###########################################
#
# Conversion Decisions for Sons of Heaven
#
###########################################

# Written by Hansol "LumberKing" Lee

decisions = {

	convert_to_confucianism = {
		potential = {
			ai = no
			is_playable = yes
			religion_group = chinese_group
			NOT = { religion = confucian }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = confucian
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = confucian
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.110 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are confucian and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = confucian }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = confucian }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_to_amidism = {
		potential = {
			ai = no
			is_playable = yes
			OR = {
				religion_group = chinese_group
				religion = chinese_pagan_reformed
				religion = chinese_pagan
				religion = japanese_pagan_reformed
				religion = japanese_pagan
				religion = korean_pagan_reformed
				religion = korean_pagan
				religion = ryukyuan_pagan_reformed
				religion = ryukyuan_pagan
				religion = viet_pagan_reformed
				religion = viet_pagan
				AND = {
					religion = buddhist
					trait = mahayana_buddhist
				}
			}
			NOT = { religion = amidist }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = amidist
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = amidist
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.111 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are amidist and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = amidist }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = amidist }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_to_taoism = {
		potential = {
			ai = no
			is_playable = yes
			religion_group = chinese_group
			NOT = { religion = taoist }
			is_theocracy = no
		}
		allow = {
			is_adult = yes
			prestige = 500
			NOT = { trait = zealous }
			any_realm_province = {
				religion = taoist
			}
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_converted }
			}
		}
		effect = {
			if = {
				limit = { higher_tier_than = BARON }
				religion_authority = {
					modifier = ruler_converted_from
				}
			}
			religion = taoist
			if = {
				limit = { higher_tier_than = BARON }
				hidden_tooltip = {
					religion_authority = {
						modifier = ruler_converted_to
					}
				}
			}
			set_character_flag = china_converted
			prestige = -500
			piety = 100
			hidden_tooltip = { character_event = { id = SoH.110 } } # Choose branch
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1

			modifier = { # Slow down
				factor = 0.1
			}
			modifier = { # Don't convert away from liege's religion
				factor = 0
				liege = { religion = ROOT }
			}
			modifier = { # Don't start rocking the boat if all your provinces are under foreign religious influence
				factor = 0
				NOT = {
					any_realm_province = {
						religion_group = chinese_group
					}
				}
			}
			modifier = { # NEVER consider it unless your liege or, if independent, all your vassals are taoist and they don't like you
				factor = 0
				NOT = {
					OR = {
						AND = {
							independent = yes
							NOT = {
								any_vassal = {
									NOT = { religion = taoist }
								}
							}
							NOT = {
								any_vassal = {
									opinion = {
										who = ROOT
										value = 25
									}
								}
							}
						}
						AND = {
							liege = { religion = taoist }
							opinion = {
								who = liege
								value = 25
							}
						}
					}
				}
			}
			modifier = { # More likely to do it sooner
				factor = 3
				trait = cynical
			}
			modifier = { # Sometimes you really need to hurry up
				factor = 5
				higher_tier_than = DUKE
				num_of_vassals = 5
			}
		}
	}

	convert_chinese_branch = {
		potential = {
			ai = no
			is_playable = yes
			is_adult = yes
			is_theocracy = no
			OR = {
				religion_group = chinese_group
				religion = chinese_pagan_reformed
				religion = chinese_pagan
			}
		}
		allow = {
			NOT = { trait = zealous }
			prestige = 50
			custom_tooltip = {
				text = chinese_has_not_converted
				NOT = { has_character_flag = china_branch_converted }
			}
		}
		effect = {
			set_character_flag = china_branch_converted
			prestige = -50
			piety = 25
			if = {
				limit = { 
					OR = {
						religion = chinese_pagan_reformed
						religion = chinese_pagan
						religion = confucian
						religion = taoist
					}
				}
				character_event = { id = SoH.115 } # Choose branch
			}
			if = {
				limit = { religion = amidist }
				character_event = { id = SoH.116 } # Choose branch
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Confucian faith if their wife or a concubine is a believer
	convert_to_spouse_confucian = {
		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			NOT = { religion = chinese_pagan_reformed }
			NOT = { religion = japanese_pagan_reformed }
			NOT = { religion = korean_pagan_reformed }
			NOT = { religion = tibetan_pagan_reformed }
			NOT = { religion = viet_pagan_reformed }
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = confucian
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = confucian
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = confucian

			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = agriculturalist
					}
				}
				add_trait = agriculturalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = diplomat
					}
				}
				add_trait = diplomat
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = legalist
					}
				}
				add_trait = legalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = logician
					}
				}
				add_trait = logician
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = militarist
					}
				}
				add_trait = militarist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = mohist
					}
				}
				add_trait = mohist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = naturalist
					}
				}
				add_trait = naturalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = syncretist
					}
				}
				add_trait = syncretist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = confucian
						hidden_tooltip = {
							is_alive = yes
						}
						trait = yangist
					}
				}
				add_trait = yangist
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Amidist faith if their wife or a concubine is a believer
	convert_to_spouse_amidist = {
		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			NOT = { religion = chinese_pagan_reformed }
			NOT = { religion = japanese_pagan_reformed }
			NOT = { religion = korean_pagan_reformed }
			NOT = { religion = tibetan_pagan_reformed }
			NOT = { religion = viet_pagan_reformed }
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = amidist
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = amidist
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = amidist
			
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = amidist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = amitabha_buddhist
					}
				}
				add_trait = amitabha_buddhist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = amidist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = dhyana_buddhist
					}
				}
				add_trait = dhyana_buddhist
			}
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}

	# Pagans can convert to the Taoist faith if their wife or a concubine is a believer
	convert_to_spouse_taoist = {
		potential = {
			ai = no
			is_playable = yes
			religion_group = pagan_group
			NOT = { religion = chinese_pagan_reformed }
			NOT = { religion = japanese_pagan_reformed }
			NOT = { religion = korean_pagan_reformed }
			NOT = { religion = tibetan_pagan_reformed }
			NOT = { religion = viet_pagan_reformed }
			controls_religion = no
			NOT = { trait = zealous }
			OR = {
				any_spouse = {
					religion = taoist
					hidden_tooltip = {
						is_alive = yes
					}
				}
				any_consort = {
					religion = taoist
					hidden_tooltip = {
						is_alive = yes
					}
				}
			}
		}
		
		effect = {
			prestige = -500
			religion_authority = {
				modifier = ruler_converted_from
			}
			
			if = {
				limit = {
					trait = cynical
				}
				random = {
					chance = 60
					add_trait = sympathy_pagans
				}
			}
			if = {
				limit = {
					NOT = { trait = cynical }
				}
				random = {
					chance = 50
					add_trait = sympathy_pagans
				}
			}		
			
			religion = taoist
			
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = agriculturalist
					}
				}
				add_trait = agriculturalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = diplomat
					}
				}
				add_trait = diplomat
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = legalist
					}
				}
				add_trait = legalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = logician
					}
				}
				add_trait = logician
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = militarist
					}
				}
				add_trait = militarist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = mohist
					}
				}
				add_trait = mohist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = naturalist
					}
				}
				add_trait = naturalist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = syncretist
					}
				}
				add_trait = syncretist
			}
			if = {
				limit = {
					any_courtier = {
						OR = {
							spouse = { character = ROOT }
							is_consort = ROOT
						}
						religion = taoist
						hidden_tooltip = {
							is_alive = yes
						}
						trait = yangist
					}
				}
				add_trait = yangist
			}
			hidden_tooltip = {
				religion_authority = {
					modifier = ruler_converted_to
				}
			}
			piety = 200
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 0
		}
	}
}
