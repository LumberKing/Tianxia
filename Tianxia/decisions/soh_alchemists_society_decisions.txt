society_decisions = {
	gather_alchemical_ingredients = {
		ai_check_interval = 24

		potential = {
			society_member_of = the_alchemists
		}

		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			NOR = {
				trait = treasure_fleet_preparation
				trait = in_mourning
			}

			custom_tooltip = {
				text = acquire_ingredients_decision_cooldown_timer_tt

				NOT = { has_character_modifier = acquire_ingredients_decision_cooldown_timer }
			}

			custom_tooltip = {
				text = acquire_ingredients_decision_too_many_ingredients

				NOT = {
					any_artifact = {
						count >= 10 # A higher bar than for the Hermetics; the Alchemists are all about ingredients!
						has_artifact_flag = ingredient
					}
				}
			}
		}

		effect = {
			custom_tooltip = { text = acquire_ingredients_effect_tooltip }

			add_character_modifier = {
				name = acquire_ingredients_decision_cooldown_timer
				years = 2 # Shorter than for the Hermetics
				hidden = yes
			}

			# TIANXIATODO: Event
		}

		ai_will_do = {
			factor = 0.01

			trigger = {
				# Already have ingredients
				NOT = {
					any_artifact = {
						has_artifact_flag = ingredient
					}
				}
			}
		}
	}

	build_alchemical_laboratory = {
		ai_check_interval = 36

		is_high_prio = yes

		only_playable = yes

		potential = {
			society_member_of = the_alchemists
			has_quest = quest_alchemists_build_laboratory
			block_general_event_trigger = no

			NOR = {
				has_character_flag = building_laboratory
				has_character_flag = built_laboratory
			}
		}

		allow = {
			wealth >= 50
		}

		effect = {
			wealth = -50

			custom_tooltip = {
				text = start_constructing_laboratory_tooltip

				set_character_flag = building_laboratory
				# TIANXIATODO: Event
			}
		}

		ai_will_do = {
			factor = 1

			trigger = {
				wealth >= 75
			}

			mult_modifier = {
				factor = 0.1
				age < 30
			}
		}
	}
	
	sell_potions = {
		ai_check_interval = 24
		
		potential = {
			society_member_of = the_alchemists
		}
		
		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			NOR = {
				trait = treasure_fleet_preparation
				trait = in_mourning
			}
			
			has_society_currency_minor_trigger = yes
			
			custom_tooltip = {
				text = sell_potions_timer_tt

				NOT = { has_character_modifier = sell_potions_timer }
			}

			custom_tooltip = {
				text = must_have_ingredients_tt

				any_artifact = {
					count >= 2
					has_artifact_flag = ingredient
				}
			}
		}
		
		effect = {
			detract_society_currency_minor_effect = yes
			
			add_character_modifier = {
				name = sell_potions_timer
				years = 2
				hidden = yes
			}
			
			# TIANXIATODO: Event
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				any_artifact = {
					count >= 4
					has_artifact_flag = ingredient
				}
				wealth < 1000
			}
			
			mult_modifier = {
				factor = 0.1
				has_society_currency_medium_trigger = no
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
	
	laboratory_experiment = {
		ai_check_interval = 24
		
		potential = {
			society_member_of = the_alchemists
			society_rank >= 2
		}
		
		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			NOR = {
				trait = treasure_fleet_preparation
				trait = in_mourning
			}
			
			has_society_currency_medium_trigger = yes

			custom_tooltip = {
				text = must_have_a_laboratory_tt

				has_character_flag = built_laboratory
			}

			custom_tooltip = {
				text = must_have_an_ingredient_tt

				any_artifact = {
					has_artifact_flag = ingredient
				}
			}

			custom_tooltip = {
				text = no_recent_laboratory_experiment_tt

				NOT = { has_character_modifier = recent_laboratory_test }
			}
		}
	}
	
	brew_immortality_potion = {
		ai_check_interval = 120
		
		potential = {
			society_member_of = the_alchemists
			society_rank == 4
		}
		
		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			NOR = {
				trait = treasure_fleet_preparation
				trait = in_mourning
			}
			
			custom_tooltip = {
				text = society_currency_5000_tt
				society_currency >= 5000
			}

			custom_tooltip = {
				text = must_have_a_laboratory_tt

				has_character_flag = built_laboratory
			}

			custom_tooltip = {
				text = must_have_many_ingredients_tt

				any_artifact = {
					count >= 5
					has_artifact_flag = ingredient
				}
			}

			custom_tooltip = {
				text = not_already_brewing_immortality_potion_tt

				NOT = { has_character_modifier = brewing_immortality_potion }
			}
			
			NOR = {
				trait = depressed
				trait = content
			}
		}
		
		effect = {
			add_character_modifier = {
				modifier = brewing_immortality_potion
				duration = -1
			}
			
			# TIANXIATODO: Event and confirmation
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				OR = {
					trait = ambitious
					trait = proud
				}
				trait = physician
			}
			
			mult_modifier = {
				factor = 0.01
				check_variable = {
					which = alchemy_healing_knowledge
					value < 100
				}
			}
		}
	}
}

targeted_decisions = {
	self_experiment = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 24
		filter = self
		ai_target_filter = self
		
		potential = {
			has_dlc = "Mystics"
			society_member_of = the_alchemists
			character = FROM
		}

		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			NOR = {
				trait = treasure_fleet_preparation
				trait = in_mourning
			}
			
			has_society_currency_minor_trigger = yes

			custom_tooltip = {
				text = must_have_an_ingredient_tt

				any_artifact = {
					has_artifact_flag = ingredient
				}
			}

			custom_tooltip = {
				text = must_not_already_be_self_experimenting_tt

				NOT = { has_character_flag = self_experiment_ongoing }
			}

			custom_tooltip = {
				text = must_not_recently_have_self_experimented_tt

				NOT = { has_character_modifier = recent_self_experiment }
			}
		}
		
		effect = {
			detract_society_currency_minor_effect = yes
			set_character_flag = self_experiment_ongoing
			
			# TIANXIATODO: Event
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				NOR = {
					trait = craven
					trait = paranoid
					trait = proud
					trait = content
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					any_artifact = {
						count >= 3
						has_artifact_flag = ingredient
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				society_rank >= 3
			}
		}
	}
	
	prisoner_testing = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 24
		filter = court
		ai_target_filter = court
		
		from_potential = {
			has_dlc = "Mystics"
			society_member_of = the_alchemists
			society_rank >= 2
		}
		
		potential = {
			is_adult = yes
			is_actually_incapable_trigger = no
			prisoner = yes
			host = {
				character = FROM
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			
			FROM = {
				has_society_currency_medium_trigger = yes
				
				has_regent = no
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}

				custom_tooltip = {
					text = must_have_ingredients_tt

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}
			}
			
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_refused_experimentation
				}
				has_character_modifier = prisoner_took_potion
			}
		}
		
		effect = {
			FROM = {
				detract_society_currency_medium_effect = yes
			}
			
			# TIANXIATODO: Event
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				FROM = {
					NOR = {
						trait = just
						trait = honest
						trait = kind
						trait = content
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					NOT = {
						any_artifact = {
							count >= 3
							has_artifact_flag = ingredient
						}
					}
				 }
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					has_society_currency_major_trigger = no
				}
			}
			
			mult_modifier = {
				factor = 10
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 5
				FROM = {
					trait = cruel
				}
			}
			
			mult_modifier = {
				factor = 2
				FROM = {
					trait = arbitrary
				}
			}
			
			mult_modifier = {
				factor = 2
				FROM = {
					trait = ambitious
				}
			}
		}
	}
	
	brew_healing_potion = {
		filter = court_including_me
		ai_target_filter = court_including_me
		ai_check_interval = 24

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank >= 2
			}
		}

		potential = {
			OR = {
				character_disease_trigger = yes
				has_symptom_trigger = yes
				has_minor_disease_trigger = yes
			}

			employer = {
				character = FROM
			}
		}

		allow = {
			show_only_failed_conditions = yes
			
			is_inaccessible_or_incapable_trigger = no

			FROM = {
				has_society_currency_minor_trigger = yes
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}

				custom_tooltip = {
					text = must_have_ingredients_tt

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}

				custom_tooltip = {
					text = must_not_already_be_preparing_potion_tt

					NOT = { has_character_flag = preparing_potion }
				}
			}
			
			custom_tooltip = {
				text  = must_not_recently_have_taken_this_potion_tt
				
				NOT = { has_character_modifier = recent_healing_potion }
			}
		}

		effect = {
			FROM = {
				show_scope_change = no

				detract_society_currency_minor_effect = yes
				set_character_flag = preparing_potion
			}

			if = {
				limit = { character = FROM } # Making yourself a potion

				custom_tooltip = {
					text = brew_healing_potion_effect_self

					set_character_flag = potion_target_is_self
					# TIANXIATODO: Event
				}
			}
			else = { # Making someone else a potion
				save_event_target_as = potion_target

				custom_tooltip = {
					text = brew_healing_potion_effect_other

					FROM = {
						# TIANXIATODO: Event
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 100
				character = FROM
			}

			mult_modifier = {
				factor = 10

				reverse_opinion = {
					who = FROM
					value >= 30
				}
			}
		}
	}
	
	choose_alchemist_lifestyle = {
		filter = self
		ai_target_filter = self
		ai_check_interval = 60

		is_in_society = yes
		only_playable = yes

		potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank >= 3
			}
		}

		allow = {
			custom_tooltip = {
				text = tooltip_not_busy

				block_general_event_trigger = no
			}
			
			custom_tooltip = {
				text = choose_alchemist_lifestyle_allow_tooltip

				NOT = { has_character_flag = choosing_alchemist_lifestyle }
			}

			OR = {
				lifestyle_traits < 1
				trait = mystic
				trait = gardener
				trait = master_schemer
			}

			has_society_currency_minor_trigger = yes
		}

		effect = {
			detract_society_currency_minor_effect = yes
			set_character_flag = choosing_alchemist_lifestyle

			if = {
				limit = {
					OR = {
						trait = mystic
						trait = gardener
						trait = master_schemer
					}
				}

				# TIANXIATODO: Event
			}
			else = {
				# TIANXIATODO: Event
			}
		}

		ai_will_do = {
			factor = 1

			trigger = {
				lifestyle_traits < 1
			}
		}
	}
	
	brew_clarity_potion = {
		filter = court_including_me
		ai_target_filter = court_including_me
		ai_check_interval = 24

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank >= 3
			}
		}

		potential = {
			OR = {
				trait = stressed
				trait = depressed
				trait = headache
				trait = malaise
				trait = fatigue
			}

			employer = {
				character = FROM
			}
		}

		allow = {
			show_only_failed_conditions = yes
			
			is_inaccessible_or_incapable_trigger = no

			FROM = {
				has_society_currency_minor_trigger = yes
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}

				custom_tooltip = {
					text = must_have_ingredients_tt

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}

				custom_tooltip = {
					text = must_not_already_be_preparing_potion_tt

					NOT = { has_character_flag = preparing_potion }
				}
			}
			
			custom_tooltip = {
				text  = must_not_recently_have_taken_this_potion_tt
				
				NOT = { has_character_modifier = recent_clarity_potion }
			}
		}

		effect = {
			FROM = {
				show_scope_change = no

				detract_society_currency_minor_effect = yes
				set_character_flag = preparing_potion
			}

			if = {
				limit = { character = FROM } # Making yourself a potion

				custom_tooltip = {
					text = brew_clarity_potion_effect_self

					set_character_flag = potion_target_is_self
					# TIANXIATODO: Event
				}
			}
			else = { # Making someone else a potion
				save_event_target_as = potion_target

				custom_tooltip = {
					text = brew_clarity_potion_effect_other

					FROM = {
						# TIANXIATODO: Event
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 100
				character = FROM
			}

			mult_modifier = {
				factor = 10

				reverse_opinion = {
					who = FROM
					value >= 30
				}
			}
		}
	}
	
	brew_fertility_potion = {
		filter = court_including_me
		ai_target_filter = court_including_me
		ai_check_interval = 24

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank >= 3
			}
		}

		potential = {
			is_adult = yes

			employer = {
				character = FROM
			}
		}

		allow = {
			show_only_failed_conditions = yes
			
			trigger_if = {
				limit = {
					is_female = yes
				}
				
				OR = {
					is_female = no
					practical_age < 45
				}
			}
			
			trigger_else_if = {
				limit = {
					trait = eunuch
				}
				
				NOT = {
					trait = eunuch
				}
			}
			
			trigger_else_if = {
				limit = {
					trait = celibate
				}
				
				NOT = {
					trait = celibate
				}
			}
			
			trigger_if = {
				limit = {
					is_married = no
					is_consort = no
				}
				is_lover = FROM
			}
			
			trigger_if = {
				limit = {
					trait = in_mourning
				}
				NOT = {
					trait = in_mourning
				}
			}
			
			is_inaccessible_or_incapable_trigger = no

			FROM = {
				has_society_currency_medium_trigger = yes
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}

				custom_tooltip = {
					text = must_have_ingredients_tt

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}

				custom_tooltip = {
					text = must_not_already_be_preparing_potion_tt

					NOT = { has_character_flag = preparing_potion }
				}
			}
			
			custom_tooltip = {
				text  = must_not_recently_have_taken_this_potion_tt
				
				NOT = { has_character_modifier = recent_fertility_potion }
			}
		}

		effect = {
			FROM = {
				show_scope_change = no

				detract_society_currency_medium_effect = yes
				set_character_flag = preparing_potion
			}

			if = {
				limit = { character = FROM } # Making yourself a potion

				custom_tooltip = {
					text = brew_fertility_potion_effect_self

					set_character_flag = potion_target_is_self
					# TIANXIATODO: Event
				}
			}
			else = { # Making someone else a potion
				save_event_target_as = potion_target

				custom_tooltip = {
					text = brew_fertility_potion_effect_other

					FROM = {
						# TIANXIATODO: Event
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 100
				character = FROM
			}

			mult_modifier = {
				factor = 10

				reverse_opinion = {
					who = FROM
					value >= 30
				}
			}
		}
	}
	
	interview_society_member = {
		filter = society
		ai_target_filter = society
		ai_check_interval = 24

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank == 4
			}
		}
		
		potential = {
			society_member_of = the_alchemists
			society_rank <= 3
		}
		
		allow = {
			show_only_failed_conditions = yes
			
			is_inaccessible_or_incapable_trigger = no

			FROM = {
				has_society_currency_medium_trigger = yes
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}
			}
			
			NOT = {
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_recent_interview
				}
			}
		}
		
		effect = {
			FROM = {
				detract_society_currency_medium_effect = yes
			}
			
			# TIANXIATODO: Event
		}

		ai_will_do = {
			factor = 0.01
		}
	}
	
	brew_aphrodisiac = {
		filter = court_including_me
		ai_target_filter = court_including_me
		ai_check_interval = 24

		is_in_society = yes
		only_playable = yes

		from_potential = {
			has_dlc = "Mystics"

			society_rank = {
				society = the_alchemists
				rank == 4
			}
		}

		potential = {
			is_adult = yes

			employer = {
				character = FROM
			}
		}

		allow = {
			show_only_failed_conditions = yes
			
			trigger_if = {
				limit = {
					dynasty = FROM
				}
				
				OR = {
					is_married = yes
					is_consort = yes
					is_lover = FROM
				}
			}
			
			trigger_else_if = {
				limit = {
					OR = {
						is_married = FROM
						is_consort = FROM
					}
				}
				
				FROM = {
					attracted_to_root_trigger = yes
					NOT = {
						trait = celibate
					}
				}
			}
			
			NOT = {
				is_rival = FROM
			}
			
			trigger_if = {
				limit = {
					trait = in_mourning
				}
				NOT = {
					trait = in_mourning
				}
			}
			
			is_inaccessible_or_incapable_trigger = no

			FROM = {
				has_society_currency_medium_trigger = yes
				
				custom_tooltip = {
					text = tooltip_not_busy

					block_general_event_trigger = no
				}

				custom_tooltip = {
					text = must_have_ingredients_tt

					any_artifact = {
						count >= 2
						has_artifact_flag = ingredient
					}
				}

				custom_tooltip = {
					text = must_not_already_be_preparing_potion_tt

					NOT = { has_character_flag = preparing_potion }
				}
			}
			
			custom_tooltip = {
				text  = must_not_recently_have_taken_this_potion_tt
				
				NOT = { has_character_modifier = recent_aphrodisiac }
			}
		}

		effect = {
			FROM = {
				show_scope_change = no

				detract_society_currency_medium_effect = yes
				set_character_flag = preparing_potion
			}

			if = {
				limit = { character = FROM } # Making yourself a potion

				custom_tooltip = {
					text = brew_aphrodisiac_effect_self

					set_character_flag = potion_target_is_self
					# TIANXIATODO: Event
				}
			}
			else = { # Making someone else a potion
				save_event_target_as = potion_target

				custom_tooltip = {
					text = brew_aphrodisiac_effect_other

					FROM = {
						# TIANXIATODO: Event
					}
				}
			}
		}

		ai_will_do = {
			factor = 0.01

			mult_modifier = {
				factor = 100
				character = FROM
			}

			mult_modifier = {
				factor = 10

				reverse_opinion = {
					who = FROM
					value >= 30
				}
			}
		}
	}
}

title_decisions = {
	combat_disease = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 60
		
		potential = {
			tier = count
			holder_scope = {
				OR = {
					character = FROM
					any_liege = {
						character = FROM
					}
				}
			}
		}
		
		from_potential = {
			society_member_of = the_alchemists
			society_rank == 5
		}
		
		allow = {
			show_only_failed_conditions = yes
			
			OR = {
				location = {
					has_epidemic = yes
				}
				FROM = {
					OR = {
						trait = paranoid
						any_demesne_province = {
							location = {
								has_epidemic = yes
							}
						}
					}
				}
			}
			
			FROM = {
				is_inaccessible_or_incapable_trigger = no
				has_society_currency_medium_trigger = yes
			}
			
			location = {
				NOT = {
					has_province_modifier = alchemical_disease_prevention
				}
			}
		}
		
		effect = {
			FROM = {
				detract_society_currency_medium_effect = yes
			}
			
			location = {
				add_province_modifier = {
					modifier = alchemical_disease_prevention
					months = 60
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.01
				always = yes # Slow it down!
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					holder_scope = {
						character = FROM
					}
				}
			}
			
			mult_modifier = {
				factor = 10
				FROM = {
					trait = physician
				}
			}
		}
	}
}