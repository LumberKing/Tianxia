society_decisions = { # TIANXIATODO: Loc
	request_to_rank_up_rising_sun = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 12

		hide_in_decisions_list = yes # This is shown in the Society View
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			
			hidden_tooltip = {
				society_rank < 3
				days_in_society = 365
				
				trigger_if = {
					limit = {
						ai = yes
						society_rank == 1
					}
					
					society_can_rank_up = yes
				}
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			OR = {
				AND = {
					society_rank == 1
					society_currency >= 750
					
					custom_tooltip = {
						text = proved_yourself_to_mentor
						has_character_flag = proved_myself_to_mentor
					}
					
					NOT = {
						has_character_modifier = mark_of_dishonor
					}
				}
				
				AND = {
					society_rank == 2
					
					OR = {
						society_currency >= 2000
						
						AND = {
							custom_tooltip = {
								text = won_wars_of_honor
								check_variable = {
									which = wars_of_honor
									value >= 2
								}
							}
							
							society_currency >= 1000
						}
					}
					
					NOT = {
						has_character_modifier = mark_of_dishonor
					}
				}
			}
		}
		
		effect = {
			#Rank up cost
			if = {
				limit = { society_rank == 1 }
				change_society_currency = -750
			}
			
			else_if = {
				limit = { society_rank == 2 }
				if = {
					limit = {
						custom_tooltip = {
							text = won_wars_of_honor
							custom_tooltip = {
								text = won_wars_of_honor
								check_variable = {
									which = wars_of_honor
									value = 2
								}
							}
						}
					}
					change_society_currency = -1000
				}
				
				else = {
					change_society_currency = -2000
				}
			}

			#Perform rank up
			hidden_tooltip = {
				set_character_flag = has_sent_request_to_rank_up
				
				letter_event = { id = MNM.10000 days = 20 random = 10 } # sends hidden delayed event to self, which then sends request to Leader of the society
			}
		}
		
		ai_will_do = {
			factor = 1

			mult_modifier = {
				factor = 0.5 #Slow down
			}
			
			mult_modifier = {
				factor = 0.5
				trait = content
			}
			
			mult_modifier = {
				factor = 2 
				trait = ambitious
			}
		}
	}
	
	rising_sun_summon_commander = {
		only_playable = yes
		is_in_society = yes
		ai_check_interval = 36 #check only once every 36 months.
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 2 # No need to have it restricted to rank 2...
			is_adult = yes

		}
		
		allow = {
			has_society_currency_medium_trigger = yes
			is_inaccessible_trigger = no
		}
		
		effect = {
			detract_society_currency_medium_effect = yes
			
			custom_tooltip = { text = tooltip_summoning_lodge_commander }
			
			hidden_tooltip = {
				if = {
					limit = {
						culture_group = japonic
					}
					
					if = {
						limit = {
							OR = {
								has_japanese_religion_trigger = yes
								religion = buddhist
								religion_openly_ryukyuan_or_reformed_trigger = yes
							}
						}
						
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = ROOT
									culture = ROOT

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = ROOT
									culture = ROOT

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
					}
					
					else = {
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = shinto
									culture = ROOT

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = shinto
									culture = ROOT

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
					}
				}
				
				else_if = {
					limit = {
						year >= 850
					}
					
					if = {
						limit = {
							OR = {
								has_japanese_religion_trigger = yes
								religion = buddhist
								religion_openly_ryukyuan_or_reformed_trigger = yes
							}
						}
						
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = ROOT
									culture = japanese

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = ROOT
									culture = japanese

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
					}
					
					else = {
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = shinto
									culture = japanese

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = shinto
									culture = japanese

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
						
						new_character = {
							random_list = {
								25 = {
									religion = buddhist
									add_trait = mahayana_buddhist
								}
								
								25 = {
									religion = shugendo
								}
								
								25 = {
									religion = koshin
								}
								
								25 = {}
							}
						}
					}
				}
				
				else = {
					if = {
						limit = {
							OR = {
								has_japanese_religion_trigger = yes
								religion = buddhist
								religion_openly_ryukyuan_or_reformed_trigger = yes
							}
						}
						
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = ROOT
									culture = yamato

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = ROOT
									culture = yamato

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
					}
					
					else = {
						random_list = {
							50 = {
								trigger = {
									OR = {
										has_religion_feature = religion_matriarchal
										has_religion_feature = religion_equal
										has_religion_feature = religion_feature_ryukyuan
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = yes
									religion = shinto
									culture = yamato

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
							
							50 = {
								trigger = {
									NOR = {
										has_religion_feature = religion_matriarchal
									}
								}
								
								create_random_soldier = {
									random_traits = yes
									dynasty = random
									female = no
									religion = shinto
									culture = yamato

									attributes = {
										diplomacy = 4
										learning = 4
										stewardship = 4
										intrigue = 4
										martial = 14
									}
								}
							}
						}
						
						new_character = {
							random_list = {
								25 = {
									religion = buddhist
									add_trait = mahayana_buddhist
								}
								
								25 = {
									religion = shugendo
								}
								
								25 = {
									religion = koshin
								}
								
								25 = {}
							}
						}
					}
				}
				
				new_character = {
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
			
					remove_lifestyle_trait_effect = yes
					
					if = { 
						limit = { 
							is_female = yes 

							ROOT = {
								NOR = {
									has_religion_feature = religion_matriarchal
									has_religion_feature = religion_feature_minangkabau
									has_religion_feature = religion_patriarchal
									has_religion_feature = religion_feature_batak
									has_religion_feature = religion_feature_yi

									has_game_rule = { # Gender equality trigger?
										name = gender
										value = all
									}
								}
							}
						}
						
						set_character_flag = special_marshal
					}
			
					random_list = { # Flavor Randomization
						35 = { 
							# Nothing
						}
						
						15 = {
							change_martial = 2
						}
						
						10 = {
							add_trait = brawny
						}
						
						10 = {
							add_trait = duelist
						}
						
						10 = {
							add_trait = hunter
						}
						
						5 = {
							add_trait = strategist
						}
						
						5 = {
							change_martial = 4
						}
						
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						
						5 = { 
							add_trait = shrewd
						}
						
						3 = { 
							add_trait = giant
						}
					}
					
					join_society = warriors_of_the_rising_sun
					
					hidden_tooltip = {
						add_trait = rising_sun_leader
						if = {
							limit = {
								has_religion_feature = religion_astrology
							}
							
							hidden_tooltip = { add_western_zodiac_trait_effect = yes }
						}

						if = {
							limit = {
								religion_group = pagan_group
								has_religion_feature = religion_no_leader
							}

							random_list = {
								 5 = { add_trait = pagan_branch_1 }
								25 = { add_trait = pagan_branch_2 }
								25 = { add_trait = pagan_branch_3 }
								25 = { add_trait = pagan_branch_4 }
							}
						}
					}
					
					set_character_flag = invited_lodge_soldier
					set_character_flag = lodge_warrior_original_court_@ROOT
					set_character_flag = no_court_invites
					save_event_target_as = invited_lodge_soldier
				}
				
				if = {
					limit = {
						government = japanese_feudal_government
					}
					event_target:invited_lodge_soldier = {
						add_trait = japanese_feudal_trait
					}
				}
			}
			
			character_event = { id = soh.3204 } # Inform ROOT about the new character
		}
		
		ai_will_do = {
			factor = 0.1

			trigger = {
				# Only use if empty commander spots
				can_grant_title = title_commander
			}
			
			mult_modifier = {
				factor = 0.5
				war = no #Only summon in time of need.
			}
			
			mult_modifier = {
				factor = 0.1
				any_courtier = { society_member_of = warriors_of_the_rising_sun } #Less likely to invite if there is already someone else at court.
			}
			
			mult_modifier = {
				factor = 0.1
				job_marshal = { martial >= 16 }
			}
		}
	}
	
	rising_sun_enlist_ronin = {
		only_playable = yes
		is_in_society = yes
		is_mercenary = yes
		is_high_prio = yes
		ai_check_interval = 20 #check only once every 20 months.
		
		potential = {
			has_dlc = "Holy Fury"
			is_playable = yes
			is_adult = yes
			society_member_of = warriors_of_the_rising_sun
			society_rank >=2
			
			OR = { 
				has_japanese_religion_trigger = yes
				AND = {
					culture_group = japonic
					religion = buddhist
				}
				religion_openly_ryukyuan_or_reformed_trigger = yes
			}
			
			OR = {
				ai = no

				trigger_if = {
					limit = { ai = yes }

					OR = {
						is_primary_war_defender = yes
						is_primary_war_attacker = yes
					}
				}
			}
		}
		allow = {
			war = yes
			has_society_currency_medium_trigger = yes
			is_inaccessible_trigger = no
			
			custom_tooltip = { 
				text = tooltip_has_not_already_enlisted_ronin
				hidden_tooltip = { NOT = { has_character_modifier = enlisted_ronin } } 
			}
		}
		
		effect = {
			detract_society_currency_medium_effect = yes
			
			capital_scope = {
			
				PREV = {
					spawn_unit = {
						owner = ROOT
						province = PREV
						home = PREV
						troops = {
							light_cavalry = { 200 200 }
							horse_archers = { 200 200 }
							heavy_infantry = { 100 100 }
							pikemen = { 500 500 }
							archers = { 500 500 }
						}
						earmark = enlisted_ronin
					}
				}
			}
			
			hidden_tooltip = { 
				add_character_modifier = { 
					modifier = enlisted_ronin 
					duration = -1 #Removed on_action when player is back at peace
					hidden = yes
				} 
			}
		}
		
		ai_will_do = {
			factor = 0 # decisions with the "is_mercenary" will not be calculated from the script
		}
	}
	
	rising_sun_become_japanese_feudal = {
		only_playable = yes
		is_in_society = yes
		is_high_prio = yes
		
		ai_check_interval = 60
		
		potential = {
			has_dlc = "Holy Fury"
			is_adult = yes
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 3
			
			is_feudal = yes
			OR = {
				government = japanese_bureaucracy_government
				government = japanese_monastic_feudal_government
			}
			
			trigger_if = {
				limit = {
					ai = yes
				}
				NOT = {
					government = japanese_monastic_feudal_government
				}
			}
		}
		
		allow = {
			has_actual_regency_trigger = no
			society_currency >= 1000
		}
		
		effect = {
			change_society_currency = -1000
			
			hidden_tooltip = {
				add_trait = japanese_feudal_trait
				remove_trait = japanese_monastic_trait
			}
			
			set_government_type = japanese_feudal_government
			
			if = {
				limit = {
					has_quest = quest_rising_sun_become_japanese_feudal
				}
				character_event = { id = soh.2638 } # Quest completed
			}
		}
		
		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.01
				NOT = {
					society_rank == 4
				}
			}
			
			trigger = {
				NOT = {
					liege = {
						dynasty = ROOT
						religion = ROOT
						OR = {
							government = japanese_monastic_feudal_government
							controls_religion = yes
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.01
				always = yes # Slow it down
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					government = japanese_feudal_government
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					dynasty = ROOT
					government = japanese_feudal_government
				}
			}
			
			mult_modifier = {
				factor = 0.1
				has_education_learning_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_education_stewardship_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_lifestyle_learning_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_lifestyle_stewardship_trigger = yes
			}
		}
	}
	
	rising_sun_subjugation_increase_progress_leader = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 12 # Important!
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank == 4
			
			society = {
				society_has_active_progress = yes
			}
			
			has_character_flag = preparing_rising_sun_subjugation
		}
		
		allow = {
			has_character_modifier = preparing_rising_sun_subjugation
			has_actual_regency_trigger = no
			
			society_currency >= 1000
			
			NOT = {
				has_character_modifier = increased_rising_sun_progress
			}
		}
		
		effect = {
			change_society_currency = -1000
			
			add_society_progress = 10
			
			add_character_modifier = {
				modifier = increased_rising_sun_progress
				days = 365
			}
		}
		
		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.05
				always = yes
			}
			
			mult_modifier = {
				factor = 2
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	rising_sun_subjugation_increase_progress_other = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 60
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank <= 3
			
			society = {
				society_has_active_progress = yes
				any_society_member = {
					has_character_flag = preparing_rising_sun_subjugation
				}
			}
		}
		
		allow = {
			any_society_member = {
				society_rank == 4
				society_member_of = warriors_of_the_rising_sun
				is_playable = yes # If the Master is unlanded, there can be no invasion...
			}
			
			society = {
				society_has_active_progress = yes
			}
			
			has_actual_regency_trigger = no
			society_currency >= 500
			
			NOT = {
				has_character_modifier = increased_rising_sun_progress
			}
		}
		
		effect = {
			change_society_currency = -500
			add_society_progress = 2.5
			
			add_character_modifier = {
				modifier = increased_rising_sun_progress
				days = 365
			}
			
			hidden_tooltip = {
				any_society_member = {
					limit = {
						society_rank == 4
						society_member_of = warriors_of_the_rising_sun
					}
					letter_event = { id = soh.3208 } # Inform the grandmaster
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				NOR = {
					trait = content
					any_society_member = {
						society_member_of = warriors_of_the_rising_sun
						society_rank == 4
						is_rival = ROOT
					}
				}
			}
			
			mult_modifier = {
				factor = 0.01 # Don't have members spam it!
				always = yes
			}
			
			mult_modifier = {
				factor = 2
				trait = ambitious
			}
		}
	}
	
	rising_sun_launch_subjugation_ai = { # The AI might look at the target and get scared because it is weaker before the society is accounted for, so let's not have that!
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 12 # Important!
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank == 4
			ai = yes
		}
		
		allow = {
			war = no
			has_actual_regency_trigger = no
			
			society = {
				society_progress >= 100
			}
			
			has_game_rule = {
				name = rising_sun_subjugation_availability
				value = allowed
			}
			
			has_character_modifier = preparing_rising_sun_subjugation
			
			any_independent_ruler = { # TIANXIATODO: Further cleanup
				NOR = {
					has_truce = ROOT
					has_non_aggression_pact_with = ROOT
				}
				
				ROOT = {
					OR = {
						# Attacker or any liege has a Chinese Peace Deal, defender is China
						AND = {
							OR = {
								has_character_modifier = peace_deal_with_china
								any_liege = {
									has_character_modifier = peace_deal_with_china
								}
							}
							
							PREV = {
								is_chinese_emperor_trigger = yes
							}
						}
						
						# Attacker is the EoC and defender has a Chinese Peace Deal
						AND = {
							ROOT = {
								is_chinese_emperor_trigger = yes
							}
							
							PREV = {
								has_character_modifier = peace_deal_with_china
							}
						}
						
						# Attacker or any liege has a peace deal with China and defender is a tributary China might defend
						AND = {
							ROOT = {
								OR = {
									has_character_modifier = peace_deal_with_china
									any_liege = {
										has_character_modifier = peace_deal_with_china
									}
								}
							}
							
							PREV = {
								OR = {
									is_tributary = {
										type = chinese_imperial_tributary
									}
									is_tributary = {
										type = chinese_protectorate
									}
									is_tributary = {
										type = chinese_client_state
									}
								}
								
								suzerain = {
									is_chinese_emperor_trigger = yes
								}
							}
						}
						
						# Attacker is a tributary of China (or a subject of such a tributary) and defender is a high-tier tributary of China
						AND = {
							ROOT = {
								OR = {
									AND = {
										OR = {
											is_tributary = {
												type = chinese_peripheral_tributary
											}
											is_tributary = {
												type = chinese_imperial_tributary
											}
											is_tributary = {
												type = chinese_protectorate
											}
											is_tributary = {
												type = chinese_client_state
											}
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
									
									top_liege = {
										OR = {
											is_tributary = {
												type = chinese_peripheral_tributary
											}
											is_tributary = {
												type = chinese_imperial_tributary
											}
											is_tributary = {
												type = chinese_protectorate
											}
											is_tributary = {
												type = chinese_client_state
											}
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
							}
							
							PREV = {
								OR = {
									AND = {
										ROOT = {
											NOT = {
												is_tributary = {
													type = chinese_protectorate
												}
											}
										}
										
										is_tributary = {
											type = chinese_protectorate
										}
									}
									
									is_tributary = {
										type = chinese_client_state
									}
								}
							}
						}
						
						# Attacker is a Client State (or vassal of a Client State) or a vassal of China and defender is any kind of Chinese tributary or has a Chinese Peace Deal
						AND = {
							ROOT = {
								OR = {
									AND = {
										is_tributary = {
											type = chinese_client_state
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
									
									top_liege = {
										is_tributary = {
											type = chinese_client_state
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
									
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
							}
							
							PREV = {
								OR = {
									AND = {
										OR = {
											is_tributary = {
												type = chinese_peripheral_tributary
											}
											is_tributary = {
												type = chinese_imperial_tributary
											}
											is_tributary = {
												type = chinese_protectorate
											}
											is_tributary = {
												type = chinese_client_state
											}
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
									
									has_character_modifier = peace_deal_with_china
								}
							}
						}
					}
				}
				
				any_realm_province = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																is_liege_or_above = ROOT
															}
														}
													}
													
													AND = {
														is_land = no
														any_neighbor_province = {
															OR = {
																AND = {
																	has_owner = yes
																	owner = {
																		OR = {
																			character = ROOT
																			is_liege_or_above = ROOT
																		}
																	}
																}
																
																AND = {
																	is_land = no
																	any_neighbor_province = {
																		owner = {
																			OR = {
																				character = ROOT
																				is_liege_or_above = ROOT
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				NOR = {
					is_the_tenno_trigger = yes
					is_ryukyuan_tenno_trigger = yes
					any_realm_lord = {
						OR = {
							is_the_tenno_trigger = yes
							is_ryukyuan_tenno_trigger = yes
						}
					}
				}
			}
			
			society_currency >= 1000
			
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			
			NOT = {
				trait = treasure_fleet_preparation
			}
		}
		
		effect = { # TIANXIATODO: Further cleanup
			change_society_currency = -1000
			random_independent_ruler = {
				limit = {
					NOR = {
						has_truce = ROOT
						has_non_aggression_pact_with = ROOT
				
						ROOT = {
							OR = {
								# Attacker or any liege has a Chinese Peace Deal, defender is China
								AND = {
									OR = {
										has_character_modifier = peace_deal_with_china
										any_liege = {
											has_character_modifier = peace_deal_with_china
										}
									}
									
									PREV = {
										is_chinese_emperor_trigger = yes
									}
								}
								
								# Attacker is the EoC and defender has a Chinese Peace Deal
								AND = {
									ROOT = {
										is_chinese_emperor_trigger = yes
									}
									
									PREV = {
										has_character_modifier = peace_deal_with_china
									}
								}
								
								# Attacker or any liege has a peace deal with China and defender is a tributary China might defend
								AND = {
									ROOT = {
										OR = {
											has_character_modifier = peace_deal_with_china
											any_liege = {
												has_character_modifier = peace_deal_with_china
											}
										}
									}
									
									PREV = {
										OR = {
											is_tributary = {
												type = chinese_imperial_tributary
											}
											is_tributary = {
												type = chinese_protectorate
											}
											is_tributary = {
												type = chinese_client_state
											}
										}
										
										suzerain = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
								
								# Attacker is a tributary of China (or a subject of such a tributary) and defender is a high-tier tributary of China
								AND = {
									ROOT = {
										OR = {
											AND = {
												OR = {
													is_tributary = {
														type = chinese_peripheral_tributary
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_client_state
													}
												}
												
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											
											top_liege = {
												OR = {
													is_tributary = {
														type = chinese_peripheral_tributary
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_client_state
													}
												}
												
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									
									PREV = {
										OR = {
											AND = {
												ROOT = {
													NOT = {
														is_tributary = {
															type = chinese_protectorate
														}
													}
												}
												
												is_tributary = {
													type = chinese_protectorate
												}
											}
											
											is_tributary = {
												type = chinese_client_state
											}
										}
									}
								}
								
								# Attacker is a Client State (or vassal of a Client State) or a vassal of China and defender is any kind of Chinese tributary or has a Chinese Peace Deal
								AND = {
									ROOT = {
										OR = {
											AND = {
												is_tributary = {
													type = chinese_client_state
												}
												
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											
											top_liege = {
												is_tributary = {
													type = chinese_client_state
												}
												
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
									
									PREV = {
										OR = {
											AND = {
												OR = {
													is_tributary = {
														type = chinese_peripheral_tributary
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_client_state
													}
												}
												
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											
											has_character_modifier = peace_deal_with_china
										}
									}
								}
							}
						}
						
						is_the_tenno_trigger = yes
						is_ryukyuan_tenno_trigger = yes
						any_realm_lord = {
							OR = {
								is_the_tenno_trigger = yes
								is_ryukyuan_tenno_trigger = yes
							}
						}
					}
				}
				
				if = {
					limit = {
						any_realm_province = {
							any_neighbor_province = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
						}
					}
					
					random_realm_province = {
						limit = {
							any_neighbor_province = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
						}
						
						kingdom = {
							save_event_target_as = rising_sun_subjugation_target
						}
					}
				}
				
				else_if = {
					limit = {
						any_realm_province = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
							}
						}
					}
					
					random_realm_province = {
						limit = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
							}
						}
						
						kingdom = {
							save_event_target_as = rising_sun_subjugation_target
						}
					}
				}
				
				else_if = {
					limit = {
						any_realm_province = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									is_land = no
									any_neighbor_province = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
					
					random_realm_province = {
						limit = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									is_land = no
									any_neighbor_province = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
						
						kingdom = {
							save_event_target_as = rising_sun_subjugation_target
						}
					}
				}
				
				else_if = {
					limit = {
						any_realm_province = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									is_land = no
									any_neighbor_province = {
										is_land = no
										any_neighbor_province = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
									}
								}
							}
						}
					}
					
					random_realm_province = {
						limit = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									is_land = no
									any_neighbor_province = {
										is_land = no
										any_neighbor_province = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
									}
								}
							}
						}
						
						kingdom = {
							save_event_target_as = rising_sun_subjugation_target
						}
					}
				}
				
				else = {
					random_realm_province = {
						limit = {
							any_neighbor_province = {
								is_land = no
								any_neighbor_province = {
									is_land = no
									any_neighbor_province = {
										is_land = no
										any_neighbor_province = {
											is_land = no
											any_neighbor_province = {
												has_owner = yes
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
						
						kingdom = {
							save_event_target_as = rising_sun_subjugation_target
						}
					}
				}
				
				reverse_war = {
					target = ROOT
					casus_belli = rising_sun_subjugation_cb
					thirdparty_title = event_target:rising_sun_subjugation_target
				}
			}
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	plan_rising_sun_subjugation = {
		only_playable = yes
		is_in_society = yes
		is_high_prio = yes
		
		ai_check_interval = 120
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank == 4
		}
		
		allow = {
			war = no
			has_actual_regency_trigger = no
			
			society_currency >= 1000
			
			NOR = {
				has_character_modifier = preparing_rising_sun_subjugation
				has_character_modifier = launched_rising_sun_subjugation
			}
			
			OR = {
				has_game_rule = {
					name = rising_sun_subjugation_availability
					value = allowed
				}
				AND = {
					has_game_rule = {
						name = rising_sun_subjugation_availability
						value = no_ai
					}
					ai = no
				}
			}
		}
		
		effect = {
			set_character_flag = preparing_rising_sun_subjugation
			
			society = {
				start_society_progress = yes
				set_society_progress = 0
			}
			
			change_society_currency = -1000
			
			narrative_event = { id = soh.3207 } # Inform ROOT
			
			add_character_modifier = {
				modifier = preparing_rising_sun_subjugation
				duration = -1
			}
			
			any_playable_ruler = {
				limit = {
					ai = no
					OR = {
						is_within_diplo_range = ROOT
						society_member_of = warriors_of_the_rising_sun
					}
				}
				narrative_event = { id = soh.3207 } # Inform the world
			}
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				higher_real_tier_than = count
				society_currency >= 2000
				NOT = {
					trait = content
				}
				
				OR = {
					has_japanese_religion_trigger = yes
					AND = {
						culture_group = japonic
						religion = buddhist
					}
					religion_openly_ryukyuan_or_reformed_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.01
				always = yes
			}
			
			mult_modifier = {
				factor = 0.2
				society_currency < 3000 # We'd not be likely to be able to launch an invasion
			}
			
			mult_modifier = {
				factor = 0.5
				society_currency < 4000 # We'd not be likely to be able to launch an invasion
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
}

targeted_decisions = {
	call_into_my_war_independent = {
		only_independent = yes
		is_in_society = yes
		
		ai_check_interval = 12
		
		ai_target_filter = society
		filter = society
		
		from_potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			war = yes
			
			NOT = {
				any_war = {
					using_cb = war_of_honor
				}
			}
			
			OR = {
				is_primary_war_defender = yes
				is_primary_war_attacker = yes
			}
		}
		
		potential = {
			independent = yes
			society_member_of = warriors_of_the_rising_sun
			war = no
			
			NOT = {
				is_rival = FROM
			}
			
			FROM = {
				OR = {
					# Has a higher rank and 100+ Honor
					AND = {
						society_currency >= 100
						OR = {
							society_rank == 4
							AND = {
								society_rank == 3
								ROOT = {
									society_rank <= 2
								}
							}
							AND = {
								society_rank >= 2
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					# Has the same rank and 200+ Honor
					AND = {
						society_currency >= 200
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 2
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					# Is one rank below and has 500+ Honor
					AND = {
						society_currency >= 200
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 4
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 2
								}
							}
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				custom_tooltip = {
					text = root_is_not_blocked_by_truce_nap_liege_relationship
					NOR = {
						any_war = {
							attacker = {
								character = FROM
							}
							
							defender = {
								OR = {
									has_truce = ROOT
									has_non_aggression_pact_with = ROOT
									any_liege = {
										character = ROOT
									}
									ROOT = {
										any_liege = {
											character = PREV
										}
									}
								}
							}
						}
						
						any_war = {
							attacker = {
								OR = {
									has_truce = ROOT
									has_non_aggression_pact_with = ROOT
									any_liege = {
										character = ROOT
									}
									ROOT = {
										any_liege = {
											character = PREV
										}
									}
								}
							}
							
							defender = {
								character = FROM
							}
						}
					}
				}
				
				custom_tooltip = {
					text = root_can_reach_the_enemy
					OR = {
						any_war = {
							attacker = {
								character = FROM
							}
							
							defender = {
								any_realm_title = {
									location = {
										ROOT = {
											capital_scope = {
												OR = {
													AND = { #Either you can travel via water to them...
														is_coastal = yes
														can_naval_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = {
														#Or they are accessible via land...
														PREVPREV = { is_coastal = no }
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = { #Or not a coastal place...
														is_coastal = no
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
												}
											}
										}
									}
								}
							}
						}
						
						any_war = {
							attacker = {
								any_realm_title = {
									location = {
										ROOT = {
											capital_scope = {
												OR = {
													AND = { #Either you can travel via water to them...
														is_coastal = yes
														can_naval_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = {
														#Or they are accessible via land...
														PREVPREV = { is_coastal = no }
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = { #Or not a coastal place...
														is_coastal = no
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
												}
											}
										}
									}
								}
							}
							
							defender = {
								character = FROM
							}
						}
					}
				}
			}
		}
		
		effect = {
			FROM = {
				if = {
					limit = {
						# Has a higher rank and 100+ Honor
						OR = {
							society_rank == 4
							AND = {
								society_rank == 3
								ROOT = {
									society_rank <= 2
								}
							}
							AND = {
								society_rank >= 2
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					change_society_currency = -100
				}
				
				else_if = {
					limit = {
						# Has the same rank and 200+ Honor
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 2
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					change_society_currency = -200
				}
				
				else = {
					change_society_currency = -500
				}
			}
			
			letter_event = { id = soh.3201 } # ROOT gets the CtA
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				FROM = {
					OR = {
						any_war = {
							attacker = {
								character = ROOT
							}
							defender = {
								relative_power_including_allies_defender = {
									who = FROM
									power = 2
								}
							}
						}
						any_war = {
							defender = {
								character = ROOT
							}
							attacker = {
								relative_power_including_allies_attacker = {
									who = FROM
									power = 2
								}
							}
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	call_into_my_war = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 12
		
		ai_target_filter = society
		filter = society
		
		from_potential = {
			has_dlc = "Holy Fury"
			independent = no
			society_member_of = warriors_of_the_rising_sun
			war = yes
			
			NOT = {
				any_war = {
					using_cb = war_of_honor
				}
			}
			
			OR = {
				is_primary_war_defender = yes
				is_primary_war_attacker = yes
			}
		}
		
		potential = {
			independent = no
			same_realm = FROM
			
			society_member_of = warriors_of_the_rising_sun
			war = no
			
			NOT = {
				is_rival = FROM
			}
			
			FROM = {
				OR = {
					# Has a higher rank and 100+ Honor
					AND = {
						society_currency >= 100
						OR = {
							society_rank == 4
							AND = {
								society_rank == 3
								ROOT = {
									society_rank <= 2
								}
							}
							AND = {
								society_rank >= 2
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					# Has the same rank and 200+ Honor
					AND = {
						society_currency >= 200
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 2
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					# Is one rank below and has 500+ Honor
					AND = {
						society_currency >= 200
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 4
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 2
								}
							}
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				custom_tooltip = {
					text = root_is_not_blocked_by_truce_nap_liege_relationship
					NOR = {
						any_war = {
							attacker = {
								character = FROM
							}
							
							defender = {
								OR = {
									has_truce = ROOT
									has_non_aggression_pact_with = ROOT
									any_liege = {
										character = ROOT
									}
									ROOT = {
										any_liege = {
											character = PREV
										}
									}
								}
							}
						}
						
						any_war = {
							attacker = {
								OR = {
									has_truce = ROOT
									has_non_aggression_pact_with = ROOT
									any_liege = {
										character = ROOT
									}
									ROOT = {
										any_liege = {
											character = PREV
										}
									}
								}
							}
							
							defender = {
								character = FROM
							}
						}
					}
				}
				
				custom_tooltip = {
					text = root_can_reach_the_enemy
					OR = {
						any_war = {
							attacker = {
								character = FROM
							}
							
							defender = {
								any_realm_title = {
									location = {
										ROOT = {
											capital_scope = {
												OR = {
													AND = { #Either you can travel via water to them...
														is_coastal = yes
														can_naval_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = {
														#Or they are accessible via land...
														PREVPREV = { is_coastal = no }
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = { #Or not a coastal place...
														is_coastal = no
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
												}
											}
										}
									}
								}
							}
						}
						
						any_war = {
							attacker = {
								any_realm_title = {
									location = {
										ROOT = {
											capital_scope = {
												OR = {
													AND = { #Either you can travel via water to them...
														is_coastal = yes
														can_naval_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = {
														#Or they are accessible via land...
														PREVPREV = { is_coastal = no }
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
													AND = { #Or not a coastal place...
														is_coastal = no
														can_land_path_to = { target = PREVPREV distance < 1000 }
													}
												}
											}
										}
									}
								}
							}
							
							defender = {
								character = FROM
							}
						}
					}
				}
			}
		}
		
		effect = {
			FROM = {
				if = {
					limit = {
						# Has a higher rank and 100+ Honor
						OR = {
							society_rank == 4
							AND = {
								society_rank == 3
								ROOT = {
									society_rank <= 2
								}
							}
							AND = {
								society_rank >= 2
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					change_society_currency = -100
				}
				
				else_if = {
					limit = {
						# Has the same rank and 200+ Honor
						OR = {
							AND = {
								society_rank == 3
								ROOT = {
									society_rank == 3
								}
							}
							AND = {
								society_rank == 2
								ROOT = {
									society_rank == 2
								}
							}
							AND = {
								society_rank == 1
								ROOT = {
									society_rank == 1
								}
							}
						}
					}
					
					change_society_currency = -200
				}
				
				else = {
					change_society_currency = -500
				}
			}
			
			letter_event = { id = soh.3201 } # ROOT gets the CtA
		}
		
		ai_will_do = {
			factor = 1
			
			trigger = {
				FROM = {
					OR = {
						any_war = {
							attacker = {
								character = ROOT
							}
							defender = {
								relative_power_including_allies_defender = {
									who = FROM
									power = 2
								}
							}
						}
						any_war = {
							defender = {
								character = ROOT
							}
							attacker = {
								relative_power_including_allies_attacker = {
									who = FROM
									power = 2
								}
							}
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	ask_to_be_my_mentor = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 30
		
		ai_target_filter = society
		filter = society
		
		from_potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank == 1
			
			NOR = {
				has_any_opinion_modifier = opinion_rising_sun_mentor
				has_character_flag = proved_myself_to_mentor
			}
		}
		
		potential = {
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 2
			
			NOT = {
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_rising_sun_ex_student
				}
			}
			
			NOT = {
				has_quest = quest_rising_sun_the_very_best
			}
		}
		
		allow = {
			has_actual_regency_trigger = no
			
			FROM = {
				has_actual_regency_trigger = no
				society_currency >= 0
			}
			
			NOR = {
				FROM = {
					has_character_modifier = asked_possible_mentor
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_refused_mentoring
					}
				}
			}
		}
		
		effect = {
			FROM = {
				add_character_modifier = {
					modifier = asked_possible_mentor
					days = 30
				}
			}
			
			letter_event = { id = soh.2701 days = 7 random = 7 } # Request made
		}
		
		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.02 # Slow it down a bit
				always = yes
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					combat_rating = 25 # Pick the best teachers
				}
			}
			
			mult_modifier = {
				factor = 0.1 # Wait for the quest...
				FROM = {
					NOT = {
						has_quest = quest_rising_sun_get_mentor
					}
				}
			}
			
			mult_modifier = {
				factor = 5 # Prioritize asking people with the quest
				has_quest = quest_rising_sun_get_student
			}
			
			mult_modifier = {
				factor = 0.1 # Prioritize asking low-ranking members as they're more likely to accept
				society_rank == 3
			}
			
			mult_modifier = {
				factor = 0.01 # Prioritize asking low-ranking members as they're more likely to accept
				society_rank == 4
			}
		}
	}
	
	ask_to_be_my_student = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 60
		
		ai_target_filter = society
		filter = society
		
		from_potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 2
			
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_rising_sun_ex_student
				}
			}
			
			NOT = {
				has_quest = quest_rising_sun_the_very_best
			}
		}
		
		potential = {
			society_member_of = warriors_of_the_rising_sun
			society_rank == 1
			
			NOR = {
				has_any_opinion_modifier = opinion_rising_sun_mentor
				has_character_flag = proved_myself_to_mentor
			}
			
			trigger_if = {
				limit = {
					FROM = {
						ai = no
					}
				}
				
				FROM = {
					ai = yes
				}
			}
		}
		
		allow = {
			OR = {
				AND = {
					is_ruler = yes
					has_actual_regency_trigger = no
				}
				
				AND = {
					is_ruler = no
					is_inaccessible_or_incapable_trigger = no
				}
			}
			
			FROM = {
				has_actual_regency_trigger = no
				OR = {
					AND = {
						society_currency >= 0
						has_quest = quest_rising_sun_get_student
					}
					
					society_currency >= 500
				}
			}
			
			NOR = {
				FROM = {
					has_character_modifier = asked_possible_student
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_refused_mentoring
					}
				}
				
				has_character_modifier = asked_possible_mentor
			}
		}
		
		effect = {
			# Keep the player from grabbing too many students
			if = {
				limit = {
					FROM = {
						NOT = {
							has_quest = quest_rising_sun_get_student
						}
					}
				}
				
				FROM = {
					change_society_currency = -200
				}
			}
			
			FROM = {
				add_character_modifier = {
					modifier = asked_possible_student
					days = 30
				}
			}
			
			letter_event = { id = soh.2735 days = 7 random = 7 } # Request made
		}
		
		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.02 # Slow it down a bit
				always = yes
			}
			
			mult_modifier = {
				factor = 0.1
				combat_rating < 25 # Pick the best students
			}
			
			mult_modifier = {
				factor = 0.1 # Don't bother if we don't have the quest (to leave some possible students for people looking for students)
				FROM = {
					NOT = {
						has_quest = quest_rising_sun_get_student
					}
				}
			}
			
			mult_modifier = {
				factor = 0.5 # Make it harder for women to get mentors that aren't women
				is_female = yes
				FROM = {
					is_female = no
				}
			}
			
			mult_modifier = {
				factor = 5 # Try to mentor other women, if you can
				is_female = yes
				FROM = {
					is_female = yes
				}
			}
			
			mult_modifier = {
				factor = 5 # Prioritize asking people with the quest
				has_quest = quest_rising_sun_get_mentor
				ai = yes
			}
			
			mult_modifier = {
				factor = 0.1 # If we have a high rank, don't do it very often
				FROM = {
					society_rank == 3
				}
			}
			
			mult_modifier = {
				factor = 0.01 # If we have a high rank, don't do it very often
				FROM = {
					society_rank == 4
				}
			}
		}
	}
	
	rising_sun_warrior_training = {
		filter = self
		ai_target_filter = self
		ai_check_interval = 12

		is_in_society = yes
		only_playable = yes
		
		potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank >= 2
			is_adult = yes
			NOT = {
				trait = rising_sun_leader
			}
		}
		
		allow = {
			has_society_currency_medium_trigger = yes
			NOT = {
				trait = rising_sun_leader
			}
		}
		
		effect = {
			detract_society_currency_medium_effect = yes
			
			add_trait = rising_sun_leader
			
			if = {
				limit = {
					NOR = {
						has_japanese_religion_trigger = yes
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion_openly_ryukyuan_or_reformed_trigger = yes
					}
				}
				
				piety = -150
			}
		}

		ai_will_do = {
			factor = 1

			trigger = {
				can_have_more_leadership_traits = yes
			}
			
			mult_modifier = {
				factor = 0.1
				NOR = {
					has_japanese_religion_trigger = yes
					AND = {
						religion = buddhist
						culture_group = japonic
					}
					religion_openly_ryukyuan_or_reformed_trigger = yes
				}
			}
		}
	}
	
	rising_sun_mark_of_dishonor = {
		only_playable = yes
		is_in_society = yes
		
		ai_check_interval = 120
		
		ai_target_filter = rivals
		
		from_potential = {
			has_dlc = "Holy Fury"
			society_member_of = warriors_of_the_rising_sun
			society_rank == 4
		}
		
		potential = {
			is_adult = yes
			is_playable = yes
			
			NOT = {
				has_quest = quest_the_very_best # If someone is trying to become the Very Best, they are honorable!
			}
			
			OR = {
				is_rival = FROM
				tier = FROM
				higher_tier_than = FROM
				independent = yes
			}
			
			NOR = {
				is_the_tenno_trigger = yes
				is_ryukyuan_tenno_trigger = yes
				FROM = {
					any_liege = {
						character = ROOT # You should not go after your liege!
					}
				}
				trait = japanese_regent
				trait = japanese_regent2
				trait = japanese_regent3
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			
			NOT = {
				has_character_modifier = mark_of_dishonor
			}
			
			OR = {
				NOT = {
					society_member_of = warriors_of_the_rising_sun
				}
				society_rank <= 2 # Hatamotos are immune (as they're likely to be in line to be the next leader)
			}
			
			NOR = {
				is_friend = FROM
				is_lover = FROM
				any_spouse = {
					character = FROM
				}
			}
			
			FROM = {
				OR = {
					society_currency >= 2000
					AND = {
						society_currency >= 1000
						ROOT = {
							NOT = {
								society_member_of = warriors_of_the_rising_sun
							}
						}
					}
				}
				
				has_actual_regency_trigger = no
			}
			
			has_actual_regency_trigger = no
		}
		
		effect = {
			custom_tooltip = {
				text = gets_mark_of_dishonor
			}
			
			if = {
				limit = {
					society_member_of = warriors_of_the_rising_sun
				}
				FROM = {
					change_society_currency = -2000
				}
			}
			
			else = {
				FROM = {
					change_society_currency = -1000
				}
			}
			
			character_event = { id = soh.3206 } # Inform ROOT
		}

		ai_will_do = {
			factor = 1
			
			mult_modifier = {
				factor = 0.01
				always = yes # Slow it down
			}
			
			mult_modifier = {
				factor = 10
				
				FROM = {
					trait = proud
					trait = brave
				}
				ROOT = 
				{
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					NOR = {
						has_japanese_religion_trigger = yes
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion_openly_ryukyuan_or_reformed_trigger = yes
					}
				}
			}
		}
	}
}