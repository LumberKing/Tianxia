# This file borrows heavily from the vanilla jd_grace_decisions.txt file when it comes to AI logic and requirements on people being sent to China
# All Grace decisions MUST be DLC-locked to JD to avoid conflict with modding rule 7, even though we cannot use the offmap mechanics
# Important scripted triggers are located in the tianxia_grace_triggers.txt file in the /common/scripted_triggers directory

# At the moment, ONLY the EoC will be using the Grace system, regardless of whether someone else has the Chinese Imperialism government
# A fully dynamic system is probably not possible due to the need to name the variables, but it should be possible to implement the same (or similar) decisions for specific titles, if desired

# All targeted decisions have an ai_check_interval that's 1.5 times vanilla, to account for us having extra characters

targeted_decisions = {
	### Tributes
	# Grace is gained only if the Tribute is accepted
	# Aside from the snipping of eunuchs, all effects take place if the tribute is accepted
	# The sender's opinion of the EoC is lowered if a Tribute is deemed unsuitable for the imperial court
	# The sender's opinion of the EoC is lowered even further
	# Any courtier sent to China gets disinherited
	
	send_gift_china = {
		only_playable = yes
		#ai_check_interval = 180
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			china_accepts_gold_tribute_trigger = yes # China must be accepting
			can_use_grace_decisions_from_trigger = yes
			FROM = {
				wealth = 500
			}
			NOR = {
				AND = {
					has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_sent_gift
					}
					FROM = {
						ai = yes
					}
				}
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_gift
				}
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.1 } # Fires an event for the EoC that lets him decide if he want to accept the gift or not
			}
		}

		ai_will_do = {
			factor = 0
		}
	}
	
	become_tributary_china = {
		only_independent = yes
		#ai_check_interval = 54
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_tributaries_trigger = yes
			FROM = {
				war = no # Is at peace
				is_tributary = no # Cannot break existing tributary relationship
				# Only non-emperors and nomads can become tributaries
				OR = {
					NOT = {
						real_tier = emperor
					}
					is_nomadic = yes
				}
#				# Borders China/a Chinese tributary or is within two sea zones of China/a Chinese tributary
#				any_realm_province = {
#					any_neighbor_province = {
#						OR = {
#							AND = {
#								has_owner = yes
#								owner = {
#									OR = {
#										character = ROOT
#										is_liege_or_above = ROOT
#										suzerain = {
#											character = ROOT
#										}
#										top_liege = {
#											suzerain = {
#												character = ROOT
#											}
#										}
#									}
#								}
#							}
#							AND = {
#								is_land = no
#								any_neighbor_province = {
#									OR = {
#										AND = {
#											has_owner = yes
#											owner = {
#												OR = {
#													character = ROOT
#													is_liege_or_above = ROOT
#													suzerain = {
#														character = ROOT
#													}
#													top_liege = {
#														suzerain = {
#															character = ROOT
#														}
#													}
#												}
#											}
#										}
#										AND = {
#											is_land = no
#											any_neighbor_province = {
#												owner = {
#													OR = {
#														character = ROOT
#														is_liege_or_above = ROOT
#														suzerain = {
#															character = ROOT
#														}
#														top_liege = {
#															suzerain = {
#																character = ROOT
#															}
#														}
#													}
#												}
#											}
#										}
#									}
#								}
#							}
#						}
#					}
#				}
			}
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_tributary
				}
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_breakaway_tributary # Can't trust them!
				}
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.4 } # The EoC gets the request
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	supply_horses_china = {
		only_playable = yes
		#ai_check_interval = 54
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_nomadic = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			#OR = {
			#	NOT = {
			#		has_character_modifier = china_supply_horses
			#	}
			#	ai = no
			#}
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			FROM = {
				unused_manpower = 300
			}
			can_use_grace_decisions_from_trigger = yes
			china_accepts_horses_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_horses
				}
				AND = {
					has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_supplying_horses
					}
					FROM = {
						ai = yes
					}
				}
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.8 } # Fires an event for the EoC that lets him decide if he want to accept the horses or not
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	#stop_supply_horses_china = { # Deprecated!
	#	only_playable = yes
	#	ai_check_interval = 54
	#	ai_target_filter = none # Unused
	#	
	#	from_potential = {
	#		always = no # Deprecated!
	#		has_dlc = "Jade Dragon"
	#		# Is independent, king-tier, or a human player
	#		OR = {
	#			independent = yes
	#			real_tier = king
	#			ai = no
	#		}
	#		OR = {
	#			e_china = {
	#				holder_scope = {
	#					is_within_diplo_range = PREVPREV
	#				}
	#			}
	#			any_realm_province = {
	#				trade_route = silk_road
	#			}
	#		}
	#		mercenary = no
	#		holy_order = no
	#		is_landed = yes
	#		is_nomadic = yes
	#		has_character_modifier = china_supply_horses
	#		is_chinese_emperor_trigger = no
	#		NOT = {
	#			top_liege = {
	#				is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
	#			}
	#		}
	#	}
	#	
	#	potential = {
	#		always = no # Deprecated!
	#		# The receiver must be the EoC and the Grace mechanics must be active
	#		is_chinese_emperor_trigger = yes
	#	}
	#	
	#	allow = {
	#		always = no # Deprecated!
	#		FROM = {
	#			has_character_modifier = china_supply_horses
	#		}
	#	}
	#	
	#	effect = {
	#		narrative_event = { id = grace.12 } # Informs the EoC that horses will no longer be supplied
	#	}
	#	
	#	ai_will_do = {
	#		factor = 1
	#		modifier = {
	#			factor = 0
	#			FROM = {
	#				OR = {
	#					trait = humble
	#					trait = shy
	#					trait = craven
	#				}
	#			}
	#			from_hates_china_trigger = no # If we like China, don't do this!
	#		}
	#		modifier = {
	#			factor = 0
	#			FROM = {
	#				NOR = {
	#					trait = proud
	#					trait = ambitious
	#					trait = brave
	#				}
	#			}
	#			from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
	#		}
	#		modifier = {
	#			factor = 1000
	#			from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
	#		}
	#	}
	#}
	
	offer_eunuch_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 54
		#show_third_party_potential = yes

		from_potential = {
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_eunuch_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_eunuch
				}
				AND = {
					OR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_eunuch
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_eunuch_small
						}
					}
					FROM = {
						ai = yes
					}
				}
			}
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				#custom_tooltip = {
					#text = adult_or_close_relative_of_12_years_tt
					#OR = {
						is_adult = yes # Non-adult eunuchs seem to be shipped back home by the game, which is unwanted...
						#AND = {
						#	is_close_relative = ROOT_FROM
						#	age = 12
						#}
					#}
				#}
				
				NOT = { is_heir = yes }

				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = { #can't be from China
					text = is_not_from_china_tt
					NOT = {	has_character_flag = eunuch_gift }
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				NOT = { prisoner = yes }

				OR = {
					custom_tooltip = {
						text = is_close_relative_tt
						is_close_relative = ROOT_FROM
					}
					custom_tooltip = {
						text = china_tribute_send_eunuch_stats_tt
						OR = {
							diplomacy = 20
							martial = 20
							stewardship = 20
							intrigue = 20
							learning = 20
						}
					}
					custom_tooltip = {
						text = china_tribute_send_eunuch_congenital_tt
						OR = {
							trait = strong
							trait = genius
							trait = quick
							trait = fair
						}
					}
					custom_tooltip = {
						text = china_tribute_send_eunuch_non_inherit_congenital_tt
						OR = {
							trait = robust
							trait = shrewd
						}
					}
					custom_tooltip = {
						text = has_the_right_eunuch_traits_tt
						OR = {
							trait = architect
							trait = administrator
							trait = strategist
							trait = scholar
							trait = faqih						
						}
					}
				}
				NOT = {
					dynasty = ROOT # Don't snip relatives of the EoC off to China!
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			# Regardless of whether the EoC accepts the eunuch in the end, they are snipped
			if = {
				limit = {
					FROMFROM = {
						NOT = {
							trait = eunuch
						}
					}
				}
				hidden_tooltip = {
					FROMFROM = {
						save_event_target_as = eunuch_candidate
					}
				}
				event_target:eunuch_candidate = { # Didn't work well in the FROMFROM scope for some reason...
					add_trait = eunuch
					hidden_tooltip = {
						opinion = {
							who = FROM
							modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
						}
						any_close_relative = {
							#limit = {
							#	NOT = {
							#		any_close_relative = {
							#			character = FROM
							#		}
							#	}
							#}
							opinion = {
								who = FROM
								modifier = opinion_castrated_close_kin
							}
						}
						any_dynasty_member = {
							#limit = {
							#	NOT = {
							#		dynasty = FROM
							#	}
							#}
							opinion = {
								who = FROM
								modifier = opinion_castrated_family
							}
						}
					}
				}
			}
			hidden_tooltip = {
				narrative_event = { id = grace.14 } # Fires an event for the EoC that lets him decide if he want to accept the eunuch or not
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.3 # slow down
			}
			modifier = {
				factor = 0
				china_accepts_eunuch_tribute_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
			modifier = {
				factor = 0
				from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
			}
		}
	}
	
	offer_concubine_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 30
		#show_third_party_potential = yes

		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			NOT = {
				has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_concubine_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_concubine
				}
				AND = {
					OR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_concubine
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_concubine_small
						}
					}
					FROM = {
						ai = yes
					}
				}
			}
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				is_female = yes
				# Has no children, and has never had any children
				NOT = {
					any_child_even_if_dead = {
						always = yes
					}
				}
				OR = {
					# Close relative of yours
					custom_tooltip = {
						text = is_close_relative_or_same_dynasty_tt
						OR = {
							is_close_relative = ROOT_FROM
							dynasty = ROOT_FROM
						}
					}
					# From a high-ranking family
					any_close_relative = {
						OR = {
							real_tier = king
							real_tier = emperor
						}
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT_FROM
					}
				}
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				NOR = {
					trait = pregnant # Known to be pregnant
					any_lover = {
						character = ROOT_FROM
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
		
		effect = {
			# TODO: Make relatives of prisoners upset if you try to send them to China
			hidden_tooltip = {
				narrative_event = { id = grace.18 } # Fires an event for the EoC that lets him decide if he want to accept the concubine or not
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.5 # slow down
			}
			modifier = {
				factor = 0
				china_accepts_concubine_tribute_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
			modifier = {
				factor = 0
				# Religion + government does not allow concubinage
				FROM = {
					NOR = {
						is_tribal = yes
						is_nomadic = yes
					}
					OR = {
						religion_group = christian
						religion_group = muslim
						religion_group = jewish_group
					}
				}
			}
			modifier = {
				factor = 0
				from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
			}
		}
	}
	
	offer_commander_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 54
		#show_third_party_potential = yes

		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_commander_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_commander
				}
				AND = {
					OR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_commander
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_commander_small
						}
					}
					FROM = {
						ai = yes
					}
				}
			}
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no

				is_adult = yes
				martial = 12
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						ROOT = {
							primary_title = {
								has_law = status_of_women_4 # Allows female commmanders
							}
						}
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.23 } # Fires an event for the EoC that lets him decide if he want to accept the commander or not
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.3 # slow down
			}
			modifier = {
				factor = 0
				china_accepts_commander_tribute_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
			modifier = {
				factor = 0
				from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
			}
		}
	}
	
	offer_physician_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = home_court
		ai_third_party_filter = home_court
		third_party = FROM
		ai_check_interval = 54
		#show_third_party_potential = yes

		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			has_dlc = "Reapers"
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_physician_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_physician
				}
				AND = {
					OR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_physician
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_physician_small
						}
					}
					FROM = {
						ai = yes
					}
				}
			}
			FROM = {
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					liege = {
						character = ROOT_FROM
					}
				}
				show_scope_change = no
				NOT = { is_ruler = yes }
				is_adult = yes
				is_heir = no
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				OR = {
					conditional_tooltip = {
						trigger = {
							has_dlc = Reapers
						}
						has_minor_title = title_court_physician 
					}
					trait = physician
					trait = scholar
					trait = mystic
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.27 } # Fires an event for the EoC that lets him decide if he want to accept the physician or not
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.3 # slow down
			}
			modifier = {
				factor = 0
				china_accepts_physician_tribute_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
			modifier = {
				factor = 0
				from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
			}
		}
	}
	
	send_relief_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			has_dlc = "Reapers"
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			realm_size = 100 # If smaller than this, it is unlikely that the relief would be enough to make a difference (and we also want to keep spam down)
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_relief_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_relief
				}
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_sent_relief # Leave without the extra AI check, at least for now
				}
			}
		}
		
		effect = {
			narrative_event = { id = grace.31 } # Fires an event for the EoC that lets him decide if he want to accept the relief or not
		}

		ai_will_do = {
			factor = 0
		}
	}
	
	offer_artifact_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = artifacts
		ai_third_party_filter = artifacts
		third_party = FROM
		ai_check_interval = 90
		show_third_party_potential = yes
	
		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_accepts_artifact_tribute_trigger = yes
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_artifact
				}
				AND = {
					OR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_artifact
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_china_sent_artifact_small
						}
					}
					FROM = {
						ai = yes
					}
				}
			}
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = send_artifact_potential_tt
					#quality > 2
					NOR = {
						has_artifact_flag = flag_considering_donation 
						has_artifact_flag = curse
						has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
						AND = {
							FROM = { NOT = { has_landed_title = e_hre } }
							artifact_type = crown_hre
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_byzantium } }
							artifact_type = crown_byzantine
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_norse_pagan_reformed } }
							artifact_type = crown_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
							artifact_type = crown_tengri_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
							artifact_type = crown_slavic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
							artifact_type = crown_romuva_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
							artifact_type = crown_finnish_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
							artifact_type = crown_west_african_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_zun_pagan_reformed } }
							artifact_type = crown_zun_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = k_hellenic_pagan } }
							artifact_type = scepter_hellenic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_bon_reformed } }
							artifact_type = scepter_bon_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_aztec_reformed } }
							artifact_type = crown_aztec_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_persia } }
							artifact_type = crown_pahlavi
						}
						AND = { # The Imperial Regalia is far too important to send away
							OR = {
								FROM = { NOT = { has_landed_title = k_chrysanthemum_throne } }
								FROM = {
									religion = shinto
									k_chrysanthemum_throne = {
										holder_scope = {
											dynasty = FROM
										}
									}
								}
							}
							has_artifact_flag = imperial_regalia_of_japan
						}
						# TODO: Tianxia pagans
					}
				}
				ROOT = {
					NOT = {
						has_artifact = PREV # Check this!
					}
				}
			}
		}
		
		third_party_allow = {
			# Check this; we might need to script in separate checks for ALL artifacts
			NOT = {
				has_artifact = FROMFROM # If the EoC already has a certain artifact, you cannot give him a duplicate
			}
		}
		
		effect = {
			hidden_tooltip = {
				narrative_event = { id = grace.34 } # Fires an event for the EoC that lets him decide if he want to accept the artifact or not
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0
				FROMFROM = {
					quality > 3
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0
				china_accepts_artifact_tribute_from_trigger = no
			}
			modifier = {
				factor = 0
				from_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
			}
		}
	}
	
	kow_tow_china = {
		only_playable = yes
		#ai_check_interval = 180
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			independent = yes
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				war = no
				NOT = {
					block_general_event_trigger = yes
					custom_tooltip = {
						text = kow_tow_tooltip_already_went
						hidden_tooltip = {
							has_character_flag = went_on_kow_tow_pilgrimage
						}
					}
				}
				custom_tooltip = {
					text = health_travel_condition
					hidden_tooltip = {
						NOR = {
							trait = pregnant
							trait = incapable
							trait = blinded
							trait = has_tuberculosis
							trait = has_typhoid_fever
							trait = has_typhus
							trait = has_bubonic_plague
							trait = has_measles
							trait = has_small_pox
							trait = has_aztec_disease
						}
					}
				}
				higher_real_tier_than = COUNT
				conditional_tooltip = {
					trigger = {
						OR = {
							real_tier = DUKE
							is_nomadic = yes
						}
					}
					prestige = 250
				}
				conditional_tooltip = {
					trigger = {
						real_tier = KING
						NOT = { is_nomadic = yes }
					}
					prestige = 500
				}
				conditional_tooltip = {
					trigger = {
						real_tier = EMPEROR
						NOT = { is_nomadic = yes }
					}
					prestige = 1000
				}
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			NOT = {
				trait = treasure_fleet_preparation
			}
		}
		
		effect = {
			# TODO: Create new kowtow events that involve the EoC and others in China a bit more
			FROM = {
				save_event_target_as = kow_tow_traveler
				set_character_flag = went_on_kow_tow_pilgrimage
				set_character_flag = do_not_disturb
				character_event = {
					id = JD.32000
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	### Boons
	# All Grace is lost upon the request being sent, regardless of whether AI China would accept or refuse the request (the AI will never ask if AI China would refuse)
	# The ONLY circumstance under which Grace is refunded is if the EoC is asked for an Imperial Marriage and he refuses because of being the lover (or currently trying to seduce) of some princess that otherwise would be a valid candidate
	# Aside from the above refusal, the sender's opinion of the EoC is lowered and the EoC loses 500 prestige
	# All princesses sent from China are disinherited
	
	request_peace_deal_china = {
		only_playable = yes
		only_independent = yes
		#ai_check_interval = 18
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			#independent = yes
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_peace_deal_boon_trigger = yes
			NOT = {
				FROM = {
					has_character_modifier = peace_deal_with_china
				}
				has_non_aggression_pact_with = FROM
			}
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				war = no
				in_revolt = no
				independent = yes
				NOT = { pays_tribute_to = ROOT }
				OR = {
					check_variable = {
						which = grace
						value = 400
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 200
						}
					}
				}
				NOT = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_peace_deal
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -200
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -400
					}
				}
			}
			narrative_event = { id = grace.301 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_doctor_china = {
		only_playable = yes
		#ai_check_interval = 18
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI
	
		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			has_dlc = "Reapers"
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_physician_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 400
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 200
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_physician_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -200
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -400
					}
				}
			}
			narrative_event = { id = grace.304 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
			#modifier = {
			#	factor = 0
			#	NOT = {
			#		e_china = {
			#			holder_scope = {
			#				is_within_diplo_range = FROM # If you're far from China, don't bother
			#			}
			#		}
			#	}
			#}
			#factor = 1
			#modifier = {
			#	factor = 0.1 # slow down
			#}
			#modifier = {
			#	FROM = { NOT = { any_courtier = { learning = 15 } } }
			#	factor = 1.5
			#}
			#modifier = {
			#	FROM = {
			#		NOT = { any_courtier = { learning = 15 } }
			#		OR = {
			#			NOT = { health = 3 }
			#			character_disease_trigger = yes
			#			has_symptom_trigger = yes
			#		}
			#	}
			#	factor = 10
			#}
			#modifier = {
			#	FROM = {
			#		NOT = { has_grace_medium_trigger = yes }
			#	}
			#	factor = 0.1
			#}
			#modifier = {
			#	factor = 0
			#	china_grants_physician_boon_from_trigger = no
			#}
		}
	}
	
	request_artifact_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_artifact_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 800
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 400
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_artifact_boon
				}
			}
			custom_tooltip = {
				text = chinese_artifact_has_all_tt
				hidden_tooltip = {
					FROM = {
						NAND = {
							has_artifact = chinese_artwork
							has_artifact = chinese_calligraphy
							has_artifact = chinese_sculpture
							has_artifact = chinese_ceremonial_robes
							#OR = {
							#	has_artifact = chinese_prev_emperor_sculpture
							#	#offmap_china = {
							#	#	offmap_prev_ruler = {
							#	#		always = no
							#	#	}
							#	#}
							#}
							has_artifact = chinese_arm_protector
							has_artifact = chinese_serpent_spear
							has_artifact = chinese_ji
							has_artifact = chinese_crossbow
							has_artifact = chinese_bronze_sculpture
							has_artifact = chinese_painting_of_glitterhoof
							has_artifact = chinese_tapestry
							has_artifact = chinese_tapestry_grand
							has_artifact = water_clock
							has_artifact = jian_sword
							has_artifact = jade_dragon
							# Books
							has_artifact = chinese_book_health
							has_artifact = chinese_book_law
							has_artifact = chinese_book_history
							has_artifact = chinese_book_economy
							has_artifact = art_of_war
							has_artifact = classic_of_poetry
						}
					}
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -400
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -800
					}
				}
			}
			narrative_event = { id = grace.307 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_siege_engineer_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_siege_engineer_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = -500
						}
					}
					check_variable = {
						which = grace
						value = -1000
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_siege_engineer_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1000
					}
				}
			}
			narrative_event = { id = grace.320 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_strategist_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_strategist_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1000
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 500
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_strategist_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1000
					}
				}
			}
			narrative_event = { id = grace.323 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_administrator_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_administrator_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = chinese_administrator_allow_tt
					NOT = { any_courtier = { has_minor_title = title_administrator } }
				}
			}
			NOR = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_administrator_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
			}
			narrative_event = { id = grace.326 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_master_engineer_china = {
		only_playable = yes
		#ai_check_interval = 90
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
	
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_master_engineer_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = chinese_master_engineer_allow_tt
					NOT = { any_courtier = { has_minor_title = title_master_engineer } }
				}
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_master_engineer_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
			}
			narrative_event = { id = grace.329 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_silk_road_favoured_status_china = {
		only_playable = yes
		#ai_check_interval = 54
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_trade_contract_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { has_character_modifier = chinese_imperial_trade_contract }
				#NOT = { has_character_modifier = chinese_favored_in_trade }
				custom_tooltip = {
					text = tooltip_silk_road_required
					hidden_tooltip = {
						any_realm_province = {
							trade_route = silk_road
						}
					}
				}
			}
			NOT = {
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = opinion_china_refused_trade_contract_boon
				}
			}
		}
		
		effect = {
			FROM = {
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
			}
			narrative_event = { id = grace.332 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	request_imperial_marriage_china = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		third_party_filter = realm_including_me
		ai_third_party_filter = court_including_me
		third_party = FROM
		ai_check_interval = 18
		show_third_party_potential = yes
		
		from_potential = {
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
				ai = no
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			can_use_grace_decisions_from_trigger = yes
			china_grants_imperial_marriage_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				conditional_tooltip = {
					trigger = { NOT = { has_character_modifier = peace_deal_with_china } }
					OR = {
						check_variable = {
							which = grace
							value = 1500
						}
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							check_variable = {
								which = grace
								value = 750
							}
						}
					}
				}
				conditional_tooltip = {
					trigger = { has_character_modifier = peace_deal_with_china }
					OR = {
						check_variable = {
							which = grace
							value = 1000
						}
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
					}
				}
				OR = {
					#custom_tooltip = {
						#text = can_marry_chinese_royal_tt
						AND = {
							is_adult = yes
							is_married = no
							is_female = no
						}
					#}
					custom_tooltip = {
						text = has_courtier_eligible_for_marriage_tt
						OR = {
							any_dynasty_member = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								is_female = no
							}
							any_close_relative = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								NOT = { any_spouse = { character = ROOT_FROM } } #turns out without this, it includes your spouse
								is_female = no
							}
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage
					}
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage_good
					}
				}
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				OR = {
					dynasty = ROOT_FROM
					is_close_relative = ROOT_FROM
				}
				OR = {
					character = ROOT_FROM
					AND = {
						liege = { character = ROOT_FROM }
						ai = yes
					}
				}
				NOT = { any_spouse = { character = ROOT_FROM } }
				is_adult = yes
				is_betrothed = no
				is_female = no # Vanilla allows women to get Chinese Imperial Marriages, but it would be VERY problematic to disallow regular marriages for the EoC's male relatives as they are more likely to inherit
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				#custom_tooltip = {
					#text = can_marry_chinese_royal_tt
					can_marry = yes
					is_married = no
				#}
			}
		}

		effect = {
			FROM = {
				show_scope_change = no
				sound_effect = china_grace_spend
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					if = {
						limit = { has_character_modifier = peace_deal_with_china }
						change_variable = {
							which = grace
							value = -500
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -750
						}
						custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
					}	
				}
				else = {
					if = {
						limit = { has_character_modifier = peace_deal_with_china }
						change_variable = {
							which = grace
							value = -1000
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -1500
						}
						custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
					}
				}
							
			}
			narrative_event = { id = grace.335 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = FROM # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0.5
				FROM = {
					NOT = {
						higher_tier_than = DUKE
					}
				}
			}
			modifier = {
				factor = 0.75
				FROM = {
					NOT = {
						independent = yes
					}
				}
			}
			modifier = {
				factor = 0
				china_grants_imperial_marriage_boon_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
			modifier = {
				factor = 0
				reverse_has_opinion_modifier = {
					who = FROM
					modifier = china_peace_deal_breaker # The EoC broke a Peace Deal with us, so we won't agree to another
				}
			}
		}
	}
	
	# Player-only targeted Imperial Marriage requests
	
	request_imperial_marriage_china_targeted = {
		only_playable = yes
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI
		ai = no
		
		third_party_filter = realm_including_me
		ai_third_party_filter = self
		third_party = FROM
		ai_check_interval = 360
		show_third_party_potential = yes
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			# The EoC must be using Grace mechanics
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
					# The target must be a Chinese princess
					ROOT = {
						is_valid_dragon_bride_candidate = yes
					}
				}
			}
		}

		allow = {
			can_use_grace_decisions_from_trigger = yes
			#china_grants_imperial_marriage_boon_trigger = yes
			e_china = {
				holder_scope = {
					NOT = {
						has_character_flag = china_no_imperial_marriage_boons # Player-only opt-out
					}
					NOT = {
						has_character_flag = china_no_peace_deal_boons # Player-only opt-out
					}
				}
			}
			show_only_failed_conditions = yes
			FROM = {
				show_scope_change = no
				conditional_tooltip = {
					trigger = { NOT = { has_character_modifier = peace_deal_with_china } }
					OR = {
						check_variable = {
							which = grace
							value = 1500
						}
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							check_variable = {
								which = grace
								value = 750
							}
						}
					}
				}
				conditional_tooltip = {
					trigger = { has_character_modifier = peace_deal_with_china }
					OR = {
						check_variable = {
							which = grace
							value = 1000
						}
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
					}
				}
				OR = {
					#custom_tooltip = {
						#text = can_marry_chinese_royal_tt
						AND = {
							is_adult = yes
							is_married = no
							is_female = no
						}
					#}
					custom_tooltip = {
						text = has_courtier_eligible_for_marriage_tt
						OR = {
							any_dynasty_member = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								is_female = no
							}
							any_close_relative = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								NOT = { any_spouse = { character = ROOT_FROM } } #turns out without this, it includes your spouse
								is_female = no
							}
						}
					}
				}
				e_china = {
					holder_scope = {
						prisoner = no
						NOT = { trait = incapable }
						is_inaccessible_trigger = no
						NOR = {
							reverse_has_opinion_modifier = {
								who = FROM
								modifier = opinion_china_refused_imperial_marriage
							}
							reverse_has_opinion_modifier = {
								who = FROM
								modifier = opinion_china_refused_imperial_marriage_good
							}
						}
					}
				}
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				OR = {
					dynasty = ROOT_FROM
					is_close_relative = ROOT_FROM
				}
				OR = {
					character = ROOT_FROM
					AND = {
						liege = { character = ROOT_FROM }
						ai = yes
					}
				}
				NOT = { any_spouse = { character = ROOT_FROM } }
				is_adult = yes
				is_betrothed = no
				is_female = no # Vanilla allows women to get Chinese Imperial Marriages, but it would be VERY problematic to disallow regular marriages for the EoC's male relatives as they are more likely to inherit
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				#custom_tooltip = {
					#text = can_marry_chinese_royal_tt
					can_marry = yes
					is_married = no
				#}
			}
		}

		effect = {
			FROM = {
				show_scope_change = no
				sound_effect = china_grace_spend
				if = {
					limit = { has_character_modifier = peace_deal_with_china }
					if = {
						limit = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
						}
						change_variable = {
							which = grace
							value = -500
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -1000
						}
					}
				}
				else = {
					if = {
						limit = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
						}
						change_variable = {
							which = grace
							value = -750
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -1500
						}
					}
					custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
				}
			}
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.339 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
				}
			}
		}

		ai_will_do = {
			factor = 0 # Far, FAR, too computationally expensive!
		}
	}
	
	### Chinese vassal Imperial Marriage requests (doesn't use Grace, but related to the system)
	
	request_imperial_marriage_china_vassal = {
		only_playable = yes
		filter = realm
		ai_target_filter = realm
		
		third_party_filter = realm_including_me
		ai_third_party_filter = court_including_me
		third_party = FROM
		ai_check_interval = 18
		show_third_party_potential = yes
		
		from_potential = {
			has_dlc = "Jade Dragon"
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			mercenary = no
			holy_order = no
			is_landed = yes
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			china_grants_imperial_marriage_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				wealth = 500
				OR = {
					#custom_tooltip = {
						#text = can_marry_chinese_royal_tt
						AND = {
							is_adult = yes
							is_married = no
							is_female = no
						}
					#}
					custom_tooltip = {
						text = has_courtier_eligible_for_marriage_tt
						OR = {
							any_dynasty_member = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								is_female = no
							}
							any_close_relative = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								NOT = { any_spouse = { character = ROOT_FROM } } #turns out without this, it includes your spouse
								is_female = no
							}
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage
					}
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage_good
					}
				}
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				OR = {
					dynasty = ROOT_FROM
					is_close_relative = ROOT_FROM
				}
				OR = {
					character = ROOT_FROM
					AND = {
						liege = { character = ROOT_FROM }
						ai = yes
					}
				}
				NOT = { any_spouse = { character = ROOT_FROM } }
				is_adult = yes
				is_betrothed = no
				is_female = no # Vanilla allows women to get Chinese Imperial Marriages, but it would be VERY problematic to disallow regular marriages for the EoC's male relatives as they are more likely to inherit
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				#custom_tooltip = {
					#text = can_marry_chinese_royal_tt
					can_marry = yes
					is_married = no
				#}
			}
		}

		effect = {
			narrative_event = { id = grace.912 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.05 # slow down
			}
			modifier = {
				factor = 0.5
				FROM = {
					NOT = {
						higher_tier_than = DUKE
					}
				}
			}
			modifier = {
				factor = 0.75
				FROM = {
					NOT = {
						independent = yes
					}
				}
			}
			modifier = {
				factor = 0
				china_grants_imperial_marriage_boon_from_trigger = no
			}
			modifier = {
				factor = 0
				china_hates_fromfrom_trigger = yes
			}
		}
	}
	
	# Targeted version of the above; player only
	request_imperial_marriage_china_vassal_targeted = {
		only_playable = yes
		ai_target_filter = none # Not used by the AI
		
		third_party_filter = realm_including_me
		ai_third_party_filter = none
		third_party = FROM
		ai = no
		show_third_party_potential = yes
		
		from_potential = {
			has_dlc = "Jade Dragon"
			ai = no
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			mercenary = no
			holy_order = no
			is_landed = yes
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			china_grants_imperial_marriage_boon_trigger = yes
			show_only_failed_conditions = yes
			FROM = {
				wealth = 500
				show_scope_change = no
				OR = {
					#custom_tooltip = {
						#text = can_marry_chinese_royal_tt
						AND = {
							is_adult = yes
							is_married = no
							is_female = no
						}
					#}
					custom_tooltip = {
						text = has_courtier_eligible_for_marriage_tt
						OR = {
							any_dynasty_member = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								is_female = no
							}
							any_close_relative = {
								is_adult = yes
								is_married = no
								liege = { character = ROOT_FROM }
								NOT = { any_spouse = { character = ROOT_FROM } } #turns out without this, it includes your spouse
								is_female = no
							}
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage
					}
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_china_refused_imperial_marriage_good
					}
				}
			}
		}

		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				OR = {
					dynasty = ROOT_FROM
					is_close_relative = ROOT_FROM
				}
				OR = {
					character = ROOT_FROM
					AND = {
						liege = { character = ROOT_FROM }
						ai = yes
					}
				}
				NOT = { any_spouse = { character = ROOT_FROM } }
				is_adult = yes
				is_betrothed = no
				is_female = no # Vanilla allows women to get Chinese Imperial Marriages, but it would be VERY problematic to disallow regular marriages for the EoC's male relatives as they are more likely to inherit
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				#custom_tooltip = {
					#text = can_marry_chinese_royal_tt
					can_marry = yes
					is_married = no
				#}
			}
		}

		effect = {
			narrative_event = { id = grace.916 } # Fires an event for the EoC that lets him decide whether to grant the Boon or not
		}

		ai_will_do = {
			factor = 0 # Far, FAR, too computationally expensive!
		}
	}
	
	### Grace checking (for players)
	
	#check_grace = { # Unused
	#	filter = self
	#	ai_target_filter = none
	#
	#	potential = {
	#		ai = no
	#	}
	#	
	#	effect = {
	#		letter_event = { id = grace.997 }
	#	}
	#	
	#	ai_will_do = {
	#		factor = 0
	#	}
	#}
	
	read_grace_dec = { # Multiplayer only Grace checking
		ai = no
		filter = all_including_me
		from_potential = {
			multiplayer = yes #This system should only be used in multiplayer
		}
		potential = {
			NOT = { is_variable_equal = { which = grace value = 0 } }
			OR = {
				FROM = {
					OR = {
						has_landed_title = e_china
						
						character = ROOT
						
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						
						is_ancestor_of = ROOT
						
						is_child_of = ROOT
						
						any_sibling = {
							character = ROOT
						}
						
						any_realm_character = {
							character = ROOT
						}
					}
				}
				
				#Now the tricky tributary conditions
				e_china = {
					holder_scope = {
						OR = {
							AND = { #Tier 1 can see Tier 1
								FROM = {
									is_tributary = {
										type = chinese_peripheral_tributary #Tier 1
										suzerain = PREV
									}
								}
								ROOT = {
									is_tributary = {
										type = chinese_peripheral_tributary #Tier 1
										suzerain = PREV
									}
								}
							}
							AND = { #Tier 1 can see 1 and 2
								FROM = {
									is_tributary = {
										type = chinese_imperial_tributary #Tier 2
										suzerain = PREV
									}
								}
								ROOT = {
									OR = {
										is_tributary = {
											type = chinese_peripheral_tributary #Tier 1
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_imperial_tributary #Tier 2
											suzerain = PREV
										}
									}
								}
							}
							AND = { #Tier 3 can see 1, 2 and 3
								FROM = {
									is_tributary = {
										type = chinese_protectorate #Tier 3
										suzerain = PREV
									}
								}
								ROOT = {
									OR = {
										is_tributary = {
											type = chinese_peripheral_tributary #Tier 1
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_imperial_tributary #Tier 2
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_protectorate #Tier 3
											suzerain = PREV
										}
									}
								}
							}
							AND = { #Tier 4 or vassal can see 1, 2, 3 and 4
								FROM = {
									OR = {
										is_tributary = {
											type = chinese_client_state #Tier 4
											suzerain = PREV
										}
										vassal_of = PREV
									}
								}
								ROOT = {
									OR = {
										is_tributary = {
											type = chinese_peripheral_tributary #Tier 1
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_imperial_tributary #Tier 2
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_protectorate #Tier 3
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_client_state #Tier 4
											suzerain = PREV
										}
									}
								}
							}
							AND = { #Non-Grace tributary can see Tier 1
								FROM = {
									is_tributary = {
										suzerain = PREV
									}
									NOR = {
										is_tributary = {
											type = chinese_peripheral_tributary #Tier 1
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_imperial_tributary #Tier 2
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_protectorate #Tier 3
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_client_state #Tier 4
											suzerain = PREV
										}
									}
								}
								ROOT = {
									is_tributary = {
										type = chinese_peripheral_tributary #Tier 1
										suzerain = PREV
									}
								}
							}
							AND = { #Any tributary/vassal can see non-Grace tributary
								FROM = {
									OR = {
										is_tributary = {
											suzerain = PREV
										}
										vassal_of = PREV
									}
								}
								ROOT = {
									is_tributary = {
										suzerain = PREV
									}
									NOR = {
										is_tributary = {
											type = chinese_peripheral_tributary #Tier 1
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_imperial_tributary #Tier 2
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_protectorate #Tier 3
											suzerain = PREV
										}
										is_tributary = {
											type = chinese_client_state #Tier 4
											suzerain = PREV
										}
									}
								}
							}
						}
					}
				}
			}
		}
		allow = {
			always = yes
		}
		effect = {
			custom_tooltip = {
				text = this_is_your_grace
			}
		}
		ai_will_do = {
			factor = 0
		}
		ai_acceptance = {
			factor = 0
		}
	}
	
	### Check if China hates you
	
	check_eoc_opinion = {
		filter = self
		ai = no
	
		potential = {
			ai = no
		}
		
		effect = {
			letter_event = { id = grace.980 }
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	### Peace Deal revokation
	
	revoke_peace_deal = {
		only_playable = yes
		filter = independent_rulers
		ai = no
		
		from_potential = {
			has_dlc = "Jade Dragon"
			ai = no
			OR = {
				is_chinese_emperor_trigger = yes
				has_character_modifier = peace_deal_with_china
			}
		}
		
		potential = {
			OR = {
				is_chinese_emperor_trigger = yes
				AND = {
					FROM = {
						is_chinese_emperor_trigger = yes
					}
					has_character_modifier = peace_deal_with_china
				}
			}
		}
		
		allow = {
			prisoner = no
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
		
		effect = {
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				letter_event = { id = grace.993 }
				break = yes
			}
			letter_event = { id = grace.991 }
		}
		
		ai_will_do = {
			factor = 0 # TODO? Normal NAPs aren't broken by the AI...
		}
	}
	
	### Tribute blocking/unblocking
	
	enable_disable_tribute = {
		filter = self
		ai = no
					
		potential = {
			ai = no
			is_chinese_emperor_trigger = yes
		}
		
		effect = {
			letter_event = { id = grace.601 }
		}
		
		ai_will_do = {
			factor = 0 # Not worth it
		}
	}
	
	### Boon blocking/unblocking
	
	enable_disable_boon = {
		filter = self
		ai = no
					
		potential = {
			ai = no
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			always = yes
		}
		
		effect = {
			letter_event = { id = grace.603 }
		}
		
		ai_will_do = {
			factor = 0 # Not worth it
		}
	}
	
	### Tiered tributary stuff
	
	ask_to_increase_tributary_tier = {
		only_independent = yes
		#ai_check_interval = 180
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			FROM = {
				suzerain = {
					character = ROOT
				}
			}
			can_use_grace_decisions_from_trigger = yes
			china_accepts_tributaries_trigger = yes
			NOR = {
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_recently_became_higher_tier_tributary
				}
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_recently_became_lower_tier_tributary
				}
			}
			FROM = {
				war = no # Is at peace
				# Only non-emperors and nomads can become a higher tier tributary
				OR = {
					NOT = {
						real_tier = emperor
					}
					is_nomadic = yes
				}
			}
			FROM = {
				OR = {
					AND = {
						is_tributary = {
							type = chinese_client_state
						}
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						# China isn't interested in integrating tribal or nomadic land
						NOR = {
							is_tribal = yes
							is_nomadic = yes
						}
						controls_religion = no # Rel heads don't want to be closely tied to a heathen
					}
					AND = {
						is_tributary = {
							type = chinese_protectorate
						}
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						# China isn't really interested in nomads, and only cares about tribals in China/its de jure
						NOR = {
							AND = {
								is_tribal = yes
								NOT = {
									any_realm_province = {
										OR = {
											region = world_china
											county = {
												de_jure_liege_or_above = e_china
											}
										}
									}
								}
							}
							is_nomadic = yes
						}
						controls_religion = no # Rel heads don't want to be closely tied to a heathen
					}
					AND = {
						is_tributary = {
							type = chinese_imperial_tributary
						}
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
													}
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						# China doesn't want to get dragged into messy wars in the steppes
						is_nomadic = no
					}
					AND = {
						NOR = {
							is_tributary = {
								type = chinese_client_state
							}
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_imperial_tributary
							}
						}
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
												AND = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														is_tributary = {
															type = chinese_imperial_tributary
														}
													}
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														is_tributary = {
															type = chinese_imperial_tributary
														}
													}
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
															AND = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
																AND = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		
		effect = {
			narrative_event = { id = grace.38 }
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	ask_to_decrease_tributary_tier = {
		only_independent = yes
		#ai_check_interval = 180
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
			NOR = {
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_recently_became_higher_tier_tributary
				}
				has_opinion_modifier = {
					who = FROM
					modifier = opinion_recently_became_lower_tier_tributary
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_from_trigger = yes
			FROM = {
				war = no # Is at peace
				suzerain = {
					character = ROOT
				}
			}
			FROM = {
				OR = {
					AND = {
						is_tributary = {
							type = chinese_client_state
						}
						OR = {
							AND = {
								NOT = { # If a Client State is too distant, China will be more willing to let them go
									any_realm_province = {
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
														NOR = {
															character = FROM
															top_liege = {
																character = FROM
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														OR = {
															AND = {
																has_owner = yes
																owner = {
																	OR = {
																		character = ROOT
																		top_liege = {
																			character = ROOT
																		}
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		top_liege = {
																			OR = {
																				is_tributary = {
																					type = chinese_client_state
																				}
																				is_tributary = {
																					type = chinese_protectorate
																				}
																			}
																		}
																	}
																	NOR = {
																		character = FROM
																		top_liege = {
																			character = FROM
																		}
																	}
																}
															}
															AND = {
																is_land = no
																any_neighbor_province = {
																	has_owner = yes
																	owner = {
																		OR = {
																			character = ROOT
																			top_liege = {
																				character = ROOT
																			}
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																			top_liege = {
																				OR = {
																					is_tributary = {
																						type = chinese_client_state
																					}
																					is_tributary = {
																						type = chinese_protectorate
																					}
																				}
																			}
																		}
																		NOR = {
																			character = FROM
																			top_liege = {
																				character = FROM
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
								check_variable = {
									which = grace
									value = 2000
								}
							}
							check_variable = {
								which = grace
								value = 1000
							}
						}
					}
					AND = {
						is_tributary = {
							type = chinese_protectorate
						}
						OR = {
							AND = {
								NOT = { # If a Protectorate is too distant, China will be more willing to let them go
									any_realm_province = {
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														OR = {
															AND = {
																has_owner = yes
																owner = {
																	OR = {
																		character = ROOT
																		top_liege = {
																			character = ROOT
																		}
																	}
																}
															}
															AND = {
																is_land = no
																any_neighbor_province = {
																	has_owner = yes
																	owner = {
																		OR = {
																			character = ROOT
																			top_liege = {
																				character = ROOT
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
								check_variable = {
									which = grace
									value = 1000
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
					}
					AND = {
						is_tributary = {
							type = chinese_imperial_tributary
						}
						check_variable = {
							which = grace
							value = 500
						}
					}
					AND = {
						NOR = {
							is_tributary = {
								type = chinese_client_state
							}
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_imperial_tributary
							}
						}
						check_variable = {
							which = grace
							value = 250
						}
					}
				}
			}
		}
		
		effect = {
			narrative_event = { id = grace.343 }
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	china_ask_to_increase_tributary_tier = {
		only_independent = yes
		ai_check_interval = 90
		filter = independent_rulers
		ai_target_filter = independent_rulers
		
		from_potential = {
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = yes
			is_within_diplo_range = ROOT
		}
		
		potential = {
			suzerain = {
				character = FROM
			}
			OR = {
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = FROM
											top_liege = {
												character = FROM
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = FROM
														top_liege = {
															character = FROM
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = FROM
															top_liege = {
																character = FROM
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China isn't interested in integrating tribal or nomadic land
					NOR = {
						is_tribal = yes
						is_nomadic = yes
					}
					controls_religion = no # Rel heads don't want to be closely tied to a heathen
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = FROM
											top_liege = {
												character = FROM
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = FROM
														top_liege = {
															character = FROM
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = FROM
															top_liege = {
																character = FROM
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China isn't really interested in nomads, and only cares about tribals in China/its de jure
					NOR = {
						AND = {
							is_tribal = yes
							NOT = {
								any_realm_province = {
									OR = {
										region = world_china
										county = {
											de_jure_liege_or_above = e_china
										}
									}
								}
							}
						}
						is_nomadic = yes
					}
					controls_religion = no # Rel heads don't want to be closely tied to a heathen
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = FROM
											top_liege = {
												character = FROM
											}
											is_tributary = {
												type = chinese_client_state
											}
											is_tributary = {
												type = chinese_protectorate
											}
											top_liege = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
												}
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = FROM
														top_liege = {
															character = FROM
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = FROM
															top_liege = {
																character = FROM
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China doesn't want to get dragged into messy wars in the steppes
					NOT = {
						is_nomadic = yes
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = FROM
											top_liege = {
												character = FROM
											}
											AND = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											top_liege = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = FROM
														top_liege = {
															character = FROM
														}
														AND = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = FROM
															top_liege = {
																character = FROM
															}
															AND = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				war = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_actual_regency_trigger = no
			}
			NOR = {
				has_character_modifier = peace_deal_with_china
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_tributary_refused_increase_tributary_tier
					}
				}
				FROM = {
					has_non_aggression_pact_with = ROOT
				}
			}
			FROM = {
				NOR = {
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_recently_became_higher_tier_tributary
					}
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_recently_became_lower_tier_tributary
					}
				}
			}
			war = no
			prisoner = no
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
			has_actual_regency_trigger = no
			# Tiered prestige and gold cost
			OR = {
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					OR = {
						AND = {
							real_tier = emperor
							is_nomadic = no
							FROM = {
								prestige = 5000
								wealth = 10000
							}
						}
						AND = {
							OR = {
								real_tier = king
								AND = {
									real_tier = emperor
									is_nomadic = yes
								}
							}
							FROM = {
								prestige = 2500
								wealth = 5000
							}
						}
						AND = {
							OR = {
								real_tier = duke
								real_tier = count
							}
							FROM = {
								prestige = 1000
								wealth = 1000
							}
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					OR = {
						AND = {
							real_tier = emperor
							is_nomadic = no
							FROM = {
								prestige = 2500
								wealth = 5000
							}
						}
						AND = {
							OR = {
								real_tier = king
								AND = {
									real_tier = emperor
									is_nomadic = yes
								}
							}
							FROM = {
								prestige = 1000
								wealth = 1000
							}
						}
						AND = {
							OR = {
								real_tier = duke
								real_tier = count
							}
							FROM = {
								prestige = 500
								wealth = 500
							}
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					OR = {
						AND = {
							real_tier = emperor
							is_nomadic = no
							FROM = {
								prestige = 1000
								wealth = 1000
							}
						}
						AND = {
							OR = {
								real_tier = king
								AND = {
									real_tier = emperor
									is_nomadic = yes
								}
							}
							FROM = {
								prestige = 500
								wealth = 500
							}
						}
						AND = {
							OR = {
								real_tier = duke
								real_tier = count
							}
							FROM = {
								prestige = 250
								wealth = 100
							}
						}
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					OR = {
						AND = {
							real_tier = emperor
							is_nomadic = no
							FROM = {
								prestige = 500
								wealth = 500
							}
						}
						AND = {
							OR = {
								real_tier = king
								AND = {
									real_tier = emperor
									is_nomadic = yes
								}
							}
							FROM = {
								prestige = 250
								wealth = 100
							}
						}
						AND = {
							OR = {
								real_tier = duke
								real_tier = count
							}
							FROM = {
								prestige = 100
								wealth = 50
							}
						}
					}
				}
			}
		}
		
		effect = {
			if = {
				limit = {
					is_tributary = {
						type = chinese_client_state
					}
				}
				if = {
					limit = {
						real_tier = emperor
						is_nomadic = no
					}
					FROM = {
						prestige = -5000
						wealth = -10000
					}
				}
				else_if = {
					limit = {
						OR = {
							real_tier = king
							AND = {
								real_tier = emperor
								is_nomadic = yes
							}
						}
					}
					FROM = {
						prestige = -2500
						wealth = -5000
					}
				}
				else = {
					FROM = {
						prestige = -1000
						wealth = -1000
					}
				}
			}
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_protectorate
					}
				}
				if = {
					limit = {
						real_tier = emperor
						is_nomadic = no
					}
					FROM = {
						prestige = -2500
						wealth = -5000
					}
				}
				else_if = {
					limit = {
						OR = {
							real_tier = king
							AND = {
								real_tier = emperor
								is_nomadic = yes
							}
						}
					}
					FROM = {
						prestige = -1000
						wealth = -1000
					}
				}
				else = {
					FROM = {
						prestige = 500
						wealth = 500
					}
				}
			}
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				if = {
					limit = {
						real_tier = emperor
						is_nomadic = no
					}
					FROM = {
						prestige = -1000
						wealth = -1000
					}
				}
				else_if = {
					limit = {
						OR = {
							real_tier = king
							AND = {
								real_tier = emperor
								is_nomadic = yes
							}
						}
					}
					FROM = {
						prestige = -500
						wealth = -500
					}
				}
				else = {
					FROM = {
						prestige = -250
						wealth = -100
					}
				}
			}
			else = {
				if = {
					limit = {
						real_tier = emperor
						is_nomadic = no
					}
					FROM = {
						prestige = -500
						wealth = -500
					}
				}
				else_if = {
					limit = {
						OR = {
							real_tier = king
							AND = {
								real_tier = emperor
								is_nomadic = yes
							}
						}
					}
					FROM = {
						prestige = -250
						wealth = -100
					}
				}
				else = {
					FROM = {
						prestige = -100
						wealth = -50
					}
				}
			}
			narrative_event = { id = grace.605 } # The tributary gets the request
		}
		
		ai_will_do = {
			factor = 1
			# Isn't really interested in more land
			modifier = {
				factor = 0.01
				NOR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Not too interested in more land
			modifier = {
				factor = 0.1
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Really doesn't want more land
			modifier = {
				factor = 0
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 0
				relative_power = {
					who = FROM
					power = 0.5
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 0.1
				relative_power = {
					who = FROM
					power = 0.25
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 5
				NOT = {
					relative_power = {
						who = FROM
						power = 0.1
					}
				}
			}
			# Same culture
			modifier = {
				factor = 5
				FROM = {
					culture = ROOT
				}
			}
			# Same culture group, or Chinese
			modifier = {
				factor = 2
				OR = {
					FROM = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
					culture_group = chinese_group
				}
			}
			# Civilized
			modifier = {
				factor = 2
				has_acceptable_chinese_religion_trigger = yes
			}
			# Civilized
			modifier = {
				factor = 2
				has_acceptable_chinese_culture_no_gamerule_trigger = yes
			}
			modifier = {
				factor = 0.5
				root_hates_china_trigger = yes # Would be refused, but we can always go to war with them...
			}
			# If they're a barbarian, we don't really want them
			modifier = {
				factor = 0.1
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# If they're a barbarian, we don't really want them
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_client_state
				}
				has_acceptable_chinese_religion_trigger = no
			}
			# If they're a barbarian, we don't really want them
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_client_state
				}
				NOR = {
					culture_group = FROM
					culture_group = chinese_group
				}
			}
			# If they hold Chinese land, we want to integrate them
			modifier = {
				factor = 10
				any_realm_province = {
					OR = {
						region = world_china
						county = {
							de_jure_liege_or_above = e_china
						}
					}
				}
			}
			# Would break free on succession, so try to prevent that
			modifier = {
				factor = 5
				is_tributary = {
					type = chinese_peripheral_tributary
				}
			}
		}
	}
	
	make_princess_available_for_regular_marriage = {
		ai = no
		filter = independent_rulers
		ai_target_filter = self
		potential = {
			has_dlc = "Jade Dragon"
			trait = dragon_bride_unmarried
			OR = {
				AND = {
					is_descendant_of = FROM
					dynasty = FROM
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		from_potential = {
			ai = no
			is_playable = yes
		}
		
		allow = {
			FROM = {
				is_inaccessible_or_incapable_trigger = no
				is_adult = yes
				has_actual_regency_trigger = no
				prisoner = no
			}
			is_inaccessible_or_incapable_trigger = no
			employer = {
				character = FROM
			}
		}
		
		effect = {
			remove_trait = dragon_bride_unmarried
			prestige = -500
			FROM = {
				prestige = -500
			}
			hidden_tooltip = {
				e_china = {
					holder_scope = {
						change_variable = {
							which = stored_mandate_change
							value = -500
						}
					}
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
}

# AI only; should hopefully result in better performance
decisions = {
	### Tributes
	# Grace is gained only if the Tribute is accepted
	# Aside from the snipping of eunuchs, all effects take place if the tribute is accepted
	# The sender's opinion of the EoC is lowered if a Tribute is deemed unsuitable for the imperial court
	# The sender's opinion of the EoC is lowered even further
	# Any courtier sent to China gets disinherited
	
	ai_send_gift_china = {
		only_playable = yes
		ai_check_interval = 180
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_accepts_gold_tribute_root_trigger = yes # China must be accepting
			wealth = 500
			e_china = {
				holder_scope = {
					NOR = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_sent_gift
						}
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_gift
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_send_gift_china
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.66 # slow down
			}
			modifier = {
				factor = 0.1
				ROOT = { NOT = { monthly_income = 11 } } #I.e. it would take more than 4 years to collect the 500 gold
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
		}
	}
	
	ai_become_tributary_china = {
		only_independent = yes
		only_playable = yes
		ai_check_interval = 54
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			e_china = {
				holder_scope = {
					is_within_diplo_range = PREVPREV
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			controls_religion = no
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_accepts_tributary_root_trigger = yes
			ROOT = {
				war = no # Is at peace
				is_tributary = no # Cannot break existing tributary relationship
				# Only non-emperors and nomads can become tributaries
				OR = {
					NOT = {
						real_tier = emperor
					}
					is_nomadic = yes
				}
#				# Borders China/a Chinese tributary or is within two sea zones of China/a Chinese tributary
#				any_realm_province = {
#					any_neighbor_province = {
#						OR = {
#							AND = {
#								has_owner = yes
#								owner = {
#									OR = {
#										is_chinese_emperor_trigger = yes
#										top_liege = {
#											is_chinese_emperor_trigger = yes
#										}
#										suzerain = {
#											is_chinese_emperor_trigger = yes
#										}
#										top_liege = {
#											suzerain = {
#												is_chinese_emperor_trigger = yes
#											}
#										}
#									}
#								}
#							}
#							AND = {
#								is_land = no
#								any_neighbor_province = {
#									OR = {
#										AND = {
#											has_owner = yes
#											owner = {
#												OR = {
#													is_chinese_emperor_trigger = yes
#													top_liege = {
#														is_chinese_emperor_trigger = yes
#													}
#													suzerain = {
#														is_chinese_emperor_trigger = yes
#													}
#													top_liege = {
#														suzerain = {
#															is_chinese_emperor_trigger = yes
#														}
#													}
#												}
#											}
#										}
#										AND = {
#											is_land = no
#											any_neighbor_province = {
#												owner = {
#													OR = {
#														is_chinese_emperor_trigger = yes
#														top_liege = {
#															is_chinese_emperor_trigger = yes
#														}
#														suzerain = {
#															is_chinese_emperor_trigger = yes
#														}
#														top_liege = {
#															suzerain = {
#																is_chinese_emperor_trigger = yes
#															}
#														}
#													}
#												}
#											}
#										}
#									}
#								}
#							}
#						}
#					}
#				}
			}
			e_china = {
				holder_scope = {
					NOR = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_tributary
						}
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_breakaway_tributary # Can't trust them!
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_become_tributary_china
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.01 # Make random distant realms unlikely to become tributaries
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are less willing to become tributaries
			modifier = {
				factor = 0.1
				OR = {
					real_tier = king
					real_tier = emperor # Nomads
				}
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 5
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 0.1
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 0
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.1
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 10
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 5
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			# Civilized
			modifier = {
				factor = 2
				has_acceptable_chinese_religion_trigger = yes
			}
			# Civilized
			modifier = {
				factor = 2
				has_acceptable_chinese_culture_no_gamerule_trigger = yes
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# We are uncivilized
			modifier = {
				factor = 0.5
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We are uncivilized and distant
			modifier = {
				factor = 0.2
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							has_owner = yes
							owner = {
								OR = {
									is_chinese_emperor_trigger = yes
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
							}
						}
					}
				}			
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 0.1
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				NOR = {
					e_china = {
						holder_scope = {
							culture_group = ROOT
						}
					}
					culture_group = chinese_group
				}
				has_acceptable_chinese_religion_trigger = no
			}
			# Barbarians
			modifier = {
				factor = 0.1
				has_acceptable_chinese_religion_trigger = no
			}
			# Pagans should be more unlikely to become tributaries
			modifier = {
				factor = 0.5
				religion_group = pagan_group
				has_acceptable_chinese_religion_trigger = no
				is_reformed_religion = no
				NOT = {
					religion = ryukyuan_pagan
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
			}
		}
	}
	
	ai_supply_horses_china = {
		only_playable = yes
		only_independent = yes
		ai_check_interval = 54
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_nomadic = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			#OR = {
			#	NOT = {
			#		has_character_modifier = china_supply_horses
			#	}
			#	ai = no
			#}
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
			unused_manpower = 300
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_accepts_horses_tribute_root_trigger = yes
			e_china = {
				holder_scope = {
					NOR = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_horses
						}
						AND = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_china_supplying_horses
							}
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_supply_horses_china
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOR = {
					trait = humble
					trait = shy
					trait = craven
				}
			}
			modifier = {
				factor = 0
				OR = {
					trait = ambitious
					trait = proud
				}
			}
			modifier = {
				factor = 0
				primary_title = {
					title = e_mongol_empire
				}
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
		}
	}
	
	ai_send_relief_china = {
		only_playable = yes
		ai_check_interval = 90
		only_independent = yes
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			has_dlc = "Reapers"
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			realm_size = 100 # If smaller than this, it is unlikely that the relief would be enough to make a difference (and we also want to keep spam down)
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_accepts_relief_tribute_root_trigger = yes
			e_china = {
				holder_scope = {
					NOR = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_relief
						}
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_sent_relief # Leave without the extra AI check, at least for now
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_send_relief_china
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0
				war = yes
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
		}
	}
	
	ai_kow_tow_china = {
		only_playable = yes
		ai_check_interval = 180
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			ROOT = {
				show_only_failed_conditions = yes
				show_scope_change = no
				war = no
				NOT = {
					block_general_event_trigger = yes
					custom_tooltip = {
						text = kow_tow_tooltip_already_went
						hidden_tooltip = {
							has_character_flag = went_on_kow_tow_pilgrimage
						}
					}
				}
			}
			custom_tooltip = {
				text = health_travel_condition
				hidden_tooltip = {
					NOR = {
						trait = pregnant
						trait = incapable
						trait = blinded
						trait = has_tuberculosis
						trait = has_typhoid_fever
						trait = has_typhus
						trait = has_bubonic_plague
						trait = has_measles
						trait = has_small_pox
						trait = has_aztec_disease
					}
				}
			}
			higher_real_tier_than = COUNT
			conditional_tooltip = {
				trigger = {
					OR = {
						real_tier = DUKE
						is_nomadic = yes
					}
				}
				prestige = 250
			}
			conditional_tooltip = {
				trigger = {
					real_tier = KING
					NOT = { is_nomadic = yes }
				}
				prestige = 500
			}
			conditional_tooltip = {
				trigger = {
					real_tier = EMPEROR
					NOT = { is_nomadic = yes }
				}
				prestige = 1000
			}
			custom_tooltip = {
				text = is_not_busy_trigger_tooltip
				hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
			}
			NOT = {
				trait = treasure_fleet_preparation
			}
		}
		
		effect = {
			save_event_target_as = kow_tow_traveler
			set_character_flag = went_on_kow_tow_pilgrimage
			set_character_flag = do_not_disturb
			character_event = {
				id = JD.32000
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.1 #slow down
			}
			modifier = {
				factor = 0
				china_hates_root_trigger = yes # If the EoC has reason to dislike ROOT, it could be dangerous to go to the EoC's court as he might use that opportunity to act against you...
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to appear subservient
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
	
	### Boons
	# All Grace is lost upon the request being sent, regardless of whether AI China would accept or refuse the request (the AI will never ask if AI China would refuse)
	# The ONLY circumstance under which Grace is refunded is if the EoC is asked for an Imperial Marriage and he refuses because of being the lover (or currently trying to seduce) of some princess that otherwise would be a valid candidate
	# Aside from the above refusal, the sender's opinion of the EoC is lowered and the EoC loses 500 prestige
	# All princesses sent from China are disinherited
	
	ai_request_peace_deal_china = {
		only_playable = yes
		ai_check_interval = 18
		only_independent = yes
	
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			independent = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_peace_deal_boon_root_trigger = yes
			NOT = {
				has_character_modifier = peace_deal_with_china
				e_china = {
					holder_scope = {
						has_non_aggression_pact_with = ROOT
					}
				}
			}
			NOT = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
			}
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				war = no
				in_revolt = no
				independent = yes
				NOT = { pays_tribute_to = ROOT }
				OR = {
					check_variable = {
						which = grace
						value = 400
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 200
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			e_china = {
				holder_scope = {
					NOT = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_peace_deal
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_request_peace_deal_china
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -200
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -400
				}
			}
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 1.5
				e_china = {
					holder_scope = {
						realm_levy_diff = {
							who = ROOT
							value = 2000
						}
					}
				}
			}
			modifier = {
				factor = 3
				e_china = {
					holder_scope = {
						realm_levy_diff = {
							who = ROOT
							value = 5000
						}
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						realm_levy_diff = {
							who = ROOT
							value = 10000
						}
					}
				}
			}
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						realm_levy_diff = {
							who = ROOT
							value = 20000
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = { has_grace_major_trigger = yes }
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Might want to attack the EoC
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = china_peace_deal_breaker # The EoC broke a Peace Deal with us, so we won't agree to another
						}
					}
				}
			}
		}
	}
	
	ai_request_artifact_china = {
		only_playable = yes
		ai_check_interval = 90
	
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_artifact_boon_root_trigger = yes
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 800
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 400
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			e_china = {
				holder_scope = {
					NOT = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_artifact_boon
						}
					}
				}
			}
			custom_tooltip = {
				text = chinese_artifact_has_all_tt
				hidden_tooltip = {
					ROOT = {
						NAND = {
							has_artifact = chinese_artwork
							has_artifact = chinese_calligraphy
							has_artifact = chinese_sculpture
							has_artifact = chinese_ceremonial_robes
							#OR = {
							#	has_artifact = chinese_prev_emperor_sculpture
							#	#offmap_china = {
							#	#	offmap_prev_ruler = {
							#	#		always = no
							#	#	}
							#	#}
							#}
							has_artifact = chinese_arm_protector
							has_artifact = chinese_serpent_spear
							has_artifact = chinese_ji
							has_artifact = chinese_crossbow
							has_artifact = chinese_bronze_sculpture
							has_artifact = chinese_painting_of_glitterhoof
							has_artifact = chinese_tapestry
							has_artifact = chinese_tapestry_grand
							has_artifact = water_clock
							has_artifact = jian_sword
							has_artifact = jade_dragon
							# Books
							has_artifact = chinese_book_health
							has_artifact = chinese_book_law
							has_artifact = chinese_book_history
							has_artifact = chinese_book_economy
							has_artifact = art_of_war
							has_artifact = classic_of_poetry
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_request_artifact_china
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -400
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -800
				}
			}
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}			
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = greedy
				}
			}
		}
	}
	
	ai_request_strategist_china = {
		only_playable = yes
		ai_check_interval = 90
	
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_strategist_boon_root_trigger = yes
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1000
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 500
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			NOT = {
				e_china = {
					holder_scope = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_strategist_boon
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_request_strategist_china
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -500
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -1000
				}
			}
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0.1
				NOT = { has_grace_major_trigger = yes }
			}
			modifier = {	
				factor = 0
				is_nomadic = yes
			}
		}
	}
	
	ai_request_administrator_china = {
		only_playable = yes
		ai_check_interval = 90
	
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_administrator_boon_root_trigger = yes
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = chinese_administrator_allow_tt
					NOT = { any_courtier = { has_minor_title = title_administrator } }
				}
			}
			NOT = {
				e_china = {
					holder_scope = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_administrator_boon
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_request_administrator_china
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -750
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -1500
				}
			}
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.5 # slow down
			}
			modifier = {
				factor = 0.1
				NOT = { has_grace_major_trigger = yes }
			}
			modifier = {
				factor = 0
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
		}
	}
	
	ai_request_master_engineer_china = {
		only_playable = yes
		ai_check_interval = 90
	
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or a human player
			OR = {
				independent = yes
				real_tier = king
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_master_engineer_boon_root_trigger = yes
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				custom_tooltip = {
					text = chinese_master_engineer_allow_tt
					NOT = { any_courtier = { has_minor_title = title_master_engineer } }
				}
			}
			NOT = {
				e_china = {
					holder_scope = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_master_engineer_boon
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_request_master_engineer_china
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -750
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -1500
				}
			}
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0.1
				NOT = { has_grace_major_trigger = yes }
			}
			modifier = {
				factor = 0
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
			}
		}
	}
	
	ai_request_silk_road_favoured_status_china = {
		only_playable = yes
		ai_check_interval = 54
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			# Is independent, king-tier, or an MR
			OR = {
				independent = yes
				real_tier = king
				is_merchant_republic = yes
			}
			OR = {
				e_china = {
					holder_scope = {
						is_within_diplo_range = PREVPREV
					}
				}
				any_realm_province = {
					trade_route = silk_road
				}
			}
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
			e_china = {
				holder_scope = {
					is_chinese_emperor_trigger = yes
				}
			}
		}

		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_grants_trade_contract_boon_root_trigger = yes
			show_only_failed_conditions = yes
			ROOT = {
				show_scope_change = no
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 750
						}
					}
				}
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { has_character_modifier = chinese_imperial_trade_contract }
				#NOT = { has_character_modifier = chinese_favored_in_trade }
				custom_tooltip = {
					text = tooltip_silk_road_required
					hidden_tooltip = {
						any_realm_province = {
							trade_route = silk_road
						}
					}
				}
			}
			NOT = {
				e_china = {
					holder_scope = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_china_refused_trade_contract_boon
						}
					}
				}
			}
		}
		
		effect = {
			if = {
				limit = {
					suzerain = {
						is_chinese_emperor_trigger = yes
					}
					OR = {
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				change_variable = {
					which = grace
					value = -750
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -1500
				}
			}
			set_character_flag = ai_request_silk_road_favoured_status_china
			character_event = { id = grace.975 } # Sets up proper scopes and fires the correct follow-up event
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
				ROOT = {
					is_merchant_republic = no # MRs are always interested
				}
			}
			modifier = {
				factor = 10
				is_merchant_republic = yes # MRs are always interested
			}
			modifier = {
				factor = 0.1 # slow down
			}
			modifier = {
				factor = 0
				ROOT = {
					NOT = {
						any_demesne_province = {
							has_trade_post = yes
							trade_route = silk_road
						}
					}
				}
			}
		}
	}
	
	### Tiered tributary stuff
	
	ai_ask_to_increase_tributary_tier = {
		only_independent = yes
		ai_check_interval = 90
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			mercenary = no
			holy_order = no
			is_landed = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			e_china = {
				holder_scope = {
					NOR = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_recently_became_higher_tier_tributary
						}
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_recently_became_lower_tier_tributary
						}
					}
				}
			}
		}
		
		allow = {
			can_use_grace_decisions_root_trigger = yes
			china_accepts_tributary_root_trigger = yes
			war = no # Is at peace
			# Only non-emperors and nomads can become a higher tier tributary
			OR = {
				NOT = {
					real_tier = emperor
				}
				is_nomadic = yes
			}
			suzerain = {
				is_chinese_emperor_trigger = yes
			}
			OR = {
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China isn't interested in integrating tribal or nomadic land
					NOR = {
						is_tribal = yes
						is_nomadic = yes
					}
					controls_religion = no # Rel heads don't want to be closely tied to a heathen
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China isn't really interested in nomads, and only cares about tribals in China/its de jure
					NOR = {
						AND = {
							is_tribal = yes
							NOT = {
								any_realm_province = {
									OR = {
										region = world_china
										county = {
											de_jure_liege_or_above = e_china
										}
									}
								}
							}
						}
						is_nomadic = yes
					}
					controls_religion = no # Rel heads don't want to be closely tied to a heathen
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
											AND = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											top_liege = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														AND = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															AND = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					# China doesn't want to get dragged into messy wars in the steppes
					NOT = {
						is_nomadic = yes
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
											AND = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
											top_liege = {
												OR = {
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													is_tributary = {
														type = chinese_imperial_tributary
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														AND = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															AND = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_ask_to_increase_tributary_tier
			character_event = { id = grace.975 }
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.01 # Make random distant realms unlikely to try to become higher tier tributaries
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are less willing to become tributaries
			modifier = {
				factor = 0.1
				OR = {
					real_tier = king
					is_nomadic = yes
				}
			}
			modifier = {
				factor = 0
				real_tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 5
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 0.1
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 0
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.1
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.25
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 10
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 5
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
			}
			modifier = {
				factor = 0
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 2
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 2
				has_acceptable_chinese_religion_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 2
				has_acceptable_chinese_culture_no_gamerule_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 5
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 0.1
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 0
				is_tributary = {
					type = chinese_client_state
				}
				has_acceptable_chinese_religion_trigger = no
			}
			# We won't willingly join China if we don't have a matching culture group or Chinese culture
			modifier = {
				factor = 0
				is_tributary = {
					type = chinese_client_state
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
			}
			# Would become a vassal
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Would become a Client State
			modifier = {
				factor = 0.25
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Would become a Protectorate
			modifier = {
				factor = 0.5
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 2
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 10
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			# More likely if China is doing well
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 0.1
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
				has_acceptable_chinese_religion_trigger = no
			}
			# If we want to get border adjustments, seriously consider it
			modifier = {
				factor = 10
				NOT = {
					is_tributary = {
						type = chinese_client_state # Already a client state, which is all we need
					}
				}
				china_grants_border_adjustment_boon_trigger = yes
				e_china = {
					holder_scope = {
						any_realm_title = {
							tier = count
							NOR = {
								de_jure_liege_or_above = e_china
								region = world_china
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
			}
			# Pagans should be more unlikely to become tributaries
			modifier = {
				factor = 0.5
				religion_group = pagan_group
				has_acceptable_chinese_religion_trigger = no
				is_reformed_religion = no
				NOT = {
					religion = ryukyuan_pagan
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
			}
			# If we're not in China, we should be unlikely to want to join China
			modifier = {
				factor = 0.001
				real_tier = king
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				real_tier = duke
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				real_tier = count
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
		}
	}
	
	ai_ask_to_decrease_tributary_tier = {
		only_independent = yes
		ai_check_interval = 90
		
		potential = {
			ai = yes
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			e_china = {
				holder_scope = {
					NOR = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_recently_became_higher_tier_tributary
						}
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_recently_became_lower_tier_tributary
						}
					}
				}
			}
		}
		
		allow = {
			china_hates_root_trigger = no # Would be refused
			china_wants_roots_land_trigger = no # Would be refused
			can_use_grace_decisions_root_trigger = yes
			war = no
			suzerain = {
				is_chinese_emperor_trigger = yes
			}
			OR = {
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					OR = {
						AND = {
							NOT = { # If a Client State is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
													NOR = {
														character = ROOT
														top_liege = {
															character = ROOT
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		top_liege = {
																			OR = {
																				is_tributary = {
																					type = chinese_client_state
																				}
																				is_tributary = {
																					type = chinese_protectorate
																				}
																			}
																		}
																	}
																	NOR = {
																		character = ROOT
																		top_liege = {
																			character = ROOT
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 1000
							}
						}
						check_variable = {
							which = grace
							value = 2000
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					OR = {
						AND = {
							NOT = { # If a Protectorate is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 1000
							}
						}
						check_variable = {
							which = grace
							value = 500
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					check_variable = {
						which = grace
						value = 500
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					check_variable = {
						which = grace
						value = 250
					}
				}
			}
		}
		
		effect = {
			set_character_flag = ai_ask_to_decrease_tributary_tier
			if = {
				limit = {
					is_tributary = {
						type = chinese_client_state
					}
				}
				if = {
					limit = {
						NOT = { # If a Client State is too distant, China will be more willing to let them go
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
														}
													}
												}
												NOR = {
													character = ROOT
													top_liege = {
														character = ROOT
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
															NOR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					change_variable = {
						which = grace
						value = -1000
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -2000
					}
				}
			}
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_protectorate
					}
				}
				if = {
					limit = {
						NOT = { # If a Protectorate is too distant, China will be more willing to let them go
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					change_variable = {
						which = grace
						value = -1000
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -500
					}
				}
			}
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				change_variable = {
					which = grace
					value = -500
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -250
				}
			}
			character_event = { id = grace.975 }
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 10
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, you should want to break free
						}
					}
				}
			}
			modifier = {
				factor = 10 # Make random distant realms more likely to try to break free
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are more likely to want to break free
			modifier = {
				factor = 2
				OR = {
					real_tier = king
					is_nomadic = yes
				}
			}
			# Non-nomadic emperors want to break free very frequently
			modifier = {
				factor = 10
				real_tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 0.25
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 5
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 10
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 10
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 5
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 0.1
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 0.5
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 100
				root_hates_china_trigger = yes # Dislikes the EoC
			}
			modifier = {
				factor = 100
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 0.25
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				has_acceptable_chinese_religion_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				government = chinese_vassal_government
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				has_acceptable_chinese_culture_no_gamerule_trigger = yes
			}
			# We are uncivilized
			modifier = {
				factor = 10
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
				has_acceptable_chinese_religion_trigger = no
			}
			# We won't willingly join China if we don't have a matching culture group or Chinese culture
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
			}
			# Is a Client State
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Is a Protectorate
			modifier = {
				factor = 5
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Wants to break free on succession
			modifier = {
				factor = 2
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Controls a religion, is a holy order, or is a mercenary and thus doesn't want to be a tributary
			modifier = {
				factor = 100
				OR = {
					controls_religion = yes
					mercenary = yes
					holy_order = yes
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.1
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			# Less likely if China is doing well
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 10
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
				has_acceptable_chinese_religion_trigger = no
			}
			# If you have rather little Grace, perhaps you should stay a bit longer...
			modifier = {
				factor = 0.01
				NOT = {
					check_variable = {
						which = grace
						value = 1000
					}
				}
			}
			# If we want to get border adjustments, seriously consider it
			modifier = {
				factor = 0.1
				china_grants_border_adjustment_boon_trigger = yes
				e_china = {
					holder_scope = {
						any_realm_title = {
							tier = count
							NOR = {
								de_jure_liege_or_above = e_china
								region = world_china
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
			}
			# Pagans should be more unlikely to become tributaries
			modifier = {
				factor = 5
				religion_group = pagan_group
				has_acceptable_chinese_religion_trigger = no
				is_reformed_religion = no
				NOT = {
					religion = ryukyuan_pagan
				}
				has_acceptable_chinese_culture_no_gamerule_trigger = no
			}
			# If we're not in China we should be a bit more likely to want to downgrade if we're a Client State
			modifier = {
				factor = 10
				real_tier = king
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
			modifier = {
				factor = 5
				real_tier = duke
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
			modifier = {
				factor = 2
				real_tier = count
				is_tributary = {
					type = chinese_client_state
				}
				NOT = {
					capital_scope = {
						OR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
			}
		}
	}
}

# Border adjustments
title_decisions = {
	request_border_adjustment = {
		only_independent = yes
		filter = all
		ai_target_filter = all
		ai_check_interval = 180
		
		from_potential = {
			has_dlc = "Jade Dragon"
			higher_tier_than = count
			is_tribal = no
			is_nomadic = no
			is_tributary = {
				type = chinese_client_state
			}
			suzerain = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			tier = duke # Individual counties would be too performace-intensive
			# We either hold the relevant duchy or hold a liege title
			OR = {
				holder_scope = {
					character = FROM
				}
				de_jure_liege_or_above = FROM
			}
			# Any county belonging to the duchy is held by China or a vassal of China
			any_direct_de_jure_vassal_title = { # Checking individual baronies would be too much
				holder_scope = {
					OR = {
						is_chinese_emperor_trigger = yes
						top_liege = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				# The county in question is neither part of de jure China nor the China region
				NOR = {
					region = world_china
					de_jure_liege_or_above = e_china
				}
			}
		}
		
		allow = {
			FROM = {
				war = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_actual_regency_trigger = no
				suzerain = {
					war = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					has_actual_regency_trigger = no
				}
			}
			FROM = {
				check_variable = {
					which = grace
					value = 2000 # Expensive, both because you're getting land from China and because it is meant to be a trap to drain your Grace so that you can't use that to avoid becoming a vassal
				}
				suzerain = {
					NOR = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_requested_border_adjustment
						}
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_refused_border_adjustment
						}
					}
				}
			}
			OR = {
				e_china = {
					holder_scope = {
						china_grants_border_adjustment_boon_from_trigger = yes
					}
				}
				FROM = {
					ai = no
					china_grants_border_adjustment_boon_trigger = yes
				}
			}
		}
		
		effect = {
			ROOT = {
				save_event_target_as = border_adjustment_duchy
			}
			FROM = {
				change_variable = {
					which = grace
					value = -2000 
				}
				suzerain = {
					narrative_event = { id = grace.346 }
				}
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 10
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					trait = humble
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					trait = charitable
				}
			}
			modifier = {
				factor = 10
				FROM = {
					real_tier = emperor
				}
			}
			modifier = {
				factor = 5
				FROM = {
					real_tier = king
				}
			}
			modifier = {
				factor = 0
				china_hates_from_trigger = yes # Would be refused
			}
		}
	}
	
	china_request_border_adjustment = {
		filter = all
		ai_target_filter = all
		ai_check_interval = 180
		
		from_potential = {
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = yes
		}
		
		potential = {
			tier = duke # Individual counties would be too performace-intensive
			# Any of FROM's client states hold land in the duchy, and the land isn't de jure theirs
			any_direct_de_jure_vassal_title = { # Only counties
				OR = {
					region = world_china
					de_jure_liege_or_above = e_china
				}
				holder_scope = {
					top_liege = {
						higher_tier_than = count # Counts shouldn't accidentally get integrated
						is_tributary = {
							type = chinese_client_state
						}
						suzerain = {
							character = FROM
						}
						NOT = {
							de_jure_vassal_or_below = PREVPREV
						}
						NOR = {
							has_opinion_modifier = {
								who = FROM
								modifier = opinion_requested_border_adjustment
							}
							has_opinion_modifier = {
								who = FROM
								modifier = opinion_china_refused_border_adjustment
							}
						}
					}
				}
			}
		}
		
		allow = {
			FROM = {
				war = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_actual_regency_trigger = no
			}
			e_china = {
				holder_scope = {
					china_grants_border_adjustment_boon_trigger = yes
				}
			}
			any_direct_de_jure_vassal_title = { # Only counties
				holder_scope = {
					top_liege = {
						higher_tier_than = count # Counts shouldn't accidentally get integrated
						is_tributary = {
							type = chinese_client_state
						}
						suzerain = {
							character = FROM
						}
						NOT = {
							de_jure_vassal_or_below = PREVPREV
						}
						NOR = {
							has_opinion_modifier = {
								who = FROM
								modifier = opinion_requested_border_adjustment
							}
							has_opinion_modifier = {
								who = FROM
								modifier = opinion_china_refused_border_adjustment
							}
						}
						war = no
						prisoner = no
						NOT = { trait = incapable }
						is_inaccessible_trigger = no
						has_actual_regency_trigger = no
					}
				}
			}
			FROM = {
				prestige = 1000
				wealth = 1000
			}
		}
		
		effect = {
			FROM = {
				prestige = -1000
				wealth = -1000
			}
			ROOT = {
				save_event_target_as = china_border_adjustment_duchy
			}
			any_independent_ruler = {
				limit = {
					any_realm_title = {
						de_jure_liege_or_above = ROOT
					}
					higher_tier_than = count # Counts shouldn't accidentally get integrated
					#is_tributary = {
					#	type = chinese_client_state
					#}
					suzerain = {
						character = FROM
					}
					war = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					has_actual_regency_trigger = no
				}
				narrative_event = { id = grace.612 }
			}
		}
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 10
				FROM = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 5
				FROM = {
					trait = greedy
				}
			}
			modifier = {
				factor = 2
				FROM = {
					trait = proud
				}
			}
			modifier = {
				factor = 0
				FROM = {
					trait = content
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					trait = humble
				}
			}
			modifier = {
				factor = 0.25
				FROM = {
					trait = charitable
				}
			}
		}
	}
}