# This file borrows heavily from the vanilla jd_grace_decisions.txt file when it comes to AI logic and requirements on people being sent to China
# All Grace decisions MUST be DLC-locked to JD to avoid conflict with modding rule 7, even though we cannot use the offmap mechanics
# Important scripted triggers are located in the tianxia_grace_triggers.txt file in the /common/scripted_triggers directory

# ONLY the EoC will be using the Grace system, regardless of whether someone else has the Chinese Imperial government type
# A fully dynamic system is not possible due to the need to name the variables, but it should be possible to implement the same (or similar) decisions for specific titles, if desired

# The AI does all of this using offset on_x_pulse events

# TODO: Scripted triggers for availability
# TODO: Opinion modifiers
# TODO: Events
# TODO: Test

targeted_decisions = {
	kow_tow_china = {
		only_playable = yes
		#ai_check_interval = 180
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		ai_target_filter = none # Not used by the AI; it has a non-targeted decision for performance reasons
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			independent = yes
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no
			NOT = {
				government = chinese_imperial_government
			}
			suzerain = {
				NAND = {
					is_chinese_emperor_trigger = no
					government = chinese_imperial_government
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			FROM = {
				show_scope_change = no
				war = no
				NOT = {
					block_general_event_trigger = yes
					custom_tooltip = {
						text = kow_tow_tooltip_already_went
						hidden_tooltip = {
							has_character_flag = went_on_kow_tow_pilgrimage
						}
					}
				}
				custom_tooltip = {
					text = health_travel_condition
					hidden_tooltip = {
						NOR = {
							trait = pregnant
							trait = incapable
							trait = blinded
							trait = has_tuberculosis
							trait = has_typhoid_fever
							trait = has_typhus
							trait = has_bubonic_plague
							trait = has_measles
							trait = has_small_pox
							trait = has_aztec_disease
						}
					}
				}
				higher_real_tier_than = COUNT
				conditional_tooltip = {
					trigger = {
						OR = {
							real_tier = DUKE
							is_nomadic = yes
						}
					}
					prestige = 250
				}
				conditional_tooltip = {
					trigger = {
						real_tier = KING
						NOT = { is_nomadic = yes }
					}
					prestige = 500
				}
				conditional_tooltip = {
					trigger = {
						real_tier = EMPEROR
						NOT = { is_nomadic = yes }
					}
					prestige = 1000
				}
				custom_tooltip = {
					text = is_not_busy_trigger_tooltip
					hidden_tooltip = { NOT = { has_character_flag = do_not_disturb } }
				}
				is_inaccessible_or_incapable_trigger = no
				has_regent = no
				is_under_regency_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			# TODO: Create new kowtow events that involve the EoC and others in China a bit more
			FROM = {
				save_event_target_as = kow_tow_traveler
				set_character_flag = went_on_kow_tow_pilgrimage
				set_character_flag = do_not_disturb
				character_event = {
					id = JD.32000
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	send_gift_china = {
		only_playable = yes
		ai = no
		filter = independent_rulers
		ai_target_filter = none
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
	
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				scaled_wealth = {
					value = 1
					min = 500
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6002 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	send_gift_china_vassal = {
		only_playable = yes
		ai = no
		filter = independent_rulers
		ai_target_filter = none
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
	
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				scaled_wealth = {
					value = 1
					min = 500
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6008 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	become_tributary_china = {
		only_playable = yes
		only_independent = yes
		ai = no
		filter = independent_rulers
		ai_target_filter = none
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
			controls_religion = no
			NAND = {
				can_have_any_japanese_government_trigger = yes
				any_realm_lord = {
					OR = {
						government = japanese_imperial_government
						government = divine_imperial_government
					}
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				war = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				has_regent = no
				is_under_regency_trigger = no
				is_tributary = no
			}
			war = no
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6014 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	supply_horses_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			has_dlc = "Horse Lords"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_nomadic = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				liege = {
					independent = yes
				}
			}
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				NOT = {
					top_liege = {
						suzerain = {
							government = chinese_imperial_government
							NOT = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
				}
				war = no
				unused_manpower = 300
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6020 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	supply_horses_china_vassal = { # Nothing to see here!
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			has_dlc = "Horse Lords"
			is_nomadic = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				war = no
				unused_manpower = 300
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6026 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_eunuch_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				NOT = {
					top_liege = {
						suzerain = {
							government = chinese_imperial_government
							NOT = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
				}
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				NAND = { # No snipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT_FROM = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOT = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				NOT = { is_heir = yes }
				OR = {
					custom_tooltip = {
						text = not_married_or_getting_married_tt
						NOT = { is_betrothed = yes }
						NOT = { is_married = yes }
					}
					AND = {
						prisoner = yes
						host = {
							character = ROOT_FROM
						}
					}
				}
				custom_tooltip = { #can't be from China
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT_FROM
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			# Regardless of whether the EoC accepts the eunuch in the end, they are snipped
			if = {
				limit = {
					FROMFROM = {
						NOT = {
							trait = eunuch
						}
					}
				}
				hidden_tooltip = {
					FROMFROM = {
						save_event_target_as = event_target:tribute_character
					}
				}
				event_target:tribute_character = { # Didn't work well in the FROMFROM scope for some reason...
					add_trait = eunuch
					hidden_tooltip = {
						opinion = {
							who = ROOT_FROM
							modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
						}
						any_close_relative = {
							opinion = {
								who = ROOT_FROM
								modifier = opinion_castrated_close_kin
							}
						}
						any_dynasty_member = {
							opinion = {
								who = ROOT_FROM
								modifier = opinion_castrated_family
							}
						}
					}
				}
			}
			hidden_tooltip = {
				character_event = { id = soh.6032 } # EoC gets event
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_eunuch_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				NAND = { # No snipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT_FROM = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOT = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				NOT = { is_heir = yes }
				OR = {
					custom_tooltip = {
						text = not_married_or_getting_married_tt
						NOT = { is_betrothed = yes }
						NOT = { is_married = yes }
					}
					AND = {
						prisoner = yes
						host = {
							character = ROOT_FROM
						}
					}
				}
				custom_tooltip = { #can't be from China
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT_FROM
					}
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			# Regardless of whether the EoC accepts the eunuch in the end, they are snipped
			if = {
				limit = {
					FROMFROM = {
						NOT = {
							trait = eunuch
						}
					}
				}
				hidden_tooltip = {
					FROMFROM = {
						save_event_target_as = tribute_character
					}
				}
				event_target:tribute_character = { # Didn't work well in the FROMFROM scope for some reason...
					add_trait = eunuch
					hidden_tooltip = {
						opinion = {
							who = ROOT_FROM
							modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
						}
						any_close_relative = {
							opinion = {
								who = ROOT_FROM
								modifier = opinion_castrated_close_kin
							}
						}
						any_dynasty_member = {
							opinion = {
								who = ROOT_FROM
								modifier = opinion_castrated_family
							}
						}
					}
				}
			}
			hidden_tooltip = {
				character_event = { id = soh.6038 } # EoC gets event
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_concubine_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			OR = {
				AND = {
					is_adult = yes
					is_female = no
					NOR = {
						trait = celibate
						trait = eunuch
					}
				}
				any_dynasty_member = {
					host = {
						character = ROOT
					}
					prisoner = no
					is_adult = yes
					is_female = no
					NOR = {
						trait = celibate
						trait = eunuch
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				NAND = { # No shipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT_FROM = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOR = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
					e_china = {
						holder_scope = {
							OR = {
								is_descendant_of = PREVPREV
								is_ancestor_of = PREVPREV
							}
						}
					}
					any_sibling = {
						is_chinese_emperor_trigger = yes
					}
				}
				is_female = yes
				# Has no children, and has never had any children
				NOT = {
					any_child_even_if_dead = {
						always = yes
					}
				}
				OR = {
					# Close relative of yours
					custom_tooltip = {
						text = is_close_relative_or_same_dynasty_tt
						OR = {
							is_close_relative = ROOT_FROM
							dynasty = ROOT_FROM
						}
					}
					# From a high-ranking family
					custom_tooltip = {
						text = close_relative_is_king_or_emperor
						any_close_relative = {
							OR = {
								real_tier = king
								real_tier = emperor
							}
						}
					}
					# Very beautiful
					trait = fair
					# Likely to be able to catch someone's attention
					AND = {
						trait = seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy # This is missing in vanilla but should probably be here...
					trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
					trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6044 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_concubine_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			has_dlc = "Jade Dragon"
			ai = no
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
			NOT = {
				has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}

		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			OR = {
				AND = {
					is_adult = yes
					is_female = no
					NOR = {
						trait = celibate
						trait = eunuch
					}
				}
				any_dynasty_member = {
					host = {
						character = ROOT
					}
					prisoner = no
					is_adult = yes
					is_female = no
					NOR = {
						trait = celibate
						trait = eunuch
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				NAND = { # No shipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT_FROM = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOR = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
					e_china = {
						holder_scope = {
							OR = {
								is_descendant_of = PREVPREV
								is_ancestor_of = PREVPREV
							}
						}
					}
					any_sibling = {
						is_chinese_emperor_trigger = yes
					}
				}
				is_female = yes
				# Has no children, and has never had any children
				NOT = {
					any_child_even_if_dead = {
						always = yes
					}
				}
				OR = {
					# Close relative of yours
					custom_tooltip = {
						text = is_close_relative_or_same_dynasty_tt
						OR = {
							is_close_relative = ROOT_FROM
							dynasty = ROOT_FROM
						}
					}
					# From a high-ranking family
					custom_tooltip = {
						text = close_relative_is_king_or_emperor
						any_close_relative = {
							OR = {
								real_tier = king
								real_tier = emperor
							}
						}
					}
					# Very beautiful
					trait = fair
					# Likely to be able to catch someone's attention
					AND = {
						trait = seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy # This is missing in vanilla but should probably be here...
					trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
					trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6050 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_commander_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no

				is_adult = yes
				OR = {
					martial = 12
					has_education_martial_trigger = yes
				}
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						e_china = {
							has_law = status_of_women_4 # Allows female commmanders
						}
					}
					custom_tooltip = {
						text = can_be_female_commander
						has_character_flag = special_marshal
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6057 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_commander_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no

				is_adult = yes
				OR = {
					martial = 12
					has_education_martial_trigger = yes
				}
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						e_china = {
							has_law = status_of_women_4 # Allows female commmanders
						}
					}
					custom_tooltip = {
						text = can_be_female_commander
						has_character_flag = special_marshal
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
			}
		}

		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6063 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_physician_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			has_dlc = "Reapers"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
				NOT = {
					any_realm_province = {
						has_disease = yes # China would probably not trust you not to send a plague-carrier
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					liege = {
						character = ROOT_FROM
					}
				}
				show_scope_change = no
				NOT = { is_ruler = yes }
				is_adult = yes
				is_heir = no
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				OR = {
					conditional_tooltip = {
						trigger = {
							has_dlc = Reapers
						}
						has_minor_title = title_court_physician 
					}
					trait = physician
					trait = scholar
					trait = mystic
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6070 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_physician_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			has_dlc = "Reapers"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = {
					any_demesne_province = {
						has_disease = yes # China would probably not trust you not to send a plague-carrier
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				hidden_tooltip = {
					liege = {
						character = ROOT_FROM
					}
				}
				show_scope_change = no
				NOT = { is_ruler = yes }
				is_adult = yes
				is_heir = no
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				OR = {
					conditional_tooltip = {
						trigger = {
							has_dlc = Reapers
						}
						has_minor_title = title_court_physician 
					}
					trait = physician
					trait = scholar
					trait = mystic
				}
			}
		}
		
		third_party_allow = {
			show_only_failed_conditions = yes
			FROMFROM = {
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_character
			}
			character_event = { id = soh.6076 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_artifact_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = artifacts
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = send_artifact_potential_tt
					#quality > 2
					NOR = {
						AND = {
							artifact_type = heirloom_seal_of_the_realm
							ROOT = {
								has_claim = e_china
							}
						}
						AND = {
							has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
							ROOT = {
								society_member_of = hermetics # Or that other thing...
							}
						}
						has_artifact_flag = flag_considering_donation 
						has_artifact_flag = curse
						has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
						AND = {
							FROM = { NOT = { has_landed_title = e_hre } }
							artifact_type = crown_hre
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_byzantium } }
							artifact_type = crown_byzantine
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_norse_pagan_reformed } }
							artifact_type = crown_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
							artifact_type = crown_tengri_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
							artifact_type = crown_slavic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
							artifact_type = crown_romuva_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
							artifact_type = crown_finnish_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
							artifact_type = crown_west_african_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_zun_pagan_reformed } }
							artifact_type = crown_zun_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = k_hellenic_pagan } }
							artifact_type = scepter_hellenic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_bon_reformed } }
							artifact_type = scepter_bon_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_aztec_reformed } }
							artifact_type = crown_aztec_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_persia } }
							artifact_type = crown_pahlavi
						}
						AND = { # The Imperial Regalia is far too important to send away
							FROM = {
								can_have_any_japanese_government_trigger = yes
							}
							has_artifact_flag = imperial_regalia_of_japan
						}
						# TODO: Tianxia pagans
					}
				}
				ROOT = {
					NOT = {
						has_artifact = PREV # Check this!
					}
				}
			}
		}
		
		third_party_allow = {
			# Check this; we might need to script in separate checks for ALL artifacts
			ROOT = {
				NOT = {
					has_artifact = ROOT_FROMFROM # If the EoC already has a certain artifact, you cannot give him a duplicate
				}
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_artifact
			}
			character_event = { id = soh.6083 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_artifact_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		third_party_filter = artifacts
		ai_third_party_filter = none
		third_party = FROM
		show_third_party_potential = yes

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		third_party_potential = {
			show_only_failed_conditions = yes
			FROMFROM = {
				show_scope_change = no
				custom_tooltip = {
					text = send_artifact_potential_tt
					#quality > 2
					NOR = {
						AND = {
							artifact_type = heirloom_seal_of_the_realm
							ROOT = {
								has_claim = e_china
							}
						}
						AND = {
							has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
							ROOT = {
								society_member_of = hermetics # Or that other thing...
							}
						}
						has_artifact_flag = flag_considering_donation 
						has_artifact_flag = curse
						has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
						AND = {
							FROM = { NOT = { has_landed_title = e_hre } }
							artifact_type = crown_hre
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_byzantium } }
							artifact_type = crown_byzantine
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_norse_pagan_reformed } }
							artifact_type = crown_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
							artifact_type = crown_tengri_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
							artifact_type = crown_slavic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
							artifact_type = crown_romuva_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
							artifact_type = crown_finnish_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
							artifact_type = crown_west_african_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_zun_pagan_reformed } }
							artifact_type = crown_zun_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = k_hellenic_pagan } }
							artifact_type = scepter_hellenic_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_bon_reformed } }
							artifact_type = scepter_bon_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = d_aztec_reformed } }
							artifact_type = crown_aztec_fylkir
						}
						AND = {
							FROM = { NOT = { has_landed_title = e_persia } }
							artifact_type = crown_pahlavi
						}
						AND = { # The Imperial Regalia is far too important to send away
							FROM = {
								can_have_any_japanese_government_trigger = yes
							}
							has_artifact_flag = imperial_regalia_of_japan
						}
						# TODO: Tianxia pagans
					}
				}
				ROOT = {
					NOT = {
						has_artifact = PREV # Check this!
					}
				}
			}
		}
		
		third_party_allow = {
			# Check this; we might need to script in separate checks for ALL artifacts
			ROOT = {
				NOT = {
					has_artifact = ROOT_FROMFROM # If the EoC already has a certain artifact, you cannot give him a duplicate
				}
			}
		}
		
		effect = {
			FROMFROM = {
				save_event_target_as = tribute_artifact
			}
			character_event = { id = soh.6089 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	renounce_claims_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
			any_realm_title = {
				claimed_by = FROM
				NOR = {
					de_jure_vassal_or_below = FROM
					controls_religion = yes
				}
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6096 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	renounce_claims_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
			any_demesne_title = {
				claimed_by = FROM
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6102 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	cancel_favor_on_eoc_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			has_dlc = "Zeus"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			owes_favor_to = FROM
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6108 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	cancel_favor_on_eoc_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			has_dlc = "Zeus"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			owes_favor_to = FROM
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6114 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	transfer_prosperity_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			has_dlc = "Reapers"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
			any_realm_province = {
				NOR = {
					has_province_modifier = prosperity_modifier_3
					owner = {
						character = FROM
					}
				}
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				any_demesne_province = {
					OR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			FROM = {
				random_demesne_province = {
					preferred_limit = {
						NOT = {
							FROM = {
								capital_scope = {
									province = PREVPREV
								}
							}
						}
					}
					save_event_target_as = tribute_province
				}
			}
			character_event = { id = soh.6120 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	transfer_society_currency_china = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM

		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			OR = {
				independent = yes
				real_tier = king
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
				liege = {
					independent = yes
				}
			}
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Either under a pretender or a vassal of China
				}
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
			same_society_as = FROM
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				OR = {
					independent = yes
					real_tier = king
					has_minor_title = title_grand_chancellor
					i_am_appropriate_regent_trigger = yes
					AND = {
						liege = {
							independent = yes
						}
						is_powerful_vassal = yes
					}
				}
				society_currency >= 1000
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOR = {
					any_war = {
						any_attacker = {
							character = FROM
						}
						any_defender = {
							is_chinese_emperor_trigger = yes
						}
					}
					any_war = {
						any_attacker = {
							is_chinese_emperor_trigger = yes
						}
						any_defender = {
							character = FROM
						}
					}
				}
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6127 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	transfer_society_currency_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none
		third_party_filter = home_court
		ai_third_party_filter = none
		third_party = FROM

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			# The receiver must be the EoC and the Grace mechanics must be active
			is_chinese_emperor_trigger = yes
			same_society_as = FROM
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				society_currency >= 1000
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6133 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	boost_moh_china_vassal = {
		only_playable = yes
		ai = no 
		filter = independent_rulers
		ai_target_filter = none

		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				prestige = 1000
			}
			is_inaccessible_or_incapable_trigger = no
		}
		
		effect = {
			character_event = { id = soh.6139 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	ask_to_increase_tributary_tier = {
		only_independent = yes
		ai = no # The AI uses a regular decision
		filter = independent_rulers
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
				}
			}
		}
		
		potential = {
			is_chinese_emperor_trigger = yes
			any_tributary = {
				character = FROM
			}
		}
		
		allow = {
			show_only_failed_conditions = yes
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			is_inaccessible_or_incapable_trigger = no
			war = no
			FROM = {
				suzerain = {
					character = ROOT
				}
			}
			FROM = {
				war = no # Is at peace
				# Only non-emperors and nomads can become a higher tier tributary
				OR = {
					NOT = {
						real_tier = emperor
					}
					is_nomadic = yes
				}
				controls_religion = no # You're too important for this!
				NAND = {
					can_have_any_japanese_government_trigger = yes
					any_realm_lord = {
						OR = {
							government = japanese_imperial_government
							government = divine_imperial_government
						}
					}
				}
			}
			FROM = {
				OR = {
					custom_tooltip = {
						text = is_nearby_client_state
						AND = {
							is_tributary = {
								type = chinese_client_state
							}
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													top_liege = {
														character = ROOT
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							# China isn't interested in integrating tribal or nomadic land
							NOR = {
								is_tribal = yes
								is_nomadic = yes
							}
						}
					}
					custom_tooltip = {
						text = is_nearby_protectorate
						AND = {
							is_tributary = {
								type = chinese_protectorate
							}
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													top_liege = {
														character = ROOT
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							# China isn't really interested in nomads, and only cares about tribals in China/its de jure
							NOR = {
								AND = {
									is_tribal = yes
									NOT = {
										any_realm_province = {
											OR = {
												region = world_china
												county = {
													de_jure_liege_or_above = e_china
												}
											}
										}
									}
								}
								is_nomadic = yes
							}
							controls_religion = no # Rel heads don't want to be closely tied to a heathen
						}
					}
					custom_tooltip = {
						text = is_nearby_imperial_tributary
						AND = {
							is_tributary = {
								type = chinese_imperial_tributary
							}
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													top_liege = {
														character = ROOT
													}
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
														}
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							# China doesn't want to get dragged into messy wars in the steppes
							is_nomadic = no
						}
					}
					custom_tooltip = {
						text = is_nearby_peripheral_or_misc_tributary
						AND = {
							NOR = {
								is_tributary = {
									type = chinese_client_state
								}
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_imperial_tributary
								}
							}
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													top_liege = {
														character = ROOT
													}
													AND = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															is_tributary = {
																type = chinese_imperial_tributary
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															is_tributary = {
																type = chinese_imperial_tributary
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
																AND = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																	AND = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																			is_tributary = {
																				type = chinese_imperial_tributary
																			}
																		}
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																			is_tributary = {
																				type = chinese_imperial_tributary
																			}
																		}
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		
		effect = {
			character_event = { id = soh.6145 } # EoC gets event
		}
		
		ai_will_do = {
			factor = 0
		}
	}
}

title_decisions = {
	hand_over_title_china_vassal = {
		only_playable = yes
		ai = no 
		filter = realm_owned
		ai_target_filter = none
		
		from_potential = {
			ai = no
			has_dlc = "Jade Dragon"
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
			any_demesne_title = {
				count = 2
				tier = count
			}
		}
		
		potential = {
			controls_religion = no
			holder_scope = {
				character = FROM
			}
			tier = count
		}
		
		allow = {
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				war = no
			}
			e_china = {
				holder_scope = {
					is_inaccessible_or_incapable_trigger = no
				}
			}
			NOT = {
				de_jure_vassal_or_below = FROM
			}
		}
		
		effect = {
			ROOT = {
				save_event_target_as = county_to_hand_over
			}
			e_china = {
				holder_scope = {
					character_event = { id = soh.6151 } # EoC gets event
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
	
	offer_border_adjustment_china = {
		ai = no
		only_independent = yes
		only_playable = yes
		filter = all
		ai_target_filter = none
		
		from_potential = {
			ai = no
			is_new_world_invader_or_vassal_trigger = no
			has_dlc = "Jade Dragon"
			is_close_to_china_or_along_the_silk_road_trigger = yes
			is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
			top_liege = {
				NOT = {
					government = chinese_imperial_government # Pretender emperors
				}
			}
			controls_religion = no
			NAND = {
				can_have_any_japanese_government_trigger = yes
				any_realm_lord = {
					OR = {
						government = japanese_imperial_government
						government = divine_imperial_government
					}
				}
			}
		}
		
		potential = {
			tier = duke # Individual counties would be too performace-intensive
			# We either hold the relevant duchy or hold a liege title
			OR = {
				holder_scope = {
					OR = {
						character = FROM
						top_liege = {
							character = FROM
						}
					}
				}
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = FROM
							top_liege = {
								character = FROM
							}
						}
					}
				}
			}
			# The title is de jure or de facto part of China
			OR = {
				region = world_china
				de_jure_liege_or_above = e_china
			}
		}
		
		allow = {
			FROM = {
				has_regent = no
				is_under_regency_trigger = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				war = no
			}
			NOT = {
				de_jure_vassal_or_below = FROM
			}
			e_china = {
				holder_scope = {
					is_inaccessible_or_incapable_trigger = no
					war = no
				}
			}
		}
		
		effect = {
			ROOT = {
				save_event_target_as = border_adjustment_duchy
			}
			e_china = {
				holder_scope = {
					character_event = { id = soh.6158 } # EoC gets event
				}
			}
		}
		
		ai_will_do = {
			factor = 0
		}
	}
}