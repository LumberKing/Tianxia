# Treasure Fleet events
# by Silverswee(e)per

namespace = treasurefleet

##### Preparation

### Startup + event selection

# I have decided to send forth a Treasure Fleet - block wars!
narrative_event = {
	id = treasurefleet.1
	title = EVTTITLE_TREASURE_FLEET_1
	desc = EVTDESC_TREASURE_FLEET_1
	picture = GFX_evt_china_invades
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_1 # It will be auspicious!
		
		add_trait = treasure_fleet_preparation
		hidden_tooltip = {
			2753 = { # Hangzhou
				treasure_fleet_setup_effect = yes
			}
		}
	}
}

# Inform vassals
narrative_event = {
	id = treasurefleet.2
	title = EVTTITLE_TREASURE_FLEET_2
	desc = EVTDESC_TREASURE_FLEET_2
	picture = GFX_evt_china_invades
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_feudal = yes
		}
		name = EVTOPTA_TREASURE_FLEET_2 # Maybe I'll join it...
	}
	
	option = {
		trigger = {
			is_feudal = no
		}
		name = EVTOPTB_TREASURE_FLEET_2 # I don't care!
	}
}

# Inform playable rulers that might care
narrative_event = {
	id = treasurefleet.3
	title = EVTTITLE_TREASURE_FLEET_3
	desc = EVTDESC_TREASURE_FLEET_3
	picture = GFX_evt_china_invades
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			any_realm_province = {
				port = yes
				can_naval_path_to = c_hangzhou
			}
		}
		name = EVTOPTA_TREASURE_FLEET_3 # Interesting...
	}
	
	option = {
		trigger = {
			NOT = {
				any_realm_province = {
					port = yes
					can_naval_path_to = c_hangzhou
				}
			}
		}
		name = EVTOPTB_TREASURE_FLEET_3 # I don't care!
	}
}

# Check if the fleet should be cancelled or launched, otherwise go to preparation event selection
province_event = {
	id = treasurefleet.4
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_preparation = {
			limit = {
				NOT = {
					top_liege = {
						has_landed_title = e_china
					}
				}
			}
			remove_trait = treasure_fleet_preparation # Clean up people that shouldn't have the trait
		}
		if = { # First check if we should cancel the TF preparations
			limit = {
				OR = {
					has_province_flag = abort_treasure_fleet_asap
					e_china = {
						has_holder = no
					}
					e_china = {
						holder_scope = {
							any_war = {
								OR = {
									attacker = {
										character = PREV
									}
									defender = {
										character = PREV
									}
								}
							}
						}
					}
					e_china = {
						holder_scope = {
							is_chinese_emperor_trigger = no
						}
					}
				}
			}
			any_playable_ruler = {
				any_war = {
					limit = {
						OR = {
							using_cb = treasure_fleet_tributary_war
							using_cb = punitive_expedition
						}
					}
					end_war = invalid
				}
			}
			clean_up_old_treasure_fleet_effect = yes
			e_china = {
				holder_scope = {
					character_event = { id = treasurefleet.7 } # Inform the EoC
					any_realm_lord = {
						limit = {
							is_playable = yes
							ai = no
						}
						character_event = { id = treasurefleet.8 } # Inform vassals
					}
				}
			}
			any_independent_ruler = {
				limit = {
					NOT = {
						has_landed_title = e_china
					}
				}
				if = {
					limit = {
						is_playable = yes
						ai = no
					}
					character_event = { id = treasurefleet.9 } # Inform others
				}
				any_realm_lord = {
					limit = {
						is_playable = yes
						ai = no
					}
					character_event = { id = treasurefleet.9 } # Inform others
				}
			}
		}
		else_if = {
			limit = {
				check_variable = {
					which = treasure_fleet_progress
					value = 25
				}
			}
			# If the fleet is too weak, boost it up to the minimum amount
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = treasure_fleet_ship_strength
							value = 10
						}
					}
				}
				set_variable = {
					which = treasure_fleet_ship_strength
					value = 10
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = treasure_fleet_army_strength
							value = 10
						}
					}
				}
				set_variable = {
					which = treasure_fleet_army_strength
					value = 10
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = treasure_fleet_wealth
							value = 10
						}
					}
				}
				set_variable = {
					which = treasure_fleet_wealth
					value = 10
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_supplies
							value = 10
						}
					}
				}
				set_variable = {
					which = tf_supplies
					value = 10
				}
			}
			clr_global_flag = treasure_fleet_preparation
			e_china = {
				holder_scope = {
					character_event = { id = treasurefleet.83 }
				}
			}
		}
		else = {
			change_variable = {
				which = treasure_fleet_progress
				value = 1
			}
			province_event = { id = treasurefleet.5 } # Preparation events
		}
	}
}

# Preparation event selection + hidden boosts
province_event = {
	id = treasurefleet.5
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		province_event = { id = treasurefleet.4 days = 30 } # Iterate
		
		# Hidden boosts
		random_list = {
			900 = {}
			90 = {
				add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
			}
			9 = {
				add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
			}
			1 = {
				add_or_boost_everything_permissible_effect = yes
			}
		}
		
		e_china = {
			holder_scope = {
				any_realm_province = {
					limit = {
						port = yes
						can_naval_path_to = c_hangzhou
						has_province_modifier = jd_dry_docks
					}
					2753 = { # Hangzhou
						random_list = {
							50 = {}
							45 = {
								boost_random_treasure_fleet_attribute_small_effect = yes
							}
							4 = {
								boost_random_treasure_fleet_attribute_medium_effect = yes
							}
							1 = {
								boost_random_treasure_fleet_attribute_large_effect = yes
							}
						}
					}
				}
				
				# Random events
				random_list = {
					100 = {
						modifier = {
							factor = 0.1
							NOT = {
								wealth = 1000
							}
						}
						modifier = {
							factor = 0
							NOT = {
								wealth = 0
							}
						}
						character_event = { id = treasurefleet.10 } # Invest more money
					}
					100 = {
						modifier = {
							factor = 0.1
							NOT = {
								prestige = 1000
							}
						}
						modifier = {
							factor = 0
							NOT = {
								prestige = 0
							}
						}
						character_event = { id = treasurefleet.11 } # Grand proclamation for prestige
					}
					100 = {
						modifier = {
							factor = 0.1
							NOT = {
								piety = 1000
							}
						}
						modifier = {
							factor = 0
							NOT = {
								piety = 0
							}
						}
						character_event = { id = treasurefleet.12 } # Lean on temples
					}
					100 = {
						character_event = { id = treasurefleet.13 } # Make a grand speech
					}
					100 = {
						character_event = { id = treasurefleet.16 } # Make military preparations
					}
					100 = {
						character_event = { id = treasurefleet.19 } # Investigate trade opportunities
					}
					100 = {
						character_event = { id = treasurefleet.22 } # Consult spies
					}
					100 = {
						character_event = { id = treasurefleet.25 } # Consult books
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_realm_lord = {
									is_playable = yes
									is_feudal = yes
									ai = yes
									war = no
									NOR = {
										trait = treasure_fleet_preparation
										has_character_modifier = tf_join_request
										has_character_modifier = tf_joining_refused
										has_character_flag = do_not_disturb
									}
								}
							}
						}
						# Try to get the AI to join
						random_realm_lord = {
							limit = {
								is_playable = yes
								is_feudal = yes
								ai = yes
								war = no
								NOR = {
									trait = treasure_fleet_preparation
									has_character_modifier = tf_join_request
									has_character_modifier = tf_joining_refused
									has_character_flag = do_not_disturb
								}
							}
							character_event = { id = treasurefleet.28 }
						}
					}
					100 = {
						character_event = { id = treasurefleet.43 } # Foreign shipwrights
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_independent_ruler = {
									is_tributary = yes
									suzerain = {
										has_landed_title = e_china
									}
									NOT = {
										has_character_modifier = tributary_supported_tf
									}
								}
							}
						}
						# Tributary might assist
						random_independent_ruler = {
							limit = {
								is_tributary = yes
								suzerain = {
									has_landed_title = e_china
								}
								NOT = {
									has_character_modifier = tributary_supported_tf
								}
							}
							character_event = { id = treasurefleet.46 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_realm_lord = {
									is_playable = yes
									is_devil_worshiper_trigger = yes
								}
							}
						}
						# DW sabotage
						random_realm_lord = {
							limit = {
								is_playable = yes
								is_devil_worshiper_trigger = yes
							}
							character_event = { id = treasurefleet.53 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									is_council_eunuch_trigger = yes
								}
							}
						}
						# Council eunuch might help
						random_courtier_or_vassal = {
							limit = {
								is_council_eunuch_trigger = yes
							}
							character_event = { id = treasurefleet.62 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									has_job_title = job_chancellor
								}
							}
						}
						# Chancellor might help
						random_courtier_or_vassal = {
							limit = {
								has_job_title = job_chancellor
							}
							character_event = { id = treasurefleet.65 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									has_job_title = job_marshal
								}
							}
						}
						# Marshal might help
						random_courtier_or_vassal = {
							limit = {
								has_job_title = job_marshal
							}
							character_event = { id = treasurefleet.68 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									has_job_title = job_treasurer
								}
							}
						}
						# Steward might help
						random_courtier_or_vassal = {
							limit = {
								has_job_title = job_treasurer
							}
							character_event = { id = treasurefleet.71 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									has_job_title = job_spymaster
								}
							}
						}
						# Spymaster might help
						random_courtier_or_vassal = {
							limit = {
								has_job_title = job_spymaster
							}
							character_event = { id = treasurefleet.74 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									has_job_title = job_spiritual
								}
							}
						}
						# Court Chaplain might help
						random_courtier_or_vassal = {
							limit = {
								has_job_title = job_spymaster
							}
							character_event = { id = treasurefleet.77 }
						}
					}
					100 = {
						modifier = {
							factor = 0
							NOT = {
								any_courtier_or_vassal = {
									OR = {
										has_minor_title = title_councilmember_king
										has_minor_title = title_councilmember_emperor
									}
								}
							}
						}
						# Advisor might help
						random_courtier_or_vassal = {
							limit = {
								OR = {
									has_minor_title = title_councilmember_king
									has_minor_title = title_councilmember_emperor
								}
							}
							character_event = { id = treasurefleet.80 }
						}
					}
					500 = {
						# Nothing
					}
				}
			}
		}
	}
}

# on_new_holder (and variations) event to add the treasure_fleet_preparation trait to owners of e_china and to remove it from the former holder
character_event = {
	id = treasurefleet.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			trait = treasure_fleet_preparation
		}
		FROM = {
			title = e_china
		}
	}
	
	immediate = {
		FROMFROM = {
			remove_trait = treasure_fleet_preparation
		}
	}
}

# Treasure Fleet cancelled for whatever reason
character_event = {
	id = treasurefleet.7
	desc = EVTDESC_TREASURE_FLEET_7
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_7 # Ok
		
		if = {
			limit = {
				trait = treasure_fleet_preparation
			}
			remove_trait = treasure_fleet_preparation
		}
	}
}

# Inform vassals
character_event = {
	id = treasurefleet.8
	desc = EVTDESC_TREASURE_FLEET_8
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_8 # Ok
		
		if = {
			limit = {
				trait = treasure_fleet_preparation
			}
			remove_trait = treasure_fleet_preparation
		}
	}
}

# Inform others
character_event = {
	id = treasurefleet.9
	desc = EVTDESC_TREASURE_FLEET_9
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_9 # Ok 
		
		if = {
			limit = {
				trait = treasure_fleet_preparation
			}
			remove_trait = treasure_fleet_preparation
		}
	}
}

### Invest more money

# Invest more money?
character_event = {
	id = treasurefleet.10
	desc = EVTDESC_TREASURE_FLEET_10
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_10 # Invest more money
		wealth = -1000
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOT = {
					wealth = 1000
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_10 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_focus = focus_business
			}
		}
	}
}

### Make a general proclamation for prestige

# Seek help for prestige?
character_event = {
	id = treasurefleet.11
	desc = EVTDESC_TREASURE_FLEET_11
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_11 # Send the proclamation!
		prestige = -1000
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				NOT = {
					prestige = 1000
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_11 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
}

### Lean on temples

# Help for piety?
character_event = {
	id = treasurefleet.12
	desc = EVTDESC_TREASURE_FLEET_12
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_12 # Lean on temples!
		piety = -1000
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = zealous
			}
			modifier = {
				factor = 0.1
				NOT = {
					piety = 1000
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_12 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = cynical
			}
		}
	}
}

### Make a grand speech - Diplomacy

# Make a grand speech?
character_event = {
	id = treasurefleet.13
	desc = EVTDESC_TREASURE_FLEET_13
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_13 # Do so!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					diplomacy = 28
				}
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 16
				}
				character_event = { id = treasurefleet.14 days = 5 random = 5 } # It goes well
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				character_event = { id = treasurefleet.15 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					diplomacy = 12
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_13 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				diplomacy = 12
			}
		}
	}
}

# Speech goes well
character_event = {
	id = treasurefleet.14
	desc = EVTDESC_TREASURE_FLEET_14
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_14 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_ship_strength
					value = 10
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Speech goes poorly
character_event = {
	id = treasurefleet.15
	desc = EVTDESC_TREASURE_FLEET_15
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_15 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Get involved in the military preparations - Martial

# Get involved in the military preparations?
character_event = {
	id = treasurefleet.16
	desc = EVTDESC_TREASURE_FLEET_16
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_16 # Do so!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					martial = 28
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 16
				}
				character_event = { id = treasurefleet.17 days = 5 random = 5 } # It goes well
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				character_event = { id = treasurefleet.18 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					martial = 12
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_16 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				martial = 12
			}
		}
	}
}

# Preparations go well
character_event = {
	id = treasurefleet.17
	desc = EVTDESC_TREASURE_FLEET_17
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_17 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_army_strength
					value = 10
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Preparations go poorly
character_event = {
	id = treasurefleet.18
	desc = EVTDESC_TREASURE_FLEET_18
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_18 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Review trade - Stewardship

# Review trade?
character_event = {
	id = treasurefleet.19
	desc = EVTDESC_TREASURE_FLEET_19
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_19 # Do so!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					stewardship = 28
				}
				modifier = {
					factor = 2
					stewardship = 24
				}
				modifier = {
					factor = 2
					stewardship = 16
				}
				character_event = { id = treasurefleet.20 days = 5 random = 5 } # It goes well
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						stewardship = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 4
					}
				}
				character_event = { id = treasurefleet.21 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					stewardship = 12
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_19 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				stewardship = 12
			}
		}
	}
}

# Review goes well
character_event = {
	id = treasurefleet.20
	desc = EVTDESC_TREASURE_FLEET_20
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_20 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 10
				}
				if = {
					limit = {
						has_dlc = "Jade Dragon"
					}
					random_list = {
						1 = {
							add_random_t1_jd_artifact_effect = yes
						}
						1 = {
							add_random_t2_jd_artifact_effect = yes
						}
						1 = {
							add_random_t3_jd_artifact_effect = yes
						}
						1 = {
							add_random_t4_jd_artifact_effect = yes
						}
						1 = {
							add_random_t5_jd_artifact_effect = yes
						}
						1 = {
							add_random_jd_modifier_effect = yes
						}
					}
				}
				else = {
					add_random_number_of_art_of_war_pages_effect = yes
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Review goes poorly
character_event = {
	id = treasurefleet.21
	desc = EVTDESC_TREASURE_FLEET_21
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_21 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Consult spies - Intrigue

# Consult spies?
character_event = {
	id = treasurefleet.22
	desc = EVTDESC_TREASURE_FLEET_22
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_22 # Do so!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				character_event = { id = treasurefleet.23 days = 5 random = 5 } # It goes well
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				character_event = { id = treasurefleet.24 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					intrigue = 12
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_22 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				intrigue = 12
			}
		}
	}
}

# Got good information
character_event = {
	id = treasurefleet.23
	desc = EVTDESC_TREASURE_FLEET_23
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_23 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_army_strength
					value = 5
				}
				change_variable = {
					which = treasure_fleet_ship_strength
					value = 5
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Got bad information
character_event = {
	id = treasurefleet.24
	desc = EVTDESC_TREASURE_FLEET_24
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_24 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Consult books - Learning

# Consult books?
character_event = {
	id = treasurefleet.25
	desc = EVTDESC_TREASURE_FLEET_25
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_25 # Do so!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					learning = 28
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 16
				}
				character_event = { id = treasurefleet.26 days = 5 random = 5 } # It goes well
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						learning = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				character_event = { id = treasurefleet.27 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					learning = 12
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_25 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				learning = 12
			}
		}
	}
}

# Found good information
character_event = {
	id = treasurefleet.26
	desc = EVTDESC_TREASURE_FLEET_26
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_26 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				if = {
					limit = {
						has_dlc = "Jade Dragon"
					}
					add_one_of_each_jd_character_effect = yes
				}
				else = {
					random_list = {
						1 = {
							add_random_number_of_soldiers_effect = yes
						}
						1 = {
							add_random_number_of_eunuchs_effect = yes
						}
						1 = {
							add_random_number_of_courtesans_effect = yes
						}
						1 = {
							add_random_number_of_scholars_effect = yes
						}
						1 = {
							add_random_number_of_nobles_effect = yes
						}
					}
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Found bad information
character_event = {
	id = treasurefleet.27
	desc = EVTDESC_TREASURE_FLEET_27
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_27 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Try to make AI subjects join

# Vassal/sub-vassal might ask to join
character_event = {
	id = treasurefleet.28
	desc = EVTDESC_TREASURE_FLEET_28
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_28 # I'll join!
		
		add_character_modifier = {
			modifier = tf_join_request
			months = 1
		}
		
		if = {
			limit = {
				e_china = {
					holder_scope = {
						owes_favor_to = ROOT
					}
				}
			}
			character_event = { id = treasurefleet.29 } # Call in Favor?
		}
		else = {
			e_china = {
				holder_scope = {
					letter_event = { id = treasurefleet.31 } # EoC gets the request
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				in_faction = yes
			}
			modifier = {
				factor = 0.01
				leads_faction = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_28 # Nah
		
		ai_chance = {
			factor = 100
		}
	}
}

# Asking to join from decision or event - use Favor or not?
character_event = {
	id = treasurefleet.29
	desc = EVTDESC_TREASURE_FLEET_29
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_29 # Call in Favor!
		
		remove_character_modifier = tf_join_request
		add_trait = treasure_fleet_preparation
		
		e_china = {
			holder_scope = {
				reverse_remove_favor = ROOT
				letter_event = { id = treasurefleet.30 } # Notify EoC
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_28 # Nah
		
		e_china = {
			holder_scope = {
				letter_event = { id = treasurefleet.31 } # EoC gets non-Favor request
			}
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

### Vassal calls in Favor to join

# EoC notified
letter_event = {
	id = treasurefleet.30
	desc = EVTDESC_TREASURE_FLEET_30
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_30 # Very well...
	}
}

### Vassal asks to join - normal

# EoC gets to accept, refuse, or offer a deal
letter_event = {
	id = treasurefleet.31
	desc = EVTDESC_TREASURE_FLEET_31
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_31 # Very well...
		
		FROM = {
			letter_event = { id = treasurefleet.32 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				any_rival = {
					character = FROM
				}
			}
			modifier = {
				factor = 0.01
				NOR = {
					dynasty = FROM
					any_close_relative = {
						character = FROM
					}
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_31 # You'll have to pay me
		
		FROM = {
			letter_event = { id = treasurefleet.33 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_dlc = "Conclave"
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			owes_favor_to = FROM
		}
		name = EVTOPTC_TREASURE_FLEET_31 # If we call it a Favor...
		
		FROM = {
			letter_event = { id = treasurefleet.36 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			NOR = {
				owes_favor_to = FROM
				FROM = {
					owes_favor_to = ROOT
				}
			}
		}
		name = EVTOPTD_TREASURE_FLEET_31 # If we call it a Favor...
		
		FROM = {
			letter_event = { id = treasurefleet.39 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			NOR = {
				owes_favor_to = FROM
				FROM = {
					owes_favor_to = ROOT
				}
			}
		}
		name = EVTOPTE_TREASURE_FLEET_31 # I don't think so!
		
		FROM = {
			letter_event = { id = treasurefleet.42 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					any_rival = {
						character = FROM
					}
				}
			}
			modifier = {
				factor = 10
				any_rival = {
					character = FROM
				}
			}
			modifier = {
				factor = 0.01
				OR = {
					dynasty = FROM
					any_close_relative = {
						character = FROM
					}
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
		}
	}
}

# Request approved
letter_event = {
	id = treasurefleet.32
	desc = EVTDESC_TREASURE_FLEET_32
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_32 # Great!
		
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = no
				}
			}
			add_trait = treasure_fleet_preparation
		}
		else = { # The fleet left just as the request arrived
			add_trait = treasure_fleet_voyage
			set_character_flag = do_not_disturb
		}
		
		remove_character_modifier = tf_join_request
	}
}

# Deal - pay the EoC?
letter_event = {
	id = treasurefleet.33
	desc = EVTDESC_TREASURE_FLEET_33
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_33 # Sure!
		
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = no
				}
			}
			add_trait = treasure_fleet_preparation
		}
		else = { # The fleet left just as the request arrived
			add_trait = treasure_fleet_voyage
			set_character_flag = do_not_disturb
		}
		
		remove_character_modifier = tf_join_request
		wealth = -100
		
		FROM = {
			wealth = 100
			letter_event = { id = treasurefleet.34 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOT = {
					wealth = 100
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_33 # No!
		
		remove_character_modifier = tf_join_request
		
		FROM = {
			letter_event = { id = treasurefleet.35 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = treasurefleet.34
	desc = EVTDESC_TREASURE_FLEET_34
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_34 # Great!
	}
}

# Offer refused
letter_event = {
	id = treasurefleet.35
	desc = EVTDESC_TREASURE_FLEET_35
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_35 # I see...
	}
}

# Deal - I'll consider it a Favor (calls in Favor owed *by* the EoC)
letter_event = {
	id = treasurefleet.36
	desc = EVTDESC_TREASURE_FLEET_36
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_36 # Sure!
		
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = no
				}
			}
			add_trait = treasure_fleet_preparation
		}
		else = { # The fleet left just as the request arrived
			add_trait = treasure_fleet_voyage
			set_character_flag = do_not_disturb
		}
		
		remove_character_modifier = tf_join_request
		FROM = {
			reverse_remove_favor  = ROOT
			letter_event = { id = treasurefleet.37 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_36 # No!
		
		remove_character_modifier = tf_join_request
		
		FROM = {
			letter_event = { id = treasurefleet.38 } # Inform FROM
		}
	}
}

# Offer accepted
letter_event = {
	id = treasurefleet.37
	desc = EVTDESC_TREASURE_FLEET_37
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_37 # Great!
	}
}

# Offer refused
letter_event = {
	id = treasurefleet.38
	desc = EVTDESC_TREASURE_FLEET_38
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_38 # I see...
	}
}

# Deal - EoC demands a Favor
letter_event = {
	id = treasurefleet.39
	desc = EVTDESC_TREASURE_FLEET_39
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_39 # Sure!
		
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = no
				}
			}
			add_trait = treasure_fleet_preparation
		}
		else = { # The fleet left just as the request arrived
			add_trait = treasure_fleet_voyage
			set_character_flag = do_not_disturb
		}
		
		remove_character_modifier = tf_join_request
		FROM = {
			add_favor = ROOT
			letter_event = { id = treasurefleet.40 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_39 # No!
		
		remove_character_modifier = tf_join_request
		
		FROM = {
			letter_event = { id = treasurefleet.41 } # Inform FROM
		}
	}
}

# Offer accepted
letter_event = {
	id = treasurefleet.40
	desc = EVTDESC_TREASURE_FLEET_40
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_40 # Great!
	}
}

# Offer refused
letter_event = {
	id = treasurefleet.41
	desc = EVTDESC_TREASURE_FLEET_41
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_41 # I see...
	}
}

# Request denied
letter_event = {
	id = treasurefleet.42
	desc = EVTDESC_TREASURE_FLEET_42
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_42 # I see...
		
		remove_character_modifier = tf_join_request
		add_character_modifier = {
			modifier = tf_joining_refused
			months = 12
		}
		
		prestige = -25
	}
}

### Foreign shipwrights

# Offer is made
character_event = {
	id = treasurefleet.43
	desc = EVTDESC_TREASURE_FLEET_43
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_43 # Do so!
		
		wealth = -500
		
		random_list = {
			50 = {
				character_event = { id = treasurefleet.44 days = 5 random = 5 } # It goes well
			}
			50 = {
				character_event = { id = treasurefleet.45 days = 5 random = 5 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOT = {
					wealth = 500
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_43 # Nah
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 0.1
				NOT = {
					wealth = 500
				}
			}
		}
	}
}

# They were helpful
character_event = {
	id = treasurefleet.44
	desc = EVTDESC_TREASURE_FLEET_44
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_44 # Great!
		
		prestige = 100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_ship_strength
					value = 10
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# They were unhelpful
character_event = {
	id = treasurefleet.45
	desc = EVTDESC_TREASURE_FLEET_45
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_45 # Curses!
		
		prestige = -100
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -10
				}
				random_list = {
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

### Tributary might offer to support the endeavor

# Tributary gets the opportunity to make an offer
character_event = {
	id = treasurefleet.46
	desc = EVTDESC_TREASURE_FLEET_46
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			has_dlc = "Jade Dragon"
			has_game_rule = {
				name = grace_interactions
				value = enabled
			}
			e_china = {
				holder_scope = {
					is_blocking_all_boons_trigger = no
				}
			}
			china_hates_root_trigger = no
		}
		
		name = EVTOPTA_TREASURE_FLEET_46 # I want Grace!
		
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.47 days = 1 } # Inform the EoC
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_46 # I want a looser relationship!
		
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.50 days = 1 } # Inform the EoC
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTC_TREASURE_FLEET_46 # Nah
		
		ai_chance = {
			factor = 100
		}
	}
}

# Offer made - want Grace
character_event = {
	id = treasurefleet.47
	desc = EVTDESC_TREASURE_FLEET_47
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_47 # Very well...
		
		FROM = {
			letter_event = { id = treasurefleet.48 } # Inform FROM
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = tf_supplies
					value = 5
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_47 # Nah
		
		prestige = -100
		
		FROM = {
			letter_event = { id = treasurefleet.49 } # Inform FROM
		}
	}
}

# Offer accepted
letter_event = {
	id = treasurefleet.48
	desc = EVTDESC_TREASURE_FLEET_48
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_48 # Great!
		
		wealth = -100
		
		add_grace_massive_effect = yes
	}
}

# Offer refused
letter_event = {
	id = treasurefleet.49
	desc = EVTDESC_TREASURE_FLEET_49
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_49 # I see...
	}
}

# Offer made - want a looser relationship
character_event = {
	id = treasurefleet.50
	desc = EVTDESC_TREASURE_FLEET_50
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_50 # Very well...
		
		FROM = {
			letter_event = { id = treasurefleet.51 } # Inform FROM
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = tf_supplies
					value = 5
				}
				random_list = {
					90 = {
						add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						add_or_boost_everything_permissible_effect = yes
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
			}
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_protectorate
				}
			}
			modifier = {
				factor = 0.01
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_50 # Nah
		
		prestige = -100
		
		FROM = {
			letter_event = { id = treasurefleet.52 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Offer accepted
letter_event = {
	id = treasurefleet.51
	desc = EVTDESC_TREASURE_FLEET_51
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_51 # Great!
		
		wealth = -100
		
		decrease_tributary_tier_or_release_effect = yes
	}
}

# Offer refused
letter_event = {
	id = treasurefleet.52
	desc = EVTDESC_TREASURE_FLEET_52
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_52 # I see...
	}
}

### DW sabotage

# Cultist gets the opportunity to try
character_event = {
	id = treasurefleet.53
	desc = EVTDESC_TREASURE_FLEET_53
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_53 # Yes!
		
		detract_society_currency_major_effect = yes
		
		random = {
			chance = 25
			increase_visibility_effect = yes
		}
		
		random_list = {
			25 = {
				modifier = {
					factor = 2
					intrigue = 50
				}
				modifier = {
					factor = 2
					intrigue = 45
				}
				modifier = {
					factor = 2
					intrigue = 40
				}
				modifier = {
					factor = 2
					intrigue = 35
				}
				modifier = {
					factor = 2
					intrigue = 30
				}
				modifier = {
					factor = 2
					intrigue = 25
				}
				modifier = {
					factor = 0
					has_character_modifier = known_satanist
				}
				character_event = { id = treasurefleet.54 days = 1 } # Success
			}
			25 = {
				modifier = {
					factor = 2
					intrigue = 50
				}
				modifier = {
					factor = 2
					intrigue = 45
				}
				modifier = {
					factor = 2
					intrigue = 40
				}
				modifier = {
					factor = 2
					intrigue = 35
				}
				modifier = {
					factor = 2
					intrigue = 30
				}
				modifier = {
					factor = 2
					intrigue = 25
				}
				modifier = {
					factor = 0
					NOT = {
						has_character_modifier = known_satanist
					}
				}
				character_event = { id = treasurefleet.56 days = 1 } # Success, but caught
			}
			25 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				modifier = {
					factor = 0
					has_character_modifier = known_satanist
				}
				character_event = { id = treasurefleet.58 days = 1 } # Failure
			}
			25 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				modifier = {
					factor = 0
					NOT = {
						has_character_modifier = known_satanist
					}
				}
				character_event = { id = treasurefleet.60 days = 1 } # Failure, and caught
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_53 # No!
		
		prestige = -100
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = treasure_fleet_preparation
			}
		}
	}
}

# Sabotage successful
character_event = {
	id = treasurefleet.54
	desc = EVTDESC_TREASURE_FLEET_54
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_54 # Praise the dark powers!
		
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.55 } # Inform the EoC
			}
		}
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.55
	desc = EVTDESC_TREASURE_FLEET_55
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_55 # Who could have done this?
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -10
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					90 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Sabotage successful, but got caught
character_event = {
	id = treasurefleet.56
	desc = EVTDESC_TREASURE_FLEET_56
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_56 # Not quite what I wanted...
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			detract_grace_super_huge_effect = yes
		}
		
		e_china = {
			holder_scope = {
				FROM = {
					imprison = PREV
				}
				character_event = { id = treasurefleet.57 } # Inform the EoC
			}
		}
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.57
	desc = EVTDESC_TREASURE_FLEET_57
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_57 # At least we caught the perpetrator!
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -5
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					90 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
		}
	}
}

# Sabotage fails
character_event = {
	id = treasurefleet.58
	desc = EVTDESC_TREASURE_FLEET_58
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_58 # At least I got away...
		
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.59 } # Inform the EoC
			}
		}
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.59
	desc = EVTDESC_TREASURE_FLEET_59
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_59 # Who could have done this?
	}
}

# Sabotage fails, and got caught
character_event = {
	id = treasurefleet.60
	desc = EVTDESC_TREASURE_FLEET_60
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_60 # That went poorly...
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
				is_chinese_emperor_trigger = no
			}
			detract_grace_super_huge_effect = yes
		}
		
		e_china = {
			holder_scope = {
				FROM = {
					imprison = PREV
				}
				character_event = { id = treasurefleet.61 } # Inform the EoC
			}
		}
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.61
	desc = EVTDESC_TREASURE_FLEET_61
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_61 # That could have been bad...
	}
}

### Council Eunuch might get involved

# Council Eunuch gets to decide
character_event = {
	id = treasurefleet.62
	desc = EVTDESC_TREASURE_FLEET_62
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_62 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					diplomacy = 28
				}
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 16
				}
				modifier = {
					factor = 2
					martial = 28
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 16
				}
				modifier = {
					factor = 2
					stewardship = 28
				}
				modifier = {
					factor = 2
					stewardship = 24
				}
				modifier = {
					factor = 2
					stewardship = 16
				}
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				modifier = {
					factor = 2
					learning = 28
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = tf_immigrants
							value = 5
						}
						random_list = {
							1 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							90 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.63 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = tf_immigrants
							value = -5
						}
						random_list = {
							1 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							90 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.64 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_62 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.63
	desc = EVTDESC_TREASURE_FLEET_63
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_63 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.64
	desc = EVTDESC_TREASURE_FLEET_64
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_64 # I see...
	}
}

### Chancellor might help (Diplomacy)

# Chancellor gets event
character_event = {
	id = treasurefleet.65
	desc = EVTDESC_TREASURE_FLEET_65
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_65 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					diplomacy = 28
				}
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_ship_strength
							value = 10
						}
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.66 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_ship_strength
							value = -10
						}
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.67 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_65 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.66
	desc = EVTDESC_TREASURE_FLEET_66
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_66 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.67
	desc = EVTDESC_TREASURE_FLEET_67
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_67 # I see...
	}
}

### Marshal might help (Martial)

# Marshal gets event
character_event = {
	id = treasurefleet.68
	desc = EVTDESC_TREASURE_FLEET_68
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_68 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					martial = 28
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_army_strength
							value = 10
						}
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.69 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_army_strength
							value = -10
						}
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.70 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_68 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.69
	desc = EVTDESC_TREASURE_FLEET_69
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_69 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.70
	desc = EVTDESC_TREASURE_FLEET_70
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_70 # I see...
	}
}

### Steward might help (Stewardship)

# Steward gets event
character_event = {
	id = treasurefleet.71
	desc = EVTDESC_TREASURE_FLEET_71
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_71 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					stewardship = 28
				}
				modifier = {
					factor = 2
					stewardship = 24
				}
				modifier = {
					factor = 2
					stewardship = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_wealth
							value = 10
						}
						if = {
							limit = {
								has_dlc = "Jade Dragon"
							}
							random_list = {
								1 = {
									add_random_t1_jd_artifact_effect = yes
								}
								1 = {
									add_random_t2_jd_artifact_effect = yes
								}
								1 = {
									add_random_t3_jd_artifact_effect = yes
								}
								1 = {
									add_random_t4_jd_artifact_effect = yes
								}
								1 = {
									add_random_t5_jd_artifact_effect = yes
								}
								1 = {
									add_random_jd_modifier_effect = yes
								}
							}
						}
						else = {
							add_random_number_of_art_of_war_pages_effect = yes
						}
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.72 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						stewardship = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_wealth
							value = -10
						}
						if = {
							limit = {
								has_dlc = "Jade Dragon"
							}
							random_list = {
								1 = {
									remove_random_t1_jd_artifact_effect = yes
								}
								1 = {
									remove_random_t2_jd_artifact_effect = yes
								}
								1 = {
									remove_random_t3_jd_artifact_effect = yes
								}
								1 = {
									remove_random_t4_jd_artifact_effect = yes
								}
								1 = {
									remove_random_t5_jd_artifact_effect = yes
								}
								1 = {
									remove_random_jd_modifier_effect = yes
								}
							}
						}
						else = {
							remove_random_number_of_art_of_war_pages_effect = yes
						}
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.73 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_71 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.72
	desc = EVTDESC_TREASURE_FLEET_72
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_72 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.73
	desc = EVTDESC_TREASURE_FLEET_73
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_73 # I see...
	}
}

### Spymaster might help (Intrigue)

# Spymaster gets event
character_event = {
	id = treasurefleet.74
	desc = EVTDESC_TREASURE_FLEET_74
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_74 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_army_strength
							value = 5
						}
						change_variable = {
							which = treasure_fleet_ship_strength
							value = 5
						}
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.75 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						change_variable = {
							which = treasure_fleet_army_strength
							value = -5
						}
						change_variable = {
							which = treasure_fleet_ship_strength
							value = -5
						}
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.76 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_74 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.75
	desc = EVTDESC_TREASURE_FLEET_75
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_75 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.76
	desc = EVTDESC_TREASURE_FLEET_76
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_76 # I see...
	}
}

### Chaplain might help (Learning)

# Chaplain gets event
character_event = {
	id = treasurefleet.77
	desc = EVTDESC_TREASURE_FLEET_77
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_77 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					learning = 28
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						if = {
							limit = {
								has_dlc = "Jade Dragon"
							}
							add_one_of_each_jd_character_effect = yes
						}
						else = {
							random_list = {
								1 = {
									add_random_number_of_soldiers_effect = yes
								}
								1 = {
									add_random_number_of_eunuchs_effect = yes
								}
								1 = {
									add_random_number_of_courtesans_effect = yes
								}
								1 = {
									add_random_number_of_scholars_effect = yes
								}
								1 = {
									add_random_number_of_nobles_effect = yes
								}
							}
						}
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.78 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						learning = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						if = {
							limit = {
								has_dlc = "Jade Dragon"
							}
							remove_one_of_each_jd_character_effect = yes
						}
						else = {
							random_list = {
								1 = {
									remove_random_number_of_soldiers_effect = yes
								}
								1 = {
									remove_random_number_of_eunuchs_effect = yes
								}
								1 = {
									remove_random_number_of_courtesans_effect = yes
								}
								1 = {
									remove_random_number_of_scholars_effect = yes
								}
								1 = {
									remove_random_number_of_nobles_effect = yes
								}
							}
						}
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.79 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_62 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.78
	desc = EVTDESC_TREASURE_FLEET_78
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_78 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.79
	desc = EVTDESC_TREASURE_FLEET_79
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_79 # I see...
	}
}

### Advisor might help - all stats might help or hinder

# Random stat help?
character_event = {
	id = treasurefleet.80
	desc = EVTDESC_TREASURE_FLEET_80
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_80 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					diplomacy = 28
				}
				modifier = {
					factor = 2
					diplomacy = 24
				}
				modifier = {
					factor = 2
					diplomacy = 16
				}
				modifier = {
					factor = 2
					martial = 28
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 16
				}
				modifier = {
					factor = 2
					stewardship = 28
				}
				modifier = {
					factor = 2
					stewardship = 24
				}
				modifier = {
					factor = 2
					stewardship = 16
				}
				modifier = {
					factor = 2
					intrigue = 28
				}
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				modifier = {
					factor = 2
					learning = 28
				}
				modifier = {
					factor = 2
					learning = 24
				}
				modifier = {
					factor = 2
					learning = 16
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						add_random_people_to_treasure_fleet_effect = yes
						random_list = {
							90 = {
								add_or_boost_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								add_or_boost_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								add_or_boost_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.81 days = 5 random = 5 } # It goes well
					}
				}
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						stewardship = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				hidden_tooltip = {
					2753 = { # Hangzhou
						remove_random_people_from_treasure_fleet_effect = yes
						random_list = {
							90 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
							}
							9 = {
								remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
							}
							1 = {
								remove_or_weaken_everything_permissible_effect = yes
							}
						}
					}
					liege = {
						character_event = { id = treasurefleet.82 days = 5 random = 5 } # It goes poorly
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_80 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = liege
					value = 25
				}
			}
		}
	}
}

# It went well
character_event = {
	id = treasurefleet.81
	desc = EVTDESC_TREASURE_FLEET_81
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_81 # Great!
	}
}

# It went poorly
character_event = {
	id = treasurefleet.82
	desc = EVTDESC_TREASURE_FLEET_82
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_82 # I see...
	}
}

##### Departure + general progress check

### Departure

# Treasure Fleet is ready - all aboard!
character_event = {
	id = treasurefleet.83
	desc = EVTDESC_TREASURE_FLEET_83
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_83 # All aboard!
		
		remove_trait = treasure_fleet_preparation
		set_global_flag = treasure_fleet_is_active
		
		activate_title = {
			title = d_treasure_fleet
			status = yes
		}
		
		if = {
			limit = {
				FROM = {
					persistent_event_target:treasure_fleet_commander = {
						is_alive = yes
						is_inaccessible_or_incapable_trigger = no
						is_landed = no
					}
				}
			}
			FROM = {
				persistent_event_target:treasure_fleet_commander = {
					grant_title = d_treasure_fleet
					set_defacto_liege = THIS
				}
			}
		}
		else = {
			create_new_court_eunuch_effect = yes
			new_character = {
				change_diplomacy = 2
				change_martial = 2
				change_stewardship = 2
				change_intrigue = 2
				change_learning = 2
				save_event_target_as = new_treasure_fleet_commander
				FROM = {
					save_persistent_event_target = { name = treasure_fleet_commander scope = event_target:new_treasure_fleet_commander }
				}
				grant_title = d_treasure_fleet
				set_defacto_liege = THIS
 			}
		}
		
		hidden_tooltip = {
			any_realm_lord = {
				limit = {
					trait = treasure_fleet_preparation
				}
				set_character_flag = do_not_disturb
				if = {
					limit = {
						ai = no
					}
					character_event = { id = treasurefleet.84 }
				}
				else = {
					remove_trait = treasure_fleet_preparation
					add_trait = treasure_fleet_voyage
				}
			}
			FROM = {
				province_event = { id = treasurefleet.85 days = 1 } # Departure
			}
		}
	}
}

# Inform vassals that are joining
character_event = {
	id = treasurefleet.84
	desc = EVTDESC_TREASURE_FLEET_84
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_84 # All aboard!
		
		remove_trait = treasure_fleet_preparation
		add_trait = treasure_fleet_voyage
	}
}

# Check to see how it goes
province_event = {
	id = treasurefleet.85
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			95 = {
				# Uneventful
				e_china = {
					holder_scope = {
						narrative_event = { id = treasurefleet.86 }
						any_realm_lord = {
							limit = {
								ai = no
								NOT = {
									trait = treasure_fleet_voyage
								}
							}
							narrative_event = { id = treasurefleet.88 }
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						narrative_event = { id = treasurefleet.87 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								ai = no
								trait = treasure_fleet_voyage
							}
							narrative_event = { id = treasurefleet.87 }
						}
					}
				}
				any_player = {
					limit = {
						NOR = {
							has_landed_title = e_china
							trait = treasure_fleet_voyage
							any_liege = {
								has_landed_title = e_china
							}
						}
					}
					character_event = { id = treasurefleet.89 }
				}
				set_province_flag = treasure_fleet_voyage_flag
				random_list = {
					10 = {
						set_province_flag = treasure_fleet_going_to_korea
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_japan
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_ryukyu
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_maynila
					}
					60 = {
						set_province_flag = treasure_fleet_going_to_champa
					}
				}
				province_event = { id = treasurefleet.102 days = 15 } # Progress check
			}
			3 = {
				modifier = {
					factor = 0
					has_game_rule = {
						name = supernatural_events
						value = off
					}
				}
				modifier = {
					factor = 0
					has_game_rule = {
						name = supernatural_events
						value = on
					}
					NOT = {
						any_player = {
							OR = {
								is_chinese_emperor_trigger = yes
								trait = treasure_fleet_voyage
							}
						}
					}
				}
				# Celestial dragon
				e_china = {
					holder_scope = {
						narrative_event = { id = treasurefleet.90 }
						any_realm_lord = {
							limit = {
								ai = no
								NOT = {
									trait = treasure_fleet_voyage
								}
							}
							narrative_event = { id = treasurefleet.92 }
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						narrative_event = { id = treasurefleet.91 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								ai = no
								trait = treasure_fleet_voyage
							}
							narrative_event = { id = treasurefleet.91 }
						}
					}
				}
				any_player = {
					limit = {
						NOR = {
							has_landed_title = e_china
							trait = treasure_fleet_voyage
							any_liege = {
								has_landed_title = e_china
							}
						}
					}
					character_event = { id = treasurefleet.93 }
				}
				set_province_flag = treasure_fleet_voyage_flag
				random_list = {
					10 = {
						set_province_flag = treasure_fleet_going_to_korea
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_japan
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_ryukyu
					}
					10 = {
						set_province_flag = treasure_fleet_going_to_maynila
					}
					60 = {
						set_province_flag = treasure_fleet_going_to_champa
					}
				}
				province_event = { id = treasurefleet.102 days = 15 } # Progress check
			}
			1 = {
				modifier = {
					factor = 0
					NAND = {
						has_global_flag = first_dragon_attack
						NOR = {
							has_global_flag = dragon_injured
							has_global_flag = ongoing_dragon_attack
							has_global_flag = dragon_slain
							has_global_flag = ongoing_dragonslaying_attempt
						}
					}
				}
				modifier = {
					factor = 0
					has_game_rule = {
						name = supernatural_events
						value = off
					}
				}
				modifier = {
					factor = 0
					has_game_rule = {
						name = supernatural_events
						value = on
					}
					NOT = {
						any_player = {
							OR = {
								is_chinese_emperor_trigger = yes
								trait = treasure_fleet_voyage
							}
						}
					}
				}
				# Red dragon
				e_china = {
					holder_scope = {
						narrative_event = { id = treasurefleet.94 }
						any_realm_lord = {
							limit = {
								ai = no
								NOT = {
									trait = treasure_fleet_voyage
								}
							}
							narrative_event = { id = treasurefleet.96 }
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						narrative_event = { id = treasurefleet.95 }
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								ai = no
								trait = treasure_fleet_voyage
							}
							narrative_event = { id = treasurefleet.95 }
						}
					}
				}
				any_player = {
					limit = {
						NOR = {
							has_landed_title = e_china
							trait = treasure_fleet_voyage
							any_liege = {
								has_landed_title = e_china
							}
						}
					}
					character_event = { id = treasurefleet.97 }
				}
			}
			1 = {
				# Fleet sinks in the harbour
				e_china = {
					holder_scope = {
						narrative_event = { id = treasurefleet.98 }
						any_realm_lord = {
							limit = {
								ai = no
								NOT = {
									trait = treasure_fleet_voyage
								}
							}
							narrative_event = { id = treasurefleet.100 }
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						narrative_event = { id = treasurefleet.99 }
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								ai = no
								trait = treasure_fleet_voyage
							}
							narrative_event = { id = treasurefleet.99 }
						}
					}
				}
				any_player = {
					limit = {
						NOR = {
							has_landed_title = e_china
							trait = treasure_fleet_voyage
							any_liege = {
								has_landed_title = e_china
							}
						}
					}
					character_event = { id = treasurefleet.101 }
				}
			}
		}
	}
}

# Departure is uneventful
narrative_event = {
	id = treasurefleet.86
	title = EVTTITLE_TREASURE_FLEET_86
	desc = EVTDESC_TREASURE_FLEET_86
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_86 # Auspicious!
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = 1000
			}
		}
	}
}

# Departure is uneventful - inform people that joined
narrative_event = {
	id = treasurefleet.87
	title = EVTTITLE_TREASURE_FLEET_87
	desc = EVTDESC_TREASURE_FLEET_87
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_87 # Auspicious!
		
		prestige = 25
	}
}

# Departure is uneventful - inform other vassals
narrative_event = {
	id = treasurefleet.88
	title = EVTTITLE_TREASURE_FLEET_88
	desc = EVTDESC_TREASURE_FLEET_88
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_88 # Auspicious!
	}
}

# Departure is uneventful - inform the world
character_event = {
	id = treasurefleet.89
	desc = EVTDESC_TREASURE_FLEET_89
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			any_realm_province = {
				port = yes
				can_naval_path_to = c_hangzhou
			}
		}
		name = EVTOPTA_TREASURE_FLEET_89 # Interesting...
	}
	
	option = {
		trigger = {
			NOT = {
				any_realm_province = {
					port = yes
					can_naval_path_to = c_hangzhou
				}
			}
		}
		name = EVTOPTB_TREASURE_FLEET_89 # I don't care!
	}
}

# Celestial dragon at departure
narrative_event = {
	id = treasurefleet.90
	title = EVTTITLE_TREASURE_FLEET_90
	desc = EVTDESC_TREASURE_FLEET_90
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_90 # Most auspicious!
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = 5000
			}
		}
	}
}

# Celestial dragon at departure - inform people that joined
narrative_event = {
	id = treasurefleet.91
	title = EVTTITLE_TREASURE_FLEET_91
	desc = EVTDESC_TREASURE_FLEET_91
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_91 # Most auspicious!
		
		prestige = 50
	}
}

# Celestial dragon at departure - inform other vassals
narrative_event = {
	id = treasurefleet.92
	title = EVTTITLE_TREASURE_FLEET_92
	desc = EVTDESC_TREASURE_FLEET_92
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_92 # Most auspicious!
	}
}

# Celestial dragon at departure - inform the world
character_event = {
	id = treasurefleet.93
	desc = EVTDESC_TREASURE_FLEET_93
	picture = GFX_evt_chinese_mythology
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			any_realm_province = {
				port = yes
				can_naval_path_to = c_hangzhou
			}
		}
		name = EVTOPTA_TREASURE_FLEET_93 # Interesting...
	}
	
	option = {
		trigger = {
			NOT = {
				any_realm_province = {
					port = yes
					can_naval_path_to = c_hangzhou
				}
			}
		}
		name = EVTOPTB_TREASURE_FLEET_93 # I don't care!
	}
}

# Red dragon burns the fleet at departure
narrative_event = {
	id = treasurefleet.94
	title = EVTTITLE_TREASURE_FLEET_94
	desc = EVTDESC_TREASURE_FLEET_94
	picture = GFX_evt_burning_man_hf
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_94 # Most inauspicious!
		
		prestige = -100
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
		FROM = {
			clean_up_old_treasure_fleet_effect = yes
		}
	}
}

# Red dragon burns the fleet at departure - inform people that joined
narrative_event = {
	id = treasurefleet.95
	title = EVTTITLE_TREASURE_FLEET_95
	desc = EVTDESC_TREASURE_FLEET_95
	picture = GFX_evt_burning_man_hf
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_95 # Aargh!
		
		remove_trait = treasure_fleet_voyage
		clr_character_flag = do_not_disturb
		
		death = {
			death_reason = death_evil_dragon
		}
	}
}

# Red dragon burns the fleet at departure - inform other vassals
narrative_event = {
	id = treasurefleet.96
	title = EVTTITLE_TREASURE_FLEET_96
	desc = EVTDESC_TREASURE_FLEET_96
	picture = GFX_evt_burning_man_hf
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_96 # Most inauspicious!
	}
}

# Red dragon burns the fleet at departure - inform the world
character_event = {
	id = treasurefleet.97
	desc = EVTDESC_TREASURE_FLEET_97
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_97 # So much for that...
	}
}

# Fleet sinks in the harbour
narrative_event = {
	id = treasurefleet.98
	title = EVTTITLE_TREASURE_FLEET_98
	desc = EVTDESC_TREASURE_FLEET_98
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_98 # Most inauspicious!
		
		prestige = -100
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
		
		FROM = {
			clean_up_old_treasure_fleet_effect = yes
		}
	}
}

# Fleet sinks in the harbour - inform people that joined
narrative_event = {
	id = treasurefleet.99
	title = EVTTITLE_TREASURE_FLEET_99
	desc = EVTDESC_TREASURE_FLEET_99
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_99 # I must swim to safety!
		
		remove_trait = treasure_fleet_voyage
		clr_character_flag = do_not_disturb
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Fleet sinks in the harbour - inform other vassals
narrative_event = {
	id = treasurefleet.100
	title = EVTTITLE_TREASURE_FLEET_100
	desc = EVTDESC_TREASURE_FLEET_100
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_100 # Most inauspicious!
	}
}

# Fleet sinks in the harbour - inform the world
character_event = {
	id = treasurefleet.101
	desc = EVTDESC_TREASURE_FLEET_101
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_101 # So much for that...
	}
}

### Progress check + maintenance for the title and treasure_fleet_voyage

# Check which chain to go to next - handled in a province!
province_event = {
	id = treasurefleet.102
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			if = {
				limit = {
					NOT = {
						top_liege = {
							has_landed_title = e_china
						}
					}
				}
				remove_trait = treasure_fleet_voyage
				clr_character_flag = do_not_disturb
			}
		}
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = yes
				}
			}
			if = { # First check if we should cancel the TF voyage
				limit = {
					OR = {
						has_province_flag = abort_treasure_fleet_asap
						e_china = {
							has_holder = no
						}
						e_china = {
							holder_scope = {
								is_chinese_emperor_trigger = no
							}
						}
					}
				}
				any_playable_ruler = {
					any_war = {
						limit = {
							OR = {
								using_cb = treasure_fleet_tributary_war
								using_cb = punitive_expedition
							}
						}
						end_war = invalid
					}
				}
				abort_treasure_fleet_for_everyone_effect = yes
			}
			else = {
				random_list = {
					10 = {
						change_variable = {
							which = tf_supplies
							value = -1
						}
					}
					10 = {
						change_variable = {
							which = tf_supplies
							value = -2
						}
					}
					10 = {
						modifier = {
							factor = 0.5
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 10
								}
							}
						}
						modifier = {
							factor = 0.1
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 5
								}
							}
						}
						change_variable = {
							which = tf_supplies
							value = -3
						}
					}
					10 = {
						modifier = {
							factor = 0.5
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 10
								}
							}
						}
						modifier = {
							factor = 0
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 5
								}
							}
						}
						change_variable = {
							which = tf_supplies
							value = -4
						}
					}
					10 = {
						modifier = {
							factor = 0.5
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 20
								}
							}
						}
						modifier = {
							factor = 0.1
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 10
								}
							}
						}
						modifier = {
							factor = 0
							NOT = {
								check_variable = {
									which = tf_supplies
									value = 5
								}
							}
						}
						change_variable = {
							which = tf_supplies
							value = -2
						}
					}
				}
				if = {
					limit = {
						has_province_flag = treasure_fleet_voyage_flag
					}
					province_event = { id = treasurefleet.105 } # Journey events
				}
				else_if = {
					limit = {
						has_province_flag = treasure_fleet_port_flag
					}
					province_event = { id = treasurefleet.207 } # Arrival and port events
				}
			}
		}
	}
}

# If the commander dies or got imprisoned by event, spawn a new one on_death
character_event = {
	id = treasurefleet.103
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = d_treasure_fleet
	}
	
	immediate = {
		create_new_court_eunuch_effect = yes
		new_character = {
			change_diplomacy = 2
			change_martial = 2
			change_stewardship = 2
			change_intrigue = 2
			change_learning = 2
			save_event_target_as = new_treasure_fleet_commander
			2753 = { # Hangzhou
				save_persistent_event_target = { name = treasure_fleet_commander scope = event_target:new_treasure_fleet_commander }
			}
			grant_title = d_treasure_fleet
			set_defacto_liege = THIS
		}
		# Make sure that artifacts are kept
		any_artifact = {
			transfer_artifact = {
				from = ROOT
				to = event_target:new_treasure_fleet_commander
			}
		}
		# Make sure that wealth is kept
		transfer_scaled_wealth = {
			from = ROOT
			to = event_target:new_treasure_fleet_commander
			value = all
		}
	}
}

# on_new_holder (and variations) event to remove treasure_fleet_voyage if we gain an empire title
character_event = {
	id = treasurefleet.104
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		tier = emperor
	}
	
	immediate = {
		remove_trait = treasure_fleet_voyage # Shouldn't ever be possessed by an independent rulers
		clr_character_flag = do_not_disturb
	}
}

##### Journey events

### Sub-chain selection

# Journey event selection
province_event = {
	id = treasurefleet.105
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			10 = {
				# Major event - commander gets the event
				d_treasure_fleet = {
					holder_scope = {
						random_list = {
							10 = {
								modifier = {
									factor = 0
									has_game_rule = {
										name = supernatural_events
										value = off
									}
								}
								modifier = {
									factor = 0
									has_game_rule = {
										name = supernatural_events
										value = on
									}
									NOT = {
										any_player = {
											trait = treasure_fleet_voyage
										}
									}
								}
								# Kraken
								character_event = { id = treasurefleet.106 }
							}
							10 = {
								# Storm
								character_event = { id = treasurefleet.120 }
							}
							10 = {
								# Pirate attack
								modifier = {
									factor = 0
									ROOT = {
										has_province_flag = treasure_fleet_sunrise_invasion_flag
									}
								}
								character_event = { id = treasurefleet.186 }
							}
							10 = {
								# Supply ship lost - no need to inform others
								character_event = { id = treasurefleet.199 }
							}
							10 = {
								# Fireworks go off
								character_event = { id = treasurefleet.200 }
							}
						}
					}
				}
			}
			80 = {
				# Minor events - various members can get events (players are always reasonably likely to get something, AI may or may not)
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									ai = no
								}
								random_list = {
									10 = {
										modifier = {
											factor = 2
											trait = cannibal_trait
										}
										# Cannibals
										character_event = { id = treasurefleet.126 }
									}
									10 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# The Eye
										character_event = { id = treasurefleet.119 }
									}
									10 = {
										# Man overboard
										character_event = { id = treasurefleet.132 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
												}
											}
										}
										# Made a friend
										character_event = { id = treasurefleet.139 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
													OR = {
														AND = {
															PREV = {
																is_female = no
																NOT = {
																	trait = homosexual
																}
															}
															is_female = yes
															NOT = {
																trait = homosexual
															}
														}
														AND = {
															PREV = {
																is_female = yes
																NOT = {
																	trait = homosexual
																}
															}
															is_female = no
															NOT = {
																trait = homosexual
															}
														}
														AND = {
															PREV = {
																is_female = yes
																trait = homosexual
															}
															is_female = yes
															trait = homosexual
														}
														AND = {
															PREV = {
																is_female = no
																trait = homosexual
															}
															is_female = no
															trait = homosexual
														}
													}
												}
											}
										}
										# Tumble opportunity
										character_event = { id = treasurefleet.141 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
												}
											}
										}
										# Made a rival
										character_event = { id = treasurefleet.147 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													any_rival = {
														character = PREV
													}
												}
											}
										}
										# Try to arrange an accident for a rival
										character_event = { id = treasurefleet.149 }
									}
									10 = {
										# Dolphins
										character_event = { id = treasurefleet.170 }
									}
									10 = {
										# Sharks
										character_event = { id = treasurefleet.171 }
									}
									10 = {
										# Turtles
										character_event = { id = treasurefleet.172 }
									}
									10 = {
										# Drifting ship
										character_event = { id = treasurefleet.173 }
									}
									10 = {
										# Deserted island
										character_event = { id = treasurefleet.181 }
									}
									10 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# Flying Dutchman
										character_event = { id = treasurefleet.185 }
									}
									10 = {
										modifier = {
											factor = 0
											ROOT = {
												check_variable = {
													which = tf_supplies
													value = 10
												}
											}
										}
										modifier = {
											factor = 0.1
											ROOT = {
												check_variable = {
													which = tf_supplies
													value = 5
												}
											}
										}
										# Food shortage
										character_event = { id = treasurefleet.206 }
									}
									200 = {} # Nothing
								}
							}
							else = {
								random = {
									chance = 10
									random_list = {
										10 = {
											modifier = {
												factor = 2
												trait = cannibal_trait
											}
											# Cannibals
											character_event = { id = treasurefleet.126 days = 5 random = 10 }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# The Eye
											character_event = { id = treasurefleet.119 days = 5 random = 10  }
										}
										10 = {
											# Man overboard
											character_event = { id = treasurefleet.132 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
													}
												}
											}
											# Made a friend
											character_event = { id = treasurefleet.139 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
														OR = {
															AND = {
																PREV = {
																	is_female = no
																	NOT = {
																		trait = homosexual
																	}
																}
																is_female = yes
																NOT = {
																	trait = homosexual
																}
															}
															AND = {
																PREV = {
																	is_female = yes
																	NOT = {
																		trait = homosexual
																	}
																}
																is_female = no
																NOT = {
																	trait = homosexual
																}
															}
															AND = {
																PREV = {
																	is_female = yes
																	trait = homosexual
																}
																is_female = yes
																trait = homosexual
															}
															AND = {
																PREV = {
																	is_female = no
																	trait = homosexual
																}
																is_female = no
																trait = homosexual
															}
														}
													}
												}
											}
											# Tumble opportunity
											character_event = { id = treasurefleet.141 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
													}
												}
											}
											# Made a rival
											character_event = { id = treasurefleet.147 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														any_rival = {
															character = PREV
														}
													}
												}
											}
											# Try to arrange an accident for a rival
											character_event = { id = treasurefleet.149 days = 5 random = 10  }
										}
										10 = {
											# Dolphins
											character_event = { id = treasurefleet.170 days = 5 random = 10  }
										}
										10 = {
											# Sharks
											character_event = { id = treasurefleet.171 days = 5 random = 10  }
										}
										10 = {
											# Turtles
											character_event = { id = treasurefleet.172 days = 5 random = 10  }
										}
										10 = {
											# Drifting ship
											character_event = { id = treasurefleet.173 days = 5 random = 10  }
										}
										10 = {
											# Deserted island
											character_event = { id = treasurefleet.181 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# Flying Dutchman
											character_event = { id = treasurefleet.185 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												ROOT = {
													check_variable = {
														which = tf_supplies
														value = 10
													}
												}
											}
											modifier = {
												factor = 0.1
												ROOT = {
													check_variable = {
														which = tf_supplies
														value = 5
													}
												}
											}
											# Food shortage
											character_event = { id = treasurefleet.206 days = 5 random = 10  }
										}
										200 = {} # Nothing
									}
								}
							}
						}
					}
				}
			}
			10 = {
				# Nothing happens
			}
		}
		if = {
			limit = {
				has_province_flag = treasure_fleet_voyage_flag # Normal voyage
			}
			clr_province_flag = treasure_fleet_voyage_flag
			set_province_flag = treasure_fleet_port_flag
			province_event = { id = treasurefleet.102 days = 15 } # Back to event selection
		}
	}
}

### Kraken

# Kraken attacks ship - inform commander
character_event = {
	id = treasurefleet.106
	desc = EVTDESC_TREASURE_FLEET_106
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_106 # To arms!
		if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							99 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							49 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							24 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 10
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							9 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 5
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							4 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 4
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							3 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 3
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							2 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.107 } # Your ship was attacked!
							}
							1 = {
								character_event = { id = treasurefleet.108 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else = {
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.107 } # Your ship was attacked!
					}
				}
			}
		}
		FROM = {
			province_event = { id = treasurefleet.109 days = 1 } # Calculate the outcome
		}
	}
}

# Kraken attacks ship - inform people on that ship
character_event = {
	id = treasurefleet.107
	desc = EVTDESC_TREASURE_FLEET_107
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_107 # To arms!
		
		set_character_flag = tf_call_to_arms
	}
}

# Kraken attacks ship - inform people on other ships
character_event = {
	id = treasurefleet.108
	desc = EVTDESC_TREASURE_FLEET_108
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_108 # How horrible!
	}
}

# Check outcome
province_event = {
	id = treasurefleet.109
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# First, let's see how strong the TF is
		set_variable = {
			which = tf_fighting_value
			value = 0
		}
		change_variable = {
			which = tf_fighting_value
			which = treasure_fleet_army_strength
		}
		multiply_variable = {
			which = tf_fighting_value
			value = 10
		}
		divide_variable = {
			which = tf_fighting_value
			which = treasure_fleet_ship_strength
		}
		set_variable = {
			which = tf_pcs
			value = 0
		}
		if = {
			limit = {
				is_variable_equal = {
					which = treasure_fleet_ship_strength
					value = 1
				}
			}
			d_treasure_fleet = {
				holder_scope = {
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
						has_character_flag = tf_call_to_arms
					}
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		change_variable = {
			which = tf_fighting_value
			which = tf_pcs
		}
		
		# Then randomize the enemy
		random_list = {
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -500
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -250
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -100
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -50
				}
			}
		}
		
		# Now let's see what the outcome is
		if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value = 2
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -1
				}
				# Ship sinks
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.113 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.114 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.115 }
							}
						}
					}
				}
			}
			else = {
				# Kraken driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.110 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.111 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.112 }
							}
						}
					}
				}
			}
		}
		else = {
			# Special case: The fleet might be lost!
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.116 }
						any_courtier = {
							character_event = { id = treasurefleet.116 }
						}
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							character_event = { id = treasurefleet.116 }
						}
						character_event = { id = treasurefleet.117 }
					}
				}
				any_player = {
					limit = {
						NOR = {
							trait = treasure_fleet_voyage
							has_landed_title = e_china
						}
					}
					character_event = { id = treasurefleet.118 }
				}
				clean_up_old_treasure_fleet_effect = yes
			}
			else = {
				# Kraken driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.110 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.111 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.112 }
							}
						}
					}
				}
			}
		}
	}
}

# Kraken driven off - inform commander
character_event = {
	id = treasurefleet.110
	desc = EVTDESC_TREASURE_FLEET_110
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_110 # Great!
		
		prestige = 100
	}
}

# Kraken driven off - inform people on that ship
character_event = {
	id = treasurefleet.111
	desc = EVTDESC_TREASURE_FLEET_111
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_111 # Great!
		
		prestige = 100
	}
}

# Kraken driven off - inform people on other ships
character_event = {
	id = treasurefleet.112
	desc = EVTDESC_TREASURE_FLEET_112
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_112 # Great!
		
		prestige = 100
	}
}

# Ship destroyed - inform commander
character_event = {
	id = treasurefleet.113
	desc = EVTDESC_TREASURE_FLEET_113
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_113 # Oh, no!
	}
}

# Ship destroyed - inform people on that ship
character_event = {
	id = treasurefleet.114
	desc = EVTDESC_TREASURE_FLEET_114
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_114 # I must swim to safety!
		
		random_list = {
			50 = {}
			50 = {
				add_trait = wounded
			}
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Ship destroyed - inform people on other ships
character_event = {
	id = treasurefleet.115
	desc = EVTDESC_TREASURE_FLEET_115
	picture =GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_115 # Oh, no!
	}
}

# Last ship destroyed - inform all TF people
character_event = {
	id = treasurefleet.116
	desc = EVTDESC_TREASURE_FLEET_116
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_116 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship destroyed - inform the EoC
character_event = {
	id = treasurefleet.117
	desc = EVTDESC_TREASURE_FLEET_117
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_117 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
		
	}
}

# Last ship destroyed - inform the world
character_event = {
	id = treasurefleet.118
	desc = EVTDESC_TREASURE_FLEET_118
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_118 # I see...
	}
}

### The Eye

# We are beheld!
character_event = {
	id = treasurefleet.119
	desc = EVTDESC_TREASURE_FLEET_119
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		
		name = EVTOPTA_TREASURE_FLEET_119 # Is that... an eye?
		
		random = {
			chance = 50
			add_trait = lunatic
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		
		name = EVTOPTB_TREASURE_FLEET_119 # IT SEES US!
		
		prestige = -50
	}
}

### Storm

# Storm - inform commander
character_event = {
	id = treasurefleet.120
	desc = EVTDESC_TREASURE_FLEET_120
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_120 # Grab on to something!
		FROM = {
			random_list = {
				1 = {
					remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
				}
				1 = {
					remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
				}
				1 = {
					remove_or_weaken_everything_permissible_effect = yes
				}
			}
		}
		if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							99 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							45 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							24 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 10
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							9 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 5
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							4 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 4
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							3 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 3
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							2 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.121 } # Your ship sinks
							}
							1 = {
								character_event = { id = treasurefleet.122 } # Other ship sinks
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.121 } # Your ship sinks
					}
				}
			}
		}
		else = {
			# Treasure Fleet lost with all hands
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.123 }
					any_courtier = {
						character_event = { id = treasurefleet.123 }
					}
				}
			}
			activate_title = {
				title = d_treasure_fleet
				status = no
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.123 }
					}
					character_event = { id = treasurefleet.124 }
				}
			}
			any_player = {
				limit = {
					NOR = {
						trait = treasure_fleet_voyage
						has_landed_title = e_china
					}
				}
				character_event = { id = treasurefleet.125 }
			}
			FROM = {
				clean_up_old_treasure_fleet_effect = yes
			}
		}
	}
}

# Your ship sinks - inform people on that ship
character_event = {
	id = treasurefleet.121
	desc = EVTDESC_TREASURE_FLEET_121
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_121 # I must swim to safety!
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Other ship sinks - inform people on other ships
character_event = {
	id = treasurefleet.122
	desc = EVTDESC_TREASURE_FLEET_122
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_122 # Oh, no!
	}
}

# Last ship sinks - inform all TF people
character_event = {
	id = treasurefleet.123
	desc = EVTDESC_TREASURE_FLEET_123
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_123 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship sinks - inform the EoC
character_event = {
	id = treasurefleet.124
	desc = EVTDESC_TREASURE_FLEET_124
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_124 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
	}
}

# Last ship sinks - inform the world
character_event = {
	id = treasurefleet.125
	desc = EVTDESC_TREASURE_FLEET_125
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_125 # I see...
	}
}

### Cannibals

# Sailors offer to share a meal
character_event = {
	id = treasurefleet.126
	desc = EVTDESC_TREASURE_FLEET_126
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = cannibal_trait
			}
		}
		name = EVTOPTA_TREASURE_FLEET_126 # Sure!
		
		character_event = { id = treasurefleet.127 days = 1 random = 1 } # Gain Cannibal
	}
	
	option = {
		trigger = {
			trait = cannibal_trait
		}
		name = EVTOPTB_TREASURE_FLEET_126 # Sure!
		
		character_event = { id = treasurefleet.127 days = 1 random = 1 } # Gain Cannibal
	}
	
	option = {
		trigger = {
			NOT = {
				trait = cannibal_trait
			}
		}
		
		name = EVTOPTC_TREASURE_FLEET_126 # I don't think so!
		
		random_list = {
			25 = {
				character_event = { id = treasurefleet.128 days = 1 random = 1 } # Nothing
			}
			25 = {
				hidden_tooltip = {
					FROM = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -1
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 40
					}
				}
				modifier = {
					factor = 10
					combat_rating = 60
				}
				character_event = { id = treasurefleet.129 days = 1 random = 1 } # You are attacked but fight off your attackers
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 80
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 20
					}
				}
				hidden_tooltip = {
					FROM = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -1
						}
					}
				}
				character_event = { id = treasurefleet.130 days = 1 random = 1 } # You are attacked and wounded
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				hidden_tooltip = {
					random = {
						chance = 50
						FROM = {
							change_variable = {
								which = treasure_fleet_army_strength
								value = -1
							}
						}
					}
				}
				character_event = { id = treasurefleet.131 days = 1 random = 1 } # You are attacked and killed
			}
		}
	}
}

# You accepted - a smile, red and white
character_event = {
	id = treasurefleet.127
	desc = EVTDESC_TREASURE_FLEET_127
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_127 # Such a nice meal!
		
		add_trait = cannibal_trait
	}
}

# You refused, nothing happens
character_event = {
	id = treasurefleet.128
	desc = EVTDESC_TREASURE_FLEET_128
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_128 # How odd...
	}
}

# You refused - they attack - you win
character_event = {
	id = treasurefleet.129
	desc = EVTDESC_TREASURE_FLEET_129
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_129 # Good riddance!
		
		prestige = 50
	}
}

# You refused - they attack - you escape but get wounded
character_event = {
	id = treasurefleet.130
	desc = EVTDESC_TREASURE_FLEET_130
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_130 # I got away!
		
		prestige = 25
		add_trait = wounded
	}
}

# You refused - they attack - you get killed
character_event = {
	id = treasurefleet.131
	desc = EVTDESC_TREASURE_FLEET_131
	picture = GFX_evt_shady_meeting
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_131 # No! No! No!
		
		prestige = -50
		
		death = {
			death_reason = death_cannibals
		}
	}
}

### Man overboard

# You fell overboard
character_event = {
	id = treasurefleet.132
	desc = EVTDESC_TREASURE_FLEET_132
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_132 # I must get back!
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				if = {
					limit = {
						has_dlc = "Conclave"
					}
					character_event = { id = treasurefleet.133 days = 1 } # Favor
				}
				else = {
					character_event = { id = treasurefleet.138 days = 1 } # You drowned
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = treasurefleet.137 days = 1 } # You saved yourself
			}
		}
	}
}

# Someone offers a hand - accept and owe them a Favor?
character_event = {
	id = treasurefleet.133
	desc = EVTDESC_TREASURE_FLEET_133
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				NOR = {
					ai = no
					character = ROOT
					owes_favor_to = ROOT
					ROOT = {
						owes_favor_to = PREV
					}
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = treasure_fleet_savior
		}
		if = {
			limit = {
				event_target:treasure_fleet_savior = {
					is_alive = yes
				}
			}
		}
		else = {
			d_treasure_fleet = {
				holder_scope = {
					save_event_target_as = treasure_fleet_savior
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_133 # I'll owe you one!
		
		character_event = { id = treasurefleet.134 days = 1 }
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_133 # I don't need your help!
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				character_event = { id = treasurefleet.136 days = 1 } # Drowned
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = treasurefleet.135 days = 1 } # You saved yourself
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = proud
					trait = stubborn
					event_target:treasure_fleet_savior = {
						any_rival = {
							character = ROOT
						}
					}
				}
			}
		}
	}
}

# Accepted and was saved
character_event = {
	id = treasurefleet.134
	desc = EVTDESC_TREASURE_FLEET_134
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_134 # It was worth it!
		
		event_target:treasure_fleet_savior = {
			add_favor = ROOT
		}
	}
}

# Refused and saved self
character_event = {
	id = treasurefleet.135
	desc = EVTDESC_TREASURE_FLEET_135
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_135 # I didn't need help!
		
		prestige = 25
	}
}

# Refused and drowned
character_event = {
	id = treasurefleet.136
	desc = EVTDESC_TREASURE_FLEET_136
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_136 # Not like this!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Saved yourself
character_event = {
	id = treasurefleet.137
	desc = EVTDESC_TREASURE_FLEET_137
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_137 # I didn't need help!
		
		prestige = 25
	}
}

# Drowned
character_event = {
	id = treasurefleet.138
	desc = EVTDESC_TREASURE_FLEET_138
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_138 # Not like this!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

### You made a friend

# You made a friend
character_event = {
	id = treasurefleet.139
	desc = EVTDESC_TREASURE_FLEET_139
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				NOR = {
					character = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = treasure_fleet_friend
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_139 # That's great!
		
		add_friend = event_target:treasure_fleet_friend
		
		event_target:treasure_fleet_friend = {
			character_event = { id = treasurefleet.140 }
		}
	}
}

# Friend informed
character_event = {
	id = treasurefleet.140
	desc = EVTDESC_TREASURE_FLEET_140
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_140 # That's great!
		
		add_friend = FROM
	}
}

### Tumbling/lovers

# Someone else is attractive - attempt to seduce?
character_event = {
	id = treasurefleet.141
	desc = EVTDESC_TREASURE_FLEET_141
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				NOR = {
					character = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_female = no
						NOT = {
							trait = homosexual
						}
						ROOT = {
							is_female = yes
							NOT = {
								trait = homosexual
							}
						}
					}
					AND = {
						is_female = yes
						NOT = {
							trait = homosexual
						}
						ROOT = {
							is_female = no
							NOT = {
								trait = homosexual
							}
						}
					}
					AND = {
						is_female = yes
						trait = homosexual
						ROOT = {
							is_female = yes
							trait = homosexual
						}
					}
					AND = {
						is_female = no
						trait = homosexual
						ROOT = {
							is_female = no
							trait = homosexual
						}
					}
				}
			}
			save_event_target_as = treasure_fleet_lover
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_141 # Yes!
		
		event_target:treasure_fleet_lover = {
			character_event = { id = treasurefleet.142 days = 1 } # Other party approached
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				event_target:treasure_fleet_lover = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				event_target:treasure_fleet_lover = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_141 # I don't think so!
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Target approached
character_event = {
	id = treasurefleet.142
	desc = EVTDESC_TREASURE_FLEET_142
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_142 # Yes!
		
		FROM = {
			character_event = { id = treasurefleet.144 } # FROM informed
		}
		unprotected_sex_effect = yes
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_142 # I don't think so!
		
		FROM = {
			character_event = { id = treasurefleet.143 } # FROM informed
		}
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Seduction failed
character_event = {
	id = treasurefleet.143
	desc = EVTDESC_TREASURE_FLEET_143
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_143 # I see...
		
		prestige = -25
	}
}

# Seduction succeeded - lovers?
character_event = {
	id = treasurefleet.144
	desc = EVTDESC_TREASURE_FLEET_144
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_144 # We should do this again!
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = treasurefleet.145 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_144 # This shouldn't become a long-term thing...
		
		FROM = {
			character_event = { id = treasurefleet.146 days = 1 } # Inform FROM
		}
	}
}

# Lovers
character_event = {
	id = treasurefleet.145
	desc = EVTDESC_TREASURE_FLEET_145
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_145 # That's great!
		
		add_lover = FROM
	}
}

# Not lovers
character_event = {
	id = treasurefleet.146
	desc = EVTDESC_TREASURE_FLEET_146
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_146 # Perhaps that's for the best...
	}
}

### Rivalry

# You made a rival
character_event = {
	id = treasurefleet.147
	desc = EVTDESC_TREASURE_FLEET_147
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				NOR = {
					character = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = treasure_fleet_rival
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_147 # I hate them!
		
		add_rival = event_target:treasure_fleet_rival
		
		event_target:treasure_fleet_rival = {
			character_event = { id = treasurefleet.148 }
		}
	}
}

# Rival informed
character_event = {
	id = treasurefleet.148
	desc = EVTDESC_TREASURE_FLEET_148
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_148 # I hate them!
		
		add_rival = FROM
	}
}

### You have a rival in the fleet - try to kill them?

# You see an opportunity
character_event = {
	id = treasurefleet.149
	desc = EVTDESC_TREASURE_FLEET_149
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				any_rival = {
					character = ROOT
				}
			}
			save_event_target_as = treasure_fleet_rival_to_kill
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_149 # Do it!
		
		event_target:treasure_fleet_rival_to_kill = {
			random_list = {
				20 = {
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 24
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 20
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 16
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 12
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 8
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 4
						}
					}
					modifier = {
						factor = 0
						combat_rating_diff = {
							character = ROOT
							value = 50
						}
					}
					modifier = {
						factor = 0.2
						combat_rating_diff = {
							character = ROOT
							value = 25
						}
					}
					modifier = {
						factor = 5
						combat_rating_diff = {
							character = ROOT
							value = -25
						}
					}
					modifier = {
						factor = 10
						combat_rating_diff = {
							character = ROOT
							value = -50
						}
					}
					# Thrown overboard; attacker unknown
					character_event = { id = treasurefleet.150 }
				}
				20 = {
					modifier = {
						factor = 2
						intrigue = 24
					}
					modifier = {
						factor = 2
						intrigue = 20
					}
					modifier = {
						factor = 2
						intrigue = 16
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 12
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 8
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 4
							}
						}
					}
					modifier = {
						factor = 0
						combat_rating_diff = {
							character = ROOT
							value = 50
						}
					}
					modifier = {
						factor = 0.2
						combat_rating_diff = {
							character = ROOT
							value = 25
						}
					}
					modifier = {
						factor = 5
						combat_rating_diff = {
							character = ROOT
							value = -25
						}
					}
					modifier = {
						factor = 10
						combat_rating_diff = {
							character = ROOT
							value = -50
						}
					}
					# Thrown overboard; attacker known
					character_event = { id = treasurefleet.155 }
				}
				20 = {
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 24
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 20
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							intrigue = 16
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 12
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 8
						}
					}
					modifier = {
						factor = 2
						NOT = {
							intrigue = 4
						}
					}
					modifier = {
						factor = 10
						combat_rating_diff = {
							character = ROOT
							value = 50
						}
					}
					modifier = {
						factor = 5
						combat_rating_diff = {
							character = ROOT
							value = 25
						}
					}
					modifier = {
						factor = 0.2
						combat_rating_diff = {
							character = ROOT
							value = -25
						}
					}
					modifier = {
						factor = 0.1
						combat_rating_diff = {
							character = ROOT
							value = -50
						}
					}
					# Not thrown overboard; attacker unknown
					character_event = { id = treasurefleet.160 }
				}
				20 = {
					modifier = {
						factor = 2
						intrigue = 24
					}
					modifier = {
						factor = 2
						intrigue = 20
					}
					modifier = {
						factor = 2
						intrigue = 16
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 12
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 8
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 4
							}
						}
					}
					modifier = {
						factor = 10
						combat_rating_diff = {
							character = ROOT
							value = 50
						}
					}
					modifier = {
						factor = 5
						combat_rating_diff = {
							character = ROOT
							value = 25
						}
					}
					modifier = {
						factor = 0.2
						combat_rating_diff = {
							character = ROOT
							value = -25
						}
					}
					modifier = {
						factor = 0.1
						combat_rating_diff = {
							character = ROOT
							value = -50
						}
					}
					# Not thrown overboard; attacker known
					character_event = { id = treasurefleet.162 }
				}
				20 = {
					modifier = {
						factor = 2
						intrigue = 24
					}
					modifier = {
						factor = 2
						intrigue = 20
					}
					modifier = {
						factor = 2
						intrigue = 16
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 12
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 8
							}
						}
					}
					modifier = {
						factor = 2
						ROOT = {
							NOT = {
								intrigue = 4
							}
						}
					}
					modifier = {
						factor = 10
						combat_rating_diff = {
							character = ROOT
							value = 50
						}
					}
					modifier = {
						factor = 5
						combat_rating_diff = {
							character = ROOT
							value = 25
						}
					}
					modifier = {
						factor = 0.1
						combat_rating_diff = {
							character = ROOT
							value = -25
						}
					}
					modifier = {
						factor = 0
						combat_rating_diff = {
							character = ROOT
							value = -50
						}
					}
					# Threw attacker overboard
					character_event = { id = treasurefleet.164 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_149 # It's too risky...
		
		prestige = -25
	}
}

# You were thrown from the ship by an unknown attacker - try to get back
character_event = {
	id = treasurefleet.150
	desc = EVTDESC_TREASURE_FLEET_150
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_150 # Get back to safety first, figure out who it was later!
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				character_event = { id = treasurefleet.153 days = 1 } # Drowned
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = treasurefleet.151 days = 1 } # Survived
			}
		}
	}
}

# You succeeded
character_event = {
	id = treasurefleet.151
	desc = EVTDESC_TREASURE_FLEET_151
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_151 # Phew!
		
		FROMFROM = {
			character_event = { id = treasurefleet.152 } # Inform the attacker
		}
	}
}

# Target survived, you're not revealed
character_event = {
	id = treasurefleet.152
	desc = EVTDESC_TREASURE_FLEET_152
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_152 # Unfortunate!
	}
}

# You failed
character_event = {
	id = treasurefleet.153
	desc = EVTDESC_TREASURE_FLEET_153
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_151 # No!
		
		death = {
			death_reason = death_murder_unknown_drowning
			killer = FROMFROM
		}
		
		FROMFROM = {
			character_event = { id = treasurefleet.154 } # Inform the attacker
		}
	}
}

# Target drowned, you're not revealed
character_event = {
	id = treasurefleet.154
	desc = EVTDESC_TREASURE_FLEET_154
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_154 # Just as planned!
	}
}

# You were thrown overboard by a known attacker - try to get back
character_event = {
	id = treasurefleet.155
	desc = EVTDESC_TREASURE_FLEET_155
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_155 # I saw the attacker!
		
		opinion = {
			who = FROM
			modifier = attempted_murder
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				character_event = { id = treasurefleet.158 days = 1 } # Drowned
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = treasurefleet.156 days = 1 } # Survived
			}
		}
	}
}

# You succeeded
character_event = {
	id = treasurefleet.156
	desc = EVTDESC_TREASURE_FLEET_156
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_156 # Phew!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROMFROM = { character_event = { id = 11 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		FROMFROM = {
			character_event = { id = treasurefleet.157 } # Inform the attacker
		}
	}
}

# Target survived and knows that you did it
character_event = {
	id = treasurefleet.157
	desc = EVTDESC_TREASURE_FLEET_157
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_157 # That didn't go well!
	}
}

# You failed
character_event = {
	id = treasurefleet.158
	desc = EVTDESC_TREASURE_FLEET_158
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_158 # No!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROMFROM = { character_event = { id = 10 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		death = {
			death_reason = death_murder_drowning
			killer = FROMFROM
		}
		
		FROMFROM = {
			character_event = { id = treasurefleet.159 } # Inform the attacker
		}
	}
}

# Target drowned but knew you did it
character_event = {
	id = treasurefleet.159
	desc = EVTDESC_TREASURE_FLEET_159
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_159 # Good enough!
	}
}

# You managed to stay on the ship - didn't see the attacker
character_event = {
	id = treasurefleet.160
	desc = EVTDESC_TREASURE_FLEET_160
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_160 # Who was that?
		
		FROM = {
			character_event = { id = treasurefleet.161 days = 1 } # Inform the attacker
		}
	}
}

# Attempt failed, but you weren't discovered
character_event = {
	id = treasurefleet.161
	desc = EVTDESC_TREASURE_FLEET_161
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_161 # At least I wasn't seen...
	}
}

# You managed to stay on the ship - saw the attacker
character_event = {
	id = treasurefleet.162
	desc = EVTDESC_TREASURE_FLEET_162
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_162 # I saw them!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 11 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		opinion = {
			who = FROM
			modifier = attempted_murder
		}
		
		FROM = {
			character_event = { id = treasurefleet.163 days = 1 } # Inform the attacker
		}
	}
}

# Attempt failed, and you were discovered
character_event = {
	id = treasurefleet.163
	desc = EVTDESC_TREASURE_FLEET_163
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_163 # Curses!
	}
}

# You gained the upper hand and threw your attacker into the sea
character_event = {
	id = treasurefleet.164
	desc = EVTDESC_TREASURE_FLEET_164
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_164 # Ha!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 11 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		opinion = {
			who = FROM
			modifier = attempted_murder
		}
		
		FROM = {
			character_event = { id = treasurefleet.165 days = 1 }
		}
	}
}

# Thrown into the sea - discovered - try to get back
character_event = {
	id = treasurefleet.165
	desc = EVTDESC_TREASURE_FLEET_165
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_165 # That went poorly...
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				character_event = { id = treasurefleet.168 days = 1 } # Drowned
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				character_event = { id = treasurefleet.166 days = 1 } # Survived
			}
		}
	}
}

# Got back to safety
character_event = {
	id = treasurefleet.166
	desc = EVTDESC_TREASURE_FLEET_166
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_166 # Phew!
		
		FROMFROM = {
			character_event = { id = treasurefleet.167 } # Inform the target
		}
	}
}

# Attacker got back to safety
character_event = {
	id = treasurefleet.167
	desc = EVTDESC_TREASURE_FLEET_167
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_167 # At least I know to watch my back now...
	}
}

# Drowned
character_event = {
	id = treasurefleet.168
	desc = EVTDESC_TREASURE_FLEET_168
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_168 # No!
		
		death = {
			death_reason = death_accident_drowning # Technically correct!
		}
		
		FROMFROM = {
			character_event = { id = treasurefleet.169 } # Inform the target
		}
	}
}

# Attacker drowned
character_event = {
	id = treasurefleet.169
	desc = EVTDESC_TREASURE_FLEET_169
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_169 # Good riddance!
	}
}

### Dolphins

# Dolphins are nice
character_event = {
	id = treasurefleet.170
	desc = EVTDESC_TREASURE_FLEET_170
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_170 # Nice!
		
		prestige = 5
	}
}

### Sharks

# Sharks might be scary
character_event = {
	id = treasurefleet.171
	desc = EVTDESC_TREASURE_FLEET_171
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_171 # I really don't want to fall overboard...
		
		if = {
			limit = {
				trait = brave
			}
			random = {
				chance = 25
				remove_trait = brave
			}
		}
		else = {
			random = {
				chance = 25
				add_trait = craven
			}
		}
	}
}

### Turtles

# Turtles are nice
character_event = {
	id = treasurefleet.172
	desc = EVTDESC_TREASURE_FLEET_172
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_172 # Nice!
		
		prestige = 5
	}
}

### Drifting ship discovered

# Drifting ship - investigate?
character_event = {
	id = treasurefleet.173
	desc = EVTDESC_TREASURE_FLEET_173
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_173 # Yes!
		
		random_list = {
			1 = {
				character_event = { id = treasurefleet.174 days = 2 random = 5 } # Nothing
			}
			1 = {
				character_event = { id = treasurefleet.175 days = 2 random = 5 } # Dead crew
			}
			1 = {
				character_event = { id = treasurefleet.176 days = 2 random = 5 } # Hidden attacker
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_173 # No!
		
		prestige = -5
	}
}

# Investigated - nothing
character_event = {
	id = treasurefleet.174
	desc = EVTDESC_TREASURE_FLEET_174
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_174 # How odd...
	}
}

# Investigated - dead crew
character_event = {
	id = treasurefleet.175
	desc = EVTDESC_TREASURE_FLEET_175
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_175 # Who did this?
		
		random = {
			chance = 10
			add_trait = paranoid
		}
	}
}

# Investigated - hidden attacker
character_event = {
	id = treasurefleet.176
	desc = EVTDESC_TREASURE_FLEET_176
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_176 # To me!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				modifier = {
					factor = 2
					combat_rating = 40
				}
				# Unharmed
				character_event = { id = treasurefleet.177 days = 1 }
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 60
				}
				# Wounded
				character_event = { id = treasurefleet.178 days = 1 }
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				# Maimed
				character_event = { id = treasurefleet.179 days = 1 }
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 20
				}
				# Killed
				character_event = { id = treasurefleet.180 days = 1 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
}

# Unharmed
character_event = {
	id = treasurefleet.177
	desc = EVTDESC_TREASURE_FLEET_177
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_177 # We avenged the crew!
		
		prestige = 25
	}
}

# Wounded
character_event = {
	id = treasurefleet.178
	desc = EVTDESC_TREASURE_FLEET_178
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_178 # We avenged the crew!
		
		add_trait = wounded
		
		prestige = 10
	}
}

# Maimed
character_event = {
	id = treasurefleet.179
	desc = EVTDESC_TREASURE_FLEET_179
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_179 # We avenged the crew!
		
		add_maimed_trait_effect = yes
		
		prestige = 10
	}
}

# Died
character_event = {
	id = treasurefleet.180
	desc = EVTDESC_TREASURE_FLEET_180
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_180 # No!
		
		death = {
			death_reason = death_battle
		}
		
		prestige = -25
	}
}

### Deserted island

# Deserted island - investigate?
character_event = {
	id = treasurefleet.181
	desc = EVTDESC_TREASURE_FLEET_181
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_173 # Yes!
		
		random_list = {
			1 = {
				modifier = {
					factor = 0 # Only if you have the proper DLC!
					NOR = {
						has_dlc = "Mystics"
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.182 days = 2 random = 5 } # Artifact
			}
			9 = {
				character_event = { id = treasurefleet.183 days = 2 random = 5 } # Treasure map
			}
			90 = {
				character_event = { id = treasurefleet.184 days = 2 random = 5 } # Nothing
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_173 # No!
		
		prestige = -5
	}
}

# Found a minor artifact
character_event = {
	id = treasurefleet.182
	desc = EVTDESC_TREASURE_FLEET_182
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = the_lily_crown
		clr_character_flag = noble_scepter
		clr_character_flag = engraved_sword
		clr_character_flag = engraved_dagger
		clr_character_flag = silver_bracelets
		clr_character_flag = collar_of_pearls
		clr_character_flag = circlet_of_twilight
		clr_character_flag = silver_staff
		clr_character_flag = iron_crown
		clr_character_flag = engraved_crown
		clr_character_flag = ceremonial_axe
		clr_character_flag = sword_tier_1_new
		clr_character_flag = scimitar_tier_1_new
		clr_character_flag = lance_tier_1_new
		clr_character_flag = axe_tier_1_new
		clr_character_flag = mace_tier_1_new
		clr_character_flag = bow_tier_1_new
		clr_character_flag = armor_tier_1
		clr_character_flag = horse_armor_tier_1
		random_list = {
			1 = {
				set_character_flag = the_lily_crown
			}
			1 = {
				set_character_flag = noble_scepter
			}
			1 = {
				set_character_flag = engraved_sword
			}
			1 = {
				set_character_flag = engraved_dagger
			}
			1 = {
				set_character_flag = silver_bracelets
			}
			1 = {
				set_character_flag = collar_of_pearls
			}
			1 = {
				set_character_flag = circlet_of_twilight
			}
			1 = {
				set_character_flag = silver_staff
			}
			1 = {
				set_character_flag = iron_crown
			}
			1 = {
				set_character_flag = engraved_crown
			}
			1 = {
				set_character_flag = ceremonial_axe
			}
			1 = {
				set_character_flag = sword_tier_1_new
			}
			1 = {
				set_character_flag = scimitar_tier_1_new
			}
			1 = {
				set_character_flag = lance_tier_1_new
			}
			1 = {
				set_character_flag = axe_tier_1_new
			}
			1 = {
				set_character_flag = mace_tier_1_new
			}
			1 = {
				set_character_flag = bow_tier_1_new
			}
			1 = {
				set_character_flag = armor_tier_1
			}
			1 = {
				set_character_flag = horse_armor_tier_1
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_182 # I hope I can find a use for this...
		
		if = {
			limit = {
				has_character_flag = the_lily_crown
			}
			add_artifact = the_lily_crown
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = noble_scepter
			}
			add_artifact = noble_scepter
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = engraved_sword
			}
			add_artifact = engraved_sword
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = engraved_dagger
			}
			add_artifact = engraved_dagger
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = silver_bracelets
			}
			add_artifact = silver_bracelets
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = collar_of_pearls
			}
			add_artifact = collar_of_pearls
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = circlet_of_twilight
			}
			add_artifact = circlet_of_twilight
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = silver_staff
			}
			add_artifact = silver_staff
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = iron_crown
			}
			add_artifact = iron_crown
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = engraved_crown
			}
			add_artifact = engraved_crown
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = ceremonial_axe
			}
			add_artifact = ceremonial_axe
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = sword_tier_1_new
			}
			add_artifact = sword_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = scimitar_tier_1_new
			}
			add_artifact = scimitar_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = lance_tier_1_new
			}
			add_artifact = lance_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = axe_tier_1_new
			}
			add_artifact = axe_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = mace_tier_1_new
			}
			add_artifact = mace_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = bow_tier_1_new
			}
			add_artifact = bow_tier_1_new
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = armor_tier_1
			}
			add_artifact = armor_tier_1
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		else_if = {
			limit = {
				has_character_flag = horse_armor_tier_1
			}
			add_artifact = horse_armor_tier_1
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		clr_character_flag = the_lily_crown
		clr_character_flag = noble_scepter
		clr_character_flag = engraved_sword
		clr_character_flag = engraved_dagger
		clr_character_flag = silver_bracelets
		clr_character_flag = collar_of_pearls
		clr_character_flag = circlet_of_twilight
		clr_character_flag = silver_staff
		clr_character_flag = iron_crown
		clr_character_flag = engraved_crown
		clr_character_flag = ceremonial_axe
		clr_character_flag = sword_tier_1_new
		clr_character_flag = scimitar_tier_1_new
		clr_character_flag = lance_tier_1_new
		clr_character_flag = axe_tier_1_new
		clr_character_flag = mace_tier_1_new
		clr_character_flag = bow_tier_1_new
		clr_character_flag = armor_tier_1
		clr_character_flag = horse_armor_tier_1
	}
}

# Found a treasure map
character_event = {
	id = treasurefleet.183
	desc = EVTDESC_TREASURE_FLEET_183
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_183 # Curious...
		
		add_artifact = treasure_map
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
	}
}

# Nothing of note
character_event = {
	id = treasurefleet.184
	desc = EVTDESC_TREASURE_FLEET_184
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_184 # Onwards!
	}
}

### Flying Dutchman

# Flying Dutchman is spooky
character_event = {
	id = treasurefleet.185
	desc = EVTDESC_TREASURE_FLEET_185
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_185 # An ominous portent!
		
		if = {
			limit = {
				trait = brave
			}
			random = {
				chance = 25
				remove_trait = brave
			}
		}
		else = {
			random = {
				chance = 25
				add_trait = craven
			}
		}
	}
}

### Pirate attack

# Pirates attacks ship - inform commander
character_event = {
	id = treasurefleet.186
	desc = EVTDESC_TREASURE_FLEET_186
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_186 # To arms!
		if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							99 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							49 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							24 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 10
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							9 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 5
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							4 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 4
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							3 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 3
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							2 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.187 } # Your ship was attacked!
							}
							1 = {
								character_event = { id = treasurefleet.188 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else = {
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.187 } # Your ship was attacked!
					}
				}
			}
		}
		FROM = {
			province_event = { id = treasurefleet.189 days = 1 } # Calculate the outcome
		}
	}
}

# Pirates attacks ship - inform people on that ship
character_event = {
	id = treasurefleet.187
	desc = EVTDESC_TREASURE_FLEET_187
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_187 # To arms!
		
		set_character_flag = tf_call_to_arms
	}
}

# Pirates attacks ship - inform people on other ships
character_event = {
	id = treasurefleet.188
	desc = EVTDESC_TREASURE_FLEET_188
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_188 # How horrible!
	}
}

# Check outcome
province_event = {
	id = treasurefleet.189
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# First, let's see how strong the TF is
		set_variable = {
			which = tf_fighting_value
			value = 0
		}
		change_variable = {
			which = tf_fighting_value
			which = treasure_fleet_army_strength
		}
		multiply_variable = {
			which = tf_fighting_value
			value = 10
		}
		divide_variable = {
			which = tf_fighting_value
			which = treasure_fleet_ship_strength
		}
		set_variable = {
			which = tf_pcs
			value = 0
		}
		if = {
			limit = {
				is_variable_equal = {
					which = treasure_fleet_ship_strength
					value = 1
				}
			}
			d_treasure_fleet = {
				holder_scope = {
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
						has_character_flag = tf_call_to_arms
					}
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		change_variable = {
			which = tf_fighting_value
			which = tf_pcs
		}
		
		# Then randomize the enemy
		random_list = {
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -500
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -250
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -100
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -50
				}
			}
		}
		
		# Now let's see what the outcome is
		if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value = 2
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -1
				}
				# Ship sinks
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.193 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.194 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.195 }
							}
						}
					}
				}
			}
			else = {
				# Pirates driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.190 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.191 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.192 }
							}
						}
					}
				}
			}
		}
		else = {
			# Special case: The fleet might be lost!
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.196 }
						any_courtier = {
							character_event = { id = treasurefleet.196 }
						}
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							character_event = { id = treasurefleet.196 }
						}
						character_event = { id = treasurefleet.197 }
					}
				}
				any_player = {
					limit = {
						NOR = {
							trait = treasure_fleet_voyage
							has_landed_title = e_china
						}
					}
					character_event = { id = treasurefleet.198 }
				}
				clean_up_old_treasure_fleet_effect = yes
			}
			else = {
				# Pirates driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.190 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.191 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.192 }
							}
						}
					}
				}
			}
		}
	}
}

# Pirates driven off - inform commander
character_event = {
	id = treasurefleet.190
	desc = EVTDESC_TREASURE_FLEET_190
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_190 # Great!
		
		prestige = 100
	}
}

# Pirates driven off - inform people on that ship
character_event = {
	id = treasurefleet.191
	desc = EVTDESC_TREASURE_FLEET_191
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_191 # Great!
		
		prestige = 100
	}
}

# Pirates driven off - inform people on other ships
character_event = {
	id = treasurefleet.192
	desc = EVTDESC_TREASURE_FLEET_192
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_192 # Great!
		
		prestige = 100
	}
}

# Ship destroyed - inform commander
character_event = {
	id = treasurefleet.193
	desc = EVTDESC_TREASURE_FLEET_193
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_193 # Oh, no!
	}
}

# Ship destroyed - inform people on that ship
character_event = {
	id = treasurefleet.194
	desc = EVTDESC_TREASURE_FLEET_194
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_194 # I must swim to safety!
		
		random_list = {
			50 = {}
			25 = {
				add_trait = wounded
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				add_maimed_trait_effect = yes
			}
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Ship destroyed - inform people on other ships
character_event = {
	id = treasurefleet.195
	desc = EVTDESC_TREASURE_FLEET_195
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_195 # Oh, no!
	}
}

# Last ship destroyed - inform all TF people
character_event = {
	id = treasurefleet.196
	desc = EVTDESC_TREASURE_FLEET_196
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_196 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship destroyed - inform the EoC
character_event = {
	id = treasurefleet.197
	desc = EVTDESC_TREASURE_FLEET_197
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_197 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
	}
}

# Last ship destroyed - inform the world
character_event = {
	id = treasurefleet.198
	desc = EVTDESC_TREASURE_FLEET_198
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_198 # I see...
	}
}

### Supply ship lost

# Supply ship lost - lose some food
character_event = {
	id = treasurefleet.199
	desc = EVTDESC_TREASURE_FLEET_199
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_199 # I see...
		
		FROM = {
			random_list = {
				1 = {
					change_variable = {
						which = tf_supplies
						value = -1
					}
				}
				1 = {
					change_variable = {
						which = tf_supplies
						value = -2
					}
				}
				1 = {
					change_variable = {
						which = tf_supplies
						value = -3
					}
				}
				1 = {
					change_variable = {
						which = tf_supplies
						value = -4
					}
				}
				1 = {
					change_variable = {
						which = tf_supplies
						value = -5
					}
				}
			}
		}
	}
}

### Fireworks go off

# Fireworks go off
character_event = {
	id = treasurefleet.200
	desc = EVTDESC_TREASURE_FLEET_200
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			random_list = {
				1 = {
					remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
				}
				1 = {
					remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
				}
				1 = {
					remove_or_weaken_everything_permissible_effect = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_200 # Oh no!
		if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							99 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							49 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							24 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 10
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							9 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 5
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							4 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 4
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							3 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 3
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							2 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.201 } # Your ship blew up
							}
							1 = {
								character_event = { id = treasurefleet.202 } # Other ship blew up
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 1
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.201 } # Your ship blew up
					}
				}
			}
		}
		else = {
			# Special case: TF destroyed
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.204 }
						any_courtier = {
							character_event = { id = treasurefleet.204 }
						}
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							character_event = { id = treasurefleet.203 }
						}
						character_event = { id = treasurefleet.204 }
					}
				}
				any_player = {
					limit = {
						NOR = {
							trait = treasure_fleet_voyage
							has_landed_title = e_china
						}
					}
					character_event = { id = treasurefleet.205 }
				}
				FROM = {
					clean_up_old_treasure_fleet_effect = yes
				}
			}
		}
	}
}

# Fireworks ship catches fire - abandon ship
character_event = {
	id = treasurefleet.201
	desc = EVTDESC_TREASURE_FLEET_201
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_201 # I must swim to safety!
		
		random_list = {
			50 = {}
			25 = {
				add_trait = wounded
			}
			25 = {
				add_maimed_trait_effect = yes
			}
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Other ship blew up
character_event = {
	id = treasurefleet.202
	desc = EVTDESC_TREASURE_FLEET_202
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_202 # Oh, no!
	}
}

# Last ship destroyed - inform all TF people
character_event = {
	id = treasurefleet.203
	desc = EVTDESC_TREASURE_FLEET_203
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_203 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship destroyed - inform the EoC
character_event = {
	id = treasurefleet.204
	desc = EVTDESC_TREASURE_FLEET_204
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_204 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
		
	}
}

# Last ship destroyed - inform the world
character_event = {
	id = treasurefleet.205
	desc = EVTDESC_TREASURE_FLEET_205
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_205 # I see...
	}
}

### Food shortage

# Food shortage - lose fat/become malnourished
character_event = {
	id = treasurefleet.206
	desc = EVTDESC_TREASURE_FLEET_206
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_206 # I'm hungry!
		
		random_list = {
			1 = {
				lose_weight_small_effect = yes
			}
			1 = {
				lose_weight_medium_effect = yes
			}
			1 = {
				lose_weight_large_effect = yes
			}
		}
	}
}

##### Arrival events

# Possible routes:
# - China -> Korea -> Japan -> Ryukyu (+ Taiwan) -> maynila -> Borneo -> Temasek (merge, then split)
# - China -> Champa -> Lavo -> Temasek (merge, then split)
# - Temasek -> Palembang -> Java -> SI
# - Temasek -> Lamuri (split)
# - Lamuri -> Dagon -> Bengal -> Eastern coast of India -> Lanka (merge)
# - Lamuri -> Lanka -> Western coast of India -> Sindh -> Oman (split)
# - Oman -> Persian Gulf
# - Oman -> Socotra -> Red Sea
# - Return route is always shortest possible, with Japan, Ryukyu, and Philippines shortcutting to China

# Check where the fleet is and fire the proper arrival event
province_event = {
	id = treasurefleet.207
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_korea
			}
			clr_province_flag = treasure_fleet_going_to_korea
			set_province_flag = treasure_fleet_in_korea
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.208 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_japan
			}
			clr_province_flag = treasure_fleet_going_to_japan
			set_province_flag = treasure_fleet_in_japan
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.209 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_ryukyu
			}
			clr_province_flag = treasure_fleet_going_to_ryukyu
			set_province_flag = treasure_fleet_in_ryukyu
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.210 }
				}
			}
		}
		#else_if = {
		#	limit = {
		#		has_province_flag = treasure_fleet_going_to_taiwan
		#	}
		#	clr_province_flag = treasure_fleet_going_to_taiwan
		#	set_province_flag = treasure_fleet_in_taiwan
		#	d_treasure_fleet = {
		#		holder_scope = {
		#			narrative_event = { id = treasurefleet.211 }
		#		}
		#	}
		#}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_maynila
			}
			clr_province_flag = treasure_fleet_going_to_maynila
			set_province_flag = treasure_fleet_in_maynila
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.212 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_borneo
			}
			clr_province_flag = treasure_fleet_going_to_borneo
			set_province_flag = treasure_fleet_in_borneo
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.213 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_champa
			}
			clr_province_flag = treasure_fleet_going_to_champa
			set_province_flag = treasure_fleet_in_champa
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.214 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_lavo
			}
			clr_province_flag = treasure_fleet_going_to_lavo
			set_province_flag = treasure_fleet_in_lavo
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.215 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_temasek
			}
			clr_province_flag = treasure_fleet_going_to_temasek
			set_province_flag = treasure_fleet_in_temasek
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.216 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_palembang
			}
			clr_province_flag = treasure_fleet_going_to_palembang
			set_province_flag = treasure_fleet_in_palembang
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.217 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_java
			}
			clr_province_flag = treasure_fleet_going_to_java
			set_province_flag = treasure_fleet_in_java
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.218 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_lamuri
			}
			clr_province_flag = treasure_fleet_going_to_lamuri
			set_province_flag = treasure_fleet_in_lamuri
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.219 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_dagon
			}
			clr_province_flag = treasure_fleet_going_to_dagon
			set_province_flag = treasure_fleet_in_dagon
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.220 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_bengal
			}
			clr_province_flag = treasure_fleet_going_to_bengal
			set_province_flag = treasure_fleet_in_bengal
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.221 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_eastern_india
			}
			clr_province_flag = treasure_fleet_going_to_eastern_india
			set_province_flag = treasure_fleet_in_eastern_india
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.222 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_lanka
			}
			clr_province_flag = treasure_fleet_going_to_lanka
			set_province_flag = treasure_fleet_in_lanka
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.223 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_western_india
			}
			clr_province_flag = treasure_fleet_going_to_western_india
			set_province_flag = treasure_fleet_in_western_india
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.224 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_sindh
			}
			clr_province_flag = treasure_fleet_going_to_sindh
			set_province_flag = treasure_fleet_in_sindh
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.225 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_oman
			}
			clr_province_flag = treasure_fleet_going_to_oman
			set_province_flag = treasure_fleet_in_oman
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.226 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_persian_gulf
			}
			clr_province_flag = treasure_fleet_going_to_persian_gulf
			set_province_flag = treasure_fleet_in_persian_gulf
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.227 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_socotra
			}
			clr_province_flag = treasure_fleet_going_to_socotra
			set_province_flag = treasure_fleet_in_socotra
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.228 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_red_sea
			}
			clr_province_flag = treasure_fleet_going_to_red_sea
			set_province_flag = treasure_fleet_in_red_sea
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.229 }
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_china
			}
			clr_province_flag = treasure_fleet_going_to_china
			set_province_flag = treasure_fleet_in_china
			province_event = { id = treasurefleet.503 }
		}
		else = {
			log = "Treasure Fleet failed to find destination!"
			# Failsafe
			province_event = { id = treasurefleet.503 }
		}
		province_event = { id = treasurefleet.230 } # Events for locals
	}
}

# Treasure Fleet arrives in Korea
narrative_event = {
	id = treasurefleet.208
	title = EVTTITLE_TREASURE_FLEET_208
	desc = EVTDESC_TREASURE_FLEET_208
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_208 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_208 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_208 # Meh...
	}
}

# Treasure Fleet arrives in Japan
narrative_event = {
	id = treasurefleet.209
	title = EVTTITLE_TREASURE_FLEET_209
	desc = EVTDESC_TREASURE_FLEET_209
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_209 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_209 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_209 # Meh...
	}
}

# Treasure Fleet arrives in Ryukyu
narrative_event = {
	id = treasurefleet.210
	title = EVTTITLE_TREASURE_FLEET_210
	desc = EVTDESC_TREASURE_FLEET_210
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_210 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_210 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_210 # Meh...
	}
}

# Treasure Fleet arrives in Taiwan - DEPRECATED AND MERGED WITH RYUKYU
narrative_event = {
	id = treasurefleet.211
	title = EVTTITLE_TREASURE_FLEET_211
	desc = EVTDESC_TREASURE_FLEET_211
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_211 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_211 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_211 # Meh...
	}
}

# Treasure Fleet arrives in maynila
narrative_event = {
	id = treasurefleet.212
	title = EVTTITLE_TREASURE_FLEET_212
	desc = EVTDESC_TREASURE_FLEET_212
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_212 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_212 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_212 # Meh...
	}
}

# Treasure Fleet arrives in Borneo
narrative_event = {
	id = treasurefleet.213
	title = EVTTITLE_TREASURE_FLEET_213
	desc = EVTDESC_TREASURE_FLEET_213
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_213 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_213 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_213 # Meh...
	}
}

# Treasure Fleet arrives in Champa
narrative_event = {
	id = treasurefleet.214
	title = EVTTITLE_TREASURE_FLEET_214
	desc = EVTDESC_TREASURE_FLEET_214
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_214 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_214 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_214 # Meh...
	}
}

# Treasure Fleet arrives in Lavo
narrative_event = {
	id = treasurefleet.215
	title = EVTTITLE_TREASURE_FLEET_215
	desc = EVTDESC_TREASURE_FLEET_215
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_215 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_215 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_215 # Meh...
	}
}

# Treasure Fleet arrives in Temasek
narrative_event = {
	id = treasurefleet.216
	title = EVTTITLE_TREASURE_FLEET_216
	desc = EVTDESC_TREASURE_FLEET_216
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_216 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_216 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_216 # Meh...
	}
}

# Treasure Fleet arrives in Palembang
narrative_event = {
	id = treasurefleet.217
	title = EVTTITLE_TREASURE_FLEET_217
	desc = EVTDESC_TREASURE_FLEET_217
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_217 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_217 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_217 # Meh...
	}
}

# Treasure Fleet arrives in Java
narrative_event = {
	id = treasurefleet.218
	title = EVTTITLE_TREASURE_FLEET_218
	desc = EVTDESC_TREASURE_FLEET_218
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_218 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_218 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_218 # Meh...
	}
}

# Treasure Fleet arrives in Lamuri
narrative_event = {
	id = treasurefleet.219
	title = EVTTITLE_TREASURE_FLEET_219
	desc = EVTDESC_TREASURE_FLEET_219
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_219 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_219 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_219 # Meh...
	}
}

# Treasure Fleet arrives in Dagon
narrative_event = {
	id = treasurefleet.220
	title = EVTTITLE_TREASURE_FLEET_220
	desc = EVTDESC_TREASURE_FLEET_220
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_220 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_220 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_220 # Meh...
	}
}

# Treasure Fleet arrives in Bengal
narrative_event = {
	id = treasurefleet.221
	title = EVTTITLE_TREASURE_FLEET_221
	desc = EVTDESC_TREASURE_FLEET_221
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_221 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_221 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_221 # Meh...
	}
}

# Treasure Fleet arrives in Eastern India
narrative_event = {
	id = treasurefleet.222
	title = EVTTITLE_TREASURE_FLEET_222
	desc = EVTDESC_TREASURE_FLEET_222
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_222 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_222 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_222 # Meh...
	}
}

# Treasure Fleet arrives in Lanka
narrative_event = {
	id = treasurefleet.223
	title = EVTTITLE_TREASURE_FLEET_223
	desc = EVTDESC_TREASURE_FLEET_223
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_223 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_223 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_223 # Meh...
	}
}

# Treasure Fleet arrives in Western India
narrative_event = {
	id = treasurefleet.224
	title = EVTTITLE_TREASURE_FLEET_224
	desc = EVTDESC_TREASURE_FLEET_224
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_224 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_224 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_224 # Meh...
	}
}

# Treasure Fleet arrives in Sindh
narrative_event = {
	id = treasurefleet.225
	title = EVTTITLE_TREASURE_FLEET_225
	desc = EVTDESC_TREASURE_FLEET_225
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_225 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_225 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_225 # Meh...
	}
}

# Treasure Fleet arrives in Oman
narrative_event = {
	id = treasurefleet.226
	title = EVTTITLE_TREASURE_FLEET_226
	desc = EVTDESC_TREASURE_FLEET_226
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_226 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_226 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_226 # Meh...
	}
}

# Treasure Fleet arrives in the Persian Gulf
narrative_event = {
	id = treasurefleet.227
	title = EVTTITLE_TREASURE_FLEET_227
	desc = EVTDESC_TREASURE_FLEET_227
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_227 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_227 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_227 # Meh...
	}
}

# Treasure Fleet arrives in Socotra
narrative_event = {
	id = treasurefleet.228
	title = EVTTITLE_TREASURE_FLEET_228
	desc = EVTDESC_TREASURE_FLEET_228
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_228 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_228 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_228 # Meh...
	}
}

# Treasure Fleet arrives in the Red Sea
narrative_event = {
	id = treasurefleet.229
	title = EVTTITLE_TREASURE_FLEET_229
	desc = EVTDESC_TREASURE_FLEET_229
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	major = yes
	
	is_triggered_only = yes
	
	major_trigger = {
		notified_of_treasure_fleet_arrival_trigger = yes
	}
	
	option = {
		trigger = {
			NOT = {
				top_liege = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_229 # Interesting...
	}
	
	option = {
		trigger = {
			trait = treasure_fleet_voyage
		}
		name = EVTOPTB_TREASURE_FLEET_229 # Interesting...
	}
	
	option = {
		trigger = {
			top_liege = {
				is_chinese_emperor_trigger = yes
				NOT = {
					trait = treasure_fleet_voyage
				}
			}
		}
		name = EVTOPTC_TREASURE_FLEET_229 # Meh...
	}
}

##### Port events for locals

# Event selection for locals
province_event = {
	id = treasurefleet.230
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			random_list = {
				1 = {
					modifier = {
						factor = 0
						is_tribal = yes
					}
					modifier = {
						factor = 0
						NOT = {
							ROOT = {
								check_variable = {
									which = tf_immigrants
									value = 1
								}
							}
						}
					}
					# Influx of Chinese people
					character_event = { id = treasurefleet.231 days = 1 random = 15 }
				}
				1 = {
					modifier = {
						factor = 0
						independent = no
					}
					modifier = {
						factor = 0
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
					}
					# Sabotage opportunity
					character_event = { id = treasurefleet.241 days = 1 random = 15 }
				}
				1 = {
					modifier = {
						factor = 0
						is_tributary = yes
					}
					modifier = {
						factor = 0
						independent = no
					}
					# Offer to become tributary?
					character_event = { id = treasurefleet.255 days = 1 random = 15 }
				}
				10 = {
					modifier = {
						factor = 0
						NOT = {
							has_dlc = "Jade Dragon"
						}
					}
					# Gold for Grace?
					character_event = { id = treasurefleet.259 days = 1 random = 15 }
				}
				1 = {
					modifier = {
						factor = 0
						ai = no
					}
					# Artifact for Grace? - AI only!
					character_event = { id = treasurefleet.263 } # Intentionally not offset
				}
				1 = {
					modifier = {
						factor = 0
						OR = {
							trait = zealous
							NOT = {
								e_china = {
									holder_scope = {
										any_realm_lord = {
											trait = treasure_fleet_voyage
											NOT = {
												religion_group = ROOT
											}
										}
									}
								}
							}
						}
					}
					# Sympathy
					character_event = { id = treasurefleet.267 days = 1 random = 15 }
				}
				5 = {
					modifier = {
						factor = 0
						ROOT = {
							NOR = {
								check_variable = {
									which = tf_soldier
									value = 1
								}
								check_variable = {
									which = tf_eunuch
									value = 1
								}
								check_variable = {
									which = tf_courtesan
									value = 1
								}
								check_variable = {
									which = tf_scholar
									value = 1
								}
								check_variable = {
									which = tf_noble
									value = 1
								}
							}
						}
					}
					# Random (non-JD) courtier
					character_event = { id = treasurefleet.268 days = 1 random = 15 }
				}
				10 = {
					modifier = {
						factor = 0
						NOT = {
							any_demesne_province = {
								port = yes
								is_in_active_treasure_fleet_region_trigger = yes
								treasure_fleet_tech_can_spread_here_trigger = yes
							}
						}
					}
					# Tech spread
					character_event = { id = treasurefleet.274 days = 1 random = 15 }
				}
				10 = {
					# Invite guests?
					character_event = { id = treasurefleet.293 days = 1 random = 15 }
				}
				10 = { # Nothing
					modifier = {
						factor = 2
						ai = yes
					}
				}
			}
		}
		province_event = { id = treasurefleet.342 days = 30 }
	}
}

### Influx of Chinese people

# Welcome settlers?
character_event = {
	id = treasurefleet.231
	desc = EVTDESC_TREASURE_FLEET_231
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				port = yes
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_settler_province
		}
		e_china = {
			holder_scope = {
				random_realm_province = {
					limit = {
						is_connected_to = {
							sub_realm = no
							target = FROM # Hangzhou
							land_gap = no
							naval_distance = yes
						}
					}
					save_event_target_as = tf_settler_origin
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_231 # Yes!
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = tf_immigrants
					value = -1
				}
			}
			if = {
				limit = {
						has_dlc = "Reapers"
					}
				hidden_tooltip = {
					event_target:tf_settler_province = {
						change_variable = { which = prosperity_value value = 6 }
					}
				}
			}
		}
		
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.232 days = 7 random = 7 } # Got paper mill
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.233 days = 7 random = 7 } # Got fireworks guild
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.234 days = 7 random = 7 } # Got dry docks
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.235 days = 7 random = 7 } # Got administrative outpost
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				character_event = { id = treasurefleet.236 days = 7 random = 7 } # Got blast furnace
			}
			1 = {
				character_event = { id = treasurefleet.237 days = 7 random = 7 } # Rowdy newcomers
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_settler_origin = {
						religion = event_target:tf_settler_province
					}
				}
				character_event = { id = treasurefleet.238 days = 7 random = 7 } # Province converts religion
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_settler_origin = {
						culture = event_target:tf_settler_province
					}
				}
				character_event = { id = treasurefleet.239 days = 7 random = 7 } # Province converts culture
			}
			1 = {
				character_event = { id = treasurefleet.240 days = 7 random = 7 } # Nothing of note
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = paranoid
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_231 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = paranoid
				}
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = trusting
			}
		}
	}
}

# Got a paper mill
character_event = {
	id = treasurefleet.232
	desc = EVTDESC_TREASURE_FLEET_232
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_232 # That's great!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = jd_paper_mill
				years = 20
			}
		}
	}
}

# Got a fireworks guild
character_event = {
	id = treasurefleet.233
	desc = EVTDESC_TREASURE_FLEET_233
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_233 # That's great!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = jd_fireworks_guild
				years = 20
			}
		}
	}
}

# Got dry docks
character_event = {
	id = treasurefleet.234
	desc = EVTDESC_TREASURE_FLEET_234
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_234 # That's great!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = jd_dry_docks
				years = 20
			}
		}
	}
}

# Got an administrative outpost
character_event = {
	id = treasurefleet.235
	desc = EVTDESC_TREASURE_FLEET_235
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_235 # That's great!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = jd_administrative_outpost
				years = 20
			}
		}
	}
}

# Got a blast furnace
character_event = {
	id = treasurefleet.236
	desc = EVTDESC_TREASURE_FLEET_236
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_236 # That's great!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = jd_blast_furnace
				years = 20
			}
		}
	}
}

# Rowdy newcomers - revolt risk
character_event = {
	id = treasurefleet.237
	desc = EVTDESC_TREASURE_FLEET_237
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_237 # They'd better behave!
		
		event_target:tf_settler_province = {
			add_province_modifier = {
				name = peasant_unrest
				years = 10
			}
		}
	}
}

# Province converts religion
character_event = {
	id = treasurefleet.238
	desc = EVTDESC_TREASURE_FLEET_238
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion = event_target:tf_settler_origin
		}
		name = EVTOPTA_TREASURE_FLEET_238 # That's great!
		
		event_target:tf_settler_province = {
			religion = event_target:tf_settler_origin
		}
	}
	
	option = {
		trigger = {
			NOT = {
				religion = event_target:tf_settler_origin
			}
		}
		name = EVTOPTB_TREASURE_FLEET_238 # That's not good!
		
		event_target:tf_settler_province = {
			religion = event_target:tf_settler_origin
		}
	}
}

# Province converts culture
character_event = {
	id = treasurefleet.239
	desc = EVTDESC_TREASURE_FLEET_239
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			culture = event_target:tf_settler_origin
		}
		name = EVTOPTA_TREASURE_FLEET_239 # That's great!
		
		event_target:tf_settler_province = {
			culture = event_target:tf_settler_origin
		}
	}
	
	option = {
		trigger = {
			NOT = {
				culture = event_target:tf_settler_origin
			}
		}
		name = EVTOPTB_TREASURE_FLEET_239 # That's not good!
		
		event_target:tf_settler_province = {
			culture = event_target:tf_settler_origin
		}
	}
}

# Nothing of note
character_event = {
	id = treasurefleet.240
	desc = EVTDESC_TREASURE_FLEET_240
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_240 # They seem to be fitting in...
	}
}

### Sabotage fleet?

# Sabotage the fleet?
character_event = {
	id = treasurefleet.241
	desc = EVTDESC_TREASURE_FLEET_241
	picture = GFX_evt_war_planning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_241 # Yes!
		
		FROM = {
			province_event = { id = treasurefleet.242 days = 1 } # Check outcome
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_241 # No!
		
		if = {
			limit = {
				root_hates_china_trigger = yes
			}
			prestige = -50
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 0.1
				trait = wroth
			}
			modifier = {
				factor = 0.1
				trait = cruel
			}
		}
	}
}

# Check outcome
province_event = {
	id = treasurefleet.242
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						martial = 16
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						martial = 20
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						martial = 24
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							martial = 12
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							martial = 8
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							martial = 4
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 12
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 8
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 4
						}
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_army_strength
						value = 100
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_army_strength
						value = 50
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
				modifier = {
					factor = 2
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
				if = {
					limit = {
						check_variable = {
							which = treasure_fleet_ship_strength
							value = 25
						}
					}
					# Fleet still takes some damage
					90 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					9 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				# Sabotage fails
				FROM = {
					character_event = { id = treasurefleet.243 }
				}
			}
			50 = {
				modifier = {
					factor = 2
					FROM = {
						martial = 16
					}
				}
				modifier = {
					factor = 2
					FROM = {
						martial = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						martial = 24
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							martial = 12
						}
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							martial = 8
						}
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							martial = 4
						}
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							intrigue = 12
						}
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							intrigue = 8
						}
					}
				}
				modifier = {
					factor = 2
					persistent_event_target:treasure_fleet_commander = {
						NOT = {
							intrigue = 4
						}
					}
				}
				remove_or_weaken_everything_permissible_effect = yes
				random = {
					chance = 25
					remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
				}
				random = {
					chance = 10
					remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
				}
				if = {
					limit = {
						check_variable = {
							which = treasure_fleet_ship_strength
							value = 1
						}
					}
					# Sabotage succeeds
					FROM = {
						character_event = { id = treasurefleet.247 }
					}
				}
				else = {
					# Fleet destroyed!
					FROM = {
						character_event = { id = treasurefleet.251 }
					}
				}
			}
		}
	}
}

# Sabotage fails
character_event = {
	id = treasurefleet.243
	desc = EVTDESC_TREASURE_FLEET_243
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_243 # This might be bad...
		
		prestige = -100
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			detract_grace_super_huge_effect = yes
		}
		
		d_treasure_fleet = {
			holder_scope = {
				character_event = { id = treasurefleet.244 } # Inform the commander!
			}
		}
		any_player = {
			limit = {
				trait = treasure_fleet_voyage
			}
			character_event = { id = treasurefleet.245 } # Inform members
		}
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.246 } # Inform the EoC
			}
		}
	}
}

# Inform the commander and let him decide if he wants to attack
character_event = {
	id = treasurefleet.244
	desc = EVTDESC_TREASURE_FLEET_244
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROM = {
				check_variable = {
					which = treasure_fleet_army_strength
					value = 30
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_244 # FROM will pay for this!
		
		add_rival = FROM
		
		FROM = {
			save_event_target_as = treasure_fleet_attacker
			random_realm_province = {
				limit = {
					is_in_active_treasure_fleet_region_trigger = yes
				}
				save_event_target_as = treasure_fleet_beachhead
			}
		}
		create_new_court_eunuch_effect = yes
		new_character = {
			set_defacto_liege = THIS
			create_title = {
				tier = DUKE
				landless = yes
				adventurer = yes
				culture = ROOT
				name = "PUNITIVE_EXPEDITION"
				holder = THIS
				base_title = THIS
			}
			save_event_target_as = treasure_fleet_punitive_expedition_leader
			disembark_regiments_until_stronger_or_unable_to_continue_effect = yes
			war = {
				target = event_target:treasure_fleet_attacker
				casus_belli = punitive_expedition
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_244 # I can't do anything about this...
		
		add_rival = FROM
		
		prestige = -100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
}

# Inform fleet members
character_event = {
	id = treasurefleet.245
	desc = EVTDESC_TREASURE_FLEET_245
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_245 # FROM will pay for this!
		
		add_rival = FROM
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.246
	desc = EVTDESC_TREASURE_FLEET_246
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_246 # FROM will pay for this!
		
		add_rival = FROM
		
		opinion = {
			who = FROM
			modifier = opinion_attacked_treasure_fleet
		}
	}
}

# Sabotage succeeds
character_event = {
	id = treasurefleet.247
	desc = EVTDESC_TREASURE_FLEET_247
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_247 # Haha!
		
		prestige = 100
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			detract_grace_super_huge_effect = yes
		}
		
		d_treasure_fleet = {
			holder_scope = {
				character_event = { id = treasurefleet.248 } # Inform the commander!
			}
		}
		any_player = {
			limit = {
				trait = treasure_fleet_voyage
			}
			character_event = { id = treasurefleet.249 } # Inform members
		}
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.250 } # Inform the EoC
			}
		}
	}
}


# Inform the commander and let him decide if he wants to attack
character_event = {
	id = treasurefleet.248
	desc = EVTDESC_TREASURE_FLEET_248
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROM = {
				check_variable = {
					which = treasure_fleet_army_strength
					value = 30
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_248 # FROM will pay for this!
		
		add_rival = FROM
		
		FROM = {
			save_event_target_as = treasure_fleet_attacker
			random_realm_province = {
				limit = {
					is_in_active_treasure_fleet_region_trigger = yes
				}
				save_event_target_as = treasure_fleet_beachhead
			}
		}
		create_new_court_eunuch_effect = yes
		new_character = {
			set_defacto_liege = THIS
			create_title = {
				tier = DUKE
				landless = yes
				adventurer = yes
				culture = ROOT
				name = "PUNITIVE_EXPEDITION"
				holder = THIS
				base_title = THIS
			}
			save_event_target_as = treasure_fleet_punitive_expedition_leader
			disembark_regiments_until_stronger_or_unable_to_continue_effect = yes
			war = {
				target = event_target:treasure_fleet_attacker
				casus_belli = punitive_expedition
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_248 # I can't do anything about this...
		
		add_rival = FROM
		
		prestige = -100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
}

# Inform fleet members
character_event = {
	id = treasurefleet.249
	desc = EVTDESC_TREASURE_FLEET_249
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_249 # FROM will pay for this!
		
		add_rival = FROM
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.250
	desc = EVTDESC_TREASURE_FLEET_250
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_250 # FROM will pay for this!
		
		add_rival = FROM
		
		opinion = {
			who = FROM
			modifier = opinion_attacked_treasure_fleet
		}
	}
}

# Sabotage succeeded - fleet destroyed
character_event = {
	id = treasurefleet.251
	desc = EVTDESC_TREASURE_FLEET_251
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_251 # Haha!
		
		prestige = 1000
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			detract_grace_super_huge_effect = yes
		}
		
		d_treasure_fleet = {
			holder_scope = {
				character_event = { id = treasurefleet.252 } # Inform the commander!
			}
		}
		activate_title = {
			title = d_treasure_fleet
			status = no
		}
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
			}
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					ROOT = {
						is_chinese_emperor_trigger = no
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = yes # Presumably impossible
					}
					ROOT = {
						detract_grace_super_huge_effect = yes
					}
				}
				else_if = {
					limit = {
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				else_if = {
					limit = {
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			character_event = { id = treasurefleet.252 } # Inform members
		}
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.253 } # Inform the EoC
			}
		}
		any_player = {
			limit = {
				NOR = {
					character = ROOT
					trait = treasure_fleet_voyage
					has_landed_title = e_china
				}
			}
			character_event = { id = treasurefleet.254 } # Inform the word!
		}
	}
}

# Last ship destroyed - members have to swim to safety or die
character_event = {
	id = treasurefleet.252
	desc = EVTDESC_TREASURE_FLEET_252
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_252 # I must swim to safety!
		
		add_rival = FROM
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_battle
					killer = FROM
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
				FROM = {
					reverse_imprison = ROOT
				}
			}
		}
	}
}

# Inform the EoC
character_event = {
	id = treasurefleet.253
	desc = EVTDESC_TREASURE_FLEET_253
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_253 # FROM will pay for this!
		
		prestige = -1000
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
		
		add_rival = FROM
		
		opinion = {
			who = FROM
			modifier = opinion_attacked_treasure_fleet
		}
	}
}

# Inform the world
character_event = {
	id = treasurefleet.254
	desc = EVTDESC_TREASURE_FLEET_254
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_254 # I see...
	}
}

### Local might volunteer to become a tributary

# Local might make offer
character_event = {
	id = treasurefleet.255
	desc = EVTDESC_TREASURE_FLEET_255
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_255 # Yes!
		
		treasure_fleet_voyage = {
			character_event = { id = treasurefleet.256 days = 1 } # Someone gets to respond
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = ambitious
			}
			modifier = {
				factor = 0.01
				trait = proud
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes
			}
			modifier = {
				factor = 0
				higher_tier_than = duke
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_255 # No!
		
		ai_chance = {
			factor = 100
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.256
	desc = EVTDESC_TREASURE_FLEET_256
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_256 # Yes!
		
		FROM = {
			character_event = { id = treasurefleet.257 }
		}
		
		e_china = {
			holder_scope = {
				make_tributary = {
					who = ROOT
					tributary_type = chinese_peripheral_tributary
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = top_liege
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_255 # No!
		
		FROM = {
			character_event = { id = treasurefleet.258 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = top_liege
					value = 25
				}
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.257
	desc = EVTDESC_TREASURE_FLEET_257
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_257 # Great!
		
		#hidden_tooltip = {
		#	if = {
		#		limit = {
		#			has_dlc = "Jade Dragon"
		#		}
		#		character_event = { id = grace.7 days = 365 }
		#	}
		#}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.258
	desc = EVTDESC_TREASURE_FLEET_258
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_258 # Huh...
	}
}

### Local offers gold for Grace - can be accepted on behalf of the EoC or personally

# Local might make offer
character_event = {
	id = treasurefleet.259
	desc = EVTDESC_TREASURE_FLEET_259
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_259 # Yes!
		
		wealth = -100
		
		treasure_fleet_voyage = {
			character_event = { id = treasurefleet.260 days = 1 } # Someone gets to respond
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_255 # No!
		
		ai_chance = {
			factor = 100
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.260
	desc = EVTDESC_TREASURE_FLEET_260
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_260 # Yes; for the EoC!
		
		hidden_tooltip = {
			FROMFROM = {
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		FROM = {
			character_event = { id = treasurefleet.261 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = top_liege
						value = -25
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_260 # Yes; for myself!
		
		wealth = 100
		
		FROM = {
			character_event = { id = treasurefleet.261 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = top_liege
					value = 25
				}
				NOT = {
					trait = greedy
				}
			}
			modifier = {
				factor = 0.1
				trait = content
			}
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTC_TREASURE_FLEET_260 # No!
		
		FROM = {
			character_event = { id = treasurefleet.262 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = top_liege
					value = 25
				}
			}
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.261
	desc = EVTDESC_TREASURE_FLEET_261
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_261 # Great!
		
		add_grace_major_effect = yes
	}
}

# Offer refused
character_event = {
	id = treasurefleet.262
	desc = EVTDESC_TREASURE_FLEET_262
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_262 # Huh...
		
		wealth = 100
	}
}

### Local offers artifact for Grace - can only be accepted personally

# Do you wish to offer an artifact?
character_event = {
	id = treasurefleet.263
	desc = EVTDESC_TREASURE_FLEET_263
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_263 # Yes!
		
		wealth = -100
		
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_crown_of_majesty
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_emerald_scepter
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = norse_pagan
							religion = norse_pagan_reformed
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_sword_of_heroes
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_crown_of_pearls
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_ruby_scepter
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = norse_pagan
							religion = norse_pagan_reformed
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_golden_sword
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_the_lily_crown
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_noble_scepter
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = christian
							religion_group = jewish_group
							religion = norse_pagan
							religion = norse_pagan_reformed
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				set_character_flag = offering_engraved_sword
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_dagger_of_glory
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
						}
					}
				}
				set_character_flag = offering_ruby_bracelets
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_bejeweled_dagger
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
						}
					}
				}
				set_character_flag = offering_golden_bracelets
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_engraved_dagger
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = muslim 
							religion = west_african_pagan
							religion = west_african_pagan_reformed
						}
					}
				}
				set_character_flag = offering_silver_bracelets
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_celestial_necklace
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_necklace_of_radiance
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = indian_group
							religion = bon
							religion = bon_reformed
							religion = chinese_pagan
							religion = chinese_pagan_reformed
							religion = korean_pagan
							religion = korean_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
							religion = viet_pagan
							religion = viet_pagan_reformed
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				set_character_flag = offering_collar_of_pearls
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_circlet_of_the_heavens
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_staff_of_majesty
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_circlet_of_the_sun
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_golden_staff
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_circlet_of_twilight
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion_group = zoroastrian_group
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				set_character_flag = offering_silver_staff
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = norse_pagan
							religion = norse_pagan_reformed
						}
					}
				}
				set_character_flag = offering_crown_of_crows
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = norse_pagan
							religion = norse_pagan_reformed
						}
					}
				}
				set_character_flag = offering_crown_of_the_sea
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = norse_pagan
							religion = norse_pagan_reformed
						}
					}
				}
				set_character_flag = offering_iron_crown
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_heros_crown
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_axe_of_the_ancestors
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_amber_crown
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_obsidian_axe
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_engraved_crown
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							religion = slavic_pagan
							religion = slavic_pagan_reformed
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = inca_religion
							religion = inca_religion_reformed
						}
					}
				}
				set_character_flag = offering_ceremonial_axe
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_sword_tier_1_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_sword_tier_2_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_sword_tier_3_heartseeker
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_sword_tier_3_vengeance
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_sword_tier_3_fury
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_scimitar_tier_1_new
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_scimitar_tier_2_new
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_scimitar_tier_3_golden
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_scimitar_tier_3_fortune
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						religion_group = muslim
						AND = {
							has_dharmic_religion_trigger = yes
							NAND = {
								religion = buddhist
								culture_group = japonic
							}
						}
					}
				}
				set_character_flag = offering_scimitar_tier_3_conquest
			}
			1 = {
				set_character_flag = offering_lance_tier_1_new
			}
			1 = {
				set_character_flag = offering_lance_tier_2_new
			}
			1 = {
				set_character_flag = offering_lance_tier_3_impaler
			}
			1 = {
				set_character_flag = offering_lance_tier_3_trident
			}
			1 = {
				set_character_flag = offering_lance_tier_3_piercer
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for axes!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_axe_tier_1_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for axes!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_axe_tier_2_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for axes!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_axe_tier_3_cleaver
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for axes!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_axe_tier_3_ravager
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for axes!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_axe_tier_3_marauder
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for maces!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_mace_tier_1_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for maces!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_mace_tier_2_new
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for maces!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_mace_tier_3_foe_hammer
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for maces!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_mace_tier_3_bone_breaker
			}
			1 = {
				modifier = {
					factor = 0
					OR = { # These shouldn't go for maces!
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_mace_tier_3_shatterer
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						is_nomadic = yes
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_bow_tier_1_new
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						is_nomadic = yes
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_bow_tier_2_new
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						is_nomadic = yes
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_bow_tier_3_silent_wind
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						is_nomadic = yes
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_bow_tier_3_lightning
			}
			1 = {
				modifier = {
					factor = 0
					NOR = {
						is_nomadic = yes
						religion = shinto
						AND = {
							religion = buddhist
							culture_group = japonic
						}
						religion = tengri_pagan
						religion = tengri_pagan_reformed
					}
				}
				set_character_flag = offering_bow_tier_3_eagle
			}
			1 = {
				set_character_flag = offering_armor_tier_1
			}
			1 = {
				set_character_flag = offering_armor_tier_2
			}
			1 = {
				set_character_flag = offering_armor_tier_3_guardian
			}
			1 = {
				set_character_flag = offering_armor_tier_3_champion
			}
			1 = {
				set_character_flag = offering_armor_tier_3_warden
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Holy Fury"
					}
				}
				set_character_flag = offering_random_world_sword
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Holy Fury"
					}
				}
				set_character_flag = offering_random_world_armor
			}
		}
		
		treasure_fleet_voyage = {
			character_event = { id = treasurefleet.264 } # Someone gets to respond
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_255 # No!
		
		ai_chance = {
			factor = 100
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.264
	desc = EVTDESC_TREASURE_FLEET_264
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_264 # Yes!
		
		if = {
			limit = {
				FROM = {
					has_character_flag = offering_crown_of_majesty
				}
			}
			add_artifact = crown_of_majesty
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_crown_of_majesty
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_emerald_scepter
				}
			}
			add_artifact = emerald_scepter
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_emerald_scepter
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_of_heroes
				}
			}
			add_artifact = sword_of_heroes
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_of_heroes
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_crown_of_pearls
				}
			}
			add_artifact = crown_of_pearls
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_crown_of_pearls
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_ruby_scepter
				}
			}
			add_artifact = ruby_scepter
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_ruby_scepter
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_golden_sword
				}
			}
			add_artifact = golden_sword
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_golden_sword
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_the_lily_crown
				}
			}
			add_artifact = the_lily_crown
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_the_lily_crown
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_noble_scepter
				}
			}
			add_artifact = noble_scepter
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_noble_scepter
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_engraved_sword
				}
			}
			add_artifact = engraved_sword
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_engraved_sword
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_dagger_of_glory
				}
			}
			add_artifact = dagger_of_glory
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_dagger_of_glory
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_ruby_bracelets
				}
			}
			add_artifact = ruby_bracelets
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_ruby_bracelets
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bejeweled_dagger
				}
			}
			add_artifact = bejeweled_dagger
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bejeweled_dagger
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_golden_bracelets
				}
			}
			add_artifact = golden_bracelets
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_golden_bracelets
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_engraved_dagger
				}
			}
			add_artifact = engraved_dagger
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_engraved_dagger
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_silver_bracelets
				}
			}
			add_artifact = silver_bracelets
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_silver_bracelets
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_celestial_necklace
				}
			}
			add_artifact = celestial_necklace
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_celestial_necklace
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_necklace_of_radiance
				}
			}
			add_artifact = necklace_of_radiance
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_necklace_of_radiance
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_collar_of_pearls
				}
			}
			add_artifact = collar_of_pearls
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_collar_of_pearls
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_circlet_of_the_heavens
				}
			}
			add_artifact = circlet_of_the_heavens
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_circlet_of_the_heavens
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_staff_of_majesty
				}
			}
			add_artifact = staff_of_majesty
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_staff_of_majesty
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_circlet_of_the_sun
				}
			}
			add_artifact = circlet_of_the_sun
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_circlet_of_the_sun
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_golden_staff
				}
			}
			add_artifact = golden_staff
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_golden_staff
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_circlet_of_twilight
				}
			}
			add_artifact = circlet_of_twilight
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_circlet_of_twilight
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_silver_staff
				}
			}
			add_artifact = silver_staff
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_silver_staff
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_crown_of_crows
				}
			}
			add_artifact = crown_of_crows
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_crown_of_crows
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_crown_of_the_sea
				}
			}
			add_artifact = crown_of_the_sea
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_crown_of_the_sea
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_iron_crown
				}
			}
			add_artifact = iron_crown
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_iron_crown
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_heros_crown
				}
			}
			add_artifact = heros_crown
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_heros_crown
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_of_the_ancestors
				}
			}
			add_artifact = axe_of_the_ancestors
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_of_the_ancestors
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_amber_crown
				}
			}
			add_artifact = amber_crown
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_amber_crown
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_obsidian_axe
				}
			}
			add_artifact = obsidian_axe
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_obsidian_axe
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_engraved_crown
				}
			}
			add_artifact = engraved_crown
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_engraved_crown
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_ceremonial_axe
				}
			}
			add_artifact = ceremonial_axe
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_ceremonial_axe
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_tier_1_new
				}
			}
			add_artifact = sword_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_tier_2_new
				}
			}
			add_artifact = sword_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_tier_3_heartseeker
				}
			}
			add_artifact = sword_tier_3_heartseeker
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_tier_3_heartseeker
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_tier_3_vengeance
				}
			}
			add_artifact = sword_tier_3_vengeance
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_tier_3_vengeance
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_sword_tier_3_fury
				}
			}
			add_artifact = sword_tier_3_fury
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_sword_tier_3_fury
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_scimitar_tier_1_new
				}
			}
			add_artifact = scimitar_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_scimitar_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_scimitar_tier_2_new
				}
			}
			add_artifact = scimitar_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_scimitar_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_scimitar_tier_3_golden
				}
			}
			add_artifact = scimitar_tier_3_golden
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_scimitar_tier_3_golden
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_scimitar_tier_3_fortune
				}
			}
			add_artifact = scimitar_tier_3_fortune
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_scimitar_tier_3_fortune
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_scimitar_tier_3_conquest
				}
			}
			add_artifact = scimitar_tier_3_conquest
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_scimitar_tier_3_conquest
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_lance_tier_1_new
				}
			}
			add_artifact = lance_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_lance_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_lance_tier_2_new
				}
			}
			add_artifact = lance_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_lance_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_lance_tier_3_impaler
				}
			}
			add_artifact = lance_tier_3_impaler
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_lance_tier_3_impaler
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_lance_tier_3_trident
				}
			}
			add_artifact = lance_tier_3_trident
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_lance_tier_3_trident
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_lance_tier_3_piercer
				}
			}
			add_artifact = lance_tier_3_piercer
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_lance_tier_3_piercer
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_tier_1_new
				}
			}
			add_artifact = axe_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_tier_2_new
				}
			}
			add_artifact = axe_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_tier_3_cleaver
				}
			}
			add_artifact = axe_tier_3_cleaver
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_tier_3_cleaver
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_tier_3_ravager
				}
			}
			add_artifact = axe_tier_3_ravager
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_tier_3_ravager
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_axe_tier_3_marauder
				}
			}
			add_artifact = axe_tier_3_marauder
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_axe_tier_3_marauder
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_mace_tier_1_new
				}
			}
			add_artifact = mace_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_mace_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_mace_tier_2_new
				}
			}
			add_artifact = mace_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_mace_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_mace_tier_3_foe_hammer
				}
			}
			add_artifact = mace_tier_3_foe_hammer
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_mace_tier_3_foe_hammer
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_mace_tier_3_bone_breaker
				}
			}
			add_artifact = mace_tier_3_bone_breaker
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_mace_tier_3_bone_breaker
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_mace_tier_3_shatterer
				}
			}
			add_artifact = mace_tier_3_shatterer
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_mace_tier_3_shatterer
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bow_tier_1_new
				}
			}
			add_artifact = bow_tier_1_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bow_tier_1_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bow_tier_2_new
				}
			}
			add_artifact = bow_tier_2_new
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bow_tier_2_new
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bow_tier_3_silent_wind
				}
			}
			add_artifact = bow_tier_3_silent_wind
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bow_tier_3_silent_wind
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bow_tier_3_lightning
				}
			}
			add_artifact = bow_tier_3_lightning
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bow_tier_3_lightning
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_bow_tier_3_eagle
				}
			}
			add_artifact = bow_tier_3_eagle
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_bow_tier_3_eagle
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_armor_tier_1
				}
			}
			add_artifact = armor_tier_1
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_armor_tier_1
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_armor_tier_2
				}
			}
			add_artifact = armor_tier_2
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_armor_tier_2
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_armor_tier_3_guardian
				}
			}
			add_artifact = armor_tier_3_guardian
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_armor_tier_3_guardian
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_armor_tier_3_champion
				}
			}
			add_artifact = armor_tier_3_champion
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_armor_tier_3_champion
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_armor_tier_3_warden
				}
			}
			add_artifact = armor_tier_3_warden
			new_artifact = {
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_armor_tier_3_warden
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_random_world_sword
				}
			}
			add_artifact = random_world_sword
			new_artifact = {
				random_list = {
					10 = {
						set_name="random_world_sword_1_FROM"
						set_description = "random_world_sword_desc_1"
					}
					10 = {
						set_name="random_world_sword_2_FROM"
						set_description = "random_world_sword_desc_2"
					}
					10 = {
						set_name="random_world_sword_3_FROM"
						set_description = "random_world_sword_desc_3"
					}
					10 = {
						set_name="random_world_sword_4_FROM"
						set_description = "random_world_sword_desc_4"
					}
					10 = {
						set_name="random_world_sword_5_FROM"
						set_description = "random_world_sword_desc_5"
					}
					10 = {
						set_name="random_world_sword_6_FROM"
						set_description = "random_world_sword_desc_6"
					}
				}
				random_list = {
					10 = {
						set_picture = "GFX_sword_golden"
					}
					10 = {
						set_picture = "GFX_sword_of_heroes"
					}
					10 = {
						set_picture = "GFX_sword_engraved"
					}
					10 = {
						set_picture = "GFX_sword_T3_glow_green"
					}
					10 = {
						set_picture = "GFX_sword_T3_glow_purple"
					}
					10 = {
						set_picture = "GFX_sword_T3_glow_red"
					}
				}
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_random_world_sword
			}
		}
		else_if = {
			limit = {
				FROM = {
					has_character_flag = offering_random_world_armor
				}
			}
			add_artifact = random_world_armor
			new_artifact = {
				random_list = {
						10 = {
							set_name="random_world_armor_1_FROM"
							set_description = "random_world_armor_desc_1"
						}
						10 = {
							set_name="random_world_armor_2_FROM"
							set_description = "random_world_armor_desc_2"
						}
						10 = {
							set_name="random_world_armor_3_FROM"
							set_description = "random_world_armor_desc_3"
						}
						10 = {
							set_name="random_world_armor_4_FROM"
							set_description = "random_world_armor_desc_4"
						}
						10 = {
							set_name="random_world_armor_5_FROM"
							set_description = "random_world_armor_desc_5"
						}
				}
				random_list = {
					10 = {
						set_picture = "GFX_guardian_armor"
					}
					10 = {
						set_picture = "GFX_champion_armor"
					}
					10 = {
						set_picture = "GFX_warden_armor"
					}
				}
				set_original_owner = FROM
			}
			FROM = {
				clr_character_flag = offering_random_world_armor
			}
		}
		
		FROM = {
			character_event = { id = treasurefleet.265 }
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_264 # No!
		
		FROM = {
			character_event = { id = treasurefleet.266 }
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.265
	desc = EVTDESC_TREASURE_FLEET_265
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_265 # Great!
		
		add_grace_major_effect = yes
	}
}

# Offer refused
character_event = {
	id = treasurefleet.266
	desc = EVTDESC_TREASURE_FLEET_266
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_266 # Huh...
		
		wealth = 100
	}
}

### Sympathy for local

# Gain sympathy
character_event = {
	id = treasurefleet.267
	desc = EVTDESC_TREASURE_FLEET_267
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							religion_group = ROOT
						}
					}
					save_event_target_as = tf_sympathy_target
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_267 # Great!
		
		if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = christian
				}
			}
			add_trait = sympathy_christendom
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = jewish_group
				}
			}
			add_trait = sympathy_judaism
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = muslim
				}
			}
			add_trait = sympathy_islam
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = indian_group
				}
			}
			add_trait = sympathy_indian
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = zoroastrian_group
				}
			}
			add_trait = sympathy_zoroastrianism
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = pagan_group
				}
			}
			add_trait = sympathy_pagans
		}
	}
}

### Gain random Chinese courtier

# Hidden event to see what you get
character_event = {
	id = treasurefleet.268
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						FROM = {
							check_variable = {
								which = tf_soldier
								value = 1
							}
						}
					}
				}
				# Soldier
				FROM = {
					change_variable = {
						which = tf_soldier
						value = -1
					}
				}
				character_event = { id = treasurefleet.269 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						FROM = {
							check_variable = {
								which = tf_eunuch
								value = 1
							}
						}
					}
				}
				# Soldier
				FROM = {
					change_variable = {
						which = tf_soldier
						value = -1
					}
				}
				character_event = { id = treasurefleet.270 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						FROM = {
							check_variable = {
								which = tf_courtesan
								value = 1
							}
						}
					}
				}
				# Courtesan
				FROM = {
					change_variable = {
						which = tf_courtesan
						value = -1
					}
				}
				character_event = { id = treasurefleet.271 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						FROM = {
							check_variable = {
								which = tf_scholar
								value = 1
							}
						}
					}
				}
				# Scholar
				FROM = {
					change_variable = {
						which = tf_scholar
						value = -1
					}
				}
				character_event = { id = treasurefleet.272 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						FROM = {
							check_variable = {
								which = tf_noble
								value = 1
							}
						}
					}
				}
				# Noble
				FROM = {
					change_variable = {
						which = tf_noble
						value = -1
					}
				}
				character_event = { id = treasurefleet.273 }
			}
		}
	}
}

# Gain courtier - young soldier
character_event = {
	id = treasurefleet.269
	desc = EVTDESC_TREASURE_FLEET_269
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		create_random_soldier = {
			age = 21
			female = no
			dynasty = none
			attributes = {
				diplomacy = 2
				martial = 7
				stewardship = 5
				intrigue = 4
				learning = 6
			}
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			random_traits =	yes
		}
		new_character = {
			random = {
				chance = 25
				random_list = {
					1 = {
						add_trait = logistics_expert
					}
					1 = {
						add_trait = master_of_flame
					}
					1 = {
						add_trait = sapper
					}
					1 = {
						add_trait = levy_coordinator
					}
				}
			}
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_269 # He's welcome here!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_269 # I don't like him!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Gain courtier - eunuch
character_event = {
	id = treasurefleet.270
	desc = EVTDESC_TREASURE_FLEET_270
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_random_priest = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 4
						martial = 2
						stewardship = 5
						intrigue = 4
						learning = 8
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_steward = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 3
						martial = 3
						stewardship = 8
						intrigue = 4
						learning = 6
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_diplomat = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 8
						martial = 1
						stewardship = 5
						intrigue = 4
						learning = 6
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			add_trait = eunuch
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_270 # He's welcome here!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_270 # I don't like him!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Gain courtier - young courtesan
character_event = {
	id = treasurefleet.271
	desc = EVTDESC_TREASURE_FLEET_271
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_random_intriguer = {
					age = 19
					female = yes
					dynasty = none
					attributes = {
						diplomacy = 6
						martial = 1
						stewardship = 4
						intrigue = 8
						learning = 2
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_diplomat = {
					age = 19
					female = yes
					dynasty = none
					attributes = {
						diplomacy = 8
						martial = 1
						stewardship = 5
						intrigue = 6
						learning = 5
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			remove_all_negative_congenital_traits_effect = yes
			add_trait = fair
			remove_trait = chaste
			remove_trait = celibate
			add_trait = lustful
			if = {
				limit = {
					has_dlc = "Way of Life"
				}
				random_list = {
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = gamer
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = hedonist
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = seductress
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = scholar
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = socializer
					}
					1 = {
						# Leave existing lifestyle
					}
				}
			}
			random = {
				chance = 5
				add_trait = homosexual
			}
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_271 # She's welcome here!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_271 # I don't like her!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Gain courtier - old scholar
character_event = {
	id = treasurefleet.272
	desc = EVTDESC_TREASURE_FLEET_272
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		create_random_priest = {
			age = 65
			female = no
			dynasty = none
			attributes = {
				diplomacy = 5
				martial = 1
				stewardship = 6
				intrigue = 4
				learning = 8
			}
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			trait = scholar
			random_traits =	yes
		}
		new_character = {
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_272 # He's welcome here!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_272 # I don't like him!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Gain courtier - random noble
character_event = {
	id = treasurefleet.273
	desc = EVTDESC_TREASURE_FLEET_273
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_character = {
					age = 35
					female = no
					dynasty = random
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_character = {
					age = 35
					female = yes
					dynasty = random
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_273 # They're welcome here!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_273 # I don't like them!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

### Tech spread

# Hidden event to see what we got
character_event = {
	id = treasurefleet.274
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				port = yes
				is_in_active_treasure_fleet_region_trigger = yes
				treasure_fleet_tech_can_spread_here_trigger = yes
			}
			save_event_target_as = tf_tech_spread_province
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_infantry_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.275 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_cavalry_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.276 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_skirmish_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.277 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_melee_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.278 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_siege_equipment_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.279 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_recruitment_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.280 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_castle_construction_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.281 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_city_construction_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.282 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_fortifications_construction_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.283 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_trade_practices_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.284 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_construction_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.285 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_naval_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.286 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_noble_customs_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.287 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_popular_customs_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.288 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_religious_customs_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.289 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_majesty_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.290 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_culture_flex_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.291 }
			}
			1 = {
				modifier = {
					factor = 0
					event_target:tf_tech_spread_province = {
						treasure_fleet_tech_legalism_can_spread_here_trigger = no
					}
				}
				character_event = { id = treasurefleet.292 }
			}
		}
	}
}

# Got Infantry increase
character_event = {
	id = treasurefleet.275
	desc = EVTDESC_TREASURE_FLEET_275
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_275 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_INFANTRY
				value = 1
			}
		}
	}
}

# Got Cavalry increase
character_event = {
	id = treasurefleet.276
	desc = EVTDESC_TREASURE_FLEET_276
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_276 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_CAVALRY
				value = 1
			}
		}
	}
}

# Got Skirmish increase
character_event = {
	id = treasurefleet.277
	desc = EVTDESC_TREASURE_FLEET_277
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_277 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_SKIRMISH
				value = 1
			}
		}
	}
}

# Got Melee increase
character_event = {
	id = treasurefleet.278
	desc = EVTDESC_TREASURE_FLEET_278
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_278 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_MELEE
				value = 1
			}
		}
	}
}

# Got Siege Equipment increase
character_event = {
	id = treasurefleet.279
	desc = EVTDESC_TREASURE_FLEET_279
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_279 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_SIEGE_EQUIPMENT
				value = 1
			}
		}
	}
}

# Got Military Organization increase
character_event = {
	id = treasurefleet.280
	desc = EVTDESC_TREASURE_FLEET_280
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_280 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_RECRUITMENT
				value = 1
			}
		}
	}
}

# Got Castle Infrastructure increase
character_event = {
	id = treasurefleet.281
	desc = EVTDESC_TREASURE_FLEET_281
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_281 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_CASTLE_CONSTRUCTION
				value = 1
			}
		}
	}
}

# Got City and Temple increase
character_event = {
	id = treasurefleet.282
	desc = EVTDESC_TREASURE_FLEET_282
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_282 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_CITY_CONSTRUCTION
				value = 1
			}
		}
	}
}

# Got Improved Keeps increase
character_event = {
	id = treasurefleet.283
	desc = EVTDESC_TREASURE_FLEET_283
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_283 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_FORTIFICATIONS_CONSTRUCTION
				value = 1
			}
		}
	}
}

# Got Trade Practices increase
character_event = {
	id = treasurefleet.284
	desc = EVTDESC_TREASURE_FLEET_284
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_284 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_TRADE_PRACTICES
				value = 1
			}
		}
	}
}

# Got Construction increase
character_event = {
	id = treasurefleet.285
	desc = EVTDESC_TREASURE_FLEET_285
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_285 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_CONSTRUCTION
				value = 1
			}
		}
	}
}

# Got Shipbuilding increase
character_event = {
	id = treasurefleet.286
	desc = EVTDESC_TREASURE_FLEET_286
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_286 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_NAVAL
				value = 1
			}
		}
	}
}

# Got Noble Customs increase
character_event = {
	id = treasurefleet.287
	desc = EVTDESC_TREASURE_FLEET_287
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_287 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_NOBLE_CUSTOMS
				value = 1
			}
		}
	}
}

# Got Popular Customs increase
character_event = {
	id = treasurefleet.288
	desc = EVTDESC_TREASURE_FLEET_288
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_288 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_POPULAR_CUSTOMS
				value = 1
			}
		}
	}
}

# Got Religious Customs increase
character_event = {
	id = treasurefleet.289
	desc = EVTDESC_TREASURE_FLEET_289
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_289 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_RELIGIOUS_CUSTOMS
				value = 1
			}
		}
	}
}

# Got Majesty increase
character_event = {
	id = treasurefleet.290
	desc = EVTDESC_TREASURE_FLEET_290
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_290 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_MAJESTY
				value = 1
			}
		}
	}
}

# Got Tolerance increase
character_event = {
	id = treasurefleet.291
	desc = EVTDESC_TREASURE_FLEET_291
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_291 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_CULTURE_FLEX
				value = 1
			}
		}
	}
}

# Got Legalism increase
character_event = {
	id = treasurefleet.292
	desc = EVTDESC_TREASURE_FLEET_292
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_292 # Great!
		
		event_target:tf_tech_spread_province = {
			change_tech = {
				technology = TECH_LEGALISM
				value = 1
			}
		}
	}
}

### Invite guests?

# Offer to invite guest over?
character_event = {
	id = treasurefleet.293
	desc = EVTDESC_TREASURE_FLEET_293
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	immediate = {
		treasure_fleet_voyage = {
			limit = {
				NOT = {
					has_any_opinion_modifier = opinion_tf_guest
				}
			}
			opinion = {
				who = ROOT
				modifier = opinion_tf_guest
				months = 1
			}
		}
		treasure_fleet_voyage = {
			limit = {
				NOT = {
					has_any_opinion_modifier = opinion_tf_guest
				}
			}
			opinion = {
				who = ROOT
				modifier = opinion_tf_guest
				months = 1
			}
		}
		treasure_fleet_voyage = {
			limit = {
				NOT = {
					has_any_opinion_modifier = opinion_tf_guest
				}
			}
			opinion = {
				who = ROOT
				modifier = opinion_tf_guest
				months = 1
			}
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_293 # Yes!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			character_event = { id = treasurefleet.294 }
		}
		character_event = { id = treasurefleet.295 days = 5 }
		
		wealth = -10
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_293 # No!
		
		prestige = -10
		
		ai_chance = {
			factor = 0
		}
	}
}

# Offer is made - guests
character_event = {
	id = treasurefleet.294
	desc = EVTDESC_TREASURE_FLEET_294
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_294 # Sounds good!
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_294 # Nah!
		
		remove_opinion = {
			who = FROM
			modifier = opinion_tf_guest
		}
		
		prestige = -10
		
		ai_chance = {
			factor = 0
		}
	}
}

# Check to see what happened
character_event = {
	id = treasurefleet.295
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_opinion_modifier_target = {
					has_opinion_modifier = {
						who = ROOT
						modifier = opinion_tf_guest
					}
				}
			}
			character_event = { id = treasurefleet.297 }
		}
		else = {
			character_event = { id = treasurefleet.296 }
		}
	}
}

# All guests refused
character_event = {
	id = treasurefleet.296
	desc = EVTDESC_TREASURE_FLEET_296
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_296 # Curses!
		
		prestige = -25
	}
}

# At least one guest accepted - guests arrives
character_event = {
	id = treasurefleet.297
	desc = EVTDESC_TREASURE_FLEET_297
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_297 # Welcome! Welcome!
		
		prestige = 10
		
		character_event = { id = treasurefleet.299 days = 2 random = 2 }
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			character_event = { id = treasurefleet.298 }
		}
	}
}

# Guests arrive - guests
character_event = {
	id = treasurefleet.298
	desc = EVTDESC_TREASURE_FLEET_298
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_298 # Time for a feast!
	}
}

# Let's see what happens
character_event = {
	id = treasurefleet.299
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				# Friendship with guest
				character_event = { id = treasurefleet.300 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
						}
					}
				}
				# Rivalry with guest
				character_event = { id = treasurefleet.302 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							NOR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
								any_rival = {
									character = ROOT
								}
							}
							OR = {
								AND = {
									ROOT = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
									is_female = yes
									NOT = {
										trait = homosexual
									}
								}
								AND = {
									ROOT = {
										is_female = yes
										NOT = {
											trait = homosexual
										}
									}
									is_female = no
									NOT = {
										trait = homosexual
									}
								}
								AND = {
									ROOT = {
										is_female = yes
										trait = homosexual
									}
									is_female = yes
									trait = homosexual
								}
								AND = {
									ROOT = {
										is_female = no
										trait = homosexual
									}
									is_female = no
									trait = homosexual
								}
							}
						}
					}
				}
				# Possible tumbling
				character_event = { id = treasurefleet.305 }
			}
			1 = {
				# Embarrassing host
				character_event = { id = treasurefleet.311 }
			}
			1 = {
				# Embarrassing guest
				character_event = { id = treasurefleet.313 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							OR = {
								NOT = {
									trait = temperate
								}
								trait = drunkard
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						has_dlc = "Jade Dragon"
					}
				}
				# Drunk guest offers free Grace
				character_event = { id = treasurefleet.315 }
			}
			1 = {
				modifier = {
					factor = 0
					NAND = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							OR = {
								NOT = {
									trait = temperate
								}
								trait = drunkard
							}
						}
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				# Drunk guest offers lower tributary tier
				character_event = { id = treasurefleet.317 }
			}
			1 = {
				modifier = {
					factor = 0
					NAND = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							OR = {
								NOT = {
									trait = temperate
								}
								trait = drunkard
							}
						}
					}
				}
				modifier = {
					factor = 0
					treasure_fleet_has_artifacts_trigger = no
				}
				# Drunk guest offers free artifact
				random_opinion_modifier_target = {
					limit = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_tf_guest
						}
						OR = {
							NOT = {
								trait = temperate
							}
							trait = drunkard
						}
					}
					character_event = { id = treasurefleet.319 }
				}
			}
			1 = {
				# Guest and courtier become friends
				character_event = { id = treasurefleet.321 }
			}
			1 = {
				# Guest and courtier become rivals
				character_event = { id = treasurefleet.323 }
			}
			1 = {
				# Host accidentally insults China
				character_event = { id = treasurefleet.325 }
			}
			1 = {
				# Host might imprison guest
				character_event = { id = treasurefleet.327 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							ai = yes # Don't want this to happen to the player
						}
					}
				}
				# Guest chokes on food
				character_event = { id = treasurefleet.334 }
			}
			1 = {
				# Uneventful feast
				character_event = { id = treasurefleet.336 }
			}
			1 = {
				modifier = {
					factor = 0
					trait = zealous
				}
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							NOT = {
								religion_group = ROOT
							}
						}
					}
				}
				# Host gains sympathy
				character_event = { id = treasurefleet.338 }
			}
			1 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_tf_guest
							}
							NOR = {
								religion_group = ROOT
								trait = zealous
							}
						}
					}
				}
				# Guest gains sympathy
				random_opinion_modifier_target = {
					limit = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_tf_guest
						}
						NOR = {
							religion_group = ROOT
							trait = zealous
						}
					}
					character_event = { id = treasurefleet.339 }
				}
			}
		}
		character_event = { id = treasurefleet.340 days = 5 random = 2 }
	}
}

# Friendship with guest
character_event = {
	id = treasurefleet.300
	desc = EVTDESC_TREASURE_FLEET_300
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_300 # That's great!
		
		add_friend = event_target:tf_feast_event_target
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.301 }
		}
	}
}

# Inform guest about friendship
character_event = {
	id = treasurefleet.301
	desc = EVTDESC_TREASURE_FLEET_301
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_301 # That's great!
		
		add_friend = FROM
	}
}

# Rivalry with guest
character_event = {
	id = treasurefleet.302
	desc = EVTDESC_TREASURE_FLEET_302
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_302 # I never should have invited them!
		
		add_friend = event_target:tf_feast_event_target
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.303 }
		}
	}
}

# Inform guest about rivalry
character_event = {
	id = treasurefleet.303
	desc = EVTDESC_TREASURE_FLEET_303
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_303 # I never should have accepted that invite!
		
		add_rival = FROM
	}
}

# 304 isn't a real number!

# Attractive guest - attempt to tumble?
character_event = {
	id = treasurefleet.305
	desc = EVTDESC_TREASURE_FLEET_305
	picture = GFX_evt_dancing
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
				OR = {
					AND = {
						ROOT = {
							is_female = no
							NOT = {
								trait = homosexual
							}
						}
						is_female = yes
						NOT = {
							trait = homosexual
						}
					}
					AND = {
						ROOT = {
							is_female = yes
							NOT = {
								trait = homosexual
							}
						}
						is_female = no
						NOT = {
							trait = homosexual
						}
					}
					AND = {
						ROOT = {
							is_female = yes
							trait = homosexual
						}
						is_female = yes
						trait = homosexual
					}
					AND = {
						ROOT = {
							is_female = no
							trait = homosexual
						}
						is_female = no
						trait = homosexual
					}
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_305 # Yes!
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.306 days = 1 } # Other party approached
		}
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				event_target:tf_feast_event_target = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				event_target:tf_feast_event_target = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_305 # I don't think so!
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Guest approached
character_event = {
	id = treasurefleet.306
	desc = EVTDESC_TREASURE_FLEET_306
	picture = GFX_evt_dancing
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_306 # Yes!
		
		FROM = {
			character_event = { id = treasurefleet.308 } # FROM informed
		}
		unprotected_sex_effect = yes
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_306 # I don't think so!
		
		FROM = {
			character_event = { id = treasurefleet.307 } # FROM informed
		}
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Tumbling didn't happen
character_event = {
	id = treasurefleet.307
	desc = EVTDESC_TREASURE_FLEET_307
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_307 # I see...
		
		prestige = -25
	}
}

# Seduction succeeded - lovers?
character_event = {
	id = treasurefleet.308
	desc = EVTDESC_TREASURE_FLEET_308
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_308 # We should do this again!
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = treasurefleet.309 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_308 # This shouldn't become a long-term thing...
		
		FROM = {
			character_event = { id = treasurefleet.310 days = 1 } # Inform FROM
		}
	}
}

# Lovers
character_event = {
	id = treasurefleet.309
	desc = EVTDESC_TREASURE_FLEET_309
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_309 # That's great!
		
		add_lover = FROM
	}
}

# Not lovers
character_event = {
	id = treasurefleet.310
	desc = EVTDESC_TREASURE_FLEET_310
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_310 # Perhaps that's for the best...
	}
}

# Host is an embarrasment - host
character_event = {
	id = treasurefleet.311
	desc = EVTDESC_TREASURE_FLEET_311
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_311 # I misspoke...
		
		prestige = -25
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			character_event = { id = treasurefleet.312 }
		}
	}
}

# Host is an embarrasment - guests
character_event = {
	id = treasurefleet.312
	desc = EVTDESC_TREASURE_FLEET_312
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_312 # How embarrasing!
	}
}

# Guest is an embarrasment - host
character_event = {
	id = treasurefleet.313
	desc = EVTDESC_TREASURE_FLEET_313
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_313 # How embarrasing!
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.314 }
		}
	}
}

# Guest is an embarrasment - guest
character_event = {
	id = treasurefleet.314
	desc = EVTDESC_TREASURE_FLEET_314
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_301 # I misspoke...
		
		prestige = -25
	}
}

# Drunk guest offers free Grace - host
character_event = {
	id = treasurefleet.315
	desc = EVTDESC_TREASURE_FLEET_315
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
				OR = {
					NOT = {
						trait = temperate
					}
					trait = drunkard
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_315 # That's great!
		
		add_grace_massive_effect = yes
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.316 }
		}
	}
}

# Drunk guest offered free Grace - guest
character_event = {
	id = treasurefleet.316
	desc = EVTDESC_TREASURE_FLEET_316
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_316 # Oops...
		
		prestige = -50
	}
}

# Drunk guest offers lower tributary tier - host
character_event = {
	id = treasurefleet.317
	desc = EVTDESC_TREASURE_FLEET_317
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
				OR = {
					NOT = {
						trait = temperate
					}
					trait = drunkard
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_317 # Don't look a gift horse in the mouth...
		
		decrease_tributary_tier_or_release_effect = yes
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.318 }
		}
	}
}

# Offer accepted - guest
character_event = {
	id = treasurefleet.318
	desc = EVTDESC_TREASURE_FLEET_318
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_318 # I really screwed up...
		
		prestige = -100
	}
}

# Drunk guest offered free artifact - guest
character_event = {
	id = treasurefleet.319
	desc = EVTDESC_TREASURE_FLEET_319
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_319 # Um, oops?
		
		FROM = {
			character_event = { id = treasurefleet.320 }
		}
		
		prestige = -50
	}
}

# Drunk guest offers free artifact
character_event = {
	id = treasurefleet.320
	desc = EVTDESC_TREASURE_FLEET_320
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_320 # I'll take it!
		gift_random_artifact_effect = yes
	}
}

# Guest and courtier develop friendship - host
character_event = {
	id = treasurefleet.321
	desc = EVTDESC_TREASURE_FLEET_321
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			save_event_target_as = tf_feast_event_target
		}
		random_courtier = {
			limit = {
				is_inaccessible_or_incapable_trigger = no
				is_landed = no
			}
			save_event_target_as = tf_feast_event_target_2
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_321 # That's great!
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.322 }
		}
	}
}

# Guest and courtier develop friendship - guest
character_event = {
	id = treasurefleet.322
	desc = EVTDESC_TREASURE_FLEET_322
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_322 # That's great!
		
		add_friend = event_target:tf_feast_event_target_2
	}
}

# Guest and courtier develop rivalry - host
character_event = {
	id = treasurefleet.323
	desc = EVTDESC_TREASURE_FLEET_323
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			save_event_target_as = tf_feast_event_target
		}
		random_courtier = {
			limit = {
				is_inaccessible_or_incapable_trigger = no
				is_landed = no
			}
			save_event_target_as = tf_feast_event_target_2
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_323 # I see...
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.324 }
		}
	}
}

# Guest and courtier develop rivalry - guest
character_event = {
	id = treasurefleet.324
	desc = EVTDESC_TREASURE_FLEET_324
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_324 # I'll remember this!
		
		add_rival = event_target:tf_feast_event_target_2
	}
}

# Host accidentally insults China - host
character_event = {
	id = treasurefleet.325
	desc = EVTDESC_TREASURE_FLEET_325
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_325 # I made a mistake...
		
		prestige = -100
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			detract_grace_major_effect = yes
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			character_event = { id = treasurefleet.326 }
		}
	}
}

# Host accidentally insults China - guest
character_event = {
	id = treasurefleet.326
	desc = EVTDESC_TREASURE_FLEET_326
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_326 # How rude!
	}
}

# Host sees the opportunity to imprison guest - host
character_event = {
	id = treasurefleet.327
	desc = EVTDESC_TREASURE_FLEET_327
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
			}
			preferred_limit = {
				any_rival = {
					character = ROOT
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_327 # Yes!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = {
				limit = {
					event_target:tf_feast_event_target = {
						is_chinese_emperor_trigger = yes # Impossible, unless something weird has happened...
					}
				}
				detract_grace_super_huge_effect = yes
			}
			else_if = {
				limit = {
					event_target:tf_feast_event_target = {
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_massive_effect = yes
			}
			else_if = {
				limit = {
					event_target:tf_feast_event_target = {
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				detract_grace_major_effect = yes
			}
			else = {
				detract_grace_medium_effect = yes
			}
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					intrigue = 24
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						NOT = {
							intrigue = 12
						}
					}
				}
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						NOT = {
							intrigue = 8
						}
					}
				}
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						NOT = {
							intrigue = 4
						}
					}
				}
				event_target:tf_feast_event_target = {
					character_event = { id = treasurefleet.328 days = 1 }
				}
			}
			50 = {
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					event_target:tf_feast_event_target = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						intrigue = 4
					}
				}
				# Guest escapes
				event_target:tf_feast_event_target = {
					character_event = { id = treasurefleet.331 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					event_target:tf_feast_event_target = {
						any_rival = {
							character = ROOT
						}
					}
				}
				NOR = {
					trait = cruel
					trait = arbitrary
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_327 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:tf_feast_event_target = {
					any_rival = {
						character = ROOT
					}
				}
			}
		}
	}
}

# Guest was imprisoned - guest
character_event = {
	id = treasurefleet.328
	desc = EVTDESC_TREASURE_FLEET_328
	picture = GFX_evt_into_the_dungeon
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_328 # No!
		
		imprison = FROM
		remove_opinion = {
			modifier = opinion_tf_guest
			who = FROM
		}
		
		FROM = {
			character_event = { id = treasurefleet.329 }
		}
	}
}

# Guest was imprisoned - host
character_event = {
	id = treasurefleet.329
	desc = EVTDESC_TREASURE_FLEET_329
	picture = GFX_evt_into_the_dungeon
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_329 # Just as planned!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					modifier = opinion_tf_guest
					who = ROOT
				}
			}
			character_event = { id = treasurefleet.330 }
		}
	}
}

# Guest was imprisoned - other guests
character_event = {
	id = treasurefleet.330
	desc = EVTDESC_TREASURE_FLEET_330
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_330 # I see...
	}
}

# Guest successfully escaped - guest
character_event = {
	id = treasurefleet.331
	desc = EVTDESC_TREASURE_FLEET_331
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_331 # I'm not caught that easily!
		
		remove_opinion = {
			modifier = opinion_tf_guest
			who = FROM
		}
		
		FROM = {
			character_event = { id = treasurefleet.332 }
		}
	}
	
}

# Guest successfully escaped - host
character_event = {
	id = treasurefleet.332
	desc = EVTDESC_TREASURE_FLEET_332
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_332 # That's not what I wanted...
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					modifier = opinion_tf_guest
					who = ROOT
				}
			}
			character_event = { id = treasurefleet.333 }
		}
	}
}

# Guest successfully escaped - other guests
character_event = {
	id = treasurefleet.333
	desc = EVTDESC_TREASURE_FLEET_333
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_333 # I see...
	}
}

# Guest chokes on food - host
character_event = {
	id = treasurefleet.334
	desc = EVTDESC_TREASURE_FLEET_334
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
				ai = yes # Don't kill the player like this!
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_334 # Oops...
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			detract_grace_trivial_effect = yes
		}
		
		prestige = -10
		
		event_target:tf_feast_event_target = {
			character_event = { id = treasurefleet.335 }
		}
	}
}

# Guest chokes on food - guest
character_event = {
	id = treasurefleet.335
	desc = EVTDESC_TREASURE_FLEET_335
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_335 # Can't... breathe...
		
		death = {
			death_reason = death_accident
		}
	}
}

# Uneventful feast - host
character_event = {
	id = treasurefleet.336
	desc = EVTDESC_TREASURE_FLEET_336
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_336 # It was nice, I guess..
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					modifier = opinion_tf_guest
					who = ROOT
				}
			}
			character_event = { id = treasurefleet.337 }
		}
	}
}

# Uneventful feast - guests
character_event = {
	id = treasurefleet.337
	desc = EVTDESC_TREASURE_FLEET_337
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_337 # It was nice, I guess..
	}
}

# Host gains sympathy
character_event = {
	id = treasurefleet.338
	desc = EVTDESC_TREASURE_FLEET_338
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tf_guest
				}
				NOT = {
					religion_group = ROOT
				}
			}
			save_event_target_as = tf_feast_event_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_338 # That's great!
		
		if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = christian
				}
			}
			add_trait = sympathy_christendom
		}
		else_if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = jewish_group
				}
			}
			add_trait = sympathy_judaism
		}
		else_if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = muslim
				}
			}
			add_trait = sympathy_islam
		}
		else_if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = indian_group
				}
			}
			add_trait = sympathy_indian
		}
		else_if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = zoroastrian_group
				}
			}
			add_trait = sympathy_zoroastrianism
		}
		else_if = {
			limit = {
				event_target:tf_feast_event_target = {
					religion_group = pagan_group
				}
			}
			add_trait = sympathy_pagans
		}
	}
}

# Guest gains sympathy
character_event = {
	id = treasurefleet.339
	desc = EVTDESC_TREASURE_FLEET_339
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_339 # That's great!
		
		if = {
			limit = {
				FROM = {
					religion_group = christian
				}
			}
			add_trait = sympathy_christendom
		}
		else_if = {
			limit = {
				FROM = {
					religion_group = jewish_group
				}
			}
			add_trait = sympathy_judaism
		}
		else_if = {
			limit = {
				FROM = {
					religion_group = muslim
				}
			}
			add_trait = sympathy_islam
		}
		else_if = {
			limit = {
				FROM = {
					religion_group = indian_group
				}
			}
			add_trait = sympathy_indian
		}
		else_if = {
			limit = {
				FROM = {
					religion_group = zoroastrian_group
				}
			}
			add_trait = sympathy_zoroastrianism
		}
		else_if = {
			limit = {
				FROM = {
					religion_group = pagan_group
				}
			}
			add_trait = sympathy_pagans
		}
	}
}

# Feast is over - host
character_event = {
	id = treasurefleet.340
	desc = EVTDESC_TREASURE_FLEET_340
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_340 # I had a great time!
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					modifier = opinion_tf_guest
					who = ROOT
				}
			}
			character_event = { id = treasurefleet.341 }
		}
	}
}

# Feast is over - guest
character_event = {
	id = treasurefleet.341
	desc = EVTDESC_TREASURE_FLEET_341
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_341 # I had a great time!
	}
}

##### Port events for members

# Event selection for fleet members
province_event = {
	id = treasurefleet.342
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			if = {
				limit = {
					NOT = {
						top_liege = {
							has_landed_title = e_china
						}
					}
				}
				remove_trait = treasure_fleet_voyage
				clr_character_flag = do_not_disturb
			}
		}
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = yes
				}
			}
			if = { # First check if we should cancel the TF voyage
				limit = {
					OR = {
						has_province_flag = abort_treasure_fleet_asap
						e_china = {
							has_holder = no
						}
						e_china = {
							holder_scope = {
								is_chinese_emperor_trigger = no
							}
						}
					}
				}
				any_playable_ruler = {
					any_war = {
						limit = {
							OR = {
								using_cb = treasure_fleet_tributary_war
								using_cb = punitive_expedition
							}
						}
						end_war = invalid
					}
				}
				abort_treasure_fleet_for_everyone_effect = yes
			}
			else = {
				if = {
					limit = {
						e_china = {
							holder_scope = {
								any_realm_province = {
									is_in_active_treasure_fleet_region_trigger = yes
								}
							}
						}
					}
					e_china = {
						holder_scope = {
							any_realm_province = {
								limit = {
									is_in_active_treasure_fleet_region_trigger = yes
								}
								ROOT = {
									change_variable = {
										which = tf_supplies
										value = 1
									}
								}
							}
						}
					}
				}
				if = {
					limit = {
						e_china = {
							holder_scope = {
								any_tributary = {
									any_realm_province = {
										is_in_active_treasure_fleet_region_trigger = yes
									}
								}
							}
						}
					}
					e_china = {
						holder_scope = {
							any_tributary = {
								any_realm_province = {
									limit = {
										is_in_active_treasure_fleet_region_trigger = yes
									}
									ROOT = {
										change_variable = {
											which = tf_supplies
											value = 1
										}
									}
								}
							}
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						random_list = {
							1 = {
								modifier = {
									factor = 0
									treasure_fleet_has_artifacts_trigger = no
								}
								# Gold for artifact?
								character_event = { id = treasurefleet.343 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									NOT = {
										any_playable_ruler = {
											can_interact_with_treasure_fleet_trigger = yes
											any_demesne_province = {
												trade_route = silk_road
											}
											NOT = {
												has_character_modifier = chinese_imperial_trade_contract
											}
										}
									}
								}
								modifier = {
									factor = 0
									NOT = {
										ROOT = {
											check_variable = {
												which = tf_chinese_imperial_trade_contract
												value = 1
											}
										}
									}
								}
								# Gold for Trade Contract?
								character_event = { id = treasurefleet.348 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									NOT = {
										any_independent_ruler = {
											can_interact_with_treasure_fleet_trigger = yes
											any_demesne_province = {
												trade_route = silk_road
											}
											NOT = {
												has_character_modifier = peace_deal_with_china
											}
										}
									}
								}
								modifier = {
									factor = 0
									NOT = {
										ROOT = {
											check_variable = {
												which = tf_peace_deal_with_china
												value = 1
											}
										}
									}
								}
								# Gold for Peace Deal?
								character_event = { id = treasurefleet.352 days = 1 random = 15 }
							}
							1 = {
								# Gold for Grace?
								character_event = { id = treasurefleet.356 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									NOT = {
										any_playable_ruler = {
											can_interact_with_treasure_fleet_trigger = yes
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								# Gold for looser tributary relationship?
								character_event = { id = treasurefleet.360 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									treasure_fleet_has_characters_trigger = no
								}
								# Gold for Chinese character
								character_event = { id = treasurefleet.364 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									ROOT = {
										check_variable = {
											which = tf_supplies
											value = 20
										}
									}
								}
								modifier = {
									factor = 0.1
									ROOT = {
										check_variable = {
											which = tf_supplies
											value = 10
										}
									}
								}
								# Resupply - only for commander!
								character_event = { id = treasurefleet.378 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									NOT = {
										any_independent_ruler = {
											can_interact_with_treasure_fleet_trigger = yes
											is_tributary = no
										}
									}
								}
								# Create tributary
								character_event = { id = treasurefleet.388 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									NOT = {
										any_province = {
											is_in_active_treasure_fleet_region_trigger = yes
											NOT = {
												religion_group = ROOT
											}
										}
									}
								}
								# Sympathy
								character_event = { id = treasurefleet.392 days = 1 random = 15 }
							}
							1 = {
								# Local noble
								character_event = { id = treasurefleet.393 days = 1 random = 15 }
							}
							1 = {
								modifier = {
									factor = 0
									treasure_fleet_has_modifiers_trigger = no
								}
								# Province modifier for gold?
								character_event = { id = treasurefleet.394 days = 1 random = 15 }
							}
							10 = {} # Nothing
						}
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							random_list = {
								1 = {
									modifier = {
										factor = 0
										treasure_fleet_has_artifacts_trigger = no
									}
									# Gold for artifact?
									character_event = { id = treasurefleet.343 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										NOT = {
											any_playable_ruler = {
												can_interact_with_treasure_fleet_trigger = yes
												any_demesne_province = {
													trade_route = silk_road
												}
												NOT = {
													has_character_modifier = chinese_imperial_trade_contract
												}
											}
										}
									}
									modifier = {
										factor = 0
										NOT = {
											ROOT = {
												check_variable = {
													which = chinese_imperial_trade_contract
													value = 1
												}
											}
										}
									}
									# Gold for Trade Contract?
									character_event = { id = treasurefleet.348 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										NOT = {
											any_independent_ruler = {
												can_interact_with_treasure_fleet_trigger = yes
												any_demesne_province = {
													trade_route = silk_road
												}
												NOT = {
													has_character_modifier = peace_deal_with_china
												}
											}
										}
									}
									modifier = {
										factor = 0
										NOT = {
											ROOT = {
												check_variable = {
													which = tf_peace_deal_with_china
													value = 1
												}
											}
										}
									}
									# Gold for Peace Deal?
									character_event = { id = treasurefleet.352 days = 1 random = 15 }
								}
								1 = {
									# Gold for Grace?
									character_event = { id = treasurefleet.356 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										NOT = {
											any_playable_ruler = {
												can_interact_with_treasure_fleet_trigger = yes
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									# Gold for looser tributary relationship?
									character_event = { id = treasurefleet.360 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										treasure_fleet_has_characters_trigger = no
									}
									# Gold for Chinese character
									character_event = { id = treasurefleet.364 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										NOT = {
											any_independent_ruler = {
												can_interact_with_treasure_fleet_trigger = yes
												is_tributary = no
											}
										}
									}
									# Create tributary
									character_event = { id = treasurefleet.388 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										NOT = {
											any_province = {
												is_in_active_treasure_fleet_region_trigger = yes
												NOT = {
													religion_group = ROOT
												}
											}
										}
									}
									# Sympathy
									character_event = { id = treasurefleet.392 days = 1 random = 15 }
								}
								1 = {
									# Local noble
									character_event = { id = treasurefleet.393 days = 1 random = 15 }
								}
								1 = {
									modifier = {
										factor = 0
										treasure_fleet_has_modifiers_trigger = no
									}
									# Province modifier for gold?
									character_event = { id = treasurefleet.394 days = 1 random = 15 }
								}
								10 = {
									modifier = {
										factor = 2
										ai = yes
									}
									# Nothing
								}
							}
						}
					}
				}
			}
			province_event = { id = treasurefleet.403 days = 30 } # End of port events
		}
	}
}

### Gold for artifact?

# Make offer?
character_event = {
	id = treasurefleet.343
	desc = EVTDESC_TREASURE_FLEET_343
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_343 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.344 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_343 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.344
	desc = EVTDESC_TREASURE_FLEET_344
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_344 # Yes!
		
		wealth = -100
		
		FROM = {
			character_event = { id = treasurefleet.345 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_344 # No!
		
		FROM = {
			character_event = { id = treasurefleet.347 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.345
	desc = EVTDESC_TREASURE_FLEET_345
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_345 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		FROM = {
			character_event = { id = treasurefleet.346 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_345 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		FROM = {
			character_event = { id = treasurefleet.346 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Artifact received
character_event = {
	id = treasurefleet.346
	desc = EVTDESC_TREASURE_FLEET_346
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_346 # Great!
		
		gift_random_artifact_effect = yes
	}
}

# Offer refused
character_event = {
	id = treasurefleet.347
	desc = EVTDESC_TREASURE_FLEET_347
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_347 # I see...
	}
}

### Gold for Trade Contract?

# Make offer?
character_event = {
	id = treasurefleet.348
	desc = EVTDESC_TREASURE_FLEET_348
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
				NOT = {
					has_character_modifier = chinese_imperial_trade_contract
				}
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_348 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.349 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_348 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.349
	desc = EVTDESC_TREASURE_FLEET_349
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_349 # Yes!
		
		wealth = -100
		
		add_character_modifier = {
			modifier = peace_deal_with_china
			inherit = yes
			years = 25
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = tf_chinese_imperial_trade_contract
					value = -1
				}
			}
		}
		
		FROM = {
			character_event = { id = treasurefleet.350 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_349 # No!
		
		FROM = {
			character_event = { id = treasurefleet.351 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.350
	desc = EVTDESC_TREASURE_FLEET_350
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_350 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_350 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.351
	desc = EVTDESC_TREASURE_FLEET_351
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_351 # I see...
	}
}

### Gold for Peace Deal?

# Make offer?
character_event = {
	id = treasurefleet.352
	desc = EVTDESC_TREASURE_FLEET_352
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
				NOT = {
					has_character_modifier = peace_deal_with_china
				}
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_352 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.353 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_352 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.353
	desc = EVTDESC_TREASURE_FLEET_353
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_353 # Yes!
		
		wealth = -100
	
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = tf_peace_deal_with_china
					value = -1
				}
			}
		}
		
		FROM = {
			character_event = { id = treasurefleet.354 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_353 # No!
		
		FROM = {
			character_event = { id = treasurefleet.355 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.354
	desc = EVTDESC_TREASURE_FLEET_354
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_354 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_354 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.355
	desc = EVTDESC_TREASURE_FLEET_355
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_355 # I see...
	}
}

### Gold for Grace?

# Make offer?
character_event = {
	id = treasurefleet.356
	desc = EVTDESC_TREASURE_FLEET_356
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_356 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.357 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_356 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.357
	desc = EVTDESC_TREASURE_FLEET_357
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_357 # Yes!
		
		wealth = -100
	
		add_grace_massive_effect = yes
		
		FROM = {
			character_event = { id = treasurefleet.358 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_357 # No!
		
		FROM = {
			character_event = { id = treasurefleet.359 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.358
	desc = EVTDESC_TREASURE_FLEET_358
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_358 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_358 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.359
	desc = EVTDESC_TREASURE_FLEET_359
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_359 # I see...
	}
}

### Gold for looser tributary relationship?

# Make offer?
character_event = {
	id = treasurefleet.360
	desc = EVTDESC_TREASURE_FLEET_360
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_360 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.361 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_360 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.361
	desc = EVTDESC_TREASURE_FLEET_361
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_361 # Yes!
		
		wealth = -100
	
		decrease_tributary_tier_or_release_effect = yes
		
		FROM = {
			character_event = { id = treasurefleet.362 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_361 # No!
		
		FROM = {
			character_event = { id = treasurefleet.363 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.362
	desc = EVTDESC_TREASURE_FLEET_362
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_362 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_362 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.363
	desc = EVTDESC_TREASURE_FLEET_363
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_363 # I see...
	}
}

### Gold for Chinese character?

# Make offer?
character_event = {
	id = treasurefleet.364
	desc = EVTDESC_TREASURE_FLEET_364
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_364 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.365 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_364 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.365
	desc = EVTDESC_TREASURE_FLEET_365
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_365 # Yes!
		
		wealth = -100
		
		FROM = {
			character_event = { id = treasurefleet.366 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_361 # No!
		
		FROM = {
			character_event = { id = treasurefleet.377 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.366
	desc = EVTDESC_TREASURE_FLEET_366
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			random_list = {
				100 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_strategist
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_strategist
							value = -1
						}
					}
					character_event = { id = treasurefleet.367 }
				}
				100 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_master_engineer
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_master_engineer
							value = -1
						}
					}
					character_event = { id = treasurefleet.368 }
				}
				100 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_administrator # Scholar-Bureaucrat
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_administrator
							value = -1
						}
					}
					character_event = { id = treasurefleet.369 }
				}
				100 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_siege_engineer
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_siege_engineer
							value = -1
						}
					}
					character_event = { id = treasurefleet.370 }
				}
				100 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_physician
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_physician
							value = -1
						}
					}
					character_event = { id = treasurefleet.371 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_soldier
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_soldier
							value = -1
						}
					}
					character_event = { id = treasurefleet.372 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_eunuch
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_eunuch
							value = -1
						}
					}
					character_event = { id = treasurefleet.373 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_courtesan
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_courtesan
							value = -1
						}
					}
					character_event = { id = treasurefleet.374 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_scholar
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_scholar
							value = -1
						}
					}
					character_event = { id = treasurefleet.375 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_noble
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_noble
							value = -1
						}
					}
					character_event = { id = treasurefleet.376 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_366 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_366 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Offer accepted - got Strategist
character_event = {
	id = treasurefleet.367
	desc = EVTDESC_TREASURE_FLEET_367
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = yes
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_strategist
			add_character_modifier = {
				name = jd_strategist
				duration = -1
			}
			if = {
				limit = {
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = {trait = master_of_flame } }
						add_trait = master_of_flame
					}
					25 = {
						trigger = { NOT = {trait = logistics_expert } }
						add_trait = logistics_expert
					}
					25 = {
						trigger = { NOT = {trait = levy_coordinator } }
						add_trait = levy_coordinator
					}
					25 = {
						trigger = { NOT = {trait = sapper } }
						add_trait = sapper
					}
				}
				set_character_flag = jd_strategist_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = chinese_courtier_original_court_@PREV
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_strategist
			random_list = {
				80 = { add_trait = skilled_tactician }
				20 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { add_trait = brave } 
				20 = { add_trait = strong }
				20 = { add_trait = shrewd }
				40 = { add_trait = robust }
			}
			random_list = {
				71 = { } #Nothing
				20 = { add_trait = scarred }
				5 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_eyed 
					change_martial = 1
				}
				2 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_handed
					change_martial = 1
				}
				2 = { add_trait = ugly }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						add_trait = strategist
					}
					add_trait = logistics_expert
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = hunter }
							50 = { add_trait = strategist }
						}
					}
					add_trait = sapper 
					add_trait = humble
					add_trait = patient
					random_list = {
						30 = { add_trait = slothful }
						70 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = strategist }
							50 = { add_trait = duelist }
						}
					}
					add_trait = master_of_flame 
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							20 = { add_trait = duelist }
							40 = { add_trait = hunter }
							40 = { add_trait = gamer }
						}
					}
					add_trait = levy_coordinator 
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						33 = { add_trait = envious }
						33 = { add_trait = gluttonous }
						33 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = falconer }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}

			#Add second commander trait
			random_list = {
				10 = {
					trigger = { NOT = {trait = master_of_flame } }
					add_trait = master_of_flame
				}
				10 = {
					trigger = { NOT = {trait = logistics_expert } }
					add_trait = logistics_expert
				}
				10 = {
					trigger = { NOT = {trait = levy_coordinator } }
					add_trait = levy_coordinator
				}
				10 = {
					trigger = { NOT = {trait = sapper } }
					add_trait = sapper
				}
				60 = {}
			}
		}
		new_character = {
			give_minor_title = title_commander
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_367 # He's welcome here!
	}
}

# Offer accepted - got Master Engineer
character_event = {
	id = treasurefleet.368
	desc = EVTDESC_TREASURE_FLEET_368
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_master_engineer
			add_character_modifier = {
				name = jd_master_engineer
				duration = -1
			}
			if = {
				limit = {
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				set_character_flag = china_master_engineer_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_master_engineer
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = tough_soldier }
				15 = { add_trait = skilled_tactician }
				5 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { } #Nothing
				20 = { add_trait = erudite }
				20 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				10 = { add_trait = robust }
				5 = { add_trait = strong }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = { 
					add_trait = weak 
					remove_trait = strong 
					remove_trait = robust
				}
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = architect }
							25 = { add_trait = theologian }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = architect }
							25 = { add_trait = socializer }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = architect }
							50 = { add_trait = strategist }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = architect }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}
				}
			}
		}
		new_character = {
			set_character_flag = master_engineer_just_spawned
			give_minor_title = title_master_engineer
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_368 # He's welcome here!
	}
}

# Offer accepted - got Scholar-Bureaucrat
character_event = {
	id = treasurefleet.369
	desc = EVTDESC_TREASURE_FLEET_369
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_administrator
			add_character_modifier = {
				name = jd_administrator
				duration = -1
			}
			if = {
				limit = {
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				set_character_flag = jd_administrator_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_administrator
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = martial_cleric }
				15 = { add_trait = scholarly_theologian }
				5 = { add_trait = mastermind_theologian }
			}
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				25 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = {  add_trait = weak }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = scholar }
							50 = { add_trait = administrator }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = administrator }
							25 = { add_trait = scholar }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = administrator }
							25 = { add_trait = architect }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = administrator }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}
			give_minor_title = title_administrator
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_369 # He's welcome here!
	}
}

# Offer accepted - got Siege Engineer
character_event = {
	id = treasurefleet.370
	desc = EVTDESC_TREASURE_FLEET_370
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			33 = {
				create_random_soldier = {
					age = 55
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 16
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 35
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 37
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					if = {
						limit = {
							e_china = {
								holder_scope = {
									has_character_modifier = mandate_of_heaven_5
								}
							}
						}
						change_martial = 5
					}
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
		}
		new_character = {
			give_minor_title = title_commander
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_370 # He's welcome here!
	}
}

# Offer accepted - got Physician
character_event = {
	id = treasurefleet.371
	desc = EVTDESC_TREASURE_FLEET_371
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = event_target:tf_character_home_province
					culture = event_target:tf_character_home_province
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
		}
        new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_doctor
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_physician
			random_list = {
				50 = { add_trait = scholarly_theologian }
				25 = { add_trait = mastermind_theologian }
			}
			add_trait = physician
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				30 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
			}
			random_list = {
				80 = { } #Nothing
				2 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				4 = { add_trait = lisp }
				4 = { add_trait = stutter }
				2 = { add_trait = ugly }
				2 = { add_trait = dwarf }
				2 = { add_trait = weak }
			}
			random_list = {
				50 = { } #Nothing
				25 = { add_trait = patient }
				25 = { add_trait = diligent }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				20 = { #Combat medic
					set_character_flag = archetype_decisive
					random_list = {
						50 = { add_trait = duelist }
						50 = { add_trait = scholar }
					}
					add_trait = scarred
					add_trait = robust
					random_list = {
						60 = { } #Nothing
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_legged 
						}
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_eyed 
						}
					}
					add_trait = brave
					random_list = {
						30 = { } #Nothing
						50 = { add_trait = cynical }
						10 = {
							add_trait = cynical
							add_trait = depressed
						}
						10 = {
							add_trait = cynical
							add_trait = depressed
							add_trait = drunkard
						}
					}
					random_list = {
						50 = { } #Nothing
						20 = { add_trait = kind }
						30 = { add_trait = honest }
					}
					remove_trait = dwarf
					remove_trait = weak
				}
				#Dr Jerk
				15 = { 
					set_character_flag = archetype_decisive
					add_trait = scholar
					add_trait = wroth
					remove_trait = patient
					random_list = {
						30 = { add_trait = proud }
						30 = { add_trait = envious }
						40 = { } #Nothing
					}
					add_trait = honest
					add_trait = cynical
					random = {
						chance = 30
						add_trait = drunkard
					}
					random_list = {
						60 = { }
						20 = { 
							add_trait = clubfooted
							set_name = Wu #House
						}
						20 = {
							trigger = { has_dlc = Reapers }
							add_trait = one_legged
							set_name = Wu #House
						}
					}
				}
				10 = { #Mad genius 
					set_character_flag = archetype_sociable
					random_list = {
						50 = { add_trait = impaler }
						50 = { add_trait = mystic }
					}
					random_list = {
						33 = { add_trait = drunkard } 
						33 = { add_trait = lunatic }
						33 = { add_trait = possessed }
					}
					add_trait = genius
					remove_trait = quick
					remove_trait = shrewd
					add_trait = paranoid
					random_list = {
						25 = { add_trait = gluttonous } 
						25 = { add_trait = wroth }
						25 = { add_trait = proud }
						25 = { add_trait = greedy }
					}   
				}
				20 = { #Herbalist
					set_character_flag = archetype_supportive
					add_trait = gardener
					add_trait = diligent
					add_trait = humble
					random_list = {
						33 = { add_trait = content } 
						33 = { add_trait = shy }
						33 = { add_trait = poet }
					}
					random = {
						chance = 50
						add_trait = robust
					}
					remove_trait = weak
				}
				20 = { #Health nut
					set_character_flag = archetype_conservative
					add_trait = mystic
					add_trait = celibate
					add_trait = chaste
					add_trait = temperate
					random_list = {
						50 = { add_trait = craven } 
						25 = { add_trait = shy }
						25 = { add_trait = content }
					}
					set_focus = focus_scholarship
				}
				20 = { #Compassionate doctor
					set_character_flag = archetype_supportive
					random_list = {
						50 = { add_trait = socializer }
						50 = { add_trait = scholar }
					}
					add_trait = kind
					add_trait = patient
					random_list = {
						25 = { add_trait = content } 
						25 = { add_trait = humble }
						25 = { add_trait = trusting }
						25 = { add_trait = charitable }
					}
					set_focus = focus_family
				}
				15 = { #McDreamy
					set_character_flag = archetype_sociable
					if = {
						limit = { is_female = yes }
						add_trait = seductress
					}
					if = {
						limit = { is_female = no }
						add_trait = seducer
					}
					random_list = {
						50 = { } #Nothing
						25 = { add_trait = poet }
						25 = { add_trait = falconer }
					}
					random_list = {
						30 = { add_trait = fair }
						50 = { add_trait = strong }
					}
					add_trait = lustful
					random_list = {
						35 = { add_trait = ambitious }
						35 = { add_trait = gregarious }
						30 = { } #Nothing
					}
					set_focus = focus_seduction
					remove_trait = clubfooted
					remove_trait = harelip
					remove_trait =  hunchback 
					remove_trait = lisp
					remove_trait = stutter
					remove_trait = ugly
					remove_trait = dwarf
					remove_trait = weak
				}
			}
		}
		new_character = {
			if = {
				limit = {
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				change_learning = 5
			}
			give_minor_title = title_court_physician
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_371 # He's welcome here!
	}
}

# Gain courtier - young soldier
character_event = {
	id = treasurefleet.372
	desc = EVTDESC_TREASURE_FLEET_372
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		create_random_soldier = {
			age = 21
			female = no
			dynasty = none
			attributes = {
				diplomacy = 2
				martial = 7
				stewardship = 5
				intrigue = 4
				learning = 6
			}
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			random_traits =	yes
		}
		new_character = {
			random = {
				chance = 25
				random_list = {
					1 = {
						add_trait = logistics_expert
					}
					1 = {
						add_trait = master_of_flame
					}
					1 = {
						add_trait = sapper
					}
					1 = {
						add_trait = levy_coordinator
					}
				}
			}
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_372 # He's welcome here!
	}
}

# Gain courtier - eunuch
character_event = {
	id = treasurefleet.373
	desc = EVTDESC_TREASURE_FLEET_373
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_random_priest = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 4
						martial = 2
						stewardship = 5
						intrigue = 4
						learning = 8
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_steward = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 3
						martial = 3
						stewardship = 8
						intrigue = 4
						learning = 6
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_diplomat = {
					age = 35
					female = no
					dynasty = none
					attributes = {
						diplomacy = 8
						martial = 1
						stewardship = 5
						intrigue = 4
						learning = 6
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			add_trait = eunuch
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_373 # He's welcome here!
	}
}

# Gain courtier - young courtesan
character_event = {
	id = treasurefleet.374
	desc = EVTDESC_TREASURE_FLEET_374
	picture = GFX_evt_daughter_asking_father
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_random_intriguer = {
					age = 19
					female = yes
					dynasty = none
					attributes = {
						diplomacy = 6
						martial = 1
						stewardship = 4
						intrigue = 8
						learning = 2
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_random_diplomat = {
					age = 19
					female = yes
					dynasty = none
					attributes = {
						diplomacy = 8
						martial = 1
						stewardship = 5
						intrigue = 6
						learning = 5
					}
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			remove_all_negative_congenital_traits_effect = yes
			add_trait = fair
			remove_trait = chaste
			remove_trait = celibate
			add_trait = lustful
			if = {
				limit = {
					has_dlc = "Way of Life"
				}
				random_list = {
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = gamer
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = hedonist
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = seductress
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = scholar
					}
					1 = {
						remove_lifestyle_trait_effect = yes
						add_trait = socializer
					}
					1 = {
						# Leave existing lifestyle
					}
				}
			}
			random = {
				chance = 5
				add_trait = homosexual
			}
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_374 # She's welcome here!
	}
}

# Gain courtier - old scholar
character_event = {
	id = treasurefleet.375
	desc = EVTDESC_TREASURE_FLEET_375
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		create_random_priest = {
			age = 65
			female = no
			dynasty = none
			attributes = {
				diplomacy = 5
				martial = 1
				stewardship = 6
				intrigue = 4
				learning = 8
			}
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			trait = scholar
			random_traits =	yes
		}
		new_character = {
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_375 # He's welcome here!
	}
}

# Gain courtier - random noble
character_event = {
	id = treasurefleet.376
	desc = EVTDESC_TREASURE_FLEET_376
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		random_list = {
			50 = {
				create_character = {
					age = 35
					female = no
					dynasty = random
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
			50 = {
				create_character = {
					age = 35
					female = yes
					dynasty = random
					culture = event_target:tf_character_home_province
					religion = event_target:tf_character_home_province
					random_traits =	yes
				}
			}
		}
		new_character = {
			save_event_target_as = new_tf_character
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_276 # They're welcome here!
	}
}

# Offer refused
character_event = {
	id = treasurefleet.377
	desc = EVTDESC_TREASURE_FLEET_377
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_377 # I see...
	}
}

### Resupply

# Ask nicely or attempt to seize supplies?
character_event = {
	id = treasurefleet.378
	desc = EVTDESC_TREASURE_FLEET_378
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		trigger = {
			FROM = {
				check_variable = {
					which = treasure_fleet_wealth
					value = 2
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_378 # I'll ask nicely!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.379 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_378 # I will use force!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 100
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 75
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 50
						}
					}
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 20
				}
				modifier = {
					factor = 2
					martial = 16
				}
				# It goes well
				character_event = { id = treasurefleet.382 days = 2 random = 5 }
			}
			50 = {
				# It goes poorly
				character_event = { id = treasurefleet.383 days = 2 random = 5 }
			}
			50 = {
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 25
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 20
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 15
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 10
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 5
							}
						}
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				# It goes extremely poorly
				character_event = { id = treasurefleet.384 days = 2 random = 5 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
			modifier = {
				factor = 0
				2753 = { # Hangzhou
					NOT = {
						check_variable = {
							which = treasure_fleet_army_strength
							value = 15
						}
					}
				}
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTC_TREASURE_FLEET_378 # Neither!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
			}
		}
	}
}

# Asked nicely
character_event = {
	id = treasurefleet.379
	desc = EVTDESC_TREASURE_FLEET_379
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_379 # Sure!
		
		wealth = 100
		
		hidden_tooltip = {
			FROMFROM = {
				change_variable = {
					which = treasure_fleet_wealth
					value = -2
				}
			}
		}
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			add_grace_medium_effect = yes
		}
		
		FROM = {
			character_event = { id = treasurefleet.380 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					opinion = {
						who = FROM
						value = -25
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					e_china = {
						holder_scope = {
							reverse_opinion = {
								who = ROOT
								value = -25
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_379 # Not happening!
		
		FROM = {
			character_event = { id = treasurefleet.381 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value = 25
				}
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						reverse_opinion = {
							who = ROOT
							value = 25
						}
					}
				}
			}
			modifier = {
				factor = 10
				trait = greedy
			}
		}
	}
}

# Request accepted
character_event = {
	id = treasurefleet.380
	desc = EVTDESC_TREASURE_FLEET_380
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_380 # Great!
		
		hidden_tooltip = {
			random_list = {
				2753 = { # Hangzhou
					1 = {
						change_variable = {
							which = tf_supplies
							value = 1
						}
					}
					1 = {
						change_variable = {
							which = tf_supplies
							value = 5
						}
					}
					1 = {
						change_variable = {
							which = tf_supplies
							value = 10
						}
					}
				}
			}
		}
	}
}

# Request refused - seize supplies?
character_event = {
	id = treasurefleet.381
	desc = EVTDESC_TREASURE_FLEET_381
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_381 # I will use force!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 100
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 75
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 50
						}
					}
				}
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 20
				}
				modifier = {
					factor = 2
					martial = 16
				}
				# It goes well
				character_event = { id = treasurefleet.382 days = 2 random = 5 }
			}
			50 = {
				# It goes poorly
				character_event = { id = treasurefleet.383 days = 2 random = 5 }
			}
			50 = {
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 25
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 20
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 15
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 10
							}
						}
					}
				}
				modifier = {
					factor = 2
					2753 = { # Hangzhou
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 5
							}
						}
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				# It goes extremely poorly
				character_event = { id = treasurefleet.384 days = 2 random = 5 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
			modifier = {
				factor = 0
				2753 = { # Hangzhou
					NOT = {
						check_variable = {
							which = treasure_fleet_army_strength
							value = 15
						}
					}
				}
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_381 # That's that...
		
		prestige = -100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
}

# Seizing supplies - it goes well
character_event = {
	id = treasurefleet.382
	desc = EVTDESC_TREASURE_FLEET_382
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_382 # Great!
		
		prestige = 25
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.385 }
		}
		
		hidden_tooltip = {
			random_list = {
				2753 = { # Hangzhou
					1 = {
						change_variable = {
							which = tf_supplies
							value = 1
						}
					}
					1 = {
						change_variable = {
							which = tf_supplies
							value = 5
						}
					}
					1 = {
						change_variable = {
							which = tf_supplies
							value = 10
						}
					}
				}
			}
		}
	}
}

# Seizing supplies - it goes poorly
character_event = {
	id = treasurefleet.383
	desc = EVTDESC_TREASURE_FLEET_383
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_383 # Curses!
		
		prestige = -25
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.386 }
		}
		
		hidden_tooltip = {
			random_list = {
				2753 = { # Hangzhou
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -1
						}
					}
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -2
						}
					}
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -3
						}
					}
				}
			}
		}
	}
}

# Seizing supplies - it goes extremely poorly
character_event = {
	id = treasurefleet.384
	desc = EVTDESC_TREASURE_FLEET_384
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_384 # Curses!
		
		prestige = -100
		character_event = { id = treasurefleet.103 }
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.387 }
		}
		
		hidden_tooltip = {
			random_list = {
				2753 = { # Hangzhou
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -1
						}
					}
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -2
						}
					}
					1 = {
						change_variable = {
							which = treasure_fleet_army_strength
							value = -3
						}
					}
				}
			}
		}
	}
}

# Inform local ruler if supplies were seized
character_event = {
	id = treasurefleet.385
	desc = EVTDESC_TREASURE_FLEET_385
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_385 # I see...
		
		add_rival = FROM
	}
}

# Inform local ruler if supply seizing failed
character_event = {
	id = treasurefleet.386
	desc = EVTDESC_TREASURE_FLEET_386
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_386 # I see...
		
		add_rival = FROM
	}
}

# Inform local ruler if commander was imprisoned
character_event = {
	id = treasurefleet.387
	desc = EVTDESC_TREASURE_FLEET_387
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_387 # I see...
		
		add_rival = FROM
		FROM = {
			imprison = ROOT
		}
	}
}

### Someone sees an opportunity to create a tributary

# Opportunity is spotted - act on it?
character_event = {
	id = treasurefleet.388
	desc = EVTDESC_TREASURE_FLEET_388
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		random_independent_ruler = {
			limit = {
				war = no
				can_interact_with_treasure_fleet_trigger = yes
				is_tributary = no
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_388 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.389 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
			modifier = {
				factor = 0
				NOT = {
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 15
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_388 # No!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
			}
		}
	}
}

# Local ruler gets ultimatum
character_event = {
	id = treasurefleet.389
	desc = EVTDESC_TREASURE_FLEET_389
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_389 # I guess I'll accept...
		
		e_china = {
			holder_scope = {
				make_tributary = {
					who = ROOT
					tributary_type = chinese_peripheral_tributary
				}
			}
		}
		
		#hidden_tooltip = {
		#	if = {
		#		limit = {
		#			has_dlc = "Jade Dragon"
		#		}
		#		character_event = { id = grace.7 days = 365 }
		#	}
		#}
		
		FROM = {
			character_event = { id = treasurefleet.390 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				root_hates_china_trigger = yes
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 0.1
				tier = king
			}
			modifier = {
				factor = 0
				tier = emperor
			}
			modifier = {
				factor = 0.1
				NOT = {
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 20
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_389 # Not happening!
		
		FROM = {
			character_event = { id = treasurefleet.391 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				has_acceptable_chinese_culture_cvg_trigger = yes
			}
			modifier = {
				factor = 0.5
				has_acceptable_chinese_religion_trigger = yes
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
			modifier = {
				factor = 0.1
				trait = content
			}
			modifier = {
				factor = 0.1
				tier = count
			}
			modifier = {
				factor = 0.5
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 50
					}
				}
			}
			modifier = {
				factor = 0.5
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 75
					}
				}
			}
			modifier = {
				factor = 0.5
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 100
					}
				}
			}
		}
	}
}

# Ultimatum accepted
character_event = {
	id = treasurefleet.390
	desc = EVTDESC_TREASURE_FLEET_390
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_390 # Great!
		
		prestige = 100
	}
}

# Ultimatum refused - spawn a host under a new eunuch and have them declare war?
character_event = {
	id = treasurefleet.391
	desc = EVTDESC_TREASURE_FLEET_391
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_391 # Then war it is!
		
		FROM = {
			save_event_target_as = treasure_fleet_attacker
			random_realm_province = {
				limit = {
					is_in_active_treasure_fleet_region_trigger = yes
				}
				save_event_target_as = treasure_fleet_beachhead
			}
		}
		create_new_court_eunuch_effect = yes
		new_character = {
			set_defacto_liege = THIS
			create_title = {
				tier = DUKE
				landless = yes
				adventurer = yes
				culture = ROOT
				name = "TRIBUTARY_WAR_HOST"
				holder = THIS
				base_title = THIS
			}
			save_event_target_as = treasure_fleet_punitive_expedition_leader
			disembark_regiments_until_stronger_or_unable_to_continue_effect = yes
			war = {
				target = event_target:treasure_fleet_attacker
				casus_belli = treasure_fleet_tributary_war
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
			modifier = {
				factor = 0
				NOT = {
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_army_strength
							value = 15
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_391 # I guess that's that...
		
		prestige = -100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
				2753 = { # Hangzhou
					check_variable = {
						which = treasure_fleet_army_strength
						value = 25
					}
				}
			}
		}
	}
}

### Sympathy for TF

# Gain sympathy
character_event = {
	id = treasurefleet.392
	desc = EVTDESC_TREASURE_FLEET_392
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
				NOT = {
					religion_group = ROOT
				}
			}
			save_event_target_as = tf_sympathy_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_392 # Great!
		
		if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = christian
				}
			}
			add_trait = sympathy_christendom
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = jewish_group
				}
			}
			add_trait = sympathy_judaism
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = muslim
				}
			}
			add_trait = sympathy_islam
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = indian_group
				}
			}
			add_trait = sympathy_indian
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = zoroastrian_group
				}
			}
			add_trait = sympathy_zoroastrianism
		}
		else_if = {
			limit = {
				event_target:tf_sympathy_target = {
					religion_group = pagan_group
				}
			}
			add_trait = sympathy_pagans
		}
	}
}

### Local noble pledges themself to you

# Local noble pledges themmself to you and joins the fleet
character_event = {
	id = treasurefleet.393
	desc = EVTDESC_TREASURE_FLEET_393
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			random_demesne_province = {
				limit = {
					is_in_active_treasure_fleet_region_trigger = yes
				}
				save_event_target_as = tf_noble_province
			}
		}
		d_treasure_fleet = {
			holder_scope = {
				random_list = {
					50 = {
						create_character = {
							age = 25
							female = no
							dynasty = random
							culture = event_target:tf_noble_province
							religion = event_target:tf_noble_province
							random_traits =	yes
						}
					}
					50 = {
						create_character = {
							age = 25
							female = yes
							dynasty = random
							culture = event_target:tf_noble_province
							religion = event_target:tf_noble_province
							random_traits =	yes
						}
					}
				}
				new_character = {
					save_event_target_as = new_tf_character
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_393 # They're welcome here!
		
		event_target:new_tf_character = {
			opinion = {
				who = ROOT
				modifier = opinion_loyal_servant
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_393 # I don't like them!
		
		event_target:new_tf_character = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

### Offer province modifier for gold

# Make offer?
character_event = {
	id = treasurefleet.394
	desc = EVTDESC_TREASURE_FLEET_394
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
			}
			save_event_target_as = tf_interaction_target
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_394 # Yes!
		
		event_target:tf_interaction_target = {
			character_event = { id = treasurefleet.395 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					opinion = {
						who = event_target:tf_interaction_target
						value = -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_394 # No!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				opinion = {
					who = event_target:tf_interaction_target
					value = 25
				}
			}
		}
	}
}

# Offer is made
character_event = {
	id = treasurefleet.395
	desc = EVTDESC_TREASURE_FLEET_395
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_395 # Yes!
		
		wealth = -100
		
		FROM = {
			character_event = { id = treasurefleet.396 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				wealth = 100
			}
			modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_395 # No!
		
		FROM = {
			character_event = { id = treasurefleet.402 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				wealth = 1000
			}
		}
	}
}

# Offer accepted
character_event = {
	id = treasurefleet.396
	desc = EVTDESC_TREASURE_FLEET_396
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			random_list = {
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_jd_paper_mill
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_jd_paper_mill
							value = -1
						}
					}
					character_event = { id = treasurefleet.397 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_jd_fireworks_guild
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_jd_fireworks_guild
							value = -1
						}
					}
					character_event = { id = treasurefleet.398 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_jd_dry_docks
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_jd_dry_docks
							value = -1
						}
					}
					character_event = { id = treasurefleet.399 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_jd_administrative_outpost
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_jd_administrative_outpost
							value = -1
						}
					}
					character_event = { id = treasurefleet.400 }
				}
				1 = {
					modifier = {
						factor = 0
						2753 = { # Hangzhou
							NOT = {
								check_variable = {
									which = tf_jd_blast_furnace
									value = 1
								}
							}
						}
					}
					2753 = { # Hangzhou
						change_variable = {
							which = tf_jd_blast_furnace
							value = -1
						}
					}
					character_event = { id = treasurefleet.401 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_396 # I'll keep this...
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_396 # This belongs to the EoC!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_wealth
					value = 1
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Got a paper mill
character_event = {
	id = treasurefleet.397
	desc = EVTDESC_TREASURE_FLEET_397
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_jd_modifier_province
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_397 # That's great!
		
		event_target:tf_jd_modifier_province = {
			add_province_modifier = {
				name = jd_paper_mill
				years = 20
			}
		}
	}
}

# Got a fireworks guild
character_event = {
	id = treasurefleet.398
	desc = EVTDESC_TREASURE_FLEET_398
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_jd_modifier_province
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_398 # That's great!
		
		event_target:tf_jd_modifier_province = {
			add_province_modifier = {
				name = jd_fireworks_guild
				years = 20
			}
		}
	}
}

# Got dry docks
character_event = {
	id = treasurefleet.399
	desc = EVTDESC_TREASURE_FLEET_399
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_jd_modifier_province
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_399 # That's great!
		
		event_target:tf_jd_modifier_province = {
			add_province_modifier = {
				name = jd_dry_docks
				years = 20
			}
		}
	}
}

# Got an administrative outpost
character_event = {
	id = treasurefleet.400
	desc = EVTDESC_TREASURE_FLEET_400
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_jd_modifier_province
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_400 # That's great!
		
		event_target:tf_jd_modifier_province = {
			add_province_modifier = {
				name = jd_administrative_outpost
				years = 20
			}
		}
	}
}

# Got a blast furnace
character_event = {
	id = treasurefleet.401
	desc = EVTDESC_TREASURE_FLEET_401
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		random_demesne_province = {
			limit = {
				is_in_active_treasure_fleet_region_trigger = yes
			}
			save_event_target_as = tf_jd_modifier_province
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_401 # That's great!
		
		event_target:tf_jd_modifier_province = {
			add_province_modifier = {
				name = jd_blast_furnace
				years = 20
			}
		}
	}
}

# Offer refused
character_event = {
	id = treasurefleet.402
	desc = EVTDESC_TREASURE_FLEET_402
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_402 # I see...
	}
}

##### End of port events

# See if the fleet needs to be cancelled, then see if either special case is an option, also send home everyone that's not supposed to be part of the TF any longer
province_event = {
	id = treasurefleet.403
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		treasure_fleet_voyage = {
			if = {
				limit = {
					NOT = {
						top_liege = {
							has_landed_title = e_china
						}
					}
				}
				
				remove_trait = treasure_fleet_voyage
				clr_character_flag = do_not_disturb
			}
			if = {
				limit = {
					has_character_flag = abort_treasure_fleet
				}
				remove_trait = treasure_fleet_voyage
				add_trait = travelling
				character_event = { id = treasurefleet.500 days = 30 random = 30 } # Actual homecoming
			}
		}
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = yes
				}
			}
			if = { # First check if we should cancel the TF voyage
				limit = {
					OR = {
						has_province_flag = abort_treasure_fleet_asap
						e_china = {
							has_holder = no
						}
						e_china = {
							holder_scope = {
								is_chinese_emperor_trigger = no
							}
						}
					}
				}
				any_playable_ruler = {
					any_war = {
						limit = {
							OR = {
								using_cb = treasure_fleet_tributary_war
								using_cb = punitive_expedition
							}
						}
						end_war = invalid
					}
				}
				abort_treasure_fleet_for_everyone_effect = yes
			}
		}
		else = {
			if = {
				limit = {
					has_province_flag = treasure_fleet_in_java
					NOR = {
						has_global_flag = treasure_fleet_at_nazca
						has_global_flag = lost_merchant_went_east
					}
				}
				random_list = {
					25 = { # Possible Nazca
						set_variable = {
							which = tf_head_east_vote
							value = 1
						}
						any_playable_ruler = {
							limit = {
								trait = treasure_fleet_voyage
							}
							character_event = { id = treasurefleet.410 } # Sail East?
						}
						province_event = { id = treasurefleet.411 days = 1 } # Check outcome
					}
					75 = {
						if = {
							limit = {
								NOT = {
									has_province_flag = treasure_fleet_is_going_home # Only on the outbound journey
								}
								NOT = {
									has_game_rule = {
										name = treasure_fleet_invasion_rule
										value = forbidden
									}
								}
								any_playable_ruler = {
									can_interact_with_treasure_fleet_trigger = yes
									top_liege = {
										any_realm_province = {
											is_in_active_treasure_fleet_region_trigger = yes
											NOT = {
												any_province = {
													owner = {
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
													NOT = {
														distance = {
															where = PREV
															value = 500
														}
													}
													NOT = {
														can_naval_path_to = {
															target = PREV
															distance <= 1000
														}
													}
												}
											}
										}
									}
									2753 = { # Hangzhou
										check_variable = {
											which = treasure_fleet_army_strength
											value = 10
										}
									}
									any_playable_ruler = {
										trait = treasure_fleet_voyage
										is_feudal = yes
										has_acceptable_chinese_culture_trigger = yes
										has_acceptable_chinese_religion_trigger = yes
										NOT = {
											top_liege = {
												dynasty = PREV
											}
										}
										OR = {
											ai = no
											AND = {
												has_game_rule = {
													name = treasure_fleet_invasion_rule
													value = allowed
												}
											}
										}
									}
								}
							}
							random_list = {
								1 = {
									random_playable_ruler = {
										limit = {
											can_interact_with_treasure_fleet_trigger = yes
											top_liege = {
												any_realm_province = {
													is_in_active_treasure_fleet_region_trigger = yes
													NOT = {
														any_province = {
															owner = {
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
															NOT = {
																distance = {
																	where = PREV
																	value = 500
																}
															}
															NOT = {
																can_naval_path_to = {
																	target = PREV
																	distance <= 1000
																}
															}
														}
													}
												}
											}
										}
										top_liege = {
											save_event_target_as = potential_tf_invasion_target
											random_realm_province = {
												limit = {
													is_in_active_treasure_fleet_region_trigger = yes
													NOT = {
														any_province = {
															owner = {
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
															NOT = {
																distance = {
																	where = PREV
																	value = 500
																}
															}
															NOT = {
																can_naval_path_to = {
																	target = PREV
																	distance <= 1000
																}
															}
														}
													}
												}
												save_event_target_as = potential_tf_invasion_target_beachhead
											}
										}
										random_playable_ruler = {
											limit = {
												trait = treasure_fleet_voyage
												is_feudal = yes
												has_acceptable_chinese_culture_trigger = yes
												has_acceptable_chinese_religion_trigger = yes
												NOT = {
													top_liege = {
														dynasty = PREV
													}
												}
												ai = no
											}
											preferred_limit = {
												tier = king
											}
											preferred_limit = {
												tier = duke
											}
											narrative_event = { id = treasurefleet.406 } # Create your own empire?
										}
									}
								}
								1 = {
									modifier = {
										factor = 0
										has_game_rule = {
											name = treasure_fleet_invasion_rule
											value = no_ai
										}
									}
									random_playable_ruler = {
										limit = {
											can_interact_with_treasure_fleet_trigger = yes
											top_liege = {
												any_realm_province = {
													is_in_active_treasure_fleet_region_trigger = yes
													NOT = {
														any_province = {
															owner = {
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
															NOT = {
																distance = {
																	where = PREV
																	value = 500
																}
															}
															NOT = {
																can_naval_path_to = {
																	target = PREV
																	distance <= 1000
																}
															}
														}
													}
												}
											}
										}
										top_liege = {
											save_event_target_as = potential_tf_invasion_target
											random_realm_province = {
												limit = {
													is_in_active_treasure_fleet_region_trigger = yes
													NOT = {
														any_province = {
															owner = {
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
															NOT = {
																distance = {
																	where = PREV
																	value = 500
																}
															}
															NOT = {
																can_naval_path_to = {
																	target = PREV
																	distance <= 1000
																}
															}
														}
													}
												}
												save_event_target_as = potential_tf_invasion_target_beachhead
											}
										}
										random_playable_ruler = {
											limit = {
												trait = treasure_fleet_voyage
												is_feudal = yes
												has_acceptable_chinese_culture_trigger = yes
												has_acceptable_chinese_religion_trigger = yes
												NOT = {
													top_liege = {
														dynasty = PREV
													}
												}
											}
											preferred_limit = {
												ai = no
												tier = king
												trait = ambitious
											}
											preferred_limit = {
												ai = no
												tier = king
											}
											preferred_limit = {
												ai = no
												tier = duke
												trait = ambitious
											}
											preferred_limit = {
												ai = no
												tier = duke
											}
											preferred_limit = {
												tier = king
												trait = ambitious
											}
											preferred_limit = {
												tier = king
											}
											preferred_limit = {
												ai = no
												tier = count
												trait = ambitious
											}
											preferred_limit = {
												tier = duke
												trait = ambitious
											}
											preferred_limit = {
												tier = duke
											}
											narrative_event = { id = treasurefleet.406 } # Create your own empire?
										}
									}
								}
								199 = {
									province_event = { id = treasurefleet.404 } # Normal departure
								}
							}
						}
						else = {
							province_event = { id = treasurefleet.404 } # Normal departure
						}
					}
				}
			}
			else_if = {
				limit = {
					NOT = {
						has_province_flag = treasure_fleet_is_going_home # Only on the outbound journey
					}
					NOT = {
						has_game_rule = {
							name = treasure_fleet_invasion_rule
							value = forbidden
						}
					}
					any_playable_ruler = {
						can_interact_with_treasure_fleet_trigger = yes
						top_liege = {
							any_realm_province = {
								is_in_active_treasure_fleet_region_trigger = yes
								NOT = {
									any_province = {
										owner = {
											top_liege = {
												is_chinese_emperor_trigger = yes
											}
										}
										NOT = {
											distance = {
												where = PREV
												value = 500
											}
										}
										NOT = {
											can_naval_path_to = {
												target = PREV
												distance <= 1000
											}
										}
									}
								}
							}
						}
						2753 = { # Hangzhou
							check_variable = {
								which = treasure_fleet_army_strength
								value = 10
							}
						}
						any_playable_ruler = {
							trait = treasure_fleet_voyage
							is_feudal = yes
							has_acceptable_chinese_culture_trigger = yes
							has_acceptable_chinese_religion_trigger = yes
							NOT = {
								top_liege = {
									dynasty = PREV
								}
							}
							OR = {
								ai = no
								AND = {
									has_game_rule = {
										name = treasure_fleet_invasion_rule
										value = allowed
									}
								}
							}
						}
					}
				}
				random_list = {
					1 = {
						random_playable_ruler = {
							limit = {
								can_interact_with_treasure_fleet_trigger = yes
								top_liege = {
									any_realm_province = {
										is_in_active_treasure_fleet_region_trigger = yes
										NOT = {
											any_province = {
												owner = {
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
												NOT = {
													distance = {
														where = PREV
														value = 500
													}
												}
												NOT = {
													can_naval_path_to = {
														target = PREV
														distance <= 1000
													}
												}
											}
										}
									}
								}
							}
							top_liege = {
								save_event_target_as = potential_tf_invasion_target
								random_realm_province = {
									limit = {
										is_in_active_treasure_fleet_region_trigger = yes
										NOT = {
											any_province = {
												owner = {
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
												NOT = {
													distance = {
														where = PREV
														value = 500
													}
												}
												NOT = {
													can_naval_path_to = {
														target = PREV
														distance <= 1000
													}
												}
											}
										}
									}
									save_event_target_as = potential_tf_invasion_target_beachhead
								}
							}
							random_playable_ruler = {
								limit = {
									trait = treasure_fleet_voyage
									is_feudal = yes
									has_acceptable_chinese_culture_trigger = yes
									has_acceptable_chinese_religion_trigger = yes
									NOT = {
										top_liege = {
											dynasty = PREV
										}
									}
									ai = no
								}
								preferred_limit = {
									tier = king
								}
								preferred_limit = {
									tier = duke
								}
								narrative_event = { id = treasurefleet.406 } # Create your own empire?
							}
						}
					}
					1 = {
						modifier = {
							factor = 0
							has_game_rule = {
								name = treasure_fleet_invasion_rule
								value = no_ai
							}
						}
						random_playable_ruler = {
							limit = {
								can_interact_with_treasure_fleet_trigger = yes
								top_liege = {
									any_realm_province = {
										is_in_active_treasure_fleet_region_trigger = yes
										NOT = {
											any_province = {
												owner = {
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
												NOT = {
													distance = {
														where = PREV
														value = 500
													}
												}
												NOT = {
													can_naval_path_to = {
														target = PREV
														distance <= 1000
													}
												}
											}
										}
									}
								}
							}
							top_liege = {
								save_event_target_as = potential_tf_invasion_target
								random_realm_province = {
									limit = {
										is_in_active_treasure_fleet_region_trigger = yes
										NOT = {
											any_province = {
												owner = {
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
												NOT = {
													distance = {
														where = PREV
														value = 500
													}
												}
												NOT = {
													can_naval_path_to = {
														target = PREV
														distance <= 1000
													}
												}
											}
										}
									}
									save_event_target_as = potential_tf_invasion_target_beachhead
								}
							}
							random_playable_ruler = {
								limit = {
									trait = treasure_fleet_voyage
									is_feudal = yes
									has_acceptable_chinese_culture_trigger = yes
									has_acceptable_chinese_religion_trigger = yes
									NOT = {
										top_liege = {
											dynasty = PREV
										}
									}
								}
								preferred_limit = {
									ai = no
									tier = king
									trait = ambitious
								}
								preferred_limit = {
									ai = no
									tier = king
								}
								preferred_limit = {
									ai = no
									tier = duke
									trait = ambitious
								}
								preferred_limit = {
									ai = no
									tier = duke
								}
								preferred_limit = {
									tier = king
									trait = ambitious
								}
								preferred_limit = {
									tier = king
								}
								preferred_limit = {
									ai = no
									tier = count
									trait = ambitious
								}
								preferred_limit = {
									tier = duke
									trait = ambitious
								}
								preferred_limit = {
									tier = duke
								}
								narrative_event = { id = treasurefleet.406 } # Create your own empire?
							}
						}
					}
					199 = {
						province_event = { id = treasurefleet.404 } # Normal departure
					}
				}
			}
			else = {
				province_event = { id = treasurefleet.404 } # Normal departure
			}
		}
	}
}

# If neither tie-in is on the table, randomize a destination and go back to journey, or select homeward journey and go to proper journey
province_event = {
	id = treasurefleet.404
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# First see if we're going home
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = tf_supplies
						value = -10
					}
				}
			}
			set_province_flag = treasure_fleet_is_going_home
		}
		else_if = {
			limit = {
				NOT = {
					check_variable = {
						which = tf_supplies
						value = 0
					}
				}
			}
			random = {
				chance = 25
				set_province_flag = treasure_fleet_is_going_home
			}
		}
		else_if = {
			limit = {
				OR = {
					has_province_flag = treasure_fleet_in_java # Home (SI handled)
					has_province_flag = treasure_fleet_in_persian_gulf # Home
					has_province_flag = treasure_fleet_in_red_sea # Home
				}
			}
			set_province_flag = treasure_fleet_is_going_home
		}
		
		# Then see where we're going
		if = {
			limit = {
				has_province_flag = treasure_fleet_in_korea
			}
			clr_province_flag = treasure_fleet_in_korea
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_china
			}
			else = {
				set_province_flag = treasure_fleet_going_to_japan
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_japan
			}
			clr_province_flag = treasure_fleet_in_japan
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_china
			}
			else = {
				set_province_flag = treasure_fleet_going_to_ryukyu
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_ryukyu
			}
			clr_province_flag = treasure_fleet_in_ryukyu
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_china
			}
			else = {
				set_province_flag = treasure_fleet_going_to_maynila
			}
		}
		#else_if = {
		#	limit = {
		#		has_province_flag = treasure_fleet_in_taiwan
		#	}
		#	clr_province_flag = treasure_fleet_in_taiwan
		#	if = {
		#		limit = {
		#			has_province_flag = treasure_fleet_is_going_home
		#		}
		#		set_province_flag = treasure_fleet_going_to_china
		#	}
		#	else = {
		#		set_province_flag = treasure_fleet_going_to_maynila
		#	}
		#}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_maynila
			}
			clr_province_flag = treasure_fleet_in_maynila
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_china
			}
			else = {
				random_list = {
					50 = {
						set_province_flag = treasure_fleet_going_to_borneo
					}
					50 = {
						set_province_flag = treasure_fleet_going_to_champa
					}
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_borneo
			}
			clr_province_flag = treasure_fleet_in_borneo
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_maynila
			}
			else = {
				set_province_flag = treasure_fleet_going_to_temasek
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_champa
			}
			clr_province_flag = treasure_fleet_in_champa
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_china
			}
			else = {
				random_list = {
					50 = {
						set_province_flag = treasure_fleet_going_to_lavo
					}
					50 = {
						set_province_flag = treasure_fleet_going_to_temasek
					}
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_lavo
			}
			clr_province_flag = treasure_fleet_in_lavo
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_champa
			}
			else = {
				set_province_flag = treasure_fleet_going_to_temasek
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_temasek
			}
			clr_province_flag = treasure_fleet_in_temasek
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				#random_list = {
					#50 = {
						set_province_flag = treasure_fleet_going_to_champa
					#}
					#50 = {
					#	set_province_flag = treasure_fleet_going_to_borneo
					#}
				#}
			}
			else = {
				random_list = {
					25 = {
						set_province_flag = treasure_fleet_going_to_palembang
					}
					75 = {
						set_province_flag = treasure_fleet_going_to_lamuri
					}
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_palembang
			}
			clr_province_flag = treasure_fleet_going_to_palembang
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_temasek
			}
			else = {
				set_province_flag = treasure_fleet_going_to_java
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_going_to_java
			}
			clr_province_flag = treasure_fleet_going_to_java
			set_province_flag = treasure_fleet_going_to_palembang
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_lamuri
			}
			clr_province_flag = treasure_fleet_in_lamuri
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_temasek
			}
			else = {
				random_list = {
					25 = {
						set_province_flag = treasure_fleet_going_to_dagon
					}
					75 = {
						set_province_flag = treasure_fleet_going_to_lanka
					}
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_dagon
			}
			clr_province_flag = treasure_fleet_in_dagon
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_lamuri
			}
			else = {
				set_province_flag = treasure_fleet_going_to_bengal
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_bengal
			}
			clr_province_flag = treasure_fleet_in_bengal
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_dagon
			}
			else = {
				set_province_flag = treasure_fleet_going_to_eastern_india
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_eastern_india
			}
			clr_province_flag = treasure_fleet_in_eastern_india
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_dagon
			}
			else = {
				set_province_flag = treasure_fleet_going_to_lanka
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_lanka
			}
			clr_province_flag = treasure_fleet_in_lanka
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_lamuri
			}
			else = {
				set_province_flag = treasure_fleet_going_to_western_india
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_western_india
			}
			clr_province_flag = treasure_fleet_in_western_india
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_lanka
			}
			else = {
				set_province_flag = treasure_fleet_going_to_sindh
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_sindh
			}
			clr_province_flag = treasure_fleet_in_sindh
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_western_india
			}
			else = {
				set_province_flag = treasure_fleet_going_to_oman
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_oman
			}
			clr_province_flag = treasure_fleet_in_oman
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_western_india
			}
			else = {
				random_list = {
					50 = {
						set_province_flag = treasure_fleet_going_to_persian_gulf
					}
					50 = {
						set_province_flag = treasure_fleet_going_to_socotra
					}
				}
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_persian_gulf
			}
			clr_province_flag = treasure_fleet_in_persian_gulf
			set_province_flag = treasure_fleet_going_to_oman
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_socotra
			}
			clr_province_flag = treasure_fleet_in_socotra
			if = {
				limit = {
					has_province_flag = treasure_fleet_is_going_home
				}
				set_province_flag = treasure_fleet_going_to_lanka
			}
			else = {
				set_province_flag = treasure_fleet_going_to_red_sea
			}
		}
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_in_red_sea
			}
			clr_province_flag = treasure_fleet_in_red_sea
			set_province_flag = treasure_fleet_going_to_socotra
		}
		else = {
			log = "Treasure Fleet failed to find destination!"
			clr_province_flag = treasure_fleet_in_korea
			clr_province_flag = treasure_fleet_in_japan
			clr_province_flag = treasure_fleet_in_ryukyu
			clr_province_flag = treasure_fleet_in_taiwan
			clr_province_flag = treasure_fleet_in_maynila
			clr_province_flag = treasure_fleet_in_borneo
			clr_province_flag = treasure_fleet_in_champa
			clr_province_flag = treasure_fleet_in_lavo
			clr_province_flag = treasure_fleet_in_temasek
			clr_province_flag = treasure_fleet_in_palembang
			clr_province_flag = treasure_fleet_in_java
			clr_province_flag = treasure_fleet_in_lamuri
			clr_province_flag = treasure_fleet_in_dagon
			clr_province_flag = treasure_fleet_in_bengal
			clr_province_flag = treasure_fleet_in_eastern_india
			clr_province_flag = treasure_fleet_in_lanka
			clr_province_flag = treasure_fleet_in_western_india
			clr_province_flag = treasure_fleet_in_sindh
			clr_province_flag = treasure_fleet_in_oman
			clr_province_flag = treasure_fleet_in_persian_gulf
			clr_province_flag = treasure_fleet_in_socotra
			clr_province_flag = treasure_fleet_in_red_sea
			set_province_flag = treasure_fleet_is_going_home
			set_province_flag = treasure_fleet_going_to_china
		}
		
		clr_province_flag = treasure_fleet_port_flag
		set_province_flag = treasure_fleet_voyage_flag
		province_event = { id = treasurefleet.102 days = 15 } # Travel events
		
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				ai = no
			}
			character_event = { id = treasurefleet.405 }
		}
	}
}

# Inform members that the TF departs normally
character_event = {
	id = treasurefleet.405
	desc = EVTDESC_TREASURE_FLEET_405
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_405 # All aboard!
	}
}

##### Empire in the West tie-in

# You see an opportunity to create your own empire - do you want to seize it?
narrative_event = {
	id = treasurefleet.406
	title = EVTTITLE_TREASURE_FLEET_406
	desc = EVTDESC_TREASURE_FLEET_406
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_406 # Yes!
		
		if = {
			limit = {
				has_dlc = "Jade Dragon"
			}
			if = { # If we have positive Grace, zero it out!
				limit = {
					check_variable = {
						which = grace
						value = 1
					}
				}
				set_variable = {
					which = grace
					value = 0
				}
			}
			detract_grace_super_huge_effect = yes # China is VERY upset with you for doing this!
		}
		
		e_china = {
			holder_scope = {
				opinion = {
					who = ROOT
					modifier = opinion_traitor
				}
				random_realm_province = {
					save_event_target_as = tf_character_home_province
				}
			}
		}
		any_demesne_title = {
			e_china = {
				holder_scope = {
					add_claim = PREVPREV
				}
			}
		}
		
		event_target:potential_tf_invasion_target_beachhead = {
			set_province_flag = tf_invasion_target_beachhead
			kingdom = {
				save_event_target_as = tf_invasion_kingdom
			}
			disembark_regiments_until_unable_to_continue_effect = yes
		}
		
		# Spawn a few good commanders, to make up for us having a regency...
		create_random_soldier = {
			age = 21
			female = no
			dynasty = none
			attributes = {
				diplomacy = 2
				martial = 7
				stewardship = 5
				intrigue = 4
				learning = 6
			}
			trait = skilled_tactician
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			random_traits =	yes
		}
		create_random_soldier = {
			age = 32
			female = no
			dynasty = none
			attributes = {
				diplomacy = 2
				martial = 7
				stewardship = 5
				intrigue = 4
				learning = 6
			}
			trait = skilled_tactician
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			random_traits =	yes
		}
		create_random_soldier = {
			age = 43
			female = no
			dynasty = none
			attributes = {
				diplomacy = 2
				martial = 7
				stewardship = 5
				intrigue = 4
				learning = 6
			}
			trait = skilled_tactician
			culture = event_target:tf_character_home_province
			religion = event_target:tf_character_home_province
			random_traits =	yes
		}
		
		war = {
			target = event_target:potential_tf_invasion_target
			casus_belli = tf_invasion
			thirdparty_title = event_target:tf_invasion_kingdom
		}
		
		activate_title = {
			title = d_treasure_fleet
			status = no
		}
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				ai = no
			}
			character_event = { id = treasurefleet.407 } # Inform other members
		}
		e_china = {
			holder_scope = {
				character_event = { id = treasurefleet.408 } # Inform the EoC
			}
		}
		any_independent_ruler = {
			limit = {
				NOT = {
					war_with = ROOT
				}
				is_chinese_emperor_trigger = no
				ai = no
			}
			character_event = { id = treasurefleet.409 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = proud
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = ambitious
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = brave
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {
						check_variable = {
							which = treasure_fleet_army_strength
							value = 25
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_406 # No!
		
		FROM = {
			province_event = { id = treasurefleet.404 } # Back to normal travel
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				NOT = {
					trait = humble
				}
			}
			modifier = {
				factor = 0.5
				NOT = {
					trait = content
				}
			}
			modifier = {
				factor = 0.5
				NOT = {
					trait = craven
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					check_variable = {
						which = treasure_fleet_army_strength
						value = 50
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					check_variable = {
						which = treasure_fleet_army_strength
						value = 75
					}
				}
			}
			modifier = {
				factor = 0.5
				FROM = {
					check_variable = {
						which = treasure_fleet_army_strength
						value = 100
					}
				}
			}
		}
	}
}

# Opportunity seized - inform the TF
character_event = {
	id = treasurefleet.407
	desc = EVTDESC_TREASURE_FLEET_407
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_407 # That's treason!
	}
}

# Opportunity seized - inform the EoC
character_event = {
	id = treasurefleet.408
	desc = EVTDESC_TREASURE_FLEET_408
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_408 # That's treason!
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
	}
}

# Opportunity seized - inform the rest of the world
character_event = {
	id = treasurefleet.409
	desc = EVTDESC_TREASURE_FLEET_409
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_409 # Interesting...
	}
}

##### Sunrise Invasion tie-in

# Sail East? - commander calls for a vote - player votes are worth more than AI votes
character_event = {
	id = treasurefleet.410
	desc = EVTDESC_TREASURE_FLEET_410
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_410 # Yes!
		
		hidden_tooltip = {
			if = {
				limit = {
					ai = no
				}
				FROM = {
					change_variable = {
						which = tf_head_east_vote
						value = 10
					}
				}
			}
			else = {
				FROM = {
					change_variable = {
						which = tf_head_east_vote
						value = 1
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_410 # No!
		
		hidden_tooltip = {
			if = {
				limit = {
					ai = no
				}
				FROM = {
					change_variable = {
						which = tf_head_east_vote
						value = -10
					}
				}
			}
			else = {
				FROM = {
					change_variable = {
						which = tf_head_east_vote
						value = -1
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
}

# Check outcome
province_event = {
	id = treasurefleet.411
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				check_variable = {
					which = tf_head_east_vote
					value = 1
				}
			}
			clr_province_flag = treasure_fleet_port_flag
			clr_province_flag = treasure_fleet_in_java
			set_province_flag = treasure_fleet_sunrise_invasion_flag
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					ai = no
				}
				character_event = { id = treasurefleet.412 } # East
			}
			province_event = { id = treasurefleet.414 days = 15 } # Islanders
		}
		else = {
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					ai = no
				}
				character_event = { id = treasurefleet.413 } # Home
			}
			province_event = { id = treasurefleet.404 days = 1 } # Sail home
		}
	}
}

# TF is heading East - members informed
character_event = {
	id = treasurefleet.412
	desc = EVTDESC_TREASURE_FLEET_412
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_412 # Very well...
	}
}

# TF is not heading East and thus heads home - members informed
character_event = {
	id = treasurefleet.413
	desc = EVTDESC_TREASURE_FLEET_413
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_413 # Very well...
	}
}

##### Islander events

# Event selection
province_event = {
	id = treasurefleet.414
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Reduce food
		random_list = {
			10 = {
				change_variable = {
					which = tf_supplies
					value = -1
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -2
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -3
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -4
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -5
				}
			}
		}
		random_list = {
			10 = {
				d_treasure_fleet = {
					holder_scope = {
						random_list = {
							1 = {
								# Islanders attack the fleet
								character_event = { id = treasurefleet.415 days = 1 random = 15 }
							}
							1 = {
								# Islanders sell food
								character_event = { id = treasurefleet.428 days = 1 random = 15 }
							}
						}
					}
				}
			}
			90 = {
				d_treasure_fleet = {
					holder_scope = {
						random_list = {
							10 = {
								# Islands avoid the fleet
								character_event = { id = treasurefleet.429 days = 1 random = 15 }
							}
							10 = {
								# Islanders invite you to a feast
								character_event = { id = treasurefleet.430 days = 1 random = 15 }
							}
							1 = {
								# Islanders invite you to a "special" feast
								character_event = { id = treasurefleet.442 days = 1 random = 15 }
							}
							10 = {
								# Islanders advise against sailing further east
								character_event = { id = treasurefleet.453 days = 1 random = 15 }
							}
							10 = {
								# Islanders offer star charts
								character_event = { id = treasurefleet.454 days = 1 random = 15 }
							}
							10 = {
								# Islanders are unhelpful
								character_event = { id = treasurefleet.455 days = 1 random = 15 }
							}
							10 = {} # Nothing
						}
					}
				}
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
					}
					random_list = {
						10 = {
							# Islands avoid the fleet
							character_event = { id = treasurefleet.429 days = 1 random = 15 }
						}
						10 = {
							# Islanders invite you to a feast
							character_event = { id = treasurefleet.430 days = 1 random = 15 }
						}
						1 = {
							# Islanders invite you to a "special" feast
							character_event = { id = treasurefleet.442 days = 1 random = 15 }
						}
						10 = {
							# Islanders advise against sailing further east
							character_event = { id = treasurefleet.453 days = 1 random = 15 }
						}
						10 = {
							# Islanders offer star charts
							character_event = { id = treasurefleet.454 days = 1 random = 15 }
						}
						10 = {
							# Islanders are unhelpful
							character_event = { id = treasurefleet.455 days = 1 random = 15 }
						}
						10 = {
							modifier = {
								factor = 5
								ai = yes
							}
							# Nothing
						}
					}
				}
			}
		}
		province_event = { id = treasurefleet.459 days = 30 random = 30 } # Part 2
	}
}

### Islanders attack the fleet

# Islanders attacks ship - inform commander
character_event = {
	id = treasurefleet.415
	desc = EVTDESC_TREASURE_FLEET_415
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_415 # To arms!
		if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 100
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							99 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 50
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							49 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 25
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							24 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 10
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							9 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 5
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							4 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 4
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							3 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 3
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							2 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else_if = {
			limit = {
				FROM = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			FROM = {
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 2
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 2
					}
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						random_list = {
							1 = {
								character_event = { id = treasurefleet.416 } # Your ship was attacked!
							}
							1 = {
								character_event = { id = treasurefleet.417 } # Other ship was attacked!
							}
						}
					}
				}
			}
		}
		else = {
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.416 } # Your ship was attacked!
					}
				}
			}
		}
		FROM = {
			province_event = { id = treasurefleet.418 days = 1 } # Calculate the outcome
		}
	}
}

# Islanders attacks ship - inform people on that ship
character_event = {
	id = treasurefleet.416
	desc = EVTDESC_TREASURE_FLEET_416
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_416 # To arms!
		
		set_character_flag = tf_call_to_arms
	}
}

# Islanders attacks ship - inform people on other ships
character_event = {
	id = treasurefleet.417
	desc = EVTDESC_TREASURE_FLEET_417
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_417 # How horrible!
	}
}

# Check outcome
province_event = {
	id = treasurefleet.418
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# First, let's see how strong the TF is
		set_variable = {
			which = tf_fighting_value
			value = 0
		}
		change_variable = {
			which = tf_fighting_value
			which = treasure_fleet_army_strength
		}
		multiply_variable = {
			which = tf_fighting_value
			value = 10
		}
		divide_variable = {
			which = tf_fighting_value
			which = treasure_fleet_ship_strength
		}
		set_variable = {
			which = tf_pcs
			value = 0
		}
		if = {
			limit = {
				is_variable_equal = {
					which = treasure_fleet_ship_strength
					value = 1
				}
			}
			d_treasure_fleet = {
				holder_scope = {
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
						has_character_flag = tf_call_to_arms
					}
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		change_variable = {
			which = tf_fighting_value
			which = tf_pcs
		}
		
		# Then randomize the enemy
		random_list = {
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -500
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -250
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -100
				}
			}
			1 = {
				change_variable = {
					which = tf_fighting_value
					value = -50
				}
			}
		}
		
		# Now let's see what the outcome is
		if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value = 2
				}
			}
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				change_variable = {
					which = treasure_fleet_ship_strength
					value = -1
				}
				# Ship sinks
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.422 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.423 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.424 }
							}
						}
					}
				}
			}
			else = {
				# Pirates driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.419 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.420 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.421 }
							}
						}
					}
				}
			}
		}
		else = {
			# Special case: The fleet might be lost!
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.425 }
						any_courtier = {
							character_event = { id = treasurefleet.425 }
						}
					}
				}
				activate_title = {
					title = d_treasure_fleet
					status = no
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							character_event = { id = treasurefleet.425 }
						}
						character_event = { id = treasurefleet.426 }
					}
				}
				any_player = {
					limit = {
						NOR = {
							trait = treasure_fleet_voyage
							has_landed_title = e_china
						}
					}
					character_event = { id = treasurefleet.427 }
				}
				clean_up_old_treasure_fleet_effect = yes
			}
			else = {
				# Pirates driven off
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = treasurefleet.422 }
					}
				}
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									has_character_flag = tf_call_to_arms
								}
								character_event = { id = treasurefleet.423 }
								clr_character_flag = tf_call_to_arms
							}
							else = {
								character_event = { id = treasurefleet.424 }
							}
						}
					}
				}
			}
		}
	}
}

# Islanders driven off - inform commander
character_event = {
	id = treasurefleet.419
	desc = EVTDESC_TREASURE_FLEET_419
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_419 # Great!
		
		prestige = 100
	}
}

# Islanders driven off - inform people on that ship
character_event = {
	id = treasurefleet.420
	desc = EVTDESC_TREASURE_FLEET_420
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_420 # Great!
		
		prestige = 100
	}
}

# Islanders driven off - inform people on other ships
character_event = {
	id = treasurefleet.421
	desc = EVTDESC_TREASURE_FLEET_421
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_421 # Great!
		
		prestige = 100
	}
}

# Ship destroyed - inform commander
character_event = {
	id = treasurefleet.422
	desc = EVTDESC_TREASURE_FLEET_422
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_422 # Oh, no!
	}
}

# Ship destroyed - inform people on that ship
character_event = {
	id = treasurefleet.423
	desc = EVTDESC_TREASURE_FLEET_423
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_423 # I must swim to safety!
		
		random_list = {
			50 = {}
			25 = {
				add_trait = wounded
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				add_maimed_trait_effect = yes
			}
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				modifier = {
					factor = 2
					is_dumb_trigger = yes
				}
				death = {
					death_reason = death_accident_drowning
				}
			}
			50 = {
				modifier = {
					factor = 5
					is_strong_trigger = yes
				}
				modifier = {
					factor = 2
					is_smart_trigger = yes
				}
			}
		}
	}
}

# Ship destroyed - inform people on other ships
character_event = {
	id = treasurefleet.424
	desc = EVTDESC_TREASURE_FLEET_424
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_424 # Oh, no!
	}
}

# Last ship destroyed - inform all TF people
character_event = {
	id = treasurefleet.425
	desc = EVTDESC_TREASURE_FLEET_425
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_425 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship destroyed - inform the EoC
character_event = {
	id = treasurefleet.426
	desc = EVTDESC_TREASURE_FLEET_426
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_426 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
	}
}

# Last ship destroyed - inform the world
character_event = {
	id = treasurefleet.427
	desc = EVTDESC_TREASURE_FLEET_427
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_427 # I see...
	}
}

### Islanders sell food

# Offer made
character_event = {
	id = treasurefleet.428
	desc = EVTDESC_TREASURE_FLEET_428
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROM = {
				check_variable = {
					which = treasure_fleet_wealth
					value = 5
				}
			}
		}
		name = EVTOPTA_TREASURE_FLEET_428 # Sure!
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = treasure_fleet_wealth
					value = -5
				}
				change_variable = {
					which = tf_supplies
					value = 10
				}
				if = {
					limit = {
						has_dlc = "Jade Dragon"
					}
					remove_random_jd_artifact_for_each_tier_effect = yes
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
				FROM = {
					check_variable = {
						which = tf_supplies
						value = 0
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_428 # Nah!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					FROM = {
						check_variable = {
							which = tf_supplies
							value = 0
						}
					}
				}
			}
		}
	}
}

### Islanders avoid the fleet

# Informed that islanders are avoiding the fleet
character_event = {
	id = treasurefleet.429
	desc = EVTDESC_TREASURE_FLEET_429
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_429 # Curious...
	}
}

### Islanders invite you to a feast - normal

# Invitation arrives
character_event = {
	id = treasurefleet.430
	desc = EVTDESC_TREASURE_FLEET_430
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_430 # Sure!
		
		character_event = { id = treasurefleet.431 days = 5 random = 5 }
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_430 # Nah!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0.01
				trait = gluttonous
			}
		}
	}
}

# Let's see what happens
character_event = {
	id = treasurefleet.431
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				character_event = { id = treasurefleet.432 } # Food is nice
			}
			1 = {
				character_event = { id = treasurefleet.433 } # Drinks are nice
			}
			1 = {
				character_event = { id = treasurefleet.434 } # Islanders are primitive
			}
			1 = {
				character_event = { id = treasurefleet.435 } # Attractive islander
			}
			1 = {
				character_event = { id = treasurefleet.436 } # Fighting lesson
			}
			1 = {
				character_event = { id = treasurefleet.439 } # Islander soldier
			}
			1 = {
				character_event = { id = treasurefleet.440 } # Islanders are advanced
			}
			1 = {
				character_event = { id = treasurefleet.441 } # Islanders have gold
			}
		}
	}
}

# Food is nice - become more gluttonous
character_event = {
	id = treasurefleet.432
	desc = EVTDESC_TREASURE_FLEET_432
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_432 # More food!
		
		if = {
			limit = {
				trait = temperate
			}
			remove_trait = temperate
		}
		else = {
			add_trait = gluttonous
		}
		
		random_list = {
			1 = {
				gain_weight_small_effect = yes
			}
			1 = {
				gain_weight_medium_effect = yes
			}
			1 = {
				gain_weight_large_effect = yes
			}
		}
	}
}

# Islanders have strong drinks - become Drunkard
character_event = {
	id = treasurefleet.433
	desc = EVTDESC_TREASURE_FLEET_433
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_433 # Maybe I drank too much...
		
		add_trait = drunkard
		
		prestige = -25
	}
}

# Islanders are depressingly primitive - become more proud
character_event = {
	id = treasurefleet.434
	desc = EVTDESC_TREASURE_FLEET_434
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_434 # They are savages!
		
		if = {
			limit = {
				trait = humble
			}
			remove_trait = humble
		}
		else = {
			add_trait = proud
		}
		
		prestige = 10
	}
}

# Someone is attractive - tumble?
character_event = {
	id = treasurefleet.435
	desc = EVTDESC_TREASURE_FLEET_435
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		d_treasure_fleet = {
			holder_scope = {
				if = {
					limit = {
						is_female = no
						NOT = {
							trait = homosexual
						}
					}
					create_character = {
						age = 17
						female = yes
						dynasty = none
						culture = papuan
						religion = melanesian_pagan
						random_traits = yes
						trait = fair
						trait = lustful
						trait = kind
						trait = charismatic_negotiator
						attributes = {
							intrigue = 5
							stewardship = 3
							learning = 1
							martial = 2
							diplomacy = 4
						}
					}
					new_character = {
						remove_trait = homosexual
					}
				}
				else_if = {
					limit = {
						is_female = yes
						trait = homosexual
					}
					create_character = {
						age = 17
						female = yes
						dynasty = none
						culture = papuan
						religion = melanesian_pagan
						random_traits = yes
						trait = fair
						trait = lustful
						trait = kind
						trait = charismatic_negotiator
						trait = homosexual
						attributes = {
							intrigue = 5
							stewardship = 3
							learning = 1
							martial = 2
							diplomacy = 4
						}
					}
				}
				else_if = {
					limit = {
						is_female = yes
						trait = homosexual
					}
					create_character = {
						age = 17
						female = no
						dynasty = none
						culture = papuan
						religion = melanesian_pagan
						random_traits = yes
						trait = fair
						trait = lustful
						trait = kind
						trait = charismatic_negotiator
						attributes = {
							intrigue = 5
							stewardship = 3
							learning = 1
							martial = 2
							diplomacy = 4
						}
					}
					new_character = {
						remove_trait = homosexual
					}
				}
				else_if = {
					limit = {
						is_female = no
						NOT = {
							trait = homosexual
						}
					}
					create_character = {
						age = 17
						female = no
						dynasty = none
						culture = papuan
						religion = melanesian_pagan
						random_traits = yes
						trait = fair
						trait = lustful
						trait = kind
						trait = charismatic_negotiator
						trait = homosexual
						attributes = {
							intrigue = 5
							stewardship = 3
							learning = 1
							martial = 2
							diplomacy = 4
						}
					}
				}
				new_character = {
					save_event_target_as = attractive_islander
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_435 # Yes!
		
		event_target:attractive_islander = {
			save_event_target_as = sex_partner
			add_lover = ROOT
		}
		unprotected_sex_effect_event_target = yes
		
		piety = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				is_ascetic_trigger = yes
				NOT = {
					trait = lustful
				}
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
			modifier = {
				factor = 5
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_142 # I don't think so!
		
		
		event_target:attractive_islander = {
			leave_court_and_die_effect = yes
		}
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0
				OR = {
					trait = seducer
					trait = seductress
				}
			}
		}
	}
}

# Islanders offer you a fighting lesson - accept?
character_event = {
	id = treasurefleet.436
	desc = EVTDESC_TREASURE_FLEET_436
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_436 # Sure!
		
		random_list = {
			50 = {
				character_event = { id = treasurefleet.437 days = 1 } # It goes well
			}
			50 = {
				character_event = { id = treasurefleet.438 days = 1 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0.01
				trait = slothful
			}
			modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_436 # Nah!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0.01
				trait = diligent
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
		}
	}
}

# Good fighting lesson
character_event = {
	id = treasurefleet.437
	desc = EVTDESC_TREASURE_FLEET_437
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_437 # Great!
		
		add_one_duel_experience_modifier = yes
		
		prestige = 10
	}
}

# Bad fighting lesson
character_event = {
	id = treasurefleet.438
	desc = EVTDESC_TREASURE_FLEET_438
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_438 # Ow!
		
		add_trait = wounded
		
		prestige = -10
	}
}

# Islander pledges themself to you
character_event = {
	id = treasurefleet.439
	desc = EVTDESC_TREASURE_FLEET_439
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		d_treasure_fleet = {
			holder_scope = {
				random_list = {
					50 = {
						create_random_soldier = {
							age = 25
							female = no
							dynasty = none
							culture = papuan
							religion = melanesian_pagan
							random_traits =	yes
						}
					}
					50 = {
						create_random_soldier = {
							age = 25
							female = yes
							dynasty = none
							culture = papuan
							religion = melanesian_pagan
							random_traits =	yes
						}
					}
				}
				new_character = {
					save_event_target_as = new_islander
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_439 # They're welcome here!
		
		event_target:new_islander = {
			opinion = {
				who = ROOT
				modifier = opinion_loyal_servant
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_439 # I don't like them!
		
		event_target:new_islander = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Islanders are more advanced than you think - gain tech points
character_event = {
	id = treasurefleet.440
	desc = EVTDESC_TREASURE_FLEET_440
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_440 # Huh...
		
		culture_techpoints = 10
		economy_techpoints = 10
		military_techpoints = 10
	}
}

# Islanders offer you a gift of gold - accept?
character_event = {
	id = treasurefleet.441
	desc = EVTDESC_TREASURE_FLEET_441
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_441 # Sure!
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		
		wealth = 100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_441 # No thanks!
		
		if = {
			limit = {
				trait = greedy
			}
			remove_trait = greedy
		}
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
}

### Islanders invite you to a feast - cannibals

# Invited
character_event = {
	id = treasurefleet.442
	desc = EVTDESC_TREASURE_FLEET_442
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_442 # Sure!
		
		character_event = { id = treasurefleet.443 days = 5 random = 5 }
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0.1
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_442 # Nah!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0.01
				trait = gluttonous
			}
		}
	}
}

# Let's see which version you get
character_event = {
	id = treasurefleet.443
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				modifier = {
					factor = 0
					NOT = {
						trait = cannibal_trait
					}
				}
				# Guest of honor
				character_event = { id = treasurefleet.444 }
			}
			10 = {
				modifier = {
					factor = 0
					trait = cannibal_trait
				}
				# Normal guest
				character_event = { id = treasurefleet.445 }
			}
			1 = {
				modifier = {
					factor = 0
					trait = cannibal_trait
				}
				# Main course
				character_event = { id = treasurefleet.449 }
			}
		}
	}
}

# Cannibal is guest of honor
character_event = {
	id = treasurefleet.444
	desc = EVTDESC_TREASURE_FLEET_444
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_444 # More food!
		
		prestige = 50
		
		if = {
			limit = {
				trait = temperate
			}
			remove_trait = temperate
		}
		else = {
			add_trait = gluttonous
		}
		
		random_list = {
			1 = {
				gain_weight_small_effect = yes
			}
			1 = {
				gain_weight_medium_effect = yes
			}
			1 = {
				gain_weight_large_effect = yes
			}
		}
	}
}

# Non-cannibal is regular guest - relizes what kind of food is being offered
character_event = {
	id = treasurefleet.445
	desc = EVTDESC_TREASURE_FLEET_445
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_445 # I guess I have no choice...
		
		add_trait = cannibal_trait
		
		prestige = -25
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_445 # Run away!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 40
					}
				}
				modifier = {
					factor = 10
					combat_rating = 60
				}
				character_event = { id = treasurefleet.446 days = 1 random = 1 } # You escape
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 80
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 20
					}
				}
				character_event = { id = treasurefleet.447 days = 1 random = 1 } # You get wounded
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				character_event = { id = treasurefleet.448 days = 1 random = 1 } # You are attacked and killed
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
}

# You fled and got away
character_event = {
	id = treasurefleet.446
	desc = EVTDESC_TREASURE_FLEET_446
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_446 # I got away!
		
		prestige = 50
	}
}

# You fled and got wounded
character_event = {
	id = treasurefleet.447
	desc = EVTDESC_TREASURE_FLEET_447
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_447 # I got away!
		
		prestige = 25
		add_trait = wounded
	}
}

# You fled but they caught you
character_event = {
	id = treasurefleet.448
	desc = EVTDESC_TREASURE_FLEET_448
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_448 # No! No! No!
		
		prestige = -50
		
		death = {
			death_reason = death_cannibals
		}
	}
}

# Non-cannibal is "guest of honor", a.k.a. the main course
character_event = {
	id = treasurefleet.449
	desc = EVTDESC_TREASURE_FLEET_449
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_449 # Run away!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 20
					}
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 40
					}
				}
				modifier = {
					factor = 10
					combat_rating = 60
				}
				character_event = { id = treasurefleet.450 days = 1 random = 1 } # You escape
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 80
				}
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 20
					}
				}
				character_event = { id = treasurefleet.451 days = 1 random = 1 } # You get wounded
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 40
				}
				modifier = {
					factor = 0.1
					combat_rating = 20
				}
				character_event = { id = treasurefleet.452 days = 1 random = 1 } # You are attacked and killed
			}
		}
	}
}

# You fled and got away
character_event = {
	id = treasurefleet.450
	desc = EVTDESC_TREASURE_FLEET_450
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_450 # I got away!
		
		prestige = 50
	}
}

# You fled and got wounded
character_event = {
	id = treasurefleet.451
	desc = EVTDESC_TREASURE_FLEET_451
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_451 # I got away!
		
		prestige = 25
		add_trait = wounded
	}
}

# You fled but they caught you
character_event = {
	id = treasurefleet.452
	desc = EVTDESC_TREASURE_FLEET_452
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_452 # No! No! No!
		
		prestige = -50
		
		death = {
			death_reason = death_cannibals
		}
	}
}

### Islanders advise about sailing further east

# Might get scared
character_event = {
	id = treasurefleet.453
	desc = EVTDESC_TREASURE_FLEET_453
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_453 # "No ships return...?"
		
		if = {
			limit = {
				trait = brave
			}
			random = {
				chance = 25
				remove_trait = brave
			}
		}
		else = {
			random = {
				chance = 25
				add_trait = craven
			}
		}
	}
}

### Islanders offer star chart

# Offer is made
character_event = {
	id = treasurefleet.454
	desc = EVTDESC_TREASURE_FLEET_454
	picture = GFX_evt_east_indo_village
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth = 100
		}
		name = EVTOPTA_TREASURE_FLEET_454 # Sure!
		
		wealth = -100
		
		change_learning = 1
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_454 # Nah!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = charitable
			}
		}
	}
}

### Islanders are unhelpful - teach them a lesson?

# Teach islanders a lesson?
character_event = {
	id = treasurefleet.455
	desc = EVTDESC_TREASURE_FLEET_455
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_455 # Yes!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					martial = 24
				}
				modifier = {
					factor = 2
					martial = 20
				}
				modifier = {
					factor = 2
					martial = 16
				}
				# It goes well
				character_event = { id = treasurefleet.456 days = 2 random = 5 }
			}
			50 = {
				# It goes poorly
				character_event = { id = treasurefleet.457 days = 2 random = 5 }
			}
			50 = {
				modifier = {
					factor = 2
					NOT = {
						martial = 12
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 8
					}
				}
				modifier = {
					factor = 2
					NOT = {
						martial = 4
					}
				}
				# It goes extremely poorly
				character_event = { id = treasurefleet.458 days = 2 random = 5 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_455 # No!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# It goes well
character_event = {
	id = treasurefleet.456
	desc = EVTDESC_TREASURE_FLEET_456
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_456 # Great!
		
		prestige = 25
		change_martial = 1
	}
}

# It goes poorly - wounded
character_event = {
	id = treasurefleet.457
	desc = EVTDESC_TREASURE_FLEET_457
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_457 # Curses!
		
		prestige = -10
		add_trait = wounded
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_army_strength
					value = -1
				}
			}
		}
	}
}

# It goes extremely poorly - killed
character_event = {
	id = treasurefleet.458
	desc = EVTDESC_TREASURE_FLEET_458
	picture = GFX_evt_tribal_life
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_458 # No!
		
		prestige = -25
		
		death = {
			death_reason = death_battle
		}
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_army_strength
					value = -5
				}
			}
		}
	}
}

##### Special Pacific events - Galapagos, Easter Island, City of Pillars, The Castle, R'lyeh, The Hole in the World

# Event selection
province_event = {
	id = treasurefleet.459
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Reduce food
		random_list = {
			10 = {
				change_variable = {
					which = tf_supplies
					value = -1
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -2
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -3
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -4
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -5
				}
			}
		}
		random_list = {
			10 = {
				# Major event - commander gets the event
				d_treasure_fleet = {
					holder_scope = {
						random_list = {
							10 = {
								# Storm
								character_event = { id = treasurefleet.120 }
							}
							10 = {
								# Fireworks go off
								character_event = { id = treasurefleet.200 }
							}
							20 = {
								modifier = {
									factor = 0
									has_game_rule = {
										name = supernatural_events
										value = off
									}
								}
								modifier = {
									factor = 0
									has_game_rule = {
										name = supernatural_events
										value = on
									}
									NOT = {
										any_player = {
											trait = treasure_fleet_voyage
										}
									}
								}
								# R'lyeh
								narrative_event = { id = treasurefleet.472 }
							}
						}
					}
				}
			}
			80 = {
				# Minor events - various members can get events (players are always reasonably likely to get something, AI may or may not)
				e_china = {
					holder_scope = {
						any_realm_lord = {
							limit = {
								trait = treasure_fleet_voyage
							}
							if = {
								limit = {
									ai = no
								}
								random_list = {
									10 = {
										modifier = {
											factor = 2
											trait = cannibal_trait
										}
										# Cannibals
										character_event = { id = treasurefleet.126 }
									}
									10 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# The Eye
										character_event = { id = treasurefleet.119 }
									}
									10 = {
										# Man overboard
										character_event = { id = treasurefleet.132 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
												}
											}
										}
										# Made a friend
										character_event = { id = treasurefleet.139 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
													OR = {
														AND = {
															PREV = {
																is_female = no
																NOT = {
																	trait = homosexual
																}
															}
															is_female = yes
															NOT = {
																trait = homosexual
															}
														}
														AND = {
															PREV = {
																is_female = yes
																NOT = {
																	trait = homosexual
																}
															}
															is_female = no
															NOT = {
																trait = homosexual
															}
														}
														AND = {
															PREV = {
																is_female = yes
																trait = homosexual
															}
															is_female = yes
															trait = homosexual
														}
														AND = {
															PREV = {
																is_female = no
																trait = homosexual
															}
															is_female = no
															trait = homosexual
														}
													}
												}
											}
										}
										# Tumble opportunity
										character_event = { id = treasurefleet.141 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													NOR = {
														character = PREV
														any_friend = {
															character = PREV
														}
														any_lover = {
															character = PREV
														}
														any_rival = {
															character = PREV
														}
													}
												}
											}
										}
										# Made a rival
										character_event = { id = treasurefleet.147 }
									}
									10 = {
										modifier = {
											factor = 0
											NOT = {
												any_playable_ruler = {
													trait = treasure_fleet_voyage
													any_rival = {
														character = PREV
													}
												}
											}
										}
										# Try to arrange an accident for a rival
										character_event = { id = treasurefleet.149 }
									}
									10 = {
										# Dolphins
										character_event = { id = treasurefleet.170 }
									}
									10 = {
										# Sharks
										character_event = { id = treasurefleet.171 }
									}
									10 = {
										# Turtles
										character_event = { id = treasurefleet.172 }
									}
									10 = {
										# Drifting ship
										character_event = { id = treasurefleet.173 }
									}
									10 = {
										# Deserted island
										character_event = { id = treasurefleet.181 }
									}
									10 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# Flying Dutchman
										character_event = { id = treasurefleet.185 }
									}
									10 = {
										modifier = {
											factor = 0
											ROOT = {
												check_variable = {
													which = tf_supplies
													value = 10
												}
											}
										}
										modifier = {
											factor = 0.1
											ROOT = {
												check_variable = {
													which = tf_supplies
													value = 5
												}
											}
										}
										# Food shortage
										character_event = { id = treasurefleet.206 }
									}
									25 = {
										# Galapagos
										narrative_event = { id = treasurefleet.460 }
									}
									25 = {
										# Easter Island
										narrative_event = { id = treasurefleet.465 }
									}
									25 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# City of Pillars
										narrative_event = { id = treasurefleet.469 }
									}
									25 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# The Castle
										narrative_event = { id = treasurefleet.470 }
									}
									25 = {
										modifier = {
											factor = 0
											has_game_rule = {
												name = supernatural_events
												value = off
											}
										}
										# The Hole in the World
										narrative_event = { id = treasurefleet.484 }
									}
									200 = {} # Nothing
								}
							}
							else = {
								random = {
									chance = 10
									random_list = {
										10 = {
											modifier = {
												factor = 2
												trait = cannibal_trait
											}
											# Cannibals
											character_event = { id = treasurefleet.126 days = 5 random = 10 }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# The Eye
											character_event = { id = treasurefleet.119 days = 5 random = 10  }
										}
										10 = {
											# Man overboard
											character_event = { id = treasurefleet.132 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
													}
												}
											}
											# Made a friend
											character_event = { id = treasurefleet.139 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
														OR = {
															AND = {
																PREV = {
																	is_female = no
																	NOT = {
																		trait = homosexual
																	}
																}
																is_female = yes
																NOT = {
																	trait = homosexual
																}
															}
															AND = {
																PREV = {
																	is_female = yes
																	NOT = {
																		trait = homosexual
																	}
																}
																is_female = no
																NOT = {
																	trait = homosexual
																}
															}
															AND = {
																PREV = {
																	is_female = yes
																	trait = homosexual
																}
																is_female = yes
																trait = homosexual
															}
															AND = {
																PREV = {
																	is_female = no
																	trait = homosexual
																}
																is_female = no
																trait = homosexual
															}
														}
													}
												}
											}
											# Tumble opportunity
											character_event = { id = treasurefleet.141 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														NOR = {
															character = PREV
															any_friend = {
																character = PREV
															}
															any_lover = {
																character = PREV
															}
															any_rival = {
																character = PREV
															}
														}
													}
												}
											}
											# Made a rival
											character_event = { id = treasurefleet.147 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													any_playable_ruler = {
														trait = treasure_fleet_voyage
														any_rival = {
															character = PREV
														}
													}
												}
											}
											# Try to arrange an accident for a rival
											character_event = { id = treasurefleet.149 days = 5 random = 10  }
										}
										10 = {
											# Dolphins
											character_event = { id = treasurefleet.170 days = 5 random = 10  }
										}
										10 = {
											# Sharks
											character_event = { id = treasurefleet.171 days = 5 random = 10  }
										}
										10 = {
											# Turtles
											character_event = { id = treasurefleet.172 days = 5 random = 10  }
										}
										10 = {
											# Drifting ship
											character_event = { id = treasurefleet.173 days = 5 random = 10  }
										}
										10 = {
											# Deserted island
											character_event = { id = treasurefleet.181 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# Flying Dutchman
											character_event = { id = treasurefleet.185 days = 5 random = 10  }
										}
										10 = {
											modifier = {
												factor = 0
												ROOT = {
													check_variable = {
														which = tf_supplies
														value = 10
													}
												}
											}
											modifier = {
												factor = 0.1
												ROOT = {
													check_variable = {
														which = tf_supplies
														value = 5
													}
												}
											}
											# Food shortage
											character_event = { id = treasurefleet.206 days = 5 random = 10  }
										}
										25 = {
											# Galapagos
											narrative_event = { id = treasurefleet.460 }
										}
										25 = {
											# Easter Island
											narrative_event = { id = treasurefleet.465 }
										}
										25 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# City of Pillars
											narrative_event = { id = treasurefleet.469 }
										}
										25 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# The Castle
											narrative_event = { id = treasurefleet.470 }
										}
										25 = {
											modifier = {
												factor = 0
												NOT = {
													has_game_rule = {
														name = supernatural_events
														value = unrestricted
													}
												}
											}
											# The Hole in the World
											narrative_event = { id = treasurefleet.484 }
										}
										200 = {} # Nothing
									}
								}
							}
						}
					}
				}
			}
			10 = {
				# Nothing happens
			}
		}
		province_event = { id = treasurefleet.485 days = 30 }
	}
}

### Galapagos

# Arrival at Galapagos
narrative_event = {
	id = treasurefleet.460
	title = EVTTITLE_TREASURE_FLEET_460
	desc = EVTDESC_TREASURE_FLEET_460
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_460 # Nice place!
		
		random_list = {
			50 = {
				character_event = { id = treasurefleet.461 days = 5 random = 5 } # Giant tortoises
			}
			10 = {
				character_event = { id = treasurefleet.462 days = 5 random = 5 } # Ceramic remains
			}
			1 = {
				character_event = { id = treasurefleet.463 days = 5 random = 5 } # Volcano erupts
			}
			10 = {
				character_event = { id = treasurefleet.464 days = 5 random = 5 } # Relaxing
			}
			10 = {} # Nothing
		}
	}
}

# Giant tortoises - hunt them for food?
character_event = {
	id = treasurefleet.461
	desc = EVTDESC_TREASURE_FLEET_461
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_461 # Yes!
		
		piety = -50
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = tf_supplies
					value = 5
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = gluttonous
				}
				2753 = { # Hangzhou
					check_variable = {
						which = tf_supplies
						value = 0
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_461 # No!
		
		piety = 50
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = gluttonous
			}
		}
	}
}

# Ceramic remains
character_event = {
	id = treasurefleet.462
	desc = EVTDESC_TREASURE_FLEET_462
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_462 # Curious...
		
		prestige = 5
	}
}

# Volcano erupts - time to leave
character_event = {
	id = treasurefleet.463
	desc = EVTDESC_TREASURE_FLEET_463
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_463 # We can't stay around...
		
		prestige = 5
	}
}

# Islands are nice - relax a bit
character_event = {
	id = treasurefleet.464
	desc = EVTDESC_TREASURE_FLEET_464
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_464 # I needed this!
		
		if = {
			limit = {
				trait = stressed
			}
			remove_trait = stressed
		}
		else = {
			if = {
				limit = {
					trait = diligent
				}
				random = {
					chance = 25
					remove_trait = diligent
				}
			}
			else = {
				random = {
					chance = 25
					add_trait = slothful
				}
			}
		}
	}
}

### Easter Island

# Arrival
narrative_event = {
	id = treasurefleet.465
	title = EVTTITLE_TREASURE_FLEET_465
	desc = EVTDESC_TREASURE_FLEET_465
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_465 # Nice place!
		
		random_list = {
			50 = {
				character_event = { id = treasurefleet.466 days = 5 random = 5 } # Moai
			}
			10 = {
				character_event = { id = treasurefleet.467 days = 5 random = 5 } # Settlement remains
			}
			10 = {
				character_event = { id = treasurefleet.468 days = 5 random = 5 } # Relaxing
			}
			10 = {} # Nothing
		}
	}
}

# Moai are interesting to study - become Scholar/Mystic?
character_event = {
	id = treasurefleet.466
	desc = EVTDESC_TREASURE_FLEET_466
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				lifestyle_traits = 1
			}
		}
		name = EVTOPTA_TREASURE_FLEET_466 # Scholar
		
		add_trait = scholar
	}
	
	option = {
		trigger = {
			NOT = {
				lifestyle_traits = 1
			}
		}
		name = EVTOPTB_TREASURE_FLEET_466 # Mystic
		
		add_trait = mystic
	}
	
	option = {
		name = EVTOPTC_TREASURE_FLEET_466 # Neither
		
		prestige = 10
	}
}

# Abandoned settlement
character_event = {
	id = treasurefleet.467
	desc = EVTDESC_TREASURE_FLEET_467
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_467 # Curious...
		
		culture_techpoints = 10
		economy_techpoints = 10
		military_techpoints = 10
	}
}

# Island is nice - relax a bit
character_event = {
	id = treasurefleet.468
	desc = EVTDESC_TREASURE_FLEET_468
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_468 # I needed this!
		
		if = {
			limit = {
				trait = stressed
			}
			remove_trait = stressed
		}
		else = {
			if = {
				limit = {
					trait = diligent
				}
				random = {
					chance = 25
					remove_trait = diligent
				}
			}
			else = {
				random = {
					chance = 25
					add_trait = slothful
				}
			}
		}
	}
}

### City of Pillars

# Tenses are messy
narrative_event = {
	id = treasurefleet.469
	title = EVTTITLE_TREASURE_FLEET_469
	desc = EVTDESC_TREASURE_FLEET_469
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_469 # I will have understood this!
		
		prestige = 5
	}
}

### The Castle

# Castle spotted - investigate?
narrative_event = {
	id = treasurefleet.470
	title = EVTTITLE_TREASURE_FLEET_470
	desc = EVTDESC_TREASURE_FLEET_470
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_470 # Approach the castle
		
		narrative_event = { id = treasurefleet.471 days = 1 }
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_470 # Leave
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Castle is foreboding - what do you do?
narrative_event = {
	id = treasurefleet.471
	title = EVTTITLE_TREASURE_FLEET_471
	desc = EVTDESC_TREASURE_FLEET_471
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_471 # Lose your mind
		
		custom_tooltip = {
			text = do_not_do_this
		}
		
		add_trait = lunatic
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					trait = lunatic
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TREASURE_FLEET_471 # Eat your crew
		
		custom_tooltip = {
			text = do_not_do_this
		}
		
		add_trait = cannibal_trait
		add_trait = wounded
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_army_strength
					value = -1
				}
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOR = {
					trait = cannibal_trait
					trait = gluttonous
				}
			}
			modifier = {
				factor = 0.01
				NOT = {
					trait = cannibal_trait
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_TREASURE_FLEET_471 # Leave
		
		ai_chance = {
			factor = 100
		}
	}
}

### R'lyeh

# R'lyeh spotted
narrative_event = {
	id = treasurefleet.472
	title = EVTTITLE_TREASURE_FLEET_472
	desc = EVTDESC_TREASURE_FLEET_472
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		name = EVTOPTA_TREASURE_FLEET_472 # Foreboding...
		
		random_list = {
			50 = {
				narrative_event = { id = treasurefleet.474 days = 1 random = 1 }
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
					}
					narrative_event = { id = treasurefleet.474 days = 1 random = 1 }
				}
			}
			50 = {
				FROM = {
					province_event = { id = treasurefleet.475 days = 1 random = 1  }
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				trait = treasure_fleet_voyage
			}
			narrative_event = { id = treasurefleet.473 }
		}
		
		random = {
			chance = 25
			add_trait = lunatic
		}
		any_courtier = {
			random = {
				chance = 25
				add_trait = lunatic
			}
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		name = EVTOPTB_TREASURE_FLEET_472 # Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn!
		
		prestige = 10
	}
}

# Inform the fleet
narrative_event = {
	id = treasurefleet.473
	title = EVTTITLE_TREASURE_FLEET_473
	desc = EVTDESC_TREASURE_FLEET_473
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		name = EVTOPTA_TREASURE_FLEET_473 # Foreboding...
		
		random = {
			chance = 25
			add_trait = lunatic
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		name = EVTOPTB_TREASURE_FLEET_473 # Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn!
		
		prestige = 10
	}
}

# Dead Cthulhu dreams
narrative_event = {
	id = treasurefleet.474
	title = EVTTITLE_TREASURE_FLEET_474
	desc = EVTDESC_TREASURE_FLEET_474
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		name = EVTOPTA_TREASURE_FLEET_474 # We should not be here!
		
		random = {
			chance = 25
			add_trait = lunatic
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		name = EVTOPTB_TREASURE_FLEET_474 # Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn!
		
		prestige = 10
	}
}

# Ping the province in case the other option happened
province_event = {
	id = treasurefleet.475
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			narrative_event = { id = treasurefleet.476 }
		}
	}
}

# Cthulhu is awake!
narrative_event = {
	id = treasurefleet.476
	title = EVTTITLE_TREASURE_FLEET_476
	desc = EVTDESC_TREASURE_FLEET_476
	picture = GFX_evt_kraken
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_476 # Ramming speed!
		
		any_playable_ruler = {
			limit = {
				ai = no
				trait = treasure_fleet_voyage
			}
			narrative_event = { id = treasurefleet.477 }
		}
		
		if = {
			limit = {
				NOT = {
					trait = lunatic
				}
			}
			random = {
				chance = 50
				add_trait = lunatic
			}
		}
		
		hidden_tooltip = {
			FROM = {
				# Damage the fleet!
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				random_list = {
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_or_stat_from_one_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_random_treasure_fleet_person_artifact_and_stat_from_each_allowed_category_effect = yes
					}
					1 = {
						remove_or_weaken_everything_permissible_effect = yes
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 1
							}
						}
					}
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 1
					}
				}
				province_event = { id = treasurefleet.478 days = 1 } # Check the outcome
			}
		}
	}
}


# Cthulhu is awake - inform everyone!
narrative_event = {
	id = treasurefleet.477
	title = EVTTITLE_TREASURE_FLEET_477
	desc = EVTDESC_TREASURE_FLEET_477
	picture = GFX_evt_kraken
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_477 # Ramming speed!
		
		if = {
			limit = {
				NOT = {
					trait = lunatic
				}
			}
			random = {
				chance = 50
				add_trait = lunatic
			}
		}
	}
}

# Check outcome
province_event = {
	id = treasurefleet.478
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# First, let's see how strong the TF is
		set_variable = {
			which = tf_fighting_value
			value = 0
		}
		change_variable = {
			which = tf_fighting_value
			which = treasure_fleet_army_strength
		}
		change_variable = {
			which = tf_fighting_value
			which = treasure_fleet_ship_strength
		}
		multiply_variable = {
			which = tf_fighting_value
			value = 5
		}
		set_variable = {
			which = tf_pcs
			value = 0
		}
		d_treasure_fleet = {
			holder_scope = {
				export_to_variable = {
					which = tf_pcs
					value = combat_rating
					who = PREV
				}
				if = {
					limit = {
						check_variable = {
							which = tf_pcs
							value = 1
						}
					}
					ROOT = {
						change_variable = {
							which = tf_pcs
							which = PREV
						}
					}
				}
				set_variable = {
					which = tf_pcs
					value = 0
				}
			}
		}
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
					}
					export_to_variable = {
						which = tf_pcs
						value = combat_rating
						who = PREV
					}
					if = {
						limit = {
							check_variable = {
								which = tf_pcs
								value = 1
							}
						}
						ROOT = {
							change_variable = {
								which = tf_pcs
								which = PREV
							}
						}
					}
					set_variable = {
						which = tf_pcs
						value = 0
					}
				}
			}
		}
		change_variable = {
			which = tf_fighting_value
			which = tf_pcs
		}
		
		# Then see if you won
		change_variable = {
			which = tf_fighting_value
			value = -1000
		}
		
		# The fleet might be lost (but at least the end of the world has been averted)!
		if = {
			limit = {
				NOT = {
					check_variable = {
						which = tf_fighting_value
						value = 0
					}
				}
			}
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.481 }
					any_courtier = {
						character_event = { id = treasurefleet.481 }
					}
				}
			}
			activate_title = {
				title = d_treasure_fleet
				status = no
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.481 }
					}
					character_event = { id = treasurefleet.482 }
				}
			}
			any_player = {
				limit = {
					NOR = {
						trait = treasure_fleet_voyage
						has_landed_title = e_china
					}
				}
				character_event = { id = treasurefleet.483 }
			}
			clean_up_old_treasure_fleet_effect = yes
		}
		else = {
			# Cthulhu injured and sleeps again
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.479 }
				}
			}
			e_china = {
				holder_scope = {
					any_realm_lord = {
						limit = {
							trait = treasure_fleet_voyage
						}
						character_event = { id = treasurefleet.480 }
					}
				}
			}
		}
	}
}

# Victory - inform commander
character_event = {
	id = treasurefleet.479
	desc = EVTDESC_TREASURE_FLEET_479
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_479 # That is not dead which can eternal lie...
		
		prestige = 1000
	}
}

# Victory - inform the rest of the fleet
character_event = {
	id = treasurefleet.480
	desc = EVTDESC_TREASURE_FLEET_480
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_480 # ...and with strange aeons even death may die
		
		prestige = 1000
	}
}

# Last ship destroyed - inform all TF people
character_event = {
	id = treasurefleet.481
	desc = EVTDESC_TREASURE_FLEET_481
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_481 # Aargh!
		
		death = {
			death_reason = death_accident_drowning
		}
	}
}

# Last ship destroyed - inform the EoC
character_event = {
	id = treasurefleet.482
	desc = EVTDESC_TREASURE_FLEET_482
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_482 # How inauspicious!
		
		prestige = -500
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -5000
			}
		}
	}
}

# Last ship destroyed - inform the world
character_event = {
	id = treasurefleet.483
	desc = EVTDESC_TREASURE_FLEET_483
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_483 # I see...
	}
}

### The Hole in the World

# A curious look down at a sunless sea
narrative_event = {
	id = treasurefleet.484
	title = EVTTITLE_TREASURE_FLEET_484
	desc = EVTDESC_TREASURE_FLEET_484
	picture = GFX_evt_tropicana
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_484 # There is a sea most sunless...
	}
}

##### Nazca and possible Sunrise Invasion tie-in

# Check to see if the fleet still is active
province_event = {
	id = treasurefleet.485
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				d_treasure_fleet = {
					has_holder = yes
				}
			}
			set_global_flag = treasure_fleet_at_nazca
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.486 } # At the coast
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.486 } # At the coast
			}
			
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.487 days = 7 } # Deserted coastline - head inland
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.487 days = 7 } # Deserted coastline - head inland
			}
			
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.488 days = 9 } # Lines in the sand
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.488 days = 9 } # Lines in the sand
			}
			
			province_event = { id = treasurefleet.489 days = 15 } # See whether we're getting the Sunrise Invasion events or not
		}
	}
}

# Fleet follows the coast of South America
narrative_event = {
	id = treasurefleet.486
	title = EVTTITLE_TREASURE_FLEET_486
	desc = EVTDESC_TREASURE_FLEET_486
	picture = GFX_evt_tropicana
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_486 # How odd...
	}
}

# Coastline is deserted - the commander orders people to head inland
narrative_event = {
	id = treasurefleet.487
	title = EVTTITLE_TREASURE_FLEET_487
	desc = EVTDESC_TREASURE_FLEET_487
	picture = GFX_evt_tropicana
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_487 # We continue on foot!
	}
}

# Lines in the sand - how curious
narrative_event = {
	id = treasurefleet.488
	title = EVTTITLE_TREASURE_FLEET_488
	desc = EVTDESC_TREASURE_FLEET_488
	picture = GFX_evt_desert
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_488 # To the mountains!
	}
}

# See which version to get
province_event = {
	id = treasurefleet.489
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					NOT = {
						has_dlc = "Sunset Invasion"
					}
					has_game_rule = {
						name = inca_invasion
						value = off
					}
				}
			}
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.490 days = 2 } # Climbing the mountains - nothing
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.490 days = 2 } # Climbing the mountains - nothing
			}
			
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.491 days = 5 } # Back at the coast
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				character_event = { id = treasurefleet.491 days = 5 } # Back at the coast
			}
			
			province_event = { id = treasurefleet.492 } # Send the fleet back to Java
		}
		else = {
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.493 days = 2 } # Climbing the mountains - surrounded
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.493 days = 2 } # Climbing the mountains - surrounded
			}
			
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.494 days = 9 } # Arrival at Cusco
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.494 days = 9 } # Arrival at Cusco
			}
			
			d_treasure_fleet = {
				holder_scope = {
					narrative_event = { id = treasurefleet.495 days = 11 } # Meeting the Sapa Inca
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				narrative_event = { id = treasurefleet.495 days = 11 } # Meeting the Sapa Inca
			}
			
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.496 days = 13 } # Time to get away
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				character_event = { id = treasurefleet.496 days = 13 } # Time to get away
			}
			
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.497 days = 15 } # Pursued
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				character_event = { id = treasurefleet.497 days = 15 } # Pursued
			}
			
			d_treasure_fleet = {
				holder_scope = {
					character_event = { id = treasurefleet.498 days = 20 } # Back at the ships
				}
			}
			any_playable_ruler = {
				limit = {
					ai = no
					trait = treasure_fleet_voyage
				}
				character_event = { id = treasurefleet.498 days = 20 } # Back at the ships
			}
			
			province_event = { id = treasurefleet.499 days = 21 } # Homeward bound
		}
	}
}

# Climbing the mountains - non-Sunrise Invasion
narrative_event = {
	id = treasurefleet.490
	title = EVTTITLE_TREASURE_FLEET_490
	desc = EVTDESC_TREASURE_FLEET_490
	picture = GFX_evt_moonlit_mountains_hf
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_490 # This tells us nothing...
	}
}

# The trip was a waste - non-Sunrise Invasion
character_event = {
	id = treasurefleet.491
	desc = EVTDESC_TREASURE_FLEET_491
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_491 # I guess we head back to Java...
	}
}

# Hidden event to send the fleet back to Java
province_event = {
	id = treasurefleet.492
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Reduce food
		random_list = {
			10 = {
				change_variable = {
					which = tf_supplies
					value = -1
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -2
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -3
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -4
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -5
				}
			}
		}
		set_province_flag = treasure_fleet_voyage_flag
		clr_province_flag = treasure_fleet_sunrise_invasion_flag
		set_province_flag = treasure_fleet_going_to_java
		province_event = { id = treasurefleet.207 days = 60 random = 30 } # Return to Java
	}
}

# Climbing the mountains - Sunrise Invasion
narrative_event = {
	id = treasurefleet.493
	title = EVTTITLE_TREASURE_FLEET_493
	desc = EVTDESC_TREASURE_FLEET_493
	picture = GFX_evt_moonlit_mountains_hf
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_493 # They're everywhere!
	}
}

# The City of the Sun
narrative_event = {
	id = treasurefleet.494
	title = EVTTITLE_TREASURE_FLEET_494
	desc = EVTDESC_TREASURE_FLEET_494
	picture = GFX_evt_cathedral_zun_pagan
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_494 # Impressive!
	}
}

# Taken before the Sapa Inca
narrative_event = {
	id = treasurefleet.495
	title = EVTTITLE_TREASURE_FLEET_495
	desc = EVTDESC_TREASURE_FLEET_495
	picture = GFX_evt_throne_room_mesoamerican
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_495 # A mighty ruler indeed!
	}
}

# Realize the Inca have captured the fleet - time to escape
character_event = {
	id = treasurefleet.496
	desc = EVTDESC_TREASURE_FLEET_496
	picture = GFX_evt_cathedral_zun_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_496 # We must escape!
	}
}

# Moving towards the coast
character_event = {
	id = treasurefleet.497
	desc = EVTDESC_TREASURE_FLEET_497
	picture = GFX_evt_desert
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_497 # We're barely ahead...
	}
}

# Back at the coast - steal a ship to go home
character_event = {
	id = treasurefleet.498
	desc = EVTDESC_TREASURE_FLEET_498
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_498 # We must warn everyone that they'll come for us!
	}
}

# Hidden event to send the fleet back to China
province_event = {
	id = treasurefleet.499
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		# Reduce food
		random_list = {
			10 = {
				change_variable = {
					which = tf_supplies
					value = -1
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -2
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -3
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -4
				}
			}
			10 = {
				change_variable = {
					which = tf_supplies
					value = -5
				}
			}
		}
		set_province_flag = treasure_fleet_voyage_flag
		clr_province_flag = treasure_fleet_sunrise_invasion_flag
		set_province_flag = treasure_fleet_going_to_china
		set_global_flag = sunrise_invasion_warning
		
		# Return to China
		province_event = { id = treasurefleet.508 days = 90 random = 60 }
	}
}

##### Abort events

# TF ended for me
character_event = {
	id = treasurefleet.500
	desc = EVTDESC_TREASURE_FLEET_500
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_500 # Home at last!
		
		remove_trait = travelling
		clr_character_flag = do_not_disturb
	}
}

# TF ended for everyone
character_event = {
	id = treasurefleet.501
	desc = EVTDESC_TREASURE_FLEET_501
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_501 # Time to head home!
		
		remove_trait = treasure_fleet_voyage
		add_trait = travelling
		character_event = { id = treasurefleet.500 days = 90 random = 60 } # Actual homecoming
	}
}

# Inform the world that the TF just ended early
character_event = {
	id = treasurefleet.502
	desc = EVTDESC_TREASURE_FLEET_502
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_502 # I see...
	}
}

##### Homecoming events

### Normal homecoming

# Province event to handle the rest
province_event = {
	id = treasurefleet.503
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				narrative_event = { id = treasurefleet.504 }
				any_realm_lord = {
					limit = {
						ai = no
						NOT = {
							trait = treasure_fleet_voyage
						}
					}
					narrative_event = { id = treasurefleet.506 }
				}
			}
		}
		d_treasure_fleet = {
			holder_scope = {
				narrative_event = { id = treasurefleet.505 }
			}
		}
		activate_title = {
			title = d_treasure_fleet
			status = no
		}
		e_china = {
			holder_scope = {
				take_tf_wealth_effect = yes
			}
		}
		clean_up_old_treasure_fleet_effect = yes
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
					}
					narrative_event = { id = treasurefleet.505 }
				}
			}
		}
		any_player = {
			limit = {
				NOR = {
					has_landed_title = e_china
					trait = treasure_fleet_voyage
					any_liege = {
						has_landed_title = e_china
					}
				}
			}
			narrative_event = { id = treasurefleet.507 }
		}
	}
}

# Inform the EoC
narrative_event = {
	id = treasurefleet.504
	title = EVTTITLE_TREASURE_FLEET_504
	desc = EVTDESC_TREASURE_FLEET_504
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_504 # Truly an auspicious event!
		
		prestige = 1000
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = 10000
			}
		}
	}
}

# Inform the members
narrative_event = {
	id = treasurefleet.505
	title = EVTTITLE_TREASURE_FLEET_505
	desc = EVTDESC_TREASURE_FLEET_505
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_505 # Truly an auspicious event!
		
		prestige = 200
		
		remove_trait = treasure_fleet_voyage
		clr_character_flag = do_not_disturb
	}
}

# Inform all other vassals
narrative_event = {
	id = treasurefleet.506
	title = EVTTITLE_TREASURE_FLEET_506
	desc = EVTDESC_TREASURE_FLEET_506
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_506 # Truly an auspicious event!
	}
}

# Inform all other rulers
narrative_event = {
	id = treasurefleet.507
	title = EVTTITLE_TREASURE_FLEET_507
	desc = EVTDESC_TREASURE_FLEET_507
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_507 # I see...
	}
}

### Sunrise Invasion homecoming

# Province event to handle the rest
province_event = {
	id = treasurefleet.508
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				narrative_event = { id = treasurefleet.509 }
				any_realm_lord = {
					limit = {
						ai = no
						NOT = {
							trait = treasure_fleet_voyage
						}
					}
					narrative_event = { id = treasurefleet.511 }
				}
			}
		}
		d_treasure_fleet = {
			holder_scope = {
				narrative_event = { id = treasurefleet.510 }
			}
		}
		activate_title = {
			title = d_treasure_fleet
			status = no
		}
		clean_up_old_treasure_fleet_effect = yes
		e_china = {
			holder_scope = {
				any_realm_lord = {
					limit = {
						trait = treasure_fleet_voyage
					}
					narrative_event = { id = treasurefleet.510 }
				}
			}
		}
		any_player = {
			limit = {
				NOR = {
					has_landed_title = e_china
					trait = treasure_fleet_voyage
					any_liege = {
						has_landed_title = e_china
					}
				}
			}
			narrative_event = { id = treasurefleet.512 }
		}
	}
}

# Inform the EoC
narrative_event = {
	id = treasurefleet.509
	title = EVTTITLE_TREASURE_FLEET_509
	desc = EVTDESC_TREASURE_FLEET_509
	picture = GFX_evt_aztec_arrival
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_509 # You expect me to believe this?
		
		prestige = -100
		
		hidden_tooltip = {
			change_variable = {
				which = stored_mandate_change
				value = -1000
			}
		}
	}
}

# Inform the members
narrative_event = {
	id = treasurefleet.510
	title = EVTTITLE_TREASURE_FLEET_510
	desc = EVTDESC_TREASURE_FLEET_510
	picture = GFX_evt_aztec_arrival
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_510 # You have to believe us!
		
		prestige = 25
		
		remove_trait = treasure_fleet_voyage
		clr_character_flag = do_not_disturb
	}
}

# Inform all other vassals
narrative_event = {
	id = treasurefleet.511
	title = EVTTITLE_TREASURE_FLEET_511
	desc = EVTDESC_TREASURE_FLEET_511
	picture = GFX_evt_aztec_arrival
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_509 # You expect me to believe this?
	}
}

# Inform all other rulers
narrative_event = {
	id = treasurefleet.512
	title = EVTTITLE_TREASURE_FLEET_512
	desc = EVTDESC_TREASURE_FLEET_512
	picture = GFX_evt_aztec_arrival
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TREASURE_FLEET_512 # They must have gone mad!
	}
}

##### Extras

# Cleanup if someone has gotten stuck - on_yearly_puse
character_event = {
	id = treasurefleet.513
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		trait = treasure_fleet_voyage
		d_treasure_fleet = {
			has_holder = no
		}
	}
	
	immediate = {
		remove_trait = treasure_fleet_voyage
		clr_character_flag = do_not_disturb
	}
}

# Cleanup if someone has gotten stuck - on_yearly_puse
character_event = {
	id = treasurefleet.514
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		trait = treasure_fleet_preparation
		d_treasure_fleet = {
			has_holder = yes
		}
	}
	
	immediate = {
		remove_trait = treasure_fleet_preparation
	}
}

# CB test
character_event = {
	id = treasurefleet.515
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		2753 = { # Hangzhou
			set_province_flag = treasure_fleet_in_red_sea
			change_variable = {
				which = treasure_fleet_army_strength
				value = 100
			}
		}
		random_playable_ruler = {
			limit = {
				can_interact_with_treasure_fleet_trigger = yes
				top_liege = {
					any_realm_province = {
						is_in_active_treasure_fleet_region_trigger = yes
						NOT = {
							any_province = {
								owner = {
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
								NOT = {
									distance = {
										where = PREV
										value = 500
									}
								}
								NOT = {
									can_naval_path_to = {
										target = PREV
										distance <= 1000
									}
								}
							}
						}
					}
				}
			}
			top_liege = {
				save_event_target_as = potential_tf_invasion_target
				random_realm_province = {
					limit = {
						is_in_active_treasure_fleet_region_trigger = yes
						NOT = {
							any_province = {
								owner = {
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
								NOT = {
									distance = {
										where = PREV
										value = 500
									}
								}
								NOT = {
									can_naval_path_to = {
										target = PREV
										distance <= 1000
									}
								}
							}
						}
					}
					save_event_target_as = potential_tf_invasion_target_beachhead
				}
			}
			2753 = {
				province_event = { id = treasurefleet.516 } # Ping
			}
		}
	}
}

province_event = {
	id = treasurefleet.516
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			narrative_event = { id = treasurefleet.406 } # Create your own empire?
		}
	}
}

# Trait inheritance for EoC
character_event = {
	id = treasurefleet.517
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		is_chinese_emperor_trigger = yes
		trait = treasure_fleet_preparation
	}
	
	immediate = {
		current_heir = {
			add_trait = treasure_fleet_preparation
		}
	}
}