# Treasure Fleet Pacific voyage events
# by Silverswee(e)per

namespace = soh

# IDs 9301-9500 reserved

##### Sub-chain selection

# Select which sub-chain (and therefore destination) the fleet gets
province_event = {
	id = soh.9301
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		decrease_treasure_fleet_supplies_medium_effect = yes
		
		trigger_switch = {
			on_trigger = has_global_flag
			
			treasure_fleet_will_arrive_at_penglai = {
				set_global_flag = treasure_fleet_at_mount_penglai
				
				#log = "Treasure Fleet will go to Penglai!"
				
				province_event = { id = soh.9302 days = 2 random = 2 } # Penglai sub-chain
			}
			
			treasure_fleet_will_arrive_at_utter_east = {
				set_global_flag = treasure_fleet_at_utter_east
				
				#log = "Treasure Fleet will go to the Utter East!"
				
				province_event = { id = soh.9344 } # Utter East sub-chain
			}
			
			treasure_fleet_will_arrive_at_rlyeh = {
				set_global_flag = treasure_fleet_at_rlyeh
				
				#log = "Treasure Fleet will go to R'lyeh!"
				
				province_event = { id = soh.9375 } # R'lyeh sub-chain
			}
			
			treasure_fleet_will_arrive_at_salt = {
				set_global_flag = treasure_fleet_at_salt
				
				#log = "Treasure Fleet will Zail East!"
				
				province_event = { id = soh.9389 } # Zailing East sub-chain
			}
			
			treasure_fleet_will_arrive_at_yamatai = {
				set_global_flag = treasure_fleet_at_yamatai
				
				#log = "Treasure Fleet will go to Yamatai!"
				
				province_event = { id = soh.9399 } # Yamatai sub-chain
			}
			
			treasure_fleet_will_arrive_at_atlantis = {
				set_global_flag = treasure_fleet_at_atlantis
				
				#log = "Treasure Fleet will go to Atlantis!"
				
				province_event = { id = soh.9407 } # Atlantis sub-chain
			}
			
			treasure_fleet_will_arrive_at_kumari_kandam = {
				set_global_flag = treasure_fleet_at_kumari_kandam
				
				#log = "Treasure Fleet will go to Kumari Kandam!"
				
				province_event = { id = soh.9422 } # Kumari Kandam sub-chain
			}
			
			treasure_fleet_will_arrive_at_nazca = {
				set_global_flag = treasure_fleet_at_pacific_crossing
				
				#log = "Treasure Fleet will go to Nazca!"
				
				province_event = { id = soh.9431} # Actual crossing
			}
		}
		
		clear_flags_with_prefix = treasure_fleet_will_arrive_at
	}
}



##### Mount Penglai

# Setup event - arriving at Penglai
province_event = {
	id = soh.9302
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9303 } # Penglai sighted
		}
		
		province_event = { id = soh.9305 days = 9 } # Follow-up
	}
}

### Arrival

# Pillars Touching the Clouds
narrative_event = {
	id = soh.9303
	title = EVTTITLE_SOH_9303
	desc = EVTDESC_SOH_9303
	picture = GFX_evt_castle_garden_chinese_group
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion = taoist
			OR = {
				trait = proud
				trait = ambitious
				has_ambition = obj_become_immortal
				trait = mystic
				# TIANXIATODO: Or that other thing...
			}
		}
		
		name = EVTOPTA_SOH_9303 # Could it be...?
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					religion = taoist
					NOR = {
						trait = proud
						trait = ambitious
						has_ambition = obj_become_immortal
						trait = mystic
						# TIANXIATODO: Or that other thing...
					}
				}
				religion_openly_chinese_or_reformed_trigger = yes
				religion = confucian
				trait = scholar
			}
		}
		
		name = EVTOPTB_SOH_9303 # This feels familiar...
	}
	
	option = {
		trigger = {
			NOT = {
				religion = taoist
			}
			religion_openly_chinese_or_reformed_trigger = no
		}
		
		name = EVTOPTC_SOH_9303 # What is this place...?
	}
	
	after = {
		narrative_event = { id = soh.9304 days = 2 }
	}
}

# The Ancient Shipwrecks
narrative_event = {
	id = soh.9304
	title = EVTTITLE_SOH_9304
	desc = EVTDESC_SOH_9304
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes # Immortal children would be a hassle, and we also want to avoid kinslaying as much as possible...
			has_epidemic = no
		}
		
		name = EVTOPTA_SOH_9304 # I will head inland!
		
		set_character_flag = treasure_fleet_heading_inland_at_penglai
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = craven
					trait = slothful
					trait = paranoid
				}
			}
			
			factor = 1
			
			mult_modifier = {
				factor = 2
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 5
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9304 # I will turn back!
		
		ai_chance = {
			factor = 1
			
			mult_modifier = {
				factor = 5
				trait = slothful
			}
			
			mult_modifier = {
				factor = 2
				trait = paranoid
			}
			
			mult_modifier = {
				factor = 2
				trait = craven
			}
		}
	}
}

# Hidden event to make sure only those that continued get the following events
province_event = {
	id = soh.9305
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				has_character_flag = treasure_fleet_heading_inland_at_penglai
			}
			
			narrative_event = { id = soh.9306 } # The Stairway
		}
		
		province_event = { id = soh.9311 days = 9 } # Make sure only the correct characters continue
	}
}

# The Stairway to the Heavens
narrative_event = {
	id = soh.9306
	title = EVTTITLE_SOH_9306
	desc = EVTDESC_SOH_9306
	picture = GFX_evt_castle_garden_chinese_group
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9306 # Onwards!
		
		narrative_event = { id = soh.9307 days = 4 } # The Palaces
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9306 # I'll head back...
		
		clr_character_flag = treasure_fleet_heading_inland_at_penglai
		
		ai_chance = {
			trigger = {
				trait = slothful
			}
			
			factor = 100
		}
	}
}

# Palaces of Gold and Silver
narrative_event = {
	id = soh.9307
	title = EVTTITLE_SOH_9307
	desc = EVTDESC_SOH_9307
	picture = GFX_evt_castle_garden_chinese_group
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9307 # A wondrous sight!
		
		narrative_event = { id = soh.9308 days = 2 } # The Jade-Armored Maidens
	}
}

# The Jade-Armored Maidens
narrative_event = {
	id = soh.9308
	title = EVTTITLE_SOH_9308
	desc = EVTDESC_SOH_9308
	picture = GFX_evt_castle_garden_chinese_group
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = proud
			}
		}
		
		name = EVTOPTA_SOH_9308 # A humble visitor!
		
		add_trait_silently_humble_effect = yes
		
		if = {
			limit = {
				has_character_modifier = known_satanist
			}
			
			character_event = { id = soh.9310 days = 1 } # Told to leave
		}
		
		else = {
			character_event = { id = soh.9309 days = 1 } # Invited inside
		}
		
		ai_chance = {
			trigger = {
				trait = humble
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = humble
			}
		}
		
		name = EVTOPTB_SOH_9308 # Someone that deserves to enter!
		
		add_trait_silently_proud_effect = yes
		
		character_event = { id = soh.9310 days = 1 } # Told to leave
		
		ai_chance = {
			trigger = {
				trait = proud
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9308 # A weary traveller
		
		hidden_tooltip = {
			random_list = {
				50 = {
					trigger = {
						NOT = {
							has_character_modifier = known_satanist
						}
					}
					
					character_event = { id = soh.9309 days = 1 } # Invited inside
				}
				
				50 = {
					character_event = { id = soh.9310 days = 1 } # Told to leave
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				has_ambition = obj_become_immortal
				trait = mystic
				# TIANXIATODO: Or that other thing...
			}
		}
		
		name = EVTOPTD_SOH_9308 # Someone seeking immortality!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					trigger = {
						NOT = {
							has_character_modifier = known_satanist
						}
					}
					
					mult_modifier = {
						factor = 2
						trait = chaste
					}
					
					mult_modifier = {
						factor = 2
						trait = temperate
					}
					
					mult_modifier = {
						factor = 2
						trait = charitable
					}
					
					mult_modifier = {
						factor = 2
						trait = diligent
					}
					
					mult_modifier = {
						factor = 2
						trait = patient
					}
					
					mult_modifier = {
						factor = 2
						trait = kind
					}
					
					mult_modifier = {
						factor = 2
						trait = humble
					}
					
					mult_modifier = {
						factor = 2
						trait = erudite
					}
					
					mult_modifier = {
						factor = 2
						trait = honest
					}
					
					mult_modifier = {
						factor = 2
						trait = just
					}
					
					character_event = { id = soh.9309 days = 1 } # Invited inside
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						trait = lustful
					}
					
					mult_modifier = {
						factor = 2
						trait = gluttonous
					}
					
					mult_modifier = {
						factor = 2
						trait = greedy
					}
					
					mult_modifier = {
						factor = 2
						trait = slothful
					}
					
					mult_modifier = {
						factor = 2
						trait = wroth
					}
					
					mult_modifier = {
						factor = 2
						trait = envious
					}
					
					mult_modifier = {
						factor = 2
						trait = proud
					}
					
					mult_modifier = {
						factor = 2
						trait = deceitful
					}
					
					mult_modifier = {
						factor = 2
						trait = arbitrary
					}
					
					character_event = { id = soh.9310 days = 1 } # Told to leave
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Invited inside
character_event = {
	id = soh.9309
	desc = EVTDESC_SOH_9309
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9309 # My thanks!
		
		set_character_flag = treasure_fleet_penglai_invited_inside
	}
}

# Told to leave
character_event = {
	id = soh.9310
	desc = EVTDESC_SOH_9310
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9310 # I don't think I should insist...
		
		prestige = -100
	}
}

### Meeting the Immortals

# Hidden event to make sure only those that got to continue get the following events
province_event = {
	id = soh.9311
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				has_character_flag = treasure_fleet_penglai_invited_inside
			}
			
			narrative_event = { id = soh.9312 } # The Garden
		}
		
		province_event = { id = soh.9322 days = 9 } # The Peach of Immortality
	}
}

# Peach Trees and Lotus Flowers
narrative_event = {
	id = soh.9312
	title = EVTTITLE_SOH_9312
	desc = EVTDESC_SOH_9312
	picture = GFX_evt_castle_garden_chinese_group
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9312 # A most beautiful garden!
		
		narrative_event = { id = soh.9313 days = 3 } # The Hosts
	}
}

# The Immortal Hosts
narrative_event = {
	id = soh.9313
	title = EVTTITLE_SOH_9313
	desc = EVTDESC_SOH_9313
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9313 # A feast? Sure!
		
		character_event = { id = soh.9314 days = 3 } # Event selection
	}
}

# Random event selection
character_event = {
	id = soh.9314
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			10 = {
				trigger = {
					OR = {
						is_ill = yes
						trait = wounded
					}
				}
				
				character_event = { id = soh.9315 } # Healing
			}
			
			10 = {
				mult_modifier = {
					factor = 2
					trait = stressed
				}
				
				mult_modifier = {
					factor = 2
					trait = depressed
				}
				
				character_event = { id = soh.9316 } # Soothing music
			}
			
			50 = {
				trigger = {
					OR = {
						society_member_of = hermetics
						society_member_of = the_alchemists
					}
				}
				
				character_event = { id = soh.9317 } # Insights
			}
			
			10 = {
				trigger = {
					NOT = {
						trait = temperate
					}
				}
				
				character_event = { id = soh.9318 } # Drinking too much
			}
			
			10 = {
				trigger = {
					religion = taoist
				}
				
				character_event = { id = soh.9319 } # Taoist gains piety
			}
			
			10 = {
				trigger = {
					NOR = {
						religion = taoist
						AND = {
							trait = zealous
							NOT = {
								true_religion = taoist
							}
						}
					}
					
					controls_religion = no
				}
				
				mult_modifier = {
					factor = 10
					true_religion = taoist
				}
				
				character_event = { id = soh.9320 } # Become a Taoist?
			}
			
			100 = {
				character_event = { id = soh.9321 } # Just having a good time
			}
		}
	}
}

# Healing
character_event = {
	id = soh.9315
	desc = EVTDESC_SOH_9315
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9315 # I feel better!
		
		remove_disease_trait_effect = yes
		remove_symptoms_effect = yes
		remove_trait = wounded
		remove_trait = severely_injured
	}
}

# Soothing music
character_event = {
	id = soh.9316
	desc = EVTDESC_SOH_9316
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9316 # I feel so relaxed!
		
		remove_trait_stressed_effect = yes
		remove_trait_depressed_effect = yes
	}
}

# Insights - Hermetics and Alchemists
character_event = {
	id = soh.9317
	desc = EVTDESC_SOH_9317
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9317 # I learned so much!
		
		add_society_currency_major_effect = yes
	}
}

# Drinking too much
character_event = {
	id = soh.9318
	desc = EVTDESC_SOH_9318
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9318 # Another drink? Sure!
		
		add_trait_drunkard_effect = yes
	}
}

# Taoist gains piety
character_event = {
	id = soh.9319
	desc = EVTDESC_SOH_9319
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9319 # This was truly an auspicious evening!
		
		piety = 100
	}
}

# Non-Taoist might convert
character_event = {
	id = soh.9320
	desc = EVTDESC_SOH_9320
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9320 # I'll convert!
		
		religion = taoist
		
		ai_chance = {
			trigger = {
				OR = {
					could_have_chinese_government_trigger = yes
					true_religion = taoist
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 100
				true_religion = taoist
			}
		}
	}
	
	option = {
		trigger = {
			NOR = {
				true_religion = taoist
				trait = zealous
			}
		}
		
		name = EVTOPTB_SOH_9320 # I'll convert in secret!
		
		set_secret_religion = taoist
		
		ai_chance = {
			trigger = {
				has_secret_religion = no
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 2
				trait = cynical
			}
			
			mult_modifier = {
				factor = 0.1
				NOR = {
					religion_group = indian_group
					trait = sympathy_indian
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9320 # I think not!
		
		ai_chance = {
			trigger = {
				NOT = {
					true_religion = taoist
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTD_SOH_9320 # My faith is the only true faith!
		
		add_trait_zealous_effect = yes
		
		ai_chance = {
			trigger = {
				NOR = {
					true_religion = taoist
					trait = cynical
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
		}
	}
}

# Having a good time
character_event = {
	id = soh.9321
	desc = EVTDESC_SOH_9321
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9321 # This was a nice evening!
	}
}

### Return

# Peach setup
province_event = {
	id = soh.9322
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				has_character_flag = treasure_fleet_penglai_invited_inside
			}
			
			narrative_event = { id = soh.9323 } # The Peach of Immortality
		}
		
		province_event = { id = soh.9325 days = 9 } # Peach fallout
	}
}
		
# The Peach of Immortality
narrative_event = {
	id = soh.9323
	title = EVTTITLE_SOH_9323
	desc = EVTDESC_SOH_9323
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9323 # A gift fit for the Dragon Throne!
		
		narrative_event = { id = soh.9324 days = 5 } # Who gets the Peach?
	}
}

# Who gets the Peach?
narrative_event = {
	id = soh.9324
	title = EVTTITLE_SOH_9324
	desc = EVTDESC_SOH_9324
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		2753 = { # Hangzhou
			persistent_event_target:treasure_fleet_sender = {
				save_event_target_as = treasure_fleet_sender
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9324 # It belongs to the Dragon Throne!
		
		FROMFROM = {
			set_province_flag = treasure_fleet_peach_dragon_throne
		}
		
		ai_chance = {
			trigger = {
				persistent_event_target:treasure_fleet_sender = {
					NOT = {
						is_rival = ROOT
					}
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.8
				has_ambition = obj_become_immortal
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_landed_title = d_treasure_fleet
			}
		}
		
		name = EVTOPTB_SOH_9324 # It belongs to me!
		
		pacifists_lose_piety_effect = yes
		
		FROMFROM = {
			set_province_flag = treasure_fleet_peach_claimed
		}
		
		set_character_flag = treasure_fleet_claimed_peach_of_immortality
		
		ai_chance = {
			trigger = {
				OR = {
					NOR = {
						trait = depressed
						trait = content
					}
					persistent_event_target:treasure_fleet_sender = {
						is_rival = ROOT
					}
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				persistent_event_target:treasure_fleet_sender = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				persistent_event_target:treasure_fleet_sender = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.2
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.01
				trait = depressed
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9324 # None are worthy!
		
		FROMFROM = {
			set_province_flag = treasure_fleet_peach_unworthy
		}
		
		ai_chance = {
			trigger = {
				persistent_event_target:treasure_fleet_sender = {
					is_rival = ROOT
				}
				NOT = {
					has_ambition = obj_become_immortal
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				persistent_event_target:treasure_fleet_sender = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				persistent_event_target:treasure_fleet_sender = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
		}
	}
}

# Peach fallout setup
province_event = {
	id = soh.9325
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		2753 = { # Hangzhou
			persistent_event_target:treasure_fleet_sender = {
				save_event_target_as = treasure_fleet_sender
			}
		}
		
		if = {
			limit = {
				has_province_flag = treasure_fleet_peach_unworthy
				NOR = {
					has_province_flag = treasure_fleet_peach_dragon_throne
					has_province_flag = treasure_fleet_peach_claimed
				}
			}
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_penglai_invited_inside
				}
				
				character_event = { id = soh.9326 } # None are worthy
			}
			
			province_event = { id = soh.9336 days = 9 } # Return to the ships
		}
		
		else_if = {
			limit = {
				has_province_flag = treasure_fleet_peach_dragon_throne
				NOT = {
					has_province_flag = treasure_fleet_peach_claimed
				}
			}
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_penglai_invited_inside
				}
				
				character_event = { id = soh.9327 } # It belongs to the Dragon Throne!
			}
			
			province_event = { id = soh.9336 days = 9 } # Return to the ships
		}
		
		else = {
			if = {
				limit = {
					any_playable_ruler = {
						count = 2
						has_character_flag = treasure_fleet_claimed_peach_of_immortality
					}
				}
				
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
						has_character_flag = treasure_fleet_penglai_invited_inside
					}
					
					character_event = { id = soh.9329 } # Multiple claimants
				}
			}
			
			else = {
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
						has_character_flag = treasure_fleet_penglai_invited_inside
						has_character_flag = treasure_fleet_claimed_peach_of_immortality
					}
					
					save_event_target_as = peach_claimant
				}
				
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
						has_character_flag = treasure_fleet_penglai_invited_inside
					}
					
					character_event = { id = soh.9328 } # One claimant
				}
			}
			
			province_event = { id = soh.9330 days = 1 } # Fight for the Peach
			
			province_event = { id = soh.9337 days = 9 } # Return to the ships
		}
	}
}

# Agreement - none are worthy
character_event = {
	id = soh.9326
	desc = EVTDESC_SOH_9326
	picture = GFX_evt_castle_garden_chinese_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9326 # It is for the best...
	}
}

# Agreement - it belongs to the Dragon Throne!
character_event = {
	id = soh.9327
	desc = EVTDESC_SOH_9327
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9327 # The Dragon Throne will doubtlessly be pleased!
	}
}

# Disagreement - one person claims the Peach
character_event = {
	id = soh.9328
	desc = EVTDESC_SOH_9328
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = treasure_fleet_claimed_peach_of_immortality
			}
		}
		
		name = EVTOPTA_SOH_9328 # This is treason!
	}
	
	option = {
		trigger = {
			has_character_flag = treasure_fleet_claimed_peach_of_immortality
		}
		
		name = EVTOPTB_SOH_9328 # The Peach belongs to me!
	}
}

# Disagreement - multiple people claim the Peach
character_event = {
	id = soh.9329
	desc = EVTDESC_SOH_9329
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = treasure_fleet_claimed_peach_of_immortality
			}
		}
		
		name = EVTOPTA_SOH_9329 # This is treason!
	}
	
	option = {
		trigger = {
			has_character_flag = treasure_fleet_claimed_peach_of_immortality
		}
		
		name = EVTOPTB_SOH_9329 # The Peach belongs to me!
	}
}

# Hidden fight for the Peach - part 1
province_event = {
	id = soh.9330
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		2753 = { # Hangzhou
			persistent_event_target:treasure_fleet_sender = {
				save_event_target_as = treasure_fleet_sender
			}
		}
		
		if = {
			limit = {
				any_playable_ruler = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_penglai_invited_inside
					NOT = {
						has_character_flag = treasure_fleet_claimed_peach_of_immortality
					}
				}
			}
			
			random_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_penglai_invited_inside
					NOT = {
						has_character_flag = treasure_fleet_claimed_peach_of_immortality
					}
				}
				
				preferred_limit = {
					combat_rating >= 200
				}
				
				preferred_limit = {
					combat_rating >= 150
				}
				
				preferred_limit = {
					combat_rating >= 100
				}
				
				preferred_limit = {
					combat_rating >= 90
				}
				
				preferred_limit = {
					combat_rating >= 80
				}
				
				preferred_limit = {
					combat_rating >= 70
				}
				
				preferred_limit = {
					combat_rating >= 60
				}
				
				preferred_limit = {
					combat_rating >= 50
				}
				
				preferred_limit = {
					combat_rating >= 40
				}
				
				preferred_limit = {
					combat_rating >= 30
				}
				
				preferred_limit = {
					combat_rating >= 20
				}
				
				preferred_limit = {
					combat_rating >= 10
				}
				
				preferred_limit = {
					combat_rating >= 0
				}
				
				set_character_flag = peach_duel
				save_event_target_as = imperial_champion
				save_event_target_as = combatant_1
			}
		}
		
		else = {
			d_treasure_fleet = {
				holder_scope = {
					set_character_flag = peach_duel
					save_event_target_as = imperial_champion
					save_event_target_as = combatant_1
				}
			}
		}
		
		random_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				has_character_flag = treasure_fleet_claimed_peach_of_immortality
			}
			
			preferred_limit = {
				combat_rating >= 200
			}
			
			preferred_limit = {
				combat_rating >= 150
			}
			
			preferred_limit = {
				combat_rating >= 100
			}
			
			preferred_limit = {
				combat_rating >= 90
			}
			
			preferred_limit = {
				combat_rating >= 80
			}
			
			preferred_limit = {
				combat_rating >= 70
			}
			
			preferred_limit = {
				combat_rating >= 60
			}
			
			preferred_limit = {
				combat_rating >= 50
			}
			
			preferred_limit = {
				combat_rating >= 40
			}
			
			preferred_limit = {
				combat_rating >= 30
			}
			
			preferred_limit = {
				combat_rating >= 20
			}
			
			preferred_limit = {
				combat_rating >= 10
			}
			
			preferred_limit = {
				combat_rating >= 0
			}
			
			save_event_target_as = best_peach_claimant
			save_event_target_as = combatant_2
		}
		
		event_target:imperial_champion = {
			clr_character_flag = peach_duel_imperial_victory
			clr_character_flag = peach_duel_claimant_victory
			
			character_event = {	id = HFP.10100 } # Duel
		}
	}
}

# Hidden fight for the Peach - part 2
province_event = {
	id = soh.9331
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				event_target:imperial_champion = {
					has_character_flag = peach_duel_imperial_victory
				}
			}
			
			set_province_flag = treasure_fleet_dragon_throne_getting_peach
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = penglai_invited_inside
					NOT = {
						has_character_flag = treasure_fleet_claimed_peach_of_immortality
					}
				}
				
				character_event = { id = soh.9332 } # Imperial side won - imperial side
			}
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_claimed_peach_of_immortality
				}
				
				character_event = { id = soh.9333 } # Imperial side won - claimants
			}
		}
		
		else = {
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
					has_character_flag = treasure_fleet_penglai_invited_inside
					NOT = {
						character = event_target:best_peach_claimant
					}
				}
				
				character_event = { id = soh.9334 } # One claimant won - others
			}
			
			event_target:best_peach_claimant = {
				character_event = { id = soh.9335 } # Winning claimant
			}
		}
	}
}

# Fight for the Peach - Imperial side prevails - imperial side
character_event = {
	id = soh.9332
	desc = EVTDESC_SOH_9332
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9332 # Good riddance!
	}
}

# Fight for the Peach - Imperial side prevails - opponents
character_event = {
	id = soh.9333
	desc = EVTDESC_SOH_9333
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9333 # Not like this!
		
		save_event_target_as = kinslayer_target
		
		event_target:imperial_champion = {
			add_kinslayer_trait_effect = yes
		
			pacifists_lose_piety_effect = yes
		}
		
		death = {
			death_reason = death_duel
			killer = event_target:imperial_champion
		}
	}
}

# Fight for the Peach - One claimant prevails - claimant
character_event = {
	id = soh.9334
	desc = EVTDESC_SOH_9334
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9334 # Not like this!
		
		death = {
			death_reason = death_murder_unknown
			killer = event_target:best_peach_claimant
		}
	}
}

# Fight for the Peach - One claimant prevails - opponents
character_event = {
	id = soh.9335
	desc = EVTDESC_SOH_9335
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9335 # Such a shame about those "accidents"...
		
		add_trait = immortal

		if = {
			limit = { has_dlc = "Holy Fury" }

			if = {
				limit = { is_female = no }

				create_bloodline = {
					type = immortal_bloodline_01
				}
			}
			else = {
				create_bloodline = {
					type = immortal_bloodline_01
					inheritance = matrilineal
				}
			}
		}
	}
}

# Retuning to the ships - no fight
province_event = {
	id = soh.9336
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_province_flag = treasure_fleet_peach_dragon_throne
			}
			
			set_province_flag = treasure_fleet_dragon_throne_getting_peach
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				
				if = {
					limit = {
						has_character_flag = treasure_fleet_penglai_invited_inside
					}
					
					character_event = { id = soh.9338 } # Returned to the ships, with peach
				}
				
				else = {
					character_event = { id = soh.9339 } # Shore party returned, with peach
				}
			}
		}
		
		else = {
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				
				if = {
					limit = {
						has_character_flag = treasure_fleet_penglai_invited_inside
					}
					
					character_event = { id = soh.9340 } # Returned to the ships, no peach
				}
				
				else = {
					character_event = { id = soh.9341 } # Shore party returned, no peach
				}
			}
		}
		
		clr_province_flag = treasure_fleet_at_mount_penglai
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_pacific_return
		set_province_flag = treasure_fleet_was_at_penglai
	}
}

# Retuning to the ships - fight
province_event = {
	id = soh.9337
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			if = {
				limit = {
					has_character_flag = treasure_fleet_penglai_invited_inside
				}
				
				character_event = { id = soh.9342 } # Returned to the ships
			}
			
			else = {
				character_event = { id = soh.9343 } # One person returns
			}
		}
		
		clr_province_flag = treasure_fleet_at_mount_penglai
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_pacific_return
		set_province_flag = treasure_fleet_was_at_penglai
	}
}

# Inform return party - no fight, have peach
character_event = {
	id = soh.9338
	desc = EVTDESC_SOH_9338
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9338 # We sail at once!
	}
}

# Inform anyone waiting at the ships - no fight, have peach - time to return to China
character_event = {
	id = soh.9339
	desc = EVTDESC_SOH_9339
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9339 # They seem eager to return home...
	}
}

# Inform return party - no fight, no peach
character_event = {
	id = soh.9340
	desc = EVTDESC_SOH_9340
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9340 # We sail at once!
	}
}

# Inform anyone waiting at the ships - no fight, no peach - time to return to China
character_event = {
	id = soh.9341
	desc = EVTDESC_SOH_9341
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9341 # They seem eager to return home...
	}
}

# Inform returning characters - have peach
character_event = {
	id = soh.9342
	desc = EVTDESC_SOH_9342
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9342 # We sail at once!
	}
}

# Inform anyone waiting at the ships - fight - time to return to China
character_event = {
	id = soh.9343
	desc = EVTDESC_SOH_9343
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9343 # I wonder what happened to the rest...
	}
}



##### Utter East

### Dragon Island

# Dragon island setup
province_event = {
	id = soh.9344
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				is_adult = yes
				has_epidemic = no
				trait = treasure_fleet_voyage
				NOR = {
					has_character_flag = left_treasure_fleet_voyage
					has_landed_title = d_treasure_fleet
				}
			}
			
			narrative_event = { id = soh.9345 } # Dragon Island sighted
		}
		
		province_event = { id = soh.9347 days = 3 } # Pick the "lucky" character
		
		province_event = { id = soh.9353 days = 9 } # Deathwater Island
	}
}

# Arrival at Dragon Island
narrative_event = {
	id = soh.9345
	title = EVTTITLE_SOH_9345
	desc = EVTDESC_SOH_9345
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9345 # We should make some repairs...
		
		character_event = { id = soh.9346 days = 1 } # Head inland?
	}
}

# Head inland?
character_event = {
	id = soh.9346
	desc = EVTDESC_SOH_9346
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9346 # I will head inland!
			
		set_character_flag = treasure_fleet_went_inland_at_dragon_island
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 2
				trait = stubborn
			}
			
			mult_modifier = {
				factor = 2
				trait = wroth
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9346 # I will stay at the shore...
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = craven
			}
			
			mult_modifier = {
				factor = 2
				trait = patient
			}
			
			mult_modifier = {
				factor = 2
				trait = slothful
			}
		}
	}
}

# Pick the "lucky" character
province_event = {
	id = soh.9347
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				has_character_flag = treasure_fleet_went_inland_at_dragon_island
			}
			
			preferred_limit = {
				trait = greedy
			}
			
			preferred_limit = {
				NOT = {
					trait = charitable
				}
			}
			
			character_event = { id = soh.9348 } # Went inland
		}
	}
}

# Treasure in the cave - take some?
character_event = {
	id = soh.9348
	desc = EVTDESC_SOH_9348
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9348 # I will rest for a bit...
		
		character_event = { id = soh.9349 days = 1 }
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = charitable
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9348 # I will head back...
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			factor = 100
		}
	}
}

# Turned into a dragon
character_event = {
	id = soh.9349
	desc = EVTDESC_SOH_9349
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		set_graphical_culture = dragon_culture
		fertility = -10 # To ensure no dragon children; don't worry, ROOT won't be alive long enough to suffer unduly!
	}
	
	option = {
		name = EVTOPTA_SOH_9349 # What's happening to me?
		
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
				NOT = {
					character = ROOT
				}
			}
			
			narrative_event = { id = soh.9350 } # DRAGON!
			
			character_event = { id = soh.9351 days = 1 } # Killed
		}
	}
}

# DRAGON!
narrative_event = {
	id = soh.9350
	title = EVTTITLE_SOH_9350
	desc = EVTDESC_SOH_9350
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9350 # Kill it! Kill it!
		
		character_event = { id = soh.9352 days = 1 }
	}
}

# Dragon killed - dragon
character_event = {
	id = soh.9351
	desc = EVTDESC_SOH_9351
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9351 # Wait! No! NO!
		
		death = {
			death_reason = death_as_dragon
		}
	}
}

# Dragon killed - reverts to true form
character_event = {
	id = soh.9352
	desc = EVTDESC_SOH_9352
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9352 # Oh no!
	}
}

### Deathwater Island

# Deathwater Island setup
province_event = {
	id = soh.9353
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9354 } # Deathwater Island sighted
		}
		
		province_event = { id = soh.9358 days = 9 } # Dark Island
	}
}

# Arrival at Deathwater Island
narrative_event = {
	id = soh.9354
	title = EVTTITLE_SOH_9354
	desc = EVTDESC_SOH_9354
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9354 # We should check for supplies...
		
		character_event = { id = soh.9355 days = 3 } # The "statue"
	}
}

# Investigating the stream - finds golden "statue"
character_event = {
	id = soh.9355
	desc = EVTDESC_SOH_9355
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9355 # I think I can reach it!
		
		character_event = { id = soh.9356 days = 1 } # You *really* shouldn't have done that...
		
		ai_chance = {
			trigger = {
				NOR = {
					trait = charitable
					trait = paranoid
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9355 # I don't care about it!
		
		character_event = { id = soh.9357 days = 1 } # A good decision!
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			trait = paranoid
		}
		
		name = EVTOPTC_SOH_9355 # Something is not right here...
		
		character_event = { id = soh.9357 days = 1 } # A good decision!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 10
				trait = craven
			}
		}
	}
}

# Went for a swim
character_event = {
	id = soh.9356
	desc = EVTDESC_SOH_9356
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9356 # Not like...!
		
		death = {
			death_reason = death_turned_to_gold
		}
	}
}

# Did NOT go for a swim
character_event = {
	id = soh.9357
	desc = EVTDESC_SOH_9357
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9357 # I'm glad I didn't go for a swim...
	}
}

### Dark Island

# Dark Island setup
province_event = {
	id = soh.9358
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9359 } # Dark Island sighted
		}
		
		province_event = { id = soh.9362 days = 9 } # Island of the Star
	}
}

# Arrival at the Dark Island
narrative_event = {
	id = soh.9359
	title = EVTTITLE_SOH_9359
	desc = EVTDESC_SOH_9359
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9359 # We must press on!
		
		decrease_treasure_fleet_ship_strength_small_effect = yes
		
		character_event = { id = soh.9360 days = 5 } # Darkness
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9359 # Turn back! TURN BACK!
		
		character_event = { id = soh.9361 days = 5 } # Others lost in the darkness
		
		ai_chance = {
			factor = 100
		}
	}
}

# Did not turn around
character_event = {
	id = soh.9360
	desc = EVTDESC_SOH_9360
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9360 # Nightmares unending!
		
		add_trait = lunatic 
		
		death = {
			death_reason = death_sailed_into_the_darkness
		}
	}
}

# Turned around
character_event = {
	id = soh.9361
	desc = EVTDESC_SOH_9361
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9361 # They're... gone!
	}
}

### Island of the Star

# Island of the Star setup
province_event = {
	id = soh.9362
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9363 } # Island of the Star sighted
		}
		
		province_event = { id = soh.9366 days = 6 } # Stone knife check
		
		province_event = { id = soh.9370 days = 9 } # Utter East setup
	}
}

# Arrival at the Island of the Star
narrative_event = {
	id = soh.9363
	title = EVTTITLE_SOH_9363
	desc = EVTDESC_SOH_9363
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9363 # We should see what we find
		
		character_event = { id = soh.9364 days = 3 } # Sleepers discovered
	}
}

# Sleepers discovered
character_event = {
	id = soh.9364
	desc = EVTDESC_SOH_9364
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			trait = paranoid
		}
		
		name = EVTOPTA_SOH_9364 # It's a trap!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}
			
			mult_modifier = {
				factor = 100
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9364 # We should leave...
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9364 # Curous, but I'm too hungry to care!
		
		set_character_flag = treasure_fleet_partaking_of_the_feast
		
		character_event = { id = soh.9365 days = 1 } # Argument
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = temperate
			}
			
			mult_modifier = {
				factor = 0.1
				trait = paranoid
			}
		}
	}
}

# Argument at the feast - reach for stone knife?
character_event = {
	id = soh.9365
	desc = EVTDESC_SOH_9365
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9365 # I should not be too hasty...
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = wroth
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = cruel
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9365 # Reach for the knife
		
		pacifists_lose_piety_effect = yes
		
		FROMFROMFROM = {
			set_province_flag = treasure_fleet_stone_knife_used
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = patient
				}
			}
			
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
		}
	}
}

# Did anyone reach for the stone knife?
province_event = {
	id = soh.9366
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_province_flag = treasure_fleet_stone_knife_used
			}
			
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				
				if = {
					limit = {
						has_character_flag = treasure_fleet_partaking_of_the_feast
					}
					
					character_event = { id = soh.9367 } # Fall into a dreamless sleep
				}
				
				else = {
					character_event = { id = soh.9368 } # New sleepers discovered
				}
			}
		}
		
		else = {
			any_playable_ruler = {
				limit = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				
				character_event = { id = soh.9369 } # Nobody home
			}
		}
	}
}		

# Dreamless sleep
character_event = {
	id = soh.9367
	desc = EVTDESC_SOH_9367
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9367 # What's happ...
		
		death = {
			death_reason = death_dreamless_sleep
		}
	}
}

# New sleepers discovered
character_event = {
	id = soh.9368
	desc = EVTDESC_SOH_9368
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9368 # This place must be cursed!
	}
}

# Departure - no stone knife
character_event = {
	id = soh.9369
	desc = EVTDESC_SOH_9369
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9369 # How odd...
	}
}

### Utter East

# Utter East setup
province_event = {
	id = soh.9370
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			character_event = { id = soh.9371 days = 3 } # Sweet water
			
			character_event = { id = soh.9372 days = 6 } # Water too shallow
		}
			
		province_event = { id = soh.9374 days = 9 } # Return voyage
	}
}

# Sweet water
character_event = {
	id = soh.9371
	desc = EVTDESC_SOH_9371
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9371 # Strange...
	}
}

# Water too shallow to continue - head ashore in longboat?
character_event = {
	id = soh.9372
	desc = EVTDESC_SOH_9372
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9372 # I will head ashore!
		
		narrative_event = { id = soh.9373 days = 3 } # The Lion
	}
	
	option = {
		name = EVTOPTB_SOH_9372 # I will stay here!
	}
}

# The Lion
narrative_event = {
	id = soh.9373
	title = EVTTITLE_SOH_9373
	desc = EVTDESC_SOH_9373
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9373 # Bow to the lion
		
		add_trait_fully_humble_effect = yes
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = proud
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = zealous
			}
		}
		
		name = EVTOPTB_SOH_9373 # I feel more understanding!
		
		if = {
			limit = {
				NOT = {
					religion_group = christian
				}
			}
			
			add_trait = sympathy_christendom
		}
		
		if = {
			limit = {
				NOT = {
					religion_group = muslim
				}
			}
			
			add_trait = sympathy_islam
		}
		
		if = {
			limit = {
				NOT = {
					religion_group = jewish_group
				}
			}
			
			add_trait = sympathy_judaism
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = cruel
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			OR = {
				religion_group = christian
				religion_group = muslim
				religion_group = jewish_group
			}
		}
		
		name = EVTOPTC_SOH_9373 # My faith grows stronger!
		
		add_trait_fully_zealous_effect = yes
	}
	
	option = {
		trigger = {
			NOR = {
				religion_group = christian
				religion_group = muslim
				religion_group = jewish_group
			}
		}
		
		name = EVTOPTD_SOH_9373 # Curious...
		
		prestige = 100
	}
}

# Return voyage
province_event = {
	id = soh.9374
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_utter_east
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_pacific_return
		set_province_flag = treasure_fleet_was_at_utter_east
	}
}



##### R'lyeh

# R'lyeh setup
province_event = {
	id = soh.9375
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		change_variable = {
			which = cthulhu_stirs
			value = 1
		}
		
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9376 } # R'lyeh sighted
		}
		
		province_event = { id = soh.9378 days = 3 } # Are the Stars Right?
	}
}

# The Ruined City
narrative_event = {
	id = soh.9376
	title = EVTTITLE_SOH_9376
	desc = EVTDESC_SOH_9376
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NAND = {
				trait = lunatic
				has_epidemic = no
			}
		}
		
		name = EVTOPTA_SOH_9376 # We should turn around!
		
		random = {
			chance = 5
			add_trait_lunatic_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
	
	option = {
		trigger = {
			NAND = {
				trait = lunatic
				has_epidemic = no
			}
		}
		
		name = EVTOPTB_SOH_9376 # I wonder what lies inside...
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = cthulhu_stirs
					value = 1
				}
			}
		}
		
		narrative_event = { id = soh.9377 days = 3 } # Cthulhu discovered
		
		random = {
			chance = 10
			add_trait_lunatic_effect = yes
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
			has_epidemic = no
		}
		
		name = EVTOPTC_SOH_9376 # Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn...
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = cthulhu_stirs
					value = 2
				}
			}
		}
		
		narrative_event = { id = soh.9377 days = 3 } # Cthulhu discovered
	}
}

# Dead Cthulhu Dreams
narrative_event = {
	id = soh.9377
	title = EVTTITLE_SOH_9377
	desc = EVTDESC_SOH_9377
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		
		name = EVTOPTA_SOH_9377 # We must leave at once!
		
		random = {
			chance = 10
			add_trait_lunatic_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		
		name = EVTOPTB_SOH_9377 # I wonder what that... thing is...
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = cthulhu_stirs
					value = 2
				}
			}
		}
		
		random = {
			chance = 25
			add_trait_lunatic_effect = yes
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		
		name = EVTOPTC_SOH_9377 # Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn!
		
		hidden_tooltip = {
			FROM = {
				change_variable = {
					which = cthulhu_stirs
					value = 5
				}
			}
		}
	}
}

# Are the Stars Right?
province_event = {
	id = soh.9378
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				trigger = {
					check_variable = {
						which = cthulhu_stirs
						value < 100
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = cthulhu_stirs
						value >= 90
					}
				}
				
				mult_modifier = {
					factor = 0.25
					check_variable = {
						which = cthulhu_stirs
						value >= 75
					}
				}
				
				mult_modifier = {
					factor = 0.5
					check_variable = {
						which = cthulhu_stirs
						value >= 50
					}
				}
				
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.9387 } # The Stars weren't Right...
				}
				
				province_event = { id = soh.9388 days = 3 } # Fleet returns home
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = cthulhu_stirs
						value >= 10
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = cthulhu_stirs
						value < 25
					}
				}
					
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					narrative_event = { id = soh.9379 } # The Stars are Right!
				}
				
				province_event = { id = soh.9380 days = 3 } # Determine outcome
			}
		}
	}
}			

# The Stars are Right - Cthulhu awakens
narrative_event = {
	id = soh.9379
	title = EVTTITLE_SOH_9379
	desc = EVTDESC_SOH_9379
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = lunatic
			}
		}
		
		name = EVTOPTA_SOH_9379 # It must be destroyed!
		
		random = {
			chance = 25
			add_trait_lunatic_effect = yes
		}
	}
	
	option = {
		trigger = {
			trait = lunatic
		}
		
		name = EVTOPTB_SOH_9379 # The Stars are Right!
	}
}

# Determine outcome
province_event = {
	id = soh.9380
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_variable = {
			which = tf_fighting_value
			which = treasure_fleet_ship_strength
		}
		
		hidden_tooltip = {
			d_treasure_fleet = {
				holder_scope = {
					if = {
						limit = {
							NOT = {
								trait = lunatic
							}
						}
						
						export_to_variable = {
							which = tf_pcs
							value = combat_rating
						}
						
						divide_variable = {
							which = tf_pcs
							value = 10
						}
						
						if = {
							limit = {
								check_variable = {
									which = tf_pcs
									value < 0
								}
							}
							
							set_variable = {
								which = tf_pcs
								value = 0
							}
						}
						
						export_to_variable = {
							which = tf_martial
							value = martial
						}
						
						divide_variable = {
							which = tf_martial
							value = 10
						}
						
						set_variable = {
							which = tf_fighting_value
							which = tf_pcs
						}
						
						change_variable = {
							which = tf_fighting_value
							which = tf_martial
						}
						
						ROOT = {
							change_variable = {
								which = tf_fighting_value
								which = PREV
							}
						}
					}
				}
			}
			
			any_playable_ruler = {
				if = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					if = {
						limit = {
							NOT = {
								trait = lunatic
							}
						}
						
						export_to_variable = {
							which = tf_pcs
							value = combat_rating
						}
						
						divide_variable = {
							which = tf_pcs
							value = 10
						}
						
						if = {
							limit = {
								check_variable = {
									which = tf_pcs
									value < 0
								}
							}
							
							set_variable = {
								which = tf_pcs
								value = 0
							}
						}
						
						export_to_variable = {
							which = tf_martial
							value = martial
						}
						
						divide_variable = {
							which = tf_martial
							value = 10
						}
						
						set_variable = {
							which = tf_fighting_value
							which = tf_pcs
						}
						
						change_variable = {
							which = tf_fighting_value
							which = tf_martial
						}
						
						ROOT = {
							change_variable = {
								which = tf_fighting_value
								which = PREV
							}
						}
					}
				}
				
				any_courtier = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					if = {
						limit = {
							NOT = {
								trait = lunatic
							}
						}
						
						export_to_variable = {
							which = tf_pcs
							value = combat_rating
						}
						
						divide_variable = {
							which = tf_pcs
							value = 10
						}
						
						if = {
							limit = {
								check_variable = {
									which = tf_pcs
									value < 0
								}
							}
							
							set_variable = {
								which = tf_pcs
								value = 0
							}
						}
						
						export_to_variable = {
							which = tf_martial
							value = martial
						}
						
						divide_variable = {
							which = tf_martial
							value = 10
						}
						
						set_variable = {
							which = tf_fighting_value
							which = tf_pcs
						}
						
						change_variable = {
							which = tf_fighting_value
							which = tf_martial
						}
						
						ROOT = {
							change_variable = {
								which = tf_fighting_value
								which = PREV
							}
						}
					}
				}
			}
		}
		
		random_list = {
			25 = {
				# Easy fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 50
					}
				}
			}
			
			70 = {
				# Middling fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 100
					}
				}
			}
			
			5 = {
				# Hard fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 200
					}
				}
			}
		}
		
		# Major damage
		if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value > 150
				}
			}
			
			random_list = {
				50 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -100
					}
				}
				
				25 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -50
					}
				}
				
				10 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -25
					}
				}
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value > 100
				}
			}
			
			random_list = {
				50 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -50
					}
				}
				
				25 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -25
					}
				}
				
				10 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -10
					}
				}
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value > 50
				}
			}
			
			random_list = {
				50 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -25
					}
				}
				
				25 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -10
					}
				}
				
				10 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -5
					}
				}
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value > 25
				}
			}
			
			random_list = {
				50 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -10
					}
				}
				
				25 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -5
					}
				}
				
				10 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -2
					}
				}
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					which = treasure_fleet_ship_strength
					value > 10
				}
			}
			
			random_list = {
				50 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -5
					}
				}
				
				25 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -2
					}
				}
				
				10 = {
					change_variable = {
						which = treasure_fleet_ship_strength
						value = -1
					}
				}
			}
		}
		
		subtract_variable = {
			which = tf_fighting_value
			which = tf_fight_difficulty
		}
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						check_variable = {
							which = tf_fighting_value
							value = 0
						}
					}
				}
				
				# Treasure Fleet survives
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					if = {
						limit = {
							NOT = {
								trait = lunatic
							}
						}
						
						character_event = { id = soh.9381 } # Fleet survives - non-cultist
					}
					
					else = {
						character_event = { id = soh.9382 } # Fleet survives - cultist
					}
				}
				
				province_event = { id = soh.9388 days = 3 } # Treasure Fleet returns home
			}
			
			50 = {
				# Treasure Fleet sacrifices itself to kill Cthulhu
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							if = {
								limit = {
									NOT = {
										trait = lunatic
									}
								}
								
								character_event = { id = soh.9383 } # Treasure Fleet destroyed - non-cultist
							}
							
							else = {
								character_event = { id = soh.9384 } # Treasure Fleet destroyed - cultist
							}
						}
							
						if = {
							limit = {
								NOT = {
									trait = lunatic
								}
							}
							
							character_event = { id = soh.9383 } # Treasure Fleet destroyed - non-cultist
						}
						
						else = {
							character_event = { id = soh.9384 } # Treasure Fleet destroyed - cultist
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
							
								if = {
									limit = {
										NOT = {
											trait = lunatic
										}
									}
									
									character_event = { id = soh.9383 } # Treasure Fleet destroyed - non-cultist
								}
								
								else = {
									character_event = { id = soh.9384 } # Treasure Fleet destroyed - cultist
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
							
								if = {
									limit = {
										NOT = {
											trait = lunatic
										}
									}
									
									character_event = { id = soh.9383 } # Treasure Fleet destroyed - non-cultist
								}
								
								else = {
									character_event = { id = soh.9384 } # Treasure Fleet destroyed - cultist
								}
							}
						}
						
						character_event = { id = soh.9385 } # Treasure Fleet destroyed - EoC
					}
				}
			}
		}
		
		set_variable = {
			which = cthulhu_stirs
			value = 0
		}
	}
}

# Fleet survives - non-cultist
character_event = {
	id = soh.9381
	desc = EVTDESC_SOH_9381
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9381 # Phew!
		
		prestige = 500
		piety = 500
	}
}

# Fleet survives - cultist
character_event = {
	id = soh.9382
	desc = EVTDESC_SOH_9382
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9382 # Maybe the Stars weren't Right?
		
		random = {
			chance = 50
			remove_trait_lunatic_effect = yes
		}
	}
}

# Fleet destroyed - non-cultist
character_event = {
	id = soh.9383
	desc = EVTDESC_SOH_9383
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9383 # At least we killed it... right?
		
		death = {
			death_reason = death_battle
		}
	}
}

# Fleet destroyed - cultist
character_event = {
	id = soh.9384
	desc = EVTDESC_SOH_9384
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9384 # But the Stars were Right!
		
		death = {
			death_reason = death_battle
		}
	}
}

# Fleet destroyed - EoC
character_event = {
	id = soh.9385
	title = EVTTITLE_SOH_9385
	desc = EVTDESC_SOH_9385
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_war
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9385 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.9386 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.9386 } # Inform the world
		}
	}
}

# Fleet destroyed - rest of the world
character_event = {
	id = soh.9386
	title = EVTTITLE_SOH_9386
	desc = EVTDESC_SOH_9386
	picture = GFX_evt_lunatic
	border = GFX_event_normal_frame_war
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_9386 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_9386 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}

# The fleet leaves - the Stars weren't Right!
character_event = {
	id = soh.9387
	desc = EVTDESC_SOH_9387
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9387 # Whatever that place was, it should be left well enough alone!
	}
}

# Return voyage
province_event = {
	id = soh.9388
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_rlyeh
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_pacific_return
		# Do not flag as "was at R'lyeh"; that results in bad things when returning home!
	}
}



##### Zailing East

# Zailing East setup
province_event = {
	id = soh.9389
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9393 } # The Hole in the World
			
			narrative_event = { id = soh.9394 days = 9 } # The Great Silence
		}
		
		random_list = {
			50 = {
				set_province_flag = treasure_fleet_north
				
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
				
					narrative_event = { id = soh.9395 days = 18 } # The City of Pillars
				}
			}
			
			50 = {
				set_province_flag = treasure_fleet_south
				
				any_playable_ruler = {
					limit = {
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
				
					narrative_event = { id = soh.9396 days = 18 } # The Castle
				}
			}
		}
		
		province_event = { id = soh.9398 days = 27 } # Return voyage
	}
}

# The Hole in the World
narrative_event = {
	id = soh.9393
	title = EVTTITLE_SOH_9393
	desc = EVTDESC_SOH_9393
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9393 # There is a sea most sunless...
	}
}

# The Great Silence
narrative_event = {
	id = soh.9394
	title = EVTTITLE_SOH_9394
	desc = EVTDESC_SOH_9394
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9394 # We can't continue...
	}
}

# The City of Pillars
narrative_event = {
	id = soh.9395
	title = EVTTITLE_SOH_9395
	desc = EVTDESC_SOH_9395
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9395 # I will have understood this!
		
		prestige = 5
	}
}

# The Castle
narrative_event = {
	id = soh.9396
	title = EVTTITLE_SOH_9396
	desc = EVTDESC_SOH_9396
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9396 # Approach the castle
		
		narrative_event = { id = soh.9397 days = 3 } # The castle
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9396 # Leave
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = brave
				}
			}
			
			factor = 100
		}
	}
}

# Investigating the Castle
narrative_event = {
	id = soh.9397
	title = EVTTITLE_SOH_9397
	desc = EVTDESC_SOH_9397
	picture = GFX_evt_lunatic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9397 # Lose your mind
		
		custom_tooltip = {
			text = do_not_do_this
		}
		
		add_trait_lunatic_effect = yes
		
		ai_chance = {
			trigger = {
				trait = lunatic
			}
			
			factor = 1
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9397 # Eat your crew
		
		pacifists_lose_piety_effect = yes
		
		custom_tooltip = {
			text = do_not_do_this
		}
		
		add_trait = cannibal
		add_trait_wounded_effect = yes
		
		ai_chance = {
			trigger = {
				OR = {
					trait = cannibal
					trait = gluttonous
				}
			}
			
			factor = 1
			
			mult_modifier = {
				factor = 0.01
				NOT = {
					trait = cannibal
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9397 # Leave
		
		ai_chance = {
			factor = 100
		}
	}
}

# Return voyage
province_event = {
	id = soh.9398
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_salt
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_arrival
		
		set_variable = {
			which = treasure_fleet_supplies
			value = 2
		}
		
		if = {
			limit = {
				has_province_flag = treasure_fleet_north
			}
			
			set_province_flag = treasure_fleet_going_to_japan
		}
		
		else = {
			set_province_flag = treasure_fleet_going_to_java
		}
	}
}



##### Yamatai

# Yamatai setup
province_event = {
	id = soh.9399
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			decrease_all_treasure_fleet_attributes_small_effect = yes
			
			narrative_event = { id = soh.9400 } # Through the Storm
			
			narrative_event = { id = soh.9401 days = 5 } # Shores of Yamatai
			
			narrative_event = { id = soh.9402 days = 10 } # The Shaman-Queen
			
			narrative_event = { id = soh.9403 days = 15 } # The Thousand Handmaidens
			
			narrative_event = { id = soh.9404 days = 20 } # The Second Audience
			
			narrative_event = { id = soh.9405 days = 25 } # Leaving Yamatai
		}
		
		province_event = { id = soh.9406 days = 30 } # Return voyage
	}
}

# Through the Storm
narrative_event = {
	id = soh.9400
	title = EVTTITLE_SOH_9400
	desc = EVTDESC_SOH_9400
	picture = GFX_evt_kraken
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9400 # I'm sure we can press on!
	}
}

# Shores of Yamatai
narrative_event = {
	id = soh.9401
	title = EVTTITLE_SOH_9401
	desc = EVTDESC_SOH_9401
	picture = GFX_evt_castle_garden_japonic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9401 # An audience with your Shaman-Queen? Sure!
	}
}

# The Shaman-Queen
narrative_event = {
	id = soh.9402
	title = EVTTITLE_SOH_9402
	desc = EVTDESC_SOH_9402
	picture = GFX_evt_matriarchy_throne_room
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		2753 = { # Hangzhou
			persistent_event_target:treasure_fleet_sender = {
				save_event_target_as = treasure_fleet_sender
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9402 # A feast? Why not!
	}
}

# The Thousand Handmaidens
narrative_event = {
	id = soh.9403
	title = EVTTITLE_SOH_9403
	desc = EVTDESC_SOH_9403
	picture = GFX_evt_feast
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9403 # Good luck!
		
		add_trait_partially_kind_effect = yes
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			has_epidemic = no
		}
		
		name = EVTOPTB_SOH_9403 # This sounds a bit suspect... join the TF?
		
		add_trait_partially_paranoid_effect = yes
		
		set_character_flag = treasure_fleet_no_himiko
		
		create_character = {
			female = yes
			culture = yamato
			religion = ryukyuan_pagan
			dynasty = none
			age = 17
			
			attributes = {
				diplomacy = 3
				martial = 1
				stewardship = 4
				intrigue = 0
				learning = 5
			}
			
			trait = charismatic_negotiator
			trait = treasure_fleet_voyage
			trait = trusting
			trait = humble
			trait = kind
			trait = chaste
			trait = attractive
			trait = groomed
		}
		
		ai_chance = {
			factor = 1
		}
	}
}

# The Second Audience
narrative_event = {
	id = soh.9404
	title = EVTTITLE_SOH_9404
	desc = EVTDESC_SOH_9404
	picture = GFX_evt_chinese_concubine
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = treasure_fleet_no_himiko
			}
		}
		
		name = EVTOPTA_SOH_9404 # Is this the handmaiden...?
	}
	
	option = {
		name = EVTOPTB_SOH_9404 # Something seems strange here...
	}
}

# Leaving Yamatai
narrative_event = {
	id = soh.9405
	title = EVTTITLE_SOH_9405
	desc = EVTDESC_SOH_9405
	picture = GFX_evt_castle_garden_japonic
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9405 # What a curious place...
	}
}

# Retun voyage
province_event = {
	id = soh.9406
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_yamatai
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_arrival
		
		increase_treasure_fleet_supplies_large_effect = yes
		
		random_list = {
			50 = {
				set_province_flag = treasure_fleet_going_to_japan
			}
			
			50 = {
				set_province_flag = treasure_fleet_going_to_ryukyu
			}
		}
	}
}



##### Atlantis

# Atlantis setup
province_event = {
	id = soh.9407
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9408 } # Atlantis spotted
			
			narrative_event = { id = soh.9409 days = 10 } # Meeting with the Atlanteans
			
			character_event = { id = soh.9410 days = 20 } # Random event selection
		}
		
		province_event = { id = soh.9414 days = 30 } # Time for the fun...
	}
}
		

# Atlantis spotted
narrative_event = {
	id = soh.9408
	title = EVTTITLE_SOH_9408
	desc = EVTDESC_SOH_9408
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9408 # I guess we follow them...
	}
}

# Meeting with the Atlanteans
narrative_event = {
	id = soh.9409
	title = EVTTITLE_SOH_9409
	desc = EVTDESC_SOH_9409
	picture = GFX_evt_hellenic_temple
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9409 # I suppose we can stay for a while...
	}
}

# Random event selection
character_event = {
	id = soh.9410
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				trigger = {
					has_epidemic = no
				}
				
				character_event = { id = soh.9411 } # Atlantean entertainment
			}
			
			10 = {
				trigger = {
					learning >= 10
					has_epidemic = no
				}
				
				character_event = { id = soh.9412 } # Atlantean knowledge
			}
			
			1 = {
				trigger = {
					intrigue >= 10
					martial >= 10
					has_epidemic = no
				}
				
				character_event = { id = soh.9413 } # Atlantean invasion plans
			}
			
			1 = {
				# Nothing
			}
		}
	}
}

# Atlantean entertainment
character_event = {
	id = soh.9411
	desc = EVTDESC_SOH_9411
	picture = GFX_evt_hellenic_temple
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9411 # Wonderful!
		
		remove_trait_stressed_effect = yes
		
		remove_trait_depressed_effect = yes
		
		add_trait_partially_gluttonous_effect = yes
	}
}

# Atlantean knowledge
character_event = {
	id = soh.9412
	desc = EVTDESC_SOH_9412
	picture = GFX_evt_hellenic_temple
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9412 # Knowledge is power!
		
		culture_techpoints = 100
		economy_techpoints = 100
		military_techpoints  = 100
	}
}

# Atlantean invasion plans
character_event = {
	id = soh.9413
	desc = EVTDESC_SOH_9413
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9413 # What have we told them...?
		
		add_trait_partially_paranoid_effect = yes
	}
}

# Time for the fun...
province_event = {
	id = soh.9414
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			character_event = { id = soh.9415 } # Volcano erupts
			
			character_event = { id = soh.9416 days = 5 } # Earthquake
			
			character_event = { id = soh.9417 days = 10 } # Flooding
			
			narrative_event = { id = soh.9418 days = 15 } # Island sinks
		}
		
		province_event = { id = soh.9421 days = 25 } # Return voyage
	}
}

# Volcano erupts
character_event = {
	id = soh.9415
	desc = EVTDESC_SOH_9415
	picture = GFX_evt_hellenic_temple
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9415 # Surely this is nothing...
	}
}

# Earthquake
character_event = {
	id = soh.9416
	desc = EVTDESC_SOH_9416
	picture = GFX_evt_hellenic_temple
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9416 # Slightly worrying...
	}
}

# Flooding
character_event = {
	id = soh.9417
	desc = EVTDESC_SOH_9417
	picture = GFX_evt_hellenic_temple
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9417 # Back to the ships!
	}
}

# Island sinks - look for survivors?
narrative_event = {
	id = soh.9418
	title = EVTTITLE_SOH_9418
	desc = EVTDESC_SOH_9418
	picture = GFX_evt_treasure_fleet
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9418 # Leave them!
		
		pacifists_lose_piety_effect = yes
		
		add_trait_partially_cruel_effect = yes
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9418 # We should help them!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = soh.9419 days = 5 } # Survivors
				}
				
				50 = {
					character_event = { id = soh.9420 days = 5 } # No survivors
				}
			}
		}
		
		add_trait_partially_kind_effect = yes
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = cruel
				}
			}
			
			factor = 100
		}
	}
}

# Survivors found
character_event = {
	id = soh.9419
	desc = EVTDESC_SOH_9419
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9419 # Welcome aboard!
		
		create_character = {
			female = 50
			culture = atlantean
			religion = hellenic_pagan
			dynasty = random
			age = 25
			random_traits = yes
			
			attributes = {
				diplomacy = 1
				martial = 5
				stewardship = 1
				intrigue = 1
				learning = 5
			}
			
			trait = treasure_fleet_voyage
		}
		
		if = {
			limit = {
				ai = no
			}
		
			create_character = {
				female = 50
				culture = atlantean
				religion = hellenic_pagan
				dynasty = random
				age = 30
				random_traits = yes
				
				attributes = {
					diplomacy = 1
					martial = 5
					stewardship = 1
					intrigue = 1
					learning = 5
				}
				
				trait = treasure_fleet_voyage
			}
		
			create_character = {
				female = 50
				culture = atlantean
				religion = hellenic_pagan
				dynasty = random
				age = 18
				random_traits = yes
				
				attributes = {
					diplomacy = 1
					martial = 5
					stewardship = 1
					intrigue = 1
					learning = 5
				}
				
				trait = treasure_fleet_voyage
			}
		
			create_character = {
				female = 50
				culture = atlantean
				religion = hellenic_pagan
				dynasty = random
				age = 10
				random_traits = yes
				
				trait = treasure_fleet_voyage
			}
		}
	}
}

# No survivors
character_event = {
	id = soh.9420
	desc = EVTDESC_SOH_9420
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9420 # Unfortunate!
		
		prestige = -25
	}
}

# Return voyage
province_event = {
	id = soh.9421
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		increase_treasure_fleet_ship_strength_large_effect = yes
		
		clr_province_flag = treasure_fleet_at_atlantis
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_pacific_return
		set_global_flag = atlantis_lost
		set_province_flag = treasure_fleet_was_at_atlantis
	}
}



##### Kumari Kandam

# Kumari Kandam setup
province_event = {
	id = soh.9422
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9423 } # Arrival at Kumari Kandam
			
			character_event = { id = soh.9424 days = 10 } # Random event selection
		
			character_event = { id = soh.9429 days = 20 } # Departure
		}
		
		province_event = { id = soh.9430 days = 30 } # Return voyage
	}
}

# Arrival at Kumari Kandam
narrative_event = {
	id = soh.9423
	title = EVTTITLE_SOH_9423
	desc = EVTDESC_SOH_9423
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9423 # That's a large island!
	}
}

# Decide on random event
character_event = {
	id = soh.9424
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				trigger = {
					is_adult = yes
					has_epidemic = no
				}
				
				character_event = { id = soh.9425 } # Literary academy visit
			}
			
			25 = {
				trigger = {
					is_adult = yes
					prefers_men_trigger = no
					has_epidemic = no
					is_unattractive_trigger = no
					NOT = {
						trait = disfigured
					}
				}
				
				mult_modifier = {
					factor = 5
					is_attractive_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					OR = {
						trait = master_seducer
						trait = master_seductress
					}
				}
				
				character_event = { id = soh.9426 } # Beautiful maiden
			}
			
			25 = {
				trigger = {
					is_adult = yes
					prefers_men_trigger = yes
					has_epidemic = no
					is_unattractive_trigger = no
					NOT = {
						trait = disfigured
					}
				}
				
				mult_modifier = {
					factor = 5
					is_attractive_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					OR = {
						trait = master_seducer
						trait = master_seductress
					}
				}
				
				character_event = { id = soh.9427 } # Beautiful man
			}
			
			50 = {
				trigger = {
					has_epidemic = no
				}
				
				character_event = { id = soh.9428 } # Submerged temples
			}
			
			1 = {
				# Nothing
			}
		}
	}
}

# Literary academy visit
character_event = {
	id = soh.9425
	desc = EVTDESC_SOH_9425
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9425 # Inspiring
		
		change_learning = 1
	}
}

# Beautiful maiden
character_event = {
	id = soh.9426
	desc = EVTDESC_SOH_9426
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		create_character = {
			female = yes
			culture = tamil
			religion = hindu
			dynasty = none
			age = 17
			random_traits = no
			trait = flamboyant_schemer
			trait = lustful
			trait = attractive
			trait = honest
			trait = gregarious
			
			attributes = {
				diplomacy = 4
				martial = 0
				stewardship = 1
				intrigue = 4
				learning = 2
			}
		}
		
		new_character = {
			if = {
				limit = {
					ROOT = {
						is_female = yes
					}
				}
				
				add_trait = homosexual
			}
			
			save_event_target_as = sex_partner
			save_event_target_as = tamil_lover
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9426 # I like the sound of that!
		
		add_lover = event_target:tamil_lover
		
		unprotected_sex_effect_event_target = yes
		
		event_target:tamil_lover = {
			add_trait = treasure_fleet_voyage
		}
		
		ai_chance = {
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9426 # I don't think so!
		
		event_target:tamil_lover = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = lustful
					NOT = {
						trait = celibate
					}
				}
			}
			
			factor = 100
		}
	}
}

# Beautiful man
character_event = {
	id = soh.9427
	desc = EVTDESC_SOH_9427
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		create_character = {
			female = no
			culture = tamil
			religion = hindu
			dynasty = none
			age = 17
			random_traits = no
			trait = flamboyant_schemer
			trait = lustful
			trait = attractive
			trait = honest
			trait = gregarious
			
			attributes = {
				diplomacy = 4
				martial = 0
				stewardship = 1
				intrigue = 4
				learning = 2
			}
		}
		
		new_character = {
			if = {
				limit = {
					ROOT = {
						is_female = no
					}
				}
				
				add_trait = homosexual
			}
			
			save_event_target_as = sex_partner
			save_event_target_as = tamil_lover
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9427 # I like the sound of that!
		
		add_lover = event_target:tamil_lover
		
		unprotected_sex_effect_event_target = yes
		
		event_target:tamil_lover = {
			add_trait = treasure_fleet_voyage
		}
		
		ai_chance = {
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9427 # I don't think so!
		
		event_target:tamil_lover = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = lustful
					NOT = {
						trait = celibate
					}
				}
			}
			
			factor = 100
		}
	}
}

# Submerged temples
character_event = {
	id = soh.9428
	desc = EVTDESC_SOH_9428
	picture = GFX_evt_dharmic_pilgrims
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9428 # Most curious...
		
		prestige = 25
	}
}

# Departure
character_event = {
	id = soh.9429
	desc = EVTDESC_SOH_9429
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9429 # Onwards!
	}
}

# Return voyage
province_event = {
	id = soh.9430
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_kumari_kandam
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_arrival
		set_province_flag = treasure_fleet_going_to_lanka
	}
}



##### Actual crossing

# Crossing setup
province_event = {
	id = soh.9431
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				trait = treasure_fleet_voyage
				NOT = {
					has_character_flag = left_treasure_fleet_voyage
				}
			}
			
			narrative_event = { id = soh.9432 } # Arrival at Easter Island
			
			character_event = { id = soh.9436 days = 10 } # Departure
			
			narrative_event = { id = soh.9437 days = 40 } # Arrival at Galapagos
			
			character_event = { id = soh.9442 days = 50 } # Departure
		}
		
		province_event = { id = soh.9443 days = 70 } # Continue to the New World
	}
}

### Easter Island

# Arrival at Easter Island
narrative_event = {
	id = soh.9432
	title = EVTTITLE_SOH_9432
	desc = EVTDESC_SOH_9432
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9432 # Nice place!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = soh.9433 days = 5 random = 2 } # Moai
				}
				
				10 = {
					character_event = { id = soh.9434 days = 5 random = 2 } # Settlement remains
				}
				
				10 = {
					character_event = { id = soh.9435 days = 5 random = 2 } # Relaxing
				}
				
				10 = {} # Nothing
			}
		}
	}
}

# Moai
character_event = {
	id = soh.9433
	desc = EVTDESC_SOH_9433
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes
			lifestyle_traits < 1
		}
		
		name = EVTOPTA_SOH_9433 # Scholar
		
		add_trait = scholar
	}
	
	option = {
		trigger = {
			is_adult = yes
			lifestyle_traits < 1
		}
		
		name = EVTOPTB_SOH_9433 # Mystic
		
		add_trait = mystic
	}
	
	option = {
		name = EVTOPTC_SOH_9433 # Neither
		
		prestige = 10
	}
}

# Settlement remains
character_event = {
	id = soh.9434
	desc = EVTDESC_SOH_9434
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9434 # Curious...
		
		culture_techpoints = 10
		economy_techpoints = 10
		military_techpoints = 10
	}
}

# Relaxing island
character_event = {
	id = soh.9435
	desc = EVTDESC_SOH_9435
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9435 # I needed this!
		
		remove_trait_stressed_effect = yes
		
		random = {
			chance = 25
			add_trait_partially_slothful_effect = yes
		}
	}
}

# Departure
character_event = {
	id = soh.9436
	desc = EVTDESC_SOH_9436
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9436 # We must sail on!
	}
}

### Galapagos

# Arrival at Galapagos
narrative_event = {
	id = soh.9437
	title = EVTTITLE_SOH_9437
	desc = EVTDESC_SOH_9437
	picture = GFX_evt_tropicana
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9437 # Nice place!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = soh.9438 days = 5 random = 5 } # Giant tortoises
				}
				
				10 = {
					character_event = { id = soh.9439 days = 5 random = 5 } # Ceramic remains
				}
				
				1 = {
					character_event = { id = soh.9440 days = 5 random = 5 } # Volcano erupts
				}
				
				10 = {
					character_event = { id = soh.9441 days = 5 random = 5 } # Relaxing
				}
				
				10 = {} # Nothing
			}
		}
	}
}

# Giant tortoises
character_event = {
	id = soh.9438
	desc = EVTDESC_SOH_9438
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9438 # Yes!
		
		pacifists_lose_piety_effect = yes
		
		piety = -50
		
		hidden_tooltip = {
			2753 = { # Hangzhou
				change_variable = {
					which = treasure_fleet_supplies
					value = 5
				}
			}
		}
		
		ai_chance = {
			trigger = {
				OR = {
					trait = gluttonous
					2753 = { # Hangzhou
						check_variable = {
							which = treasure_fleet_supplies
							value < 0
						}
					}
				}
			}
			
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9438 # No!
		
		piety = 50
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = gluttonous
			}
		}
	}
}

# Ceramic remains
character_event = {
	id = soh.9439
	desc = EVTDESC_SOH_9439
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9439 # Curious...
		
		prestige = 5
	}
}

# Volcano erupts
character_event = {
	id = soh.9440
	desc = EVTDESC_SOH_9440
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9440 # We can't stay around...
		
		prestige = 5
	}
}

# Relaxing island
character_event = {
	id = soh.9441
	desc = EVTDESC_SOH_9441
	picture = GFX_evt_tropicana
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9441 # I needed this!
		
		remove_trait_stressed_effect = yes
		
		random = {
			chance = 25
			add_trait_partially_slothful_effect = yes
		}
	}
}

# Departure
character_event = {
	id = soh.9442
	desc = EVTDESC_SOH_9442
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9442 # We must sail on!
	}
}

# Continue to the New World
province_event = {
	id = soh.9443
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_province_flag = treasure_fleet_at_pacific_crossing
		clr_global_flag = treasure_fleet_pacific
		set_global_flag = treasure_fleet_new_world
	}
}