# Lunar New Year events

# by Silverswee(e)per

namespace = soh

# IDs 6600-6900 reserved

#####

# Currently, the following characters have access to the LNY:
# - Taoists (that are not Koreanic, unless Chinese Imperial)
# - Confucians (that are not Koreanic, unless Chinese Imperial)
# - Shenists
# - Reformed Shenists - even if not "Chinese enough"
# - Chinese culture group Buddhists; this might potentially be expanded a bit in the future to cover at least *some* "Chinese enough" Buddhists
# - The Emperor of China, if "Chinese enough" (i.e. if they're eligible for Chinese Imperial)
# - Pretender emperors
# This choice should give the festival to most characters that realistically should be interested in it while not giving it to characters that have some other festival unless CI

# The LNY can be celebrated Jan-Feb in the mod, and the actual LNY is assumed to take place February 1 (the sixty year cycle is rather more complicated to include).
# Festivities might not be in the right order, but the chosen order should lead to a payoff at the end and should hopefully have stuff happen throughout the LNY.
# There is a game rule specifically for disabling the supernatural stuff that's less Chinese, if that's desired



##### Initial setup

# Determine if zodiac and/or element matches
character_event = {
	id = soh.6601
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		# Clear various flags from any previous LNY celebration
		clr_character_flag = acrobats_hired
		clr_character_flag = coming_to_lny
		clr_character_flag = dragon_boon_fertility
		clr_character_flag = dragon_boon_health
		clr_character_flag = dragon_boon_intelligence
		clr_character_flag = dragon_boon_martial
		clr_character_flag = dragon_boon_prosperity
		clr_character_flag = dragon_boon_rulership
		clr_character_flag = dragon_boon_strength
		clr_character_flag = dragon_boon_wisdom
		clr_character_flag = dragon_combat_undecided
		clr_character_flag = guest_lny_started
		clr_character_flag = helping_with_bandits
		clr_character_flag = helping_with_dragon
		clr_character_flag = host_lny_started
		clr_character_flag = large_fireworks
		clr_character_flag = lavishly_food
		clr_character_flag = lion_dance
		clr_character_flag = lny_cleaned_a_little
		clr_character_flag = lny_cleaned_properly
		clr_character_flag = lny_did_not_clean
		clr_character_flag = lny_element_match
		clr_character_flag = lny_extra_dragon_guards
		clr_character_flag = lny_extravagant_decorations
		clr_character_flag = lny_no_decorations
		clr_character_flag = lny_normal_decorations
		clr_character_flag = lny_zodiac_match
		clr_character_flag = low_food
		clr_character_flag = massive_fireworks
		clr_character_flag = medium_food
		clr_character_flag = musicians_hired
		clr_character_flag = nine_dragon_dance
		clr_character_flag = no_lion_dance
		clr_character_flag = normal_dragon_dance
		clr_character_flag = normal_fireworks
		clr_character_flag = ongoing_dragon_attack
		clr_character_flag = red_envelopes
		clr_character_flag = sent_invitations
		clr_character_flag = small_dragon_dance
		clr_character_flag = small_fireworks
		clr_character_flag = two_dragon_dance
		
		# Determine ROOT's zodiac/element
		set_this_chinese_year_zodiac_element_yin_yang_effect = yes
		
		# Determine the zodiac/element of the new year and the old year - done globally
		set_old_chinese_year_zodiac_element_yin_yang_effect = yes
		set_new_chinese_year_zodiac_element_yin_yang_effect = yes
		
		# Check if there's a match
		if = {
			limit = {
				lunar_new_year_is_this_zodiac_trigger = yes
			}
			set_character_flag = lny_zodiac_match
		}
		
		if = {
			limit = {
				lunar_new_year_is_this_element_trigger = yes
			}
			set_character_flag = lny_element_match
		}
		
		character_event = { id = soh.6602 days = 1 } # Dragon dance - always happens!
		
		random = {
			chance = 50
			character_event = { id = soh.6603 days = 2 random = 1 } # Musicians
		}
		
		random = {
			chance = 50
			character_event = { id = soh.6604 days = 3 } # Acrobats
		}
		
		character_event = { id = soh.6605 days = 4 random = 1  } # Fireworks - always happens!
		
		random = {
			chance = 50
			character_event = { id = soh.6606 days = 5 } # Lion dance
		}
		
		character_event = { id = soh.6607 days = 6 random = 1  } # Decorations - always happens!
		
		random = {
			chance = 50
			character_event = { id = soh.6608 days = 7 } # Red envelopes
		}
		
		if = {
			limit = {
				has_global_flag = first_dragon_attack
				#NOT = {
				#	has_global_flag = dragon_slain # There could always be more dragons out there, so why take the risk...?
				#}
			}
			
			character_event = { id = soh.6691 days = 8 random = 1  } # Extra guards in case of dragon attack
		}
		
		character_event = { id = soh.6609 days = 10 random = 2 } # Food - always happens!
		
		character_event = { id = soh.6610 days = 15 } # Invitations - always happens!
	}
}

# Decide on dragon dance
character_event = {
	id = soh.6602
	desc = EVTDESC_SOH_6602
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6602 # What is the smallest dragon I can get away with?
		
		wealth = -10
		
		set_character_flag = small_dragon_dance
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6602 # Give me one normal-sized dragon!
		
		wealth = -25
		
		set_character_flag = normal_dragon_dance
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6602 # Two dragons!
		
		wealth = -50
		
		set_character_flag = two_dragon_dance
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				tier = king
				tier = emperor
			}
			is_feudal = yes
		}
		
		name = EVTOPTD_SOH_6602 # Give me the full nine dragons!
		
		wealth = -250
		
		set_character_flag = nine_dragon_dance
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 2
				government = chinese_imperial_government
			}
			
			mult_modifier = {
				factor = 2
				is_chinese_emperor_trigger = yes
			}
		}
	}
}

# Musicians
character_event = {
	id = soh.6603
	desc = EVTDESC_SOH_6603
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6603 # Musicians would make the celebration better!
		
		wealth = -15
		
		set_character_flag = musicians_hired
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6603 # No thanks!
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
}

# Acrobats
character_event = {
	id = soh.6604
	desc = EVTDESC_SOH_6604
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6604 # Acrobats would make the celebration better!
		
		wealth = -15
		
		set_character_flag = acrobats_hired
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6604 # No thanks!
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
}

# Fireworks
character_event = {
	id = soh.6605
	desc = EVTDESC_SOH_6605
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6605 # Get as few as possible
		
		wealth = -5
		
		set_character_flag = small_fireworks
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.5
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6605 # Get a decent amount
		
		wealth = -10
		
		set_character_flag = normal_fireworks
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6605 # Get more than enough
		
		wealth = -25
		
		set_character_flag = large_fireworks
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_6605 # Get a LOT more than expected
		
		wealth = -100
		
		set_character_flag = massive_fireworks
		
		ai_chance = {
			factor = 10
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.5
				trait = craven
			}
			
			mult_modifier = {
				factor = 2
				government = chinese_imperial_government
			}
			
			mult_modifier = {
				factor = 2
				is_chinese_emperor_trigger = yes
			}
		}
	}
}

# Lion dance
character_event = {
	id = soh.6606
	desc = EVTDESC_SOH_6606
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6606 # Sure, let's have one of those!
		
		wealth = -15
		
		set_character_flag = lion_dance
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6606 # It's not worth it...
		
		set_character_flag = no_lion_dance
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
}

# Decorations
character_event = {
	id = soh.6607
	desc = EVTDESC_SOH_6607
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6607 # Don't bother
		
		set_character_flag = lny_no_decorations
		
		if = {
			limit = {
				is_adult = yes
			}
			
			random = {
				chance = 25
				add_trait_partially_greedy_effect = yes
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = greedy
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6607 # Get a decent amount
		
		wealth = -25
		
		set_character_flag = lny_normal_decorations
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6607 # Get more than expected
		
		wealth = -50
		
		if = {
			limit = {
				is_adult = yes
			}
			
			random = {
				chance = 25
				add_trait_partially_charitable_effect = yes
			}
		}
		
		set_character_flag = lny_extravagant_decorations
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
		}
	}
}

# Red envelopes
character_event = {
	id = soh.6608
	desc = EVTDESC_SOH_6608
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6608 # Sure, let's do that!
		
		wealth = -25
		
		set_character_flag = red_envelopes
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6608 # It's not worth it...
		
		piety = -10
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
			}
		}
	}
}

# Food preparations - vanilla code
character_event = {
	id = soh.6609
	desc = EVTDESC_SOH_6609
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	prisoner = no
	war = no
	
	is_triggered_only = yes

	trigger = {
		is_actually_incapable_trigger = no
		NOR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
	}

	immediate = {
		if = {
			limit = {
				any_artifact = {
					has_artifact_flag = cooking
					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}
			}

			random_artifact = {
				limit = {
					has_artifact_flag = cooking

					OR = {
						is_artifact_equipped = yes

						# If ROOT already cannibal, someone else should be around to become cannical...
						trigger_if = {
							limit = {
								artifact_type = the_omnivore
								ROOT = { trait = cannibal }
							}

							ROOT = {
								any_courtier = {
									is_adult = yes
									NOT = { trait = cannibal }
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}

					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}

				preferred_limit = {
					quality >= 3
				}

				preferred_limit = {
					quality >= 2
				}

				preferred_limit = {
					quality >= 1
				}

				save_event_target_as = book_target
			}

			if = { # If ROOT is already a cannibal...
				limit = {
					trait = cannibal

					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				random_courtier = {
					limit = {
						NOT = { trait = cannibal }
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
						is_evil_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
					}

					preferred_limit = {
						family_of_root_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
					}

					save_event_target_as = potential_cannibal
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTD72003 # Why don't we use this as inspiration?
			trigger = {
				event_target:book_target = { quality > 1 }
			}
		}
		name = {
			text = EVTOPTD72003_cheap # Let's make use of this little thing
			trigger = {
				event_target:book_target = { quality < 2 }
			}
		}

		tooltip_info_custom = available_because_books_tt

		trigger = {
			event_target:book_target = { always = yes }
		}

		if = {
			limit = {
				event_target:book_target = {
					quality < 2
				}
			}

			set_character_flag = low_food
			prestige = -5
		}
		else_if = {
			limit = {
				event_target:book_target = {
					quality == 2
				}
			}

			if = {
				limit = {
					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				if = {
					limit = { trait = cannibal }

					custom_tooltip = { text = EVTOPTD72003_buddy_cannibal_tt }

					event_target:potential_cannibal = {
						show_scope_change = no

						add_trait = cannibal
					}
				}
				else = {
					custom_tooltip = { text = EVTOPTD72003_cannibal_tt }
					add_trait = cannibal
				}

				set_character_flag = lavishly_food
				wealth = -10
				prestige = 20
			}
			else = {
				set_character_flag = medium_food
				wealth = -5
				prestige = 5
			}
		}
		else = { # Means it's quality 3/higher
			set_character_flag = lavishly_food
			wealth = -10
			prestige = 20
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTA72003 # Spend lavishly on food

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		set_character_flag = lavishly_food
		wealth = -20
		prestige = 10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				trait = greedy
			}

			mult_modifier = {
				factor = 3
				trait = gluttonous
			}

			mult_modifier = {
				factor = 0.1
				trait = temperate
			}

			mult_modifier = {
				factor = 2
				higher_real_tier_than = DUKE
			}
		}
	}

	option = {
		name = EVTOPTB72003 # Spend medium on food

		set_character_flag = medium_food
		wealth = -10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTC72003 # Spend low on food

		trigger = {
			NOT = { trait = gluttonous }
		}

		set_character_flag = low_food
		wealth = -5
		prestige = -5

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 2.5
				trait = greedy
			}

			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}

			mult_modifier = {
				factor = 2
				real_tier = COUNT
			}
		}
	}
}

### Invitations

# Time to send out invitations
character_event = {
	id = soh.6610
	desc = EVTDESC_SOH_6610
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}

	option = {
		name = EVTOPTA72010
		
		character_event = { id = soh.6613 days = 15 }
		narrative_event = { id = soh.6614 days = 20 }

		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000

			set_character_flag = sent_invitations

			character_event = {
				id = 72015
				days = 20
			}

			any_vassal = {
				limit = {
					war = no
					block_general_event_trigger = no
					NOT = { has_character_modifier = lny_in_progress }
					NOR = {
						trait = treasure_fleet_preparation
						trait = in_mourning
					}
				}
				letter_event = {
					id = soh.6611
					days = 2
					#tooltip = "EVTTOOLTIP72011"
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = soh.6611
	desc = EVTDESC_SOH_6611

	is_triggered_only = yes

	trigger = { NOT = { is_inaccessible_trigger = yes } }

	option = {
		name = EVTOPTA_SOH_6611 # Travel to the LNY celebration
		
		set_character_flag = coming_to_lny

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -40
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -20
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6611 # Refuse

		FROM = {
			show_scope_change = no

			letter_event = {
				id = soh.6612
				days = 1
				random = 2
				tooltip = EVTTOOLTIP72012
			}

			opinion = {
				name = opinion_dislike
				who = ROOT
				years = 10
			}
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -60
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -80
				}
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = soh.6612
	desc = EVTDESC_SOH_6612

	is_triggered_only = yes

	option = {
		name = "EVTOPTA72012"
		
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}

# Cleaning
character_event = {
	id = soh.6613
	desc = EVTDESC_SOH_6613
	picture = GFX_evt_china_famine
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6613 # Make sure everything is properly cleaned
		
		wealth = -10
		
		set_character_flag = lny_cleaned_properly
		
		random = {
			chance = 5
			add_trait_stressed_effect = yes
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					trait = cynical
				}
			}
			
			mult_modifier = {
				factor = 2
				trait = diligent
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6613 # Clean a little
		
		wealth = -5
		
		set_character_flag = lny_cleaned_a_little
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = diligent
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6613 # Don't bother
		
		piety = -10
		
		set_character_flag = lny_did_not_clean
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = diligent
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}



##### Guests arrive + first event selection

# Guests arrive - host
narrative_event = {
	id = soh.6614
	title = EVTTITLE_SOH_6614
	desc = EVTDESC_SOH_6614
	picture = GFX_evt_china_open
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6614 # Wishing you prosperity!
		
		set_character_flag = host_lny_started
		
		hidden_tooltip = {
			# Welcome the guests
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				
				set_character_flag = guest_lny_started
				
				if = {
					limit = {
						ai = no # No need to spam the AI
					}
					
					narrative_event = { id = soh.6615 }
				}
			}
			
			# Cleaning
			random_list = {
				25 = {
					trigger = {
						NOT = {
							has_character_flag = lny_did_not_clean
						}
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					mult_modifier = {
						factor = 0.25
						has_character_flag = lny_cleaned_a_little
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6616 days = 2 random = 2 } # Vassal compliments thorough cleaning
					}
				}
				
				50 = {
					trigger = {
						NOT = {
							has_character_flag = lny_cleaned_properly
						}
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					mult_modifier = {
						factor = 0.1
						has_character_flag = lny_did_not_clean
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6618 days = 2 random = 2 } # Vassal comments on somewhat bad cleaning
					}
				}
				25 = {
					trigger = {
						NOT = {
							has_character_flag = lny_cleaned_properly
						}
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					mult_modifier = {
						factor = 0.1
						has_character_flag = lny_cleaned_a_little
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6620 days = 2 random = 2 } # Vassal complains about lack of cleaning
					}
				}
				
				25 = {
					# Nothing
				}
			}
			
			# Food complaints/compliments - based on vanilla
			random_list = {
				10 = { #Lavish food (vassal)
					trigger = {
						has_character_flag = lavishly_food
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6623 days = 6 random = 3 } # High food
					}
				}
				
				10 = { #Medium food (vassal)
					trigger = {
						has_character_flag = medium_food
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6624 days = 6 random = 3 } # Medium food
					}
				}
				
				10 = { #Low food (vassal)
					trigger = {
						has_character_flag = low_food
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6625 days = 6 random = 3 } # Low food
					}
				}
				
				10 = {
					# Nothing
				}
			}
			
			# Decorations
			random_list = {
				25 = {
					trigger = {
						has_character_flag = lny_extravagant_decorations
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						character_event = { id = soh.6628 days = 3 random = 2 } # Vassal compliments decorations
					}
				}
				
				50 = {
					trigger = {
						has_character_flag = lny_no_decorations
						any_vassal = {
							has_character_flag = coming_to_lny
							war = no
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						character_event = { id = soh.6630 days = 3 random = 2 } # Vassal disparages lack of decorations
					}
				}
				
				25 = {} # No event
			}
			
			# Stewardship discussion
			hidden_tooltip = {
				random = {
					chance = 50
					if = {
						limit = {
							any_vassal = {
								is_adult = yes
								has_character_flag = coming_to_lny
								war = no
								stewardship >= 16
							}
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_lny
								war = no
								stewardship >= 16
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							save_event_target_as = lny_stewardship_teacher
						}
						
						if = {
							limit = {
								is_adult = yes
								is_actually_incapable_trigger = no
								stewardship < 8
							}
							
							character_event = { id = soh.6632 days = 7 random = 2 } # Chance to teach liege... or not
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_lny
								war = no
								is_adult = yes
								is_actually_incapable_trigger = no
								stewardship < 8
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.6637 days = 4 random = 5 } # Chance to teach fellow vassal... or not
						}
					}
				}
			}
			
			# If zodiac matches, fire a special event
			if = {
				limit = {
					has_character_flag = lny_zodiac_match
					NOT = {
						has_character_flag = lny_element_match
					}
				}
				
				character_event = { id = soh.6642 days = 8 random = 3 } # Priest blesses ruler's reign
			}
			
			# If zodiac AND element matches, fire a special event
			else_if = {
				limit = {
					has_character_flag = lny_zodiac_match
					has_character_flag = lny_element_match
				}
				
				narrative_event = { id = soh.6643 days = 8 random = 3 } # Priest blesses ruler's reign (major)
			}
			
			# Fire the second event selection
			character_event = { id = soh.6645 days = 12 random = 3 } # More events
		}
	}
}

# Guests arrive - guest
narrative_event = {
	id = soh.6615
	title = EVTTITLE_SOH_6615
	desc = EVTDESC_SOH_6615
	picture = GFX_evt_china_open
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
			NOT = {
				is_dumb_trigger = yes
			}
		}
		
		name = EVTOPTA_SOH_6615 # Wishing you prosperity!
		
		piety = 5
	}
	
	option = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_6615 # Wishing you prosperity... NOT!
		
		prestige = 25
		piety = -25
	}
	
	option = {
		trigger = {
			is_dumb_trigger = yes
		}
		
		name = EVTOPTC_SOH_6615 # Happy New Year! - NOT what you're supposed to say!
		
		prestige = -25
	}
}



##### First event group

### Cleaning

# Vassal notices good cleaning
character_event = {
	id = soh.6616
	desc = EVTDESC_SOH_6616
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6616 # How auspicious!
		
		opinion = {
			who = FROM
			modifier = approves_of_lny_cleaning
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6617 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6616 # Who cares?
		
		piety = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege notified of approval
character_event = {
	id = soh.6617
	desc = EVTDESC_SOH_6617
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6617 # Good to hear!
		
		piety = 25
	}
}

# Vassal notices poor cleaning
character_event = {
	id = soh.6618
	desc = EVTDESC_SOH_6618
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6618 # How inauspicious!
		
		opinion = {
			who = FROM
			modifier = disapproves_of_lny_cleaning
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6619 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6618 # Who cares?
		
		piety = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				OR = {
					opinion = {
						who = FROM
						value < 25
					}
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege notified of dislike
character_event = {
	id = soh.6619
	desc = EVTDESC_SOH_6619
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6619 # Unfortunate
		
		piety = -10
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
	}
}

# Vassal notices NO cleaning
character_event = {
	id = soh.6620
	desc = EVTDESC_SOH_6620
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6620 # Most inauspicious!
		
		FROM = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				
				opinion = {
					who = FROM
					modifier = disapproves_of_lny_cleaning
					months = 12
				}
			}
		}
		
		FROM = {
			character_event = { id = soh.6621 }
			
			any_vassal = {
				limit = {
					NOT = {
						character = ROOT
					}
					has_character_flag = coming_to_lny
				}
				
				character_event = { id = soh.6622 }
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6620 # Who cares?
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				OR = {
					opinion = {
						who = FROM
						value < 25
					}
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege informed of vassal's comments
character_event = {
	id = soh.6621
	desc = EVTDESC_SOH_6621
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
		
	option = {
		name = EVTOPTA_SOH_6621 # Most unfortunate
		
		piety = -50
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.6622
	desc = EVTDESC_SOH_6622
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6622 # Most inauspicious!
	}
}

### Food events - based on vanilla

# Lavish Food
character_event = {
	id = soh.6623
	desc = EVTDESC_SOH_6623
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6623 # Approve publicly

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6626
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6623 # Disapprove

		trigger = {
			NOT = { trait = gluttonous }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6627
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6623 # Say nothing
		
		prestige = -10
	}
}

# Medium Food
character_event = {
	id = soh.6624
	desc = EVTDESC_SOH_6624
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6623 # Approve publicly
		
		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6626
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6623 # Disapprove publicly

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6627
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6623 # Say nothing
		prestige = -10
	}
}

# Low Food
character_event = {
	id = soh.6625
	desc = EVTDESC_SOH_6625
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6623 # Approve publicly

		trigger = {
			NOT = { trait = gluttonous }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6626
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6623 # Disapprove publicly

		trigger = {
			NOT = { trait = temperate }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.6627
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6623 # Say nothing
		
		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = soh.6626
	desc = EVTDESC_SOH_6626
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6626 # Good!
		
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 10
		}
		
		reverse_opinion = {
			modifier = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = soh.6627
	desc = EVTDESC_SOH_6627
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6627 # Shut up!
		
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 10
		}
		
		reverse_opinion = {
			modifier = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Decorations

# Vassal notices decorations
character_event = {
	id = soh.6628
	desc = EVTDESC_SOH_6628
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6628 # How auspicious!
		
		opinion = {
			who = FROM
			modifier = approves_of_lny_decorations
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6629 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6628 # Who cares?
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege notified of approval
character_event = {
	id = soh.6629
	desc = EVTDESC_SOH_6629
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6629 # Good to hear!
		
		prestige = 25
	}
}

# Vassal notices lack of decorations
character_event = {
	id = soh.6630
	desc = EVTDESC_SOH_6630
	picture = GFX_evt_china_famine
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6630 # Most inauspicious!
		
		opinion = {
			who = FROM
			modifier = disapproves_of_lny_decorations
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6631 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
				NOT = {
					trait = humble
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6630 # Who cares?
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					trait = proud
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege notified of dislike
character_event = {
	id = soh.6631
	desc = EVTDESC_SOH_6631
	picture = GFX_evt_china_famine
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6631 # Unfortunate
		
		prestige = -10
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
	}
}

### Stewardship

# Approach vassal?
character_event = {
	id = soh.6632
	desc = EVTDESC_SOH_6632
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		event_target:lny_stewardship_teacher = {
			is_inaccessible_or_incapable_trigger = no
			war = no
		}
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6632 # Let's ask!
		
		event_target:lny_stewardship_teacher = {
			character_event = { id = soh.6633 }
		}
		
		prestige = -25
		
		random = {
			chance = 15
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.01
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6632 # Nah!
		
		prestige = 10
		
		random = {
			chance = 15
			add_trait_partially_slothful_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 0.01
				trait = humble
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Vassal apporached
character_event = {
	id = soh.6633
	desc = EVTDESC_SOH_6633
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6633 # Sure!
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					is_rival = FROM
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
		
		FROM = {
			character_event = { id = soh.6634 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6633 # I don't think so!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value >= 50
					}
					opinion = {
						who = FROM
						value < -50
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
		
		FROM = {
			character_event = { id = soh.6635 days = 1 } # Inform FROM
		}
	}
	
	option = {
		trigger = {
			intrigue >= 12
			attribute_diff = {
				who = FROM
				attribute = intrigue
				value >= 4
			}
		}
		
		name = EVTOPTC_SOH_6633 # I'll teach FROM a lesson, to be sure...
		
		prestige = 50
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
				OR = {
					trait = arbitrary
					NOR = {
						is_friend = FROM
						is_lover = FROM
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
		
		FROM = {
			character_event = { id = soh.6636 days = 1 } # Inform FROM
		}
	}
}

# Got the lesson
character_event = {
	id = soh.6634
	desc = EVTDESC_SOH_6634
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6634 # Great!
		
		add_character_modifier = {
			modifier = lny_stewardship
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = good_lny_teacher
		}
	}
}

# Got no lesson
character_event = {
	id = soh.6635
	desc = EVTDESC_SOH_6635
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6635 # How rude!
		
		prestige = -5
		
		opinion = {
			who = FROM
			modifier = no_lny_teacher
		}
	}
}

# Got the wrong kind of lesson
character_event = {
	id = soh.6636
	desc = EVTDESC_SOH_6636
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6636 # Curses!
		
		add_character_modifier = {
			modifier = bad_lny_stewardship
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = bad_lny_teacher
		}
		
		if = {
			limit = {
				OR = {
					is_friend = FROM
					is_lover = FROM
				}
			}
			
			if = {
				limit = {
					is_friend = FROM
				}
				
				remove_friend = FROM
			}
			
			if = {
				limit = {
					is_lover = FROM
				}
				
				remove_lover = FROM
			}
		}
		
		else = {
			random = {
				chance = 25
				add_rival = FROM
			}
		}
	}
}

# Approach fellow vassal?
character_event = {
	id = soh.6637
	desc = EVTDESC_SOH_6637
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		event_target:lny_stewardship_teacher = {
			is_inaccessible_or_incapable_trigger = no
			war = no
		}
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6637 # Let's ask!
		
		event_target:lny_stewardship_teacher = {
			character_event = { id = soh.6638 }
		}
		
		prestige = -25
		
		random = {
			chance = 15
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.01
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6637 # Nah!
		
		random = {
			chance = 15
			add_trait_partially_slothful_effect = yes
		}
		
		prestige = 10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 0.01
				trait = humble
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Vassal apporached
character_event = {
	id = soh.6638
	desc = EVTDESC_SOH_6638
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6638 # Sure!
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					is_rival = FROM
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
		
		FROM = {
			character_event = { id = soh.6639 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6638 # I don't think so!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value >= 50
					}
					opinion = {
						who = FROM
						value < -50
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
		
		FROM = {
			character_event = { id = soh.6640 days = 1 } # Inform FROM
		}
	}
	
	option = {
		trigger = {
			intrigue >= 12
			attribute_diff = {
				who = FROM
				attribute = intrigue
				value >= 4
			}
		}
		
		name = EVTOPTC_SOH_6638 # I'll teach FROM a lesson, to be sure...
		
		prestige = 50
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
				OR = {
					trait = arbitrary
					NOR = {
						is_friend = FROM
						is_lover = FROM
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
		
		FROM = {
			character_event = { id = soh.6641 days = 1 } # Inform FROM
		}
	}
}

# Got the lesson
character_event = {
	id = soh.6639
	desc = EVTDESC_SOH_6639
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6639 # Great!
		
		add_character_modifier = {
			modifier = lny_stewardship
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = good_lny_teacher
		}
	}
}

# Got no lesson
character_event = {
	id = soh.6640
	desc = EVTDESC_SOH_6640
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6640 # How rude!
		
		prestige = -5
		
		opinion = {
			who = FROM
			modifier = no_lny_teacher
		}
	}
}

# Got the wrong kind of lesson
character_event = {
	id = soh.6641
	desc = EVTDESC_SOH_6641
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6641 # Curses!
		
		add_character_modifier = {
			modifier = bad_lny_stewardship
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = bad_lny_teacher
		}
		
		if = {
			limit = {
				OR = {
					is_friend = FROM
					is_lover = FROM
				}
			}
			
			if = {
				limit = {
					is_friend = FROM
				}
				
				remove_friend = FROM
			}
			
			if = {
				limit = {
					is_lover = FROM
				}
				
				remove_lover = FROM
			}
		}
		
		else = {
			random = {
				chance = 25
				add_rival = FROM
			}
		}
	}
}

### Zodiac (+ element) blessings

# Priest blesses ruler (zodiac only)
character_event = {
	id = soh.6642
	desc = EVTDESC_SOH_6642
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6642 # As if there was any doubt!
		
		prestige = 250
		
		piety = 100
		
		add_character_modifier = {
			modifier = lny_blessing
			months = 18
		}
		
		hidden_tooltip = {
			if =  {
				limit = {
					government = chinese_imperial_government
				}
				
				mandate_boost_small_effect = yes
			}
		}
	}
}

# Priest blesses ruler (zodiac + element)
narrative_event = {
	id = soh.6643
	title = EVTTITLE_SOH_6643
	desc = EVTDESC_SOH_6643
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6643 # As if there was any doubt!
		
		prestige = 500
		
		piety = 250
		
		add_character_modifier = {
			modifier = lny_major_blessing
			months = 36
		}
		
		hidden_tooltip = {
			if =  {
				limit = {
					government = chinese_imperial_government
				}
		
				mandate_boost_medium_effect = yes
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			opinion = {
				who = ROOT
				modifier = zodiac_element_match
			}
			
			if = {
				limit = {
					ai = no
				}
				narrative_event = { id = soh.6644 }
			}
		}
	}
}

# Vassals informed of major blessing
narrative_event = {
	id = soh.6644
	title = EVTTITLE_SOH_6644
	desc = EVTDESC_SOH_6644
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6644 # Good for FROM, I suppose
			
		opinion = {
			who = FROM
			modifier = zodiac_element_match
		}
	}
}



##### Second event selection

# Select events
character_event = {
	id = soh.6645
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	immediate = {
		# Musicians
		if = {
			limit = {
				has_character_flag = musicians_hired
			}
			
			random_list = {
				30 = {
					character_event = { id = soh.6646 } # Tone-deaf musicians upset townspeople
				}
				
				60 = {
					character_event = { id = soh.6647 } # Townspeople like musicians
				}
				
				5 = {
					character_event = { id = soh.6648 } # Musicians don't show up
				}
				
				5 = {
					# Nothing
				}
			}
		}
		
		# Acrobats
		if = {
			limit = {
				has_character_flag = acrobats_hired
			}
			
			random_list = {
				50 = {
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6649 days = 2 random = 1 } # Vassal likes acrobats
					}
				}
				
				10 = {
					character_event = { id = soh.6651 days = 2 random = 1 } # Burgled by acrobats
				}
				
				20 = {
					any_vassal = {
						count = 2
						limit = {
							has_character_flag = coming_to_lny
							war = no
							is_adult = yes
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6652 days = 2 random = 1 } # Vassal approached by burglar acrobats
					}
				}
				
				5 = {
					trigger = {
						is_adult = yes
						is_actually_incapable_trigger = no
					}
					
					# Potentially interested in acrobat
					if = {
						limit = {
							OR = {
								AND = {
									is_female = no
									NOT = {
										trait = homosexual
									}
								}
								AND = {
									is_female = yes
									trait = homosexual
								}
							}
						}
						
						character_event = { id = soh.6660 days = 2 random = 1 } # Female acrobat
					}
					
					else = {
						character_event = { id = soh.6663 days = 2 random = 1 } # Male acrobat
					}
				}
				
				5 = {
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
							is_adult = yes
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						# Vassal potentially interested in acrobat
						if = {
							limit = {
								OR = {
									AND = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
									AND = {
										is_female = yes
										trait = homosexual
									}
								}
							}
							
							character_event = { id = soh.6660 days = 2 random = 1 } # Female acrobat
						}
						
						else = {
							character_event = { id = soh.6663 days = 2 random = 1 } # Male acrobat
						}
					}
				}
				
				10 = {
					# Nothing
				}
			}
		}
		
		# Lion dance
		random_list = {
			25 = {
				trigger = {
					has_character_flag = no_lion_dance
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_lny
						war = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					character_event = { id = soh.6666 days = 4 random = 2 } # Vassal dislikes lack of lion dance
				}
			}
			
			50 = {
				trigger = {
					has_character_flag = lion_dance
					is_adult = yes
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_lny
						war = no
						ai = no
						is_adult = yes
					}
					
					character_event = { id = soh.6668 days = 4 random = 2 } # Lettuce fight bet?
				}
				
				character_event = { id = soh.6668 days = 4 random = 2 } # Lettuce fight bet?
			}
			25 = {
				trigger = {
					has_character_flag = lion_dance
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_lny
						is_adult = yes
						war = no
						ai = no
						is_maimed_trigger = no
						NOT = {
							trait = pregnant
						}
						is_ill = no
					}
					
					character_event = { id = soh.6671 days = 4 random = 2 } # Replacement dancer needed for competition - join in?
				}
				
				if = {
					limit = {
						is_maimed_trigger = no
						is_adult = yes
						NOT = {
							trait = pregnant
						}
						is_ill = no
					}
					
					character_event = { id = soh.6671 days = 4 random = 2 } # Replacement dancer needed for competition - join in?
				}
			}
			
			10 = {} # Nothing
		}
		
		# Red envelopes
		if = {
			limit = {
				has_character_flag = red_envelopes
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					war = no
				}
				
				random_list = {
					25 = {
						character_event = { id = soh.6676 days = 6 random = 2 } # Red envelope - nothing
					}
					
					50 = {
						character_event = { id = soh.6677 days = 6 random = 2 } # Red envelope - small
					}
					
					49 = {
						character_event = { id = soh.6678 days = 6 random = 2 } # Red envelope - medium
					}
					
					1 = {
						character_event = { id = soh.6679 days = 6 random = 2 } # Red envelope - large
					}
				}
			}
		}
		
		# Learning discussion
		if = {
			limit = {
				any_vassal = {
					is_adult = yes
					has_character_flag = coming_to_lny
					war = no
					learning >= 16
				}
			}
			
			any_vassal = {
				limit = {
					is_adult = yes
					has_character_flag = coming_to_lny
					war = no
					learning >= 16
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = lny_learning_teacher
			}
			
			if = {
				limit = {
					is_adult = yes
					is_actually_incapable_trigger = no
					learning < 8
				}
				
				character_event = { id = soh.6680 days = 7 random = 2 } # Chance to teach liege... or not
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					war = no
					is_adult = yes
					is_actually_incapable_trigger = no
					learning < 8
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				character_event = { id = soh.6685 days = 4 random = 5 } # Chance to teach fellow vassal... or not
			}
		}
		
		# Third event group (+ dragons)
		character_event = { id = soh.6690 days = 10 } # Here there (might) be dragons!
	}
}



##### Second event group

### Musicians

# Tone-deaf musicians upset townspeople
character_event = {
	id = soh.6646
	desc = EVTDESC_SOH_6646
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6646 # Curses!
		
		prestige = -10
		
		capital_scope = {
			add_province_modifier = {
				name = peasants_upset
				duration = 365
			}
		}
	}
}

# Good musicians make townspeople happy
character_event = {
	id = soh.6647
	desc = EVTDESC_SOH_6647
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6647 # Great!
		
		prestige = 10
		
		capital_scope = {
			add_province_modifier = {
				name = peasants_happy
				duration = 365
			}
		}
	}
}

# Musicians don't show up
character_event = {
	id = soh.6648
	desc = EVTDESC_SOH_6648
	picture = GFX_evt_china_isolationist
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6648 # Curses!
		
		prestige = -25
	}
}

### Acrobats

# Vassal likes acrobats
character_event = {
	id = soh.6649
	desc = EVTDESC_SOH_6649
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6649 # A good show indeed!
		
		opinion = {
			who = FROM
			modifier = approves_of_acrobats
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6650 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6649 # Who cares?
		
		piety = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege notified of approval
character_event = {
	id = soh.6650
	desc = EVTDESC_SOH_6650
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6650 # Good to hear!
		
		prestige = 25
	}
}

# Burgled by acrobats
character_event = {
	id = soh.6651
	desc = EVTDESC_SOH_6651
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6651 # Curses!
		
		prestige = -25
		
		wealth = -25
	}
}

# Vassal approached by burglar acrobats
character_event = {
	id = soh.6652
	desc = EVTDESC_SOH_6652
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
			any_vassal = {
				is_actually_incapable_trigger = no
				has_character_flag = coming_to_lny
				war = no
				NOT = {
					character = ROOT
				}
			}
		}
	}
	
	immediate = {
		FROM = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					war = no
					NOT = {
						character = ROOT
					}
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = lny_burglar_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6652 # I'm in!
		
		hidden_tooltip = {
			event_target:lny_burglar_target = { # ROOT's intrigue doesn't matter, since ROOT isn't part of the burglary
				random_list = {
					25 = {
						modifier = {
							factor = 10
							intrigue < 10
						}
						modifier = {
							factor = 10
							ROOT = {
								intrigue >= 20
							}
						}
						
						character_event = { id = soh.6653 days = 1 } # Burglars successful
						
						ROOT = {
							character_event = { id = soh.6654 days = 1 } # Burglars successful
						}
					}
					
					50 = {
						character_event = { id = soh.6655 days = 1 } # Burglars unsuccesful, but flee
						
						ROOT = {
							character_event = { id = soh.6656 days = 1 } # Burglars unsuccesful, but flee
						}
					}
					
					25 = {
						modifier = {
							factor = 10
							intrigue >= 20
						}
						
						modifier = {
							factor = 10
							ROOT = {
								intrigue < 10
							}
						}
						
						character_event = { id = soh.6657 days = 1 } # Burglars unsuccesful, and caught
					}
				}
			}
		}
		
		add_trait_partially_arbitrary_effect = yes
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = event_target:lny_burglar_target
					value < 50
				}
				NAND = {
					opinion = {
						who = event_target:lny_burglar_target
						value >= 25
					}
					NOR = {
						trait = deceitful
						trait = arbitrary
						trait = greedy
					}
				}
				NOR = {
					trait = just
					trait = honest
				}
			}
			
			mult_modifier = {
				factor = 0.01
				event_target:lny_burglar_target = {
					OR = {
						is_friend = ROOT
						is_lover = ROOT
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6652 # Get out of my sight!
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					trait = arbitrary
					trait = deceitful
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = event_target:lny_burglar_target
					value < 0
				}
			}
			
			mult_modifier = {
				factor = 0.001
				event_target:lny_burglar_target = {
					is_rival = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = greedy
			}
		}
	}
}

# Burglar acrobats strike successfully - victim
character_event = {
	id = soh.6653
	desc = EVTDESC_SOH_6653
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	hide_from = yes
	
	option = {
		name = EVTOPTA_SOH_6653 # Oh no!
		
		wealth = -50
	}
}

# Vassal gets spoils
character_event = {
	id = soh.6654
	desc = EVTDESC_SOH_6654
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6654 # A job well done!
		
		prestige = 25
		
		wealth = 25
	}
}

# Burglar acrobats strike unsuccesfully but escape - victim
character_event = {
	id = soh.6655
	desc = EVTDESC_SOH_6655
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	hide_from = yes
	
	option = {
		name = EVTOPTA_SOH_6655 # I wonder who sent them...
	}
}

# Vassal informed burglars escaped
character_event = {
	id = soh.6656
	desc = EVTDESC_SOH_6656
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6656 # At least they escaped!
	}
}

# Burglar acrobats strike unsuccesfully and are caught - victim
character_event = {
	id = soh.6657
	desc = EVTDESC_SOH_6657
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6657 # It was YOU!
		
		add_rival = FROM
		
		FROM = {
			character_event = { id = soh.6658 }
		}
	}
}

# Vassal informed burglars tattled
character_event = {
	id = soh.6658
	desc = EVTDESC_SOH_6658
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6658 # Lies! Lies and slander!
		
		add_rival = FROM
		
		FROMFROMFROM = {
			character_event = { id = soh.6659 }
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					war = no
				}
				if = {
					limit = {
						ai = no
					}
					
					character_event = { id = soh.6659 }
				}
			}
		}
	}
}

# Everyone informed of possibly criminal vassal
character_event = {
	id = soh.6659
	desc = EVTDESC_SOH_6659
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6659 # Word against word, but I suspect FROM did it...
		
		opinion = {
			who = FROM
			modifier = lny_thief
		}
	}
}

# Pretty female acrobat
character_event = {
	id = soh.6660
	desc = EVTDESC_SOH_6660
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	immediate = {
		create_character = {
			female = yes
			age = 19
			culture = FROM
			religion = FROM
			dynasty = none
			random_traits = no
			
			attributes = {
				diplomacy = 3
				martial = 3
				stewardship = 2
				intrigue = 3
				learning = 1
			}
			
			add_trait = flamboyant_schemer
			add_trait = lustful
			add_trait = attractive
			add_trait = brawny
			add_trait = socializer
			add_trait = temperate
			add_trait = proud
			add_trait = brave
		}
		
		new_character = {
			if = {
				limit = {
					ROOT = {
						trait = homosexual
					}
				}
				add_trait = homosexual
			}
			save_event_target_as = pretty_acrobat
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6660 # She's pretty, I guess...
		
		prestige = 5
		
		random = {
			chance = 30
			add_trait_partially_chaste_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6660 # I should proposition her!
		
		piety = -10
		
		hidden_tooltip = {
			random_list = {
				50 = {
					# It works out
					mult_modifier = {
						factor = 2
						OR = {
							trait = master_seducer
							trait = master_seductress
						}
					}
					
					mult_modifier = {
						factor = 5
						is_attractive_trigger = yes
					}
					
					character_event = { id = soh.6661 }
				}
				
				50 = {
					# It does not work out
					mult_modifier = {
						factor = 5
						is_unattractive_trigger = yes
					}
					
					character_event = { id = soh.6662 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
				}
			}
		}
	}
}

# It worked out
character_event = {
	id = soh.6661
	desc = EVTDESC_SOH_6661
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:pretty_acrobat = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
	}
	
	option = {
		name = EVTOPTA_SOH_6661 # See you never!
		
		event_target:pretty_acrobat = {
			leave_court_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6661 # I guess you can stick around...
		
		event_target:pretty_acrobat = {
			add_lover = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			has_concubinage = yes
			is_female = no
			OR = {
				NOT = {
					num_of_consorts >= 3
				}
				AND = {
					government = eastern_imperial_government
					NOT = {
						num_of_consorts >= 10
					}
				}
				government = chinese_imperial_government
				government = japanese_imperial_government
				government = divine_imperial_government
			}
		}
		
		name = EVTOPTC_SOH_6661 # You should be my concubine!
		
		event_target:pretty_acrobat = {
			add_lover = ROOT
		}
		
		add_consort = event_target:pretty_acrobat
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# It did not work out
character_event = {
	id = soh.6662
	desc = EVTDESC_SOH_6662
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6662 # Fine! Be that way!
		
		prestige = -25
		
		event_target:pretty_acrobat = {
			leave_court_and_die_effect = yes
		}
	}
}

# Pretty male acrobat
character_event = {
	id = soh.6663
	desc = EVTDESC_SOH_6663
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	immediate = {
		create_character = {
			female = no
			age = 19
			culture = FROM
			religion = FROM
			dynasty = none
			random_traits = no
			
			attributes = {
				diplomacy = 3
				martial = 3
				stewardship = 2
				intrigue = 3
				learning = 1
			}
			
			add_trait = flamboyant_schemer
			add_trait = lustful
			add_trait = attractive
			add_trait = brawny
			add_trait = socializer
			add_trait = temperate
			add_trait = proud
			add_trait = brave
		}
		
		new_character = {
			if = {
				limit = {
					ROOT = {
						trait = homosexual
					}
				}
				add_trait = homosexual
			}
			save_event_target_as = pretty_acrobat
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6663 # He's pretty, I guess...
		
		prestige = 5
		
		random = {
			chance = 30
			add_trait_partially_chaste_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6663 # I should proposition him!
		
		piety = -10
		
		hidden_tooltip = {
			random_list = {
				50 = {
					# It works out
					mult_modifier = {
						factor = 2
						OR = {
							trait = master_seducer
							trait = master_seductress
						}
					}
					
					mult_modifier = {
						factor = 5
						is_attractive_trigger = yes
					}
					
					character_event = { id = soh.6664 }
				}
				
				50 = {
					# It does not work out
					mult_modifier = {
						factor = 5
						is_unattractive_trigger = yes
					}
					
					character_event = { id = soh.6665 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
				}
			}
		}
	}
}

# It worked out
character_event = {
	id = soh.6664
	desc = EVTDESC_SOH_6664
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:pretty_acrobat = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
	}
	
	option = {
		name = EVTOPTA_SOH_6664 # See you never!
		
		event_target:pretty_acrobat = {
			leave_court_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6664 # I guess you can stick around...
		
		event_target:pretty_acrobat = {
			add_lover = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			has_concubinage = yes
			is_female = yes
			OR = {
				NOT = {
					num_of_consorts >= 3
				}
				AND = {
					government = eastern_imperial_government
					NOT = {
						num_of_consorts >= 10
					}
				}
				government = chinese_imperial_government
				government = japanese_imperial_government
				government = divine_imperial_government
			}
			OR = {
				has_religion_feature = religion_matriarchal
				has_religion_feature = religion_equal
				has_religion_feature = religion_feature_bon
				has_religion_feature = religion_feature_bai
				has_religion_feature = religion_feature_minahasan
				has_religion_feature = religion_feature_ryukyuan
				has_religion_feature = religion_feature_minangkabau
				religion = bon_pagan
			}
		}
		
		name = EVTOPTC_SOH_6664 # You should be my consort!
		
		event_target:pretty_acrobat = {
			add_lover = ROOT
		}
		
		add_consort = event_target:pretty_acrobat
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# It did not work out
character_event = {
	id = soh.6665
	desc = EVTDESC_SOH_6665
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6665 # Fine! Be that way!
		
		prestige = -25
		
		event_target:pretty_acrobat = {
			leave_court_and_die_effect = yes
		}
	}
}

### Lion dance

# Lack of lion dance upsets vassal
character_event = {
	id = soh.6666
	desc = EVTDESC_SOH_6666
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6666 # How disappointing!
		
		opinion = {
			who = FROM
			modifier = disapproves_of_lny_no_lion_dance
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.6667 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6666 # Who cares?
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege informed
character_event = {
	id = soh.6667
	desc = EVTDESC_SOH_6667
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6667 # Unfortunate
		
		prestige = -10
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
	}
}

# Lettuce fight - bet?
character_event = {
	id = soh.6668
	desc = EVTDESC_SOH_6668
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6668 # I bet on that one!
		
		wealth = -25
		
		hidden_tooltip = {
			random_list = {
				50 = {
					character_event = { id = soh.6669 days = 1 } # Won
				}
				
				50 = {
					character_event = { id = soh.6670 days = 1 } # Lost
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = content
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6668 # No bets for me!
		
		prestige = -5
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = game_master
			}
		}
	}
}

# Bet won
character_event = {
	id = soh.6669
	desc = EVTDESC_SOH_6669
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6669 # Excellent!
		
		wealth = 50
	}
}

# Bet lost
character_event = {
	id = soh.6670
	desc = EVTDESC_SOH_6670
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6670 # Curses!
		
		prestige = -25
	}
}

# Replacement acrobat needed - want to join?
character_event = {
	id = soh.6671
	desc = EVTDESC_SOH_6671
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6671 # I'll join you!
		
		hidden_tooltip = {
			random_list = {
				25 = {
					mult_modifier = {
						factor = 1.5
						combat_rating >= 100
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 90
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 80
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 70
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 60
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 50
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 45
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 40
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 35
					}
					
					character_event = { id = soh.6672 days = 1 } # Won
				}
				
				60 = {
					mult_modifier = {
						factor = 1.5
						combat_rating >= 50
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 45
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 40
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating >= 35
					}
					
					character_event = { id = soh.6673 days = 1 } # Lost
				}
				
				10 = {
					trigger = {
						combat_rating < 75
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 30
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 25
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 20
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 0
					}
					
					character_event = { id = soh.6674 days = 1 } # Wounded
				}
				
				5 = {
					trigger = {
						combat_rating < 50
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 30
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 25
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 20
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 15
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 10
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 5
					}
					
					mult_modifier = {
						factor = 1.5
						combat_rating < 0
					}
					
					character_event = { id = soh.6675 days = 1 } # Maimed
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = proud
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = content
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6671 # No thanks!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = humble
			}
		}
	}
}

# Competition won
character_event = {
	id = soh.6672
	desc = EVTDESC_SOH_6672
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6672 # Excellent!
		
		wealth = 10
		
		prestige = 50
	}
}

# Competition lost
character_event = {
	id = soh.6673
	desc = EVTDESC_SOH_6673
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6673 # At least I didn't make a fool of myself...
		
		prestige = 10
	}
}

# Competition went poorly
character_event = {
	id = soh.6674
	desc = EVTDESC_SOH_6674
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6674 # Curses!
		
		prestige = -5
		
		add_trait_wounded_effect = yes
	}
}

# Competition went really poorly
character_event = {
	id = soh.6675
	desc = EVTDESC_SOH_6675
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6675 # Ow!
		
		prestige = -25
		
		add_maimed_trait_effect = yes
	}
}

### Red envelopes

# Got no money
character_event = {
	id = soh.6676
	desc = EVTDESC_SOH_6676
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6676 # That's it?
	}
}

# Got small money
character_event = {
	id = soh.6677
	desc = EVTDESC_SOH_6677
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6677 # That's it?
		
		wealth = 1
	}
}

# Got medium money
character_event = {
	id = soh.6678
	desc = EVTDESC_SOH_6678
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6678 # Good!
		
		wealth = 5
	}
}

# Got large money
character_event = {
	id = soh.6679
	desc = EVTDESC_SOH_6679
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6679 # Good!
		
		wealth = 10
	}
}

### Learning

# Approach vassal?
character_event = {
	id = soh.6680
	desc = EVTDESC_SOH_6680
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		event_target:lny_learning_teacher = {
			is_inaccessible_or_incapable_trigger = no
			war = no
		}
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6680 # Let's ask!
		
		event_target:lny_stewardship_teacher = {
			character_event = { id = soh.6681 }
		}
		
		prestige = -25
		
		random = {
			chance = 15
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.01
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6680 # Nah!
		
		random = {
			chance = 15
			add_trait_partially_slothful_effect = yes
		}
		
		prestige = 10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 0.01
				trait = humble
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Vassal apporached
character_event = {
	id = soh.6681
	desc = EVTDESC_SOH_6681
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6681 # Sure!
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					is_rival = FROM
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
		
		FROM = {
			character_event = { id = soh.6682 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6681 # I don't think so!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value >= 50
					}
					opinion = {
						who = FROM
						value < -50
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
		
		FROM = {
			character_event = { id = soh.6683 days = 1 } # Inform FROM
		}
	}
	
	option = {
		trigger = {
			intrigue >= 12
			attribute_diff = {
				who = FROM
				attribute = intrigue
				value >= 4
			}
		}
		
		name = EVTOPTC_SOH_6681 # I'll teach FROM a lesson, to be sure...
		
		prestige = 50
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
				OR = {
					trait = arbitrary
					NOR = {
						is_friend = FROM
						is_lover = FROM
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
		
		FROM = {
			character_event = { id = soh.6684 days = 1 } # Inform FROM
		}
	}
}

# Got the lesson
character_event = {
	id = soh.6682
	desc = EVTDESC_SOH_6682
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6682 # Great!
		
		add_character_modifier = {
			modifier = lny_learning
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = good_lny_teacher
		}
	}
}

# Got no lesson
character_event = {
	id = soh.6683
	desc = EVTDESC_SOH_6683
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6683 # How rude!
		
		prestige = -5
		
		opinion = {
			who = FROM
			modifier = no_lny_teacher
		}
	}
}

# Got the wrong kind of lesson
character_event = {
	id = soh.6684
	desc = EVTDESC_SOH_6684
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6684 # Curses!
		
		add_character_modifier = {
			modifier = bad_lny_learning
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = bad_lny_teacher
		}
		
		if = {
			limit = {
				OR = {
					is_friend = FROM
					is_lover = FROM
				}
			}
			
			if = {
				limit = {
					is_friend = FROM
				}
				
				remove_friend = FROM
			}
			
			if = {
				limit = {
					is_lover = FROM
				}
				
				remove_lover = FROM
			}
		}
		
		else = {
			random = {
				chance = 25
				add_rival = FROM
			}
		}
	}
}

# Approach fellow vassal?
character_event = {
	id = soh.6685
	desc = EVTDESC_SOH_6685
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		event_target:lny_learning_teacher = {
			is_inaccessible_or_incapable_trigger = no
			war = no
		}
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6685 # Let's ask!
		
		event_target:lny_stewardship_teacher = {
			character_event = { id = soh.6686 }
		}
		
		prestige = -25
		
		random = {
			chance = 15
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.01
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6685 # Nah!
		
		random = {
			chance = 15
			add_trait_partially_slothful_effect = yes
		}
		
		prestige = 10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 0.01
				trait = humble
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
	}
}

# Vassal apporached
character_event = {
	id = soh.6686
	desc = EVTDESC_SOH_6686
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6686 # Sure!
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
				NOT = {
					is_rival = FROM
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
		
		FROM = {
			character_event = { id = soh.6687 days = 1 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6686 # I don't think so!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value >= 50
					}
					opinion = {
						who = FROM
						value < -50
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = diligent
			}
		}
		
		FROM = {
			character_event = { id = soh.6688 days = 1 } # Inform FROM
		}
	}
	
	option = {
		trigger = {
			intrigue >= 12
			attribute_diff = {
				who = FROM
				attribute = intrigue
				value >= 4
			}
		}
		
		name = EVTOPTC_SOH_6686 # I'll teach FROM a lesson, to be sure...
		
		prestige = 50
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
				OR = {
					trait = arbitrary
					NOR = {
						is_friend = FROM
						is_lover = FROM
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
		
		FROM = {
			character_event = { id = soh.6689 days = 1 } # Inform FROM
		}
	}
}

# Got the lesson
character_event = {
	id = soh.6687
	desc = EVTDESC_SOH_6687
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6676 # Great!
		
		add_character_modifier = {
			modifier = lny_learning
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = good_lny_teacher
		}
	}
}

# Got no lesson
character_event = {
	id = soh.6688
	desc = EVTDESC_SOH_6688
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6688 # How rude!
		
		prestige = -5
		
		opinion = {
			who = FROM
			modifier = no_lny_teacher
		}
	}
}

# Got the wrong kind of lesson
character_event = {
	id = soh.6689
	desc = EVTDESC_SOH_6689
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6689 # Curses!
		
		add_character_modifier = {
			modifier = bad_lny_learning
			months = 12
		}
		
		opinion = {
			who = FROM
			modifier = bad_lny_teacher
		}
		
		if = {
			limit = {
				OR = {
					is_friend = FROM
					is_lover = FROM
				}
			}
			
			if = {
				limit = {
					is_friend = FROM
				}
				
				remove_friend = FROM
			}
			
			if = {
				limit = {
					is_lover = FROM
				}
				
				remove_lover = FROM
			}
		}
		
		else = {
			random = {
				chance = 25
				add_rival = FROM
			}
		}
	}
}



##### Third event selection (+ dragons)

character_event = {
	id = soh.6690
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	immediate = {
		# Dragon events - supernatural!
		if = {
			limit = {
				OR = {
					AND = {
						ai = yes
						has_game_rule = {
							name = supernatural_events
							value = unrestricted
						}
					}
					AND = {
						ai = no
						NOT = {
							has_game_rule = {
								name = supernatural_events
								value = off
							}
						}
					}
				}
			}
			
			random_list = {
				70 = {
					trigger = {
						NOT = {
							has_global_flag = lunar_new_year_zodiac_is_dragon # The Year of the Dragon WILL contain a dragon event!
						}
					}
					
					# No dragon event
				}
				
				20 = { # Chinese dragon - more likely than others
					trigger = {
						NAND = {
							has_game_rule = {
								name =  western_dragons
								value = allowed
							}
							NOT = {
								has_global_flag = first_dragon_attack
							}
							has_global_flag = lunar_new_year_element_is_fire # If it is the Year of the Fire Dragon, !!FUN!! is about to begin...
							ai = no
						}
					}
					
					mult_modifier = {
						factor = 2
						has_global_flag = lunar_new_year_element_is_air
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					random_list = {
						5 = {
							character_event = { id = soh.6692 } # Chinese dragon sighted
						}
						
						10 = {
							character_event = { id = soh.6694 } # Chinese dragon flyby
						}
						
						5 = {
							trigger = {
								has_character_flag = lny_extra_dragon_guards
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_real_tier_than = duke
								}
							}
							
							character_event = { id = soh.6696 } # Chinese dragon driven off
						}
						
						5 = {
							trigger = {
								has_character_flag = lny_extra_dragon_guards
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_real_tier_than = duke
								}
							}
							
							narrative_event = { id = soh.6698 } # Chinese dragon displeased due to guards attacking it
						}
						
						5 = {
							trigger = {
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 2
								has_character_flag = two_dragon_dance
							}
							
							mult_modifier = {
								factor = 5
								has_character_flag = nine_dragon_dance
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_real_tier_than = duke
								}
							}
							
							narrative_event = { id = soh.6700 } # Chinese dragon lands, might offer boon
						}
					}
				}
				
				5 = { # Silver dragon on a mission to smite evil
					trigger = {
						NOR = {
							has_game_rule = {
								name =  western_dragons
								value = forbidden
							}
							has_global_flag = silver_dragon_active # We don't want to have it fight in two places at once
							AND = {
								has_game_rule = {
									name =  western_dragons
									value = allowed
								}
								NOT = {
									has_global_flag = first_dragon_attack
								}
								has_global_flag = lunar_new_year_element_is_fire # If it is the Year of the Fire Dragon, !!FUN!! is about to begin...
								ai = no
							}
						}
					}
					
					mult_modifier = {
						factor = 5
						has_global_flag = lunar_new_year_element_is_metal
					}
					
					mult_modifier = {
						factor = 2
						has_global_flag = first_dragon_attack
						NOT = {
							has_global_flag = dragon_slain
						}
					}
					
					random_list = {
						5 = {
							character_event = { id = soh.6720 } # Silver dragon sighted
						}
						
						10 = {
							character_event = { id = soh.6722 } # Silver dragon flyby
						}
						
						10 = {
							trigger = {
								has_character_flag = lny_extra_dragon_guards
							}
							
							character_event = { id = soh.6724 } # Silver dragon driven off
						}
						
						5 = {
							trigger = {
								has_character_flag = lny_extra_dragon_guards
								OR = {
									any_vassal = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									
									any_courtier = {
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
								}
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_real_tier_than = duke
								}
							}
							
							if = {
								limit = {
									any_vassal = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
								}
								
								any_vassal = {
									limit = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = smite_evil_target
								}
							}
							
							else = {
								any_courtier = {
									limit = {
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = smite_evil_target
								}
							}
							
							set_global_flag = silver_dragon_active
							
							narrative_event = { id = soh.6726 } # Silver dragon displeased due to guards attacking it
						}
						
						10 = {
							trigger = {
								OR = {
									any_vassal = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									
									any_courtier = {
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
								}
								is_feudal = yes
							}
							
							if = {
								limit = {
									any_vassal = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
								}
								
								any_vassal = {
									limit = {
										has_character_flag = coming_to_lny
										war = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = smite_evil_target
								}
							}
							
							else = {
								any_courtier = {
									limit = {
										is_inaccessible_or_incapable_trigger = no
										prisoner = no
										is_adult = yes
										OR = {
											AND = {
												is_evil_trigger = yes
												has_vice_trigger = yes
											}
											is_devil_worshiper_trigger = yes
										}
										is_ill = no
										is_maimed_trigger = no
										NOT = {
											trait = pregnant
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = smite_evil_target
								}
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_real_tier_than = duke
								}
							}
							
							set_global_flag = silver_dragon_active
							narrative_event = { id = soh.6736 } # Silver dragon targets evildoer
						}
						
						5 = {
							trigger = {
								is_adult = yes
								is_feudal = yes
								is_benevolent_trigger = yes
								has_pleasant_trait_trigger = yes
								has_pious_trait_trigger = yes
								has_virtue_trigger = yes
								piety >= 2000
								is_evil_trigger = no
								has_vice_trigger = no
								higher_real_tier_than = duke
								has_global_flag = first_dragon_attack # If the evil dragon isn't known to exist, don't give away Gram
								NOR = {
									has_global_flag = gram_exists
									has_global_flag = dragon_slain # The evil dragon is no more
									is_devil_worshiper_trigger = yes
								}
								has_regent = no
							}
							
							mult_modifier = {
								factor = 2
								piety >= 5000
							}
							
							mult_modifier = {
								factor = 2
								piety >= 10000
							}
							
							set_global_flag = gram_exists
							set_global_flag = silver_dragon_active
							
							narrative_event = { id = soh.6743 } # Silver dragon gifts Gram to the ruler
						}
					}
				}
				
				5 = { # Red dragon on a mission to burninate
					trigger = {
						has_game_rule = {
							name = western_dragons
							value = allowed
						}
						NOR = {
							has_global_flag = dragon_injured
							has_global_flag = ongoing_dragon_attack
							has_global_flag = dragon_slain
						}
						OR = {
							has_global_flag = first_dragon_attack
							AND = {
								# The fun begins a certain year...
								has_global_flag = lunar_new_year_zodiac_is_dragon
								has_global_flag = lunar_new_year_element_is_fire 
							}
						}
					}
					
					mult_modifier = {
						factor = 10
						has_global_flag = first_dragon_attack
					}
					
					mult_modifier = {
						factor = 10
						has_global_flag = lunar_new_year_element_is_fire
					}
					
					random_list = {
						1 = {
							trigger = {
								has_global_flag = first_dragon_attack
							}
							
							character_event = { id = soh.6745 } # Red dragon sighted
						}
						
						1 = {
							trigger = {
								has_global_flag = first_dragon_attack
							}
							
							character_event = { id = soh.6747 } # Red dragon flyby
						}
						
						1 = {
							trigger = {
								has_global_flag = first_dragon_attack
								has_global_flag = lny_extra_dragon_guards
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_tier_than = duke
								}
							}
							
							mult_modifier = {
								factor = 0.1
								is_feudal = no
							}
							
							character_event = { id = soh.6749 } # Red dragon driven off
						}
						
						10 = {
							trigger = {
								NOT = {
									has_global_flag = first_dragon_attack
								}
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_tier_than = duke
								}
							}
							
							mult_modifier = {
								factor = 0.1
								is_feudal = no
							}
							
							set_global_flag = first_dragon_attack
							set_global_flag = ongoing_dragon_attack
							set_character_flag = ongoing_dragon_attack
							
							narrative_event = { id = soh.6752 } # First red dragon attack
						}
						
						10 = {
							trigger = {
								has_global_flag = first_dragon_attack
								is_feudal = yes
							}
							
							mult_modifier = {
								factor = 0.1
								NOT = {
									higher_tier_than = duke
								}
							}
							
							mult_modifier = {
								factor = 0.1
								is_feudal = no
							}
							
							set_global_flag = ongoing_dragon_attack
							set_character_flag = ongoing_dragon_attack
							
							narrative_event = { id = soh.6769 } # Red dragon attacks
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				NOT = {
					has_character_flag = ongoing_dragon_attack # Dragon attacks derail festivities, but otherwise the show must go on
				}
			}
			
			# Dragon dance
			random_list = {
				10 = {
					trigger = {
						NOR = {
							has_character_flag = nine_dragon_dance
							has_character_flag = two_dragon_dance
						}
						OR = {
							higher_real_tier_than = duke
							NOT = {
								has_character_flag = normal_dragon_dance
							}
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6783 days = 4 } # Vassal might complain
					}
				}
				
				10 = {
					trigger = {
						NOR = {
							has_character_flag = nine_dragon_dance
							has_character_flag = two_dragon_dance
						}
					}
					
					character_event = { id = soh.6786 days = 4 } # Dragon dance is good
				}
				
				10 = {
					trigger = {
						OR = {
							has_character_flag = nine_dragon_dance
							has_character_flag = two_dragon_dance
						}
					}
					
					mult_modifier = {
						factor = 3
						has_character_flag = nine_dragon_dance
					}
					
					character_event = { id = soh.6788 days = 4 } # Dragon dancers get tangled up
				}
				
				10 = {
					trigger = {
						has_character_flag = two_dragon_dance
					}
					
					character_event = { id = soh.6790 days = 4 } # Two dragons are more impressive than one3
				}
				
				10 = {
					trigger = {
						has_character_flag = nine_dragon_dance
					}
					
					narrative_event = { id = soh.6792 days = 4 } # Nine dragons are most impressive
				}
				
				10 = {
					trigger = {
						NOR = {
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bai
							gender_equality_trigger = yes
						}
					}
					
					narrative_event = { id = soh.6794 days = 4 } # Bandits disguise themselves as dragon dancers
				}
			}
			
			# Fireworks
			random_list = {
				10 = {
					trigger = {
						NOR = {
							has_character_flag = massive_fireworks
							has_character_flag = large_fireworks
						}
						OR = {
							higher_real_tier_than = duke
							NOT = {
								has_character_flag = normal_fireworks
							}
						}
					}
					
					any_vassal = {
						limit = {
							has_character_flag = coming_to_lny
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.6803 days = 7 } # Vassal might complain
					}
				}
				
				10 = {
					trigger = {
						has_character_flag = normal_fireworks
					}
					
					character_event = { id = soh.6806 days = 7 } # Fireworks are acceptable
				}
				
				10 = {
					trigger = {
						has_character_flag = large_fireworks
					}
					
					character_event = { id = soh.6808 days = 7 } # Larger than normal fireworks are good
				}
				
				10 = {
					trigger = {
						has_character_flag = massive_fireworks
					}
					
					narrative_event = { id = soh.6810 days = 7 } # Massive fireworks are great
				}
			}
		}
			
		# End of the LNY
		character_event = { id = soh.6812 days = 10 } # End of the LNY
	}
}



##### Supernatural dragon events (separated from the rest)

# Extra guards
character_event = {
	id = soh.6691
	desc = EVTDESC_SOH_6691
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = lny_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_6691 # Yes! Get me more guards!
		
		scaled_wealth = {
			value = -1
			min = -100
			max = -1000
		}
		
		set_character_flag = lny_extra_dragon_guards
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy # Surely I won't have to pay more if attacked!
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave # I fear no dragon!
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes # "Hire guards"? Can you use smaller words?
			}
			
			mult_modifier = {
				factor = 0.1
				any_artifact = {
					has_flag = dragonslayer # I should win... right?
				}
			}
		}
	}
	option = {
		name = EVTOPTB_SOH_6691 # There's no need for more guards!
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = craven # Dragons are scary!
				}
			}
			
			mult_modifier = {
				factor = 0.1
				is_smart_trigger = yes # Let's not be foolhardy...
			}
		}
	}
}

### Chinese dragon

# Chinese dragon sighted
character_event = {
	id = soh.6692
	desc = EVTDESC_SOH_6692
	picture = GFX_evt_chinese_mythology
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6692 # Auspicious!
		
		piety = 25
		
		prestige = 25
		
		if = {
			limit = {
				government = chinese_imperial_government
			}
			
			mandate_boost_trivial_effect = yes
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6693 } # Inform vassals
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6693
	desc = EVTDESC_SOH_6693
	picture = GFX_evt_chinese_mythology
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6693 # Auspicious!
	}
}

# Chinese dragon flyby
character_event = {
	id = soh.6694
	desc = EVTDESC_SOH_6694
	picture = GFX_evt_chinese_mythology
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6694 # Most auspicious!
		
		if = {
			limit = {
				government = chinese_imperial_government
			}
		
			mandate_boost_small_effect = yes
		}
		
		piety = 50
		
		prestige = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6695 } # Inform vassals
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6695
	desc = EVTDESC_SOH_6695
	picture = GFX_evt_chinese_mythology
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6695 # Most auspicious!
	}
}

# Chinese dragon accidentally driven off
character_event = {
	id = soh.6696
	desc = EVTDESC_SOH_6696
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6696 # Inauspicious!
		
		piety = -50
		
		prestige = -50
		
		if = {
			limit = {
				government = chinese_imperial_government
			}
		
			mandate_penalty_medium_effect = yes
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6697 } # Inform vassals
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6697
	desc = EVTDESC_SOH_6697
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6697 # Inauspicious!
	}
}

# Chinese dragon angered by attack
narrative_event = {
	id = soh.6698
	title = EVTTITLE_SOH_6698
	desc = EVTDESC_SOH_6698
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6698 # Most inauspicious!
		
		piety = -200
		
		prestige = -200
		
		hidden_tooltip = {
			if = {
				limit = {
					government = chinese_imperial_government
				}
		
				mandate_penalty_large_effect = yes
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			opinion = {
				who = ROOT
				modifier = angered_chinese_dragon
			}
			
			if = {
				limit = {
					ai = no
				}
				narrative_event = { id = soh.6699 } # Inform vassals
			}
		}
	}
}

# Inform vassals
narrative_event = {
	id = soh.6699
	title = EVTTITLE_SOH_6699
	desc = EVTDESC_SOH_6693
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6699 # Most inauspicious!
	}
}

# Chinese dragon lands, might agree to boon
narrative_event = {
	id = soh.6700
	title = EVTTITLE_SOH_6700
	desc = EVTDESC_SOH_6700
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	immediate = {
		# Select a few possible boons
		if = {
			limit = {
				is_adult = yes
				OR = {
					has_education_martial_trigger = yes
					has_lifestyle_martial_trigger = yes
					trait = ambitious
					martial >= 15
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_martial
			}
		}
		
		if = {
			limit = {
				NOT = {
					trait = strong
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_strength
			}
		}
		
		if = {
			limit = {
				OR = {
					is_ill = yes
					is_maimed_trigger = yes
					any_realm_province = {
						has_disease = yes
					}
					age >= 60
					trait = paranoid
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_health
			}
		}
		
		if = {
			limit = {
				is_adult = yes
				NAND = {
					is_female = yes
					practical_age >= 45
				}
				NOT = {
					trait = celibate
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_fertility
			}
		}
		
		if = {
			limit = {
				OR = {
					has_education_stewardship_trigger = yes
					has_lifestyle_stewardship_trigger = yes
					stewardship >= 15
					trait = diligent
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_prosperity
			}
		}
		
		if = {
			limit = {
				OR = {
					has_education_learning_trigger = yes
					has_lifestyle_learning_trigger = yes
					AND = {
						diplomacy < 8
						martial < 8
						stewardship < 8
						intrigue < 8
						learning < 8
					}
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_wisdom
			}
		}
		
		if = {
			limit = {
				NOT = {
					trait = genius
				}
			}
			
			random = {
				chance = 25
				set_character_flag = dragon_boon_intelligence
			}
		}
		
		set_character_flag = dragon_boon_rulership
	}
	
	option = {
		name = EVTOPTA_SOH_6700 # Your presence is boon enough!
		
		hidden_tooltip = {
			if = {
				limit = {
					government = chinese_imperial_government
				}
		
				mandate_boost_small_effect = yes
			}
		}
		
		prestige = 500
		
		piety = 500
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = ambitious
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = humble
				}
			}
			
			mult_modifier = {
				factor = 0.01
				NOT = {
					trait = content
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_martial
		}
		
		name = EVTOPTB_SOH_6700 # Bless my armies, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6702 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = content
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_strength
		}
		
		name = EVTOPTC_SOH_6700 # Bless me with your strength, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6704 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				is_weak_trigger = yes
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_health
		}
		
		name = EVTOPTD_SOH_6700 # Grant me health, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6706 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = depressed
				}
			}
			
			mult_modifier = {
				factor = 0.01
				NOR = {
					is_ill = yes
					is_maimed_trigger = yes
					age = 60
				}
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_fertility
		}
		
		name = EVTOPTE_SOH_6700 # Bless me with fertility, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6708 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = chaste
			}
			
			mult_modifier = {
				factor = 0.01
				trait = homosexual
			}
			
			mult_modifier = {
				factor = 0.1
				any_child = {
					count = 5
					is_alive = yes
				}
			}
			
			mult_modifier = {
				factor = 100
				any_child = {
					count = 2
					is_alive = yes
				}
			}
			
			mult_modifier = {
				factor = 0.01
				NOR = {
					is_married = yes
					num_of_consorts >= 1
					any_lover = {
						NOT = {
							same_sex = PREV
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_prosperity
		}
		
		name = EVTOPTF_SOH_6700 # Grant me prosperity, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6710 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.01
				wealth >= 10000
			}
			
			mult_modifier = {
				factor = 0.1
				scaled_wealth >= 10
			}
			
			mult_modifier = {
				factor = 100
				trait = greedy
			}
			
			mult_modifier = {
				factor = 100
				wealth < 100
			}
			
			mult_modifier = {
				factor = 10
				scaled_wealth < 1
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_wisdom
		}
		
		name = EVTOPTG_SOH_6700 # Bless me with wisdom, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6712 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			trigger = {
				NAND = {
					diplomacy >= 12
					martial >= 12
					stewardship >= 12
					intrigue >= 12
					learning >= 12
				}
			}
			
			mult_modifier = {
				factor = 0.01
				diplomacy >= 8
				martial >= 8
				stewardship >= 8
				intrigue >= 8
				learning >= 8
			}
			
			mult_modifier = {
				factor = 100
				NAND = {
					diplomacy >= 4
					martial >= 4
					stewardship >= 4
					intrigue >= 4
					learning >= 4
				}
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_intelligence
		}
		
		name = EVTOPTH_SOH_6700 # Bless my mind, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6714 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				is_smart_trigger = no
			}
			
			mult_modifier = {
				factor = 0.01
				is_dumb_trigger = no
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = dragon_boon_rulership
			has_regent = no
		}
		
		name = EVTOPTI_SOH_6700 # Bless my rule, oh mighty dragon!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.01
						has_character_flag = small_dragon_dance # Likely to fail
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = two_dragon_dance
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_5
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_4
					}
					
					character_event = { id = soh.6716 days = 1 }
				}
				
				50 = {
					mult_modifier = {
						factor = 100
						is_devil_worshiper_trigger = yes # The dragon knows...
					}
					
					mult_modifier = {
						factor = 0.01
						has_character_flag = nine_dragon_dance # Likely to succeed
					}
					
					mult_modifier = {
						factor = 2
						has_character_modifier = mandate_of_heaven_2
					}
					
					mult_modifier = {
						factor = 5
						has_character_modifier = mandate_of_heaven_1
					}
					
					character_event = { id = soh.6718 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				real_tier = emperor
			}
		}
	}
	
	after = {
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			narrative_event = { id = soh.6701 } # Inform vassals that the dragon arrived
		}
	}
}

# Inform vassals
narrative_event = {
	id = soh.6701
	title = EVTTITLE_SOH_6701
	desc = EVTDESC_SOH_6701
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6701 # Truly an auspicious day!
	}
}

# Boon bestowed - military power
character_event = {
	id = soh.6702
	desc = EVTDESC_SOH_6702
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6702 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				OR = {
					has_education_martial_trigger = no
					trait = brilliant_strategist
				}
			}
			
			add_character_modifier = {
				modifier = dragon_boon_martial
				days = 3650
			}
		}
		
		else = {
			upgrade_education_effect = yes
		}
		
		prestige = 100
		
		piety = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6703 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6703
	desc = EVTDESC_SOH_6703
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6703 # A powerful boon indeed!
	}
}

# Boon bestowed - strength
character_event = {
	id = soh.6704
	desc = EVTDESC_SOH_6704
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6704 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				is_weak_trigger = yes
			}
			
			remove_trait = weak
			remove_trait = frail
		}
		
		else = {
			remove_trait = brawny
			add_trait = strong
		}
		
		prestige = 100
		
		piety = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6705 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6705
	desc = EVTDESC_SOH_6705
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6705 # A powerful boon indeed!
	}
}

# Boon bestowed - good health
character_event = {
	id = soh.6706
	desc = EVTDESC_SOH_6706
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6706 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				is_ill = no
				is_maimed_trigger = no
			}
			
			add_character_modifier = {
				modifier = dragon_boon_health
				days = 3650
			}
		}
		
		if = {
			limit = {
				is_ill = yes
			}
			
			remove_random_disease_effect = yes
			remove_random_epidemic_disease_effect = yes
			remove_symptoms_effect = yes
		}
		
		if = {
			limit = {
				is_maimed_trigger  = yes
			}
			
			remove_random_maimed_effect = yes
		}
		
		prestige = 100
		
		piety = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6707 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6707
	desc = EVTDESC_SOH_6707
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6707 # A powerful boon indeed!
	}
}

# Boon bestowed - fertility
character_event = {
	id = soh.6708
	desc = EVTDESC_SOH_6708
	picture =GFX_evt_china_golden_age
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6708 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				trait = eunuch
			}
			
			remove_trait = eunuch
		}
		
		else_if = {
			limit = {
				trait = chaste
			}
			
			remove_trait_chaste_effect = yes
		}
		
		else_if = {
			limit = {
				NOT = {
					trait = lustful
				}
			}
			
			add_trait_lustful_effect = yes
		}
		
		else = {
			add_character_modifier = {
				modifier = dragon_boon_fertility
				days = 3650
			}
		}
		
		prestige = 100
		
		piety = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6709 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6709
	desc = EVTDESC_SOH_6709
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6709 # A powerful boon indeed!
	}
}

# Boon bestowed - prosperity
character_event = {
	id = soh.6710
	desc = EVTDESC_SOH_6710
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6710 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				has_dlc = "Reapers"
				any_demesne_province = {
					OR = {
						has_province_modifier = depopulated_1
						has_province_modifier = depopulated_2
						has_province_modifier = depopulated_3
					}
				}
			}
			
			any_demesne_province = {
				limit = {
					OR = {
						has_province_modifier = depopulated_1
						has_province_modifier = depopulated_2
						has_province_modifier = depopulated_3
					}
				}
				decrease_depopulation_effect = yes
			}
		}
		
		else_if = {
			limit = {
				has_dlc = "Reapers"
				any_demesne_province = {
					NOT = {
						has_province_modifier = prosperity_modifier_3
					}
				}
			}
			
			any_demesne_province = {
				limit = {
					NOT = {
						has_province_modifier = prosperity_modifier_3
					}
				}
				increase_prosperity_effect = yes
			}
		}
		
		else = {
			wealth = 1000
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6711 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6711
	desc = EVTDESC_SOH_6711
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6711 # A powerful boon indeed!
	}
}

# Boon bestowed - wisdom
character_event = {
	id = soh.6712
	desc = EVTDESC_SOH_6712
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6712 # Thank you, oh mighty dragon!
		
		# Order is Learning > Stewardship > Diplomacy > Intrigue > Martial
		if = {
			limit = {
				learning < 8
			}
			
			change_learning = 4
		}
		
		else_if = {
			limit = {
				stewardship < 8
			}
			
			change_stewardship = 4
		}
		
		else_if = {
			limit = {
				diplomacy < 8
			}
			
			change_diplomacy = 4
		}
		
		else_if = {
			limit = {
				intrigue < 8
			}
			
			change_intrigue = 4
		}
		
		else_if = {
			limit = {
				martial < 8
			}
			
			change_martial = 4
		}
		
		else = {
			random_list = {
				20 = {
					mult_modifier = {
						factor = 0.01
						diplomacy >= 25
					}
					
					change_diplomacy = 4
				}
				
				20 = {
					mult_modifier = {
						factor = 0.01
						martial >= 25
					}
					
					change_martial = 4
				}
				
				20 = {
					mult_modifier = {
						factor = 0.01
						stewardship >= 25
					}
					
					change_stewardship = 4
				}
				
				20 = {
					mult_modifier = {
						factor = 0.01
						intrigue >= 25
					}
					change_intrigue = 4
				}
				
				20 = {
					mult_modifier = {
						factor = 0.01
						learning >= 25
					}
					change_learning = 4
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6713 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6713
	desc = EVTDESC_SOH_6713
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6713 # A powerful boon indeed!
	}
}

# Boon bestowed - intelligence
character_event = {
	id = soh.6714
	desc = EVTDESC_SOH_6714
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6714 # Thank you, oh mighty dragon!
		
		if = {
			limit = {
				OR = {
					trait = quick
					trait = shrewd
				}
			}
			
			remove_trait = quick
			remove_trait = shrewd
			add_trait = genius
		}
		
		else_if = {
			limit = {
				is_dumb_trigger = no
			}
			
			add_trait = quick
		}
		
		else_if = {
			limit = {
				OR = {
					trait = slow
					trait = dull
				}
			}
			
			remove_trait = slow
			remove_trait = dull
		}
		
		else = {
			remove_trait = imbecile
			add_trait = slow
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			character_event = { id = soh.6715 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6715
	desc = EVTDESC_SOH_6715
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6715 # A powerful boon indeed!
	}
}

# Boon bestowed - rulership blessing
character_event = {
	id = soh.6716
	desc = EVTDESC_SOH_6716
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6716 # Thank you, oh mighty dragon!
		
		hidden_tooltip = {
			if = {
				limit = {
					government = chinese_imperial_government
				}
		
				mandate_boost_medium_effect = yes
			}
		}
		
		add_character_modifier = {
			modifier = dragon_boon_rulership
			days = 3650
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6717 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6717
	desc = EVTDESC_SOH_6717
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6717 # A powerful boon indeed!
	}
}

# Declared unworthy of boon
character_event = {
	id = soh.6718
	desc = EVTDESC_SOH_6718
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6718 # B-b-but why...?
		
		hidden_tooltip = {
			if = {
				limit = {
					government = chinese_imperial_government
				}
		
				mandate_penalty_medium_effect = yes
			}
		}
		
		prestige = -100
		
		piety = -100
		
		add_character_modifier = {
			modifier = unworthy_of_dragon_boon
			days = 3650
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6719 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6719
	desc = EVTDESC_SOH_6719
	picture =GFX_evt_china_unrest
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6719 # Unworthy? Ha!
	}
}

### Silver dragon (Icava, the Champion of Justice)

# Silver dragon sighted
character_event = {
	id = soh.6720
	desc = EVTDESC_SOH_6720
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6720 # Maybe it was just a bird...
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6721 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6721
	desc = EVTDESC_SOH_6721
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6721 # Maybe it was just a bird...
	}
}

# Silver dragon flyby
character_event = {
	id = soh.6722
	desc = EVTDESC_SOH_6722
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6722 # Worrisome...
		
		if = {
			limit = {
				OR = {
					AND = {
						is_evil_trigger = yes
						has_vice_trigger = yes
					}
					is_devil_worshiper_trigger = yes
				}
			}
			
			random = {
				chance = 25
				add_trait_stressed_effect = yes
			}
			
			if = {
				limit = {
					is_adult = yes
				}
				
				random = {
					chance = 25
					add_trait_fully_paranoid_effect = yes
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6723 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6723
	desc = EVTDESC_SOH_6723
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6723 # Worrisome...
		
		if = {
			limit = {
				OR = {
					AND = {
						is_evil_trigger = yes
						has_vice_trigger = yes
					}
					is_devil_worshiper_trigger = yes
				}
			}
			
			random = {
				chance = 25
				add_trait_stressed_effect = yes
			}
			
			if = {
				limit = {
					is_adult = yes
				}
				
				random = {
					chance = 25
					add_trait_fully_paranoid_effect = yes
				}
			}
		}
	}
}

# Silver dragon driven off
character_event = {
	id = soh.6724
	desc = EVTDESC_SOH_6724
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6724 # Probably for the best...
		
		prestige = 50
		
		piety = -50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6725 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6725
	desc = EVTDESC_SOH_6725
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6725 # Probably for the best...
	}
}

# Silver dragon angered by being attacked
narrative_event = {
	id = soh.6726
	title = EVTTITLE_SOH_6726
	desc = EVTDESC_SOH_6726
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6726 # There's been a misunderstanding!
		
		hidden_tooltip = {
			random_list = {
				50 = {
					trigger = {
						diplomacy >= 10
						NOR = {
							AND = {
								is_evil_trigger = yes
								has_vice_trigger = yes
							}
							is_devil_worshiper_trigger = yes
						}
					}
					
					mult_modifier = {
						factor = 0.8
						diplomacy < 20
					}
					
					mult_modifier = {
						factor = 0.8
						diplomacy < 15
					}
					
					character_event = { id = soh.6728 days = 1 } # Diplomacy succeeded
				}
				
				50 = {
					character_event = { id = soh.6730 days = 1 } # Diplomacy barely succeeded
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = gregarious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				any_artifact = {
					has_flag = dragonslayer
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6726 # Let's fight, then!
		
		pacifists_lose_piety_effect = yes
		
		hidden_tooltip = {
			random_list = {
				1 = { # Critical success
					character_event = { id = soh.6732 days = 1 }
				}
				18 = {
					set_character_flag = dragon_combat_undecided
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					character_event = { id = soh.6734 days = 1 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								is_evil_trigger = yes
								has_vice_trigger = yes
							}
							is_devil_worshiper_trigger = yes
						}
					}
					
					change_variable = {
						which = d20
						value = -10 # Detects as Evil, so certain things will help in combat...
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 25 # Intentionally easier to defeat than Fredak
						}
					}

					character_event = { id = soh.6732 days = 1 } # Victory
				}
				
				else = {
					# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
					if = {
						limit = {
							combat_rating >= 500
						}
						change_variable = {
							which = d20
							value = 50
						}
					}
					else_if = {
						limit = {
							combat_rating >= 490
						}
						change_variable = {
							which = d20
							value = 49
						}
					}
					else_if = {
						limit = {
							combat_rating >= 480
						}
						change_variable = {
							which = d20
							value = 48
						}
					}
					else_if = {
						limit = {
							combat_rating >= 470
						}
						change_variable = {
							which = d20
							value = 47
						}
					}
					else_if = {
						limit = {
							combat_rating >= 460
						}
						change_variable = {
							which = d20
							value = 46
						}
					}
					else_if = {
						limit = {
							combat_rating >= 450
						}
						change_variable = {
							which = d20
							value = 45
						}
					}
					else_if = {
						limit = {
							combat_rating >= 440
						}
						change_variable = {
							which = d20
							value = 44
						}
					}
					else_if = {
						limit = {
							combat_rating >= 430
						}
						change_variable = {
							which = d20
							value = 43
						}
					}
					else_if = {
						limit = {
							combat_rating >= 420
						}
						change_variable = {
							which = d20
							value = 42
						}
					}
					else_if = {
						limit = {
							combat_rating >= 410
						}
						change_variable = {
							which = d20
							value = 41
						}
					}
					else_if = {
						limit = {
							combat_rating >= 400
						}
						change_variable = {
							which = d20
							value = 40
						}
					}
					else_if = {
						limit = {
							combat_rating >= 390
						}
						change_variable = {
							which = d20
							value = 39
						}
					}
					else_if = {
						limit = {
							combat_rating >= 380
						}
						change_variable = {
							which = d20
							value = 38
						}
					}
					else_if = {
						limit = {
							combat_rating >= 370
						}
						change_variable = {
							which = d20
							value = 37
						}
					}
					else_if = {
						limit = {
							combat_rating >= 360
						}
						change_variable = {
							which = d20
							value = 36
						}
					}
					else_if = {
						limit = {
							combat_rating >= 350
						}
						change_variable = {
							which = d20
							value = 35
						}
					}
					else_if = {
						limit = {
							combat_rating >= 340
						}
						change_variable = {
							which = d20
							value = 34
						}
					}
					else_if = {
						limit = {
							combat_rating >= 330
						}
						change_variable = {
							which = d20
							value = 33
						}
					}
					else_if = {
						limit = {
							combat_rating >= 320
						}
						change_variable = {
							which = d20
							value = 32
						}
					}
					else_if = {
						limit = {
							combat_rating >= 310
						}
						change_variable = {
							which = d20
							value = 31
						}
					}
					else_if = {
						limit = {
							combat_rating >= 300
						}
						change_variable = {
							which = d20
							value = 30
						}
					}
					else_if = {
						limit = {
							combat_rating >= 290
						}
						change_variable = {
							which = d20
							value = 29
						}
					}
					else_if = {
						limit = {
							combat_rating >= 280
						}
						change_variable = {
							which = d20
							value = 28
						}
					}
					else_if = {
						limit = {
							combat_rating >= 270
						}
						change_variable = {
							which = d20
							value = 27
						}
					}
					else_if = {
						limit = {
							combat_rating >= 260
						}
						change_variable = {
							which = d20
							value = 26
						}
					}
					else_if = {
						limit = {
							combat_rating >= 250
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							combat_rating >= 240
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							combat_rating >= 230
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							combat_rating >= 220
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							combat_rating >= 210
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							combat_rating >= 200
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							combat_rating >= 190
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							combat_rating >= 180
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							combat_rating >= 170
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							combat_rating >= 160
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							combat_rating >= 150
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							combat_rating >= 140
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							combat_rating >= 130
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							combat_rating >= 120
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							combat_rating >= 110
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							combat_rating >= 100
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							combat_rating >= 90
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							combat_rating >= 80
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							combat_rating >= 70
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							combat_rating >= 60
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							combat_rating >= 50
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							combat_rating >= 40
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							combat_rating >= 30
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							combat_rating >= 20
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							combat_rating >= 10
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					
					# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
					if = {
						limit = {
							martial >= 50
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							martial >= 48
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							martial >= 46
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							martial >= 44
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							martial >= 42
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							martial >= 40
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							martial >= 38
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							martial >= 36
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							martial >= 34
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							martial >= 32
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							martial >= 30
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							martial >= 28
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							martial >= 26
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							martial >= 24
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							martial >= 22
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							martial >= 20
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							martial >= 18
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							martial >= 16
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							martial >= 14
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							martial >= 12
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							martial >= 10
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							martial >= 8
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							martial >= 6
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							martial >= 4
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							martial >= 2
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					
					if = {
						limit = {
							check_variable = {
								which = d20
								value >= 25 # Intentionally easier to defeat than Fredak
							}
						}
						
						character_event = { id = soh.6732 days = 1 } # Victory 
					}
					
					else = {
						character_event = { id = soh.6734 days = 1 } # Defeat
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				is_benevolent_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_pleasant_trait_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_pious_trait_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_virtue_trigger = yes
			}
		}
	}
	
	option = {
		trigger = {
			is_devil_worshiper_trigger = yes
		}
		
		name = EVTOPTC_SOH_6726 # I am more powerful than you think!
		
		pacifists_lose_piety_effect = yes
		
		custom_tooltip = {
			text = use_dark_power_if_necessary
		}
		
		hidden_tooltip = {
			random_list = {
				1 = { # Critical success
					character_event = { id = soh.6732 days = 1 } # Victory
				}
				18 = {
					set_character_flag = dragon_combat_undecided
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					character_event = { id = soh.6734 days = 1 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								is_evil_trigger = yes
								has_vice_trigger = yes
							}
							is_devil_worshiper_trigger = yes
						}
					}
					change_variable = {
						which = d20
						value = -10 # Detects as Evil, so certain things will help in combat...
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 25 # Intentionally easier to defeat than Fredak
						}
					}
					
					character_event = { id = soh.6732 days = 1 } # Victory
				}
				
				else = {
					# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
					if = {
						limit = {
							combat_rating >= 500
						}
						change_variable = {
							which = d20
							value = 50
						}
					}
					else_if = {
						limit = {
							combat_rating >= 490
						}
						change_variable = {
							which = d20
							value = 49
						}
					}
					else_if = {
						limit = {
							combat_rating >= 480
						}
						change_variable = {
							which = d20
							value = 48
						}
					}
					else_if = {
						limit = {
							combat_rating >= 470
						}
						change_variable = {
							which = d20
							value = 47
						}
					}
					else_if = {
						limit = {
							combat_rating >= 460
						}
						change_variable = {
							which = d20
							value = 46
						}
					}
					else_if = {
						limit = {
							combat_rating >= 450
						}
						change_variable = {
							which = d20
							value = 45
						}
					}
					else_if = {
						limit = {
							combat_rating >= 440
						}
						change_variable = {
							which = d20
							value = 44
						}
					}
					else_if = {
						limit = {
							combat_rating >= 430
						}
						change_variable = {
							which = d20
							value = 43
						}
					}
					else_if = {
						limit = {
							combat_rating >= 420
						}
						change_variable = {
							which = d20
							value = 42
						}
					}
					else_if = {
						limit = {
							combat_rating >= 410
						}
						change_variable = {
							which = d20
							value = 41
						}
					}
					else_if = {
						limit = {
							combat_rating >= 400
						}
						change_variable = {
							which = d20
							value = 40
						}
					}
					else_if = {
						limit = {
							combat_rating >= 390
						}
						change_variable = {
							which = d20
							value = 39
						}
					}
					else_if = {
						limit = {
							combat_rating >= 380
						}
						change_variable = {
							which = d20
							value = 38
						}
					}
					else_if = {
						limit = {
							combat_rating >= 370
						}
						change_variable = {
							which = d20
							value = 37
						}
					}
					else_if = {
						limit = {
							combat_rating >= 360
						}
						change_variable = {
							which = d20
							value = 36
						}
					}
					else_if = {
						limit = {
							combat_rating >= 350
						}
						change_variable = {
							which = d20
							value = 35
						}
					}
					else_if = {
						limit = {
							combat_rating >= 340
						}
						change_variable = {
							which = d20
							value = 34
						}
					}
					else_if = {
						limit = {
							combat_rating >= 330
						}
						change_variable = {
							which = d20
							value = 33
						}
					}
					else_if = {
						limit = {
							combat_rating >= 320
						}
						change_variable = {
							which = d20
							value = 32
						}
					}
					else_if = {
						limit = {
							combat_rating >= 310
						}
						change_variable = {
							which = d20
							value = 31
						}
					}
					else_if = {
						limit = {
							combat_rating >= 300
						}
						change_variable = {
							which = d20
							value = 30
						}
					}
					else_if = {
						limit = {
							combat_rating >= 290
						}
						change_variable = {
							which = d20
							value = 29
						}
					}
					else_if = {
						limit = {
							combat_rating >= 280
						}
						change_variable = {
							which = d20
							value = 28
						}
					}
					else_if = {
						limit = {
							combat_rating >= 270
						}
						change_variable = {
							which = d20
							value = 27
						}
					}
					else_if = {
						limit = {
							combat_rating >= 260
						}
						change_variable = {
							which = d20
							value = 26
						}
					}
					else_if = {
						limit = {
							combat_rating >= 250
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							combat_rating >= 240
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							combat_rating >= 230
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							combat_rating >= 220
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							combat_rating >= 210
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							combat_rating >= 200
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							combat_rating >= 190
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							combat_rating >= 180
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							combat_rating >= 170
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							combat_rating >= 160
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							combat_rating >= 150
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							combat_rating >= 140
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							combat_rating >= 130
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							combat_rating >= 120
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							combat_rating >= 110
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							combat_rating >= 100
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							combat_rating >= 90
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							combat_rating >= 80
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							combat_rating >= 70
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							combat_rating >= 60
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							combat_rating >= 50
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							combat_rating >= 40
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							combat_rating >= 30
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							combat_rating >= 20
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							combat_rating >= 10
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
					if = {
						limit = {
							martial >= 50
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							martial >= 48
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							martial >= 46
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							martial >= 44
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							martial >= 42
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							martial >= 40
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							martial >= 38
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							martial >= 36
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							martial >= 34
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							martial >= 32
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							martial >= 30
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							martial >= 28
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							martial >= 26
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							martial >= 24
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							martial >= 22
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							martial >= 20
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							martial >= 18
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							martial >= 16
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							martial >= 14
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							martial >= 12
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							martial >= 10
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							martial >= 8
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							martial >= 6
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							martial >= 4
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							martial >= 2
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					
					if = {
						limit = {
							check_variable = {
								which = d20
								value >= 25 # Intentionally easier to defeat than Fredak
							}
						}
						
						character_event = { id = soh.6734 days = 1 } # Victory
					}
					
					else = {
						increase_visibility_effect = yes
						
						if = {
							limit = {
								society_currency >= 1000
							}
							change_variable = {
								which = d20
								value = 10
							}
							change_society_currency = -1000
						}
						else_if = {
							limit = {
								society_currency >= 900
							}
							change_variable = {
								which = d20
								value = 9
							}
							change_society_currency = -900
						}
						else_if = {
							limit = {
								society_currency >= 800
							}
							change_variable = {
								which = d20
								value = 8
							}
							change_society_currency = -800
						}
						else_if = {
							limit = {
								society_currency >= 700
							}
							change_variable = {
								which = d20
								value = 7
							}
							change_society_currency = -700
						}
						else_if = {
							limit = {
								society_currency >= 600
							}
							change_variable = {
								which = d20
								value = 6
							}
							change_society_currency = -600
						}
						else_if = {
							limit = {
								society_currency >= 500
							}
							change_variable = {
								which = d20
								value = 5
							}
							change_society_currency = -500
						}
						else_if = {
							limit = {
								society_currency >= 400
							}
							change_variable = {
								which = d20
								value = 4
							}
							change_society_currency = -400
						}
						else_if = {
							limit = {
								society_currency >= 300
							}
							change_variable = {
								which = d20
								value = 3
							}
							change_society_currency = -300
						}
						else_if = {
							limit = {
								society_currency >= 200
							}
							change_variable = {
								which = d20
								value = 2
							}
							change_society_currency = -200
						}
						else_if = {
							limit = {
								society_currency >= 100
							}
							change_variable = {
								which = d20
								value = 1
							}
							change_society_currency = -100
						}
						
						if = {
							limit = {
								check_variable = {
									which = d20
									value >= 25 # Intentionally easier to defeat than Fredak
								}
							}
							
							character_event = { id = soh.6732 days = 1 } # Victory
						}
						
						else = {
							character_event = { id = soh.6734 days = 1 } # Victory
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				is_benevolent_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_pleasant_trait_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_pious_trait_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				has_virtue_trigger = yes
			}
		}
	}
	
	after = {
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				OR = {
					ai = no
					event_target:smite_evil_target = {
						character = ROOT
					}
				}
			}
			
			narrative_event = { id = soh.6727 }
		}
	}
}

# Inform vassals
narrative_event = {
	id = soh.6727
	title = EVTTITLE_SOH_6727
	desc = EVTDESC_SOH_6727
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:smite_evil_target = {
				character = ROOT
			}
		}
		
		name = EVTOPTA_SOH_6727 # Is she here for me...?
		
		random = {
			chance = 25
			add_trait_stressed_effect = yes
		}
		
		if = {
			limit = {
				is_adult = yes
			}
			
			random = {
				chance = 25
				add_trait_fully_paranoid_effect = yes
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				event_target:smite_evil_target = {
					character = ROOT
				}
			}
		}
		
		name = EVTOPTB_SOH_6727 # Who might that evildoer be...?
	}
}

# Diplomacy worked
character_event = {
	id = soh.6728
	desc = EVTDESC_SOH_6728
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6728 # Great!
		
		prestige = 100
		
		piety = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			character_event = { id = soh.6729 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform vassals
character_event = {
	id = soh.6729
	desc = EVTDESC_SOH_6729
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6729 # Great!
	}
}

# Diplomacy barely accepted
character_event = {
	id = soh.6730
	desc = EVTDESC_SOH_6730
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6730 # Could be worse...
		
		prestige = -50
		
		piety = 10
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			character_event = { id = soh.6731 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform vassals
character_event = {
	id = soh.6731
	desc = EVTDESC_SOH_6731
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6731 # Could be worse...
	}
}

# Fight successful, dragon chooses better part of valor
character_event = {
	id = soh.6732
	desc = EVTDESC_SOH_6732
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6732 # Good riddance!
		
		prestige = 200
		
		piety = -100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6733 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform vassals
character_event = {
	id = soh.6733
	desc = EVTDESC_SOH_6733
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6733 # Good riddance!
	}
}

# Fight goes poorly, wounded/maimed
character_event = {
	id = soh.6734
	desc = EVTDESC_SOH_6734
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6734 # Good riddance!
		
		random_list = {
			25 = {
				add_trait_wounded_effect = yes
			}
			75 = {
				add_maimed_trait_effect = yes
			}
		}
		
		prestige = -100
		
		piety = -100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6735 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform vassals
character_event = {
	id = soh.6735
	desc = EVTDESC_SOH_6735
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				event_target:smite_evil_target = {
					character = ROOT
				}
			}
		}
		
		name = EVTOPTA_SOH_6729 # Could have been worse...
	}
	
	option = {
		trigger = {
			event_target:smite_evil_target = {
				character = ROOT
			}
		}
		
		name = EVTOPTB_SOH_6735 # Better FROM than me...
	}
}

# Silver dragon challenges evildoer - liege
narrative_event = {
	id = soh.6736
	title = EVTTITLE_SOH_6736
	desc = EVTDESC_SOH_6736
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	is_triggered_only = yes
	
	immediate = {
		event_target:smite_evil_target = {
			narrative_event = { id = soh.6738 } # Evildoer informed right away
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6736 # This should be interesting...
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
				NOT = {
					event_target:smite_evil_target = {
						character = PREV
					}
				}
			}
			
			narrative_event = { id = soh.6737 } # Inform other vassals
		}
	}
}

# Silver dragon challenges evildoer - other vassals
narrative_event = {
	id = soh.6737
	title = EVTTITLE_SOH_6737
	desc = EVTDESC_SOH_6737
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6737 # This should be interesting...
	}
}

# Silver dragon challenges evildoer - evildoer
narrative_event = {
	id = soh.6738
	title = EVTTITLE_SOH_6738
	desc = EVTDESC_SOH_6738
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				ai = no
				is_devil_worshiper_trigger = no # It is a fight to the death for the evildoer; DWs should go for the event that gives them an advantage, even if it might expose them
			}
		}
		
		name = EVTOPTA_SOH_6738 # Let's fight, then!
		
		hidden_tooltip = {
			random_list = {
				1 = { # Critical success
					character_event = { id = soh.6739 days = 1 } # Victory
				}
				18 = {
					set_character_flag = dragon_combat_undecided
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					character_event = { id = soh.6741 days = 1 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								is_evil_trigger = yes
								has_vice_trigger = yes
							}
							is_devil_worshiper_trigger = yes
						}
					}
					change_variable = {
						which = d20
						value = -10 # Detects as Evil, so certain things will help in combat...
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 25 # Intentionally easier to defeat than Fredak
						}
					}
					
					character_event = { id = soh.6739 days = 1 } # Victory
				}
				
				else = {
					# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
					if = {
						limit = {
							combat_rating >= 500
						}
						change_variable = {
							which = d20
							value = 50
						}
					}
					else_if = {
						limit = {
							combat_rating >= 490
						}
						change_variable = {
							which = d20
							value = 49
						}
					}
					else_if = {
						limit = {
							combat_rating >= 480
						}
						change_variable = {
							which = d20
							value = 48
						}
					}
					else_if = {
						limit = {
							combat_rating >= 470
						}
						change_variable = {
							which = d20
							value = 47
						}
					}
					else_if = {
						limit = {
							combat_rating >= 460
						}
						change_variable = {
							which = d20
							value = 46
						}
					}
					else_if = {
						limit = {
							combat_rating >= 450
						}
						change_variable = {
							which = d20
							value = 45
						}
					}
					else_if = {
						limit = {
							combat_rating >= 440
						}
						change_variable = {
							which = d20
							value = 44
						}
					}
					else_if = {
						limit = {
							combat_rating >= 430
						}
						change_variable = {
							which = d20
							value = 43
						}
					}
					else_if = {
						limit = {
							combat_rating >= 420
						}
						change_variable = {
							which = d20
							value = 42
						}
					}
					else_if = {
						limit = {
							combat_rating >= 410
						}
						change_variable = {
							which = d20
							value = 41
						}
					}
					else_if = {
						limit = {
							combat_rating >= 400
						}
						change_variable = {
							which = d20
							value = 40
						}
					}
					else_if = {
						limit = {
							combat_rating >= 390
						}
						change_variable = {
							which = d20
							value = 39
						}
					}
					else_if = {
						limit = {
							combat_rating >= 380
						}
						change_variable = {
							which = d20
							value = 38
						}
					}
					else_if = {
						limit = {
							combat_rating >= 370
						}
						change_variable = {
							which = d20
							value = 37
						}
					}
					else_if = {
						limit = {
							combat_rating >= 360
						}
						change_variable = {
							which = d20
							value = 36
						}
					}
					else_if = {
						limit = {
							combat_rating >= 350
						}
						change_variable = {
							which = d20
							value = 35
						}
					}
					else_if = {
						limit = {
							combat_rating >= 340
						}
						change_variable = {
							which = d20
							value = 34
						}
					}
					else_if = {
						limit = {
							combat_rating >= 330
						}
						change_variable = {
							which = d20
							value = 33
						}
					}
					else_if = {
						limit = {
							combat_rating >= 320
						}
						change_variable = {
							which = d20
							value = 32
						}
					}
					else_if = {
						limit = {
							combat_rating >= 310
						}
						change_variable = {
							which = d20
							value = 31
						}
					}
					else_if = {
						limit = {
							combat_rating >= 300
						}
						change_variable = {
							which = d20
							value = 30
						}
					}
					else_if = {
						limit = {
							combat_rating >= 290
						}
						change_variable = {
							which = d20
							value = 29
						}
					}
					else_if = {
						limit = {
							combat_rating >= 280
						}
						change_variable = {
							which = d20
							value = 28
						}
					}
					else_if = {
						limit = {
							combat_rating >= 270
						}
						change_variable = {
							which = d20
							value = 27
						}
					}
					else_if = {
						limit = {
							combat_rating >= 260
						}
						change_variable = {
							which = d20
							value = 26
						}
					}
					else_if = {
						limit = {
							combat_rating >= 250
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							combat_rating >= 240
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							combat_rating >= 230
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							combat_rating >= 220
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							combat_rating >= 210
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							combat_rating >= 200
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							combat_rating >= 190
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							combat_rating >= 180
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							combat_rating >= 170
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							combat_rating >= 160
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							combat_rating >= 150
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							combat_rating >= 140
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							combat_rating >= 130
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							combat_rating >= 120
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							combat_rating >= 110
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							combat_rating >= 100
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							combat_rating >= 90
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							combat_rating >= 80
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							combat_rating >= 70
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							combat_rating >= 60
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							combat_rating >= 50
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							combat_rating >= 40
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							combat_rating >= 30
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							combat_rating >= 20
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							combat_rating >= 10
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
					if = {
						limit = {
							martial >= 50
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							martial >= 48
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							martial >= 46
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							martial >= 44
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							martial >= 42
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							martial >= 40
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							martial >= 38
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							martial >= 36
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							martial >= 34
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							martial >= 32
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							martial >= 30
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							martial >= 28
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							martial >= 26
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							martial >= 24
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							martial >= 22
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							martial >= 20
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							martial >= 18
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							martial >= 16
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							martial >= 14
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							martial >= 12
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							martial >= 10
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							martial >= 8
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							martial >= 6
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							martial >= 4
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							martial >= 2
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					
					if = {
						limit = {
							check_variable = {
								which = d20
								value = 25 # Intentionally easier to defeat than Fredak
							}
						}
						
						character_event = { id = soh.6739 days = 1 } # Victory
					}
					
					else = {
						character_event = { id = soh.6741 days = 1 } # Defeat
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			is_devil_worshiper_trigger = yes
		}
		
		name = EVTOPTB_SOH_6738 # I am more powerful than you think!
		
		custom_tooltip = {
			text = use_dark_power_if_necessary
		}
		
		hidden_tooltip = {
			random_list = {
				1 = { # Critical success
					character_event = { id = soh.6739 days = 1 } # Victory
				}
				18 = {
					set_character_flag = dragon_combat_undecided
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					character_event = { id = soh.6741 days = 1 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								is_evil_trigger = yes
								has_vice_trigger = yes
							}
							is_devil_worshiper_trigger = yes
						}
					}
					change_variable = {
						which = d20
						value = -10 # Detects as Evil, so certain things will help in combat...
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 25 # Intentionally easier to defeat than Fredak
						}
					}
					
					character_event = { id = soh.6739 days = 1 } # Victory
				}
				
				else = {
					# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
					if = {
						limit = {
							combat_rating >= 500
						}
						change_variable = {
							which = d20
							value = 50
						}
					}
					else_if = {
						limit = {
							combat_rating >= 490
						}
						change_variable = {
							which = d20
							value = 49
						}
					}
					else_if = {
						limit = {
							combat_rating >= 480
						}
						change_variable = {
							which = d20
							value = 48
						}
					}
					else_if = {
						limit = {
							combat_rating >= 470
						}
						change_variable = {
							which = d20
							value = 47
						}
					}
					else_if = {
						limit = {
							combat_rating >= 460
						}
						change_variable = {
							which = d20
							value = 46
						}
					}
					else_if = {
						limit = {
							combat_rating >= 450
						}
						change_variable = {
							which = d20
							value = 45
						}
					}
					else_if = {
						limit = {
							combat_rating >= 440
						}
						change_variable = {
							which = d20
							value = 44
						}
					}
					else_if = {
						limit = {
							combat_rating >= 430
						}
						change_variable = {
							which = d20
							value = 43
						}
					}
					else_if = {
						limit = {
							combat_rating >= 420
						}
						change_variable = {
							which = d20
							value = 42
						}
					}
					else_if = {
						limit = {
							combat_rating >= 410
						}
						change_variable = {
							which = d20
							value = 41
						}
					}
					else_if = {
						limit = {
							combat_rating >= 400
						}
						change_variable = {
							which = d20
							value = 40
						}
					}
					else_if = {
						limit = {
							combat_rating >= 390
						}
						change_variable = {
							which = d20
							value = 39
						}
					}
					else_if = {
						limit = {
							combat_rating >= 380
						}
						change_variable = {
							which = d20
							value = 38
						}
					}
					else_if = {
						limit = {
							combat_rating >= 370
						}
						change_variable = {
							which = d20
							value = 37
						}
					}
					else_if = {
						limit = {
							combat_rating >= 360
						}
						change_variable = {
							which = d20
							value = 36
						}
					}
					else_if = {
						limit = {
							combat_rating >= 350
						}
						change_variable = {
							which = d20
							value = 35
						}
					}
					else_if = {
						limit = {
							combat_rating >= 340
						}
						change_variable = {
							which = d20
							value = 34
						}
					}
					else_if = {
						limit = {
							combat_rating >= 330
						}
						change_variable = {
							which = d20
							value = 33
						}
					}
					else_if = {
						limit = {
							combat_rating >= 320
						}
						change_variable = {
							which = d20
							value = 32
						}
					}
					else_if = {
						limit = {
							combat_rating >= 310
						}
						change_variable = {
							which = d20
							value = 31
						}
					}
					else_if = {
						limit = {
							combat_rating >= 300
						}
						change_variable = {
							which = d20
							value = 30
						}
					}
					else_if = {
						limit = {
							combat_rating >= 290
						}
						change_variable = {
							which = d20
							value = 29
						}
					}
					else_if = {
						limit = {
							combat_rating >= 280
						}
						change_variable = {
							which = d20
							value = 28
						}
					}
					else_if = {
						limit = {
							combat_rating >= 270
						}
						change_variable = {
							which = d20
							value = 27
						}
					}
					else_if = {
						limit = {
							combat_rating >= 260
						}
						change_variable = {
							which = d20
							value = 26
						}
					}
					else_if = {
						limit = {
							combat_rating >= 250
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							combat_rating >= 240
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							combat_rating >= 230
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							combat_rating >= 220
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							combat_rating >= 210
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							combat_rating >= 200
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							combat_rating >= 190
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							combat_rating >= 180
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							combat_rating >= 170
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							combat_rating >= 160
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							combat_rating >= 150
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							combat_rating >= 140
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							combat_rating >= 130
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							combat_rating >= 120
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							combat_rating >= 110
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							combat_rating >= 100
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							combat_rating >= 90
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							combat_rating >= 80
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							combat_rating >= 70
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							combat_rating >= 60
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							combat_rating >= 50
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							combat_rating >= 40
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							combat_rating >= 30
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							combat_rating >= 20
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							combat_rating >= 10
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
					if = {
						limit = {
							martial >= 50
						}
						change_variable = {
							which = d20
							value = 25
						}
					}
					else_if = {
						limit = {
							martial >= 48
						}
						change_variable = {
							which = d20
							value = 24
						}
					}
					else_if = {
						limit = {
							martial >= 46
						}
						change_variable = {
							which = d20
							value = 23
						}
					}
					else_if = {
						limit = {
							martial >= 44
						}
						change_variable = {
							which = d20
							value = 22
						}
					}
					else_if = {
						limit = {
							martial >= 42
						}
						change_variable = {
							which = d20
							value = 21
						}
					}
					else_if = {
						limit = {
							martial >= 40
						}
						change_variable = {
							which = d20
							value = 20
						}
					}
					else_if = {
						limit = {
							martial >= 38
						}
						change_variable = {
							which = d20
							value = 19
						}
					}
					else_if = {
						limit = {
							martial >= 36
						}
						change_variable = {
							which = d20
							value = 18
						}
					}
					else_if = {
						limit = {
							martial >= 34
						}
						change_variable = {
							which = d20
							value = 17
						}
					}
					else_if = {
						limit = {
							martial >= 32
						}
						change_variable = {
							which = d20
							value = 16
						}
					}
					else_if = {
						limit = {
							martial >= 30
						}
						change_variable = {
							which = d20
							value = 15
						}
					}
					else_if = {
						limit = {
							martial >= 28
						}
						change_variable = {
							which = d20
							value = 14
						}
					}
					else_if = {
						limit = {
							martial >= 26
						}
						change_variable = {
							which = d20
							value = 13
						}
					}
					else_if = {
						limit = {
							martial >= 24
						}
						change_variable = {
							which = d20
							value = 12
						}
					}
					else_if = {
						limit = {
							martial >= 22
						}
						change_variable = {
							which = d20
							value = 11
						}
					}
					else_if = {
						limit = {
							martial >= 20
						}
						change_variable = {
							which = d20
							value = 10
						}
					}
					else_if = {
						limit = {
							martial >= 18
						}
						change_variable = {
							which = d20
							value = 9
						}
					}
					else_if = {
						limit = {
							martial >= 16
						}
						change_variable = {
							which = d20
							value = 8
						}
					}
					else_if = {
						limit = {
							martial >= 14
						}
						change_variable = {
							which = d20
							value = 7
						}
					}
					else_if = {
						limit = {
							martial >= 12
						}
						change_variable = {
							which = d20
							value = 6
						}
					}
					else_if = {
						limit = {
							martial >= 10
						}
						change_variable = {
							which = d20
							value = 5
						}
					}
					else_if = {
						limit = {
							martial >= 8
						}
						change_variable = {
							which = d20
							value = 4
						}
					}
					else_if = {
						limit = {
							martial >= 6
						}
						change_variable = {
							which = d20
							value = 3
						}
					}
					else_if = {
						limit = {
							martial >= 4
						}
						change_variable = {
							which = d20
							value = 2
						}
					}
					else_if = {
						limit = {
							martial >= 2
						}
						change_variable = {
							which = d20
							value = 1
						}
					}
					
					if = {
						limit = {
							check_variable = {
								which = d20
								value >= 25 # Intentionally easier to defeat than Fredak
							}
						}
						
						character_event = { id = soh.6739 days = 1 } # Victory
					}
					
					else = {
						increase_visibility_effect = yes
						
						if = {
							limit = {
								society_currency >= 1000
							}
							change_variable = {
								which = d20
								value = 10
							}
							change_society_currency = -1000
						}
						else_if = {
							limit = {
								society_currency >= 900
							}
							change_variable = {
								which = d20
								value = 9
							}
							change_society_currency = -900
						}
						else_if = {
							limit = {
								society_currency >= 800
							}
							change_variable = {
								which = d20
								value = 8
							}
							change_society_currency = -800
						}
						else_if = {
							limit = {
								society_currency >= 700
							}
							change_variable = {
								which = d20
								value = 7
							}
							change_society_currency = -700
						}
						else_if = {
							limit = {
								society_currency >= 600
							}
							change_variable = {
								which = d20
								value = 6
							}
							change_society_currency = -600
						}
						else_if = {
							limit = {
								society_currency >= 500
							}
							change_variable = {
								which = d20
								value = 5
							}
							change_society_currency = -500
						}
						else_if = {
							limit = {
								society_currency >= 400
							}
							change_variable = {
								which = d20
								value = 4
							}
							change_society_currency = -400
						}
						else_if = {
							limit = {
								society_currency >= 300
							}
							change_variable = {
								which = d20
								value = 3
							}
							change_society_currency = -300
						}
						else_if = {
							limit = {
								society_currency >= 200
							}
							change_variable = {
								which = d20
								value = 2
							}
							change_society_currency = -200
						}
						else_if = {
							limit = {
								society_currency >= 100
							}
							change_variable = {
								which = d20
								value = 1
							}
							change_society_currency = -100
						}
						
						if = {
							limit = {
								check_variable = {
									which = d20
									value >= 25 # Intentionally easier to defeat than Fredak
								}
							}
							
							character_event = { id = soh.6739 days = 1 } # Victory
						}
						
						else = {
							character_event = { id = soh.6741 days = 1 } # Defeat
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Fight won - better part of valor
character_event = {
	id = soh.6739
	desc = EVTDESC_SOH_6739
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6739 # You'd better run!
		
		prestige = 200
		
		piety = -100
		
		FROMFROM = {
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.6740 } # Inform liege
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					ai = no
					NOT = {
						character = ROOT
					}
				}
				
				character_event = { id = soh.6740 } # Inform vassals
			}
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform others
character_event = {
	id = soh.6740
	desc = EVTDESC_SOH_6740
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6740 # Perhaps the dragon was wrong...?
	}
}

# Fight lost - death
character_event = {
	id = soh.6741
	desc = EVTDESC_SOH_6741
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6741 # Not like this!
		
		prestige = -200
		
		piety = -100
		
		FROMFROM = {
			if = {
				limit = {
					ai = no
				}
				
				character_event = { id = soh.6742 } # Inform liege
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
					ai = no
					NOT = {
						character = ROOT
					}
				}
				
				character_event = { id = soh.6742 } # Inform vassals
			}
		}
		
		death = {
			death_reason = death_good_dragon
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform others
character_event = {
	id = soh.6742
	desc = EVTDESC_SOH_6742
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6742 # Thus, always, to evil!
	}
}

# Silver dragon gifts you Gram
narrative_event = {
	id = soh.6743
	title = EVTTITLE_SOH_6743
	desc = EVTDESC_SOH_6743
	picture = GFX_evt_garden
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6743 # Thank you!
		
		prestige = 1000
		
		piety = 1000
		
		add_artifact = gram
		
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			narrative_event = { id = soh.6744 } # Inform other vassals
		}
	}
	
	after = {
		clr_global_flag = silver_dragon_active
	}
}

# Inform vassals
narrative_event = {
	id = soh.6744
	title = EVTTITLE_SOH_6744
	desc = EVTDESC_SOH_6744
	picture = GFX_evt_garden
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6744 # Interesting...
	}
}

### Red dragon (Fredak, the Emperor of Embers)

# Red dragon sighted
character_event = {
	id = soh.6745
	desc = EVTDESC_SOH_6745
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6745 # May it stay far away!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6746 } # Inform vassals
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6746
	desc = EVTDESC_SOH_6746
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6746 # May it stay far away!
	}
}

# Red dragon flyby
character_event = {
	id = soh.6747
	desc = EVTDESC_SOH_6747
	picture = GFX_evt_china_famine
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6747 # That was close...
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6748 } # Inform vassals
		}
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					random = {
						chance = 50
						decrease_prosperity_effect = yes
					}
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					random = {
						chance = 50
						if = {
							limit = {
								has_province_modifier = depopulated_1
							}
							remove_province_modifier = depopulated_1
							add_province_modifier = {
								name = depopulated_2
								duration = -1
							}
						}
						
						else_if = {
							limit = {
								has_province_modifier = depopulated_2
							}
							remove_province_modifier = depopulated_2
							add_province_modifier = {
								name = depopulated_3
								duration = -1
							}
						}
						
						else = {
							capital_holding = {
								destroy_random_building = yes
							}
						}
					}
				}
			}
		}
		
		else = {
			random = {
				chance = 50
				capital_scope = {
					capital_holding = {
						destroy_random_building = yes
					}
				}
			}
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 500
					}
				}
			}
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6748
	desc = EVTDESC_SOH_6748
	picture = GFX_evt_china_famine
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6748 # That was close...
	}
}

# Red dragon driven off
character_event = {
	id = soh.6749
	desc = EVTDESC_SOH_6749
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6749 # Almost reached us...
		
		clr_global_flag = dragon_injured
		set_global_flag = dragon_injured
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6750 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			character_event = { id = soh.6751 days = 30 } # Inform the world
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					random_list = {
						50 = {
							change_variable = {
								which = dragon_wounds
								value = 1
							}
						}
						25 = {
							change_variable = {
								which = dragon_wounds
								value = 2
							}
						}
						15 = {
							change_variable = {
								which = dragon_wounds
								value = 3
							}
						}
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 4
							}
						}
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 5
							}
						}
					}
					
					province_event = { id = tianxia.201 days = 180 random = 365 } # The dragon recovers from its wounds
				}
			}
		}
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					decrease_prosperity_effect = yes
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					if = {
						limit = {
							has_province_modifier = depopulated_1
						}
						remove_province_modifier = depopulated_1
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					
					else_if = {
						limit = {
							has_province_modifier = depopulated_2
						}
						remove_province_modifier = depopulated_2
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
					
					else = {
						capital_holding = {
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 500
					}
				}
			}
		}
	}
}

# Inform vassals
character_event = {
	id = soh.6750
	desc = EVTDESC_SOH_6750
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	war = no
	
	option = {
		name = EVTOPTA_SOH_6750 # Almost reached us...
	}
}

# Inform the world
character_event = {
	id = soh.6751
	desc = EVTDESC_SOH_6751
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6751 # Maybe the time to kill the beast is now...
	}
}

# Red dragon arrives - special first time event
narrative_event = {
	id = soh.6752
	title = EVTTITLE_SOH_6752
	desc = EVTDESC_SOH_6752
	picture = GFX_evt_burning_house # If there's an option between this and the Irminsul picture, that'd be nice...
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		#log = "Fredak, the Emperor of Embers, has arrived! COWER BEFORE HIS FURY!"
		
		capital_scope = {
			save_event_target_as = dragon_attack_capital
			random_province = {
				limit = {
					terrain = mountain
					NOT = {
						province = PREV
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						holding_type = tribal
					}
					owner = {
						ai = yes
					}
					distance = {
						where = PREV
						value >= 1000
					}
					distance = {
						where = PREV
						value < 2000
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
					}
					owner = {
						ai = yes
					}
					distance = {
						where = PREV
						value >= 1000
					}
					distance = {
						where = PREV
						value < 2000
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						holding_type = tribal
					}
					distance = {
						where = PREV
						value >= 1000
					}
					distance = {
						where = PREV
						value < 2000
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
					}
					distance = {
						where = PREV
						value >= 1000
					}
					distance = {
						where = PREV
						value < 2000
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						holding_type = tribal
					}
				}
				
				preferred_limit = {
					any_province_holding = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = temple
						}
					}
				}
				
				set_province_flag = dragons_lair_province
				
				save_event_target_as = dragons_lair_province
				
				2861 = { # Chang'an
					save_persistent_event_target = {
						name = dragons_lair_province
						scope = PREV
					}
				}
				
				change_variable = {
					which = dragons_hoard
					value = 10000
				}
			}
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_lny
			}
			
			narrative_event = { id = soh.6753 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			narrative_event = { id = soh.6754 days = 1 } # Inform the world
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6752 # Grovel
		
		character_event = { id = soh.6757 days = 1 } # Accepted
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					owner = {
						character_event = { id = soh.6755 days = 3 } # Inform the owner of the lair province that it is the dragon's lair - ALWAYS happens
						any_liege = {
							character_event = { id = soh.6755 days = 3 } # Inform the owner of the lair province that it is the dragon's lair - ALWAYS happens
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					decrease_prosperity_effect = yes
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					if = {
						limit = {
							has_province_modifier = depopulated_1
						}
						remove_province_modifier = depopulated_1
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					
					else_if = {
						limit = {
							has_province_modifier = depopulated_2
						}
						remove_province_modifier = depopulated_2
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
					
					else = {
						capital_holding = {
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 1
			
			# We WANT the first attack to possibly result in a full display of power...
			trigger = {
				NAND = {
					is_adult = yes
					is_actually_incapable_trigger = no
					NOT = {
						trait = craven
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			OR = {
				ai = no
				AND = {
					is_ill = no
					NOT = {
						trait = pregnant
					}
					is_maimed_trigger = no
				}
			}
			has_regent = no
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTB_SOH_6752 # Begone, foul beast!
		
		pacifists_lose_piety_effect = yes
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					decrease_prosperity_effect = yes
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					if = {
						limit = {
							has_province_modifier = depopulated_1
						}
						remove_province_modifier = depopulated_1
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					
					else_if = {
						limit = {
							has_province_modifier = depopulated_2
						}
						remove_province_modifier = depopulated_2
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
					
					else = {
						capital_holding = {
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					owner = {
						character_event = { id = soh.6755 days = 3 } # Inform the owner of the lair province that it is the dragon's lair - ALWAYS happens
						any_liege = {
							character_event = { id = soh.6755 days = 3 } # Inform the owner of the lair province that it is the dragon's lair - ALWAYS happens
						}
					}
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			character_event = { id = soh.6759 days = 1 } # Inform vassals
		}
		
		character_event = { id = soh.6760 days = 2 } # Calculate outcome
		
		ai_chance = {
			factor = 1000
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wounded
			}
			
			mult_modifier = {
				factor = 0.1
				combat_rating < 50
			}
			
			mult_modifier = {
				factor = 0.1
				martial < 10
			}
		}
	}
}

# Inform vassals at the LNY of the dragon's arrival
narrative_event = {
	id = soh.6753
	title = EVTTITLE_SOH_6753
	desc = EVTDESC_SOH_6753
	picture = GFX_evt_burning_house # If there's an option between this and the Irminsul picture, that'd be nice...
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6753 # This is going to be bad...
	}
}

# Inform the world of the dragon's existence
narrative_event = {
	id = soh.6754
	title = EVTTITLE_SOH_6754
	desc = EVTDESC_SOH_6754
	picture = GFX_evt_burning_house # If there's an option between this and the Irminsul picture, that'd be nice...
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6754 # Oh no!
	}
}

# Inform the lair's owner of the lair province
character_event = {
	id = soh.6755
	desc = EVTDESC_SOH_6755
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		any_demesne_province = {
			limit = {
				has_province_flag = dragons_lair_province
			}
			save_event_target_as = dragons_lair_province
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOT = {
					character = ROOT
				}
			}
			character_event = { id = soh.6756 } # Inform everyone else about the lair - ALWAYS happens
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6755 # Here be dragons...
		
		event_target:dragons_lair_province = {
			hidden_tooltip = {
				change_variable = {
					which = dragons_hoard
					value = 1000
				}
			}
			
			add_province_modifier = {
				name = dragons_lair
				duration = -1
			}
			
			custom_tooltip = {
				text = is_burninated_with_extreme_prejudice
				burninate_with_extreme_prejudice_effect = yes
			}
		}
	}
}

# Inform everyone else about the lair
character_event = {
	id = soh.6756
	desc = EVTDESC_SOH_6756
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6756 # There be dragons...
	}
}

# Grovel accepted
character_event = {
	id = soh.6757
	desc = EVTDESC_SOH_6757
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6757 # At least I'm alive...
		
		scaled_wealth = {
			value = -10
			min = 1000
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 1000
					}
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			character_event = { id = soh.6758 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that they, too, should grovel
character_event = {
	id = soh.6758
	desc = EVTDESC_SOH_6758
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6758 # At least I'm alive...
		
		scaled_wealth = {
			value = -1
			min = 100
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 100
					}
				}
			}
		}
	}
}

# Fight about to happen - join?
character_event = {
	id = soh.6759
	desc = EVTDESC_SOH_6759
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6759 # I'll leave this to FROM...
		
		ai_chance = {
			factor = 1000
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.001
				has_character_flag = dragonslayer_wannabe
			}
			
			mult_modifier = {
				factor = 0.1
				any_artifact = {
					has_flag = dragonslayer
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			OR = {
				ai = no
				AND = {
					is_ill = no
					NOT = {
						trait = pregnant
					}
					is_maimed_trigger = no
				}
			}
			has_regent = no
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTB_SOH_6759 # I'll help fight the dragon!
		
		set_character_flag = helping_with_dragon
		
		pacifists_lose_piety_effect = yes
		
		ai_chance = {
			factor = 1000
			
			trigger = {
				NOR = {
					trait = craven
					is_rival = FROM
				}
				opinion = {
					who = FROM
					value >= -50
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 0
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wounded
			}
			
			mult_modifier = {
				factor = 0.01
				combat_rating < 50
			}
			
			mult_modifier = {
				factor = 0.01
				is_female = yes
				# If women are not expected to fight, don't do it unnecessarily...
				NOR = {
					is_member_of_any_warrior_lodge_trigger = yes
					society_member_of = warriors_of_the_rising_sun
					society_member_of = hwarang
					trait = shieldmaiden
					has_character_flag = special_marshal
					has_character_flag = dragonslayer_wannabe
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_bai
					has_religion_feature = religion_feature_minahasan
					has_religion_feature = religion_feature_ryukyuan
					has_religion_feature = religion_feature_minangkabau
					gender_equality_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.01
				# If men are not expected to fight, don't do it unnecessarily...
				is_female = no
				NOR = {
					is_member_of_any_warrior_lodge_trigger = yes
					society_member_of = warriors_of_the_rising_sun
					society_member_of = hwarang
					has_character_flag = special_marshal
					has_character_flag = dragonslayer_wannabe
				}
				OR = {
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_feature_minangkabau
				}
			}
		}
	}
}

# Determine how the fight goes
character_event = {
	id = soh.6760
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			random_list = {
				19 = {
					set_character_flag = dragon_combat_undecided
					
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 25 # Due to plot armor, a crit is only +5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					narrative_event = { id = soh.6765 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
				if = {
					limit = {
						combat_rating >= 500
					}
					change_variable = {
						which = d20
						value = 50
					}
				}
				else_if = {
					limit = {
						combat_rating >= 490
					}
					change_variable = {
						which = d20
						value = 49
					}
				}
				else_if = {
					limit = {
						combat_rating >= 480
					}
					change_variable = {
						which = d20
						value = 48
					}
				}
				else_if = {
					limit = {
						combat_rating >= 470
					}
					change_variable = {
						which = d20
						value = 47
					}
				}
				else_if = {
					limit = {
						combat_rating >= 460
					}
					change_variable = {
						which = d20
						value = 46
					}
				}
				else_if = {
					limit = {
						combat_rating >= 450
					}
					change_variable = {
						which = d20
						value = 45
					}
				}
				else_if = {
					limit = {
						combat_rating >= 440
					}
					change_variable = {
						which = d20
						value = 44
					}
				}
				else_if = {
					limit = {
						combat_rating >= 430
					}
					change_variable = {
						which = d20
						value = 43
					}
				}
				else_if = {
					limit = {
						combat_rating >= 420
					}
					change_variable = {
						which = d20
						value = 42
					}
				}
				else_if = {
					limit = {
						combat_rating >= 410
					}
					change_variable = {
						which = d20
						value = 41
					}
				}
				else_if = {
					limit = {
						combat_rating >= 400
					}
					change_variable = {
						which = d20
						value = 40
					}
				}
				else_if = {
					limit = {
						combat_rating >= 390
					}
					change_variable = {
						which = d20
						value = 39
					}
				}
				else_if = {
					limit = {
						combat_rating >= 380
					}
					change_variable = {
						which = d20
						value = 38
					}
				}
				else_if = {
					limit = {
						combat_rating >= 370
					}
					change_variable = {
						which = d20
						value = 37
					}
				}
				else_if = {
					limit = {
						combat_rating >= 360
					}
					change_variable = {
						which = d20
						value = 36
					}
				}
				else_if = {
					limit = {
						combat_rating >= 350
					}
					change_variable = {
						which = d20
						value = 35
					}
				}
				else_if = {
					limit = {
						combat_rating >= 340
					}
					change_variable = {
						which = d20
						value = 34
					}
				}
				else_if = {
					limit = {
						combat_rating >= 330
					}
					change_variable = {
						which = d20
						value = 33
					}
				}
				else_if = {
					limit = {
						combat_rating >= 320
					}
					change_variable = {
						which = d20
						value = 32
					}
				}
				else_if = {
					limit = {
						combat_rating >= 310
					}
					change_variable = {
						which = d20
						value = 31
					}
				}
				else_if = {
					limit = {
						combat_rating >= 300
					}
					change_variable = {
						which = d20
						value = 30
					}
				}
				else_if = {
					limit = {
						combat_rating >= 290
					}
					change_variable = {
						which = d20
						value = 29
					}
				}
				else_if = {
					limit = {
						combat_rating >= 280
					}
					change_variable = {
						which = d20
						value = 28
					}
				}
				else_if = {
					limit = {
						combat_rating >= 270
					}
					change_variable = {
						which = d20
						value = 27
					}
				}
				else_if = {
					limit = {
						combat_rating >= 260
					}
					change_variable = {
						which = d20
						value = 26
					}
				}
				else_if = {
					limit = {
						combat_rating >= 250
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						combat_rating >= 240
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						combat_rating >= 230
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						combat_rating >= 220
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						combat_rating >= 210
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						combat_rating >= 200
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						combat_rating >= 190
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						combat_rating >= 180
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						combat_rating >= 170
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						combat_rating >= 160
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						combat_rating >= 150
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						combat_rating >= 140
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						combat_rating >= 130
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						combat_rating >= 120
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						combat_rating >= 110
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						combat_rating >= 100
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						combat_rating >= 90
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						combat_rating >= 80
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						combat_rating >= 70
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						combat_rating >= 60
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						combat_rating >= 50
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						combat_rating >= 40
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						combat_rating >= 30
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						combat_rating >= 20
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						combat_rating >= 10
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
				if = {
					limit = {
						martial >= 50
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						martial >= 48
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						martial >= 46
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						martial >= 44
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						martial >= 42
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						martial >= 40
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						martial >= 38
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						martial >= 36
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						martial >= 34
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						martial >= 32
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						martial >= 30
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						martial >= 28
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						martial >= 26
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						martial >= 24
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						martial >= 22
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						martial >= 20
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						martial >= 18
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						martial >= 16
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						martial >= 14
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						martial >= 12
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						martial >= 10
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						martial >= 8
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						martial >= 6
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						martial >= 4
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						martial >= 2
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				any_courtier = {
					limit = {
						has_character_flag = dragonslayer_wannabe
						is_inaccessible_or_incapable_trigger = no
					}
					ROOT = {
						change_variable = {
							which = d20
							value = 5
						}
					}
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_lny
						has_character_flag = helping_with_dragon
					}
					ROOT = {
						change_variable = {
							which = d20
							value = 1 # Much, much worse than a dedicated dragonslayer
						}
					}
				}
				
				if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						lower_real_tier_than = king
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						real_tier = king
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						real_tier = emperor
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				
				if = {
					limit = {
						has_character_flag = small_fireworks
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				else_if = {
					limit = {
						has_character_flag = normal_fireworks
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						has_character_flag = large_fireworks
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = massive_fireworks
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						has_character_flag = lny_zodiac_match
						NOT = {
							has_character_flag = lny_element_match
						}
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						NOT = {
							has_character_flag = lny_zodiac_match
						}
						has_character_flag = lny_element_match
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_zodiac_match
						has_character_flag = lny_element_match
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						real_tier = duke
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				else_if = {
					limit = {
						real_tier = king
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				
				else_if = {
					limit = {
						real_tier = emperor
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
			
				# Calculate outcome - due to plot armor, the dragon is unkillable
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 50
						}
					}
					
					narrative_event = { id = soh.6761 } # Dragon driven off and wounded
				}
				
				else = {
					narrative_event = { id = soh.6765 } # Defeat
				}
			}
		}
	}
}

# Dragon wounded and driven off
narrative_event = {
	id = soh.6761
	title = EVTTITLE_SOH_6761
	desc = EVTDESC_SOH_6761
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6761 # BE GONE!
		
		prestige = 500
		
		piety = 500
		
		set_global_flag = dragon_injured
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					random_list = {
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 1
							}
						}
						40 = {
							change_variable = {
								which = dragon_wounds
								value = 2
							}
						}
						30 = {
							change_variable = {
								which = dragon_wounds
								value = 3
							}
						}
						25 = {
							change_variable = {
								which = dragon_wounds
								value = 4
							}
						}
						20 = {
							change_variable = {
								which = dragon_wounds
								value = 5
							}
						}
						15 = {
							change_variable = {
								which = dragon_wounds
								value = 6
							}
						}
						10 = {
							change_variable = {
								which = dragon_wounds
								value = 7
							}
						}
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 8
							}
						}
						2 = {
							change_variable = {
								which = dragon_wounds
								value = 9
							}
						}
						1 = {
							change_variable = {
								which = dragon_wounds
								value = 10
							}
						}
					}
					
					province_event = { id = tianxia.201 days = 180 random = 365 } # The dragon recovers from its wounds
				}
			}
		}
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				if = {
					limit = {
						has_character_flag = helping_with_dragon
					}
					if = {
						limit = {
							ai = no
						}
						narrative_event = { id = soh.6762 } # Inform vassals
					}
					
					else = {
						prestige = 500
						piety = 500
						
						random_list = {
							80 = {}
							
							15 = {
								trigger = {
									combat_rating < 80
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 40
								}
								
								add_trait_wounded_effect = yes
							}
							
							5 = {
								trigger = {
									combat_rating < 40
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 20
								}
								
								add_maimed_trait_effect = yes
							}
						}
					}
				}
				
				else = {
					if = {
						limit = {
							ai = no
						}
						character_event = { id = soh.6763 } # Inform vassals
					}
				}
			}
			
			any_courtier = {
				limit = {
					has_character_flag = dragonslayer_wannabe
					is_inaccessible_or_incapable_trigger = no
				}
				
				prestige = 100
				piety = 100
				
				random_list = {
					80 = {}
					
					15 = {
						trigger = {
							combat_rating < 80
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 40
						}
						
						add_trait_wounded_effect = yes
					}
					
					5 = {
						trigger = {
							combat_rating < 40
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 20
						}
						
						add_maimed_trait_effect = yes
					}
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			character_event = { id = soh.6764 days = 30 } # Inform the world
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that fought
narrative_event = {
	id = soh.6762
	title = EVTTITLE_SOH_6762
	desc = EVTDESC_SOH_6762
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6762 # BE GONE!
		
		piety = 100
		
		prestige = 100
		
		random_list = {
			80 = {}
			
			15 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_trait_wounded_effect = yes
			}
			
			5 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				add_maimed_trait_effect = yes
			}
		}
	}
}

# Inform vassals that didn't fight
character_event = {
	id = soh.6763
	desc = EVTDESC_SOH_6763
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6763 # Go Team Fellow Humans!
	}
}

# Inform the world
character_event = {
	id = soh.6764
	desc = EVTDESC_SOH_6764
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6764 # Maybe the time to kill the beast is now...
	}
}

# Dragon wins and razes the capital
narrative_event = {
	id = soh.6765
	title = EVTTITLE_SOH_6765
	desc = EVTDESC_SOH_6765
	picture = GFX_evt_irminsul_burning
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6765 # NOOOO!
		
		capital_scope = {
			custom_tooltip = {
				text = is_burninated_with_extreme_prejudice
				burninate_with_extreme_prejudice_effect = yes
			}
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					check_variable = {
						which = d20
						value >= 23
					}
				}
				
				set_global_flag = dragon_injured
				
				2861 = { # Chang'an
					persistent_event_target:dragons_lair_province = {
						change_variable = {
							which = dragon_wounds
							value = 1
						}
					}
				}
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				
				if = {
					limit = {
						has_character_flag = helping_with_dragon
					}
					
					if = {
						limit = {
							ai = no
						}
						narrative_event = { id = soh.6766 } # Inform vassals
					}
					
					else = {
						random_list = {
							40 = {
								add_trait_wounded_effect = yes
							}
							
							30 = {
								trigger = {
									combat_rating < 80
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 40
								}
								
								add_maimed_trait_effect = yes
							}
							
							30 = {
								trigger = {
									combat_rating < 40
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 20
								}
								
								death = {
									death_reason = death_evil_dragon
								}
							}
						}
					}
				}
				
				else = {
					if = {
						limit = {
							ai = no
						}
						
						character_event = { id = soh.6767 } # Inform vassals
					}
				}
			}
			
			any_courtier = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
				}
				
				random_list = {
					40 = {
						add_trait_wounded_effect = yes
					}
					
					30 = {
						trigger = {
							combat_rating < 80
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 40
						}
						
						add_maimed_trait_effect = yes
					}
					
					30 = {
						trigger = {
							combat_rating < 40
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 20
						}
						
						death = {
							death_reason = death_evil_dragon
						}
					}
				}
			}
			
			hidden_tooltip = {
				2861 = { # Chang'an
					persistent_event_target:dragons_lair_province = {
						change_variable = {
							which = dragons_hoard
							value = 5000
						}
					}
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			character_event = { id = soh.6768 days = 5 } # Inform the world
		}
		
		random_list = {
			40 = {
				add_trait_wounded_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_maimed_trait_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				death = {
					death_reason = death_evil_dragon
				}
			}
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that fought
narrative_event = {
	id = soh.6766
	title = EVTTITLE_SOH_6766
	desc = EVTDESC_SOH_6766
	picture = GFX_evt_irminsul_burning
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6766 # NO!
		
		random_list = {
			40 = {
				add_trait_wounded_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_maimed_trait_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				death = {
					death_reason = death_evil_dragon
				}
			}
		}
	}
}

# Inform vassals that didn't fight
character_event = {
	id = soh.6767
	desc = EVTDESC_SOH_6767
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6767 # How terrible!
		
		random_list = {
			20 = {}
			
			60 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_trait_wounded_effect = yes
			}
			
			20 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				add_maimed_trait_effect = yes
			}
		}
	}
}

# Inform the world
character_event = {
	id = soh.6768
	desc = EVTDESC_SOH_6768
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6768 # How terrible!
	}
}

# Red dragon arrives
narrative_event = {
	id = soh.6769
	title = EVTTITLE_SOH_6769
	desc = EVTDESC_SOH_6769
	picture = GFX_evt_burning_house # If there's an option between this and the Irminsul picture, that'd be nice...
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		capital_scope = {
			save_event_target_as = dragon_attack_capital
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_lny
			}
			
			narrative_event = { id = soh.6770 } # Inform vassals
		}
	}
	
	
	option = {
		name = EVTOPTA_SOH_6769 # Grovel
		
		character_event = { id = soh.6771 days = 1 } # Accepted
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					decrease_prosperity_effect = yes
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					if = {
						limit = {
							has_province_modifier = depopulated_1
						}
						remove_province_modifier = depopulated_1
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					
					else_if = {
						limit = {
							has_province_modifier = depopulated_2
						}
						remove_province_modifier = depopulated_2
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
					
					else = {
						capital_holding = {
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 1000
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.001
				has_character_flag = dragonslayer_wannabe
			}
			
			mult_modifier = {
				factor = 0.1
				any_artifact = {
					has_flag = dragonslayer
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			OR = {
				ai = no
				AND = {
					is_ill = no
					NOT = {
						trait = pregnant
					}
					is_maimed_trigger = no
				}
			}
			has_regent = no
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTB_SOH_6769 # Begone, foul beast!
		
		pacifists_lose_piety_effect = yes
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			capital_scope = {
				if = {
					limit = {
						OR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					decrease_prosperity_effect = yes
				}
				
				else_if = {
					limit = {
						NOR = {
							has_province_modifier = prosperity_modifier_3
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_1
						}
					}
					
					if = {
						limit = {
							has_province_modifier = depopulated_1
						}
						remove_province_modifier = depopulated_1
						add_province_modifier = {
							name = depopulated_2
							duration = -1
						}
					}
					
					else_if = {
						limit = {
							has_province_modifier = depopulated_2
						}
						remove_province_modifier = depopulated_2
						add_province_modifier = {
							name = depopulated_3
							duration = -1
						}
					}
					
					else = {
						capital_holding = {
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			character_event = { id = soh.6773 days = 1 } # Inform vassals
		}
		
		character_event = { id = soh.6774 days = 2 } # Calculate outcome
		
		ai_chance = {
			factor = 1000
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wounded
			}
			
			mult_modifier = {
				factor = 0.1
				combat_rating < 50
			}
			
			mult_modifier = {
				factor = 0.1
				martial < 10
			}
		}
	}
}

# Inform vassals at the LNY of the dragon's arrival
narrative_event = {
	id = soh.6770
	title = EVTTITLE_SOH_6770
	desc = EVTDESC_SOH_6770
	picture = GFX_evt_burning_house # If there's an option between this and the Irminsul picture, that'd be nice...
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6770 # This is going to be bad...
	}
}

# Grovel accepted
character_event = {
	id = soh.6771
	desc = EVTDESC_SOH_6771
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6771 # At least I'm alive...
		
		scaled_wealth = {
			value = -10
			min = 1000
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 1000
					}
				}
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			character_event = { id = soh.6772 } # Inform vassals
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that they, too, should grovel
character_event = {
	id = soh.6772
	desc = EVTDESC_SOH_6772
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6772 # At least I'm alive...
		
		scaled_wealth = {
			value = -1
			min = 100
		}
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragons_hoard
						value = 100
					}
				}
			}
		}
	}
}

# Fight about to happen - join?
character_event = {
	id = soh.6773
	desc = EVTDESC_SOH_6773
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6773 # I'll leave this to FROM...
		
		ai_chance = {
			factor = 1000
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.001
				has_character_flag = dragonslayer_wannabe
			}
			
			mult_modifier = {
				factor = 0.1
				any_artifact = {
					has_flag = dragonslayer
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			OR = {
				ai = no
				AND = {
					is_ill = no
					NOT = {
						trait = pregnant
					}
					is_maimed_trigger = no
				}
			}
			has_regent = no
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTB_SOH_6773 # I'll help fight the dragon!
		
		set_character_flag = helping_with_dragon
		
		pacifists_lose_piety_effect = yes
		
		ai_chance = {
			factor = 1000
			
			trigger = {
				NOR = {
					trait = craven
					is_rival = FROM
				}
				opinion = {
					who = FROM
					value >= -50
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 0
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wounded
			}
			
			mult_modifier = {
				factor = 0.01
				combat_rating < 50
			}
			
			mult_modifier = {
				factor = 0.01
				is_female = yes
				# If women are not expected to fight, don't do it unnecessarily...
				NOR = {
					is_member_of_any_warrior_lodge_trigger = yes
					society_member_of = warriors_of_the_rising_sun
					society_member_of = hwarang
					trait = shieldmaiden
					has_character_flag = special_marshal
					has_character_flag = dragonslayer_wannabe
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_bai
					has_religion_feature = religion_feature_minahasan
					has_religion_feature = religion_feature_ryukyuan
					has_religion_feature = religion_feature_minangkabau
					gender_equality_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.01
				# If men are not expected to fight, don't do it unnecessarily...
				is_female = no
				NOR = {
					is_member_of_any_warrior_lodge_trigger = yes
					society_member_of = warriors_of_the_rising_sun
					society_member_of = hwarang
					has_character_flag = special_marshal
					has_character_flag = dragonslayer_wannabe
				}
				OR = {
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_feature_minangkabau
				}
			}
		}
	}
}

# Determine how the fight goes
character_event = {
	id = soh.6774
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			random_list = {
				19 = {
					set_character_flag = dragon_combat_undecided
					
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 25 # Due to plot armor, a crit is only +5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					narrative_event = { id = soh.6765 } # Defeat
				}
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = game_master # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				
				# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
				if = {
					limit = {
						combat_rating >= 500
					}
					change_variable = {
						which = d20
						value = 50
					}
				}
				else_if = {
					limit = {
						combat_rating >= 490
					}
					change_variable = {
						which = d20
						value = 49
					}
				}
				else_if = {
					limit = {
						combat_rating >= 480
					}
					change_variable = {
						which = d20
						value = 48
					}
				}
				else_if = {
					limit = {
						combat_rating >= 470
					}
					change_variable = {
						which = d20
						value = 47
					}
				}
				else_if = {
					limit = {
						combat_rating >= 460
					}
					change_variable = {
						which = d20
						value = 46
					}
				}
				else_if = {
					limit = {
						combat_rating >= 450
					}
					change_variable = {
						which = d20
						value = 45
					}
				}
				else_if = {
					limit = {
						combat_rating >= 440
					}
					change_variable = {
						which = d20
						value = 44
					}
				}
				else_if = {
					limit = {
						combat_rating >= 430
					}
					change_variable = {
						which = d20
						value = 43
					}
				}
				else_if = {
					limit = {
						combat_rating >= 420
					}
					change_variable = {
						which = d20
						value = 42
					}
				}
				else_if = {
					limit = {
						combat_rating >= 410
					}
					change_variable = {
						which = d20
						value = 41
					}
				}
				else_if = {
					limit = {
						combat_rating >= 400
					}
					change_variable = {
						which = d20
						value = 40
					}
				}
				else_if = {
					limit = {
						combat_rating >= 390
					}
					change_variable = {
						which = d20
						value = 39
					}
				}
				else_if = {
					limit = {
						combat_rating >= 380
					}
					change_variable = {
						which = d20
						value = 38
					}
				}
				else_if = {
					limit = {
						combat_rating >= 370
					}
					change_variable = {
						which = d20
						value = 37
					}
				}
				else_if = {
					limit = {
						combat_rating >= 360
					}
					change_variable = {
						which = d20
						value = 36
					}
				}
				else_if = {
					limit = {
						combat_rating >= 350
					}
					change_variable = {
						which = d20
						value = 35
					}
				}
				else_if = {
					limit = {
						combat_rating >= 340
					}
					change_variable = {
						which = d20
						value = 34
					}
				}
				else_if = {
					limit = {
						combat_rating >= 330
					}
					change_variable = {
						which = d20
						value = 33
					}
				}
				else_if = {
					limit = {
						combat_rating >= 320
					}
					change_variable = {
						which = d20
						value = 32
					}
				}
				else_if = {
					limit = {
						combat_rating >= 310
					}
					change_variable = {
						which = d20
						value = 31
					}
				}
				else_if = {
					limit = {
						combat_rating >= 300
					}
					change_variable = {
						which = d20
						value = 30
					}
				}
				else_if = {
					limit = {
						combat_rating >= 290
					}
					change_variable = {
						which = d20
						value = 29
					}
				}
				else_if = {
					limit = {
						combat_rating >= 280
					}
					change_variable = {
						which = d20
						value = 28
					}
				}
				else_if = {
					limit = {
						combat_rating >= 270
					}
					change_variable = {
						which = d20
						value = 27
					}
				}
				else_if = {
					limit = {
						combat_rating >= 260
					}
					change_variable = {
						which = d20
						value = 26
					}
				}
				else_if = {
					limit = {
						combat_rating >= 250
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						combat_rating >= 240
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						combat_rating >= 230
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						combat_rating >= 220
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						combat_rating >= 210
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						combat_rating >= 200
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						combat_rating >= 190
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						combat_rating >= 180
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						combat_rating >= 170
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						combat_rating >= 160
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						combat_rating >= 150
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						combat_rating >= 140
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						combat_rating >= 130
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						combat_rating >= 120
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						combat_rating >= 110
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						combat_rating >= 100
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						combat_rating >= 90
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						combat_rating >= 80
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						combat_rating >= 70
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						combat_rating >= 60
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						combat_rating >= 50
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						combat_rating >= 40
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						combat_rating >= 30
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						combat_rating >= 20
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						combat_rating >= 10
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
				if = {
					limit = {
						martial >= 50
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						martial >= 48
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						martial >= 46
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						martial >= 44
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						martial >= 42
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						martial >= 40
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						martial >= 38
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						martial >= 36
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						martial >= 34
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						martial >= 32
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						martial >= 30
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						martial >= 28
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						martial >= 26
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						martial >= 24
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						martial >= 22
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						martial >= 20
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						martial >= 18
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						martial >= 16
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						martial >= 14
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						martial >= 12
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						martial >= 10
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						martial >= 8
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						martial >= 6
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						martial >= 4
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						martial >= 2
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				any_courtier = {
					limit = {
						has_character_flag = dragonslayer_wannabe
						is_inaccessible_or_incapable_trigger = no
					}
					ROOT = {
						change_variable = {
							which = d20
							value = 5
						}
					}
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_lny
						has_character_flag = helping_with_dragon
					}
					ROOT = {
						change_variable = {
							which = d20
							value = 1 # Much, much worse than a dedicated dragonslayer
						}
					}
				}
				
				if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						lower_real_tier_than = king
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						real_tier = king
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_extra_dragon_guards
						real_tier = emperor
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				
				if = {
					limit = {
						has_character_flag = small_fireworks
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				else_if = {
					limit = {
						has_character_flag = normal_fireworks
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						has_character_flag = large_fireworks
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = massive_fireworks
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						has_character_flag = lny_zodiac_match
						NOT = {
							has_character_flag = lny_element_match
						}
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						NOT = {
							has_character_flag = lny_zodiac_match
						}
						has_character_flag = lny_element_match
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						has_character_flag = lny_zodiac_match
						has_character_flag = lny_element_match
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				
				if = {
					limit = {
						real_tier = duke
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				
				else_if = {
					limit = {
						real_tier = king
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				
				else_if = {
					limit = {
						real_tier = emperor
						is_tribal = no
						is_nomadic = no
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				
				if = {
					limit = {
						has_character_flag = mabs_boon
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						has_character_flag = mabs_curse
					}
					change_variable = {
						which = d20
						value = -10
					}
				}
				
				# Calculate outcome
				if = {
					limit = {
						check_variable = {
							which = d20
							value >= 50
						}
					}
					narrative_event = { id = soh.6775 } # Dragon driven off and wounded
				}
				
				else_if = {
					limit = {
						check_variable = {
							which = d20
							value < 50
						}
						check_variable = {
							which = d20
							value >= 23
						}
					}
					
					random_list = {
						25 = {
							narrative_event = { id = soh.6775 } # Dragon driven off and wounded
						}
						
						75 = {
							narrative_event = { id = soh.6779 } # Defeat
						}
					}
				}
				
				else = {
					narrative_event = { id = soh.6779 } # Defeat
				}
			}
		}
	}
}

# Dragon wounded and driven off
narrative_event = {
	id = soh.6775
	title = EVTTITLE_SOH_6775
	desc = EVTDESC_SOH_6775
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6775 # BE GONE!
		
		prestige = 500
		
		piety = 500
		
		set_global_flag = dragon_injured
		
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					random_list = {
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 1
							}
						}
						40 = {
							change_variable = {
								which = dragon_wounds
								value = 2
							}
						}
						30 = {
							change_variable = {
								which = dragon_wounds
								value = 3
							}
						}
						25 = {
							change_variable = {
								which = dragon_wounds
								value = 4
							}
						}
						20 = {
							change_variable = {
								which = dragon_wounds
								value = 5
							}
						}
						15 = {
							change_variable = {
								which = dragon_wounds
								value = 6
							}
						}
						10 = {
							change_variable = {
								which = dragon_wounds
								value = 7
							}
						}
						5 = {
							change_variable = {
								which = dragon_wounds
								value = 8
							}
						}
						2 = {
							change_variable = {
								which = dragon_wounds
								value = 9
							}
						}
						1 = {
							change_variable = {
								which = dragon_wounds
								value = 10
							}
						}
					}
					
					province_event = { id = tianxia.201 days = 180 random = 365 } # The dragon recovers from its wounds
				}
			}
		}
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				
				if = {
					limit = {
						has_character_flag = helping_with_dragon
					}
					
					if = {
						limit = {
							ai = no
						}
						narrative_event = { id = soh.6776 } # Inform vassals
					}
					
					else = {
						prestige = 500
						piety = 500
						
						random_list = {
							80 = {}
							
							15 = {
								trigger = {
									combat_rating < 80
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 40
								}
								
								add_trait_wounded_effect = yes
							}
							
							5 = {
								trigger = {
									combat_rating < 40
								}
								
								mult_modifier = {
									factor = 0.5
									combat_rating >= 20
								}
								
								add_maimed_trait_effect = yes
							}
						}
					}
				}
				
				else = {
					if = {
						limit = {
							ai = no
						}
						character_event = { id = soh.6777 } # Inform vassals
					}
				}
			}
			
			any_courtier = {
				limit = {
					has_character_flag = dragonslayer_wannabe
					is_inaccessible_or_incapable_trigger = no
				}
				
				prestige = 500
				piety = 500
				
				random_list = {
					80 = {}
					
					15 = {
						trigger = {
							combat_rating < 80
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 40
						}
						
						add_trait_wounded_effect = yes
					}
					
					5 = {
						trigger = {
							combat_rating < 40
						}
						
						mult_modifier = {
							factor = 0.5
							combat_rating >= 20
						}
						
						add_maimed_trait_effect = yes
					}
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			character_event = { id = soh.6778 days = 30 } # Inform the world
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that fought
narrative_event = {
	id = soh.6776
	title = EVTTITLE_SOH_6776
	desc = EVTDESC_SOH_6776
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6776 # BE GONE!
		
		piety = 500
		
		prestige = 500
		
		random_list = {
			80 = {}
			
			15 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_trait_wounded_effect = yes
			}
			
			5 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				add_maimed_trait_effect = yes
			}
		}
	}
}

# Inform vassals that didn't fight
character_event = {
	id = soh.6777
	desc = EVTDESC_SOH_6777
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6777 # Go Team Fellow Humans!
	}
}

# Inform the world
character_event = {
	id = soh.6778
	desc = EVTDESC_SOH_6778
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6778 # Maybe the time to kill the beast is now...
	}
}

# Dragon wins and razes the capital
narrative_event = {
	id = soh.6779
	title = EVTTITLE_SOH_6779
	desc = EVTDESC_SOH_6779
	picture = GFX_evt_irminsul_burning
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6779 # NOOOO!
		
		capital_scope = {
			custom_tooltip = {
				text = is_burninated_with_extreme_prejudice
				burninate_with_extreme_prejudice_effect = yes
			}
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					check_variable = {
						which = d20
						value >= 23
					}
				}
				
				set_global_flag = dragon_injured
				
				2861 = { # Chang'an
					persistent_event_target:dragons_lair_province = {
						change_variable = {
							which = dragon_wounds
							value = 1
						}
					}
				}
			}
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_lny
				}
				
				if = {
					limit = {
						has_character_flag = helping_with_dragon
					}
					
					if = {
						limit = {
							ai = no
						}
						
						narrative_event = { id = soh.6780 } # Inform vassals
					}
					
					else = {
						random_list = {
							40 = {
								add_trait_wounded_effect = yes
							}
							30 = {
								modifier = {
									factor = 0
									combat_rating >= 80
								}
								modifier = {
									factor = 0.5
									combat_rating >= 40
								}
								add_maimed_trait_effect = yes
							}
							30 = {
								modifier = {
									factor = 0
									combat_rating >= 40
								}
								modifier = {
									factor = 0.5
									combat_rating >= 20
								}
								death = {
									death_reason = death_evil_dragon
								}
							}
						}
					}
				}
				
				else = {
					if = {
						limit = {
							ai = no
						}
						
						character_event = { id = soh.6781 } # Inform vassals
					}
				}
			}
			
			any_courtier = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
				}
				
				random_list = {
					40 = {
						add_trait_wounded_effect = yes
					}
					
					30 = {
						modifier = {
							factor = 0
							combat_rating >= 80
						}
						modifier = {
							factor = 0.5
							combat_rating >= 40
						}
						add_maimed_trait_effect = yes
					}
					
					30 = {
						modifier = {
							factor = 0
							combat_rating >= 40
						}
						modifier = {
							factor = 0.5
							combat_rating >= 20
						}
						death = {
							death_reason = death_evil_dragon
						}
					}
				}
			}
			
			hidden_tooltip = {
				2861 = { # Chang'an
					persistent_event_target:dragons_lair_province = {
						change_variable = {
							which = dragons_hoard
							value = 5000
						}
					}
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					character = ROOT
					AND = {
						has_character_flag = coming_to_lny
						liege = {
							character = ROOT
						}
					}
				}
			}
			
			character_event = { id = soh.6782 days = 5 } # Inform the world
		}
		
		random_list = {
			40 = {
				add_trait_wounded_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_maimed_trait_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				death = {
					death_reason = death_evil_dragon
				}
			}
		}
	}
	
	after = {
		clr_global_flag = ongoing_dragon_attack
	}
}

# Inform vassals that fought
narrative_event = {
	id = soh.6780
	title = EVTTITLE_SOH_6780
	desc = EVTDESC_SOH_6780
	picture = GFX_evt_irminsul_burning
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6780 # NO!
		
		random_list = {
			40 = {
				add_trait_wounded_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_maimed_trait_effect = yes
			}
			
			30 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				death = {
					death_reason = death_evil_dragon
				}
			}
		}
	}
}

# Inform vassals that didn't fight
character_event = {
	id = soh.6781
	desc = EVTDESC_SOH_6781
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6781 # How terrible!
		
		random_list = {
			20 = {}
			
			60 = {
				trigger = {
					combat_rating < 80
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 40
				}
				
				add_trait_wounded_effect = yes
			}
			
			20 = {
				trigger = {
					combat_rating < 40
				}
				
				mult_modifier = {
					factor = 0.5
					combat_rating >= 20
				}
				
				add_maimed_trait_effect = yes
			}
		}
	}
}

# Inform the world
character_event = {
	id = soh.6782
	desc = EVTDESC_SOH_6782
	picture = GFX_evt_irminsul_burning
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6782 # How terrible!
	}
}



##### Third event group

### Dragon dance

# Vassal notices very poor dragon dance
character_event = {
	id = soh.6783
	desc = EVTDESC_SOH_6783
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6783 # Most inauspicious!
		FROM = {
			character_event = { id = soh.6784 }
			
			any_vassal = {
				limit = {
					NOT = {
						character = ROOT
					}
					has_character_flag = coming_to_lny
				}
				
				character_event = { id = soh.6785 }
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					opinion = {
						who = FROM
						value >= 25
					}
					NOT = {
						trait = zealous
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = cynical
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6783 # Who cares?
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value < 25
					}
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Liege informed of vassal's comments
character_event = {
	id = soh.6784
	desc = EVTDESC_SOH_6784
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
		
	option = {
		name = EVTOPTA_SOH_6784 # Most unfortunate
		
		prestige = -50
		
		piety = -50
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			opinion = {
				who = ROOT
				modifier = disapproves_of_lny_dragon_dance
				months = 12
			}
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.6785
	desc = EVTDESC_SOH_6785
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6785 # Most inauspicious!
	}
}

# Dragon dance is good
character_event = {
	id = soh.6786
	desc = EVTDESC_SOH_6786
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6786 # This is rather nice
		
		prestige = 25
		
		piety = 25
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6787 } # Inform vassals
		}
	}
}

# Dragon dance is good - vassals
character_event = {
	id = soh.6787
	desc = EVTDESC_SOH_6787
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6787 # This is rather nice
	}
}

# Dragons get tangled up
character_event = {
	id = soh.6788
	desc = EVTDESC_SOH_6788
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6788 # How inauspicious!
		
		prestige = -25
		
		piety = -25
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6789 } # Inform vassals
		}
	}
}

# Dragons get tangled up - vassals
character_event = {
	id = soh.6789
	desc = EVTDESC_SOH_6789
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6789 # How inauspicious!
	}
}

# Multiple dragons are nice
character_event = {
	id = soh.6790
	desc = EVTDESC_SOH_6790
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6790 # Auspicious!
		
		prestige = 25
		
		piety = 25
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6791 } # Inform vassals
		}
	}
}

# Multiple dragons are nice - vassals
character_event = {
	id = soh.6791
	desc = EVTDESC_SOH_6791
	picture = GFX_evt_china_open
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6791 # Auspicious!
	}
}

# Nine dragons
narrative_event = {
	id = soh.6792
	title = EVTTITLE_SOH_6792
	desc = EVTDESC_SOH_6792
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6792 # Most auspicious!
		
		prestige = 100
		
		piety = 100
		
		if = {
			limit = {
				is_adult = yes
			}
			
			random = {
				chance = 25
				add_trait_partially_proud_effect = yes
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			narrative_event = { id = soh.6793 } # Inform vassals
		}
	}
}

# Nine dragons - vassals
narrative_event = {
	id = soh.6793
	title = EVTTITLE_SOH_6793
	desc = EVTDESC_SOH_6793
	picture = GFX_evt_chinese_mythology
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6793 # Most auspicious!
	}
}

# Bandits disguised as dragon dancers
narrative_event = {
	id = soh.6794
	title = EVTTITLE_SOH_6794
	desc = EVTDESC_SOH_6794
	picture = GFX_evt_china_unrest
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	immediate = {
		create_character = {
			culture = ROOT
			religion = ROOT
			dynasty = random
			age = 19
			female = yes
			
			attributes = {
				diplomacy = 3
				martial >= 10
				stewardship = 5
				intrigue = 8
				learning = 6
			}
			
			trait = brave
			trait = skilled_tactician
			trait = kind
			trait = deceitful
			trait = attractive
			trait = ambitious
			trait = duelist
		}
		
		new_character = {
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			save_event_target_as = a_girl_worth_fighting_alongside
			add_one_duel_experience_modifier = yes
			add_one_duel_experience_modifier = yes
			add_one_duel_experience_modifier = yes
			add_one_duel_experience_modifier = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6794 # I trust her to handle this!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				is_adult = yes
				ai = no
				is_actually_incapable_trigger = no
			}
			
			narrative_event = { id = soh.6795 } # Let the player opt in to helping out (if an adult)
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				is_adult = yes
				war = no
				ai = yes
				is_actually_incapable_trigger = no
			}
			
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			
			narrative_event = { id = soh.6795 } # Let an interesting AI vassal help out, if they want to
		}
		
		hidden_tooltip = {
			random_list = {
				75 = {
					narrative_event = { id = soh.6796 days = 2 random = 1 } # Success
				}
				
				25 = {
					narrative_event = { id = soh.6799 days = 2 random = 1 } # Failure
				}
			}
		}
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 10
				is_female = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6794 # Just send in the guards...
		
		event_target:a_girl_worth_fighting_alongside = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 2
				trait = wroth
			}
		}
		
		character_event = { id = soh.6802 } # The guards handle matters
	}
}

# Help the peasant girl?
narrative_event = {
	id = soh.6795
	title = EVTTITLE_SOH_6795
	desc = EVTDESC_SOH_6795
	picture = GFX_evt_china_unrest
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes
			is_female = no
		}
		
		name = EVTOPTA_SOH_6795 # I'll help her!
		
		prestige = 25
		
		set_character_flag = helping_with_bandits
		
		pacifists_lose_piety_effect = yes
		
		ai_chance = {
			factor = 75
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			is_female = yes
		}
		
		name = EVTOPTA_SOH_6795 # I'll help her!
		
		prestige = 50
		
		set_character_flag = helping_with_bandits
		
		pacifists_lose_piety_effect = yes
		
		ai_chance = {
			factor = 75
			
			trigger = {
				NOT = {
					trait = craven
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_female = no
		}
		
		name = EVTOPTB_SOH_6795 # A girl fighting? She'll fail for sure!
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOT = {
					trait = brave
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_female = yes
		}
		
		name = EVTOPTC_SOH_6795 # Fighting is not for me...
		
		prestige = -5
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOT = {
					trait = brave
				}
			}
		}
	}
}

# Peasant girl rescues the hostages - liege
narrative_event = {
	id = soh.6796
	title = EVTTITLE_SOH_6796
	desc = EVTDESC_SOH_6796
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6796 # I knew she could do it!
		
		prestige = 50
		
		event_target:a_girl_worth_fighting_alongside = {
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			set_character_flag = special_marshal
			
			add_friend = ROOT
		}
		
		any_vassal = {
			limit = {
				has_character_flag = helping_with_bandits
			}
			
			narrative_event = { id = soh.6797 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_lny
				NOT = {
					has_character_flag = helping_with_bandits
				}
			}
			
			narrative_event = { id = soh.6798 }
		}
	}
}

# Peasant girl rescues the hostages - vassals that joined
narrative_event = {
	id = soh.6797
	title = EVTTITLE_SOH_6797
	desc = EVTDESC_SOH_6797
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6797 # I knew she could do it!
		
		prestige = 50
		
		event_target:a_girl_worth_fighting_alongside = {
			add_friend = ROOT
		}
	}
}

# Peasant girl rescues the hostages - vassals that didn't join
narrative_event = {
	id = soh.6798
	title = EVTTITLE_SOH_6798
	desc = EVTDESC_SOH_6798
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	
	option = {
		name = EVTOPTA_SOH_6798 # Well, that happened...
	}
}

# Peasant girl fails to rescue the hostages - liege
narrative_event = {
	id = soh.6799
	title = EVTTITLE_SOH_6799
	desc = EVTDESC_SOH_6799
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6799 # She has failed me!
		
		prestige = -50
		
		event_target:a_girl_worth_fighting_alongside = {
			random_list = {
				75 = {
					add_trait_wounded_effect = yes
				}
				
				25 = {
					add_maimed_trait_effect = yes
				}
			}
			
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			
			imprison = yes
		}
		
		any_vassal = {
			limit = {
				has_character_flag = helping_with_bandits
			}
			
			narrative_event = { id = soh.6800 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_lny
				NOT = {
					has_character_flag = helping_with_bandits
				}
			}
			narrative_event = { id = soh.6801 }
		}
	}
}

# Peasant girl rescues the hostages - vassals that joined
narrative_event = {
	id = soh.6800
	title = EVTTITLE_SOH_6800
	desc = EVTDESC_SOH_6800
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6800 # It's her fault!
		
		prestige = -25
		
		random = {
			chance = 25
			add_trait_wounded_effect = yes
		}
	}
}

# Peasant girl rescues the hostages - vassals that didn't join
narrative_event = {
	id = soh.6801
	title = EVTTITLE_SOH_6801
	desc = EVTDESC_SOH_6801
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	
	option = {
		name = EVTOPTA_SOH_6801 # Apparently she didn't know how to fight...
	}
}

# Liege sent in the guards
character_event = {
	id = soh.6802
	desc = EVTDESC_SOH_6802
	picture = GFX_evt_china_invades
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6802 # The guards had it under control
	}
}

### Fireworks

# Unimpressive fireworks - vassal might complain
character_event = {
	id = soh.6803
	desc = EVTDESC_SOH_6803
	picture = GFX_evt_china_unrest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6803 # Most inauspicious!
		
		FROM = {
			character_event = { id = soh.6804 }
			
			any_vassal = {
				limit = {
					NOT = {
						character = ROOT
					}
					ai = no
					has_character_flag = coming_to_lny
				}
				
				character_event = { id = soh.6805 }
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				OR = {
					opinion = {
						who = FROM
						value < 25
					}
					trait = humble
				}
			}
			
			mult_modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = cynical
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6803 # Who cares?
		
		piety = -25
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					opinion = {
						who = FROM
						value < 25
					}
					trait = proud
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = shy
			}
		}
	}
}

# Unimpressive fireworks - liege
character_event = {
	id = soh.6804
	desc = EVTDESC_SOH_6804
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
		
	option = {
		name = EVTOPTA_SOH_6804 # Most unfortunate
		
		prestige = -50
		
		piety = -50
		
		opinion = {
			who = FROM
			modifier = troublesome_guest
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
			}
			
			opinion = {
				who = ROOT
				modifier = disapproves_of_lny_fireworks
				months = 12
			}
		}
	}
}

# Unimpressive fireworks - other vassals
character_event = {
	id = soh.6805
	desc = EVTDESC_SOH_6805
	picture =GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6805 # Most inauspicious!
	}
}

# Acceptable fireworks - liege
character_event = {
	id = soh.6806
	desc = EVTDESC_SOH_6806
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6806 # This is rather nice
		
		prestige = 25
		
		piety = 25
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6807 } # Inform vassals
		}
	}
}

# Acceptable fireworks - vassals
character_event = {
	id = soh.6807
	desc = EVTDESC_SOH_6807
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6807 # This is rather nice
	}
}

# Good fireworks - liege
character_event = {
	id = soh.6808
	desc = EVTDESC_SOH_6808
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = yes
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6808 # Auspicious!
		
		prestige = 50
		
		piety = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			character_event = { id = soh.6809 } # Inform vassals
		}
	}
}

# Good fireworks - vassals
character_event = {
	id = soh.6809
	desc = EVTDESC_SOH_6809
	picture = GFX_evt_comet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6809 # Auspicious!
	}
}

# Great fireworks - liege
narrative_event = {
	id = soh.6810
	title = EVTTITLE_SOH_6810
	desc = EVTDESC_SOH_6810
	picture = GFX_evt_china_stable
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = lny_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6810 # Most auspicious!
		
		prestige = 100
		
		piety = 100
		
		random = {
			chance = 25
			add_trait_partially_proud_effect = yes
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_lny
				ai = no
			}
			
			narrative_event = { id = soh.6811 } # Inform vassals
		}
	}
}

# Great fireworks - vassals
narrative_event = {
	id = soh.6811
	title = EVTTITLE_SOH_6811
	desc = EVTDESC_SOH_6811
	picture = GFX_evt_china_stable
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_6811 # Most auspicious!
	}
}



##### End + cleanup events

# Normal end
character_event = {
	id = soh.6812
	desc = EVTDESC_SOH_6812
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = lny_in_progress
	}

	option = {
		name = EVTOPTA_SOH_6812 # Wishing you prosperity!
		
		prestige = 10
		
		piety = 10
		
		set_character_flag = recent_lny
		
		hidden_tooltip = {
			remove_character_modifier = lny_in_progress
			clr_character_flag = acrobats_hired
			clr_character_flag = coming_to_lny
			clr_character_flag = dragon_boon_fertility
			clr_character_flag = dragon_boon_health
			clr_character_flag = dragon_boon_intelligence
			clr_character_flag = dragon_boon_martial
			clr_character_flag = dragon_boon_prosperity
			clr_character_flag = dragon_boon_rulership
			clr_character_flag = dragon_boon_strength
			clr_character_flag = dragon_boon_wisdom
			clr_character_flag = dragon_combat_undecided
			clr_character_flag = guest_lny_started
			clr_character_flag = helping_with_bandits
			clr_character_flag = helping_with_dragon
			clr_character_flag = host_lny_started
			clr_character_flag = large_fireworks
			clr_character_flag = lavishly_food
			clr_character_flag = lion_dance
			clr_character_flag = lny_cleaned_a_little
			clr_character_flag = lny_cleaned_properly
			clr_character_flag = lny_did_not_clean
			clr_character_flag = lny_element_match
			clr_character_flag = lny_extra_dragon_guards
			clr_character_flag = lny_extravagant_decorations
			clr_character_flag = lny_no_decorations
			clr_character_flag = lny_normal_decorations
			clr_character_flag = lny_zodiac_match
			clr_character_flag = low_food
			clr_character_flag = massive_fireworks
			clr_character_flag = medium_food
			clr_character_flag = musicians_hired
			clr_character_flag = nine_dragon_dance
			clr_character_flag = no_lion_dance
			clr_character_flag = normal_dragon_dance
			clr_character_flag = normal_fireworks
			clr_character_flag = ongoing_dragon_attack
			clr_character_flag = red_envelopes
			clr_character_flag = sent_invitations
			clr_character_flag = small_dragon_dance
			clr_character_flag = small_fireworks
			clr_character_flag = two_dragon_dance
			clr_character_flag = do_not_disturb
			
			any_vassal = {
				limit = {
					has_character_flag = guest_lny_started
				}
				
				character_event = { id = soh.6813 }
				
				remove_opinion = {
					modifier = opinion_enjoyed_lny
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_enjoyed_lny
					who = ROOT
					years = 2
				}
				
				clr_character_flag = coming_to_lny
				clr_character_flag = guest_lny_started
				clr_character_flag = helping_with_bandits
				clr_character_flag = helping_with_dragon
			}
		}
	}
}

# Normal end - vassals
character_event = {
	id = soh.6813
	desc = EVTDESC_SOH_6813
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6813  # Wishing you prosperity!
		
		prestige = 5
		
		piety = 5
	}
}

# LNY cancelled
character_event = {
	id = soh.6814
	desc = EVTDESC_SOH_6814
	picture = GFX_evt_china_isolationist

	only_rulers = yes
	war = yes

	trigger = {
		has_character_modifier = lny_in_progress
		NOT = {
			has_character_flag = ongoing_dragon_attack # Takes precedence
		}
	}
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6814 # I see...
		hidden_tooltip = {
			remove_character_modifier = lny_in_progress
			clr_character_flag = acrobats_hired
			clr_character_flag = coming_to_lny
			clr_character_flag = dragon_boon_fertility
			clr_character_flag = dragon_boon_health
			clr_character_flag = dragon_boon_intelligence
			clr_character_flag = dragon_boon_martial
			clr_character_flag = dragon_boon_prosperity
			clr_character_flag = dragon_boon_rulership
			clr_character_flag = dragon_boon_strength
			clr_character_flag = dragon_boon_wisdom
			clr_character_flag = dragon_combat_undecided
			clr_character_flag = guest_lny_started
			clr_character_flag = helping_with_bandits
			clr_character_flag = helping_with_dragon
			clr_character_flag = host_lny_started
			clr_character_flag = large_fireworks
			clr_character_flag = lavishly_food
			clr_character_flag = lion_dance
			clr_character_flag = lny_cleaned_a_little
			clr_character_flag = lny_cleaned_properly
			clr_character_flag = lny_did_not_clean
			clr_character_flag = lny_element_match
			clr_character_flag = lny_extra_dragon_guards
			clr_character_flag = lny_extravagant_decorations
			clr_character_flag = lny_no_decorations
			clr_character_flag = lny_normal_decorations
			clr_character_flag = lny_zodiac_match
			clr_character_flag = low_food
			clr_character_flag = massive_fireworks
			clr_character_flag = medium_food
			clr_character_flag = musicians_hired
			clr_character_flag = nine_dragon_dance
			clr_character_flag = no_lion_dance
			clr_character_flag = normal_dragon_dance
			clr_character_flag = normal_fireworks
			clr_character_flag = ongoing_dragon_attack
			clr_character_flag = red_envelopes
			clr_character_flag = sent_invitations
			clr_character_flag = small_dragon_dance
			clr_character_flag = small_fireworks
			clr_character_flag = two_dragon_dance
			clr_character_flag = do_not_disturb
			
			any_vassal = {
				limit = {
					has_character_flag = guest_lny_started
				}
				
				letter_event = { id = soh.6815 }
				clr_character_flag = coming_to_lny
				clr_character_flag = guest_lny_started
				clr_character_flag = helping_with_bandits
				clr_character_flag = helping_with_dragon
			}
		}
	}
}

# LNY cancelled - vassals
letter_event = {
	id = soh.6815
	desc = EVTDESC_SOH_6815

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_6815 # I see...
	}
}

# on_war_started - end LNY
character_event = {
	id = soh.6816
	hide_window = yes
	
	is_triggered_only = yes # on_war_started
	
	immediate = {
		ROOT = {
			if = {
				limit = {
					has_character_modifier = lny_in_progress
				}
				
				character_event = { id = soh.6814 }
			}
		}
		
		FROM = {
			if = {
				limit = {
					has_character_modifier = lny_in_progress
				}
				
				character_event = { id = soh.6814 }
			}
		}
	}
}