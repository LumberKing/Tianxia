# Grace events related to Tributes
# By Silverswee(e)per

namespace = soh

# soh.6001-6200 reserved

# Partially inspired by JD logic; MUST be JD-locked



##### Send Gift

### Send Gift - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6002
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_gift_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_gift_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6003 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6004 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6003
	title = EVTTITLE_SOH_6003
	
	desc = {
		text = EVTDESCA_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6003 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6003 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6003 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6004 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6004
	title = EVTTITLE_SOH_6004
	
	desc = {
		text = EVTDESCA_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0
			}
			
			if = {
				limit = {
					ROOT = {
						wealth < 0
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					ROOT = {
						OR = {
							scaled_wealth < 1
							wealth < 1000
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						OR = {
							scaled_wealth < 10
							wealth < 10000
						}
					}
				}
				
				change_variable = {
					which = grace_gain
					value = 150
				}
			}
			
			else = {
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
		
		random_courtier = {
			limit = {
				is_council_eunuch_trigger = yes
			}
			
			preferred_limit = {
				NOT = {
					has_position = loyalist
				}
			}
			
			save_event_target_as = eunuch_target
		}
		
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
			}
			
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6004 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s gold Tribute!"
		
		if = {
			limit = {
				has_dlc = "Conclave"
			}
			
			primary_title = {
				trigger_switch = {
					on_trigger = has_law
					
					eunuch_law_4 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.4
										min = 200
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.3
										min = 150
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
				
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.35
										min = 175
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
						}
					}
					
					eunuch_law_3 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.3
										min = 150
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.35
										min = 175
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
						}
					}
					
					eunuch_law_2 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
						}
					}
					
					eunuch_law_1 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.9
										min = 450
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.05
										min = 25
									}
								}
							}
						}
					}
					
					eunuch_law_0 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.9
										min = 450
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.05
										min = 25
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 1
										min = 500
									}
								}
							}
						}
					}
				}
			}
		}
		
		else = {
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 1
					min = 500
				}
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6005 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				
				OR = {
					wealth < 10000
					scaled_wealth < 10
				}
				
				NOR = {
					trait = content
					trait = charitable
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6004 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s gold Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6006 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			eoc_refuse_tribute_score = yes
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6005
	desc = EVTDESC_SOH_6005
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6005 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6006
	desc = EVTDESC_SOH_6006
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6006 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_gold_tribute
		}
	}
}

### Send Gift - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6008
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_gift_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_gift_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6009 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6010 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6009
	title = EVTTITLE_SOH_6009
	
	desc = {
		text = EVTDESCA_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6009 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6009 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6009 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6010 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6010
	title = EVTTITLE_SOH_6010
	
	desc = {
		text = EVTDESCA_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0
			}
			
			if = {
				limit = {
					ROOT = {
						wealth < 0
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					ROOT = {
						OR = {
							scaled_wealth < 1
							wealth < 1000
						}
					}
				}
				
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						OR = {
							scaled_wealth < 10
							wealth < 10000
						}
					}
				}
				
				change_variable = {
					which = grace_gain
					value = 150
				}
			}
			
			else = {
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
		
		random_courtier = {
			limit = {
				is_council_eunuch_trigger = yes
			}
			
			preferred_limit = {
				NOT = {
					has_position = loyalist
				}
			}
			
			save_event_target_as = eunuch_target
		}
		
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
			}
			
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6010 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s gold Tribute!"
		
		
		
		if = {
			limit = {
				has_dlc = "Conclave"
			}
			
			primary_title = {
				trigger_switch = {
					on_trigger = has_law
					
					eunuch_law_4 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.4
										min = 200
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.3
										min = 150
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
				
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.35
										min = 175
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
						}
					}
					
					eunuch_law_3 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.3
										min = 150
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.35
										min = 175
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
						}
					}
					
					eunuch_law_2 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.4
										min = 200
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.3
										min = 150
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
						}
					}
					
					eunuch_law_1 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.5
										min = 250
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.25
										min = 125
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.9
										min = 450
									}
									
									transfer_scaled_wealth = {
										to = event_target:eunuch_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.05
										min = 25
									}
								}
							}
						}
					}
					
					eunuch_law_0 = {
						trigger_switch = {
							on_trigger = has_law
							
							ci_courtier_law_4 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.6
										min = 300
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.2
										min = 100
									}
									
									scaled_wealth = {
										value = -0.2
										min = 100
									}
								}
							}
							
							ci_courtier_law_3 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.7
										min = 350
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.15
										min = 75
									}
									
									scaled_wealth = {
										value = -0.15
										min = 75
									}
								}
							}
							
							ci_courtier_law_2 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.8
										min = 400
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.1
										min = 50
									}
									
									scaled_wealth = {
										value = -0.1
										min = 50
									}
								}
							}
							
							ci_courtier_law_1 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 0.9
										min = 450
									}
									
									transfer_scaled_wealth = {
										to = event_target:courtier_target
										value = 0.05
										min = 25
									}
									
									scaled_wealth = {
										value = -0.05
										min = 25
									}
								}
							}
							
							ci_courtier_law_0 = {
								event_target:grace_decision_taker = {
									transfer_scaled_wealth = {
										to = ROOT
										value = 1
										min = 500
									}
								}
							}
						}
					}
				}
			}
		}
		
		else = {
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 1
					min = 500
				}
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6011 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				
				OR = {
					wealth < 10000
					scaled_wealth < 10
				}
				
				NOR = {
					trait = content
					trait = charitable
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6010 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s gold Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6012 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			eoc_refuse_tribute_score = yes
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6011
	desc = EVTDESC_SOH_6011
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6011 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6012
	desc = EVTDESC_SOH_6012
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6012 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_gold_tribute
		}
	}
}



##### Become Tributary

### Become Tributary

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6014
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_tributary_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_tributary_fromfrom_trigger = yes
			}
			
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6015 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6016 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6015
	title = EVTTITLE_SOH_6015
	
	desc = {
		text = EVTDESCA_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6015 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6015 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6015 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6016 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6016
	title = EVTTITLE_SOH_6016
	
	desc = {
		text = EVTDESCA_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0
			}
			
			if = {
				limit = {
					tier = emperor
					is_nomadic = no
					is_within_diplo_range = ROOT
				}
				change_variable = {
					which = grace_gain
					value = 400
				}
			}
			
			else_if = {
				limit = {
					OR = {
						is_nomadic = yes
						tier = king
					}
				}
				change_variable = {
					which = grace_gain
					value = 300
				}
			}
			
			else_if = {
				limit = {
					tier = duke
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			else = {
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											any_liege = {
												character = ROOT
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = ROOT
														any_liege = {
															character = ROOT
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															any_liege = {
																character = ROOT
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = proud
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = humble
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6016 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s tributary offer!"
		
		if = {
			limit = {
				NOT = {
					event_target:grace_decision_taker = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												any_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															any_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																any_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			
			make_tributary = {
				who = event_target:grace_decision_taker
				tributary_type = chinese_peripheral_tributary
			}
		}
		
		else = {
			make_tributary = {
				who = event_target:grace_decision_taker
				tributary_type = chinese_imperial_tributary
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6017 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
				trait = stubborn
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6016 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s tributary offer!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6018 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6017
	desc = EVTDESC_SOH_6017
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6017 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6018
	desc = EVTDESC_SOH_6018
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6018 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_tributary
		}
	}
}



##### Supply Horses

### Supply Horses - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6020
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6021 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6022 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6021
	title = EVTTITLE_SOH_6021
	
	desc = {
		text = EVTDESCA_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6021 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6021 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6021 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6022 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6022
	title = EVTTITLE_SOH_6022
	
	desc = {
		text = EVTDESCA_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 200
			}
			
			if = {
				limit = {
					ROOT = {
						war = yes
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = proud
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = humble
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6022 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s horse Tribute!"
		
		capital_scope = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					troops = {
						knights = { 50 50 }
						light_cavalry = { 100 100 }
						horse_archers = { 150 150 }
					}
					attrition = 1.0
					maintenance_multiplier = 0.5
				}
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6023 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				war = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6022 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s horse Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6024 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6023
	desc = EVTDESC_SOH_6023
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6023 # Great!
		
		grace_change_effect = yes
		
		manpower = -300
	}
}

# Offer refused
letter_event = {
	id = soh.6024
	desc = EVTDESC_SOH_6024
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6024 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_horses_tribute
		}
	}
}

### Supply Horses - vassal - NOTHING TO SEE HERE!

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6026
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes # A nomad can never be the GC!
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6027 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6028 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6027
	title = EVTTITLE_SOH_6027
	
	desc = {
		text = EVTDESCA_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6027 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6027 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6027 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6028 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6028
	title = EVTTITLE_SOH_6028
	
	desc = {
		text = EVTDESCA_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 200
			}
			
			if = {
				limit = {
					ROOT = {
						war = yes
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = proud
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = humble
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6028 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s horse Tribute!"
		
		capital_scope = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					troops = {
						knights = { 50 50 }
						light_cavalry = { 100 100 }
						horse_archers = { 150 150 }
					}
					attrition = 1.0
					maintenance_multiplier = 0.5
				}
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6029 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				war = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6028 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s horse Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6030 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6029
	desc = EVTDESC_SOH_6029
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6029 # Great!
		
		grace_change_effect = yes
		
		manpower = -300
	}
}

# Offer refused
letter_event = {
	id = soh.6030
	desc = EVTDESC_SOH_6030
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6030 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_horses_tribute
		}
	}
}



##### Offer Eunuch

### Offer Eunuch - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6032
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6033 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6034 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6033
	title = EVTTITLE_SOH_6033
	
	desc = {
		text = EVTDESCA_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6033 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6033 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6033 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6034 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6034
	title = EVTTITLE_SOH_6034
	
	desc = {
		text = EVTDESCA_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 100
			}
			
			if = {
				limit = {
					e_china = {
						has_law = eunuch_law_4
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_3
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_1
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_0
					}
				}
				divide_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = lustful
						is_adult = yes
						OR = {
							AND = {
								is_female = yes
								NOT = {
									trait = homosexual
								}
							}
							AND = {
								is_female = no
								trait = homosexual
							}
						}
					}
					event_target:tribute_character = {
						is_attractive_trigger = yes
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 8
						diplomacy < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 12
						diplomacy < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 16
						diplomacy < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 8
						martial < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 8
						stewardship < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 12
						stewardship < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 16
						stewardship < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 8
						intrigue < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 12
						intrigue < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 16
						intrigue < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = architect
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = faqih
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6034 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s eunuch Tribute!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			if = {
				limit = {
					prisoner = yes
				}
				prisoner = no
			}
			move_character = event_target:eoc
			force_host = event_target:eoc
			# TIANXIATODO: Make Council Eunuch, if there's a spot
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6035 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		trigger = {
			primary_title = {
				NOT = {
					has_law = eunuch_law_4
				}
			}
		}
		
		name = EVTOPTB_SOH_6034 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s eunuch Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6036 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6035
	desc = EVTDESC_SOH_6035
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6035 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6036
	desc = EVTDESC_SOH_6036
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6036 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_eunuch_tribute
		}
	}
}

### Offer Eunuch - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6038
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6039 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6040 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6039
	title = EVTTITLE_SOH_6039
	
	desc = {
		text = EVTDESCA_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6039 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6039 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6039 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6040 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6040
	title = EVTTITLE_SOH_6040
	
	desc = {
		text = EVTDESCA_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 100
			}
			
			if = {
				limit = {
					e_china = {
						has_law = eunuch_law_4
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_3
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_1
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = eunuch_law_0
					}
				}
				divide_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						is_adult = yes
						trait = lustful
						OR = {
							AND = {
								is_female = yes
								NOT = {
									trait = homosexual
								}
							}
							AND = {
								is_female = no
								trait = homosexual
							}
						}
					}
					event_target:tribute_character = {
						is_attractive_trigger = yes
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 8
						diplomacy < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 12
						diplomacy < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 16
						diplomacy < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 8
						martial < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 8
						stewardship < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 12
						stewardship < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 16
						stewardship < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 8
						intrigue < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 12
						intrigue < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 16
						intrigue < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = architect
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = faqih
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						is_adult = no
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6040 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s eunuch Tribute!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			if = {
				limit = {
					prisoner = yes
				}
				prisoner = no
			}
			move_character = event_target:eoc
			force_host = event_target:eoc
			# TIANXIATODO: Make Council Eunuch, if there's a spot
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6041 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		trigger = {
			primary_title = {
				NOT = {
					has_law = eunuch_law_4
				}
			}
		}
		
		name = EVTOPTB_SOH_6040 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s eunuch Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6042 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6041
	desc = EVTDESC_SOH_6041
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6041 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6042
	desc = EVTDESC_SOH_6042
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6042 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_eunuch_tribute
		}
	}
}



##### Offer Concubine

### Offer Concubine - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6044
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6045 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6046 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6045
	title = EVTTITLE_SOH_6045
	
	desc = {
		text = EVTDESCA_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6045 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6045 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6045 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6046 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6046
	title = EVTTITLE_SOH_6046
	
	desc = {
		text = EVTDESCA_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = lustful
						is_female = no
						NOT = {
							trait = homosexual
						}
						is_adult = yes
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						OR = {
							trait = chaste
							trait = homosexual
							is_female = yes
							is_adult = no
						}
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 8
						diplomacy < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 12
						diplomacy < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 16
						diplomacy < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 8
						martial < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 8
						stewardship < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 12
						stewardship < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 16
						stewardship < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 8
						intrigue < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 12
						intrigue < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 16
						intrigue < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = depressed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = drunkard
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = infirm
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stressed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = wounded
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred_mid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred_high
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = maimed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = immortal
					}
				}
				change_variable = {
					which = grace_gain
					value = 1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = fat
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = malnourished
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = disfigured
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mangled
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_eyed
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_handed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_legged
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = severely_injured
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = bastard
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = legit_bastard
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = twin
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = born_in_the_purple
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = child_of_consort
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = child_of_consort_male
					}
				}
				change_variable = {
					which = grace_gain
					value = -100 # Basically bastardry under Confucianism
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = attractive
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = clubfooted
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = dwarf
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = harelip
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hunchback
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = imbecile
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = inbred
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lisp
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slow
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stutter
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ugly
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = weak
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = giant
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lefthanded
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = sturdy
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = frail
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = dull
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = groomed
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = uncouth
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hedonist
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_schemer
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = socializer
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = poet
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = chaste
					}
					ROOT = {
						trait = lustful
						NOT = {
							trait = homosexual
						}
						is_female = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = temperate
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = charitable
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = kind
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lustful
					}
				}
				change_variable = {
					which = grace_gain
					value = 100 # Good for the dynasty!
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = gluttonous
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = greedy
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = wroth
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = envious
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = cruel
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = erudite
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = honest
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shy
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						has_character_modifier = incestuous_adulteress
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						has_character_modifier = adulteress
					}
				}
				change_variable = {
					which = grace_gain
					value = -500
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						any_close_relative = {
							OR = {
								real_tier = emperor
								controls_religion = yes
							}
							is_nomadic = no
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							real_tier = emperor
							real_tier = king
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.25
				}
			}
			
			if = {
				limit = {
					e_china = {
						has_law = ci_courtier_law_4
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = ci_courtier_law_3
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_dynasty_member = {
			limit = {
				is_adult = yes
				is_female = no
				is_landed = no
				NOT = {
					num_of_consorts = 3
				}
				host = {
					character = ROOT
				}
				NOR = {
					trait = eunuch
					trait = celibate
				}
			}
			
			preferred_limit = {
				any_close_relative = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			
			preferred_limit = {
				OR = {
					is_friend = ROOT
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			
			preferred_limit = {
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = relative_to_give_tribute
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_female = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					num_of_consorts = 3
				}
				has_concubinage = yes
				is_inaccessible_or_incapable_trigger = no
				NOR = {
					dynasty = ROOT
					dynasty = event_target:grace_decision_taker
					dynasty = event_target:tribute_character
					is_descendant_of = event_target:tribute_character
					is_ancestor_of = event_target:tribute_character
					any_close_relative = {
						character = event_target:tribute_character
					}
					trait = eunuch
					trait = celibate
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			is_female = no
			NOR = {
				trait = eunuch
				trait = celibate
			}
		}
		
		name = EVTOPTA_SOH_6046 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					limit = {
						NOT = {
							character = ROOT
						}
					}
					
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							mult_modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			ROOT = {
				add_consort = PREV
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				event_target:tribute_character = {
					trait = attractive
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				trait = stubborn
				event_target:tribute_character = {
					trait = attractive
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				event_target:tribute_character = {
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				trait = stubborn
				event_target:tribute_character = {
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = chaste
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_lover =  event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6046 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s concubine Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6048 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:relative_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6046 # Give the concubine to a relative
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (relative)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					limit = {
						NOT = {
							character = event_target:relative_to_give_tribute
						}
					}
					
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							mult_modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			event_target:relative_to_give_tribute = {
				add_consort = PREV
			}
		}
		
		reverse_opinion = {
			who = event_target:relative_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:relative_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:relative_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:relative_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTD_SOH_6046 # Give the concubine to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					limit = {
						NOT = {
							character = event_target:vassal_to_give_tribute
						}
					}
					
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							mult_modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			event_target:vassal_to_give_tribute = {
				add_consort = PREV
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6055 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value >= 1000
					}
				}
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6047
	desc = {
		text = EVTDESCA_SOH_6047
		trigger = {
			FROM = {
				any_consort = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6047
		trigger = {
			FROM = {
				any_dynasty_member = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6047
		trigger = {
			FROM = {
				any_realm_lord = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROM = {
				any_consort = {
					character = event_target:tribute_character
				}
			}
		}
		
		name = EVTOPTA_SOH_6047 # Great!
		
		grace_change_effect = yes
	}
	
	option = {
		trigger = {
			FROM = {
				any_dynasty_member = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
		
		name = EVTOPTB_SOH_6047 # Great!
		
		grace_change_effect = yes
	}
	
	option = {
		trigger = {
			FROM = {
				any_realm_lord = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
				
		name = EVTOPTC_SOH_6047 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6048
	desc = EVTDESC_SOH_6048
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6048 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_concubine_tribute
		}
	}
}

### Offer Concubine - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6050
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6051 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6052 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6051
	title = EVTTITLE_SOH_6051
	
	desc = {
		text = EVTDESCA_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6051 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6051 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6051 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6052 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6052
	title = EVTTITLE_SOH_6052
	
	desc = {
		text = EVTDESCA_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = lustful
						is_female = no
						NOT = {
							trait = homosexual
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						OR = {
							trait = chaste
							trait = homosexual
							is_female = yes
						}
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 8
						diplomacy < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 12
						diplomacy < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 16
						diplomacy < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						diplomacy >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 8
						martial < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 8
						stewardship < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 12
						stewardship < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 16
						stewardship < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						stewardship >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 8
						intrigue < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 12
						intrigue < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 16
						intrigue < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						intrigue >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						learning >= 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = intricate_webweaver
							trait = charismatic_negotiator
							trait = fortune_builder
							trait = skilled_tactician
							trait = scholarly_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							trait = elusive_shadow
							trait = grey_eminence
							trait = midas_touched
							trait = brilliant_strategist
							trait = mastermind_theologian
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = depressed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = drunkard
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = infirm
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stressed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = wounded
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred_mid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scarred_high
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = maimed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = immortal
					}
				}
				change_variable = {
					which = grace_gain
					value = 1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = fat
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = malnourished
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = disfigured
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mangled
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_eyed
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_handed
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = one_legged
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = severely_injured
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = bastard
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = legit_bastard
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = twin
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = born_in_the_purple
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = child_of_consort
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = child_of_consort_male
					}
				}
				change_variable = {
					which = grace_gain
					value = -100 # Basically bastardry under Confucianism
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = attractive
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = clubfooted
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = dwarf
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = harelip
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hunchback
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = imbecile
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = inbred
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lisp
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slow
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stutter
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ugly
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = weak
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = giant
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lefthanded
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = sturdy
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = frail
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = dull
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = groomed
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = uncouth
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hedonist
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_schemer
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = socializer
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = poet
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = chaste
					}
					ROOT = {
						trait = lustful
						NOT = {
							trait = homosexual
						}
						is_female = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = temperate
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = charitable
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = kind
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = lustful
					}
				}
				change_variable = {
					which = grace_gain
					value = 100 # Good for the dynasty!
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = gluttonous
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = greedy
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = wroth
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = envious
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = cruel
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = erudite
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = honest
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shy
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						has_character_modifier = incestuous_adulteress
					}
				}
				change_variable = {
					which = grace_gain
					value = -1000
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						has_character_modifier = adulteress
					}
				}
				change_variable = {
					which = grace_gain
					value = -500
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						any_close_relative = {
							OR = {
								real_tier = emperor
								controls_religion = yes
							}
							is_nomadic = no
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						OR = {
							real_tier = emperor
							real_tier = king
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.25
				}
			}
			
			if = {
				limit = {
					e_china = {
						has_law = ci_courtier_law_4
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = ci_courtier_law_3
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_dynasty_member = {
			limit = {
				is_adult = yes
				is_female = no
				is_landed = no
				NOT = {
					num_of_consorts = 3
				}
				host = {
					character = ROOT
				}
				NOR = {
					trait = eunuch
					trait = celibate
				}
			}
			
			preferred_limit = {
				any_close_relative = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			
			preferred_limit = {
				OR = {
					is_friend = ROOT
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			
			preferred_limit = {
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = relative_to_give_tribute
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_female = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					num_of_consorts = 3
				}
				has_concubinage = yes
				is_inaccessible_or_incapable_trigger = no
				NOR = {
					dynasty = ROOT
					dynasty = event_target:grace_decision_taker
					dynasty = event_target:tribute_character
					is_descendant_of = event_target:tribute_character
					is_ancestor_of = event_target:tribute_character
					any_close_relative = {
						character = event_target:tribute_character
					}
					trait = eunuch
					trait = celibate
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				is_friend = ROOT
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				is_friend = ROOT
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		trigger = {
			is_adult = yes
			is_female = no
			NOR = {
				trait = eunuch
				trait = celibate
			}
		}
		
		name = EVTOPTA_SOH_6052 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			ROOT = {
				add_consort = PREV
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOR = {
					is_female = yes
					is_adult = no
					trait = homosexual
				}
				event_target:tribute_character = {
					trait = attractive
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOR = {
					is_female = yes
					is_adult = no
					trait = homosexual
				}
				trait = stubborn
				event_target:tribute_character = {
					trait = attractive
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOR = {
					is_female = yes
					is_adult = no
					trait = homosexual
				}
				event_target:tribute_character = {
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = lustful
				NOR = {
					is_female = yes
					is_adult = no
					trait = homosexual
				}
				trait = stubborn
				event_target:tribute_character = {
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = chaste
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_lover =  event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6052 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s concubine Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6054 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:relative_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6052 # Give the concubine to a relative
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (relative)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			event_target:relative_to_give_tribute = {
				add_consort = PREV
			}
		}
		
		reverse_opinion = {
			who = event_target:relative_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:relative_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:relative_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:relative_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTD_SOH_6052 # Give the concubine to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s concubine Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			event_target:vassal_to_give_tribute = {
				add_consort = PREV
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6055 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value >= 500
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value >= 1000
					}
				}
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6053
	desc = {
		text = EVTDESCA_SOH_6053
		trigger = {
			FROM = {
				any_consort = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6053
		trigger = {
			FROM = {
				any_dynasty_member = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6053
		trigger = {
			FROM = {
				any_realm_lord = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6053 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6054
	desc = EVTDESC_SOH_6054
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6054 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_concubine_tribute
		}
	}
}

### Inform vassal

# Vassal got concubine
letter_event = {
	id = soh.6055
	desc = EVTDESC_SOH_6055
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = homosexual
			}
		}
		
		name = EVTOPTA_SOH_6055 # Nice!
		
		add_consort = event_target:tribute_character
	}
	
	option = {
		trigger = {
			trait = homosexual
		}
		
		name = EVTOPTB_SOH_6055 # That's... nice?
		
		add_consort = event_target:tribute_character
	}
}



##### Offer Commander

### Offer Commander - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6057
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6058 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6059 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6058
	title = EVTTITLE_SOH_6058
	
	desc = {
		text = EVTDESCA_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6058 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6058 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6058 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6059 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6059
	title = EVTTITLE_SOH_6059
	
	desc = {
		text = EVTDESCA_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			if = {
				limit = {
					ROOT = {
						war = yes
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = ambitious
						war = no
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						trait = content
						war = no
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tributary_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = misguided_warrior
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = tough_soldier
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = skilled_tactician
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brilliant_strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 14
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 14
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 18
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 18
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
						martial < 22
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 22
						martial < 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = duelist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hunter
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = game_master
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = adventurer
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brave
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = craven
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shieldmaiden
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = sapper
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_of_flame
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = logistics_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = levy_coordinator
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = light_foot_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = heavy_infantry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = cavalry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = inspiring_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trickster
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = organizer
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = defensive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = direct_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = flanker
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = aggressive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = siege_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = war_elephant_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = desert_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = flat_terrain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = jungle_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mountain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = rough_terrain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = norse_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = tengri_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = baltic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = finnish_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slavic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = west_african_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = zun_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = bon_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hellenic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = rising_sun_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ainu_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					e_china = {
						has_law = ci_vassal_law_4
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = ci_vassal_law_3
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				in_faction = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					e_china = {
						claimed_by = PREV
					}
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6059 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s commander Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6060 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6059 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s commander Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6061 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6059 # Give the commander to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s commander Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6068 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6060 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6060
	desc = {
		text = EVTDESCA_SOH_6060
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6060
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6060 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6061
	desc = EVTDESC_SOH_6061
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6061 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_commander_tribute
		}
	}
}

### Offer Commander - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6063
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6064 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6065 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6064
	title = EVTTITLE_SOH_6064
	
	desc = {
		text = EVTDESCA_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6064 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6064 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6064 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6065 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6065
	title = EVTTITLE_SOH_6065
	
	desc = {
		text = EVTDESCA_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			if = {
				limit = {
					ROOT = {
						war = yes
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = ambitious
						war = no
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					ROOT = {
						trait = content
						war = no
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tributary_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = misguided_warrior
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = tough_soldier
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = skilled_tactician
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brilliant_strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						martial >= 12
						martial < 14
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 14
						martial < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 16
						martial < 18
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 18
						martial < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 20
						martial < 22
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 22
						martial < 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 120
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_character = {
						martial >= 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strong
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brawny
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 30
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = strategist
					}
				}
				change_variable = {
					which = grace_gain
					value = 80
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = duelist
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hunter
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = administrator
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = game_master
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = adventurer
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -40
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = brave
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = craven
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = shieldmaiden
					}
				}
				change_variable = {
					which = grace_gain
					value = 20
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = sapper
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = master_of_flame
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = logistics_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = levy_coordinator
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = light_foot_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = heavy_infantry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = cavalry_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = inspiring_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = trickster
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = organizer
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = defensive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = direct_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = flanker
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = aggressive_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = siege_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = war_elephant_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = desert_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = flat_terrain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = jungle_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = mountain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = rough_terrain_expert
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = norse_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = tengri_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = baltic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = finnish_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = slavic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = west_african_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = zun_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = bon_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = hellenic_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = rising_sun_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tribute_character = {
						trait = ainu_leader
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					e_china = {
						has_law = ci_vassal_law_4
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 2
				}
			}
			
			else_if = {
				limit = {
					e_china = {
						has_law = ci_vassal_law_3
					}
				}
				divide_variable = { # Interloper!
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				in_faction = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					e_china = {
						claimed_by = PREV
					}
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6065 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s commander Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6066 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 400
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 300
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 800
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 600
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6065 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s commander Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6067 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6065 # Give the commander to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s commander Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6068 } # Inform vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6066 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6066
	desc = {
		text = EVTDESCA_SOH_6066
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6066
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6066 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6067
	desc = EVTDESC_SOH_6067
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6067 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_commander_tribute
		}
	}
}

### Inform vassal

# Vassal got commander
letter_event = {
	id = soh.6068
	desc = EVTDESC_SOH_6068
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6068 # Nice!
	}
}



##### Offer Physician

### Offer Physician - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6070
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6071 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6072 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6071
	title = EVTTITLE_SOH_6071
	
	desc = {
		text = EVTDESCA_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6071 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6071 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6071 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6072 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6072
	title = EVTTITLE_SOH_6072
	
	desc = {
		text = EVTDESCA_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						is_ill = yes
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						any_demesne_province = {
							has_disease = yes
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tributary_character = {
						learning < 8
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 20
						learning < 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 24
						learning < 28
					}
				}
				change_variable = {
					which = grace_gain
					value = 180
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 28
						learning < 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 220
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 260
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = detached_priest
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = dutiful_cleric
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = scholarly_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = mastermind_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = temperate
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = kind
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = gluttonous
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = greedy
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = wroth
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = envious
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = cruel
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = cynical
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = erudite
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = honest
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = shy
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6072 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s physician Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6073 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_ill = yes
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6072 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s physician Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6074 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6072 # Give the physician to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s physician Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6081 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6073 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
				event_target:vassal_to_give_tribute = {
					is_ill = yes
				}
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6073
	desc = {
		text = EVTDESCA_SOH_6073
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6073
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6073 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6074
	desc = EVTDESC_SOH_6074
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6074 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_physician_tribute
		}
	}
}

### Offer Physician - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6076
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6077 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6078 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6077
	title = EVTTITLE_SOH_6077
	
	desc = {
		text = EVTDESCA_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6077 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6077 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6077 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6078 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6078
	title = EVTTITLE_SOH_6078
	
	desc = {
		text = EVTDESCA_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						is_ill = yes
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						any_demesne_province = {
							has_disease = yes
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tributary_character = {
						learning < 8
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 8
						learning < 12
					}
				}
				change_variable = {
					which = grace_gain
					value = 40
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 12
						learning < 16
					}
				}
				change_variable = {
					which = grace_gain
					value = 60
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 16
						learning < 20
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 20
						learning < 24
					}
				}
				change_variable = {
					which = grace_gain
					value = 140
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 24
						learning < 28
					}
				}
				change_variable = {
					which = grace_gain
					value = 180
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 28
						learning < 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 220
				}
			}
			
			else_if = {
				limit = {
					event_target:tributary_character = {
						learning >= 32
					}
				}
				change_variable = {
					which = grace_gain
					value = 260
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = genius
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = quick
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = shrewd
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = physician
					}
				}
				change_variable = {
					which = grace_gain
					value = 200
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = mystic
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = scholar
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = lunatic
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = possessed
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = detached_priest
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = dutiful_cleric
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = scholarly_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 75
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = mastermind_theologian
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = temperate
					}
				}
				change_variable = {
					which = grace_gain
					value = 25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = diligent
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = patient
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = kind
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = humble
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = gluttonous
					}
				}
				change_variable = {
					which = grace_gain
					value = -25
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = greedy
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = slothful
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = wroth
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = envious
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = proud
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = ambitious
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = arbitrary
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = content
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = cruel
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = cynical
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = deceitful
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = erudite
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = gregarious
					}
				}
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = honest
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = just
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = paranoid
					}
				}
				change_variable = {
					which = grace_gain
					value = -50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = shy
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = stubborn
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = trusting
					}
				}
				change_variable = {
					which = grace_gain
					value = 50
				}
			}
			
			if = {
				limit = {
					event_target:tributary_character = {
						trait = zealous
						can_have_chinese_imperial_only_religion_trigger = no
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6078 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s physician Tribute (self)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6079 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:tribute_character = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_ill = yes
			}
			
			mult_modifier = {
				factor = 1000
				is_friend = event_target:tribute_character
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6078 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s physician Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6080 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6078 # Give the physician to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s physician Tribute (vassal)!"
		
		event_target:tribute_character = {
			show_portrait = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6081 } # Inform vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6079 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
				event_target:vassal_to_give_tribute = {
					is_ill = yes
				}
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6079
	desc = {
		text = EVTDESCA_SOH_6079
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6079
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6079 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6080
	desc = EVTDESC_SOH_6080
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6080 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_physician_tribute
		}
	}
}

### Inform vassal

# Vassal got physician
letter_event = {
	id = soh.6081
	desc = EVTDESC_SOH_6081
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6081 # Nice!
	}
}



##### Offer Artifact

### Offer Artifact - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6083
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6084 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6085 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6084
	title = EVTTITLE_SOH_6084
	desc = {
		text = EVTDESCA_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6084 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTB_SOH_6084 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTC_SOH_6084 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6085 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6085
	title = EVTTITLE_SOH_6085
	
	desc = {
		text = EVTDESCA_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 500
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						artifact_type = heirloom_seal_of_the_realm
					}
				}
				set_variable = {
					which = grace_gain
					value = 10000
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = envious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 5
					}
				}
				change_variable = {
					which = grace_gain
					value = 4500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
					}
				}
				change_variable = {
					which = grace_gain
					value = 2500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 3
					}
				}
				change_variable = {
					which = grace_gain
					value = 1500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 2
					}
				}
				change_variable = {
					which = grace_gain
					value = 500
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality < 4
						has_artifact_flag = lore # Magnum Opus book
						ROOT = {
							NOT = {
								society_member_of = hermetics
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -300
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
						has_artifact_flag = lore # Magnum Opus book
						ROOT = {
							NOT = {
								society_member_of = hermetics
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality < 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -350
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -250
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						has_artifact_flag = ingredient
					}
					ROOT = {
						NOT = {
							society_member_of = hermetics # Or that other one... # Or that other one...
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.1
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_list = {
			33 = {
				trigger = {
					has_dlc = "Conclave"
					primary_title = {
						NOT = {
							has_law = eunuch_law_0
						}
					}
				}
				
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = eunuch_law_2
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = eunuch_law_4
					}
				}
				
				random_courtier = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					
					preferred_limit = {
						NOT = {
							has_position = loyalist
						}
					}
					
					save_event_target_as = eunuch_target
				}
			}
			
			34 = {
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = ci_courtier_law_3
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = ci_courtier_law_4
					}
				}
				
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						OR = {
							AND = {
								is_voter = yes
								NOT = {
									has_position = loyalist
								}
							}
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
					}
					
					save_event_target_as = courtier_target
				}
			}
			
			33 = {
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = ci_vassal_law_3
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = ci_vassal_law_4
					}
				}
				
				random_realm_lord = {
					limit = {
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							character = event_target:grace_decision_taker
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					save_event_target_as = vassal_to_give_tribute
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6085 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = ROOT
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = greedy
			}
			
			mult_modifier = {
				factor = 10
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 2500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 2000
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1500
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 5000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 4000
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 3000
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTB_SOH_6085 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s artifact Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6087 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTC_SOH_6085 # Give the artifact to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (vassal)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:vassal_to_give_tribute
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6094 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTD_SOH_6085 # Give the artifact to a courtier
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (courtier)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:courtier_target
			}
		}
		
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:courtier_target = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			event_target:eunuch_target = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTE_SOH_6085 # Give the artifact to a eunuch
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (eunuch)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:eunuch_target
			}
		}
		reverse_opinion = {
			who = event_target:eunuch_target
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:eunuch_target = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6086
	desc = {
		text = EVTDESCA_SOH_6086
		trigger = {
			event_target:tribute_artifact = {
				owner = {
					character = FROM
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6086
		trigger = {
			event_target:tribute_artifact = {
				owner = {
					NOT = {
						character = FROM
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6086 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6087
	desc = EVTDESC_SOH_6087
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6087 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_artifact_tribute
		}
	}
}

### Offer Artifact - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6089
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6090 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6091 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6090
	title = EVTTITLE_SOH_6090
	
	desc = {
		text = EVTDESCA_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6090 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTB_SOH_6090 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTC_SOH_6090 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6091 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6091
	title = EVTTITLE_SOH_6091
	
	desc = {
		text = EVTDESCA_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 500
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						artifact_type = heirloom_seal_of_the_realm
					}
				}
				set_variable = {
					which = grace_gain
					value = 10000
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = envious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 5
					}
				}
				change_variable = {
					which = grace_gain
					value = 4500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
					}
				}
				change_variable = {
					which = grace_gain
					value = 2500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 3
					}
				}
				change_variable = {
					which = grace_gain
					value = 1500
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 2
					}
				}
				change_variable = {
					which = grace_gain
					value = 500
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality < 4
						has_artifact_flag = lore # Magnum Opus book
						ROOT = {
							NOT = {
								society_member_of = hermetics
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -300
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
						has_artifact_flag = lore #Magnum Opus book
						ROOT = {
							NOT = {
								society_member_of = hermetics
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -200
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						quality < 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -350
				}
			}
			
			else_if = {
				limit = {
					event_target:tribute_artifact = {
						quality == 4
						has_artifact_flag = created
					}
				}
				change_variable = {
					which = grace_gain
					value = -250
				}
			}
			
			if = {
				limit = {
					event_target:tribute_artifact = {
						has_artifact_flag = ingredient
					}
					ROOT = {
						NOT = {
							society_member_of = hermetics # Or that other one... # Or that other one...
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.1
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
		
		random_list = {
			33 = {
				trigger = {
					has_dlc = "Conclave"
					primary_title = {
						NOT = {
							has_law = eunuch_law_0
						}
					}
				}
				
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = eunuch_law_2
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = eunuch_law_4
					}
				}
				
				random_courtier = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					
					preferred_limit = {
						NOT = {
							has_position = loyalist
						}
					}
					
					save_event_target_as = eunuch_target
				}
			}
			
			34 = {
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = ci_courtier_law_3
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = ci_courtier_law_4
					}
				}
				
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						OR = {
							AND = {
								is_voter = yes
								NOT = {
									has_position = loyalist
								}
							}
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
					}
					
					preferred_limit = {
						OR = {
							is_rival = ROOT
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = master_schemer
							trait = greedy
							trait = arbitrary
						}
					}
					
					save_event_target_as = courtier_target
				}
			}
			
			33 = {
				mult_modifier = {
					factor = 2
					primary_title = {
						has_law = ci_vassal_law_3
					}
				}
				
				mult_modifier = {
					factor = 5
					primary_title = {
						has_law = ci_vassal_law_4
					}
				}
				
				random_realm_lord = {
					limit = {
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							character = event_target:grace_decision_taker
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_feudal = yes
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					save_event_target_as = vassal_to_give_tribute
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6091 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (self)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = ROOT
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = greedy
			}
			
			mult_modifier = {
				factor = 10
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 2500
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 2000
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 1500
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 5000
					}
				}
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 4000
					}
				}
				has_character_modifier = mandate_of_heaven_4
			}
			
			mult_modifier = {
				factor = 0.5
				event_target:grace_decision_taker = {
					check_variable = {
						which = grace_gain
						value < 3000
					}
				}
				has_character_modifier = mandate_of_heaven_3
			}
		}
	}
	
	option = {
		trigger = {
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTB_SOH_6091 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s artifact Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6093 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTC_SOH_6091 # Give the artifact to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (vassal)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:vassal_to_give_tribute
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6094 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTD_SOH_6091 # Give the artifact to a courtier
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (courtier)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:courtier_target
			}
		}
		
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:courtier_target = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			event_target:eunuch_target = {
				always = yes
			}
			event_target:tribute_artifact = {
				NOT = {
					artifact_type = heirloom_seal_of_the_realm
				}
			}
		}
		
		name = EVTOPTE_SOH_6091 # Give the artifact to a eunuch
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s artifact Tribute (eunuch)!"
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:eunuch_target
			}
		}
		
		reverse_opinion = {
			who = event_target:eunuch_target
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:eunuch_target = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:eunuch_target
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6092
	desc = {
		text = EVTDESCA_SOH_6092
		trigger = {
			event_target:tribute_artifact = {
				owner = {
					character = FROM
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6092
		trigger = {
			event_target:tribute_artifact = {
				owner = {
					NOT = {
						character = FROM
					}
				}
			}
		}
	}
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6092 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6093
	desc = EVTDESC_SOH_6093
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6093 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_artifact_tribute
		}
	}
}

### Inform vassal

# Vassal got artifact
letter_event = {
	id = soh.6094
	desc = EVTDESC_SOH_6094
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6094 # Nice!
	}
}



##### Renounce Claims

### - Renounce Claims - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6096
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_renounce_claims_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_renounce_claims_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6097 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6098 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6097
	title = EVTTITLE_SOH_6097
	
	desc = {
		text = EVTDESCA_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6097 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6097 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6097 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6098 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6098
	title = EVTTITLE_SOH_6098
	
	desc = {
		text = EVTDESCA_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			
			if = {
				limit = {
					any_claim = {
						tier = emperor
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 5000
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = king
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
				}
				any_claim = {
					limit = {
						tier = king
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
					if = {
						limit = {
							holder_scope = {
								character = ROOT
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 1000
							}
						}
					}
					else = {
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 500
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = duke
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
				}
				any_claim = {
					limit = {
						tier = duke
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
					if = {
						limit = {
							holder_scope = {
								character = ROOT
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 500
							}
						}
					}
					else = {
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 250
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = duke
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
				}
				any_claim = {
					limit = {
						tier = count
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							top_liege = {
								character = ROOT
							}
						}
					}
					if = {
						limit = {
							holder_scope = {
								character = ROOT
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 100
							}
						}
					}
					else = {
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 50
							}
						}
					}
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = craven
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = brave
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.1
					}
				}
				
				multiply_variable = {
					which = grace_gain
					value = 0.1
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.1
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.2
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.5
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power >= 1.5
					}
					relative_power = {
						who = ROOT
						power < 2
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power >= 2
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6098 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce claims Tribute!"
		
		custom_tooltip = {
			text = tribute_renounce_claims
			any_demesne_title = {
				limit = {
					claimed_by = event_target:grace_decision_taker
					controls_religion = no
					NOT = {
						de_jure_vassal_or_below = event_target:grace_decision_taker
					}
				}
				remove_claim = event_target:grace_decision_taker
			}
			
			any_realm_lord = {
				any_demesne_title = {
					limit = {
						claimed_by = event_target:grace_decision_taker
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
					}
					remove_claim = event_target:grace_decision_taker
				}
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6099 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_6098 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s renounce claims Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6100 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6099
	desc = EVTDESC_SOH_6099
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6099 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6100
	desc = EVTDESC_SOH_6100
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6100 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_renounce_claims_tribute
		}
	}
}

### Renounce Claims - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6102
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_renounce_claims_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_renounce_claims_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6103 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6104 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6103
	title = EVTTITLE_SOH_6103
	
	desc = {
		text = EVTDESCA_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6103 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6103 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6103 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6104 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6104
	title = EVTTITLE_SOH_6104
	
	desc = {
		text = EVTDESCA_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			
			if = {
				limit = {
					any_claim = {
						tier = emperor
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = 5000
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = king
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
				}
				any_claim = {
					limit = {
						tier = king
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
					event_target:grace_decision_taker = {
						change_variable = {
							which = grace_gain
							value = 1000
						}
					}
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = duke
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
				}
				any_claim = {
					limit = {
						tier = duke
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
					event_target:grace_decision_taker = {
						change_variable = {
							which = grace_gain
							value = 500
						}
					}
				}
			}
			
			if = {
				limit = {
					any_claim = {
						tier = count
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
				}
				any_claim = {
					limit = {
						tier = count
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
						holder_scope = {
							character = ROOT
						}
					}
					event_target:grace_decision_taker = {
						change_variable = {
							which = grace_gain
							value = 100
						}
					}
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = craven
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = brave
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.1
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.1
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.2
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.2
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power < 0.5
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 0.5
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power >= 1.5
					}
					relative_power = {
						who = ROOT
						power < 2
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					relative_power = {
						who = ROOT
						power >= 2
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
			
			if = {
				limit = {
					NOT = {
						check_variable = {
							which = grace_gain
							value = 0
						}
					}
				}
				set_variable = {
					which = grace_gain
					value = 0
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6104 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce claims Tribute!"
		
		custom_tooltip = {
			text = tribute_renounce_claims
			any_demesne_title = {
				limit = {
					claimed_by = event_target:grace_decision_taker
					controls_religion = no
					NOT = {
						de_jure_vassal_or_below = event_target:grace_decision_taker
					}
				}
				remove_claim = event_target:grace_decision_taker
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6105 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_6104 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s renounce claims Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6106 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6105
	desc = EVTDESC_SOH_6105
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6105 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6106
	desc = EVTDESC_SOH_6106
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6106 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_renounce_claims_tribute
		}
	}
}



##### Cancel Favor (Tribute)

### Cancel Favor - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6108
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6109 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6110 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6109
	title = EVTTITLE_SOH_6109
	
	desc = {
		text = EVTDESCA_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6109 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6109 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6109 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6110 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6110
	title = EVTTITLE_SOH_6110
	
	desc = {
		text = EVTDESCA_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 400
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6110 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce Favor Tribute!"
		
		reverse_remove_favor = event_target:grace_decision_taker
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6111 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_6110 # Refuse
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce Favor Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6112 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6111
	desc = EVTDESC_SOH_6111
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6111 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6112
	desc = EVTDESC_SOH_6112
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6112 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_cancel_favor_tribute
		}
	}
}

### Cancel Favor (Tribute) - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6114
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6115 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6116 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6115
	title = EVTTITLE_SOH_6115
	
	desc = {
		text = EVTDESCA_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6115 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6115 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6115 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6116 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6116
	title = EVTTITLE_SOH_6116
	
	desc = {
		text = EVTDESCA_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 400
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6116 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce Favor Tribute!"
		
		reverse_remove_favor = event_target:grace_decision_taker
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6117 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_6116 # Refuse
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s renounce Favor Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6118 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6117
	desc = EVTDESC_SOH_6117
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6117 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6118
	desc = EVTDESC_SOH_6118
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6118 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_cancel_favor_tribute
		}
	}
}



##### Transfer Prosperity

### Transfer Prosperity - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6120
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_prosperity_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_prosperity_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6121 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6122 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6121
	title = EVTTITLE_SOH_6121
	
	desc = {
		text = EVTDESCA_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6121 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6121 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6121 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6122 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6122
	title = EVTTITLE_SOH_6122
	
	desc = {
		text = EVTDESCA_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 400
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				any_demesne_province = {
					NOT = {
						has_province_modifier = prosperity_modifier_3
					}
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				is_feudal = yes
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		trigger = {
			any_demesne_province = {
				NOT = {
					has_province_modifier = prosperity_modifier_3
				}
			}
		}
		
		name = EVTOPTA_SOH_6122 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s transfer Prosperity Tribute (self)!"
		
		event_target:grace_decision_taker = {
			random_demesne_province = {
				limit = {
					OR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				
				preferred_limit = {
					NOT = {
						event_target:grace_decision_taker = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
				
				decrease_prosperity_effect = yes
			}
		}
		
		random_demesne_province = {
			preferred_limit = {
				ROOT = {
					capital_scope = {
						province = PREVPREV
					}
				}
			}
			
			preferred_limit = {
				has_province_modifier = depopulated_3
			}
			
			preferred_limit = {
				has_province_modifier = depopulated_2
			}
			
			preferred_limit = {
				has_province_modifier = depopulated_1
			}
			
			preferred_limit = {
				NOR = {
					has_province_modifier = prosperity_modifier_1
					has_province_modifier = prosperity_modifier_2
					has_province_modifier = prosperity_modifier_3
				}
			}
			
			preferred_limit = {
				has_province_modifier = prosperity_modifier_1
			}
			
			preferred_limit = {
				has_province_modifier = prosperity_modifier_2
			}
			
			if = {
				limit = {
					OR = {
						has_province_modifier = depopulated_3
						has_province_modifier = depopulated_2
						has_province_modifier = depopulated_1
					}
				}
				decrease_depopulation_effect = yes
			}
			
			else = {
				hidden_tooltip = { change_variable = { which = prosperity_value value = 100 } }
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6123 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6122 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s transfer Prosperity Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6124 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6122 # Give it to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s transfer Prosperity Tribute (vassal)!"
		
		event_target:grace_decision_taker = {
			random_demesne_province = {
				limit = {
					OR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				
				preferred_limit = {
					NOT = {
						event_target:grace_decision_taker = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
				
				decrease_prosperity_effect = yes
			}
		}
		
		event_target:vassal_to_give_tribute = {
			random_demesne_province = {
				preferred_limit = {
					has_province_modifier = depopulated_3
				}
				
				preferred_limit = {
					has_province_modifier = depopulated_2
				}
				
				preferred_limit = {
					has_province_modifier = depopulated_1
				}
				
				preferred_limit = {
					event_target:vassal_to_give_tribute = {
						capital_scope = {
							province = PREVPREV
						}
					}
				}
				
				preferred_limit = {
					NOR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				
				preferred_limit = {
					has_province_modifier = prosperity_modifier_1
				}
				
				preferred_limit = {
					has_province_modifier = prosperity_modifier_2
				}
				
				if = {
					limit = {
						OR = {
							has_province_modifier = depopulated_3
							has_province_modifier = depopulated_2
							has_province_modifier = depopulated_1
						}
					}
					decrease_depopulation_effect = yes
				}
				
				else = {
					hidden_tooltip = { change_variable = { which = prosperity_value value = 100 } }
				}
			}
		}
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6125 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6123 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6123
	desc = EVTDESC_SOH_6123
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6123 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6124
	desc = EVTDESC_SOH_6124
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6124 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_transfer_prosperity_tribute
		}
	}
}

### Inform vassal

# Vassal got Prosperity
letter_event = {
	id = soh.6125
	desc = EVTDESC_SOH_6125
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6125 # Nice!
	}
}



##### Transfer Society Currency

### Transfer Society Currency - non-vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6127
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						OR = {
							FROMFROM = {
								is_secret_society_member = no
							}
							same_society_as = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6128 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6129 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6128
	title = EVTTITLE_SOH_6128
	
	desc = {
		text = EVTDESCA_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6128 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6128 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6128 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6129 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6129
	title = EVTTITLE_SOH_6129
	
	desc = {
		text = EVTDESCA_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = no
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCM_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCN_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCO_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCP_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = envious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = kind
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6129 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s transfer society currency Tribute!"
		
		change_society_currency = 1000
		event_target:grace_decision_taker = {
			change_society_currency = -1000
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
					is_secret_society_member = no
				}
			}
			
			prestige = -500
			
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				
				set_council_malcontent = yes
				
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			
			hidden_tooltip = {
				mandate_penalty_trivial_effect = yes
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6130 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = envious
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6129 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s transfer society currency Tribute!"
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
					is_secret_society_member = no
				}
			}
			
			prestige = -500
			
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				
				set_council_malcontent = yes
				
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			
			hidden_tooltip = {
				mandate_penalty_trivial_effect = yes
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6131 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6130
	desc = EVTDESC_SOH_6130
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6130 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6131
	desc = EVTDESC_SOH_6131
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6131 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_transfer_society_currency_tribute
		}
	}
}

### Transfer Society Currency - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6133
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6134 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6135 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6134
	title = EVTTITLE_SOH_6134
	
	desc = {
		text = EVTDESCA_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				is_secret_society_member = no
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				is_secret_society_member = yes
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6134 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6134 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6134 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6135 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6135
	title = EVTTITLE_SOH_6135
	
	desc = {
		text = EVTDESCA_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 100
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = envious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = kind
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6135 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s transfer society currency Tribute!"
		
		change_society_currency = 1000
		event_target:grace_decision_taker = {
			change_society_currency = -1000
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
					is_secret_society_member = no
				}
			}
			
			prestige = -500
			
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				
				set_council_malcontent = yes
				
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			
			hidden_tooltip = {
				mandate_penalty_trivial_effect = yes
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6136 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = envious
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6135 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s transfer society currency Tribute!"
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
					is_secret_society_member = no
				}
			}
			
			prestige = -500
			
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				
				set_council_malcontent = yes
				
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			
			hidden_tooltip = {
				mandate_penalty_trivial_effect = yes
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6137 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6136
	desc = EVTDESC_SOH_6136
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6136 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6137
	desc = EVTDESC_SOH_6137
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6137 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_transfer_society_currency_tribute
		}
	}
}



##### Boost Mandate

### Boost Mandate - vassal

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6139
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_moh_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_moh_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6140 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6141 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6140
	title = EVTTITLE_SOH_6140
	
	desc = {
		text = EVTDESCA_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6140 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6140 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6140 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6141 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6141
	title = EVTTITLE_SOH_6141
	
	desc = {
		text = EVTDESCA_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			set_variable = {
				which = grace_gain
				value = 400
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = humble
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = proud
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = paranoid
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = trusting
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6141 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s Mandate boost Tribute!"
		
		hidden_tooltip = {
			if = {
				limit = {
					event_target:grace_decision_taker = {
						real_tier = king
					}
				}
				mandate_boost_medium_effect = yes
			}
			
			else_if = {
				limit = {
					event_target:grace_decision_taker = {
						real_tier = duke
					}
				}
				mandate_boost_small_effect = yes
			}
			
			else = {
				mandate_boost_trivial_effect = yes
			}
		}
		
		event_target:grace_decision_taker = {
			scaled_prestige = {
				value = -1
				min = -1000
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6142 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				has_character_modifier = mandate_of_heaven_1
			}
			
			mult_modifier = {
				factor = 5
				has_character_modifier = mandate_of_heaven_2
			}
			
			mult_modifier = {
				factor = 2
				has_character_modifier = mandate_of_heaven_3
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6141 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s Mandate boost Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6143 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				has_character_modifier = mandate_of_heaven_5
			}
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6142
	desc = EVTDESC_SOH_6142
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6142 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6143
	desc = EVTDESC_SOH_6143
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6143 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_boost_moh_tribute
		}
	}
}



##### Ask to Increase Tributary Tier

### Ask to Increase Tributary Tie

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6145
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_increase_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_increase_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6146 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6147 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6146
	title = EVTTITLE_SOH_6146
	
	desc = {
		text = EVTDESCA_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6146 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6146 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6146 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6147 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6147
	title = EVTTITLE_SOH_6147
	
	desc = {
		text = EVTDESCA_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			
			if = {
				limit = {
					is_tributary = {
						type = chinese_client_state
					}
				}
				change_variable = {
					which = grace_gain
					value = 1000
				}
			}
			
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_protectorate
					}
				}
				change_variable = {
					which = grace_gain
					value = 500
				}
			}
			
			else_if = {
				limit = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				change_variable = {
					which = grace_gain
					value = 250
				}
			}
			
			else = {
				change_variable = {
					which = grace_gain
					value = 100
				}
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = humble
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = proud
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6147 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s offer to increase tributary tier!"
		
		event_target:grace_decision_taker = {
			increase_tributary_tier_or_vassalize_effect = yes
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6148 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6147 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s offer to increase tributary tier!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6149 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6148
	desc = EVTDESC_SOH_6148
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6148 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6149
	desc = EVTDESC_SOH_6149
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6149 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_increase_tributary_tier
		}
	}
}



##### Hand Over Title

### Hand Over Title

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6151
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						NOT = {
							character = FROMFROM
						}
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6152 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			
			event_target:eoc = {
				narrative_event = { id = soh.6153 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6152
	title = EVTTITLE_SOH_6152
	
	desc = {
		text = EVTDESCA_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6152 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6152 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6152 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6153 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6153
	title = EVTTITLE_SOH_6153
	
	desc = {
		text = EVTDESCA_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 300
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							NOT = {
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_disease = yes
						}
					}
				}
				change_variable = {
					which = grace_gain
					value = -100
				}
			}
			
			if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = prosperity_modifier_3
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = prosperity_modifier_2
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			else_if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = prosperity_modifier_1
						}
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.1
				}
			}
			
			if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = depopulated_3
						}
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			else_if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = depopulated_2
						}
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			else_if = {
				limit = {
					event_target:county_to_hand_over = {
						location = {
							has_province_modifier = depopulated_1
						}
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.1
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
		
		random_realm_lord = {
			limit = {
				is_feudal = yes
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				OR = {
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
					could_have_japanese_government_trigger = yes
				}
			}
			
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				liege = {
					character = ROOT
				}
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_to_give_tribute
		}
		
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
					could_have_japanese_government_trigger = yes
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			
			preferred_limit = {
				OR = {
					is_rival = ROOT
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = master_schemer
					trait = greedy
					trait = arbitrary
				}
			}
			
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6153 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s county Tribute (self)!"
		
		grant_title_no_opinion = event_target:county_to_hand_over
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6153 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s county Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6155 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6153 # Give the county to a vassal
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s county Tribute (vassal)!"
		
		grant_title_no_opinion = event_target:county_to_hand_over
		
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6156 } # Inform the vassal
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:vassal_to_give_tribute = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				is_lover =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival =  event_target:vassal_to_give_tribute
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
		}
		
		name = EVTOPTD_SOH_6153 # Give the county to a courtier
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s county Tribute (courtier)!"
		
		grant_title_no_opinion = event_target:county_to_hand_over
		
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 0.1
				event_target:courtier_target = {
					china_eoc_hates_this_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:courtier_target
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6154
	desc = EVTDESC_SOH_6154
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6154 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6155
	desc = EVTDESC_SOH_6155
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6155 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_hand_over_title_tribute
		}
	}
}

### Inform vassal

# Vassal got title

letter_event = {
	id = soh.6156
	desc = EVTDESC_SOH_6156
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6156 # Nice!
	}
}



##### Offer Border Adjustment

### Offer Border Adjustment

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6158
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes
		}
		
		if = {
			limit = {
				china_would_refuse_border_adjustment_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		
		else_if = {
			limit = {
				china_would_accept_border_adjustment_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					narrative_event = { id = soh.6159 } # EoC's GC has a say
				}
			}
		}
		
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6160 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
narrative_event = {
	id = soh.6159
	title = EVTTITLE_SOH_6159
	
	desc = {
		text = EVTDESCA_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6159 # Indicate that the EoC should accept
		
		gc_accept_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_accept_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6159 # Indicate that the EoC should refuse
		
		gc_refuse_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_refuse_grace_score = yes
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6159 # Indicate no strong preference
		
		gc_neutral_grace_offer_effect = yes
		
		ai_chance = {
			factor = 100
			
			gc_neutral_grace_score = yes
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6160 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6160
	title = EVTTITLE_SOH_6160
	
	desc = {
		text = EVTDESCA_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCB_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCC_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCD_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCE_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCF_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCG_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCH_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCI_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	
	desc = {
		text = EVTDESCJ_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCK_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	
	desc = {
		text = EVTDESCL_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		event_target:grace_decision_taker = {
			# Calculate Grace gain
			# Base
			set_variable = {
				which = grace_gain
				value = 0 # Reset if already used
			}
			change_variable = {
				which = grace_gain
				value = 500
			}
			
			# Traits of the EoC
			if = {
				limit = {
					ROOT = {
						trait = greedy
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = charitable
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.5
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = ambitious
					}
				}
				multiply_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			if = {
				limit = {
					ROOT = {
						trait = content
					}
				}
				divide_variable = {
					which = grace_gain
					value = 1.2
				}
			}
			
			# Specifics of the tribute
			event_target:border_adjustment_duchy = {
				any_direct_de_jure_vassal_title = {
					limit = {
						holder_scope = {
							top_liege = {
								character = event_target:grace_decision_taker
							}
						}
					}
					
					if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_3
								has_disease = no
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 700
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_2
								has_disease = no
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 600
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_1
								has_disease = no
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 500
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								NOR = {
									has_province_modifier = depopulated_3
									has_province_modifier = depopulated_2
									has_province_modifier = depopulated_1
								}
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 400
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_1
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 300
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_2
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 200
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_3
								any_province_holding = {
									OR = {
										holding_type = castle
										holding_type = city
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 100
							}
						}
					}
					
					if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_3
								has_disease = no
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 350
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_2
								has_disease = no
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 300
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = prosperity_modifier_1
								has_disease = no
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 250
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								NOR = {
									has_province_modifier = depopulated_3
									has_province_modifier = depopulated_2
									has_province_modifier = depopulated_1
								}
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 200
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_1
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 150
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_2
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 100
							}
						}
					}
					
					else_if = {
						limit = {
							location = {
								has_province_modifier = depopulated_3
								NOT = {
									any_province_holding = {
										OR = {
											holding_type = castle
											holding_type = city
										}
									}
								}
							}
						}
						event_target:grace_decision_taker = {
							change_variable = {
								which = grace_gain
								value = 50
							}
						}
					}
				}
			}
			
			# MoH
			ROOT = {
				trigger_switch = {
					on_trigger = has_character_modifier
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
					
					mandate_of_heaven_4 = {
						event_target:grace_decision_taker = {
							divide_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_2 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.25
							}
						}
					}
					
					mandate_of_heaven_5 = {
						event_target:grace_decision_taker = {
							multiply_variable = {
								which = grace_gain
								value = 1.5
							}
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6160 # Accept the offer
		
		log = "[Root.GetBestName] accepted [grace_decision_taker.GetBestName]'s border adjustment Tribute!"
		
		event_target:border_adjustment_duchy = {
			any_direct_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = {
							character = event_target:grace_decision_taker
						}
					}
				}
				
				if = {
					limit = {
						holder_scope = {
							NOR = {
								any_demesne_title = {
									NOR = {
										de_jure_liege_or_above = event_target:border_adjustment_duchy
										title = event_target:border_adjustment_duchy
									}
								}
								any_vassal = {
									any_demesne_title = {
										NOR = {
											de_jure_liege_or_above = event_target:border_adjustment_duchy
											title = event_target:border_adjustment_duchy
										}
									}
								}
							}
						}
					}
					holder_scope = {
						set_defacto_liege = ROOT
					}
				}
				
				else = {
					ROOT = {
						grant_title_no_opinion = PREV
					}
				}
			}
			
			if = {
				limit = {
					has_holder = yes
					holder_scope = {
						top_liege = {
							character = event_target:grace_decision_taker
						}
					}
				}
				ROOT = {
					grant_title_no_opinion = PREV
				}
			}
		}
		
		set_truce = {
			who = event_target:grace_decision_taker
			years = 10
		}
		
		event_target:grace_decision_taker = {
			set_truce = {
				who = ROOT
				years = 10
			}
		}
		
		eoc_accept_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6161 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_accept_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = greedy
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6160 # Refuse
		
		log = "[Root.GetBestName] refused [grace_decision_taker.GetBestName]'s border adjustment Tribute!"
		
		eoc_refuse_grace_offer_effect = yes
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6162 } # Inform sender
		}
		
		ai_chance = {
			factor = 100
			
			eoc_refuse_tribute_score = yes
			
			mult_modifier = {
				factor = 10
				trait = content
			}
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6161
	desc = EVTDESC_SOH_6161
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6161 # Great!
		
		grace_change_effect = yes
	}
}

# Offer refused
letter_event = {
	id = soh.6162
	desc = EVTDESC_SOH_6162
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6162 # Really?
		
		opinion = {
			who = FROM
			modifier = opinion_grace_china_refused_border_adjustment_tribute
		}
	}
}



##### AI Tribute randomization events

# Delayed on_yearly_pulse randomization event for vassals and below of the EoC
character_event = {
	id = soh.6163
	hide_window = yes
	
	is_triggered_only = yes # on_yearly_pulse -> random_events -> grace_events
	
	has_dlc = "Jade Dragon"
	
	only_playable = yes
	
	min_age = 16
	
	capable_only = yes # Works fine here
	
	prisoner = no
	
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
			is_inaccessible_or_incapable_trigger = no
		}
		
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		
		root_was_refused_any_boon_trigger = no
		
		is_inaccessible_or_incapable_trigger = no
		has_regent = no
		
		mercenary = no
		holy_order = no
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes
		
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		
		log = "Vassal Grace tribute event fired for [Root.GetTitledName]!"
		
		random_list = {
			200 = {
				mult_modifier = {
					factor = 0.2
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				
				mult_modifier = {
					factor = 0.5
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
				
				mult_modifier = {
					factor = 5
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
				
				mult_modifier = {
					factor = 10
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
				
				# Do nothing
			}
			
			50 = {
				# NOTHING TO SEE HERE!
				trigger = {
					is_nomadic = yes
					has_dlc = "Horse Lords"
					war = no
					unused_manpower >= 300
					
					NOR = {
						trait = ambitious
						trait = proud
					}
				}
				
				mult_modifier = {
					factor = 5
					trait = craven
				}
				
				mult_modifier = {
					factor = 2
					trait = humble
				}
				
				mult_modifier = {
					factor = 2
					trait = content
				}
				
				# Supply horses
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_horses_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_horses_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes # A nomad can never be the GC!
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6027 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6028 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					has_dlc = "Conclave"
					e_china = {
						NOT = {
							has_law = eunuch_law_0
						}
					}
					
					any_courtier = {
						is_landed = no
						is_female = no
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOT = {
							dynasty = event_target:eoc
						}
						
						trigger_if = {
							limit = {
								NAND = {
									prisoner = yes
									host = {
										character = ROOT
									}
								}
							}
							
							is_married = no
							is_betrothed = no
						}
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_rival = ROOT
							NOR = {
								dynasty = ROOT
								is_friend = ROOT
								is_lover = ROOT
							}
						}
					}
				}
				
				# Offer eunuch
				random_courtier = {
					limit = {
						is_landed = no
						is_female = no
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOT = {
							dynasty = event_target:eoc
						}
						
						trigger_if = {
							limit = {
								NAND = {
									prisoner = yes
									host = {
										character = ROOT
									}
								}
							}
							
							is_married = no
							is_betrothed = no
						}
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_rival = ROOT
							NOR = {
								dynasty = ROOT
								is_friend = ROOT
								is_lover = ROOT
							}
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
						NOT = {
							dynasty = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					
					save_event_target_as = tribute_character
					
					if = {
						limit = {
							NOT = {
								trait = eunuch
							}
						}
						
						add_trait = eunuch
						
						hidden_tooltip = {
							opinion = {
								who = ROOT
								modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
							}
							
							any_close_relative = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_close_kin
								}
							}
							
							any_dynasty_member = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_family
								}
							}
						}
					}
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_eunuch_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_eunuch_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6039 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6040 } # EoC gets offer
					}
				}
			}
			
			50 = {
				trigger = {
					NOR = {
						has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
						has_religion_feature = religion_feature_minangkabau # If we're Matriarchial, we shouldn't accept concubinage
					}
					
					event_target:eoc = {
						OR = {
							AND = {
								is_adult = yes
								is_female = no
								
								NOR = {
									trait = celibate
									trait = eunuch
								}
							}
							
							any_dynasty_member = {
								host = {
									character = ROOT
								}
								
								is_adult = yes
								is_female = no
								
								is_inaccessible_or_incapable_trigger = no
								
								NOR = {
									trait = celibate
									trait = eunuch
								}
							}
						}
					}
					
					OR = {
						is_tribal = yes
						is_nomadic = yes
						has_concubinage = yes
					}
					
					any_courtier = {
						is_landed = no
						is_female = yes
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						practical_age < 35
						
						trigger_if = {
							limit = {
								OR = {
									religion = zoroastrian
									religion = messalian
									religion_openly_inca_or_reformed_trigger = yes
									has_religion_feature = religion_holy_family
									has_religion_feature = religion_feature_zun
								}
							}
							
							NOT = {
								is_close_relative = ROOT
							}
						}
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOR = {
							dynasty = event_target:eoc
							any_sibling = {
								character = event_target:eoc
							}
							is_descendant_of = event_target:eoc
							is_ancestor_of = event_target:eoc
							any_child_even_if_dead = {
								always = yes
							}
						}
						
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
							
							any_close_relative = {
								OR = {
									real_tier = king
									real_tier = emperor
								}
							}
							
							trait = attractive
							
							# Likely to be able to catch someone's attention
							AND = {
								trait = master_seductress
								NOT = {
									trait = homosexual
								}
							}
						}
						
						is_married = no
						is_betrothed = no
						is_consort = no
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ascetic_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
							trait = celibate
							has_character_modifier = wont_let_spouse_touch_me
							trait = pregnant # Known to be pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							is_lover = ROOT
						}
						
						OR = {
							NOT = { prisoner = yes }
							host = {
								character = ROOT
							}
						}
					}
				}
				
				# Offer concubine
				random_courtier = {
					limit = {
						is_landed = no
						is_female = yes
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						practical_age < 35
						
						trigger_if = {
							limit = {
								OR = {
									religion = zoroastrian
									religion = messalian
									religion_openly_inca_or_reformed_trigger = yes
									has_religion_feature = religion_holy_family
									has_religion_feature = religion_feature_zun
								}
							}
							
							NOT = {
								is_close_relative = ROOT
							}
						}
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOR = {
							dynasty = event_target:eoc
							any_sibling = {
								character = event_target:eoc
							}
							is_descendant_of = event_target:eoc
							is_ancestor_of = event_target:eoc
							any_child_even_if_dead = {
								always = yes
							}
						}
						
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
							
							any_close_relative = {
								OR = {
									real_tier = king
									real_tier = emperor
								}
							}
							
							trait = attractive
							
							# Likely to be able to catch someone's attention
							AND = {
								trait = master_seductress
								NOT = {
									trait = homosexual
								}
							}
						}
						
						is_married = no
						is_betrothed = no
						is_consort = no
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ascetic_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
							trait = celibate
							has_character_modifier = wont_let_spouse_touch_me
							trait = pregnant # Known to be pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							is_lover = ROOT
						}
						
						OR = {
							NOT = { prisoner = yes }
							host = {
								character = ROOT
							}
						}
					}

					preferred_limit = {
						NOR = {
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_concubine_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_concubine_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6051 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6052 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					war = no
					event_target:eoc = {
						war = yes
					}
					
					NAND = {
						independent = yes
						
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					any_courtier = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						martial >= 12
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_female = no
							
							AND = {
								has_minor_title = title_commander
								e_china = {
									gender_equality_trigger = yes
								}
							}
							
							has_character_flag = special_marshal
						}
					}
				}
				
				# Offer commander
				random_courtier = {
					limit = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						martial >= 12
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_female = no
							
							AND = {
								has_minor_title = title_commander
								e_china = {
									gender_equality_trigger = yes
								}
							}
							
							has_character_flag = special_marshal
						}
					}
				
					preferred_limit = {
						NOR = {
							dynasty = ROOT
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_commander_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_commander_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6064 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6065 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					has_dlc = "Reapers"
					
					NOT = {
						any_demesne_province = {
							has_disease = yes # China would probably not trust you not to send a plague-carrier
						}
					}
					
					event_target:eoc = {
						any_realm_province = {
							has_disease = yes
						}
					}
					
					any_courtier = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							trait = physician
							trait = scholar
							trait = mystic
						}
					}
				}
					
				# Offer physician
				
				random_courtier = {
					limit = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							trait = physician
							trait = scholar
							trait = mystic
						}
					}
				
					preferred_limit = {
						NOR = {
							dynasty = ROOT
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_physician_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_physician_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6077 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6078 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					NOT = {
						trait = greedy
					}
					
					any_artifact = {
						NOR = {
							AND = {
								artifact_type = heirloom_seal_of_the_realm
								ROOT = {
									has_claim = e_china
								}
							}
							AND = {
								has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
								e_china = {
									holder_scope = {
										society_member_of = hermetics # Or that other one...
									}
								}
							}
							
							has_artifact_flag = flag_considering_donation 
							has_artifact_flag = curse
							has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
							
							trigger_if = {
								limit = {
									has_artifact_flag = imperial_regalia_of_japan
								}
								
								ROOT = {
									could_have_japanese_government_trigger = no
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = heirloom_seal_of_the_realm
								}
								
								ROOT = {
									NOR = {
										trait = ambitious
										trait = proud
										has_claim = e_china
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_byzantine
								}
								
								ROOT = {
									NOR = {
										has_landed_title = e_byzantium
										has_landed_title = e_roman_empire
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_hre
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_hre
									}
								}
							}
						
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_pahlavi
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_persia
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									has_artifact_flag = reformer_artifact # Assorted HF temporal reformer artifacts
								}
								
								is_artifact_active = no
							}
							
							event_target:eoc = {
								NOT = {
									has_artifact = PREV
								}
							}
						}
					}
				}
				
				# Offer artifact
				random_artifact = {
					limit = {
						NOR = {
							AND = {
								artifact_type = heirloom_seal_of_the_realm
								ROOT = {
									has_claim = e_china
								}
							}
							AND = {
								has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
								e_china = {
									holder_scope = {
										society_member_of = hermetics # Or that other one...
									}
								}
							}
							
							has_artifact_flag = flag_considering_donation 
							has_artifact_flag = curse
							has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
							
							trigger_if = {
								limit = {
									has_artifact_flag = imperial_regalia_of_japan
								}
								
								ROOT = {
									could_have_japanese_government_trigger = no
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = heirloom_seal_of_the_realm
								}
								
								ROOT = {
									NOR = {
										trait = ambitious
										trait = proud
										has_claim = e_china
									}
									OR = {
										event_target:eoc = {
											NOR = {
												has_character_modifier = mandate_of_heaven_2
												has_character_modifier = mandate_of_heaven_1
											}
										}
										dynasty = event_target:eoc
										is_friend = event_target:eoc
										is_lover = event_target:eoc
										trait = content
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_byzantine
								}
								
								ROOT = {
									NOR = {
										has_landed_title = e_byzantium
										has_landed_title = e_roman_empire
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_hre
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_hre
									}
								}
							}
						
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_pahlavi
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_persia
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									has_artifact_flag = reformer_artifact # Assorted HF temporal reformer artifacts
								}
								
								is_artifact_active = no
							}
							
							event_target:eoc = {
								NOT = {
									has_artifact = PREV
								}
							}
						}
					}

					preferred_limit = {
						artifact_type = heirloom_seal_of_the_realm
					}
					
					save_event_target_as = tribute_artifact
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_artifact_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_artifact_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6090 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6091 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					war = no
					
					any_claim = {
						holder_scope = {
							character = event_target:eoc
						}
						
						NOR = {
							de_jure_vassal_or_below = ROOT
							controls_religion = yes
						}
						
						trigger_if = {
							limit = {
								tier = king
							}
							
							ROOT = {
								NOT = {
									tier = king
								}
							}
						}
					}
					
					NOT = {
						any_claim = {
							holder_scope = {
								character = event_target:eoc
							}
							
							OR = {
								de_jure_vassal_or_below = ROOT
								controls_religion = yes
								
								trigger_if = {
									limit = {
										tier = king
									}
									
									ROOT = {
										tier = king
									}
								}
							}
						}
					}
					
					relative_power = {
						who = event_target:eoc
						power < 1
					}
				}
				
				mult_modifier = {
					factor = 0.5
					relative_power = {
						who = event_target:eoc
						power >= 0.5
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.5
					trait = brave
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 2
					trait = craven
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Renounce claims
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_renounce_claims_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_renounce_claims_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6103 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6104 } # EoC gets offer
					}
				}
			}
		
			10 = {
				trigger = {
					has_dlc = "Conclave"
					event_target:eoc = {
						owes_favor_to = ROOT
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = deceitful
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = honest
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Cancel Favor
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_cancel_other_favor_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_cancel_other_favor_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6115 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6116 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					has_dlc = "Reapers"
					
					any_demesne_province = {
						OR = {
							has_province_modifier = prosperity_modifier_1
							has_province_modifier = prosperity_modifier_2
							has_province_modifier = prosperity_modifier_3
						}
					}
					
					event_target:eoc = {
						any_realm_province = {
							NOR = {
								owner = {
									character = ROOT
								}
								
								has_province_modifier = prosperity_modifier_3
							}
						}
					}
					
					NOT = {
						trait = greedy
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = charitable
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Transfer Prosperity
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_prosperity_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_prosperity_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6121 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6122 } # EoC gets offer
					}
				}
			}
			
			50 = {
				trigger = {
					same_society_as = event_target:eoc
					society_currency >= 1000
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = kind
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Transfer society currency
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_society_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_society_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
								OR = {
									ROOT = {
										is_secret_society_member = no
									}
									same_society_as = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6134 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6135 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					prestige >= 1000
					NOT = {
						has_claim = e_china
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = greedy
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = charitable
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				mult_modifier = {
					factor = 10
					dynasty = event_target:eoc
				}
				
				mult_modifier = {
					factor = 10
					is_friend = event_target:eoc
				}
				
				mult_modifier = {
					factor = 10
					is_lover = event_target:eoc
				}
				
				# Boost Mandate
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_moh_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_moh_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6140 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6141 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					controls_religion = no
					
					NOT = {
						has_claim = e_china
					}
					
					any_demesne_title = {
						NOT = {
							de_jure_vassal_or_below = ROOT
						}
						tier = count
					}
					
					any_demesne_title = {
						# Don't unland yourself!
						count = 2
						tier = count
					}
					
					NOR = {
						trait = ambitious
						trait = envious
						trait = proud
					}
				}
		
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				mult_modifier = {
					factor = 10
					dynasty = event_target:eoc
				}
				
				# Hand Over Title
				random_demesne_title = {
					limit = {
						NOT = {
							de_jure_vassal_or_below = ROOT
						}
						tier = count
					}
					
					save_event_target_as = county_to_hand_over
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_county_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_county_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6152 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						
						set_character_flag = grace_accept_offer_gc
					}
					
					event_target:eoc = {
						narrative_event = { id = soh.6153 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Delayed on_five_year_pulse randomization event for rulers that might care to engage with the Grace system
character_event = {
	id = soh.6164
	hide_window = yes
	
	is_triggered_only = yes # on_five_year_pulse -> random_events -> grace_events
	
	has_dlc = "Jade Dragon"
	
	only_playable = yes
	
	min_age = 16
	
	capable_only = yes # Works fine here
	
	prisoner = no
	
	ai = yes
	
	trigger = {
		trigger_if = {
			limit = {
				OR = {
					independent = yes
					real_tier = king
				}
			}
			
			always = yes
		}
		
		trigger_else = {
			higher_real_tier_than = count # For performance reasons
			
			OR = {
				trigger_if = {
					limit = {
						liege = {
							independent = yes
						}
					}
					
					is_powerful_vassal = yes
				}
				
				has_minor_title = title_grand_chancellor
				i_am_appropriate_regent_trigger = yes
			}
		}
		
		is_close_to_china_or_along_the_silk_road_trigger = yes
		
		top_liege = {
			NOR = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
				suzerain = {
					government = chinese_imperial_government
					is_chinese_emperor_trigger = no
				}
			}
		}
		
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					war_with = ROOT
				}
			}
		}
		
		is_inaccessible_or_incapable_trigger = no
		has_regent = no
		
		is_new_world_invader_or_vassal_trigger = no
		root_was_refused_any_boon_trigger = no
		root_hates_china_trigger = no
		
		mercenary = no
		holy_order = no
		
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes
		
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		
		log = "Grace tribute event fired for [Root.GetTitledName]!"
		
		random_list = {
			200 = {
				mult_modifier = {
					factor = 0.2
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				
				mult_modifier = {
					factor = 0.5
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
				
				mult_modifier = {
					factor = 5
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
				
				mult_modifier = {
					factor = 10
					event_target:eoc = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
				
				mult_modifier = {
					factor = 10
					is_within_diplo_range = event_target:eoc # If you're far from China, don't bother
				}
				
				# Do nothing
			}
			
			50 = {
				trigger = {
					scaled_wealth = {
						value = 1
						min = 500
					}
					NOT = {
						trait = greedy
					}
				}
				
				mult_modifier = {
					factor = 10
					event_target:eoc = {
						wealth < 0
					}
				}
				
				mult_modifier = {
					factor = 0.1
					monthly_income < 11  #I.e. it would take more than 4 years to collect the 500 gold
				}
				
				mult_modifier = {
					factor = 2
					trait = charitable
				}
				
				# Send gift
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_gift_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_gift_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6003 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6004 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					independent = yes
					is_tributary = no
					
					war = no
					controls_religion = no
					
					NAND = {
						real_tier = emperor
						is_nomadic = no
					}
					
					realm_size < 100
					
					NAND = {
						could_have_japanese_government_trigger = yes
						any_realm_lord = {
							OR = {
								is_the_tenno_trigger = yes
								is_ryukyuan_tenno_trigger = yes
							}
						}
					}
					
					NAND = {
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					NAND = {
						OR = {
							trait = proud
							trait = ambitious
							trait = brave
						}
						NOR = {
							trait = humble
							trait = content
							trait = craven
						}
					}
					
					event_target:eoc = {
						war = no
						NOT = {
							has_opinion_modifier = {
								who = ROOT
								modifier = opinion_traitor
							}
						}
					}
					
					NAND = {
						any_neighbor_independent_ruler = {
							government = chinese_imperial_government
							NOT = {
								is_chinese_emperor_trigger = yes
							}
							OR = {
								has_character_modifier = mandate_of_heaven_3
								has_character_modifier = mandate_of_heaven_4
								has_character_modifier = mandate_of_heaven_5
							}
						}
						
						NOT = {
							any_neighbor_independent_ruler = {
								is_chinese_emperor_trigger = yes
								OR = {
									has_character_modifier = mandate_of_heaven_3
									has_character_modifier = mandate_of_heaven_4
									has_character_modifier = mandate_of_heaven_5
								}
							}
						}
					}
					
					relative_power = {
						who = event_target:eoc
						power < 0.5
					}
				}
				
				mult_modifier = {
					factor = 0.01 # Make random distant realms unlikely to become tributaries
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													OR = {
														is_chinese_emperor_trigger = yes
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				# Kings and nomads are less willing to become tributaries
				mult_modifier = {
					factor = 0.1
					higher_real_tier_than = duke
				}
				
				# Small realms are more likely to be willing to become tributaries
				mult_modifier = {
					factor = 5
					realm_size < 10
				}
				
				# Large realms are less likely to be willing to become tributaries
				mult_modifier = {
					factor = 0.1
					realm_size >= 50
				}
				
				# Wants to be independent due to traits
				mult_modifier = {
					factor = 0.1
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				
				# Is likely to be scared of China
				mult_modifier = {
					factor = 10
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				
				# China is less than four times as powerful
				mult_modifier = {
					factor = 0.1
					relative_power = {
						who = event_target:eoc
						power >= 0.25
					}
				}
				
				# China is more than ten times as powerful
				mult_modifier = {
					factor = 5
					relative_power = {
						who = event_target:eoc
						power < 0.1
					}
				}
				
				# Same culture
				mult_modifier = {
					factor = 5
					culture = event_target:eoc
				}
				
				# Same culture group
				mult_modifier = {
					factor = 2
					culture_group = event_target:eoc
					NOT = {
						culture = event_target:eoc
					}
				}
				
				# We are uncivilized
				mult_modifier = {
					factor = 0.5
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
				}
				
				# We are uncivilized and distant
				mult_modifier = {
					factor = 0.2
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
							}
						}
					}
				}
				
				# If someone is just too different, they should want to be free a bit more often
				mult_modifier = {
					factor = 0.1
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
					NOR = {
						culture_group = event_target:eoc
						culture_group = chinese_group
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				
				# Barbarians
				mult_modifier = {
					factor = 0.1
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				
				# Pagans should be more unlikely to become tributaries
				mult_modifier = {
					factor = 0.5
					religion_group = pagan_group
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
					is_reformed_religion = no
				}
				
				# Become tributary
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_tributary_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_tributary_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6015 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6016 } # EoC gets offer
					}
				}
			}
			
			50 = {
				trigger = {
					is_nomadic = yes
					has_dlc = "Horse Lords"
					war = no
					unused_manpower >= 300
					
					NAND = {
						independent = yes
						
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					NOR = {
						trait = ambitious
						trait = proud
					}
				}
				
				mult_modifier = {
					factor = 5
					trait = craven
				}
				
				mult_modifier = {
					factor = 2
					trait = humble
				}
				
				mult_modifier = {
					factor = 2
					trait = content
				}
				
				# Supply horses
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_horses_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_horses_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6021 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6022 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					has_dlc = "Conclave"
					e_china = {
						NOT = {
							has_law = eunuch_law_0
						}
					}
					
					any_courtier = {
						is_landed = no
						is_female = no
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOT = {
							dynasty = event_target:eoc
						}
						
						trigger_if = {
							limit = {
								NAND = {
									prisoner = yes
									host = {
										character = ROOT
									}
								}
							}
							
							is_married = no
							is_betrothed = no
						}
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_rival = ROOT
							NOR = {
								dynasty = ROOT
								is_friend = ROOT
								is_lover = ROOT
							}
						}
					}
				}
				
				# Offer eunuch
				random_courtier = {
					limit = {
						is_landed = no
						is_female = no
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOT = {
							dynasty = event_target:eoc
						}
						
						trigger_if = {
							limit = {
								NAND = {
									prisoner = yes
									host = {
										character = ROOT
									}
								}
							}
							
							is_married = no
							is_betrothed = no
						}
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_rival = ROOT
							NOR = {
								dynasty = ROOT
								is_friend = ROOT
								is_lover = ROOT
							}
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
						NOT = {
							dynasty = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					
					save_event_target_as = tribute_character
					
					if = {
						limit = {
							NOT = {
								trait = eunuch
							}
						}
						
						add_trait = eunuch
						
						hidden_tooltip = {
							opinion = {
								who = ROOT
								modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
							}
							
							any_close_relative = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_close_kin
								}
							}
							
							any_dynasty_member = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_family
								}
							}
						}
					}
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_eunuch_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_eunuch_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6033 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6034 } # EoC gets offer
					}
				}
			}
			
			50 = {
				trigger = {
					NOR = {
						has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
						has_religion_feature = religion_feature_minangkabau # If we're Matriarchial, we shouldn't accept concubinage
					}
					
					event_target:eoc = {
						OR = {
							AND = {
								is_adult = yes
								is_female = no
								
								NOR = {
									trait = celibate
									trait = eunuch
								}
							}
							
							any_dynasty_member = {
								host = {
									character = ROOT
								}
								
								is_adult = yes
								is_female = no
								
								is_inaccessible_or_incapable_trigger = no
								
								NOR = {
									trait = celibate
									trait = eunuch
								}
							}
						}
					}
					
					NAND = {
						independent = yes
						
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					OR = {
						is_tribal = yes
						is_nomadic = yes
						has_concubinage = yes
					}
					
					any_courtier = {
						is_landed = no
						is_female = yes
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						practical_age < 35
						
						trigger_if = {
							limit = {
								OR = {
									religion = zoroastrian
									religion = messalian
									religion_openly_inca_or_reformed_trigger = yes
									has_religion_feature = religion_holy_family
									has_religion_feature = religion_feature_zun
								}
							}
							
							NOT = {
								is_close_relative = ROOT
							}
						}
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOR = {
							dynasty = event_target:eoc
							any_sibling = {
								character = event_target:eoc
							}
							is_descendant_of = event_target:eoc
							is_ancestor_of = event_target:eoc
							any_child_even_if_dead = {
								always = yes
							}
						}
						
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
							
							any_close_relative = {
								OR = {
									real_tier = king
									real_tier = emperor
								}
							}
							
							trait = attractive
							
							# Likely to be able to catch someone's attention
							AND = {
								trait = master_seductress
								NOT = {
									trait = homosexual
								}
							}
						}
						
						is_married = no
						is_betrothed = no
						is_consort = no
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ascetic_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
							trait = celibate
							has_character_modifier = wont_let_spouse_touch_me
							trait = pregnant # Known to be pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							is_lover = ROOT
						}
						
						OR = {
							NOT = { prisoner = yes }
							host = {
								character = ROOT
							}
						}
					}
				}
				
				# Offer concubine
				random_courtier = {
					limit = {
						is_landed = no
						is_female = yes
						is_adult = yes
						is_patrician = no
						is_heir = no
						
						practical_age < 35
						
						trigger_if = {
							limit = {
								OR = {
									religion = zoroastrian
									religion = messalian
									religion_openly_inca_or_reformed_trigger = yes
									has_religion_feature = religion_holy_family
									has_religion_feature = religion_feature_zun
								}
							}
							
							NOT = {
								is_close_relative = ROOT
							}
						}
						
						trigger_if = {
							limit = {
								ROOT = {
									could_have_japanese_government_trigger = yes
								}
							}
							
							NOT = {
								any_dynasty_member = {
									is_landed = yes
									OR = {
										is_the_tenno_trigger = yes
										is_ryukyuan_tenno_trigger = yes
									}
								}
							}
						}
						
						NOR = {
							dynasty = event_target:eoc
							any_sibling = {
								character = event_target:eoc
							}
							is_descendant_of = event_target:eoc
							is_ancestor_of = event_target:eoc
							any_child_even_if_dead = {
								always = yes
							}
						}
						
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
							
							any_close_relative = {
								OR = {
									real_tier = king
									real_tier = emperor
								}
							}
							
							trait = attractive
							
							# Likely to be able to catch someone's attention
							AND = {
								trait = master_seductress
								NOT = {
									trait = homosexual
								}
							}
						}
						
						is_married = no
						is_betrothed = no
						is_consort = no
						
						courtier_from_china_trigger = no
						is_incapable = no
						is_inaccessible_trigger = no
						is_maimed_trigger = no
						is_ascetic_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
							trait = celibate
							has_character_modifier = wont_let_spouse_touch_me
							trait = pregnant # Known to be pregnant
							trait = hard_pregnancy # This is missing in vanilla but should probably be here...
							trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
							trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
							is_lover = ROOT
						}
						
						OR = {
							NOT = { prisoner = yes }
							host = {
								character = ROOT
							}
						}
					}

					preferred_limit = {
						NOR = {
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_concubine_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_concubine_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6045 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6046 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					war = no
					event_target:eoc = {
						war = yes
					}
					
					NAND = {
						independent = yes
						
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					any_courtier = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						martial >= 12
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_female = no
							
							AND = {
								has_minor_title = title_commander
								e_china = {
									gender_equality_trigger = yes
								}
							}
							
							has_character_flag = special_marshal
						}
					}
				}
				
				# Offer commander
				random_courtier = {
					limit = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						martial >= 12
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							is_female = no
							
							AND = {
								has_minor_title = title_commander
								e_china = {
									gender_equality_trigger = yes
								}
							}
							
							has_character_flag = special_marshal
						}
					}
				
					preferred_limit = {
						NOR = {
							dynasty = ROOT
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_commander_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_commander_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6058 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6059 } # EoC gets offer
					}
				}
			}
			
			25 = {
				trigger = {
					has_dlc = "Reapers"
					
					NOT = {
						any_realm_province = {
							has_disease = yes # China would probably not trust you not to send a plague-carrier
						}
					}
					
					event_target:eoc = {
						any_realm_province = {
							has_disease = yes
						}
					}
					
					any_courtier = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							trait = physician
							trait = scholar
							trait = mystic
						}
					}
				}
					
				# Offer physician
				
				random_courtier = {
					limit = {
						is_adult = yes
						is_heir = no
						is_landed = no
						is_ruler = no
						is_married = no
						is_betrothed = no
						
						courtier_from_china_trigger = no
						is_inaccessible_or_incapable_trigger = no
						is_maimed_trigger = no
						is_ill = no
						
						NOR = {
							trait = inbred
							trait = imbecile
							trait = wounded
							trait = severely_injured
						}
						
						OR = {
							trait = physician
							trait = scholar
							trait = mystic
						}
					}
				
					preferred_limit = {
						NOR = {
							dynasty = ROOT
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = tribute_character
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_physician_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_physician_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6071 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6072 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					NOT = {
						trait = greedy
					}
					
					any_artifact = {
						NOR = {
							AND = {
								artifact_type = heirloom_seal_of_the_realm
								ROOT = {
									has_claim = e_china
								}
							}
							AND = {
								has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
								e_china = {
									holder_scope = {
										society_member_of = hermetics # Or that other one...
									}
								}
							}
							
							has_artifact_flag = flag_considering_donation 
							has_artifact_flag = curse
							has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
							
							trigger_if = {
								limit = {
									has_artifact_flag = imperial_regalia_of_japan
								}
								
								ROOT = {
									could_have_japanese_government_trigger = no
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = heirloom_seal_of_the_realm
								}
								
								ROOT = {
									NOR = {
										trait = ambitious
										trait = proud
										has_claim = e_china
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_byzantine
								}
								
								ROOT = {
									NOR = {
										has_landed_title = e_byzantium
										has_landed_title = e_roman_empire
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_hre
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_hre
									}
								}
							}
						
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_pahlavi
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_persia
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									has_artifact_flag = reformer_artifact # Assorted HF temporal reformer artifacts
								}
								
								is_artifact_active = no
							}
							
							event_target:eoc = {
								NOT = {
									has_artifact = PREV
								}
							}
						}
					}
				}
				
				# Offer artifact
				random_artifact = {
					limit = {
						NOR = {
							AND = {
								artifact_type = heirloom_seal_of_the_realm
								ROOT = {
									has_claim = e_china
								}
							}
							AND = {
								has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
								e_china = {
									holder_scope = {
										society_member_of = hermetics # Or that other one...
									}
								}
							}
							
							has_artifact_flag = flag_considering_donation 
							has_artifact_flag = curse
							has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
							
							trigger_if = {
								limit = {
									has_artifact_flag = imperial_regalia_of_japan
								}
								
								ROOT = {
									could_have_japanese_government_trigger = no
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = heirloom_seal_of_the_realm
								}
								
								ROOT = {
									NOR = {
										trait = ambitious
										trait = proud
										has_claim = e_china
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_byzantine
								}
								
								ROOT = {
									NOR = {
										has_landed_title = e_byzantium
										has_landed_title = e_roman_empire
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_hre
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_hre
									}
								}
							}
						
							
							trigger_else_if = {
								limit = {
									artifact_type = crown_pahlavi
								}
								
								ROOT = {
									NOT = {
										has_landed_title = e_persia
									}
								}
							}
							
							trigger_else_if = {
								limit = {
									has_artifact_flag = reformer_artifact # Assorted HF temporal reformer artifacts
								}
								
								is_artifact_active = no
							}
							
							event_target:eoc = {
								NOT = {
									has_artifact = PREV
								}
							}
						}
					}

					preferred_limit = {
						artifact_type = heirloom_seal_of_the_realm
					}
					
					save_event_target_as = tribute_artifact
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_artifact_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_artifact_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6084 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6085 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					war = no
					
					any_claim = {
						holder_scope = {
							top_liege = {
								character = event_target:eoc
							}
						}
						
						NOR = {
							de_jure_vassal_or_below = ROOT
							controls_religion = yes
						}
						
						trigger_if = {
							limit = {
								OR = {
									tier = king
									tier = emperor
								}
							}
							
							ROOT = {
								NOR = {
									tier = king
									tier = emperor
								}
							}
						}
					}
					
					NOT = {
						any_claim = {
							holder_scope = {
								top_liege = {
									character = event_target:eoc
								}
							}
							
							OR = {
								de_jure_vassal_or_below = ROOT
								controls_religion = yes
								
								trigger_if = {
									limit = {
										OR = {
											tier = king
											tier = emperor
										}
									}
									
									ROOT = {
										OR = {
											tier = king
											tier = emperor
										}
									}
								}
							}
						}
					}
					
					NAND = {
						independent = yes
						
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					relative_power = {
						who = event_target:eoc
						power < 1
					}
				}
				
				mult_modifier = {
					factor = 0.5
					relative_power = {
						who = event_target:eoc
						power >= 0.5
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.5
					trait = brave
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 2
					trait = craven
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Renounce claims
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_renounce_claims_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_renounce_claims_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6097 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6098 } # EoC gets offer
					}
				}
			}
		
			10 = {
				trigger = {
					has_dlc = "Conclave"
					event_target:eoc = {
						owes_favor_to = ROOT
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = deceitful
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = honest
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Cancel Favor
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_cancel_other_favor_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_cancel_other_favor_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6109 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6110 } # EoC gets offer
					}
				}
			}
			
			50 = {
				trigger = {
					same_society_as = event_target:eoc
					society_currency >= 1000
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = envious
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 10
					trait = kind
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Transfer society currency
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_society_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_society_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								OR = {
									ROOT = {
										is_secret_society_member = no
									}
									same_society_as = ROOT
								}
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6128 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6129 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					independent = yes
					
					suzerain = {
						character = event_target:eoc
					}
					
					realm_size < 100
					
					trigger_if = {
						limit = {
							tier = emperor
						}
						
						is_nomadic = yes
					}
					
					war = no
					
					event_target:eoc = {
						war = no
					}
					
					controls_religion = no
					
					NAND = {
						could_have_japanese_government_trigger = yes
						any_realm_lord = {
							OR = {
								is_the_tenno_trigger = yes
								is_ryukyuan_tenno_trigger = yes
							}
						}
					}
					
					NAND = {
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					relative_power = {
						who = event_target:eoc
						power < 1
					}
					
					trigger_if = {
						limit = {
							is_tributary = {
								type = chinese_client_state
							}
						}
						
						is_tribal = no
						is_nomadic = no
						government = chinese_vassal_government
						
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					
					trigger_else_if = {
						limit = {
							is_tributary = {
								type = chinese_protectorate
							}
						}
						
						is_nomadic = no
						
						trigger_if = {
							limit = {
								is_tribal = yes
							}
							
							any_realm_province = {
								OR = {
									region = world_china
									county = {
										de_jure_liege_or_above = e_china
									}
								}
							}
						}
						
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					
					trigger_else_if = {
						limit = {
							is_tributary = {
								type = chinese_imperial_tributary
							}
						}
						
						is_nomadic = no
						
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
													}
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
					
					trigger_else = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
												AND = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														is_tributary = {
															type = chinese_imperial_tributary
														}
													}
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														is_tributary = {
															type = chinese_imperial_tributary
														}
													}
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															AND = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	is_tributary = {
																		type = chinese_imperial_tributary
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																AND = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		is_tributary = {
																			type = chinese_imperial_tributary
																		}
																	}
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				mult_modifier = {
					factor = 0.01 # Make random distant realms unlikely to try to become higher tier tributaries
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													OR = {
														is_chinese_emperor_trigger = yes
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				
				# Kings and nomads are less willing to become tributaries
				mult_modifier = {
					factor = 0.1
					OR = {
						real_tier = king
						is_nomadic = yes
					}
				}
				
				# Small realms are more likely to be willing to become tributaries
				mult_modifier = {
					factor = 5
					realm_size < 10
				}
				
				# Large realms are less likely to be willing to become tributaries
				mult_modifier = {
					factor = 0.1
					realm_size >= 50
				}
				
				# Wants to be independent due to traits
				mult_modifier = {
					factor = 0.1
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					NOR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				
				# Wants to be independent due to traits
				mult_modifier = {
					factor = 0.25
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				
				# Is likely to be scared of China
				mult_modifier = {
					factor = 10
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				
				# China is less than twice as powerful
				mult_modifier = {
					factor = 0.25
					relative_power = {
						who = event_target:eoc
						power >= 0.5
					}
				}
				
				# China is less than four times as powerful
				mult_modifier = {
					factor = 0.5
					relative_power = {
						who = event_target:eoc
						power >= 0.25
					}
				}
				
				# China is more than ten times as powerful
				mult_modifier = {
					factor = 5
					relative_power = {
						who = event_target:eoc
						power < 0.1
					}
				}
				
				# Same culture
				mult_modifier = {
					factor = 5
					culture = event_target:eoc
				}
				
				# Same culture group
				mult_modifier = {
					factor = 2
					culture_group = event_target:eoc
					NOT = {
						culture = event_target:eoc
					}
				}
				
				# Chinese
				mult_modifier = {
					factor = 2
					culture_group = chinese_group
				}
				
				# Is "Chinese enough"
				mult_modifier = {
					factor = 5
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				}
				
				# We are uncivilized
				mult_modifier = {
					factor = 0.1
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
				}
				
				# Would become a vassal
				mult_modifier = {
					factor = 0.1
					is_tributary = {
						type = chinese_client_state
					}
				}
				
				# Would become a Client State
				mult_modifier = {
					factor = 0.25
					is_tributary = {
						type = chinese_protectorate
					}
				}
				
				# Would become a Protectorate
				mult_modifier = {
					factor = 0.5
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				
				# I have strong neighbours and protection would be nice
				mult_modifier = {
					factor = 2
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						relative_power = {
							who = ROOT
							power >= 2
						}
					}
					
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				
				mult_modifier = {
					factor = 5
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						relative_power = {
							who = ROOT
							power >= 5
						}
					}
					
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				
				mult_modifier = {
					factor = 10
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						relative_power = {
							who = ROOT
							power >= 10
						}
					}
					
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				
				# If someone is just too different, they should want to be free a bit more often
				mult_modifier = {
					factor = 0.1
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
					
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				
				# If we want to get border adjustments, seriously consider it
				mult_modifier = {
					factor = 10
					NOT = {
						is_tributary = {
							type = chinese_client_state # Already a client state, which is all we need
						}
					}
					e_china = {
						holder_scope = {
							any_realm_title = {
								tier = count
								NOR = {
									de_jure_liege_or_above = e_china
									region = world_china
								}
								de_jure_liege_or_above = ROOT
							}
						}
					}
				}
				
				# Pagans should be more unlikely to become tributaries
				mult_modifier = {
					factor = 0.5
					religion_group = pagan_group
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
					is_reformed_religion = no
				}
				
				# If we're not in China, we should be unlikely to want to join China
				mult_modifier = {
					factor = 0.001
					real_tier = king
					is_tributary = {
						type = chinese_client_state
					}
					
					capital_scope = {
						NOR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
				
				mult_modifier = {
					factor = 0.01
					real_tier = duke
					is_tributary = {
						type = chinese_client_state
					}
					
					capital_scope = {
						NOR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
				
				mult_modifier = {
					factor = 0.1
					real_tier = count
					is_tributary = {
						type = chinese_client_state
					}
					
					capital_scope = {
						NOR = {
							region = world_china
							county = {
								de_jure_liege_or_above = e_china
							}
						}
					}
				}
				
				# Increase tributary tier
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_increase_tributary_tier_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_increase_tributary_tier_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6146 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6147 } # EoC gets offer
					}
				}
			}
			
			10 = {
				trigger = {
					independent = yes
					lower_tier_than = emperor
					controls_religion = no
					
					war = no
					event_target:eoc = {
						war = no
					}
					
					any_realm_title = {
						tier = count
						OR = {
							region = world_china
							de_jure_liege_or_above = e_china
						}
						NOT = {
							de_jure_liege_or_above = ROOT
						}
					}
					
					NAND = {
						could_have_japanese_government_trigger = yes
						any_realm_lord = {
							OR = {
								is_the_tenno_trigger = yes
								is_ryukyuan_tenno_trigger = yes
							}
						}
					}
					
					NAND = {
						any_owned_bloodline = {
							has_bloodline_flag = genghis_khan_line
						}
						
						event_target:eoc = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
					
					capital_scope = {
						NOR = {
							region = world_china
							de_jure_liege_or_above = e_china
						}
					}
				}
				
				mult_modifier = {
					factor = 0.1
					trait = proud
				}
				
				mult_modifier = {
					factor = 0.1
					trait = ambitious
				}
				
				mult_modifier = {
					factor = 0.1
					trait = brave
				}
				
				mult_modifier = {
					factor = 10
					trait = humble
				}
				
				mult_modifier = {
					factor = 0.1
					trait = craven
				}
				
				mult_modifier = {
					factor = 10
					trait = content
				}
				
				# Offer Border Adjustment
				random_realm_title = {
					limit = {
						tier = count
						OR = {
							region = world_china
							de_jure_liege_or_above = e_china
						}
						NOT = {
							de_jure_liege_or_above = ROOT
						}
					}
					
					preferred_limit = {
						duchy = {
							NOR = {
								holder_scope = {
									character = ROOT
								}
								
								any_direct_de_jure_vassal_title = {
									holder_scope = {
										character = ROOT
									}
								}
							}
						}
					}
					
					duchy = {
						save_event_target_as = border_adjustment_duchy
					}
				}
				
				save_event_target_as = grace_decision_taker
				
				if = {
					limit = {
						china_would_refuse_border_adjustment_tribute_root_trigger = yes
					}
					
					set_character_flag = grace_refuse_offer
				}
				
				else_if = {
					limit = {
						china_would_accept_border_adjustment_tribute_root_trigger = yes
					}
					
					set_character_flag = grace_accept_offer
				}
				
				else = {
					set_character_flag = grace_neutral_offer
				}
				
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							narrative_event = { id = soh.6159 } # EoC's GC has a say
						}
					}
				}
				
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6160 } # EoC gets offer
					}
				}
			}
		}
	}
}