# Grace events related to Tributes
# By Silverswee(e)per

namespace = soh

# soh.6001-6200 reserved

# Partially inspired by JD logic; MUST be JD-locked

# TODO: AI logic for event options
# TODO: Opinion modifiers
# TODO: Grace handouts - scaled by MoH
# TODO: Scripted triggers and effects
# TODO: Localization
# TODO: Testing



##### Send Gift

### Send Gift - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6001
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		is_inaccessible_trigger = no
		scaled_wealth = {
			value = 1
			min = 500
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					event_target:eoc = {
						NOT = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
				modifier = {
					factor = 0.1
					ROOT = { NOT = { monthly_income = 11 } } #I.e. it would take more than 4 years to collect the 500 gold
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					trait = greedy
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_gift_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_gift_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6003 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6004 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6002
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_gift_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_gift_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6003 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6004 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6003
	desc = {
		text = EVTDESCA_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6003
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6003 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6003 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6003 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6004 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6004
	is_triggered_only = yes
	title = EVTTITLE_SOH_6004
	desc = {
		text = EVTDESCA_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6004
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_courtier = {
			limit = {
				is_council_eunuch_trigger = yes
			}
			preferred_limit = {
				NOT = {
					has_position = loyalist
				}
			}
			save_event_target_as = eunuch_target
		}
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
			}
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6004 # Accept the offer
		
		if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.4
					min = 200
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.3
					min = 150
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.35
					min = 175
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.3
					min = 150
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.35
					min = 175
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.8
					min = 400
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.1
					min = 50
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.8
					min = 400
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.1
					min = 50
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.9
					min = 450
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.05
					min = 25
				}
			}
		}
		else = {
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 1
					min = 500
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6005 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6004 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6006 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6005
	desc = EVTDESC_SOH_6005
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6005 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6006
	desc = EVTDESC_SOH_6006
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6006 # Really?
	}
}

### Send Gift - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6007
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		scaled_wealth = {
			value = 1
			min = 500
		}
		e_china = {
			holder_scope = {
				war = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					event_target:eoc = {
						NOT = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
				modifier = {
					factor = 0.1
					ROOT = { NOT = { monthly_income = 11 } } #I.e. it would take more than 4 years to collect the 500 gold
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					trait = greedy
				}
				modifier = {
					factor = 2
					trait = charitable
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_gift_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_gift_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6009 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6010 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6008
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		FROMFROM = {
			save_event_target_as = grace_decision_taker
			clear_grace_decision_flags_effect = yes # TODO
		}
		if = {
			limit = {
				china_would_refuse_gift_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_gift_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6009 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6010 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6009
	desc = {
		text = EVTDESCA_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6009
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6009 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6009 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6009 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6010 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6010
	is_triggered_only = yes
	title = EVTTITLE_SOH_6010
	desc = {
		text = EVTDESCA_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6010
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_courtier = {
			limit = {
				is_council_eunuch_trigger = yes
			}
			preferred_limit = {
				NOT = {
					has_position = loyalist
				}
			}
			save_event_target_as = eunuch_target
		}
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
			}
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6010 # Accept the offer
		
		if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.4
					min = 200
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.3
					min = 150
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.35
					min = 175
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.3
					min = 150
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.35
					min = 175
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_3
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.4
					min = 200
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.3
					min = 150
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_2
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.8
					min = 400
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.1
					min = 50
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_4
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.5
					min = 250
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.2
					min = 100
				}
				scaled_wealth = {
					value = -0.25
					min = 125
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_3
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.6
					min = 300
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.15
					min = 75
				}
				scaled_wealth = {
					value = -0.2
					min = 100
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_2
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.7
					min = 350
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.1
					min = 50
				}
				scaled_wealth = {
					value = -0.15
					min = 75
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_1
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.8
					min = 400
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				transfer_scaled_wealth = {
					to = event_target:courtier_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.1
					min = 50
				}
			}
		}
		else_if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_1
					has_law = ci_courtier_law_0
				}
			}
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.9
					min = 450
				}
				transfer_scaled_wealth = {
					to = event_target:eunuch_target
					value = 0.05
					min = 25
				}
				scaled_wealth = {
					value = -0.05
					min = 25
				}
			}
		}
		else = {
			event_target:grace_decision_taker = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 1
					min = 500
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6011 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6010 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6012 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6011
	desc = EVTDESC_SOH_6011
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6011 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6012
	desc = EVTDESC_SOH_6012
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6012 # Really?
	}
}



##### Become Tributary

### Become Tributary

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6013
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	only_independent = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		controls_religion = no
		NAND = {
			can_have_any_japanese_government_trigger = yes
			any_realm_lord = {
				OR = {
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
		war = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		is_tributary = no
		e_china = {
			holder_scope = {
				war = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.01 # Make random distant realms unlikely to become tributaries
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													OR = {
														is_chinese_emperor_trigger = yes
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				# Kings and nomads are less willing to become tributaries
				modifier = {
					factor = 0.1
					OR = {
						real_tier = king
						real_tier = emperor # Nomads
					}
				}
				modifier = {
					factor = 0
					real_tier = emperor
					is_nomadic = no
				}
				# Rel heads do not kneel!
				modifier = {
					factor = 0
					controls_religion = yes
				}
				# Small realms are more likely to be willing to become tributaries
				modifier = {
					factor = 5
					NOT = {
						realm_size = 10
					}
				}
				# Large realms are less likely to be willing to become tributaries
				modifier = {
					factor = 0.1
					realm_size = 50
				}
				# At this size, the realm is too powerful to willingly become a tributary
				modifier = {
					factor = 0
					realm_size = 100
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 0
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					NOR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 0.1
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Is likely to be scared of China
				modifier = {
					factor = 10
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# China is less than twice as powerful
				modifier = {
					factor = 0
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.5
								}
							}
						}
					}
				}
				# China is less than four times as powerful
				modifier = {
					factor = 0.1
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.25
								}
							}
						}
					}
				}
				# China is more than ten times as powerful
				modifier = {
					factor = 5
					NOT = {
						e_china = {
							holder_scope = {
								ROOT = {
									relative_power = {
										who = PREV
										power = 0.1
									}
								}
							}
						}
					}
				}
				# Same culture
				modifier = {
					factor = 5
					e_china = {
						holder_scope = {
							culture = ROOT
						}
					}
				}
				# Same culture group
				modifier = {
					factor = 2
					e_china = {
						holder_scope = {
							culture_group = ROOT
							NOT = {
								culture = ROOT
							}
						}
					}
				}
				# Civilized
				modifier = {
					factor = 2
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					e_china = {
						holder_scope = {
							is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
						}
					}
				}
				# We are uncivilized
				modifier = {
					factor = 0.5
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
				}
				# We are uncivilized and distant
				modifier = {
					factor = 0.2
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
							}
						}
					}			
				}
				# If someone is just too different, they should want to be free a bit more often
				modifier = {
					factor = 0.1
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
					NOR = {
						e_china = {
							holder_scope = {
								culture_group = ROOT
							}
						}
						culture_group = chinese_group
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# Barbarians
				modifier = {
					factor = 0.1
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# Pagans should be more unlikely to become tributaries
				modifier = {
					factor = 0.5
					religion_group = pagan_group
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
					is_reformed_religion = no
				}
				modifier = { # Don't submit to China if next to a reasonably powerful pretender and not next to China!
					factor = 0
					any_neighbor_independent_ruler = {
						government = chinese_imperial_government
						OR = {
							has_character_modifier = mandate_of_heaven_3
							has_character_modifier = mandate_of_heaven_4
							has_character_modifier = mandate_of_heaven_5
						}
						NOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					NOT = {
						any_neighbor_independent_ruler = {
							is_chinese_emperor_trigger = yes
							OR = {
								has_character_modifier = mandate_of_heaven_3
								has_character_modifier = mandate_of_heaven_4
								has_character_modifier = mandate_of_heaven_5
							}
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_tributary_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_tributary_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6015 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6016 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6014
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_tributary_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_tributary_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6015 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6016 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6015
	desc = {
		text = EVTDESCA_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6015
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6015 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6015 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6015 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6016 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6016
	is_triggered_only = yes
	title = EVTTITLE_SOH_6016
	desc = {
		text = EVTDESCA_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6016
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6016 # Accept the offer
		
		if = {
			limit = {
				NOT = {
					event_target:grace_decision_taker = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												any_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															character = ROOT
															any_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																character = ROOT
																any_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			make_tributary = {
				who = event_target:grace_decision_taker
				tributary_type = chinese_peripheral_tributary
			}
		}
		else = {
			make_tributary = {
				who = event_target:grace_decision_taker
				tributary_type = chinese_imperial_tributary
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6017 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6016 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6018 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6017
	desc = EVTDESC_SOH_6017
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6017 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6018
	desc = EVTDESC_SOH_6018
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6018 # Really?
	}
}



##### Supply Horses

### Supply Horses - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6019
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Horse Lords"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_nomadic = yes
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			liege = {
				independent = yes
			}
		}
		NOT = {
			top_liege = {
				is_chinese_emperor_trigger = yes
			}
		}
		NOT = {
			top_liege = {
				suzerain = {
					government = chinese_imperial_government
					NOT = {
						is_chinese_emperor_trigger = yes
					}
				}
			}
		}
		war = no
		unused_manpower = 300
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				war = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOR = {
						trait = humble
						trait = shy
						trait = craven
					}
				}
				modifier = {
					factor = 0
					OR = {
						trait = ambitious
						trait = proud
					}
				}
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_horses_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_horses_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6021 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6022 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6020
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6021 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6022 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6021
	desc = {
		text = EVTDESCA_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6021
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6021 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6021 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6021 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6022 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6022
	is_triggered_only = yes
	title = EVTTITLE_SOH_6022
	desc = {
		text = EVTDESCA_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6022
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6022 # Accept the offer
		
		capital_scope = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					troops = {
						knights = { 50 50 }
						light_cavalry = { 100 100 }
						horse_archers = { 150 150 }
					}
					attrition = 1.0
					maintenance_multiplier = 0.5
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6023 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6022 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6024 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6023
	desc = EVTDESC_SOH_6023
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6023 # Great!
		
		set_character_flag = grace_character
		
		manpower = -300
	}
}

# Offer refused
letter_event = {
	id = soh.6024
	desc = EVTDESC_SOH_6024
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6024 # Really?
	}
}

### Supply Horses - vassal - NOTHING TO SEE HERE!

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6025
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Horse Lords"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_nomadic = yes
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		war = no
		unused_manpower = 300
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				war = no
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOR = {
						trait = humble
						trait = shy
						trait = craven
					}
				}
				modifier = {
					factor = 0
					OR = {
						trait = ambitious
						trait = proud
					}
				}
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_horses_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_horses_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6027 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6028 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6026
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_horses_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6027 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6028 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6027
	desc = {
		text = EVTDESCA_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6027
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6027 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6027 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6027 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6028 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6028
	is_triggered_only = yes
	title = EVTTITLE_SOH_6028
	desc = {
		text = EVTDESCA_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6028
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6028 # Accept the offer
		
		capital_scope = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					troops = {
						knights = { 50 50 }
						light_cavalry = { 100 100 }
						horse_archers = { 150 150 }
					}
					attrition = 1.0
					maintenance_multiplier = 0.5
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6029 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6028 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6030 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6029
	desc = EVTDESC_SOH_6029
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6029 # Great!
		
		set_character_flag = grace_character
		
		manpower = -300
	}
}

# Offer refused
letter_event = {
	id = soh.6030
	desc = EVTDESC_SOH_6030
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6030 # Really?
	}
}



##### Offer Eunuch

### Offer Eunuch - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6031
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOT = {
			top_liege = {
				suzerain = {
					government = chinese_imperial_government
					NOT = {
						is_chinese_emperor_trigger = yes
					}
				}
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NAND = { # No snipping off members of the Imperial Family if you care
				OR = {
					any_dynasty_member = {
						religion = shinto
						controls_religion = yes
					}
					any_dynasty_member = {
						religion = ryukyuan_pagan_reformed
						controls_religion = yes
						government = divine_imperial_government
					}
				}
				ROOT = {
					can_have_any_japanese_government_trigger = yes
				}
			}
			NOT = {
				any_dynasty_member = {
					is_chinese_emperor_trigger = yes
				}
			}
			custom_tooltip = {
				text = is_landless_male_tt
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_female = yes }
				NOT = { is_patrician = yes }
			}
			NOT = { is_heir = yes }
			OR = {
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				AND = {
					prisoner = yes
					host = {
						character = ROOT
					}
				}
			}
			custom_tooltip = { #can't be from China
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			custom_tooltip = {
				text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
				NOT = { trait = one_eyed }
				NOT = { trait = one_handed }
				NOT = { trait = one_legged }
				NOT = { trait = disfigured }
				NOT = { trait = mangled }
			}
			OR = {
				NOT = { prisoner = yes }
				host = {
					character = ROOT
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				NAND = { # No snipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOT = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				NOT = { is_heir = yes }
				OR = {
					custom_tooltip = {
						text = not_married_or_getting_married_tt
						NOT = { is_betrothed = yes }
						NOT = { is_married = yes }
					}
					AND = {
						prisoner = yes
						host = {
							character = ROOT
						}
					}
				}
				custom_tooltip = { #can't be from China
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					event_target:tribute_character = {
						dynasty = ROOT
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:tribute_character = {
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						event_target:tribute_character = {
							NOT = {
								trait = eunuch
							}
						}
					}
					event_target:tribute_character = {
						add_trait = eunuch
						hidden_tooltip = {
							opinion = {
								who = ROOT
								modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
							}
							any_close_relative = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_close_kin
								}
							}
							any_dynasty_member = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_family
								}
							}
						}
						remove_friend = ROOT
						remove_lover = ROOT
					}
				}
				if = {
					limit = {
						china_would_refuse_eunuch_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_eunuch_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6033 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6034 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6032
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6033 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6034 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6033
	desc = {
		text = EVTDESCA_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6033
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6033 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6033 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6033 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6034 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6034
	is_triggered_only = yes
	title = EVTTITLE_SOH_6034
	desc = {
		text = EVTDESCA_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6034
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6034 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			if = {
				limit = {
					prisoner = yes
				}
				prisoner = no
			}
			move_character = event_target:eoc
			force_host = event_target:eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6035 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6034 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6036 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6035
	desc = EVTDESC_SOH_6035
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6035 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6036
	desc = EVTDESC_SOH_6036
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6036 # Really?
	}
}

### Offer Eunuch - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6037
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NAND = { # No snipping off members of the Imperial Family if you care
				OR = {
					any_dynasty_member = {
						religion = shinto
						controls_religion = yes
					}
					any_dynasty_member = {
						religion = ryukyuan_pagan_reformed
						controls_religion = yes
						government = divine_imperial_government
					}
				}
				ROOT = {
					can_have_any_japanese_government_trigger = yes
				}
			}
			NOT = {
				any_dynasty_member = {
					is_chinese_emperor_trigger = yes
				}
			}
			custom_tooltip = {
				text = is_landless_male_tt
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_female = yes }
				NOT = { is_patrician = yes }
			}
			NOT = { is_heir = yes }
			OR = {
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				AND = {
					prisoner = yes
					host = {
						character = ROOT
					}
				}
			}
			custom_tooltip = { #can't be from China
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			custom_tooltip = {
				text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
				NOT = { trait = one_eyed }
				NOT = { trait = one_handed }
				NOT = { trait = one_legged }
				NOT = { trait = disfigured }
				NOT = { trait = mangled }
			}
			OR = {
				NOT = { prisoner = yes }
				host = {
					character = ROOT
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				NAND = { # No snipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT = {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOT = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
				}
				custom_tooltip = {
					text = is_landless_male_tt
					NOT = { is_landed = yes }
					NOT = { is_ruler = yes }
					NOT = { is_female = yes }
					NOT = { is_patrician = yes }
				}
				NOT = { is_heir = yes }
				OR = {
					custom_tooltip = {
						text = not_married_or_getting_married_tt
						NOT = { is_betrothed = yes }
						NOT = { is_married = yes }
					}
					AND = {
						prisoner = yes
						host = {
							character = ROOT
						}
					}
				}
				custom_tooltip = { #can't be from China
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					event_target:tribute_character = {
						dynasty = ROOT
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					event_target:tribute_character = {
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						event_target:tribute_character = {
							NOT = {
								trait = eunuch
							}
						}
					}
					event_target:tribute_character = {
						add_trait = eunuch
						hidden_tooltip = {
							opinion = {
								who = ROOT
								modifier = opinion_castrated_me # The potential eunuch will be a mite upset about the whole "Snipped me off to China" thing, even if the EoC turns him down
							}
							any_close_relative = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_close_kin
								}
							}
							any_dynasty_member = {
								opinion = {
									who = ROOT
									modifier = opinion_castrated_family
								}
							}
						}
						remove_friend = ROOT
						remove_lover = ROOT
					}
				}
				if = {
					limit = {
						china_would_refuse_eunuch_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_eunuch_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6039 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6040 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6038
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_eunuch_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6039 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6040 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6039
	desc = {
		text = EVTDESCA_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6039
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6039 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6039 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6039 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6040 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6040
	is_triggered_only = yes
	title = EVTTITLE_SOH_6040
	desc = {
		text = EVTDESCA_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6040
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6040 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			if = {
				limit = {
					prisoner = yes
				}
				prisoner = no
			}
			move_character = event_target:eoc
			force_host = event_target:eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6041 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6040 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6042 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6041
	desc = EVTDESC_SOH_6041
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6041 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6042
	desc = EVTDESC_SOH_6042
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6042 # Really?
	}
}



##### Offer Concubine

### Offer Concubine - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6043
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOT = {
			has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				OR = {
					AND = {
						is_adult = yes
						is_female = no
						NOR = {
							trait = celibate
							trait = eunuch
						}
					}
					any_dynasty_member = {
						host = {
							character = ROOT
						}
						prisoner = no
						is_adult = yes
						is_female = no
						NOR = {
							trait = celibate
							trait = eunuch
						}
					}
				}
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NAND = { # No shipping off members of the Imperial Family if you care
				OR = {
					any_dynasty_member = {
						religion = shinto
						controls_religion = yes
					}
					any_dynasty_member = {
						religion = ryukyuan_pagan_reformed
						controls_religion = yes
						government = divine_imperial_government
					}
				}
				ROOT= {
					can_have_any_japanese_government_trigger = yes
				}
			}
			NOR = {
				any_dynasty_member = {
					is_chinese_emperor_trigger = yes
				}
				e_china = {
					holder_scope = {
						OR = {
							is_descendant_of = PREVPREV
							is_ancestor_of = PREVPREV
						}
					}
				}
				any_sibling = {
					is_chinese_emperor_trigger = yes
				}
			}
			is_female = yes
			# Has no children, and has never had any children
			NOT = {
				any_child_even_if_dead = {
					always = yes
				}
			}
			OR = {
				# Close relative of yours
				custom_tooltip = {
					text = is_close_relative_or_same_dynasty_tt
					OR = {
						is_close_relative = ROOT
						dynasty = ROOT
					}
				}
				# From a high-ranking family
				any_close_relative = {
					OR = {
						real_tier = king
						real_tier = emperor
					}
				}
				# Very beautiful
				trait = fair
				# Likely to be able to catch someone's attention
				AND = {
					trait = seductress
					NOT = {
						trait = homosexual
					}
				}
			}
			#custom_tooltip = {
				#text = is_adult_under_35_tt
				is_adult = yes
				NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
			#}
			NOT = { is_landed = yes }
			NOT = { is_ruler = yes }
			NOT = { is_heir = yes }
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			custom_tooltip = {
				text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
				NOT = { trait = one_eyed }
				NOT = { trait = one_handed }
				NOT = { trait = one_legged }
				NOT = { trait = disfigured }
				NOT = { trait = mangled }
			}
			OR = {
				NOT = { prisoner = yes }
				host = {
					character = ROOT
				}
			}
			custom_tooltip = {
				text = is_not_ascetic_or_celibate_tt
				NOT = { is_ascetic_trigger = yes }
				NOT = { trait = celibate }
			}
			NOR = {
				trait = pregnant # Known to be pregnant
				trait = hard_pregnancy # This is missing in vanilla but should probably be here...
				trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
				trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
				any_lover = {
					character = ROOT
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				NAND = { # No shipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT= {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOR = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
					e_china = {
						holder_scope = {
							OR = {
								is_descendant_of = PREVPREV
								is_ancestor_of = PREVPREV
							}
						}
					}
					any_sibling = {
						is_chinese_emperor_trigger = yes
					}
				}
				is_female = yes
				# Has no children, and has never had any children
				NOT = {
					any_child_even_if_dead = {
						always = yes
					}
				}
				OR = {
					# Close relative of yours
					custom_tooltip = {
						text = is_close_relative_or_same_dynasty_tt
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
						}
					}
					# From a high-ranking family
					any_close_relative = {
						OR = {
							real_tier = king
							real_tier = emperor
						}
					}
					# Very beautiful
					trait = fair
					# Likely to be able to catch someone's attention
					AND = {
						trait = seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT
					}
				}
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy # This is missing in vanilla but should probably be here...
					trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
					trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
					any_lover = {
						character = ROOT
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT # Dangerous
					}
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT # Dangerous
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					# Religion + government does not allow concubinage
					FROM = {
						NOR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							religion_group = christian
							religion_group = muslim
							religion_group = jewish_group
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0 # Would like to marry/concubine this character, probably
					OR = {
						religion = zoroastrian
						religion = melanesian
						religion = inca_religion
						religion = inca_religion_reformed
						has_religion_feature = religion_holy_family
						has_religion_feature = religion_feature_zun
					}
					event_target:tribute_character = {
						any_close_relative = {
							character = ROOT
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_concubine_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_concubine_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6045 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6046 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6044
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6045 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6046 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6045
	desc = {
		text = EVTDESCA_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6045
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6045 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6045 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6045 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6046 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6046
	is_triggered_only = yes
	title = EVTTITLE_SOH_6046
	desc = {
		text = EVTDESCA_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6046
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_dynasty_member = {
			limit = {
				is_adult = yes
				is_female = no
				is_landed = no
				NOT = {
					num_of_consorts = 3
				}
				host = {
					character = ROOT
				}
				NOR = {
					trait = eunuch
					trait = celibate
				}
			}
			preferred_limit = {
				any_close_relative = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			preferred_limit = {
				OR = {
					any_friend = {
						character = ROOT
					}
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = relative_to_give_tribute
		}
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_female = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					num_of_consorts = 3
				}
				has_concubinage = yes
				is_inaccessible_or_incapable_trigger = no
				NOR = {
					dynasty = ROOT
					dynasty = event_target:grace_decision_taker
					dynasty = event_target:tribute_character
					is_descendant_of = event_target:tribute_character
					is_ancestor_of = event_target:tribute_character
					any_close_relative = {
						character = event_target:tribute_character
					}
					trait = eunuch
					trait = celibate
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6046 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			ROOT = {
				add_consort = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6046 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6048 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:relative_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6046 # Give the concubine to a relative
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			event_target:relative_to_give_tribute = {
				add_consort = PREV
			}
		}
		reverse_opinion = {
			who = event_target:relative_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTD_SOH_6046 # Give the concubine to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			event_target:vassal_to_give_tribute = {
				add_consort = PREV
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6055 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6047 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6047
	desc = {
		text = EVTDESCA_SOH_6047
		trigger = {
			FROM = {
				any_consort = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6047
		trigger = {
			FROM = {
				any_dynasty_member = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6047
		trigger = {
			FROM = {
				any_realm_lord = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6047 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6048
	desc = EVTDESC_SOH_6048
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6048 # Really?
	}
}

### Offer Concubine - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6049
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			liege = {
				independent = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOT = {
			has_religion_feature = religion_matriarchal # If we're Matriarchial, we shouldn't accept concubinage
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				OR = {
					AND = {
						is_adult = yes
						is_female = no
						NOR = {
							trait = celibate
							trait = eunuch
						}
					}
					any_dynasty_member = {
						host = {
							character = ROOT
						}
						prisoner = no
						is_adult = yes
						is_female = no
						NOR = {
							trait = celibate
							trait = eunuch
						}
					}
				}
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NAND = { # No shipping off members of the Imperial Family if you care
				OR = {
					any_dynasty_member = {
						religion = shinto
						controls_religion = yes
					}
					any_dynasty_member = {
						religion = ryukyuan_pagan_reformed
						controls_religion = yes
						government = divine_imperial_government
					}
				}
				ROOT= {
					can_have_any_japanese_government_trigger = yes
				}
			}
			NOR = {
				any_dynasty_member = {
					is_chinese_emperor_trigger = yes
				}
				e_china = {
					holder_scope = {
						OR = {
							is_descendant_of = PREVPREV
							is_ancestor_of = PREVPREV
						}
					}
				}
				any_sibling = {
					is_chinese_emperor_trigger = yes
				}
			}
			is_female = yes
			# Has no children, and has never had any children
			NOT = {
				any_child_even_if_dead = {
					always = yes
				}
			}
			OR = {
				# Close relative of yours
				custom_tooltip = {
					text = is_close_relative_or_same_dynasty_tt
					OR = {
						is_close_relative = ROOT
						dynasty = ROOT
					}
				}
				# From a high-ranking family
				any_close_relative = {
					OR = {
						real_tier = king
						real_tier = emperor
					}
				}
				# Very beautiful
				trait = fair
				# Likely to be able to catch someone's attention
				AND = {
					trait = seductress
					NOT = {
						trait = homosexual
					}
				}
			}
			#custom_tooltip = {
				#text = is_adult_under_35_tt
				is_adult = yes
				NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
			#}
			NOT = { is_landed = yes }
			NOT = { is_ruler = yes }
			NOT = { is_heir = yes }
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			custom_tooltip = {
				text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
				NOT = { trait = one_eyed }
				NOT = { trait = one_handed }
				NOT = { trait = one_legged }
				NOT = { trait = disfigured }
				NOT = { trait = mangled }
			}
			OR = {
				NOT = { prisoner = yes }
				host = {
					character = ROOT
				}
			}
			custom_tooltip = {
				text = is_not_ascetic_or_celibate_tt
				NOT = { is_ascetic_trigger = yes }
				NOT = { trait = celibate }
			}
			NOR = {
				trait = pregnant # Known to be pregnant
				trait = hard_pregnancy # This is missing in vanilla but should probably be here...
				trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
				trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
				any_lover = {
					character = ROOT
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				NAND = { # No shipping off members of the Imperial Family if you care
					OR = {
						any_dynasty_member = {
							religion = shinto
							controls_religion = yes
						}
						any_dynasty_member = {
							religion = ryukyuan_pagan_reformed
							controls_religion = yes
							government = divine_imperial_government
						}
					}
					ROOT= {
						can_have_any_japanese_government_trigger = yes
					}
				}
				NOR = {
					any_dynasty_member = {
						is_chinese_emperor_trigger = yes
					}
					e_china = {
						holder_scope = {
							OR = {
								is_descendant_of = PREVPREV
								is_ancestor_of = PREVPREV
							}
						}
					}
					any_sibling = {
						is_chinese_emperor_trigger = yes
					}
				}
				is_female = yes
				# Has no children, and has never had any children
				NOT = {
					any_child_even_if_dead = {
						always = yes
					}
				}
				OR = {
					# Close relative of yours
					custom_tooltip = {
						text = is_close_relative_or_same_dynasty_tt
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
						}
					}
					# From a high-ranking family
					any_close_relative = {
						OR = {
							real_tier = king
							real_tier = emperor
						}
					}
					# Very beautiful
					trait = fair
					# Likely to be able to catch someone's attention
					AND = {
						trait = seductress
						NOT = {
							trait = homosexual
						}
					}
				}
				#custom_tooltip = {
					#text = is_adult_under_35_tt
					is_adult = yes
					NOT = { age = 35 } # Vanilla uses 45, but we want the concubines to have a few childbearing years left
				#}
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				NOT = { is_heir = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				custom_tooltip = {
					text = is_not_one_eyed_handed_legged_disfigured_or_mangled_tt
					NOT = { trait = one_eyed }
					NOT = { trait = one_handed }
					NOT = { trait = one_legged }
					NOT = { trait = disfigured }
					NOT = { trait = mangled }
				}
				OR = {
					NOT = { prisoner = yes }
					host = {
						character = ROOT
					}
				}
				custom_tooltip = {
					text = is_not_ascetic_or_celibate_tt
					NOT = { is_ascetic_trigger = yes }
					NOT = { trait = celibate }
				}
				NOR = {
					trait = pregnant # Known to be pregnant
					trait = hard_pregnancy # This is missing in vanilla but should probably be here...
					trait = troubled_pregnancy # This is missing in vanilla but should probably be here...
					trait = pregnancy_finishing # This is missing in vanilla but should probably be here...
					any_lover = {
						character = ROOT
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT # Dangerous
					}
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT # Dangerous
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					# Religion + government does not allow concubinage
					FROM = {
						NOR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							religion_group = christian
							religion_group = muslim
							religion_group = jewish_group
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0 # Would like to marry/concubine this character, probably
					OR = {
						religion = zoroastrian
						religion = melanesian
						religion = inca_religion
						religion = inca_religion_reformed
						has_religion_feature = religion_holy_family
						has_religion_feature = religion_feature_zun
					}
					event_target:tribute_character = {
						any_close_relative = {
							character = ROOT
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_concubine_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_concubine_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6051 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6052 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6050
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_concubine_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6051 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6052 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6051
	desc = {
		text = EVTDESCA_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6051
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6051 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6051 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6051 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6052 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6052
	is_triggered_only = yes
	title = EVTTITLE_SOH_6052
	desc = {
		text = EVTDESCA_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6052
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_dynasty_member = {
			limit = {
				is_adult = yes
				is_female = no
				is_landed = no
				NOT = {
					num_of_consorts = 3
				}
				host = {
					character = ROOT
				}
				NOR = {
					trait = eunuch
					trait = celibate
				}
			}
			preferred_limit = {
				any_close_relative = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			preferred_limit = {
				OR = {
					any_friend = {
						character = ROOT
					}
					ROOT = {
						current_heir = {
							character = PREVPREV
						}
					}
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = relative_to_give_tribute
		}
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_female = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					num_of_consorts = 3
				}
				has_concubinage = yes
				is_inaccessible_or_incapable_trigger = no
				NOR = {
					dynasty = ROOT
					dynasty = event_target:grace_decision_taker
					dynasty = event_target:tribute_character
					is_descendant_of = event_target:tribute_character
					is_ancestor_of = event_target:tribute_character
					any_close_relative = {
						character = event_target:tribute_character
					}
					trait = eunuch
					trait = celibate
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				any_friend = {
					character = ROOT
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6052 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			ROOT = {
				add_consort = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6052 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6054 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:relative_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6052 # Give the concubine to a relative
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			event_target:relative_to_give_tribute = {
				add_consort = PREV
			}
		}
		reverse_opinion = {
			who = event_target:relative_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTD_SOH_6052 # Give the concubine to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			event_target:vassal_to_give_tribute = {
				add_consort = PREV
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6055 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6053 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6053
	desc = {
		text = EVTDESCA_SOH_6053
		trigger = {
			FROM = {
				any_consort = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6053
		trigger = {
			FROM = {
				any_dynasty_member = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6053
		trigger = {
			FROM = {
				any_realm_lord = {
					any_consort = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6053 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6054
	desc = EVTDESC_SOH_6054
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6054 # Really?
	}
}

### Inform vassal

# Vassal got concubine
letter_event = {
	id = soh.6055
	desc = EVTDESC_SOH_6055
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = homosexual
			}
		}
		name = EVTOPTA_SOH_6055 # Nice!
		
		add_consort = event_target:tribute_character
	}
	
	option = {
		trigger = {
			trait = homosexual
		}
		name = EVTOPTB_SOH_6055 # That's... nice?
		
		add_consort = event_target:tribute_character
	}
}



##### Offer Commander

### Offer Commander - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6056
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		war = no # Foolish otherwise
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			is_adult = yes
			martial = 12
			is_heir = no
			NOT = { is_landed = yes }
			NOT = { is_ruler = yes }
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}

			NOT = { prisoner = yes }
			
			OR = {
				is_female = no
				AND = {
					has_minor_title = title_commander
					e_china = {
						has_law = status_of_women_4 # Allows female commmanders
					}
				}
				custom_tooltip = {
					text = can_be_female_commander
					has_character_flag = special_marshal
				}
				has_game_rule = {
					name = gender
					value = all
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				is_adult = yes
				martial = 12
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						e_china = {
							has_law = status_of_women_4 # Allows female commmanders
						}
					}
					custom_tooltip = {
						text = can_be_female_commander
						has_character_flag = special_marshal
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_commander_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_commander_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6058 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6059 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6057
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6058 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6059 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6058
	desc = {
		text = EVTDESCA_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6058
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6058 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6058 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6058 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6059 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6059
	is_triggered_only = yes
	title = EVTTITLE_SOH_6059
	desc = {
		text = EVTDESCA_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6059
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				in_faction = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					e_china = {
						claimed_by = PREV
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6059 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6060 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6059 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6061 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6059 # Give the commander to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6068 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6060 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6060
	desc = {
		text = EVTDESCA_SOH_6060
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6060
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6060 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6061
	desc = EVTDESC_SOH_6061
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6061 # Really?
	}
}

### Offer Commander - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6062
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		has_dlc = "Jade Dragon"
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		war = no # Foolish otherwise
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			is_adult = yes
			is_heir = no
			NOT = { is_landed = yes }
			NOT = { is_ruler = yes }
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}

			NOT = { prisoner = yes }
			
			OR = {
				is_female = no
				AND = {
					has_minor_title = title_commander
					e_china = {
						has_law = status_of_women_4 # Allows female commmanders
					}
				}
				custom_tooltip = {
					text = can_be_female_commander
					has_character_flag = special_marshal
				}
				has_game_rule = {
					name = gender
					value = all
				}
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				is_adult = yes
				OR = {
					martial = 12
					has_education_martial_trigger = yes
				}
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						e_china = {
							has_law = status_of_women_4 # Allows female commmanders
						}
					}
					custom_tooltip = {
						text = can_be_female_commander
						has_character_flag = special_marshal
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_commander_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_commander_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6064 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6065 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6063
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_commander_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6064 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6065 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6064
	desc = {
		text = EVTDESCA_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6064
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6064 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6064 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6064 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6065 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6065
	is_triggered_only = yes
	title = EVTTITLE_SOH_6065
	desc = {
		text = EVTDESCA_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6065
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				in_faction = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				NOT = {
					e_china = {
						claimed_by = PREV
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6065 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6066 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6065 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6067 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6065 # Give the commander to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						can_grant_title = title_commander
					}
				}
				give_minor_title = title_commander
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6068 } # Inform vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6066 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6066
	desc = {
		text = EVTDESCA_SOH_6066
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6066
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6066 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6067
	desc = EVTDESC_SOH_6067
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6067 # Really?
	}
}

### Inform vassal

# Vassal got commander
letter_event = {
	id = soh.6068
	desc = EVTDESC_SOH_6068
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6068 # Nice!
	}
}



##### Offer Physician

### Offer Physician - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6069
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Reapers"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		NOT = {
			any_realm_province = {
				has_disease = yes # China would probably not trust you not to send a plague-carrier
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NOT = { is_ruler = yes }
			is_adult = yes
			is_heir = no
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			OR = {
				conditional_tooltip = {
					trigger = {
						has_dlc = Reapers
					}
					has_minor_title = title_court_physician 
				}
				trait = physician
				trait = scholar
				trait = mystic
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
			NOT = { is_landed = yes }
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				NOT = { is_ruler = yes }
				is_adult = yes
				is_heir = no
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}
				OR = {
					conditional_tooltip = {
						trigger = {
							has_dlc = Reapers
						}
						has_minor_title = title_court_physician 
					}
					trait = physician
					trait = scholar
					trait = mystic
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_physician_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_physician_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6071 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6072 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6070
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6071 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6072 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6071
	desc = {
		text = EVTDESCA_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6071
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6071 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6071 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6071 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6072 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6072
	is_triggered_only = yes
	title = EVTTITLE_SOH_6072
	desc = {
		text = EVTDESCA_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6072
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6072 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6073 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6072 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6074 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6072 # Give the physician to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6081 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6073 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6073
	desc = {
		text = EVTDESCA_SOH_6073
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6073
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6073 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6074
	desc = EVTDESC_SOH_6074
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6074 # Really?
	}
}

### Offer Physician - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6075
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Reapers"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOT = {
			any_demesne_province = {
				has_disease = yes # China would probably not trust you not to send a plague-carrier
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			NOT = { is_ruler = yes }
			is_adult = yes
			is_heir = no
			custom_tooltip = {
				text = not_married_or_getting_married_tt
				NOT = { is_betrothed = yes }
				NOT = { is_married = yes }
			}
			custom_tooltip = {
				text = is_not_from_china_tt
				courtier_from_china_trigger = no
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			custom_tooltip = {
				text = is_not_maimed_or_infirm_tt
				NOT = { trait = maimed }
				NOT = { trait = infirm }
			}
			OR = {
				conditional_tooltip = {
					trigger = {
						has_dlc = Reapers
					}
					has_minor_title = title_court_physician 
				}
				trait = physician
				trait = scholar
				trait = mystic
			}
			is_ill = no
			custom_tooltip = {
				text = is_not_wounded_severely_injured_tt
				NOT = { trait = wounded }
				NOT = { trait = severely_injured }
			}
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
			NOT = { is_landed = yes }
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				is_adult = yes
				OR = {
					martial = 12
					has_education_martial_trigger = yes
				}
				is_heir = no
				NOT = { is_landed = yes }
				NOT = { is_ruler = yes }
				custom_tooltip = {
					text = not_married_or_getting_married_tt
					NOT = { is_betrothed = yes }
					NOT = { is_married = yes }
				}
				custom_tooltip = {
					text = is_not_from_china_tt
					courtier_from_china_trigger = no
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				custom_tooltip = {
					text = is_not_maimed_or_infirm_tt
					NOT = { trait = maimed }
					NOT = { trait = infirm }
				}

				NOT = { prisoner = yes }
				
				OR = {
					is_female = no
					AND = {
						has_minor_title = title_commander
						e_china = {
							has_law = status_of_women_4 # Allows female commmanders
						}
					}
					custom_tooltip = {
						text = can_be_female_commander
						has_character_flag = special_marshal
					}
					has_game_rule = {
						name = gender
						value = all
					}
				}
				is_ill = no
				custom_tooltip = {
					text = is_not_wounded_severely_injured_tt
					NOT = { trait = wounded }
					NOT = { trait = severely_injured }
				}
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
			}
			preferred_limit = {
				NOR = {
					dynasty = ROOT
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = tribute_character
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_physician_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_physician_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6077 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6078 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6076
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_physician_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6077 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6078 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6077
	desc = {
		text = EVTDESCA_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6077
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6077 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6077 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6077 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6078 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6078
	is_triggered_only = yes
	title = EVTTITLE_SOH_6078
	desc = {
		text = EVTDESCA_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6078
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6078 # Accept the offer
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					ROOT = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6079 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6078 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6080 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6078 # Give the physician to a vassal
		
		event_target:tribute_character = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = no_court_invites
			
			move_character = event_target:vassal_to_give_tribute
			force_host = event_target:vassal_to_give_tribute
			
			if = {
				limit = {
					event_target:vassal_to_give_tribute = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6081 } # Inform vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6079 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6079
	desc = {
		text = EVTDESCA_SOH_6079
		trigger = {
			FROM = {
				any_courtier = {
					character = event_target:tribute_character
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6079
		trigger = {
			FROM = {
				any_realm_lord = {
					any_courtier = {
						character = event_target:tribute_character
					}
				}
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6079 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6080
	desc = EVTDESC_SOH_6080
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6080 # Really?
	}
}

### Inform vassal

# Vassal got physician
letter_event = {
	id = soh.6081
	desc = EVTDESC_SOH_6081
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6081 # Nice!
	}
}



##### Offer Artifact

### Offer Artifact - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6082
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_artifact = {
			custom_tooltip = {
				text = send_artifact_potential_tt
				#quality > 2
				NOR = {
					AND = {
						artifact_type = heirloom_seal_of_the_realm
						ROOT = {
							has_claim = e_china
						}
					}
					AND = {
						has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
						e_china = {
							holder_scope = {
								society_member_of = hermetics # Or that other thing...
							}
						}
					}
					has_artifact_flag = flag_considering_donation 
					has_artifact_flag = curse
					has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
					AND = {
						ROOT = { NOT = { has_landed_title = e_hre } }
						artifact_type = crown_hre
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_byzantium } }
						artifact_type = crown_byzantine
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_norse_pagan_reformed } }
						artifact_type = crown_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
						artifact_type = crown_tengri_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
						artifact_type = crown_slavic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
						artifact_type = crown_romuva_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
						artifact_type = crown_finnish_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
						artifact_type = crown_west_african_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_zun_pagan_reformed } }
						artifact_type = crown_zun_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = k_hellenic_pagan } }
						artifact_type = scepter_hellenic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_bon_reformed } }
						artifact_type = scepter_bon_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_aztec_reformed } }
						artifact_type = crown_aztec_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_persia } }
						artifact_type = crown_pahlavi
					}
					AND = { # The Imperial Regalia is far too important to send away
						ROOT = {
							can_have_any_japanese_government_trigger = yes
						}
						has_artifact_flag = imperial_regalia_of_japan
					}
					# TODO: Tianxia pagans
				}
			}
			e_china = {
				holder_scope = {
					NOT = {
						has_artifact = PREVPREV # Check this!
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_artifact = {
			limit = {
				#quality > 2
				NOR = {
					AND = {
						artifact_type = heirloom_seal_of_the_realm
						ROOT = {
							has_claim = e_china
						}
					}
					AND = {
						has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
						e_china = {
							holder_scope = {
								society_member_of = hermetics # Or that other thing...
							}
						}
					}
					has_artifact_flag = flag_considering_donation 
					has_artifact_flag = curse
					has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
					AND = {
						ROOT = { NOT = { has_landed_title = e_hre } }
						artifact_type = crown_hre
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_byzantium } }
						artifact_type = crown_byzantine
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_norse_pagan_reformed } }
						artifact_type = crown_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
						artifact_type = crown_tengri_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
						artifact_type = crown_slavic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
						artifact_type = crown_romuva_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
						artifact_type = crown_finnish_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
						artifact_type = crown_west_african_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_zun_pagan_reformed } }
						artifact_type = crown_zun_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = k_hellenic_pagan } }
						artifact_type = scepter_hellenic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_bon_reformed } }
						artifact_type = scepter_bon_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_aztec_reformed } }
						artifact_type = crown_aztec_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_persia } }
						artifact_type = crown_pahlavi
					}
					AND = { # The Imperial Regalia is far too important to send away
						ROOT = {
							can_have_any_japanese_government_trigger = yes
						}
						has_artifact_flag = imperial_regalia_of_japan
					}
					# TODO: Tianxia pagans
				}
			}
			e_china = {
				holder_scope = {
					NOT = {
						has_artifact = PREVPREV # Check this!
					}
				}
			}
			save_event_target_as = tribute_artifact
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_artifact_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_artifact_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6084 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6085 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6083
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6084 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6085 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6084
	desc = {
		text = EVTDESCA_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6084
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6084 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6084 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6084 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6085 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6085
	is_triggered_only = yes
	title = EVTTITLE_SOH_6085
	desc = {
		text = EVTDESCA_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6085
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_list = {
			33 = {
				modifier = {
					factor = 0
					primary_title = {
						has_law = eunuch_law_0
					}
				}
				modifier = {
					factor = 2
					primary_title = {
						has_law = eunuch_law_2
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = eunuch_law_4
					}
				}
				random_courtier = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					preferred_limit = {
						NOT = {
							has_position = loyalist
						}
					}
					save_event_target_as = eunuch_target
				}
			}
			34 = {
				modifier = {
					factor = 2
					primary_title = {
						has_law = ci_courtier_law_3
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = ci_courtier_law_4
					}
				}
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						OR = {
							AND = {
								is_voter = yes
								NOT = {
									has_position = loyalist
								}
							}
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
						NOR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
					}
					save_event_target_as = courtier_target
				}
			}
			33 = {
				modifier = {
					factor = 2
					primary_title = {
						has_law = ci_vassal_law_3
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = ci_vassal_law_4
					}
				}
				random_realm_lord = {
					limit = {
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							character = event_target:grace_decision_taker
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					save_event_target_as = vassal_to_give_tribute
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6085 # Accept the offer
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = ROOT
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6085 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6087 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6085 # Give the artifact to a vassal
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:vassal_to_give_tribute
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6094 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
		}
		name = EVTOPTD_SOH_6085 # Give the artifact to a courtier
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:courtier_target
			}
		}
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:eunuch_target = {
				always = yes
			}
		}
		name = EVTOPTE_SOH_6085 # Give the artifact to a eunuch
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:eunuch_target
			}
		}
		reverse_opinion = {
			who = event_target:eunuch_target
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6086 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6086
	desc = EVTDESC_SOH_6086
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6086 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6087
	desc = EVTDESC_SOH_6087
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6087 # Really?
	}
}

### Offer Artifact - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6088
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_artifact = {
			custom_tooltip = {
				text = send_artifact_potential_tt
				#quality > 2
				NOR = {
					AND = {
						artifact_type = heirloom_seal_of_the_realm
						ROOT = {
							has_claim = e_china
						}
					}
					AND = {
						has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
						e_china = {
							holder_scope = {
								society_member_of = hermetics # Or that other thing...
							}
						}
					}
					has_artifact_flag = flag_considering_donation 
					has_artifact_flag = curse
					has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
					AND = {
						ROOT = { NOT = { has_landed_title = e_hre } }
						artifact_type = crown_hre
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_byzantium } }
						artifact_type = crown_byzantine
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_norse_pagan_reformed } }
						artifact_type = crown_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
						artifact_type = crown_tengri_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
						artifact_type = crown_slavic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
						artifact_type = crown_romuva_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
						artifact_type = crown_finnish_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
						artifact_type = crown_west_african_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_zun_pagan_reformed } }
						artifact_type = crown_zun_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = k_hellenic_pagan } }
						artifact_type = scepter_hellenic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_bon_reformed } }
						artifact_type = scepter_bon_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_aztec_reformed } }
						artifact_type = crown_aztec_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_persia } }
						artifact_type = crown_pahlavi
					}
					AND = { # The Imperial Regalia is far too important to send away
						ROOT = {
							can_have_any_japanese_government_trigger = yes
						}
						has_artifact_flag = imperial_regalia_of_japan
					}
					# TODO: Tianxia pagans
				}
			}
			e_china = {
				holder_scope = {
					NOT = {
						has_artifact = PREVPREV # Check this!
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_artifact = {
			limit = {
				#quality > 2
				NOR = {
					AND = {
						artifact_type = heirloom_seal_of_the_realm
						ROOT = {
							has_claim = e_china
						}
					}
					AND = {
						has_artifact_flag = ingredient # Even compared to the rest of your paltry trinkets, this would be underwhelming
						e_china = {
							holder_scope = {
								society_member_of = hermetics # Or that other thing...
							}
						}
					}
					has_artifact_flag = flag_considering_donation 
					has_artifact_flag = curse
					has_artifact_flag = grace # Changed from "chinese" because that flag is useful elsewhere
					AND = {
						ROOT = { NOT = { has_landed_title = e_hre } }
						artifact_type = crown_hre
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_byzantium } }
						artifact_type = crown_byzantine
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_norse_pagan_reformed } }
						artifact_type = crown_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_tengri_pagan_reformed } }
						artifact_type = crown_tengri_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_slavic_pagan_reformed } }
						artifact_type = crown_slavic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_baltic_pagan_reformed } }
						artifact_type = crown_romuva_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_finnish_pagan_reformed } }
						artifact_type = crown_finnish_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_west_african_pagan_reformed } }
						artifact_type = crown_west_african_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_zun_pagan_reformed } }
						artifact_type = crown_zun_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = k_hellenic_pagan } }
						artifact_type = scepter_hellenic_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_bon_reformed } }
						artifact_type = scepter_bon_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = d_aztec_reformed } }
						artifact_type = crown_aztec_fylkir
					}
					AND = {
						ROOT = { NOT = { has_landed_title = e_persia } }
						artifact_type = crown_pahlavi
					}
					AND = { # The Imperial Regalia is far too important to send away
						ROOT = {
							can_have_any_japanese_government_trigger = yes
						}
						has_artifact_flag = imperial_regalia_of_japan
					}
					# TODO: Tianxia pagans
				}
			}
			e_china = {
				holder_scope = {
					NOT = {
						has_artifact = PREVPREV # Check this!
					}
				}
			}
			save_event_target_as = tribute_artifact
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_artifact_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_artifact_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6090 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6091 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6089
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_artifact_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6090 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6091 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6090
	desc = {
		text = EVTDESCA_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6090
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6090 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6090 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6090 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6091 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6091
	is_triggered_only = yes
	title = EVTTITLE_SOH_6091
	desc = {
		text = EVTDESCA_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6091
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_list = {
			33 = {
				modifier = {
					factor = 0
					primary_title = {
						has_law = eunuch_law_0
					}
				}
				modifier = {
					factor = 2
					primary_title = {
						has_law = eunuch_law_2
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = eunuch_law_4
					}
				}
				random_courtier = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					preferred_limit = {
						NOT = {
							has_position = loyalist
						}
					}
					save_event_target_as = eunuch_target
				}
			}
			34 = {
				modifier = {
					factor = 2
					primary_title = {
						has_law = ci_courtier_law_3
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = ci_courtier_law_4
					}
				}
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						OR = {
							AND = {
								is_voter = yes
								NOT = {
									has_position = loyalist
								}
							}
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
						NOR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
						NOR = {
							trait = content
							trait = slothful
							trait = just
						}
					}
					preferred_limit = {
						OR = {
							any_rival = {
								character = ROOT
							}
							AND = {
								is_voter = yes
								has_position = malcontent
							}
							NOT = {
								opinion = {
									who = ROOT
									value = -25
								}
							}
							trait = ambitious
							trait = envious
							trait = schemer
							trait = greedy
							trait = arbitrary
						}
					}
					save_event_target_as = courtier_target
				}
			}
			33 = {
				modifier = {
					factor = 2
					primary_title = {
						has_law = ci_vassal_law_3
					}
				}
				modifier = {
					factor = 5
					primary_title = {
						has_law = ci_vassal_law_4
					}
				}
				random_realm_lord = {
					limit = {
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							character = event_target:grace_decision_taker
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						liege = {
							character = ROOT
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						liege = {
							character = ROOT
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						is_feudal = yes
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						OR = {
							is_tribal = yes
							is_nomadic = yes
						}
						NOT = {
							any_rival = {
								character = ROOT
							}
						}
					}
					save_event_target_as = vassal_to_give_tribute
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6091 # Accept the offer
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = ROOT
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6091 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6093 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6091 # Give the artifact to a vassal
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:vassal_to_give_tribute
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6094 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
		}
		name = EVTOPTD_SOH_6091 # Give the artifact to a courtier
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:courtier_target
			}
		}
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:eunuch_target = {
				always = yes
			}
		}
		name = EVTOPTE_SOH_6091 # Give the artifact to a eunuch
		
		event_target:tribute_artifact = {
			transfer_artifact = {
				from = event_target:grace_decision_taker
				to = event_target:eunuch_target
			}
		}
		reverse_opinion = {
			who = event_target:eunuch_target
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6092 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6092
	desc = EVTDESC_SOH_6092
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6092 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6093
	desc = EVTDESC_SOH_6093
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6093 # Really?
	}
}

### Inform vassal

# Vassal got artifact
letter_event = {
	id = soh.6094
	desc = EVTDESC_SOH_6094
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6094 # Nice!
	}
}



##### Renounce Claims

### - Renounce Claims - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6095
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		e_china = {
			holder_scope = {
				OR = {
					any_demesne_title = {
						claimed_by = ROOT
						NOR = {
							de_jure_vassal_or_below = ROOT
							controls_religion = yes
							AND = {
								OR = {
									tier = king
									tier = emperor
								}
								ROOT = {
									OR = {
										tier = king
										tier = emperor
									}
								}
							}
						}
					}
					any_realm_lord = {
						any_demesne_title = {
							claimed_by = ROOT
							NOR = {
								de_jure_vassal_or_below = ROOT
								controls_religion = yes
								AND = {
									OR = {
										tier = king
										tier = emperor
									}
									ROOT = {
										OR = {
											tier = king
											tier = emperor
										}
									}
								}
							}
						}
					}
				}
				NOR = {
					any_demesne_title = {
						claimed_by = ROOT
						OR = {
							de_jure_vassal_or_below = ROOT
							controls_religion = yes
							AND = {
								OR = {
									tier = king
									tier = emperor
								}
								ROOT = {
									OR = {
										tier = king
										tier = emperor
									}
								}
							}
						}
					}
					any_realm_lord = {
						any_demesne_title = {
							claimed_by = ROOT
							OR = {
								de_jure_vassal_or_below = ROOT
								controls_religion = yes
								AND = {
									OR = {
										tier = king
										tier = emperor
									}
									ROOT = {
										OR = {
											tier = king
											tier = emperor
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					e_china = {
						holder_scope = {
							NOT = {
								relative_power = {
									who = ROOT
									power = 1
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.5
					e_china = {
						holder_scope = {
							NOT = {
								relative_power = {
									who = ROOT
									power = 0.5
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = brave
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = craven
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_renounce_tribute_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_renounce_tribute_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6097 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6098 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6096
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_renounce_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_renounce_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6097 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6098 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6097
	desc = {
		text = EVTDESCA_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6097
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6097 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6097 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6097 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6098 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6098
	is_triggered_only = yes
	title = EVTTITLE_SOH_6098
	desc = {
		text = EVTDESCA_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6098
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6098 # Accept the offer
		
		custom_tooltip = {
			text = tribute_renounce_claims
			any_demesne_title = {
				limit = {
					claimed_by = event_target:grace_decision_taker
					controls_religion = no
					NOT = {
						de_jure_vassal_or_below = event_target:grace_decision_taker
					}
				}
				remove_claim = event_target:grace_decision_taker
			}
			any_realm_lord = {
				any_demesne_title = {
					limit = {
						claimed_by = event_target:grace_decision_taker
						controls_religion = no
						NOT = {
							de_jure_vassal_or_below = event_target:grace_decision_taker
						}
					}
					remove_claim = event_target:grace_decision_taker
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6099 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6098 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6100 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6099
	desc = EVTDESC_SOH_6099
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6099 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6100
	desc = EVTDESC_SOH_6100
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6100 # Really?
	}
}

### Renounce Claims - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6101
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		e_china = {
			holder_scope = {
				any_demesne_title = {
					claimed_by = ROOT
					NOR = {
						de_jure_vassal_or_below = ROOT
						controls_religion = yes
						AND = {
							OR = {
								tier = king
								tier = emperor
							}
							ROOT = {
								OR = {
									tier = king
									tier = emperor
								}
							}
						}
					}
				}
				NOT = {
					any_demesne_title = {
						claimed_by = ROOT
						OR = {
							de_jure_vassal_or_below = ROOT
							controls_religion = yes
							AND = {
								OR = {
									tier = king
									tier = emperor
								}
								ROOT = {
									OR = {
										tier = king
										tier = emperor
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					e_china = {
						holder_scope = {
							NOT = {
								relative_power = {
									who = ROOT
									power = 1
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.5
					e_china = {
						holder_scope = {
							NOT = {
								relative_power = {
									who = ROOT
									power = 0.5
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = brave
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = craven
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_renounce_tribute_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_renounce_tribute_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6103 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6104 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6102
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_renounce_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_renounce_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6103 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6104 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6103
	desc = {
		text = EVTDESCA_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6103
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6103 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6103 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6103 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6104 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6104
	is_triggered_only = yes
	title = EVTTITLE_SOH_6104
	desc = {
		text = EVTDESCA_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6104
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6104 # Accept the offer
		
		custom_tooltip = {
			text = tribute_renounce_claims
			any_demesne_title = {
				limit = {
					claimed_by = event_target:grace_decision_taker
					controls_religion = no
					NOT = {
						de_jure_vassal_or_below = event_target:grace_decision_taker
					}
				}
				remove_claim = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6105 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6104 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6106 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6105
	desc = EVTDESC_SOH_6105
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6105 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6106
	desc = EVTDESC_SOH_6106
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6106 # Really?
	}
}



##### Cancel Favor (Tribute)

### Cancel Favor - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6107
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Zeus"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				owes_favor_to = ROOT
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = deceitful
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = honest
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_cancel_other_favor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_cancel_other_favor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6109 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6110 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6108
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6109 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6110 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6109
	desc = {
		text = EVTDESCA_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6109
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6109 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6109 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6109 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6110 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6110
	is_triggered_only = yes
	title = EVTTITLE_SOH_6110
	desc = {
		text = EVTDESCA_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6110
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6110 # Accept the offer
		
		reverse_remove_favor = event_target:grace_decision_taker
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6111 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6110 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6112 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6111
	desc = EVTDESC_SOH_6111
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6111 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6112
	desc = EVTDESC_SOH_6112
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6112 # Really?
	}
}

### Cancel Favor (Tribute) - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6113
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Zeus"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				owes_favor_to = ROOT
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = deceitful
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = honest
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_cancel_other_favor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_cancel_other_favor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6115 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6116 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6114
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_cancel_other_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6115 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6116 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6115
	desc = {
		text = EVTDESCA_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6115
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6115 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6115 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6115 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6116 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6116
	is_triggered_only = yes
	title = EVTTITLE_SOH_6116
	desc = {
		text = EVTDESCA_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6116
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6116 # Accept the offer
		
		reverse_remove_favor = event_target:grace_decision_taker
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6117 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6116 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6118 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6117
	desc = EVTDESC_SOH_6117
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6117 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6118
	desc = EVTDESC_SOH_6118
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6118 # Really?
	}
}



##### Transfer Prosperity

### Transfer Prosperity

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6119
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Reapers"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
			is_inaccessible_or_incapable_trigger = no
			any_realm_province = {
				NOR = {
					has_province_modifier = prosperity_modifier_3
					owner = {
						character = ROOT
					}
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		any_demesne_province = {
			OR = {
				has_province_modifier = prosperity_modifier_1
				has_province_modifier = prosperity_modifier_2
				has_province_modifier = prosperity_modifier_3
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = charitable
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_prosperity_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_prosperity_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6121 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6122 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6120
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_prosperity_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_prosperity_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6121 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6122 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6121
	desc = {
		text = EVTDESCA_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6121
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6121 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6121 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6121 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6122 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6122
	is_triggered_only = yes
	title = EVTTITLE_SOH_6122
	desc = {
		text = EVTDESCA_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6122
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
				any_demesne_province = {
					NOT = {
						has_province_modifier = prosperity_modifier_3
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				is_feudal = yes
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
	}
	
	option = {
		trigger = {
			any_demesne_province = {
				NOT = {
					has_province_modifier = prosperity_modifier_3
				}
			}
		}
		
		name = EVTOPTA_SOH_6122 # Accept the offer
		
		event_target:grace_decision_taker = {
			random_demesne_province = {
				limit = {
					OR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				preferred_limit = {
					NOT = {
						event_target:grace_decision_taker = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
				decrease_prosperity_effect = yes
			}
		}
		random_demesne_province = {
			preferred_limit = {
				ROOT = {
					capital_scope = {
						province = PREVPREV
					}
				}
			}
			preferred_limit = {
				has_province_modifier = depopulated_3
			}
			preferred_limit = {
				has_province_modifier = depopulated_2
			}
			preferred_limit = {
				has_province_modifier = depopulated_1
			}
			preferred_limit = {
				NOR = {
					has_province_modifier = prosperity_modifier_1
					has_province_modifier = prosperity_modifier_2
					has_province_modifier = prosperity_modifier_3
				}
			}
			preferred_limit = {
				has_province_modifier = prosperity_modifier_1
			}
			preferred_limit = {
				has_province_modifier = prosperity_modifier_2
			}
			if = {
				limit = {
					OR = {
						has_province_modifier = depopulated_3
						has_province_modifier = depopulated_2
						has_province_modifier = depopulated_1
					}
				}
				decrease_depopulation_effect = yes
			}
			else = {
				hidden_tooltip = { change_variable = { which = prosperity_value value = 100 } }
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6123 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6122 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6124 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6122 # Give it to a vassal
		
		event_target:grace_decision_taker = {
			random_demesne_province = {
				limit = {
					OR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				preferred_limit = {
					NOT = {
						event_target:grace_decision_taker = {
							capital_scope = {
								province = PREVPREV
							}
						}
					}
				}
				decrease_prosperity_effect = yes
			}
		}
		event_target:vassal_to_give_tribute = {
			random_demesne_province = {
				preferred_limit = {
					has_province_modifier = depopulated_3
				}
				preferred_limit = {
					has_province_modifier = depopulated_2
				}
				preferred_limit = {
					has_province_modifier = depopulated_1
				}
				preferred_limit = {
					event_target:vassal_to_give_tribute = {
						capital_scope = {
							province = PREVPREV
						}
					}
				}
				preferred_limit = {
					NOR = {
						has_province_modifier = prosperity_modifier_1
						has_province_modifier = prosperity_modifier_2
						has_province_modifier = prosperity_modifier_3
					}
				}
				preferred_limit = {
					has_province_modifier = prosperity_modifier_1
				}
				preferred_limit = {
					has_province_modifier = prosperity_modifier_2
				}
				if = {
					limit = {
						OR = {
							has_province_modifier = depopulated_3
							has_province_modifier = depopulated_2
							has_province_modifier = depopulated_1
						}
					}
					decrease_depopulation_effect = yes
				}
				else = {
					hidden_tooltip = { change_variable = { which = prosperity_value value = 100 } }
				}
			}
		}
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6125 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6123 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6123
	desc = EVTDESC_SOH_6123
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6123 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6124
	desc = EVTDESC_SOH_6124
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6124 # Really?
	}
}

### Inform vassal

# Vassal got Prosperity
letter_event = {
	id = soh.6125
	desc = EVTDESC_SOH_6125
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6125 # Nice!
	}
}



##### Transfer Society Currency

### Transfer Society Currency - non-vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6126
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	is_in_society = yes
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		society_currency >= 1000
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				same_society_as = ROOT
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = deceitful
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = honest
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_society_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_society_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								OR = {
									ROOT = {
										is_secret_society_member = no
									}
									same_society_as = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6128 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6129 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6127
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						OR = {
							FROMFROM = {
								is_secret_society_member = no
							}
							same_society_as = FROMFROM
						}
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6128 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6129 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6128
	desc = {
		text = EVTDESCA_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6128
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6128 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6128 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6128 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6129 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6129
	is_triggered_only = yes
	title = EVTTITLE_SOH_6129
	desc = {
		text = EVTDESCA_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6129
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6129 # Accept the offer
		
		change_society_currency = 1000
		event_target:grace_decision_taker = {
			change_society_currency = -1000
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6130 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6129 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6131 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6130
	desc = EVTDESC_SOH_6130
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6130 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6131
	desc = EVTDESC_SOH_6131
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6131 # Really?
	}
}

### Transfer Society Currency - vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6132
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	is_in_society = yes
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
			is_inaccessible_or_incapable_trigger = no
			same_society_as = ROOT
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		society_currency >= 1000
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = charitable
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_society_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_society_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
								OR = {
									ROOT = {
										is_secret_society_member = no
									}
									same_society_as = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6134 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									OR = {
										ROOT = {
											is_secret_society_member = no
										}
										same_society_as = ROOT
									}
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6135 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6133
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_society_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6134 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							OR = {
								FROMFROM = {
									is_secret_society_member = no
								}
								same_society_as = FROMFROM
							}
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6135 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6134
	desc = {
		text = EVTDESCA_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6134
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6134 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6134 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6134 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6135 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6135
	is_triggered_only = yes
	title = EVTTITLE_SOH_6135
	desc = {
		text = EVTDESCA_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6135
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6135 # Accept the offer
		
		change_society_currency = 1000
		event_target:grace_decision_taker = {
			change_society_currency = -1000
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6136 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6135 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6137 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6136
	desc = EVTDESC_SOH_6136
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6136 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6137
	desc = EVTDESC_SOH_6137
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6137 # Really?
	}
}



##### Boost Mandate

### Boost Mandate

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6138
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
			is_inaccessible_or_incapable_trigger = no
		}
		prestige = 1000
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOT = {
			has_claim = e_china
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = greedy
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = charitable
				}
				modifier = {
					factor = 10
					trait = content
				}
				modifier = {
					factor = 10
					dynasty = event_target:eoc
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_moh_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_moh_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6140 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6141 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6139
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_moh_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_moh_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6140 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6141 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6140
	desc = {
		text = EVTDESCA_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6140
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6140 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6140 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6140 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6141 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6141
	is_triggered_only = yes
	title = EVTTITLE_SOH_6141
	desc = {
		text = EVTDESCA_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6141
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6141 # Accept the offer
		
		hidden_tooltip = {
			if = {
				limit = {
					event_target:grace_decision_taker = {
						real_tier = king
					}
				}
				change_variable = {
					which = mandate_of_heaven
					value = 5
				}
			}
			else_if = {
				limit = {
					event_target:grace_decision_taker = {
						real_tier = duke
					}
				}
				change_variable = {
					which = mandate_of_heaven
					value = 2
				}
			}
			else = {
				change_variable = {
					which = mandate_of_heaven
					value = 1
				}
			}
			event_target:grace_decision_taker = {
				scaled_prestige = {
					value = -1
					min = -1000
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6142 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6141 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6143 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6142
	desc = EVTDESC_SOH_6142
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6142 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6143
	desc = EVTDESC_SOH_6143
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6143 # Really?
	}
}



##### Ask to Increase Tributary Tier

### Ask to Increase Tributary Tier

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6144
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		NOT = {
			top_liege = {
				is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				war = no
				ROOT = {
					suzerain = {
						character = PREVPREV
					}
				}
			}
		}
		war = no # Is at peace
		# Only non-emperors and nomads can become a higher tier tributary
		OR = {
			NOT = {
				real_tier = emperor
			}
			is_nomadic = yes
		}
		controls_religion = no # You're too important for this!
		NAND = {
			can_have_any_japanese_government_trigger = yes
			any_realm_lord = {
				OR = {
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
		OR = {
			AND = {
				is_tributary = {
					type = chinese_client_state
				}
				any_realm_province = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				# China isn't interested in integrating tribal or nomadic land
				NOR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			AND = {
				is_tributary = {
					type = chinese_protectorate
				}
				any_realm_province = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				# China isn't really interested in nomads, and only cares about tribals in China/its de jure
				NOR = {
					AND = {
						is_tribal = yes
						NOT = {
							any_realm_province = {
								OR = {
									region = world_china
									county = {
										de_jure_liege_or_above = e_china
									}
								}
							}
						}
					}
					is_nomadic = yes
				}
				controls_religion = no # Rel heads don't want to be closely tied to a heathen
			}
			AND = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
				any_realm_province = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
										is_tributary = {
											type = chinese_client_state
										}
										is_tributary = {
											type = chinese_protectorate
										}
										top_liege = {
											OR = {
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
											}
										}
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
														}
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						# China doesn't want to get dragged into messy wars in the steppes
						is_nomadic = no
					}
				}
			}
			AND = {
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				any_realm_province = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										is_chinese_emperor_trigger = yes
										top_liege = {
											is_chinese_emperor_trigger = yes
										}
										AND = {
											OR = {
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												is_tributary = {
													type = chinese_imperial_tributary
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
										top_liege = {
											OR = {
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												is_tributary = {
													type = chinese_imperial_tributary
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
													AND = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															is_tributary = {
																type = chinese_imperial_tributary
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															is_tributary = {
																type = chinese_imperial_tributary
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														AND = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																is_tributary = {
																	type = chinese_imperial_tributary
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0.01 # Make random distant realms unlikely to try to become higher tier tributaries
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													OR = {
														is_chinese_emperor_trigger = yes
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				# Kings and nomads are less willing to become tributaries
				modifier = {
					factor = 0.1
					OR = {
						real_tier = king
						is_nomadic = yes
					}
				}
				modifier = {
					factor = 0
					real_tier = emperor
					is_nomadic = no
				}
				# Small realms are more likely to be willing to become tributaries
				modifier = {
					factor = 5
					NOT = {
						realm_size = 10
					}
				}
				# Large realms are less likely to be willing to become tributaries
				modifier = {
					factor = 0.1
					realm_size = 50
				}
				# At this size, the realm is too powerful to willingly become a tributary
				modifier = {
					factor = 0
					realm_size = 100
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 0.1
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					NOR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 0.25
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Is likely to be scared of China
				modifier = {
					factor = 10
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# China is less than twice as powerful
				modifier = {
					factor = 0.1
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.5
								}
							}
						}
					}
				}
				# China is less than four times as powerful
				modifier = {
					factor = 0.25
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.25
								}
							}
						}
					}
				}
				# China is more than ten times as powerful
				modifier = {
					factor = 5
					NOT = {
						e_china = {
							holder_scope = {
								ROOT = {
									relative_power = {
										who = PREV
										power = 0.1
									}
								}
							}
						}
					}
				}
				# Same culture
				modifier = {
					factor = 5
					e_china = {
						holder_scope = {
							culture = ROOT
						}
					}
				}
				# Same culture group
				modifier = {
					factor = 2
					e_china = {
						holder_scope = {
							culture_group = ROOT
							NOT = {
								culture = ROOT
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0
					e_china = {
						holder_scope = {
							is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
						}
					}
				}
				# Chinese
				modifier = {
					factor = 2
					culture_group = chinese_group
				}
				# Is "Chinese enough"
				modifier = {
					factor = 2
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				}
				# Is "Chinese enough"
				modifier = {
					factor = 5
					government = chinese_vassal_government
				}
				# We are uncivilized
				modifier = {
					factor = 0.1
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
				}
				# We won't willingly join China if we don't have a "Chinese enough" religion
				modifier = {
					factor = 0
					is_tributary = {
						type = chinese_client_state
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# Would become a vassal
				modifier = {
					factor = 0.1
					is_tributary = {
						type = chinese_client_state
					}
				}
				# Would become a Client State
				modifier = {
					factor = 0.25
					is_tributary = {
						type = chinese_protectorate
					}
				}
				# Would become a Protectorate
				modifier = {
					factor = 0.5
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				# I have strong neighbours and protection would be nice
				modifier = {
					factor = 2
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.5
								}
							}
						}
					}
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				modifier = {
					factor = 5
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.25
								}
							}
						}
					}
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				modifier = {
					factor = 10
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
					}
				}
				# More likely if China is doing well
				modifier = {
					factor = 10
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				modifier = {
					factor = 5
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_4
						}
					}
				}
				modifier = {
					factor = 0.25
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_2
						}
					}
				}
				modifier = {
					factor = 0.1
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_1
						}
					}
				}
				# If someone is just too different, they should want to be free a bit more often
				modifier = {
					factor = 0.1
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# If we want to get border adjustments, seriously consider it
				modifier = {
					factor = 10
					NOT = {
						is_tributary = {
							type = chinese_client_state # Already a client state, which is all we need
						}
					}
					e_china = {
						holder_scope = {
							any_realm_title = {
								tier = count
								NOR = {
									de_jure_liege_or_above = e_china
									region = world_china
								}
								de_jure_liege_or_above = ROOT
							}
						}
					}
				}
				# Pagans should be more unlikely to become tributaries
				modifier = {
					factor = 0.5
					religion_group = pagan_group
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
					is_reformed_religion = no
				}
				# If we're not in China, we should be unlikely to want to join China
				modifier = {
					factor = 0.001
					real_tier = king
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.01
					real_tier = duke
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					real_tier = count
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_increase_tributary_tier_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_increase_tributary_tier_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6146 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6147 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6145
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_increase_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_increase_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6146 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6147 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6146
	desc = {
		text = EVTDESCA_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6146
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6146 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6146 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6146 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6147 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6147
	is_triggered_only = yes
	title = EVTTITLE_SOH_6147
	desc = {
		text = EVTDESCA_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6147
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6147 # Accept the offer
		
		event_target:grace_decision_taker = {
			increase_tributary_tier_or_vassalize_effect = yes
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6148 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6147 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6149 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6148
	desc = EVTDESC_SOH_6148
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6148 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6149
	desc = EVTDESC_SOH_6149
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6149 # Really?
	}
}



##### Hand Over Title

### Hand Over Title

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6150
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			is_chinese_emperor_trigger = yes
			is_inaccessible_or_incapable_trigger = no
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		NOT = {
			has_claim = e_china
		}
		any_demesne_title = {
			NOT = {
				de_jure_vassal_or_below = ROOT
			}
			tier = count
		}
		any_demesne_title = {
			# Don't unland yourself!
			count = 2
			tier = count
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		random_demesne_title = {
			limit = {
				NOT = {
					de_jure_vassal_or_below = ROOT
				}
				tier = count
			}
			save_event_target_as = county_to_hand_over
		}
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = envious
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 10
					trait = content
				}
				modifier = {
					factor = 10
					dynasty = event_target:eoc
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_county_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_county_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6152 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6153 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6151
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6152 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6153 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6152
	desc = {
		text = EVTDESCA_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6152
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6152 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6152 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6152 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6153 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6153
	is_triggered_only = yes
	title = EVTTITLE_SOH_6153
	desc = {
		text = EVTDESCA_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6153
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_realm_lord = {
			limit = {
				is_feudal = yes
				is_adult = yes
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				liege = {
					character = ROOT
				}
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				liege = {
					character = ROOT
				}
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT
					}
				}
			}
			save_event_target_as = vassal_to_give_tribute
		}
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				is_council_eunuch_trigger = no
				NAND = {
					dynasty = ROOT
					any_close_relative = {
						character = ROOT
					}
				}
				OR = {
					AND = {
						is_voter = yes
						NOT = {
							has_position = loyalist
						}
					}
					any_spouse = {
						character = ROOT
					}
					any_consort = {
						character = ROOT
					}
					any_child = {
						character = ROOT
					}
					any_child_even_if_dead = {
						any_child = {
							character = ROOT
						}
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					any_friend = {
						character = ROOT
					}
					any_lover = {
						character = ROOT
					}
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
				NOR = {
					trait = content
					trait = slothful
					trait = just
				}
			}
			preferred_limit = {
				OR = {
					any_rival = {
						character = ROOT
					}
					AND = {
						is_voter = yes
						has_position = malcontent
					}
					NOT = {
						opinion = {
							who = ROOT
							value = -25
						}
					}
					trait = ambitious
					trait = envious
					trait = schemer
					trait = greedy
					trait = arbitrary
				}
			}
			save_event_target_as = courtier_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6153 # Accept the offer
		
		grant_title_no_opinion = event_target:county_to_hand_over
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6153 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6155 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_to_give_tribute = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_6153 # Give the county to a vassal
		
		grant_title_no_opinion = event_target:county_to_hand_over
		reverse_opinion = {
			who = event_target:vassal_to_give_tribute
			modifier = got_tribute_from_eoc
		}
		
		event_target:vassal_to_give_tribute = {
			letter_event = { id = soh.6156 } # Inform the vassal
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:courtier_target = {
				always = yes
			}
		}
		name = EVTOPTD_SOH_6153 # Give the county to a courtier
		
		grant_title_no_opinion = event_target:county_to_hand_over
		reverse_opinion = {
			who = event_target:courtier_target
			modifier = got_tribute_from_eoc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6154 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6154
	desc = EVTDESC_SOH_6154
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6154 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6155
	desc = EVTDESC_SOH_6155
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6155 # Really?
	}
}

### Inform vassal

# Vassal got title

letter_event = {
	id = soh.6156
	desc = EVTDESC_SOH_6156
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6156 # Nice!
	}
}



##### Offer Border Adjustment

### Offer Border Adjustment

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6157
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	only_playable = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_close_to_china_or_along_the_silk_road_trigger = yes
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Pretender emperors
			}
		}
		controls_religion = no
		NAND = {
			can_have_any_japanese_government_trigger = yes
			any_realm_lord = {
				OR = {
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		war = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				war = no
			}
		}
		any_realm_title = {
			tier = count
			OR = {
				region = world_china
				de_jure_liege_or_above = e_china
			}
			NOT = {
				de_jure_liege_or_above = ROOT
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		random_realm_title = {
			limit = {
				tier = count
				OR = {
					region = world_china
					de_jure_liege_or_above = e_china
				}
				NOT = {
					de_jure_liege_or_above = ROOT
				}
			}
			duchy = {
				save_event_target_as = border_adjustment_duchy
			}
		}
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make offer
				modifier = {
					factor = 0
					primary_title = {
						title = e_mongol_empire
					}
				}
				modifier = {
					factor = 0
					any_owned_bloodline = {
						has_bloodline_flag = genghis_khan_line
					}
					e_china = {
						holder_scope = {
							NOT = {
								any_owned_bloodline = {
									has_bloodline_flag = genghis_khan_line
								}
							}
						}
					}
				}
				modifier = {
					factor = 0
					capital_scope = {
						OR = {
							region = world_china
							de_jure_liege_or_above = e_china
						}
					}
				}
				modifier = {
					factor = 0
					tier = emperor
				}
				modifier = {
					factor = 0
					tier = king
					event_target:border_adjustment_duchy = {
						de_jure_liege_or_above = ROOT
					}
				}
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 0
					root_hates_china_trigger = yes # Dislikes the EoC enough to not want to send anything
				}
				modifier = {
					factor = 0.1
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = brave
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 0.1
					trait = craven
				}
				modifier = {
					factor = 10
					trait = content
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_border_adjustment_tribute_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_border_adjustment_tribute_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6159 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6160 } # EoC gets offer
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6158
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_border_adjustment_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_border_adjustment_tribute_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6159 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6160 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6159
	desc = {
		text = EVTDESCA_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6159
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6159 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6159 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6159 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6160 } # EoC informed of the offer and the GC's position
		}
	}
}

# EoC gets the offer (and possible recommendation)
narrative_event = {
	id = soh.6160
	is_triggered_only = yes
	title = EVTTITLE_SOH_6160
	desc = {
		text = EVTDESCA_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6160
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6160 # Accept the offer
		
		event_target:border_adjustment_duchy = {
			any_direct_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = {
							character = event_target:grace_decision_taker
						}
					}
				}
				if = {
					limit = {
						holder_scope = {
							NOR = {
								any_demesne_title = {
									NOR = {
										de_jure_liege_or_above = event_target:border_adjustment_duchy
										title = event_target:border_adjustment_duchy
									}
								}
								any_vassal = {
									any_demesne_title = {
										NOR = {
											de_jure_liege_or_above = event_target:border_adjustment_duchy
											title = event_target:border_adjustment_duchy
										}
									}
								}
							}
						}
					}
					holder_scope = {
						set_defacto_liege = ROOT
					}
				}
				else = {
					ROOT = {
						grant_title_no_opinion = PREV
					}
				}
			}
			if = {
				limit = {
					has_holder = yes
					holder_scope = {
						top_liege = {
							character = event_target:grace_decision_taker
						}
					}
				}
				ROOT = {
					grant_title_no_opinion = PREV
				}
			}
		}
		
		set_truce = {
			who = event_target:grace_decision_taker
			years = 10
		}
		event_target:grace_decision_taker = {
			set_truce = {
				who = ROOT
				years = 10
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6161 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6160 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6162 } # Inform sender
		}
	}
}

# Offer accepted
letter_event = {
	id = soh.6161
	desc = EVTDESC_SOH_6161
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6161 # Great!
		
		set_character_flag = grace_character
	}
}

# Offer refused
letter_event = {
	id = soh.6162
	desc = EVTDESC_SOH_6162
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6162 # Really?
	}
}