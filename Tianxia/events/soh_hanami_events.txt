# Hanami events

# by Silverswee(e)per

namespace = soh

# Event IDs 3901-4200 reserved

##### Preparations and invitation

### General preparations

# I have started preparing for the hanami - which kind of hanami?
character_event = {
	id = soh.3901
	desc = EVTDESC_SOH_3901
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = daytime_hanami
		clr_character_flag = nighttime_hanami
		clr_character_flag = hanami_decorate_capital_event
		clr_character_flag = hanami_capital_decorated
		clr_character_flag = hanami_capital_extremely_decorated
		clr_character_flag = hanami_plain_capital
		clr_character_flag = hanami_offerings_event
		clr_character_flag = hanami_small_offering
		clr_character_flag = hanami_great_offering
		clr_character_flag = hanami_dw_self_sabotage
		clr_character_flag = hanami_dw_sabotage_attempted
		clr_character_flag = hanami_no_offering
		clr_character_flag = hanami_improve_garden_event
		clr_character_flag = hanami_garden_improvement_self
		clr_character_flag = hanami_garden_improvement
		clr_character_flag = hanami_garden_improvement_self_gardener
		clr_character_flag = hanami_weeds
		clr_character_flag = hanami_shirabyoshi_event
		clr_character_flag = hanami_shirabyoshi
		clr_character_flag = hanami_no_entertainers
		clr_character_flag = lavishly_food
		clr_character_flag = medium_food
		clr_character_flag = low_food
		clr_character_flag = sent_invitations
		clr_character_flag = shirabyoshi_noshow
		clr_character_flag = bad_shirabyoshi
		clr_character_flag = inspiring_shirabyoshi
		clr_character_flag = troublesome_shirabyoshi
		clr_character_flag = remarkable_shirabyoshi
		clr_character_flag = banished_shirabyoshi
		clr_character_flag = shirabyoshi_killed
		clr_character_flag = hanami_duel_challengee_won
		clr_character_flag = hanami_duel_draw
		clr_character_flag = hanami_duel_challenger_won
		clr_character_flag = hanami_in_progress
		clr_character_flag = hanami_good_weather
		clr_character_flag = hanami_shirabyoshi_duel_hold_back
		clr_character_flag = hanami_shirabyoshi_duel_fair_fight
		clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
		clr_character_flag = hanami_brave
		clr_character_flag = hanami_not_craven
		clr_character_flag = hanami_prestige
		clr_character_flag = hanami_wounded
		clr_character_flag = hanami_duelist
		
		any_vassal = {
			limit = {
				has_character_flag = guest_hanami_started
			}
			
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
		}
		
		any_courtier = {
			clr_character_flag = coming_to_hanami
			clr_character_flag = guest_hanami_started
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = shirabyoshi_dueller
		}
	}
	
	option = {
		name = EVTOPTA_SOH_3901 # Let the preparations begin!
		
		character_event = { id = soh.3902 days = 1 } # Pick day or night celebration
	}
}

# Day or night hanami?
character_event = {
	id = soh.3902
	desc = EVTDESC_SOH_3902
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_3902 # Day
		
		set_character_flag = daytime_hanami
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3902 # Night (yozakura)
		
		set_character_flag = nighttime_hanami
		
		ai_chance = {
			factor = 25
		}
	}
	
	after = {
		hidden_tooltip = {
			random_list = {
				25 = {
					trigger = {
						is_adult = yes
					}
					
					character_event = { id = soh.3903 days = 5 } # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				
				25 = {
					character_event = { id = soh.3904 days = 5 } # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				
				25 = {
					character_event = { id = soh.3905 days = 5 } # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				
				25 = {
					character_event = { id = soh.3907 days = 5 } # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
			}
			
			random_list = {
				25 = {
					trigger = {
						is_adult = yes
						NOT = {
							has_character_flag = hanami_shirabyoshi_event
						}
					}
					
					character_event = { id = soh.3903 days = 10 } # Hire Shirabyoshi?
					set_character_flag = hanami_shirabyoshi_event
				}
				
				25 = {
					trigger = {
						NOT = {
							has_character_flag = hanami_decorate_capital_event
						}
					}
					
					character_event = { id = soh.3904 days = 10 } # Decorate capital?
					set_character_flag = hanami_decorate_capital_event
				}
				
				25 = {
					trigger = {
						NOT = {
							has_character_flag = hanami_offerings_event
						}
					}
					
					character_event = { id = soh.3905 days = 10 } # Send offerings to shrines? - DW side event!
					set_character_flag = hanami_offerings_event
				}
				
				25 = {
					trigger = {
						NOT = {
							has_character_flag = hanami_improve_garden_event
						}
					}
					
					character_event = { id = soh.3907 days = 10 } # Improve the garden?
					set_character_flag = hanami_improve_garden_event
				}
				
				100 = {} # No random event
			}
		}
		
		character_event = { id = soh.3908 days = 15 } # Food preparations
		
		character_event = {	id = soh.3909 days = 20 } # Invite people
	}
}

# Hire shirabyoshi?
character_event = {
	id = soh.3903
	desc = EVTDESC_SOH_3903
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			wealth >= 25
		}
		
		name = EVTOPTA_SOH_3903 # Hire shirabyoshi
		
		set_character_flag = hanami_shirabyoshi
		
		wealth = -25
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 0.01
				trait = greedy
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 2
				trait = lustful
				OR = {
					AND = {
						is_female = no
						NOT = {
							trait = homosexual
						}
					}
					AND = {
						is_female = yes
						trait = homosexual
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3903 # Let's not
		
		set_character_flag = hanami_no_entertainers
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					NOT = {
						trait = greedy
					}
					wealth >= 25
				}
			}
		}
	}
}

# Decorate the capital?
character_event = {
	id = soh.3904
	desc = EVTDESC_SOH_3904
	picture = GFX_evt_market
	border = GFX_event_normal_frame_diplomacy
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth >= 10
		}
		
		name = EVTOPTA_SOH_3904 # Decorate the capital
		
		set_character_flag = hanami_capital_decorated
		
		wealth = -10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			wealth = 50
		}
		
		name = EVTOPTB_SOH_3904 # Decorate the capital extensively!
		
		set_character_flag = hanami_capital_extremely_decorated
		
		wealth = -50
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 8 }
					}
				}
			}
		}
		
		capital_scope = {
			add_province_modifier = {
				modifier = hanami_decorations
				months = 12
			}
		}
		
		ai_chance = {
			factor = 10
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3904 # Nah
		
		set_character_flag = hanami_plain_capital
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					NOT = {
						trait = greedy
					}
					wealth >= 25
				}
			}
		}
	}
}

# Send offerings to shrines?
character_event = {
	id = soh.3905
	desc = EVTDESC_SOH_3905
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_diplomacy
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			wealth >= 10
		}
		
		name = EVTOPTA_SOH_3905 # Make a small offering
		
		set_character_flag = hanami_small_offering
		
		wealth = -10
		
		piety = 5
		
		hidden_tooltip = {
			random = {
				chance = 25
				
				any_realm_character = {
					limit = {
						society_member_of = the_desecrators
						NOR = {
							character = ROOT
							distance = {
								who = ROOT
								distance = 250
							}
							trait = craven
						}
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							trait = craven
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = hanami_dw_sabotager
					
					character_event = { id = soh.3906 } # Sabotage the offerings?
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					society_member_of = the_desecrators
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
			}
		}
	}
	
	option = {
		trigger = {
			wealth = 25
		}
		
		name = EVTOPTB_SOH_3905 # Make a great offering
		
		set_character_flag = hanami_great_offering
		
		random = {
			chance = 25
			add_trait_partially_zealous_effect = yes
		}
		
		random = {
			chance = 25
			add_trait_partially_charitable_effect = yes
		}
		
		wealth = -25
		
		piety = 10
		
		hidden_tooltip = {
			random = {
				chance = 25
				
				any_realm_character = {
					limit = {
						society_member_of = the_desecrators
						NOR = {
							character = ROOT
							distance = {
								who = ROOT
								distance = 250
							}
							trait = craven
						}
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							trait = craven
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = hanami_dw_sabotager
					
					character_event = { id = soh.3906 } # Sabotage the offerings?
				}
			}
		}
		
		ai_chance = {
			factor = 10
			
			trigger = {
				NOR = {
					society_member_of = the_desecrators
					trait = greedy
					trait = cynical
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
			
			mult_modifier = {
				factor = 100
				trait = zealous
			}
		}
	}
	
	option = {
		trigger = {
			society_member_of = the_desecrators
			wealth >= 10
		}
		
		name = EVTOPTC_SOH_3905 # Oh, I know just what to send...
		
		wealth = -10
		
		set_character_flag = hanami_dw_self_sabotage
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_3905 # Nah
		
		set_character_flag = hanami_no_offering
		
		random = {
			chance = 25
			add_trait_partially_cynical_effect = yes
		}
		
		random = {
			chance = 25
			add_trait_partially_greedy_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					NOR = {
						trait = greedy
						trait = cynical
					}
					wealth >= 10
				}
			}
			
			mult_modifier = {
				factor = 0.01
				society_member_of = the_desecrators
				OR = {
					trait = brave
					trait = ambitious
				}
			}
		}
	}
}

# DW - try to sabotage offerings?
character_event = {
	id = soh.3906
	desc = EVTDESC_SOH_3906
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3906 # Attempt to sabotage the offerings
		detract_society_currency_trivial_effect = yes
		
		FROM = {
			set_character_flag = hanami_dw_sabotage_attempted
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3906 # Attempt to sabotage the offerings
		
		ai_chance = {
			factor = 25
		}
	}
}

# Improve the garden?
character_event = {
	id = soh.3907
	desc = EVTDESC_SOH_3907
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = gardener
			}
			wealth >= 10
		}
		
		name = EVTOPTA_SOH_3907 # Deal with it yourself
		
		set_character_flag = hanami_garden_improvement_self
		
		wealth = -10
		
		random = {
			chance = 25
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 0.01
				trait = slothful
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = gardener
				}
				trait = slothful
			}
			wealth >= 25
		}
		
		name = EVTOPTB_SOH_3907 # Hire someone to deal with it for you
		
		set_character_flag = hanami_garden_improvement
		
		wealth = -25
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
		}
	}
	
	option = {
		trigger = {
			trait = gardener
		}
		
		name = EVTOPTC_SOH_3907 # Deal with it yourself
		
		set_character_flag = hanami_garden_improvement_self_gardener
		
		prestige = 25
		
		random = {
			chance = 25
			add_trait_partially_diligent_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = slothful
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_3907 # Nah
		
		set_character_flag = hanami_weeds
		
		random = {
			chance = 25
			add_trait_partially_slothful_effect = yes
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					NOR = {
						trait = greedy
						trait = slothful
					}
					wealth >= 10
				}
			}
		}
	}
}

# Food preparations - vanilla code
character_event = {
	id = soh.3908
	desc = EVTDESC_SOH_3908
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
		NOR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
	}

	immediate = {
		if = {
			limit = {
				any_artifact = {
					has_artifact_flag = cooking
					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}
			}

			random_artifact = {
				limit = {
					has_artifact_flag = cooking

					OR = {
						is_artifact_equipped = yes

						# If ROOT already cannibal, someone else should be around to become cannical...
						trigger_if = {
							limit = {
								artifact_type = the_omnivore
								ROOT = { trait = cannibal }
							}

							ROOT = {
								any_courtier = {
									is_adult = yes
									NOT = { trait = cannibal }
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}

					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}

				preferred_limit = {
					quality >= 3
				}

				preferred_limit = {
					quality >= 2
				}

				preferred_limit = {
					quality >= 1
				}

				save_event_target_as = book_target
			}

			if = { # If ROOT is already a cannibal...
				limit = {
					trait = cannibal

					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				random_courtier = {
					limit = {
						NOT = { trait = cannibal }
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
						is_evil_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
					}

					preferred_limit = {
						family_of_root_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
					}

					save_event_target_as = potential_cannibal
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTD72003 # Why don't we use this as inspiration?
			trigger = {
				event_target:book_target = { quality > 1 }
			}
		}
		name = {
			text = EVTOPTD72003_cheap # Let's make use of this little thing
			trigger = {
				event_target:book_target = { quality < 2 }
			}
		}

		tooltip_info_custom = available_because_books_tt

		trigger = {
			event_target:book_target = { always = yes }
		}

		if = {
			limit = {
				event_target:book_target = {
					quality < 2
				}
			}

			set_character_flag = low_food
			prestige = -5
		}
		else_if = {
			limit = {
				event_target:book_target = {
					quality == 2
				}
			}

			if = {
				limit = {
					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				if = {
					limit = { trait = cannibal }

					custom_tooltip = { text = EVTOPTD72003_buddy_cannibal_tt }

					event_target:potential_cannibal = {
						show_scope_change = no

						add_trait = cannibal
					}
				}
				else = {
					custom_tooltip = { text = EVTOPTD72003_cannibal_tt }
					add_trait = cannibal
				}

				set_character_flag = lavishly_food
				wealth = -10
				prestige = 20
			}
			else = {
				set_character_flag = medium_food
				wealth = -5
				prestige = 5
			}
		}
		else = { # Means it's quality 3/higher
			set_character_flag = lavishly_food
			wealth = -10
			prestige = 20
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTA72003 # Spend lavishly on food

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		set_character_flag = lavishly_food
		wealth = -20
		prestige = 10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				trait = greedy
			}

			mult_modifier = {
				factor = 3
				trait = gluttonous
			}

			mult_modifier = {
				factor = 0.1
				trait = temperate
			}

			mult_modifier = {
				factor = 2
				higher_real_tier_than = DUKE
			}
		}
	}

	option = {
		name = EVTOPTB72003 # Spend medium on food

		set_character_flag = medium_food
		wealth = -10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTC72003 # Spend low on food

		trigger = {
			NOT = { trait = gluttonous }
		}

		set_character_flag = low_food
		wealth = -5
		prestige = -5

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 2.5
				trait = greedy
			}

			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}

			mult_modifier = {
				factor = 2
				real_tier = COUNT
			}
		}
	}
}

### Invitations (based on vanilla logic)

# Time to send out invitations
character_event = {
	id = soh.3909
	desc = EVTDESC_SOH_3909
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	war = no

	trigger = {
		has_character_modifier = hanami_in_progress
		OR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
		NOT = {
			has_character_flag = sent_invitations
		}
	}
	
	option = {
		name = "EVTOPTA72010"
		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000

			set_character_flag = sent_invitations
			
			narrative_event = { id = soh.3912 days = 10 } # Start of the Hanami

			any_vassal = {
				limit = {
					war = no
					block_general_event_trigger = no
					NOT = { has_character_modifier = chuseok_in_progress }
					NOR = {
						trait = treasure_fleet_preparation
						trait = in_mourning
					}
				}
				
				letter_event = {
					id = soh.3910
					days = 2
					#tooltip = "EVTTOOLTIP72011"
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = soh.3910
	desc = EVTDESC_SOH_3910

	is_triggered_only = yes

	trigger = { NOT = { is_inaccessible_trigger = yes } }

	option = {
		name = EVTOPTA_SOH_3910 # Travel to the hanami
		
		set_character_flag = coming_to_hanami
		
		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -40
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -20
				}
			}
		}
	}
	option = {
		name = EVTOPTB_SOH_3910 # Refuse

		FROM = {
			show_scope_change = no

			letter_event = {
				id = soh.3911
				days = 1
				random = 2
				tooltip = EVTTOOLTIP72012
			}

			opinion = {
				name = opinion_dislike
				who = ROOT
				years = 10
			}
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -60
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -80
				}
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = soh.3911
	desc = EVTDESC_SOH_3911

	is_triggered_only = yes

	option = {
		name = "EVTOPTA72012"
		
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}



##### Arrival events

# Guests arrive
narrative_event = {
	id = soh.3912
	title = EVTTITLE_SOH_3912
	border = GFX_event_narrative_frame_diplomacy

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hanami_in_progress
		has_character_flag = sent_invitations
		
		NOT = {
			has_character_flag = host_hanami_started
		}
		
		any_vassal = {
			NOT = {
				has_character_flag = guest_hanami_started
			}
			has_character_flag = coming_to_hanami
		}
	}
	
	desc = {
		trigger = {
			has_character_flag = daytime_hanami
		}
		text = EVTDESCA_SOH_3912
		picture = GFX_evt_garden
	}
	
	desc = {
		trigger = {
			has_character_flag = nighttime_hanami
		}
		text = EVTDESCB_SOH_3912
		picture = GFX_evt_shadowy_cabal
	}
	
	option = {
		name = EVTOPTA_SOH_3912 # Welcome the guests
		
		set_character_flag = host_hanami_started
			
		# Event selection
		character_event = { id = soh.3914 days = 2 }
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			set_character_flag = guest_hanami_started
			
			if = {
				limit = {
					ai = no # No need to spam the AI
					has_character_flag = coming_to_hanami
				}
				narrative_event = { id = soh.3913 } # Guests notified
			}
		}
	}
}

# Guest welcomed
narrative_event = {
	id = soh.3913
	title = EVTTITLE_SOH_3913
	border = GFX_event_narrative_frame_diplomacy
	
	only_rulers = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	desc = {
		trigger = {
			FROM = {
				has_character_flag = daytime_hanami
			}
		}
		text = EVTDESCA_SOH_3913
		picture = GFX_evt_garden
	}
	
	desc = {
		trigger = {
			FROM = {
				has_character_flag = nighttime_hanami
			}
		}
		text = EVTDESCB_SOH_3913
		picture = GFX_evt_shadowy_cabal
	}
	
	option = {
		name = EVTOPTA_SOH_3913 # This should be fun!
	}
}



##### Event group 1

# Event selection
character_event = {
	id = soh.3914
	hide_window = yes
	
	is_triggered_only = yes

	prisoner = no
	war = no

	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	immediate = {
		# Select random events
		hidden_tooltip = {		
			# Decorations (or lack thereof)
			if = {
				limit = {
					has_character_flag = hanami_decorate_capital_event
				}
				
				random_list = {
					40 = {
						trigger = {
							NOT = {
								has_character_flag = hanami_plain_capital
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_capital_extremely_decorated
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3915 days = 3 random = 3 } # Capital decorations impresses guest
						}
					}
					
					40 = {
						trigger = {
							NOT = {
								has_character_flag = hanami_capital_extremely_decorated
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_plain_capital
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3917 days = 3 random = 3 } # Lack of decorations upsets guest
						}
					}
					
					20 = {}
				}
			}
			
			# Offerings sent to shrine (or not)
			if = {
				limit = {
					has_character_flag = hanami_offerings_event
				}
				
				random_list = {
					25 = {
						trigger = {
							NOR = {
								has_character_flag = hanami_no_offering
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
							any_vassal = {
								has_character_flag = coming_to_hanami
								OR = {
									has_japanese_religion_trigger = yes
									AND = {
										religion = buddhist
										culture_group = japonic
									}
								}
								NOT = {
									trait = cynical
								}
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_great_offering
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								OR = {
									has_japanese_religion_trigger = yes
									AND = {
										religion = buddhist
										culture_group = japonic
									}
								}
								NOT = {
									trait = cynical
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3919 days = 3 random = 3 } # Vassal impressed by offering
						}
					}
					
					25 = {
						trigger = {
							NOR = {
								has_character_flag = hanami_great_offering
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_no_offering
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								OR = {
									has_japanese_religion_trigger = yes
									AND = {
										religion = buddhist
										culture_group = japonic
									}
								}
								NOT = {
									trait = cynical
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3921 days = 3 random = 3 } # Vassal upset over lack of offering
						}
					}
					
					25 = {
						trigger = {
							OR = {
								has_character_flag = hanami_dw_self_sabotage
								has_character_flag = hanami_dw_sabotage_attempted
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_dw_self_sabotage
						}
						
						if = {
							limit = {
								has_character_flag = hanami_dw_self_sabotage
							}
							
							character_event = { id = soh.3923 days = 3 random = 3 } # Determine how the sabotage went
						}
						
						if = {
							limit = {
								NOT = {
									has_character_flag = hanami_dw_self_sabotage
								}
							}
							
							event_target:hanami_dw_sabotager = {
								character_event = { id = soh.3927 days = 3 random = 3 } # Determine how the sabotage went
							}
						}
					}
					
					25 = {}
				}
			}
			
			# Garden improved (or not)
			if = {
				limit = {
					has_character_flag = hanami_improve_garden_event
				}
				
				random_list = {
					40 = {
						trigger = {
							NOT = {
								has_character_flag = hanami_weeds
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_garden_improvement_self_gardener
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3932 days = 3 random = 3 } # Garden improvement impresses guest
						}
					}
					
					40 = {
						trigger = {
							NOT = {
								has_character_flag = hanami_garden_improvement_self_gardener
							}
						}
						
						mult_modifier = {
							factor = 5
							has_character_flag = hanami_weeds
						}
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3934 days = 3 random = 3 } # Bad garden improvement upsets guest
						}
					}
					
					10 = {}
				}
			}
			
			# Shirabyoshi
			if = {
				limit = {
					has_character_flag = hanami_shirabyoshi_event
				}
				
				if = {
					limit = {
						has_character_flag = hanami_no_entertainers
					}
					
					random = {
						chance = 75
						
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.3936 days = 6 random = 3 } # Guest complains about lack of entertainment
						}
					}
				}
				
				if = {
					limit = {
						has_character_flag = hanami_shirabyoshi
					}
					
					random_list = {
						10 = {
							character_event = { id = soh.3938 days = 6 random = 3 } # Shirabyoshi do not show up
						}
						
						30 = {
							character_event = { id = soh.3940 days = 6 random = 3 } # Shirabyoshi perform poorly
						}
						
						30 = {
							trigger = {
								any_dynasty_member = {
									is_female = yes
									age >= 6
									age < 16
									NOR = {
										trait = shy
										trait = brooding
									}
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
									host = {
										character = ROOT
									}
									NOT = {
										has_character_flag = inspired_by_shirabyoshi
									}
								}
							}
							
							set_character_flag = inspiring_shirabyoshi
							
							any_dynasty_member = {
								limit = {
									is_female = yes 
									age >= 6
									age < 16
									NOR = {
										trait = shy
										trait = brooding
									}
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
									host = {
										character = ROOT
									}
								}
								score_value = { #Prioritizes selecting an interesting courtier...
									value = 10
									interesting_courtier_selection_score = yes
								}
								
								character_event = { id = soh.3942 days = 6 random = 3 } # Shirabyoshi inspire your kinswoman
							}
						}
						
						10 = {
							trigger = {
								any_vassal = {
									is_adult = yes
									has_character_flag = coming_to_hanami
									OR = {
										is_female = no
										has_education_martial_trigger = yes
										has_lifestyle_martial_trigger = yes
										society_member_of = warriors_of_the_rising_sun
										ROOT = {
											primary_title = {
												OR = {
													has_law = status_of_women_3
													has_law = status_of_women_4
												}
											}
										}
										gender_equality_trigger = yes
									}
								}
							}
							
							set_character_flag = troublesome_shirabyoshi
							
							any_vassal = {
								limit = {
									is_adult = yes
									has_character_flag = coming_to_hanami
									is_ill = no
									has_symptom_trigger = no
									is_maimed_trigger = no
									OR = {
										is_female = no
										has_education_martial_trigger = yes
										has_lifestyle_martial_trigger = yes
										society_member_of = warriors_of_the_rising_sun
										ROOT = {
											primary_title = {
												OR = {
													has_law = status_of_women_3
													has_law = status_of_women_4
												}
											}
										}
										gender_equality_trigger = yes
									}
								}
								score_value = { #Prioritizes selecting an interesting courtier...
									value = 10
									interesting_courtier_selection_score = yes
								}
								
								set_character_flag = shirabyoshi_dueller
								
								character_event = { id = soh.3944 days = 6 random = 3 } # Vassal gets option to duel shirabyoshi
							}
						}
						
						10 = {
							set_character_flag = remarkable_shirabyoshi
							
							character_event = { id = soh.3972 days = 6 random = 3 } # Remarkable shirabyoshi
						}
						
						10 = {}
					}
				}
			}
			
			character_event = { id = soh.3974 days = 10 } # Second group of events
		}
	}
}

### Decorations

# Vassal impressed
character_event = {
	id = soh.3915
	desc = EVTDESC_SOH_3915
	picture = GFX_evt_market

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3915 # I like it!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3916 } # Inform liege
		}
	}
}

# Decorations impress vassal
character_event = {
	id = soh.3916
	desc = EVTDESC_SOH_3916
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3916 # Good to hear!
		
		prestige = 25
	}
}

# Lack of decorations upset vassal
character_event = {
	id = soh.3917
	desc = EVTDESC_SOH_3917
	picture = GFX_evt_market

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3917 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3918 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = soh.3918
	desc = EVTDESC_SOH_3918
	picture = GFX_evt_market

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3918 # Unfortunate
		
		prestige = -25
	}
}

### Offerings sent to shrines

# Vassal informed of offerings
character_event = {
	id = soh.3919
	desc = EVTDESC_SOH_3919
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				true_japanese_religion_trigger = yes
				true_religion = buddhist
			}
			NOT = {
				trait = cynical
			}
		}
		
		name = EVTOPTA_SOH_3919 # Most impressive!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3920 } # Inform liege
		}
	}
	
	option = {
		trigger = {
			OR = {
				NOR = {
					true_japanese_religion_trigger = yes
					true_religion = buddhist
				}
				trait = cynical
			}
		}
		
		name = EVTOPTB_SOH_3919 # Let's pretend we're impressed!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3920 } # Inform liege
		}
	}
}

# Offerings impress vassal
character_event = {
	id = soh.3920
	desc = EVTDESC_SOH_3920
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3920 # Good to hear!
		
		piety = 25
	}
}

# Small/no offerings upset vassal
character_event = {
	id = soh.3921
	desc = EVTDESC_SOH_3921
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				true_japanese_religion_trigger = yes
				true_religion = buddhist
			}
			NOT = {
				trait = cynical
			}
		}
		
		name = EVTOPTA_SOH_3921 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3922 } # Inform liege
		}
	}
	
	option = {
		trigger = {
			NOR = {
				true_japanese_religion_trigger = yes
				true_religion = buddhist
			}
			NOT = {
				trait = cynical
			}
		}
		
		name = EVTOPTB_SOH_3921 # Pretend to be outraged
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3922 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = soh.3922
	desc = EVTDESC_SOH_3922
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3922 # Unfortunate
		
		piety = -25
	}
}

# DW offering self-sabotage - check outcome
character_event = {
	id = soh.3923
	hide_window = yes
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
		society_member_of = the_desecrators
	}
	
	immediate = {
		random_list = {
			33 = {
				mult_modifier = {
					factor = 2
					intrigue >= 28
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 24
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 20
				}
				
				character_event = { id = soh.3924 } # Sabotage went well
			}
			
			34 = {
				character_event = { id = soh.3925 } # Sabotage discovered, but not who did it
			}
			
			33 = {
				mult_modifier = {
					factor = 2
					intrigue < 12
				}
				
				mult_modifier = {
					factor = 2
					intrigue < 8
				}
				
				mult_modifier = {
					factor = 2
					intrigue < 4
				}
				
				character_event = { id = soh.3926 } # Sabotage discovered, suspicion increased
			}
		}
	}
}

# Sabotage went well - not discovered
character_event = {
	id = soh.3924
	desc = EVTDESC_SOH_3924
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3924 # Just as planned!
		
		add_society_currency_minor_effect = yes
		
		religion_authority = {
			modifier = temple_desecrated
			years = 30
		}
	}
}

# Sabotage discovered, but your involvement wasn't discovered
character_event = {
	id = soh.3925
	desc = EVTDESC_SOH_3925
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3925 # Try to act surprised
		detract_society_currency_tiny_effect = yes
		
		piety = -5
	}
}

# Sabotage discovered - increase suspicion
character_event = {
	id = soh.3926
	desc = EVTDESC_SOH_3926
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3926 # Oh no!
		
		detract_society_currency_minor_effect = yes
		increase_visibility_effect = yes
		
		piety = -25
	}
}

# Vassal attempts sabotage - check outcome
character_event = {
	id = soh.3927
	hide_window = yes
	is_triggered_only = yes

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
		society_member_of = the_desecrators
	}
	
	immediate = {
		random_list = {
			33 = {
				mult_modifier = {
					factor = 2
					intrigue >= 28
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 24
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 20
				}
				
				character_event = { id = soh.3928 } # Sabotage went well
			}
			
			34 = {
				character_event = { id = soh.3929 } # Sabotage discovered, but not who did it
				
				FROM = {
					character_event = { id = soh.3930 } # Sabotage discovered
				}
			}
			
			33 = {
				mult_modifier = {
					factor = 2
					intrigue < 12
				}
				
				mult_modifier = {
					factor = 2
					intrigue < 8
				}
				
				mult_modifier = {
					factor = 2
					intrigue < 4
				}
				
				character_event = { id = soh.3931 } # Sabotage discovered, suspicion increased
				
				FROM = {
					character_event = { id = soh.3930 } # Sabotage discovered
				}
			}
		}
	}
}

# Sabotage went well - inform vassal
character_event = {
	id = soh.3928
	desc = EVTDESC_SOH_3928
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3928 # Just as planned!
		add_society_currency_minor_effect = yes
		
		religion_authority = {
			modifier = temple_desecrated
			years = 30
		}
	}
}

# Sabotage discovered, but not your involvement - inform vassal
character_event = {
	id = soh.3929
	desc = EVTDESC_SOH_3929
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3929 # Try to act surprised
		detract_society_currency_tiny_effect = yes
	}
}

# Sabotage discovered - inform liege (both versions)
character_event = {
	id = soh.3930
	desc = EVTDESC_SOH_3930
	picture = GFX_evt_tribal_shrine

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3930 # Who could have done this?
		
		piety = -5
	}
}

# Sabotage discovered, increase suspicion - inform vassal
character_event = {
	id = soh.3931
	desc = EVTDESC_SOH_3931
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3931 # Oh no!
		
		detract_society_currency_minor_effect = yes
		increase_visibility_effect = yes
		
		piety = -25
	}
}

### Garden improvements

# Vassal impressed
character_event = {
	id = soh.3932
	desc = EVTDESC_SOH_3932
	picture = GFX_evt_garden

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3932 # I like it!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3933 } # Inform liege
		}
	}
}

# Garden impresses vassal
character_event = {
	id = soh.3933
	desc = EVTDESC_SOH_3933
	picture = GFX_evt_garden

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3933 # Good to hear!
		
		prestige = 25
	}
}

# Weeds in garden upset vassal
character_event = {
	id = soh.3934
	desc = EVTDESC_SOH_3934
	picture = GFX_evt_garden

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3934 # I don't like it!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3935 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = soh.3935
	desc = EVTDESC_SOH_3935
	picture = GFX_evt_garden

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3935 # Unfortunate
		
		prestige = -25
	}
}

### Shirabyoshi

# Lack of Shirabyoshi upsets vassal
character_event = {
	id = soh.3936
	desc = EVTDESC_SOH_3936
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3936 # This is boring!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		FROM = {
			character_event = { id = soh.3937 } # Inform liege
		}
	}
}

# Vassal upset
character_event = {
	id = soh.3937
	desc = EVTDESC_SOH_3937
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3937 # Unfortunate
		
		prestige = -25
	}
}

# Shirabyoshi don't show up - liege
character_event = {
	id = soh.3938
	desc = EVTDESC_SOH_3938
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3938 # I want my money back!
		
		prestige = -50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = FROM
				modifier = bad_hanami
				months = 12
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.3939 } # Inform vassals
			}
		}
	}
}

# Shirabyoshi don't show up - vassal
character_event = {
	id = soh.3939
	desc = EVTDESC_SOH_3939
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3939 # Surely FROM is just lying!
	}
}

# Shirabyoshi perform poorly - liege
character_event = {
	id = soh.3940
	desc = EVTDESC_SOH_3940
	picture = GFX_evt_scandal

	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3940 # Not what I paid for!
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no # The AI shouldn't get events that have no effect...
				has_character_flag = coming_to_hanami
			}
			
			character_event = { id = soh.3941 } # Inform vassals
		}
	}
}

# Shirabyoshi perform poorly - vassal
character_event = {
	id = soh.3941
	desc = EVTDESC_SOH_3941
	picture = GFX_evt_scandal

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3941 # Please make them stop!
	}
}

# Kinswoman is inspired
character_event = {
	id = soh.3942
	desc = EVTDESC_SOH_3942
	picture = GFX_evt_melee # Best option

	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	immediate = {
		set_character_flag = inspired_by_shirabyoshi
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3942 # Teach me how to use a sword!
		
		change_martial = 1
		
		FROM = {
			character_event = { id = soh.3943 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3942 # Teach me how to conduct business!
		
		change_stewardship = 1
		
		FROM = {
			character_event = { id = soh.3943 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3942 # Teach me how to write poetry!
		
		change_learning = 1
		
		FROM = {
			character_event = { id = soh.3943 } # Inform FROM
		}
	}
	
	option = {
		name = EVTOPTD_SOH_3942 # Teach me how to convince people!
		
		random_list = {
			50 = {
				change_diplomacy = 1
			}
			50 = {
				change_intrigue = 1
			}
		}
		
		FROM = {
			character_event = { id = soh.3943 } # Inform FROM
		}
	}
}

# Liege is informed
character_event = {
	id = soh.3943
	desc = EVTDESC_SOH_3943
	picture = GFX_evt_emissary

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3943 # Sounds good!
		
		prestige = 10
	}
}

# Shirabyoshi suggests duel - vassal/courtier
character_event = {
	id = soh.3944
	desc = EVTDESC_SOH_3944
	picture = GFX_evt_quarrel

	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	immediate = {
		FROM = {
			create_character = {
				age = 25
				culture = ROOT
				dynasty = none
				religion = shinto
				random_traits = no
				female = yes
				
				attributes = {
					diplomacy = 6
					martial = 8
					stewardship = 4
					intrigue = 2
					learning = 8
				}
			}
		}
		
		new_character = {
			add_trait = duelist
			
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			give_nickname = nick_the_shirabyoshi
			
			# Religion randomization
			random_list = {
				25 = {
					religion = buddhist
					add_trait = mahayana_buddhist
				}
				25 = {
					religion = shugendo
				}
				25 = {
					religion = koshin
				}
				25 = {}
			}
			
			# Sexuality
			random = {
				chance = 10
				add_trait = homosexual
			}
			
			# Actual combat potential
			random_list = {
				10 = {
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
			}
			
			# Education
			random_list = {
				70 = { # Martial
					random_list = {
						10 = {
							add_trait = misguided_warrior
						}
						40 = {
							add_trait = tough_soldier
						}
						40 = {
							add_trait = skilled_tactician
						}
						10 = {
							add_trait = brilliant_strategist
						}
					}
				}
				
				20 = { # Diplomacy
					random_list = {
						10 = {
							add_trait = naive_appeaser
						}
						40 = {
							add_trait = underhanded_rogue
						}
						40 = {
							add_trait = charismatic_negotiator
						}
						10 = {
							add_trait = grey_eminence
						}
					}
				}
				
				20 = { # Intrigue
					random_list = {
						10 = {
							add_trait = amateurish_plotter
						}
						40 = {
							add_trait = flamboyant_schemer
						}
						40 = {
							add_trait = intricate_webweaver
						}
						10 = {
							add_trait = elusive_shadow
						}
					}
				}
				
				5 = { # Stewardship
					random_list = {
						10 = {
							add_trait = indulgent_wastrel
						}
						40 = {
							add_trait = thrifty_clerk
						}
						40 = {
							add_trait = fortune_builder
						}
						10 = {
							add_trait = midas_touched
						}
					}
				}
				
				5 = { # Learning
					random_list = {
						10 = {
							add_trait = detached_priest
						}
						40 = {
							add_trait = dutiful_cleric
						}
						40 = {
							add_trait = scholarly_theologian
						}
						10 = {
							add_trait = mastermind_theologian
						}
					}
				}
			}
			
			# Archetypes
			random_list = {
				10 = {
					# The Seductress
					remove_trait = duelist
					
					random_list = {
						90 = {
							add_trait = master_seductress
						}
						5 = {
							add_trait = hedonist
						}
						5 = {
							add_trait = socializer
						}
					}
					
					add_trait = attractive
					add_trait = groomed
					add_trait = lustful
					random = {
						chance = 5
						add_trait = lovers_pox
					}
					add_trait = gregarious
					add_trait = deceitful
					add_trait = proud
					add_trait = arbitrary
					add_trait = cruel
				}
				
				10 = {
					# The Veteran
					add_trait = scarred
					
					random_list = {
						80 = {
							add_trait = strong
						}
						10 = {
							add_trait = brawny
						}
						10 = {
							add_trait = sturdy
						}
					}
					
					if = {
						limit = {
							has_dlc = "Reapers"
						}
						random = {
							chance = 5
							random_list = {
								25 = {
									add_trait = one_handed
								}
								25 = {
									add_trait = one_eyed
								}
								25 = {
									add_trait = disfigured
								}
								25 = {
									add_trait = mangled
								}
							}
						}
					}
					
					add_trait = uncouth
					add_trait = poet
					add_trait = humble
					add_trait = wroth
					add_trait = just
					add_trait = brave
					add_trait = honest
				}
				
				10 = {
					# The Trickster
					remove_trait = duelist
					add_trait = master_schemer
					add_trait = deceitful
					add_trait = shrewd
					add_trait = patient
					add_trait = greedy
					add_trait = cynical
					add_trait = craven
					add_trait = shy
				}
				
				10 = {
					# The Zealot
					add_trait = zealous
					add_trait = chaste
					
					random = {
						chance = 10
						add_trait = celibate
					}
					
					add_trait = diligent
					add_trait = envious
					add_trait = content
					add_trait = honest
					add_trait = trusting
				}
				
				10 = {
					# The Mad Genius
					add_trait = genius
					add_trait = lunatic
					add_trait = kind
					add_trait = ambitious
					add_trait = erudite
					add_trait = paranoid
					add_trait = stubborn
				}
			}
			if = {
				limit = {
					has_dlc = "Holy Fury"
					trait = duelist
				}
				
				random = {
					chance = 25
					join_society = warriors_of_the_rising_sun
				}
			}
			
			save_event_target_as = troublesome_shirabyoshi
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3944 # Sure, why not?
		
		pacifists_lose_piety_effect = yes
		
		FROM = {
			character_event = { id = soh.3945 }
		}
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3944 # I'd rather not...
		
		prestige = -25
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# Liege informed of pending duel
character_event = {
	id = soh.3945
	desc = EVTDESC_SOH_3945
	picture = GFX_evt_quarrel

	only_rulers = yes
	prisoner = no
	war = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3945 # Sure, why not?
		
		FROM = {
			character_event = { id = soh.3948 } # Vassal/courtier selects stance - shirabyoshi stance triggered from here
		}
		
		any_vassal = {
			limit = {
				ai = no # No need to spam AI characters with information that doesn't matter to them...
				has_character_flag = coming_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3950 }
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		trigger = {
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTB_SOH_3945 # No; get out!
		
		FROM = {
			character_event = { id = soh.3946 }
		}
		
		event_target:troublesome_shirabyoshi = {
			leave_court_and_die_effect = yes
		}
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = coming_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3947 }
		}
		
		ai_chance = {
			factor = 25
		}
	}
}

# FROM informed the duel is off
character_event = {
	id = soh.3946
	desc = EVTDESC_SOH_3946
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3946 # I could have taken her!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
	}
}

# Other vassals informed the duel is off
character_event = {
	id = soh.3947
	desc = EVTDESC_SOH_3947
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3947 # It could have been fun!
	}
}

# Vassal/courtier selects stance
character_event = {
	id = soh.3948
	desc = EVTDESC_SOH_3948
	picture = GFX_evt_melee # Best option

	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		trigger = {
			NOR = {
				trait = cruel
				trait = wroth
				trait = deceitful
				trait = arbitrary
				trait = proud
			}
		}
		
		name = EVTOPTA_SOH_3948 # Hold back
		
		set_character_flag = hanami_shirabyoshi_duel_hold_back
		
		event_target:troublesome_shirabyoshi = {
			character_event = { id = soh.3949 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3948 # Fight fairly
		
		set_character_flag = hanami_shirabyoshi_duel_fair_fight
		
		event_target:troublesome_shirabyoshi = {
			character_event = { id = soh.3949 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
		}
		
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				trait = wroth
			}
		}
		
		name = EVTOPTC_SOH_3948 # Fight to kill
		
		set_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		
		event_target:troublesome_shirabyoshi = {
			character_event = { id = soh.3949 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = kind
					trait = just
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = deceitful
				trait = arbitrary
			}
			NOR = {
				trait = humble
				trait = kind
			}
		}
		
		name = EVTOPTD_SOH_3948 # Fight dirty
		
		set_character_flag = hanami_shirabyoshi_duel_fight_dirty
		
		event_target:troublesome_shirabyoshi = {
			character_event = { id = soh.3949 } # Shirabyoshi picks stance; somewhat influenced by other party's stance
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = kind
					trait = just
				}
			}
		}
	}
}

# Shirabyoshi selects stance
character_event = {
	id = soh.3949
	desc = EVTDESC_SOH_3949
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	immediate = {
		opinion = {
			who = FROM
			modifier = hanami_duel
			months = 1
		}
		
		reverse_opinion = {
			who = FROM
			modifier = hanami_duel
			months = 1
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = cruel
				trait = wroth
				trait = deceitful
				trait = arbitrary
				trait = proud
			}
		}
		
		name = EVTOPTA_SOH_3948 # Hold back
		
		set_character_flag = hanami_shirabyoshi_duel_hold_back
		
		FROMFROM = {
			character_event = { id = soh.3951 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			
			mult_modifier = {
				factor = 0.25
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3948 # Fight fairly
		
		set_character_flag = hanami_shirabyoshi_duel_fair_fight
		
		FROMFROM = {
			character_event = { id = soh.3951 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = cruel
					trait = deceitful
				}
			}
			
			mult_modifier = {
				factor = 2
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			
			mult_modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			
			mult_modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			
			mult_modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				trait = wroth
			}
		}
		
		name = EVTOPTC_SOH_3948 # Fight to kill
		
		set_character_flag = hanami_shirabyoshi_duel_fight_to_kill
		
		FROMFROM = {
			character_event = { id = soh.3951 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = kind
					trait = just
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			
			mult_modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			
			mult_modifier = {
				factor = 10
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			
			mult_modifier = {
				factor = 2
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = deceitful
				trait = arbitrary
			}
			NOR = {
				trait = humble
				trait = kind
			}
		}
		
		name = EVTOPTD_SOH_3948 # Fight dirty
		
		set_character_flag = hanami_shirabyoshi_duel_fight_dirty
		
		FROMFROM = {
			character_event = { id = soh.3951 days = 1 } # Ping liege
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = kind
					trait = just
				}
			}
			
			mult_modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_hold_back
				}
			}
			
			mult_modifier = {
				factor = 0.5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fair_fight
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				}
			}
			
			mult_modifier = {
				factor = 5
				FROM = {
					has_character_flag = hanami_shirabyoshi_duel_fight_dirty
				}
			}
		}
	}
}

# Inform non-AI vassals
character_event = {
	id = soh.3950
	desc = EVTDESC_SOH_3950
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3950 # This should be fun
	}
}

# Hidden event for vassal/courtier to calculate the outcome
character_event = {
	id = soh.3951
	is_triggered_only = yes
	hide_window = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	immediate = {
		event_target:troublesome_shirabyoshi = { # TIANXIATODO: Maybe replace with actual duel logic
			random_list = {
				50 = {
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 10
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 20
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 30
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 40
						}
					}
					
					mult_modifier = {
						factor = 0.1
						has_character_flag = hanami_shirabyoshi_duel_hold_back
						FROM = {
							NOT = {
								has_character_flag = hanami_shirabyoshi_duel_hold_back
							}
						}
					}
					
					mult_modifier = {
						factor = 0.1
						has_character_flag = hanami_shirabyoshi_duel_hold_back
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
						}
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = hanami_shirabyoshi_duel_fight_dirty
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
					}
					
					mult_modifier = {
						factor = 10
						has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
					}
					
					character_event = { id = soh.3952 } # Victory!
					
					add_one_duel_experience_modifier = yes
					
					FROM = {
						add_one_duel_experience_modifier = yes
					}
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						has_character_flag = hanami_shirabyoshi_duel_hold_back
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
					}
					
					mult_modifier = {
						factor = 2
						has_character_flag = hanami_shirabyoshi_duel_fight_fairly
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_fight_fairly
						}
					}
					
					character_event = { id = soh.3957 } # Draw!
					
					add_one_duel_experience_modifier = yes
					
					FROM = {
						add_one_duel_experience_modifier = yes
					}
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 10
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 20
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 30
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 40
							}
						}
					}
					
					mult_modifier = {
						factor = 0.1
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
						NOT = {
							has_character_flag = hanami_shirabyoshi_duel_hold_back
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							has_character_flag = hanami_shirabyoshi_duel_fight_dirty
						}
						has_character_flag = hanami_shirabyoshi_duel_hold_back
					}
					
					add_one_duel_experience_modifier = yes
					
					FROM = {
						character_event = { id = soh.3962 } # Defeat!
						add_one_duel_experience_modifier = yes
					}
				}
			}
		}
	}
}

# Victory - what do you do?
character_event = {
	id = soh.3952
	desc = EVTDESC_SOH_3952
	picture = GFX_evt_melee # Best option
	is_triggered_only = yes
	
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3952 # Be a graceful winner
		
		set_character_flag = won_shirabyoshi_duel
		
		add_trait_partially_kind_effect = yes
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROM = {
			character_event = { id = soh.3953 } # Inform liege of mercy
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 5
				trait = kind
			}
			
			mult_modifier = {
				factor = 5
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3952 # Make fun of her!
		
		set_character_flag = won_shirabyoshi_duel
		
		FROM = {
			character_event = { id = soh.3953 } # Inform liege of mercy
		}
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 5
				trait = kind
			}
			
			mult_modifier = {
				factor = 5
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				trait = wroth
				trait = cruel
			}
		}
		
		name = EVTOPTC_SOH_3952 # Show no mercy!
		
		pacifists_lose_piety_effect = yes
		
		add_trait_partially_cruel_effect = yes
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.3955 } # Inform liege of no mercy
		}
		
		FROMFROM = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed of mercy
character_event = {
	id = soh.3953
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
		text = EVTDESCA_SOH_3953
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
		text = EVTDESCB_SOH_3953
	}
	
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3953 # Unsurprising
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3954 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.3954
	
	desc = {
		trigger = {
			FROMFROMFROMFROM = {
				has_opinion_modifier = {
					who = FROMFROM
					modifier = hanami_duel_good_sport
				}
			}
		}
		text = EVTDESCA_SOH_3954
	}
	
	desc = {
		trigger = {
			FROMFROMFROMFROM = {
				has_opinion_modifier = {
					who = FROMFROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
		text = EVTDESCB_SOH_3954
	}
	
	picture = GFX_evt_melee # Best option
	
	trigger = {
		is_actually_incapable_trigger = no
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3954 # Unsurprising
	}
}

# Vassal merciless - liege
character_event = {
	id = soh.3955
	desc = EVTDESC_SOH_3955
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3955 # That was unnecessary...
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = soh.3956 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.3956
	desc = EVTDESC_SOH_3956
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3956 # That happened...
	}
}

# Draw - vassal picks how to treat the situation
character_event = {
	id = soh.3957
	desc = EVTDESC_SOH_3957
	picture = GFX_evt_melee # Best option
	
	is_triggered_only = yes
	
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3957 # Well fought!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROM = {
			character_event = { id = soh.3958 } # Inform liege
		}
		
		prestige = -10
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 5
				trait = kind
			}
			
			mult_modifier = {
				factor = 5
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.2
				trait = cruel
			}
			
			mult_modifier = {
				factor = 5
				has_character_flag = hanami_shirabyoshi_duel_fair_fight
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_hold_back
				trait = wroth
				trait = cruel
				trait = proud
			}
		}
		
		name = EVTOPTB_SOH_3957 # I held back!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		prestige = 10 # This is bait!
		
		FROM = {
			character_event = { id = soh.3960 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed vassal/courtier was courteous
character_event = {
	id = soh.3958
	desc = EVTDESC_SOH_3958
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3958 # Was she that good?
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3959 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.3959
	desc = EVTDESC_SOH_3959
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3959 # Was she that good?
	}
}

# Liege informed vassal/courtier wasn't courteous
character_event = {
	id = soh.3960
	desc = EVTDESC_SOH_3960
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3960 # Sore loser...
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3961 } # Other vassals are informed
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.3961
	desc = EVTDESC_SOH_3961
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3961 # Sore loser...
	}
}

# Shirabyoshi won - she picks what to do
character_event = {
	id = soh.3962
	desc = EVTDESC_SOH_3962
	picture = GFX_evt_melee # Best option
	
	is_triggered_only = yes
	
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3962 # Spare the vassal/courtier!
		
		FROM = {
			character_event = { id = soh.3963 } # Ping liege
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 5
				trait = kind
			}
			
			mult_modifier = {
				factor = 5
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.2
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				trait = wroth
				trait = cruel
			}
		}
		
		name = EVTOPTB_SOH_3962 # Show no mercy!
		
		pacifists_lose_piety_effect = yes
		
		# GRACETODO
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.3969 } # Inform vassal
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Ping liege
character_event = {
	id = soh.3963
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.3964 } # Vassal informed
		}
	}
}


# Loss - vassal picks how to treat the situation
character_event = {
	id = soh.3964
	desc = EVTDESC_SOH_3964
	picture = GFX_evt_melee # Best option
	is_triggered_only = yes
	
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3964 # Well fought!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_good_sport
				months = 12
			}
		}
		
		FROM = {
			character_event = { id = soh.3965 } # Inform liege
		
			any_vassal = {
				limit = {
					ai = no # The AI doesn't care
					has_character_flag = going_to_hanami
					NOT = {
						character = ROOT
					}
				}
				character_event = { id = soh.3966 } # Other vassals are informed
			}
		}
		
		prestige = -25
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 5
				trait = kind
			}
			
			mult_modifier = {
				factor = 5
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.2
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.2
				trait = cruel
			}
			
			mult_modifier = {
				factor = 5
				has_character_flag = hanami_shirabyoshi_duel_fair_fight
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = hanami_shirabyoshi_duel_hold_back
				trait = wroth
				trait = cruel
				trait = proud
			}
		}
		
		name = EVTOPTB_SOH_3964 # I held back!
		
		FROMFROM = {
			opinion = {
				who = ROOT
				modifier = hanami_duel_bad_sport
				months = 12
			}
		}
		
		prestige = -10 # This is bait!
		
		FROM = {
			character_event = { id = soh.3967 } # Inform liege
		
			any_vassal = {
				limit = {
					ai = no # The AI doesn't care
					has_character_flag = going_to_hanami
					NOT = {
						character = ROOT
					}
				}
				
				character_event = { id = soh.3968 } # Other vassals are informed
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Liege informed vassal/courtier was courteous
character_event = {
	id = soh.3965
	desc = EVTDESC_SOH_3965
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3965 # Was she that good?
	}
}

# Other vassals informed
character_event = {
	id = soh.3966
	desc = EVTDESC_SOH_3966
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3966 # Was she that good?
	}
}

# Liege informed vassal/courtier wasn't courteous
character_event = {
	id = soh.3967
	desc = EVTDESC_SOH_3967
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3967 # Sore loser...
	}
}

# Other vassals informed
character_event = {
	id = soh.3968
	desc = EVTDESC_SOH_3968
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3968 # Sore loser...
	}
}

# Killed by shirabyoshi
character_event = {
	id = soh.3969
	desc = EVTDESC_SOH_3969
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3969 # NOOOOO!
		
		liege = {
			character_event = { id = soh.3970 }
		}
		
		death = {
			death_reason = death_duel
			killer = FROM
		}
	}
}

# Shirabyoshi merciless - liege
character_event = {
	id = soh.3970
	desc = EVTDESC_SOH_3970
	picture = GFX_evt_melee # Best option

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3970 # That was unnecessary...
		
		event_target:troublesome_shirabyoshi = {
			leave_court_effect = yes
		}
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			character_event = { id = soh.3971 } # Other vassals are informed
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					dynasty = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3970 # Imprison the shirabyoshi
		
		event_target:troublesome_shirabyoshi = {
			imprison = yes
		}
		
		any_vassal = {
			limit = {
				ai = no # The AI doesn't care
				has_character_flag = going_to_hanami
				NOT = {
					character = FROM
				}
			}
			
			character_event = { id = soh.3971 } # Other vassals are informed
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				dynasty = FROM
			}
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.3971
	desc = EVTDESC_SOH_3971
	picture = GFX_evt_melee # Best option

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3971 # That happened...
	}
}

# Remarkable shirabyoshi
character_event = {
	id = soh.3972
	desc = EVTDESC_SOH_3972
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	immediate = {
		create_character = {
			age = 25
			culture = ROOT
			dynasty = none
			religion = shinto
			random_traits = no
			female = yes
			
			attributes = {
				diplomacy = 6
				martial = 8
				stewardship = 4
				intrigue = 2
				learning = 8
			}
		}
		
		new_character = {
			add_trait = duelist
			save_event_target_as = troublesome_shirabyoshi
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			give_nickname = nick_the_shirabyoshi
			
			# Religion randomization
			random_list = {
				25 = {
					religion = buddhist
					add_trait = mahayana_buddhist
				}
				25 = {
					religion = shugendo
				}
				25 = {
					religion = koshin
				}
				25 = {}
			}
			
			# Sexuality
			random = {
				chance = 10
				add_trait = homosexual
			}
			
			# Actual combat potential
			random_list = {
				10 = {
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
				10 = {
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
					add_one_duel_experience_modifier = yes
				}
			}
			
			# Education
			random_list = {
				70 = { # Martial
					random_list = {
						10 = {
							add_trait = misguided_warrior
						}
						40 = {
							add_trait = tough_soldier
						}
						40 = {
							add_trait = skilled_tactician
						}
						10 = {
							add_trait = brilliant_strategist
						}
					}
				}
				
				20 = { # Diplomacy
					random_list = {
						10 = {
							add_trait = naive_appeaser
						}
						40 = {
							add_trait = underhanded_rogue
						}
						40 = {
							add_trait = charismatic_negotiator
						}
						10 = {
							add_trait = grey_eminence
						}
					}
				}
				
				20 = { # Intrigue
					random_list = {
						10 = {
							add_trait = amateurish_plotter
						}
						40 = {
							add_trait = flamboyant_schemer
						}
						40 = {
							add_trait = intricate_webweaver
						}
						10 = {
							add_trait = elusive_shadow
						}
					}
				}
				
				5 = { # Stewardship
					random_list = {
						10 = {
							add_trait = indulgent_wastrel
						}
						40 = {
							add_trait = thrifty_clerk
						}
						40 = {
							add_trait = fortune_builder
						}
						10 = {
							add_trait = midas_touched
						}
					}
				}
				
				5 = { # Learning
					random_list = {
						10 = {
							add_trait = detached_priest
						}
						40 = {
							add_trait = dutiful_cleric
						}
						40 = {
							add_trait = scholarly_theologian
						}
						10 = {
							add_trait = mastermind_theologian
						}
					}
				}
			}
			
			# Archetypes
			random_list = {
				10 = {
					# The Seductress
					remove_trait = duelist
					
					random_list = {
						90 = {
							add_trait = master_seductress
						}
						5 = {
							add_trait = hedonist
						}
						5 = {
							add_trait = socializer
						}
					}
					
					add_trait = attractive
					add_trait = groomed
					add_trait = lustful
					random = {
						chance = 5
						add_trait = lovers_pox
					}
					add_trait = gregarious
					add_trait = deceitful
					add_trait = proud
					add_trait = arbitrary
					add_trait = cruel
				}
				
				10 = {
					# The Veteran
					add_trait = scarred
					
					random_list = {
						80 = {
							add_trait = strong
						}
						10 = {
							add_trait = brawny
						}
						10 = {
							add_trait = sturdy
						}
					}
					
					if = {
						limit = {
							has_dlc = "Reapers"
						}
						random = {
							chance = 5
							random_list = {
								25 = {
									add_trait = one_handed
								}
								25 = {
									add_trait = one_eyed
								}
								25 = {
									add_trait = disfigured
								}
								25 = {
									add_trait = mangled
								}
							}
						}
					}
					
					add_trait = uncouth
					add_trait = poet
					add_trait = humble
					add_trait = wroth
					add_trait = just
					add_trait = brave
					add_trait = honest
				}
				
				10 = {
					# The Trickster
					remove_trait = duelist
					add_trait = master_schemer
					add_trait = deceitful
					add_trait = shrewd
					add_trait = patient
					add_trait = greedy
					add_trait = cynical
					add_trait = craven
					add_trait = shy
				}
				
				10 = {
					# The Zealot
					add_trait = zealous
					add_trait = chaste
					random = {
						chance = 10
						add_trait = celibate
					}
					add_trait = diligent
					add_trait = envious
					add_trait = content
					add_trait = honest
					add_trait = trusting
				}
				
				10 = {
					# The Mad Genius
					add_trait = genius
					add_trait = lunatic
					add_trait = kind
					add_trait = ambitious
					add_trait = erudite
					add_trait = paranoid
					add_trait = stubborn
				}
			}
			
			save_event_target_as = remarkable_shirabyoshi
		}
	}
	
	option = {
		name = EVTOPTA_SOH_3972 # She's welcome to stay!
		
		prestige = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.3973 } # Inform vassals
			}
		}
	}
}

# Remarkable shirabyoshi - vassal
character_event = {
	id = soh.3973
	desc = EVTDESC_SOH_3973
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_3973 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}



##### Event group 2

# Event selection
character_event = {
	id = soh.3974
	hide_window = yes

	prisoner = no
	war = no

	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			### Event group 2 - 10-19 days into the hanami
			
			# Daytime events 1
			if = {
				limit = {
					has_character_flag = daytime_hanami
				}
				random_list = {
					25 = {
						set_character_flag = hanami_good_weather
						
						character_event = { id = soh.3975 } # Beautiful weather
					}
					
					20 = {
						trigger = {
							any_vassal = {
								count = 2
								has_character_flag = going_to_hanami
								NOR = {
									is_friend = ROOT
									is_lover = ROOT
									is_rival = ROOT
								}
							}
						}
						
						# Vassal makes a friend/rival
						random_list = {
							50 = {
								any_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = hanami_friend_1
								}
								
								any_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
										NOR = {
											is_friend = event_target:hanami_friend_1
											is_lover = event_target:hanami_friend_1
											is_rival = event_target:hanami_friend_1
											character = event_target:hanami_friend_1
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = hanami_friend_2
								}
								
								event_target:hanami_friend_1 = {
									character_event = { id = soh.3976 } # Ping the vassal - friend
								}
							}
							
							50 = {
								any_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = hanami_rival_1
								}
								
								any_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
										NOR = {
											is_friend = event_target:hanami_rival_1
											is_lover = event_target:hanami_rival_1
											is_rival = event_target:hanami_rival_1
											character = event_target:hanami_rival_1
										}
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									save_event_target_as = hanami_rival_2
								}
								
								event_target:hanami_rival_1 = {
									character_event = { id = soh.3979 } # Ping the vassal - rival
								}
							}
						}
					}
					
					20 = {
						trigger = {
							any_vassal = {
								count = 2
								is_adult = yes
								has_character_flag = coming_to_hanami
								NOT = {
									num_of_rivals >= 1
								}
							}
						}
						
						# Arguing vassals
						any_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								NOT = {
									num_of_rivals = 1
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							save_event_target_as = arguing_hanami_vassal_1
						}
						
						any_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								NOT = {
									num_of_rivals >= 1
								}
								NOT = {
									event_target:arguing_hanami_vassal_1 = {
										character = PREV
									}
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							save_event_target_as = arguing_hanami_vassal_2
						}
						
						character_event = { id = soh.3982 } # Inform the liege
					}
					
					25 = {
						trigger = {
							NOR = {
								has_character_flag = hanami_dw_sabotage_attempted
								has_character_flag = hanami_dw_self_sabotage
							}
						}
						
						character_event = { id = soh.3987 } # A visiting priest(ess)
					}
					
					10 = {}
				}
			}
			
			# Nighttime events 1
			else = {
				random_list = {
					30 = {
						# Love in the Dark
						any_vassal = {
							limit = {
								has_character_flag = coming_to_hanami
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							random_list = {
								25 = {
									trigger = {
										is_adult = yes
										NOR = {
											trait = chaste
											trait = celibate
											has_lover = yes
										}
									}
									
									save_event_target_as = hanami_lover_1
									
									ROOT = {
										any_vassal = {
											limit = {
												has_character_flag = coming_to_hanami
												NOT = {
													event_target:hanami_lover_1 = {
														NOT = {
															character = PREV
														}
													}
												}
											}
											score_value = { #Prioritizes selecting an interesting courtier...
												value = 10
												interesting_courtier_selection_score = yes
											}
											
											random_list = {
												25 = {
													trigger = {
														is_adult = yes
														NOR = {
															trait = chaste
															trait = celibate
															has_lover = yes
														}
														is_valid_romance_target = event_target:hanami_lover_1
														event_target:hanami_lover_1 = {
															is_valid_romance_target = PREV
														}
													}
													
													save_event_target_as = hanami_lover_2
												}
												
												75 = {
													any_courtier = {
														limit = {
															is_adult = yes
															is_inaccessible_or_incapable_trigger  = no
															prisoner = no
															has_lover = no
															NOR = {
																trait = chaste
																trait = celibate
																has_lover = yes
															}
															is_valid_romance_target = event_target:hanami_lover_1
															event_target:hanami_lover_1 = {
																is_valid_romance_target = PREV
															}
														}
														score_value = { #Prioritizes selecting an interesting courtier...
															value = 10
															interesting_courtier_selection_score = yes
														}
														
														save_event_target_as = hanami_lover_2
													}
												}
											}
										}
									}
								}
								
								75 = {
									any_courtier = {
										limit = {
											is_adult = yes
											is_inaccessible_or_incapable_trigger  = no
											prisoner = no
											has_lover = no
											NOR = {
												trait = chaste
												trait = celibate
												has_lover = yes
											}
										}
										score_value = { #Prioritizes selecting an interesting courtier...
											value = 10
											interesting_courtier_selection_score = yes
										}
										
										save_event_target_as = hanami_lover_1
										
										ROOT = {
											any_vassal = {
												limit = {
													has_character_flag = coming_to_hanami
													NOT = {
														event_target:hanami_lover_1 = {
															NOT = {
																character = PREV
															}
														}
													}
												}
												score_value = { #Prioritizes selecting an interesting courtier...
													value = 10
													interesting_courtier_selection_score = yes
												}
												
												random_list = {
													25 = {
														trigger = {
															is_adult = yes
															NOR = {
																trait = chaste
																trait = celibate
																has_lover = yes
															}
															is_valid_romance_target = event_target:hanami_lover_1
															event_target:hanami_lover_1 = {
																is_valid_romance_target = PREV
															}
														}
														
														save_event_target_as = hanami_lover_2
													}
													
													75 = {
														any_courtier = {
															limit = {
																is_adult = yes
																is_inaccessible_or_incapable_trigger  = no
																prisoner = no
																has_lover = no
																NOR = {
																	trait = chaste
																	trait = celibate
																	has_lover = yes
																}
																is_valid_romance_target = event_target:hanami_lover_1
																event_target:hanami_lover_1 = {
																	is_valid_romance_target = PREV
																}
															}
															score_value = { #Prioritizes selecting an interesting courtier...
																value = 10
																interesting_courtier_selection_score = yes
															}
															
															save_event_target_as = hanami_lover_2
														}
													}
												}
											}
										}
									}
								}
							}
						}
						
						event_target:hanami_lover_1 = {
							character_event = { id = soh.3988 } # Let the first potential lover choose whether to approach the second
						}
					}
					
					30 = {
						character_event = { id = soh.4001 } # Noise complaints
					}
					
					30 = {
						character_event = { id = soh.4002 } # A shadowy figure
					}
					
					10 = {}
				}
			}
			
			# Misc events 1
			random_list = {
				30 = {
					trigger = {
						is_adult = yes
					}
					character_event = { id = soh.4003 days = 3 random = 3 } # Sake
				}
				
				30 = {
					any_vassal = {
						limit = {
							is_adult = yes
							is_actually_incapable_trigger = no
							has_character_flag = coming_to_hanami
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						save_event_target_as = hanami_poetry_vassal
					}
					
					event_target:hanami_poetry_vassal = {
						character_event = { id = soh.4004 days = 3 random = 3 } # Poetry contest
					}
				}
				
				30 = {
					trigger = {
						any_vassal = {
							count = 2
							is_adult = yes
							has_character_flag = coming_to_hanami
							OR = {
								is_female = no
								has_education_martial_trigger = yes
								has_lifestyle_martial_trigger = yes
								society_member_of = warriors_of_the_rising_sun
								ROOT = {
									primary_title = {
										OR = {
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								gender_equality_trigger = yes
							}
							
							ROOT = {
								any_vassal = {
									is_adult = yes
									has_character_flag = coming_to_hanami
									OR = {
										is_female = no
										has_education_martial_trigger = yes
										has_lifestyle_martial_trigger = yes
										society_member_of = warriors_of_the_rising_sun
										ROOT = {
											primary_title = {
												OR = {
													has_law = status_of_women_3
													has_law = status_of_women_4
												}
											}
										}
										gender_equality_trigger = yes
									}
									
									NOT = {
										character = PREVPREV
									}
									reverse_opinion = {
										who = PREVPREV
										value < 0
									}
									opinion = {
										who = PREVPREV
										value < 0
									}
								}
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						government = japanese_feudal_government
					}
					
					any_vassal = {
						limit = {
							is_adult = yes
							has_character_flag = coming_to_hanami
							OR = {
								is_female = no
								has_education_martial_trigger = yes
								has_lifestyle_martial_trigger = yes
								society_member_of = warriors_of_the_rising_sun
								ROOT = {
									primary_title = {
										OR = {
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								gender_equality_trigger = yes
							}
							
							ROOT = {
								any_vassal = {
									is_adult = yes
									has_character_flag = coming_to_hanami
									OR = {
										is_female = no
										has_education_martial_trigger = yes
										has_lifestyle_martial_trigger = yes
										society_member_of = warriors_of_the_rising_sun
										ROOT = {
											primary_title = {
												OR = {
													has_law = status_of_women_3
													has_law = status_of_women_4
												}
											}
										}
										gender_equality_trigger = yes
									}
									NOT = {
										character = PREVPREV
									}
									reverse_opinion = {
										who = PREVPREV
										value < 0
									}
									opinion = {
										who = PREVPREV
										value < 0
									}
								}
							}
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						save_event_target_as = hanami_duel_vassal_1
					}
					
					any_vassal = {
						limit = {
							is_adult = yes
							has_character_flag = coming_to_hanami
							OR = {
								is_female = no
								has_education_martial_trigger = yes
								has_lifestyle_martial_trigger = yes
								society_member_of = warriors_of_the_rising_sun
								ROOT = {
									primary_title = {
										OR = {
											has_law = status_of_women_3
											has_law = status_of_women_4
										}
									}
								}
								gender_equality_trigger = yes
							}
							ROOT = {
								event_target:hanami_duel_vassal_1 = {
									NOT = {
										character = PREVPREV
									}
									reverse_opinion = {
										who = PREVPREV
										value < 0
									}
									opinion = {
										who = PREVPREV
										value < 0
									}
								}
							}
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						save_event_target_as = hanami_duel_vassal_2
					}
					
					event_target:hanami_duel_vassal_1 = {
						character_event = { id = soh.4010 days = 3 random = 3 } # Duel between vassals
					}
				}
				
				10 = {}
			}
			
			# Food complaints/compliments - based on vanilla
			random_list = {
				10 = { #Lavish food (vassal)
					trigger = {
						has_character_flag = lavishly_food
						any_vassal = {
							has_character_flag = coming_to_hanami
							war = no
						}
					}
					
					any_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.4016 days = 6 random = 3 }
					}
				}
				
				10 = { #Medium food (vassal)
					trigger = {
						has_character_flag = medium_food
						any_vassal = {
							has_character_flag = coming_to_hanami
							war = no
						}
					}
					
					any_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.4017 days = 6 random = 3 }
					}
				}
				
				10 = { #Low food (vassal)
					trigger = {
						has_character_flag = low_food
						any_vassal = {
							has_character_flag = coming_to_hanami
							war = no
						}
					}
					
					any_vassal = {
						limit = { 
							has_character_flag = coming_to_hanami
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						character_event = { id = soh.4018 days = 6 random = 3 }
					}
				}
				
				10 = {
					# Nothing
				}
			}
			
			character_event = { id = soh.4021 days = 10 } # Third group of events
		}
	}
}

### Daytime events

# Beautiful weather
character_event = {
	id = soh.3975
	desc = EVTDESC_SOH_3975
	picture = GFX_evt_garden

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}

	option = {
		name = EVTOPTA_SOH_3975 # I sure picked a good day!
		
		prestige = 10
	}
}

# Become friends?
character_event = {
	id = soh.3976
	desc = EVTDESC_SOH_3976
	picture = GFX_evt_courtiers_talking
	
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_friend_2 = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_3976 # I should speak more with X!
		event_target:hanami_friend_2 = {
			character_event = { id = soh.3977 days = 1 }
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3976 # I don't need another friend!
		
		prestige = -5
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become friends?
character_event = {
	id = soh.3977
	desc = EVTDESC_SOH_3977
	picture = GFX_evt_courtiers_talking

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3977 # I should speak more with X!
		add_friend = FROM
		FROM = {
			character_event = { id = soh.3978 }
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3977 # I don't need another friend!
		
		prestige = -5
		
		FROM = {
			character_event = { id = soh.3978 }
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Inform FROM
character_event = {
	id = soh.3978
	
	desc = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		text = EVTDESCA_SOH_3978
	}
	
	desc = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_SOH_3978
	}
	
	picture = GFX_evt_courtiers_talking

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		
		name = EVTOPTA_SOH_3978 # Good!
		
		add_friend = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		
		name = EVTOPTB_SOH_3978 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Become rivals?
character_event = {
	id = soh.3979
	desc = EVTDESC_SOH_3979
	picture = GFX_evt_quarrel
	
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_rival_2 = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_3979 # They'd better apologize!
		event_target:hanami_rival_2 = {
			character_event = { id = soh.3980 days = 1 }
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3979 # Let's not make matters worse...
		
		prestige = -10
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become rivals?
character_event = {
	id = soh.3980
	desc = EVTDESC_SOH_3980
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3980 # I hate you too!
		
		# GRACETODO
		
		add_rival = FROM
		
		FROM = {
			character_event = { id = soh.3981 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3980 # Let's make amends...
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.3981 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = cruel
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# Inform FROM
character_event = {
	id = soh.3981
	
	desc = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		text = EVTDESCA_SOH_3981
	}
	
	desc = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_SOH_3981
	}
	
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		
		name = EVTOPTA_SOH_3981 # You're going down!
		
		# GRACETODO
		
		add_rival = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		
		name = EVTOPTB_SOH_3981 # Very well...
		
		opinion = {
			who = FROM
			modifier = opinion_glad
			months = 12
		}
	}
}

# Arguing vassals - liege
character_event = {
	id = soh.3982
	desc = EVTDESC_SOH_3982
	picture = GFX_evt_quarrel

	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3982 # Try to make things better
		hidden_tooltip = {
			if = {
				limit = {
					diplomacy >= 16
				}
				character_event = { id = soh.3983 days = 1 } # Good outcome
			}
			
			else_if = {
				limit = {
					diplomacy < 16
					diplomacy >= 6
				}
				
				random_list = {
					50 = {
						character_event = { id = soh.3983 days = 1 } # Good outcome
					}
					
					50 = {
						character_event = { id = soh.3985 days = 1 } # Bad outcome
					}
				}
			}
			
			else = {
				character_event = { id = soh.3985 days = 1 } # Bad outcome
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = craven
					trait = shy
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3982 # Let's not get involved...
		
		prestige = -10
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NAND = {
					OR = {
						trait = socializer
						trait = gregarious
					}
					NOR = {
						trait = craven
						trait = shy
					}
				}
			}
		}
	}
}

# Liege made things better
character_event = {
	id = soh.3983
	desc = EVTDESC_SOH_3983
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3983 # Good!
		
		prestige = 10		
		
		event_target:arguing_hanami_vassal_1 = {
			character_event = { id = soh.3984 }
		}
		
		event_target:arguing_hanami_vassal_2 = {
			character_event = { id = soh.3984 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.3984
	desc = EVTDESC_SOH_3984
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3984 # Good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Liege made things worse
character_event = {
	id = soh.3985
	desc = EVTDESC_SOH_3985
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3985 # Not good!
		
		prestige = -10		
		
		event_target:arguing_hanami_vassal_1 = {
			character_event = { id = soh.3986 }
		}
		
		event_target:arguing_hanami_vassal_2 = {
			character_event = { id = soh.3986 }
		}
	}
}

# Inform vassals
character_event = {
	id = soh.3986
	desc = EVTDESC_SOH_3986
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3986 # Rude!
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		if = {
			limit = {
				event_target:arguing_hanami_vassal_1 = {
					character = ROOT
				}
			}
			
			event_target:arguing_hanami_vassal_2 = {
				opinion = {
					who = ROOT
					modifier = opinion_upset
					months = 12
				}
				
				reverse_opinion = {
					who = ROOT
					modifier = opinion_upset
					months = 12
				}
			}
		}
		
		else = {
			event_target:arguing_hanami_vassal_1 = {
				opinion = {
					who = ROOT
					modifier = opinion_upset
					months = 12
				}
				
				reverse_opinion = {
					who = ROOT
					modifier = opinion_upset
					months = 12
				}
			}
		}
	}
}

# Visiting priest(ess)
character_event = {
	id = soh.3987
	desc = EVTDESC_SOH_3987
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3987 # Great!
		
		piety = 10
	}
}

### Nighttime events

# Attempt to tumble other character?
character_event = {
	id = soh.3988
	desc = EVTDESC_SOH_3988
	picture = GFX_evt_brothel
	
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_lover_2 = {
				is_alive = yes
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3988 # Yes!
		
		piety = -5
		
		event_target:hanami_lover_2 = {
			character_event = { id = soh.3989 days = 1 } # Other vassal chooses how to respond
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					AND = {
						spouse = {
							reverse_opinion = {
								who = ROOT
								value >= 25
							}
						}
						NOR = {
							trait = lustful
							trait = master_seducer
							trait = master_seductress
						}
					}
				
					spouse = {
						reverse_opinion = {
							who = ROOT
							value >= 50
						}
					}
					
					event_target:hanami_lover_2 = {
						is_unattractive_trigger = yes
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3988 # No!
		
		piety = 5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				event_target:hanami_lover_2 = {
					is_attractive_trigger = no
				}
			}
			
			mult_modifier = {
				factor = 0.5
				trait = lustful
			}
			
			mult_modifier = {
				factor = 0.5
				OR = {
					trait = master_seducer
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 2
				trait = content
			}
			
			mult_modifier = {
				factor = 2
				trait = zealous
			}
			
			mult_modifier = {
				factor = 2
				trait = just
			}
			
			mult_modifier = {
				factor = 5
				trait = paranoid
			}
		}
	}
}

# Tumble?
character_event = {
	id = soh.3989
	desc = EVTDESC_SOH_3989
	picture = GFX_evt_brothel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_lover_1 = {
				is_alive = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_3989 # Yes!
		
		#STDs and pregnancy
		FROM = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = soh.3991 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						spouse = {
							reverse_opinion = {
								who = ROOT
								value >= 25
							}
						}
						NOR = {
							trait = lustful
							trait = master_seducer
							trait = master_seductress
						}
					}
				
					spouse = {
						reverse_opinion = {
							who = ROOT
							value >= 50
						}
					}
					
					FROM = {
						is_unattractive_trigger = yes
					}
					
					has_character_modifier = dismissed_proposal # Refusing all seduction attempts!
				}
			}
			
			mult_modifier = {
				factor = 5
				FROM = {
					OR = {
						trait = master_seducer
						trait = master_seductress
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3989 # No!
		
		piety = 5
		
		FROM = {
			character_event = { id = soh.3990 }
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 0.5
				trait = lustful
			}
			
			mult_modifier = {
				factor = 0.5
				OR = {
					trait = master_seducer
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 2
				trait = content
			}
			
			mult_modifier = {
				factor = 2
				trait = zealous
			}
			
			mult_modifier = {
				factor = 2
				trait = just
			}
			
			mult_modifier = {
				factor = 5
				trait = paranoid
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
}

# No lover
character_event = {
	id = soh.3990
	desc = EVTDESC_SOH_3990
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3990 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Got lover
character_event = {
	id = soh.3991
	desc = EVTDESC_SOH_3991
	picture = GFX_evt_lovers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3991 # Great!
		
		add_lover = FROM
		
		hidden_tooltip = {
			if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 4
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 4
							}
						}
					}
					
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 8
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 8
							}
						}
					}
				}
				
				random_list = {
					25 = {
						FROMFROMFROM = {
							character_event = { id = soh.3992 } # Liege discovers tumbling
						}
					}
					
					75 = {}
				}
			}
			
			else_if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 8
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 8
							}
						}
					}
					
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 12
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 12
							}
						}
					}
				}
				
				random_list = {
					50 = {
						FROMFROMFROM = {
							character_event = { id = soh.3992 } # Liege discovers tumbling
						}
					}
					
					50 = {}
				}
			}
			
			else_if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 12
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 12
							}
						}
					}
					
					NOR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 16
							}
						}
						FROMFROMFROM = {
							attribute_diff = {
								character = FROM
								attribute = intrigue
								value >= 16
							}
						}
					}
				}
				
				random_list = {
					75 = {
						FROMFROMFROM = {
							character_event = { id = soh.3992 } # Liege discovers tumbling
						}
					}
					
					25 = {}
				}
			}
			else_if = {
				limit = {
					OR = {
						FROMFROMFROM = {
							attribute_diff = {
								character = ROOT
								attribute = intrigue
								value >= 16
							}
						}
						FROM = {
							FROMFROM = {
								attribute_diff = {
									character = PREV
									attribute = intrigue
									value >= 16
								}
							}
						}
					}
				}
				
				FROMFROMFROM = {
					character_event = { id = soh.3992 } # Liege discovers tumbling
				}
			}
		}
	}
}

# Tumbling discovered - liege chooses how to react
character_event = {
	id = soh.3992
	desc = EVTDESC_SOH_3992
	picture = GFX_evt_lovers
	
	prisoner = no
	only_rulers = yes
	war = no
	min_age = 16
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes
	
	# No need to have Grace penalties applied to the lovers here since the AI will trigger normal adultery fallout if closely related to the characters in question and that handles it already
	
	option = {
		name = EVTOPTA_SOH_3992 # Keep it secret!
		
		FROM = {
			character_event = { id = soh.3993 days = 1 }
		}
		
		FROMFROM = {
			character_event = { id = soh.3994 days = 1 }
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					FROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							AND =
							{
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
					
					FROMFROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3992 # Try to blackmail them!
		
		# GRACETODO
		
		FROM = {
			character_event = { id = soh.3995 days = 1 }
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					FROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
					
					FROMFROM = {
						OR = {
							any_spouse = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							any_consort = {
								OR = {
									character = ROOT
									ROOT = {
										current_heir = {
											character = PREVPREV
										}
									}
									any_close_relative = {
										dynasty = PREV
										character = ROOT
									}
								}
							}
							
							AND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 5
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 5
				trait = deceitful
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3992 # Expose them!
		
		# GRACETODO
		
		FROM = {
			character_event = { id = soh.3999 days = 1 } # Inform of outing
		}
		
		FROMFROM = {
			character_event = { id = soh.3999 days = 1 } # Inform of outing
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				NOR = {
					character = FROM
					character = FROMFROM
				}
			}
			
			character_event = { id = soh.4000 days = 1 } # Inform of outing
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 5
				trait = cruel
			}
			
			mult_modifier = {
				factor = 5
				trait = just
			}
		}
	}
}

# Liege keeps secret - lover 1
character_event = {
	id = soh.3993
	desc = EVTDESC_SOH_3993
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3993 # Phew!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Liege keeps secret - lover 2
character_event = {
	id = soh.3994
	desc = EVTDESC_SOH_3994
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3994 # Phew!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Blackmail attempt - lover 1
character_event = {
	id = soh.3995
	desc = EVTDESC_SOH_3995
	picture = GFX_evt_whispers

	is_triggered_only = yes
	
	option = {
		trigger = {
			scaled_wealth >= 0.1
		}
		
		name = EVTOPTA_SOH_3995 # Fine! I'll pay!
		
		FROMFROMFROM = {
			character_event = { id = soh.3996 } # Other lover needs to accept too
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPA_SOH_3995
		}
		
		opinion = {
			who = FROM
			modifier = hanami_lover_paid_money
			months = 1
		}
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			FROM = {
				OR = {
					any_voter = {
						character = ROOT
					}
					any_vassal = {
						character = ROOT
					}
				}
				
				NOT = {
					holds_favor_on = ROOT
				}
			}
		}
		
		name = EVTOPTB_SOH_3995 # Fine! I owe you one!
		
		FROMFROMFROM = {
			character_event = { id = soh.3996 } # Other lover needs to accept too
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPB_SOH_3995
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3995 # Never!
		
		FROM = {
			character_event = { id = soh.3998 }
		}
		
		ai_chance = {
			factor = 10
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
}

# Blackmail attempt 2
character_event = {
	id = soh.3996
	desc = EVTDESC_SOH_3996
	picture = GFX_evt_whispers

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			scaled_wealth >= 0.1
		}
		
		name = EVTOPTA_SOH_3995 # Fine! I'll pay!
		
		FROMFROM = {
			character_event = { id = soh.3997 } # Inform liege
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPA_SOH_3996
		}
		
		opinion = {
			who = FROM
			modifier = hanami_lover_paid_money
			months = 1
		}
		
		ai_chance = {
			factor = 75
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Conclave"
			FROMFROM = {
				OR = {
					any_voter = {
						character = ROOT
					}
					any_vassal = {
						character = ROOT
					}
				}
				NOT = {
					holds_favor_on = ROOT
				}
			}
		}
		
		name = EVTOPTB_SOH_3995 # Fine! I owe you one!
		
		FROMFROM = {
			character_event = { id = soh.3997 } # Inform liege
		}
		
		custom_tooltip = {
			text = EVTTOOLTIPB_SOH_3996
		}
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3995 # Never!
		
		FROM = {
			character_event = { id = soh.3998 }
		}
		
		ai_chance = {
			factor = 10
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
		}
	}
}

# Blackmail accepted
character_event = {
	id = soh.3997
	desc = EVTDESC_SOH_3997
	picture = GFX_evt_whispers

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3997
		
		if = {
			limit = {
				FROMFROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_lover_paid_money
					}
				}
			}
			FROMFROM = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.1
					min = 10
					max = 1000
				}
			}
		}
		
		else = {
			add_favor = FROMFROM
		}
		
		if = {
			limit = {
				FROM = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_lover_paid_money
					}
				}
			}
			FROM = {
				transfer_scaled_wealth = {
					to = ROOT
					value = 0.1
					min = 10
					max = 1000
				}
			}
		}
		
		if = {
			limit = {
				NOT = {
					FROM = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hanami_lover_paid_money
						}
					}
				}
			}
			
			add_favor = FROM
		}
	}
}
	
# Blackmail not accepted
character_event = {
	id = soh.3998
	desc = EVTDESC_SOH_3998
	picture = GFX_evt_whispers

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3998 # Expose them!
		
		FROM = {
			character_event = { id = soh.3999 days = 1 } # Inform of outing
		}
		
		FROMFROM = {
			character_event = { id = soh.3999 days = 1 } # Inform of outing
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				NOR = {
					character = FROM
					character = FROMFROM
				}
			}
			
			character_event = { id = soh.4000 days = 1 } # Inform of outing
		}
		
	}
}

# Lovers being outed
character_event = {
	id = soh.3999
	desc = EVTDESC_SOH_3999
	picture = GFX_evt_scandal

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_3999 # Oh no!
		
		prestige = -100
		piety = -50
		
		opinion = {
			who = FROM
			modifier = bad_hanami
			months = 12
		}
		
		
		FROMFROM = {
			save_event_target_as = target_adulterer
		}
		
		FROMFROMFROM = {
			character_event = { id = 20 } # Adultery fallout
		}
	}
}

# Other vassals informed
character_event = {
	id = soh.4000
	desc = EVTDESC_SOH_4000
	picture = GFX_evt_scandal

	capable_only = yes
	prisoner = no

	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				any_spouse = {
					character = FROMFROM
				}
				any_consort = {
					character = FROMFROM
				}
				any_spouse = {
					character = FROMFROMFROM
				}
				any_consort = {
					character = FROMFROMFROM
				}
				any_child = {
					character = FROMFROM
				}
				any_child = {
					character = FROMFROMFROM
				}
			}
		}
		
		name = EVTOPTA_SOH_4000 # I see...
	}
	
	option = {
		trigger = {
			OR = {
				any_spouse = {
					character = FROMFROM
				}
				any_consort = {
					character = FROMFROM
				}
				any_spouse = {
					character = FROMFROMFROM
				}
				any_consort = {
					character = FROMFROMFROM
				}
			}
		}
		
		name = EVTOPTB_SOH_4000 # They will pay!
		
		if = {
			limit = {
				any_lover = {
					character = FROMFROM
				}
			}
			remove_lover = FROMFROM
		}
		
		if = {
			limit = {
				any_lover = {
					character = FROMFROMFROM
				}
			}
			remove_lover = FROMFROMFROM
		}
		
		add_rival = FROMFROM
		
		add_rival = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				any_child = {
					character = FROMFROM
				}
				any_child = {
					character = FROMFROMFROM
				}
			}
		}
		
		name = EVTOPTC_SOH_4000 # They will pay!
		
		if = {
			limit = {
				any_child = {
					character = FROMFROM
				}
			}
			add_rival = FROMFROMFROM
		}
		
		if = {
			limit = {
				any_child = {
					character = FROMFROMFROM
				}
			}
			add_rival = FROMFROM
		}
	}
}

# Townspeople complain about loud party
character_event = {
	id = soh.4001
	desc = EVTDESC_SOH_4001
	picture = GFX_evt_emissary
	
	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4001 # We'll tone it down!
		
		prestige = -25
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					trait = cruel
				}
			}
			
			mult_modifier = {
				factor = 2
				trait = humble
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_4001 # Shut up, peasant!
		
		capital_scope = {
			add_province_modifier = {
				name = peasants_upset
				duration = 365
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			mult_modifier = {
				factor = 2
				trait = proud
			}
		}
	}
}

# Someone sneaking about
character_event = {
	id = soh.4002
	desc = EVTDESC_SOH_4002
	picture = GFX_evt_shadow

	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = paranoid
			}
		}
		
		name = EVTOPTA_SOH_4002 # Who goes there?
		
		random = {
			chance = 25
			add_trait_partially_paranoid_effect = yes
		}
	}
	
	option = {
		trigger = {
			trait = paranoid
		}
		
		name = EVTOPTB_SOH_4002 # Guards, to me!
		
		prestige = -25
	}
}

### Misc events

# Sake
character_event = {
	id = soh.4003
	desc = EVTDESC_SOH_4003
	picture = GFX_evt_feast

	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			trait = temperate
			NOT = {
				trait = drunkard
			}
		}
		
		name = EVTOPTA_SOH_4003 # Try to drink in moderation
		
		random = {
			chance = 20
			add_trait_partially_drunkard_effect = yes
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = temperate
				trait = drunkard
			}
		}
		
		name = EVTOPTB_SOH_4003 # Drink some more
		
		random = {
			chance = 20
			add_trait_partially_drunkard_effect = yes
		}
	}
	
	option = {
		trigger = {
			trait = drunkard
		}
		
		name = EVTOPTC_SOH_4003 # Drink a lot
		
		prestige = -25
	}
}

# Hold poetry contest?
character_event = {
	id = soh.4004
	desc = EVTDESC_SOH_4004
	picture = GFX_evt_council

	prisoner = no
	only_rulers = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4004 # Issue a challenge!
		
		FROM = {
			character_event = { id = soh.4005 } # Liege is challenged
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4004 # Let's not
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			
			trigger =  {
				NOT = {
					trait = poet
				}
			}
		}
	}
}

# Poetry contest?
character_event = {
	id = soh.4005
	desc = EVTDESC_SOH_4005
	picture = GFX_evt_council

	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4005 # Challenge accepted!
		
		FROM = {
			character_event = { id = soh.4007 } # Inform FROM
		}
		
		ai_chance = {
			factor = 75
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4005 # Let's not
		
		FROM = {
			character_event = { id = soh.4006 } # Inform FROM
		}
		
		prestige = -25
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOT = {
					trait = poet
				}
			}
		}
	}
}

# Liege refused contest
character_event = {
	id = soh.4006
	desc = EVTDESC_SOH_4006
	picture = GFX_evt_council

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4006 # I see...
	}
}

# Calculate outcome
character_event = {
	id = soh.4007

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				mult_modifier = {
					factor = 10
					trait = poet
				}
				
				mult_modifier = {
					factor = 2
					learning >= 12
				}
				
				mult_modifier = {
					factor = 2
					learning >= 16
				}
				
				mult_modifier = {
					factor = 2
					learning >= 20
				}
				
				mult_modifier = {
					factor = 2
					learning >= 24
				}
				
				mult_modifier = {
					factor = 2
					learning >= 28
				}
				
				character_event = { id = soh.4008 days = 1 } # Vassal won
				
				FROM = {
					character_event = { id = soh.4009 days = 1 } # Liege lost
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 10
					FROM = {
						trait = poet
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						learning >= 12
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						learning >= 16
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						learning >= 20
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						learning >= 24
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						learning >= 28
					}
				}
				
				character_event = { id = soh.4009 days = 1 } # Vassal lost
				
				FROM = {
					character_event = { id = soh.4008 days = 1 } # Liege won
				}
			}
		}
	}
}

# You won
character_event = {
	id = soh.4008
	desc = EVTDESC_SOH_4008
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		trigger = {
			NOT = {
				trait = poet
			}
		}
		
		name = EVTOPTA_SOH_4008# I should do this more often!
		
		random = {
			chance = 25
			add_trait_poet_effect = yes
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = poet
			}
		}
		
		name = EVTOPTB_SOH_4008 # This went well!
		
		prestige = 10
	}
	
	option = {
		trigger = {
			trait = poet
		}
		
		name = EVTOPTC_SOH_4008 # I know how to use words effectively!
		
		prestige = 25
	}
}

# You lost
character_event = {
	id = soh.4009
	desc = EVTDESC_SOH_4009
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4009 # Unfortunate
		
		prestige = -10
	}
}

# Insulted by other vassal - duel them?
character_event = {
	id = soh.4010
	desc = EVTDESC_SOH_4010
	picture = GFX_evt_quarrel

	prisoner = no
	only_rulers = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4010 # Issue a challenge!
		
		pacifists_lose_piety_effect = yes
		
		event_target:hanami_duel_vassal_2 = {
			character_event = { id = soh.4011 } # Other vassal is challenged
		}
		
		ai_chance = {
			factor = 75
			
			trigger = {
				NOR = {
					trait = craven
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4004 # Let's not
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NAND = {
					NOR = {
						trait = craven
						trait = kind
					}
					OR = {
						trait = proud
						trait = cruel
						trait = wroth
					}
				}
			}
		}
	}
}

# Challenge issued - accept?
character_event = {
	id = soh.4011
	desc = EVTDESC_SOH_4011
	picture = GFX_evt_quarrel

	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTA_SOH_4011 # Challenge accepted!
		
		pacifists_lose_piety_effect = yes
		
		hidden_tooltip = { # TIANXIATODO: Maybe replace with actual duel logic
			random_list = {
				50 = {
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 10
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 20
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 30
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 40
						}
					}
					
					FROMFROM = {
						set_character_flag = hanami_duel_challengee_won
					}
				}
				
				50 = {
					FROMFROM = {
						set_character_flag = hanami_duel_draw
					}
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 10
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 20
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 30
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 40
							}
						}
					}
					
					FROMFROM = {
						set_character_flag = hanami_duel_challenger_won
					}
				}
			}
			
			character_event = { id = soh.4014 days = 1 }
			
			FROM = {
				character_event = { id = soh.4014 days = 1 }
			}
			
			FROMFROM = {
				character_event = { id = soh.4013 days = 1 }
				
				any_vassal = {
					limit = {
						ai = no # The AI doesn't care
						has_character_flag = coming_to_hanami
						NOR = {
							event_target:hanami_duel_vassal_1 = {
								character = PREV
							}
							event_target:hanami_duel_vassal_2 = {
								character = PREV
							}
						}
					}
					
					character_event = { id = soh.4015 days = 1 }
				}
			}
		}
		
		ai_chance = {
			factor = 75
			
			trigger = {
				NOR = {
					trait = craven
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4011 # I apologize!
		
		prestige = -25
		
		FROM = {
			character_event = { id = soh.4012 days = 1 } # Apology
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NAND = {
					NOR = {
						trait = craven
						trait = kind
					}
					OR = {
						trait = proud
						trait = cruel
						trait = wroth
					}
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = gregarious
			}
			
			mult_modifier = {
				factor = 10
				trait = socializer
			}
		}
	}
}

# Apology issued
character_event = {
	id = soh.4012
	desc = EVTDESC_SOH_4012
	picture = GFX_evt_quarrel

	capable_only = yes
	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4012 # I'll take it!
		
		prestige = 25
	}
}

# Liege informed of duel outcome
character_event = {
	id = soh.4013
	
	desc = {
		trigger = {
			has_character_flag = hanami_duel_challengee_won
		}
		text = EVTDESCA_SOH_4013
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_duel_draw
		}
		text = EVTDESCB_SOH_4013
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_duel_challenger_won
		}
		text = EVTDESCC_SOH_4013
	}
	
	picture = GFX_evt_emissary
	
	is_triggered_only = yes

	prisoner = no
	only_rulers = yes
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4013 # I see...
	}
}

# Duelling vassals informed of outcome
character_event = {
	id = soh.4014
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROM
		}
		text = EVTDESCA_SOH_4014
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROM
		}
		text = EVTDESCB_SOH_4014
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROM
		}
		text = EVTDESCC_SOH_4014
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROMFROM
		}
		text = EVTDESCD_SOH_4014
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROMFROM
		}
		text = EVTDESCE_SOH_4014
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROMFROM
		}
		text = EVTDESCF_SOH_4014
	}
	
	picture = GFX_evt_melee # Best option
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROM
		}
		
		name = EVTOPTA_SOH_4014 # Yield!
		
		prestige = 10
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROM
		}
		
		name = EVTOPTB_SOH_4014 # Well fought!
		
		prestige = 5
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROM
		}
		
		name = EVTOPTC_SOH_4014 # I yield!
		
		prestige = -10
		
		add_trait_wounded_effect = yes
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
			character = FROMFROM
		}
		
		name = EVTOPTD_SOH_4014 # I yield!
		
		prestige = -10
		
		add_trait_wounded_effect = yes
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
			character = FROMFROM
		}
		
		name = EVTOPTE_SOH_4014 # Well fought!
		
		prestige = 5
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
			character = FROMFROM
		}
		name = EVTOPTF_SOH_4014 # Yield!
		
		prestige = 10
	}
}

# Other vassals informed of outcome
character_event = {
	id = soh.4015
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challengee_won
			}
		}
		text = EVTDESCA_SOH_4015
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_draw
			}
		}
		text = EVTDESCB_SOH_4015
	}
	
	desc = {
		trigger = {
			FROMFROMFROM = {
				has_character_flag = hanami_duel_challenger_won
			}
		}
		text = EVTDESCC_SOH_4015
	}
	
	picture = GFX_evt_feast

	prisoner = no
	only_rulers = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4015 # I see...
	}
}

### Food events - based on vanilla

# Lavish Food
character_event = {
	id = soh.4016
	desc = EVTDESC_SOH_4016
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4016 # Approve publicly

		trigger = {
			NOT = { trait = temperate }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4019
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4016 # Disapprove

		trigger = {
			NOT = { trait = gluttonous }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4020
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4016 # Say nothing
		
		prestige = -10
	}
}

# Medium Food
character_event = {
	id = soh.4017
	desc = EVTDESC_SOH_4017
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4016 # Approve publicly

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4019
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4016 # Disapprove publicly

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4020
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4016 # Say nothing
		
		prestige = -10
	}
}

# Low Food
character_event = {
	id = soh.4018
	desc = EVTDESC_SOH_4018
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4016 # Approve publicly

		trigger = {
			NOT = { trait = gluttonous }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4019
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4016 # Disapprove

		trigger = {
			NOT = { trait = temperate }
		}

		FROM = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.4020
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4016 # Say nothing
		
		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = soh.4019
	desc = EVTDESC_SOH_4019
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4019 # Good!
		
		opinion = {
			modifier = opinion_happy
			who = FROM
			years = 10
		}
		
		reverse_opinion = {
			modifier = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = soh.4020
	desc = EVTDESC_SOH_4020
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4020 # Shut up!
		
		opinion = {
			modifier = opinion_irritated
			who = FROM
			years = 10
		}
		
		reverse_opinion = {
			modifier = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}



##### Event group 3

# Event selection
character_event = {
	id = soh.4021
	hide_window = yes

	prisoner = no
	war = no

	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			### Event group 3 - 20-29 days into the hanami
			
			# Entertainment 2 - guaranteed if a remarkable or troublesome entertainer is present, otherwise minor flavour can happen from time to time
			
			if = {
				limit = {
					OR = {
						has_character_flag = troublesome_shirabyoshi
						has_character_flag = remarkable_shirabyoshi
					}
					
					NOR = {
						has_character_flag = banished_shirabyoshi
						has_character_flag = shirabyoshi_killed
					}
				}
				
				if = {
					limit = {
						has_character_flag = troublesome_shirabyoshi
						event_target:troublesome_shirabyoshi = {
							is_alive = yes
						}
					}
					
					random_list = {
						50 = {
							# Shirabyoshi and duelling vassal might become lovers/friends
							event_target:troublesome_shirabyoshi = {
								any_opinion_modifier_target = {
									limit = {
										OR = {
											reverse_has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_good_sport
											}
											reverse_has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_bad_sport # You can certainly try, but good luck!
											}
										}
										
										is_actually_incapable_trigger = no
										war = no
									}
									
									character_event = { id = soh.4022 } # Vassal gets event
								}
							}
						}
						
						100 = {
							# Angry shirabyoshi attempts to kill vassal
							trigger = {
								event_target:troublesome_shirabyoshi = {
									has_any_opinion_modifier = hanami_duel_bad_sport
								}
							}
							
							# Shirabyoshi and duelling vassal might become lovers/friends
							event_target:troublesome_shirabyoshi = {
								character_event = { id = soh.4029 } # Shirabyoshi gets event
							}
						}
						
						100 = {
							# Angry vassal attempts to kill shirabyoshi
							trigger = {
								event_target:troublesome_shirabyoshi = {
									has_any_opinion_modifier = hanami_duel_bad_sport
								}
							}
							
							event_target:troublesome_shirabyoshi = {
								any_opinion_modifier_target = {
									limit = {
										reverse_has_opinion_modifier = {
											who = PREV
											modifier = hanami_duel_bad_sport
										}
										NOT = {
											has_character_flag = won_shirabyoshi_duel
										}
									}
									
									character_event = { id = soh.4043 } # Vassal gets event
								}
							}
						}
						
						50 = {
							# Shirabyoshi teaches female courtier how to fight
							trigger = {
									any_courtier = {
									is_adult = yes
									dynasty = ROOT
									is_female = yes
									is_inaccessible_or_incapable_trigger = no
									prisoner = no
									NOR = {
										lifestyle_traits >= 1
										has_character_flag = shirabyoshi_lesson
									}
									event_target:troublesome_shirabyoshi = {
										NOT = {
											has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_bad_sport
											}
										}
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_adult = yes
									dynasty = ROOT
									is_female = yes
									is_inaccessible_or_incapable_trigger = no
									prisoner = no
									NOR = {
										lifestyle_traits >= 1
										has_character_flag = shirabyoshi_lesson
									}
									event_target:troublesome_shirabyoshi = {
										NOT = {
											has_opinion_modifier = {
												who = PREV
												modifier = hanami_duel_bad_sport
											}
										}
									}
								}
								score_value = { #Prioritizes selecting an interesting courtier...
									value = 10
									interesting_courtier_selection_score = yes
								}
								
								set_character_flag = shirabyoshi_lesson
								
								character_event = { id = soh.4055 } # Female relative gets lesson
							}
						}
						
						10 = {
							# Nothing
						}
					}
				}
				
				if = {
					limit = {
						is_adult = yes
						has_character_flag = remarkable_shirabyoshi
						event_target:remarkable_shirabyoshi = {
							is_alive = yes
						}
					}
					
					random_list = {
						50 = {
							# Try to seduce/befriend shirabyoshi?
							character_event = { id = soh.4057 }
						}
						
						50 = {
							# Shirabyoshi provides vassal opinion boost
							character_event = { id = soh.4064 }
						}
					}
				}
			}
			
			if = {
				limit = {
					has_character_flag = hanami_shirabyoshi
					NOR = {
						has_character_flag = troublesome_shirabyoshi
						has_character_flag = remarkable_shirabyoshi
						has_character_flag = shirabyoshi_noshow
						has_character_flag = bad_shirabyoshi
					}
				}
				
				random_list = {
					30 = {
						# Shirabyoshi perform well
						character_event = { id = soh.4066 }
					}
					
					30 = {
						# Shirabyoshi upset someone
						any_vassal = {
							limit = {
								has_character_flag = going_to_hanami
								war = no
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.4068 }
						}
					}
					
					40 = {}
				}
			}
			
			# Daytime events 2
			if = {
				limit = {
					has_character_flag = daytime_hanami
				}
				random_list = {
					50 = {
						# Children become friends/rivals
						any_child = {
							limit = {
								age >= 6
								age < 16
								is_inaccessible_or_incapable_trigger = no
								host = {
									character = ROOT
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							ROOT = {
								any_vassal = {
									limit = {
										has_character_flag = coming_to_hanami
										war = no
									}
									score_value = { #Prioritizes selecting an interesting courtier...
										value = 10
										interesting_courtier_selection_score = yes
									}
									
									any_child = {
										limit = {
											age >= 6
											age < 16
											is_inaccessible_or_incapable_trigger = no
											NOR = {
												is_friend = PREVPREVPREV
												is_rival = PREVPREVPREV
											}
											host = {
												character = PREV
											}
										}
										score_value = { #Prioritizes selecting an interesting courtier...
											value = 10
											interesting_courtier_selection_score = yes
										}
										
										save_event_target_as = hanami_child_friend_rival
									}
									
									random_list = {
										50 = {
											character_event = { id = soh.4072 days = 3 random = 3 } # Friends?
										}
										
										50 = {
											character_event = { id = soh.4075 days = 3 random = 3 } # Rivals?
										}
									}
								}
							}
						}
					}
					
					40 = {
						character_event = { id = soh.4078 days = 3 random = 3 } # The weather worsens
					}
					
					10 = {}
				}
			}
			
			# Nighttime events 2
			if = {
				limit = {
					has_character_flag = nighttime_hanami
				}
				random_list = {
					50 = {
						trigger = {
							is_adult = yes
						}
						character_event = { id = soh.4079 days = 3 random = 3 } # Fireworks merchant
					}
					
					40 = {
						random_list = {
							1 = {
								character_event = { id = soh.4095 days = 3 random = 3 } # Comet sighted!
							}
							
							20 = {
								trigger = {
									is_adult = yes
									is_married = yes
									spouse = {
										is_adult = yes
										is_inaccessible_or_incapable_trigger = no
										NOT = {
											any_lover = {
												NOR = {
													spouse = {
														character = PREVPREV
													}
													any_consort = {
														character = PREVPREV
													}
												}
											}
										}
										opinion = {
											who = ROOT
											value >= 25
										}
										is_valid_romance_target = ROOT
										ROOT = {
											is_valid_romance_target = PREV
										}
									}
								}
								
								character_event = { id = soh.4097 days = 3 random = 3 } # Bond with spouse
							}
							
							20 = {
								trigger = {
									any_child = {
										is_inaccessible_or_incapable_trigger = no
										host = {
											character = ROOT
										}
										NOR = {
											is_friend = ROOT
											is_rival = ROOT
										}
										opinion = {
											who = ROOT
											value >= 0
										}
									}
								}
								
								character_event = { id = soh.4098 days = 3 random = 3 } # Bond with child
							}
							
							69 = { # I don't *think* this was intentional...
								character_event = { id = soh.4099 days = 3 random = 3 } # Just a nice evening
							}
						}
					}
					
					10 = {}
				}
			}
			
			# Misc events 2
			random_list = {
				25 = {
					trigger = {
						is_adult = yes
						is_maimed_trigger = no
						OR = {
							is_female = no
							has_education_martial_trigger = yes
							has_lifestyle_martial_trigger = yes
							society_member_of = warriors_of_the_rising_sun
							has_law = status_of_women_3
							has_law = status_of_women_4
							gender_equality_trigger = yes
						}
					}
					
					mult_modifier = {
						factor = 0.2
						NOT = {
							government = japanese_feudal_government
						}
					}
					
					mult_modifier = {
						factor = 2
						society_member_of = warriors_of_the_rising_sun
					}
					
					mult_modifier = {
						factor = 2
						trait = duelist
					}
					
					character_event = { id = soh.4100 days = 6 random = 3 } # Sword practice
					
					if = {
						limit = {
							tier = duke
							controls_religion = no
						}
						
						any_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								is_maimed_trigger = no
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									has_law = status_of_women_3
									has_law = status_of_women_4
									gender_equality_trigger = yes
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.4100 days = 6 random = 3 } # Sword practice
						}
					}
					
					else_if = {
						limit = {
							tier = king
							controls_religion = no
						}
						
						any_vassal = {
							count = 2
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								is_maimed_trigger = no
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									has_law = status_of_women_3
									has_law = status_of_women_4
									gender_equality_trigger = yes
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.4100 days = 6 random = 3 } # Sword practice
						}
					}
					
					else_if = {
						limit = {
							OR = {
								tier = emperor
								controls_religion = yes
							}
						}
						
						any_vassal = {
							count = 5
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								is_maimed_trigger = no
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									has_law = status_of_women_3
									has_law = status_of_women_4
									gender_equality_trigger = yes
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							character_event = { id = soh.4100 days = 6 random = 3 } # Sword practice
						}
					}
				}
				
				25 = {
					# Strategy discussion
					trigger = {
						is_adult = yes
						OR = {
							is_female = no
							has_education_martial_trigger = yes
							has_lifestyle_martial_trigger = yes
							society_member_of = warriors_of_the_rising_sun
							has_law = status_of_women_3
							has_law = status_of_women_4
							gender_equality_trigger = yes
						}
					}
					
					mult_modifier = {
						factor = 0.2
						NOT = {
							government = japanese_feudal_government
						}
					}
					
					mult_modifier = {
						factor = 2
						society_member_of = warriors_of_the_rising_sun
					}
					
					mult_modifier = {
						factor = 2
						trait = strategist
					}
					
					random_list = {
						50 = {
							mult_modifier = {
								factor = 10
								trait = brilliant_strategist
							}
							
							mult_modifier = {
								factor = 5
								trait = skilled_tactician
							}
							
							mult_modifier = {
								factor = 5
								trait = strategist
							}
							
							mult_modifier = {
								factor = 2
								martial >= 32
							}
							
							mult_modifier = {
								factor = 2
								martial >= 28
							}
							
							mult_modifier = {
								factor = 2
								martial >= 24
							}
							
							mult_modifier = {
								factor = 2
								martial >= 20
							}
							
							mult_modifier = {
								factor = 2
								martial >= 16
							}
							
							character_event = { id = soh.4102 days = 6 random = 3 } # Strategy discussion goes well
						}
						
						50 = {
							mult_modifier = {
								factor = 2
								martial < 12
							}
							
							mult_modifier = {
								factor = 2
								martial < 8
							}
							
							mult_modifier = {
								factor = 2
								martial < 4
							}
							
							mult_modifier = {
								factor = 2
								NOR = {
									trait = brilliant_strategist
									trait = skilled_tactician
								}
							}
							
							mult_modifier = {
								factor = 2
								has_education_martial_trigger = no
							}
							
							character_event = { id = soh.4104 days = 6 random = 3 } # Strategy discussion goes poorly
						}
					}
					
					if = {
						limit = {
							tier = duke
							controls_religion = no
						}
						
						any_vassal = {
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									ROOT = {
										primary_title = {
											OR = {
												has_law = status_of_women_3
												has_law = status_of_women_4
											}
										}
									}
									gender_equality_trigger = yes
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							random_list = {
								50 = {
									mult_modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									
									mult_modifier = {
										factor = 5
										trait = skilled_tactician
									}
									
									mult_modifier = {
										factor = 5
										trait = strategist
									}
									
									mult_modifier = {
										factor = 2
										martial >= 32
									}
									
									mult_modifier = {
										factor = 2
										martial >= 28
									}
									
									mult_modifier = {
										factor = 2
										martial >= 24
									}
									
									mult_modifier = {
										factor = 2
										martial >= 20
									}
									
									mult_modifier = {
										factor = 2
										martial >= 16
									}
									
									character_event = { id = soh.4103 days = 6 random = 3 } # Strategy discussion goes well
								}
						
								50 = {
									mult_modifier = {
										factor = 2
										martial < 12
									}
									
									mult_modifier = {
										factor = 2
										martial < 8
									}
									
									mult_modifier = {
										factor = 2
										martial < 4
									}
									
									mult_modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									
									mult_modifier = {
										factor = 2
										has_education_martial_trigger = no
									}
									
									character_event = { id = soh.4105 days = 6 random = 3 } # Strategy discussion goes poorly
								}
							}
						}
					}
					
					else_if = {
						limit = {
							tier = king
							controls_religion = no
						}
						
						any_vassal = {
							count = 2
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									ROOT = {
										primary_title = {
											OR = {
												has_law = status_of_women_3
												has_law = status_of_women_4
											}
										}
									}
									gender_equality_trigger = yes
								}
							}
							
							random_list = {
								50 = {
									mult_modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									
									mult_modifier = {
										factor = 5
										trait = skilled_tactician
									}
									
									mult_modifier = {
										factor = 5
										trait = strategist
									}
									
									mult_modifier = {
										factor = 2
										martial >= 32
									}
									
									mult_modifier = {
										factor = 2
										martial >= 28
									}
									
									mult_modifier = {
										factor = 2
										martial >= 24
									}
									
									mult_modifier = {
										factor = 2
										martial >= 20
									}
									
									mult_modifier = {
										factor = 2
										martial >= 16
									}
									
									character_event = { id = soh.4103 days = 6 random = 3 } # Strategy discussion goes well
								}
						
								50 = {
									mult_modifier = {
										factor = 2
										martial < 12
									}
									
									mult_modifier = {
										factor = 2
										martial < 8
									}
									
									mult_modifier = {
										factor = 2
										martial < 4
									}
									
									mult_modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									
									mult_modifier = {
										factor = 2
										has_education_martial_trigger = no
									}
									
									character_event = { id = soh.4105 days = 6 random = 3 } # Strategy discussion goes poorly
								}
							}
						}
					}
					
					else_if = {
						limit = {
							OR = {
								tier = emperor
								controls_religion = yes
							}
						}
						
						any_vassal = {
							count = 5
							limit = {
								is_adult = yes
								has_character_flag = coming_to_hanami
								OR = {
									is_female = no
									has_education_martial_trigger = yes
									has_lifestyle_martial_trigger = yes
									society_member_of = warriors_of_the_rising_sun
									ROOT = {
										primary_title = {
											OR = {
												has_law = status_of_women_3
												has_law = status_of_women_4
											}
										}
									}
									gender_equality_trigger = yes
								}
							}
							
							random_list = {
								50 = {
									mult_modifier = {
										factor = 10
										trait = brilliant_strategist
									}
									
									mult_modifier = {
										factor = 5
										trait = skilled_tactician
									}
									
									mult_modifier = {
										factor = 5
										trait = strategist
									}
									
									mult_modifier = {
										factor = 2
										martial >= 32
									}
									
									mult_modifier = {
										factor = 2
										martial >= 28
									}
									
									mult_modifier = {
										factor = 2
										martial >= 24
									}
									
									mult_modifier = {
										factor = 2
										martial >= 20
									}
									
									mult_modifier = {
										factor = 2
										martial >= 16
									}
									
									character_event = { id = soh.4103 days = 6 random = 3 } # Strategy discussion goes well
								}
						
								50 = {
									mult_modifier = {
										factor = 2
										martial < 12
									}
									
									mult_modifier = {
										factor = 2
										martial < 8
									}
									
									mult_modifier = {
										factor = 2
										martial < 4
									}
									
									mult_modifier = {
										factor = 2
										NOR = {
											trait = brilliant_strategist
											trait = skilled_tactician
										}
									}
									
									mult_modifier = {
										factor = 2
										has_education_martial_trigger = no
									}
									
									character_event = { id = soh.4105 days = 6 random = 3 } # Strategy discussion goes poorly
								}
							}
						}
					}
				}
				
				25 = {
					trigger = {
						is_adult = yes
					}
					# Go
					any_vassal = {
						limit = {
							has_character_flag = coming_to_hanami
							is_adult = yes
							war = no
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						save_event_target_as = hanami_go_opponent
					}
					
					random_list = {
						50 = {
							mult_modifier = {
								factor = 10
								trait = game_master
								event_target:hanami_go_opponent = {
									NOT = {
										trait = game_master
									}
								}
							}
							
							mult_modifier = {
								factor = 2
								learning >= 32
							}
							
							mult_modifier = {
								factor = 2
								learning >= 28
							}
							
							mult_modifier = {
								factor = 2
								learning >= 24
							}
							
							mult_modifier = {
								factor = 2
								learning >= 20
							}
							
							mult_modifier = {
								factor = 2
								learning >= 16
							}
							
							mult_modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									learning >= 32
								}
							}
							
							mult_modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning >= 28
								}
							}
							
							mult_modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning >= 24
								}
							}
							
							mult_modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning >= 20
								}
							}
							
							mult_modifier = {
								factor = 2
								event_target:hanami_go_opponent = {
									learning >= 16
								}
							}
							
							character_event = { id = soh.4106 days = 6 random = 3 } # Go victory
							
							event_target:hanami_go_opponent = {
								character_event = { id = soh.4107 days = 6 random = 3 } # Go defeat
							}
						}
						
						50 = {
							mult_modifier = {
								factor = 10
								NOT = {
									trait = game_master
								}
								event_target:hanami_go_opponent = {
									trait = game_master
								}
							}
							
							mult_modifier = {
								factor = 2
								learning < 12
							}
							
							mult_modifier = {
								factor = 2
								learning < 8
							}
							
							mult_modifier = {
								factor = 2
								learning < 4
							}
							
							mult_modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									learning < 12
								}
							}
							
							mult_modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									learning < 8
								}
							}
							
							mult_modifier = {
								factor = 0.5
								event_target:hanami_go_opponent = {
									learning < 2
								}
							}
							
							character_event = { id = soh.4108 days = 6 random = 3 } # Go defeat
							
							event_target:hanami_go_opponent = {
								character_event = { id = soh.4109 days = 6 random = 3 } # Go victory
							}
						}
					}
				}
				
				25 = {}
			}
			
			character_event = { id = soh.4110 days = 10 } # Inform liege that the hanami is over
		}
	}
}

### Shirabyoshi events 2

# Attempt to tumble/befriend shirabyoshi?
character_event = {
	id = soh.4022
	desc = EVTDESC_SOH_4022
	picture = GFX_evt_quarrel

	prisoner = no
	war = no
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:troublesome_shirabyoshi = {
				is_alive = yes
			}
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:troublesome_shirabyoshi = {
				is_valid_romance_target = ROOT
				ROOT = {
					is_valid_romance_target = PREV
				}
			}
		}
		
		name = EVTOPTA_SOH_4022 # Yes!
		
		piety = -5
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = soh.4023 days = 1 } # Shirabyoshi chooses how to respond
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:troublesome_shirabyoshi = {
					is_unattractive_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 5
				event_target:troublesome_shirabyoshi = {
					is_attractive_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:troublesome_shirabyoshi = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_duel_bad_sport
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4022 # Try to become friends instead!
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				character_event = { id = soh.4026 days = 1 } # Shirabyoshi chooses how to respond
			}
		}
		
		piety = 5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:troublesome_shirabyoshi = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_duel_bad_sport
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4022 # I don't want to!
		
		ai_chance = {
			factor = 100
			
			trigger = {
				event_target:troublesome_shirabyoshi = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_duel_bad_sport
					}
				}
			}
		}
	}
}

# Tumble?
character_event = {
	id = soh.4023
	desc = EVTDESC_SOH_4023
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4023 # Yes!
		
		#STDs and pregnancy
		unprotected_sex_effect = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = soh.4024 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
					FROM = {
						is_unattractive_trigger = yes
					}
				}
			}
			
			mult_modifier = {
				factor = 10
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4023 # No!
		
		piety = 5
		
		FROM = {
			character_event = { id = soh.4025 }
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 10
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
}

# Got lover
character_event = {
	id = soh.4024
	desc = EVTDESC_SOH_4024
	picture = GFX_evt_lovers

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4024 # Great!
		
		add_lover = FROM
	}
}

# No lover
character_event = {
	id = soh.4025
	desc = EVTDESC_SOH_4025
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4025 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Become friends?
character_event = {
	id = soh.4026
	desc = EVTDESC_SOH_4026
	picture = GFX_evt_quarrel
	
	trigger = {
		is_actually_incapable_trigger = no
		FROMFROM = {
			has_character_modifier = hanami_in_progress
		}
	}

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4026 # Yes!
		
		add_friend = FROM
		
		FROM = {
			character_event = { id = soh.4027 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4026 # I don't need another friend!
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.4028 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
}

# Friends!
character_event = {
	id = soh.4027
	desc = EVTDESC_SOH_4027
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4027 # Great!
		add_friend = FROM
	}
}

# Not friends!
character_event = {
	id = soh.4028
	desc = EVTDESC_SOH_4028
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4028 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Troublesome shirabyoshi gets the chance to try to kill the vassal
character_event = {
	id = soh.4029
	desc = EVTDESC_SOH_4029
	picture = GFX_evt_shadow

	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	immediate = {
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = hanami_duel_bad_sport
				}
			}
			save_event_target_as = shirabyoshi_foe
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4029 # Attempt to kill vassal
		
		pacifists_lose_piety_effect = yes
		
		event_target:shirabyoshi_foe = {
			character_event = { id = soh.4030 } # Vassal is attacked
			
			# GRACETODO
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4029 # Do nothing
		
		prestige = 10
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Vassal being attacked selects response
character_event = {
	id = soh.4030
	desc = EVTDESC_SOH_4030
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4030 # Fight!
		
		hidden_tooltip = {
			random_list = { # TIANXIATODO: Possibly revise with normal duel logic
				50 = {
					mult_modifier = {
						factor = 2
						attribute_diff = {
							who = FROM
							attribute = intrigue
							value >= 4
						}
					}
					
					mult_modifier = {
						factor = 2
						attribute_diff = {
							who = FROM
							attribute = intrigue
							value >= 8
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 10
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 20
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 30
						}
					}
					
					mult_modifier = {
						factor = 2
						combat_rating_diff = {
							who = FROM
							value >= 40
						}
					}
					
					random_list = {
						70 = {
							trigger = {
								combat_rating >= 25
							}
							
							character_event = { id = soh.4035 days = 1} # Victory, no wounds
						}
						
						20 = {
							trigger = {
								combat_rating < 75
							}
							
							mult_modifier = {
								factor = 0.1
								combat_rating >= 50
							}
							
							character_event = { id = soh.4037 days = 1} # Victory - wounded
						}
						
						10 = {
							trigger = {
								combat_rating < 25
							}
							
							character_event = { id = soh.4039 days = 1} # Victory - maimed
						}
					}
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						FROM = {
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 4
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 8
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 10
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 20
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 30
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							combat_rating_diff = {
								who = ROOT
								value >= 40
							}
						}
					}
					
					random_list = {
						70 = {
							trigger = {
								FROM = {
									combat_rating >= 25
								}
							}
						}
						
						20 = {
							trigger = {
								FROM = {
									combat_rating < 75
								}
							}
							
							mult_modifier = {
								factor = 0.1
								FROM = {
									combat_rating >= 50
								}
							}
							
							FROM = {
								add_trait_wounded_effect = yes
								set_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
							}
						}
						
						10 = {
							trigger = {
								FROM = {
									combat_rating < 25
								}
							}
							
							FROM = {
								add_maimed_trait_effect = yes
								set_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
							}
						}
					}
					
					character_event = { id = soh.4041 days = 1} # Died
				}
			}
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4030 # Flee
		
		prestige = -10
		
		hidden_tooltip = {
			random_list = {
				50 = {
					mult_modifier = {
						factor = 2
						attribute_diff = {
							who = FROM
							attribute = intrigue
							value >= 4
						}
					}
					
					mult_modifier = {
						factor = 2
						attribute_diff = {
							who = FROM
							attribute = intrigue
							value >= 8
						}
					}
					
					character_event = { id = soh.4031 days = 1 } # Survived
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						FROM = {
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 4
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						FROM = {
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 8
							}
						}
					}
					
					character_event = { id = soh.4033 days = 1 } # Died
				}
			}
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			
			mult_modifier = {
				factor = 100
				trait = craven
			}
		}
	}
}

# Fled and lived
character_event = {
	id = soh.4031
	desc = EVTDESC_SOH_4031
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4031 # Phew!
		
		FROMFROMFROM = {
			character_event = { id = soh.4032 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4032
	desc = EVTDESC_SOH_4032
	picture = GFX_evt_emissary

	only_rulers = yes
	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	immediate = {
		event_target:troublesome_shirabyoshi = {
			leave_court_and_die_effect = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4032 # I see...
	}
}

# Fled and died
character_event = {
	id = soh.4033
	desc = EVTDESC_SOH_4033
	picture = GFX_evt_shadow

	capable_only = yes
	prisoner = no
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4033 # NOOOO!
		
		if = {
			limit = {
				liege = {
					intrigue < 16
				}
				NOT = {
					event_target:troublesome_shirabyoshi = {
						has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
					}
				}
			}
			
			death = {
				death_reason = death_murder_unknown
				killer = event_target:troublesome_shirabyoshi
			}
		}
		
		else = {
			death = {
				death_reason = death_murder
				killer = event_target:troublesome_shirabyoshi
			}
			
			hidden_tooltip = {
				save_event_target_as = target_victim
				event_target:troublesome_shirabyoshi = { character_event = { id = 10 } } # Consequences of discovery
				clear_event_target = target_victim
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = soh.4034 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4034
	desc = EVTDESC_SOH_4034
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				intrigue >= 8
				event_target:troublesome_shirabyoshi = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		
		name = EVTOPTA_SOH_4034 # Who could have done this?
	}
	
	option = {
		trigger = {
			intrigue >= 8
			NOR = {
				intrigue >= 16
				event_target:troublesome_shirabyoshi = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		
		name = EVTOPTB_SOH_4034 # I have my suspicions...
		
		opinion = {
			who = event_target:troublesome_shirabyoshi
			modifier = opinion_acting_suspicious
		}
	}
	
	option = {
		trigger = {
			OR = {
				intrigue >= 16
				event_target:troublesome_shirabyoshi = {
					has_character_flag = shirabyoshi_wounded_maimed # Can't hide from liege
				}
			}
		}
		
		name = EVTOPTC_SOH_4034 # I know who did this!
		
		opinion = {
			who = event_target:troublesome_shirabyoshi
			modifier = opinion_dishonorable
		}
	}
}

# Fought and lived
character_event = {
	id = soh.4035
	desc = EVTDESC_SOH_4035
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4035 # Phew!
		
		add_one_duel_experience_modifier = yes
		
		FROMFROM = {
			# GRACETODO
			
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		FROMFROMFROM = {
			character_event = { id = soh.4036 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4036
	desc = EVTDESC_SOH_4036
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4036 # I see...
	}
}

# Fought and lived - wounded
character_event = {
	id = soh.4037
	desc = EVTDESC_SOH_4037
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4037 # 'Tis but a scratch!
		
		add_one_duel_experience_modifier = yes
		
		FROMFROM = {
			# GRACETODO
			
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		add_trait_wounded_effect = yes
		
		FROMFROMFROM = {
			character_event = { id = soh.4038 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4038
	desc = EVTDESC_SOH_4038
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4038 # I see...
	}
}

# Fought and lived - maimed
character_event = {
	id = soh.4039
	desc = EVTDESC_SOH_4039
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4039 # At least I still live...
		
		add_one_duel_experience_modifier = yes
		
		FROMFROM = {
			# GRACETODO
			
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		add_maimed_trait_effect = yes
		
		FROMFROMFROM = {
			character_event = { id = soh.4040 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4040
	desc = EVTDESC_SOH_4040
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4040 # I see...
	}
}

# Fought and died
character_event = {
	id = soh.4041
	desc = EVTDESC_SOH_4041
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4041 # NOOOO!
		
		death = {
			death_reason = death_duel
			killer = event_target:troublesome_shirabyoshi
		}
		
		FROMFROMFROM = {
			add_one_duel_experience_modifier = yes
			
			character_event = { id = soh.4042 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4042
	desc = EVTDESC_SOH_4042
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	immediate = {
		event_target:troublesome_shirabyoshi = {
			leave_court_effect = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4042 # I see...
	}
}

# Vassal - attack shirabyoshi?
character_event = {
	id = soh.4043
	desc = EVTDESC_SOH_4043
	picture = GFX_evt_shadow

	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
		event_target:troublesome_shirabyoshi = {
			has_opinion_modifier = {
				who = ROOT
				modifier = hanami_duel_bad_sport
			}
			is_landed = no
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4043 # Attempt to kill shirabyoshi
		
		pacifists_lose_piety_effect = yes
		
		event_target:troublesome_shirabyoshi = {
			hidden_tooltip = {
				random_list = { # TIANXIATODO: Replace with actual duel logic?
					50 = {
						mult_modifier = {
							factor = 2
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 4
							}
						}
						
						mult_modifier = {
							factor = 2
							attribute_diff = {
								who = ROOT
								attribute = intrigue
								value >= 8
							}
						}
						
						mult_modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value >= 10
							}
						}
						
						mult_modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value >= 20
							}
						}
						
						mult_modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value >= 30
							}
						}
						
						mult_modifier = {
							factor = 2
							combat_rating_diff = {
								who = ROOT
								value >= 40
							}
						}
						
						random_list = {
							70 = {
								trigger = {
									combat_rating >= 25
								}
									
								ROOT = {
									character_event = { id = soh.4048 days = 1} # Died, shirabyoshi unharmed
								}
							}
							
							20 = {
								trigger = {
									combat_rating < 75
								}
								
								mult_modifier = {
									factor = 0.1
									combat_rating >= 50
								}
								
								add_trait_wounded_effect = yes
								
								ROOT = {
									character_event = { id = soh.4049 days = 1} # Died, shirabyoshi wounded
								}
							}
							
							10 = {
								trigger = {
									combat_rating < 25
								}
								
								add_maimed_trait_effect = yes
								
								ROOT = {
									character_event = { id = soh.4050 days = 1} # Died, shirabyoshi maimed
								}
							}
						}
					}
					
					50 = {
						mult_modifier = {
							factor = 2
							ROOT = {
								attribute_diff = {
									who = PREV
									attribute = intrigue
									value >= 4
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							ROOT = {
								attribute_diff = {
									who = PREV
									attribute = intrigue
									value >= 8
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value >= 10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value >= 20
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value >= 30
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							ROOT = {
								combat_rating_diff = {
									who = PREV
									value >= 40
								}
							}
						}
						
						random_list = {
							70 = {
								trigger = {
									ROOT = {
										combat_rating >= 25
									}
								}
								
								ROOT = {
									character_event = { id = soh.4044 days = 1} # Victory, no wounds
								}
							}
							
							20 = {
								trigger = {
									ROOT = {
										combat_rating < 75
									}
								}
								
								mult_modifier = {
									factor = 0.1
									ROOT = {
										combat_rating >= 50
									}
								}
								
								ROOT = {
									character_event = { id = soh.4045 days = 1} # Victory - wounded
								}
							}
							
							10 = {
								trigger = {
									ROOT = {
										combat_rating < 25
									}
								}
								
								ROOT = {
									character_event = { id = soh.4046 days = 1} # Victory - wounded
								}
							}
						}
					}
				}
			}
		}
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4043 # Do nothing
		
		prestige = 10
		
		ai_chance = {
			factor = 50
			
			mult_modifier = {
				factor = 1000
				has_character_flag = hanami_shirabyoshi_duel_hold_back
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Killed shirabyoshi
character_event = {
	id = soh.4044
	desc = EVTDESC_SOH_4044
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4044 # Good riddance!
		
		prestige = 100
		
		add_one_duel_experience_modifier = yes
		
		event_target:troublesome_shirabyoshi = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		liege = {
			character_event = { id = soh.4047 } # Inform liege
		}
	}
}

# Killed shirabyoshi - wounded
character_event = {
	id = soh.4045
	desc = EVTDESC_SOH_4045
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4045 # 'Tis but a scratch!
		
		add_one_duel_experience_modifier = yes
		
		event_target:troublesome_shirabyoshi = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		add_trait_wounded_effect = yes
		
		liege = {
			character_event = { id = soh.4047 } # Inform liege
		}
	}
}

# Killed shirabyoshi - maimed
character_event = {
	id = soh.4046
	desc = EVTDESC_SOH_4046
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4046 # At least I still live...
		
		add_one_duel_experience_modifier = yes
		
		event_target:troublesome_shirabyoshi = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		add_maimed_trait_effect = yes
		
		liege = {
			character_event = { id = soh.4047 } # Inform liege
		}
	}
}

# Inform liege
character_event = {
	id = soh.4047
	desc = EVTDESC_SOH_4047
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4047 # I see...
	}
}

# Killed by shirabyoshi
character_event = {
	id = soh.4048
	desc = EVTDESC_SOH_4048
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4048 # NOOO!
		
		event_target:troublesome_shirabyoshi = {
			# GRACETODO
			
			ROOT = {
				death = {
					death_reason = death_duel
					killer = event_target:troublesome_shirabyoshi
				}
			}
		
			add_one_duel_experience_modifier = yes
		}
		
		FROMFROMFROM = {
			character_event = { id = soh.4051 } # Inform liege
		}
	}
}

# Killed by shirabyoshi - shirabyoshi wounded
character_event = {
	id = soh.4049
	desc = EVTDESC_SOH_4049
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4049 # NOOO!
		
		event_target:troublesome_shirabyoshi = {
			# GRACETODO
			
			ROOT = {
				death = {
					death_reason = death_duel
					killer = event_target:troublesome_shirabyoshi
				}
			}
		
			add_one_duel_experience_modifier = yes
		}
		
		FROMFROMFROM = {
			character_event = { id = soh.4051 } # Inform liege
		}
	}
}

# Killed by shirabyoshi - shirabyoshi maimed
character_event = {
	id = soh.4050
	desc = EVTDESC_SOH_4050
	picture = GFX_evt_shadow
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4050 # NOOO!
		
		event_target:troublesome_shirabyoshi = {
			# GRACETODO
			
			ROOT = {
				death = {
					death_reason = death_duel
					killer = event_target:troublesome_shirabyoshi
				}
			}
		
			add_one_duel_experience_modifier = yes
		}
		
		FROMFROMFROM = {
			character_event = { id = soh.4051 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4051
	desc = EVTDESC_SOH_4051
	picture = GFX_evt_emissary
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4051 # She was only defending herself!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_outraged
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.4052 } # Vassals informed
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					dynasty = FROM
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4051 # Get out of my sight!
		
		event_target:troublesome_shirabyoshi = {
			leave_court_effect = yes
			opinion = {
				who = ROOT
				modifier = opinion_upset
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_upset
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.4053 } # Vassals informed
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOT = {
					dynasty = FROM
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4051 # Seize her!
		
		event_target:troublesome_shirabyoshi = {
			imprison = yes
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = soh.4054 } # Vassals informed
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NAND = {
					OR = {
						trait = just
						trait = kind
					}
					NOT = {
						dynasty = FROM
					}
				}
			}
		}
	}
}

# Vassals informed - shirabyoshi remains free
character_event = {
	id = soh.4052
	desc = EVTDESC_SOH_4052
	picture = GFX_evt_scandal

	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4052 # Why is she free?
	}
}

# Vassals informed - shirabyoshi banished
character_event = {
	id = soh.4053
	desc = EVTDESC_SOH_4053
	picture = GFX_evt_scandal

	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4053 # Why is she free?
	}
}

# Vassals informed - shirabyoshi imprisoned
character_event = {
	id = soh.4054
	desc = EVTDESC_SOH_4054
	picture = GFX_evt_into_the_dungeon

	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4054 # Good!
	}
}

# Female dynasty member taught to fight
character_event = {
	id = soh.4055
	desc = EVTDESC_SOH_4055
	picture = GFX_evt_courtiers_talking

	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:troublesome_shirabyoshi = {
				is_alive = yes
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4055 # I have a new best friend!
		
		if = {
			limit = {
				NOT = {
					lifestyle_traits >= 1
				}
			}
			
			add_trait = duelist
		}
		
		add_one_duel_experience_modifier = yes
		
		FROM = {
			event_target:troublesome_shirabyoshi = {
				add_friend = ROOT
			}
		}
		
		FROM = {
			character_event = { id = soh.4056 }
		}
	}
}

# Inform liege
character_event = {
	id = soh.4056
	desc = EVTDESC_SOH_4056
	picture = GFX_evt_courtiers_talking

	only_rulers = yes
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4056 # I see...
	}
}


# Attempt to tumble/befriend shirabyoshi?
character_event = {
	id = soh.4057
	desc = EVTDESC_SOH_4057
	picture = GFX_evt_quarrel

	prisoner = no
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
		event_target:remarkable_shirabyoshi = {
			is_alive = yes
		}
	}

	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:remarkable_shirabyoshi = {
				is_valid_romance_target = ROOT
				ROOT = {
					is_valid_romance_target = PREV
				}
			}
		}
		
		name = EVTOPTA_SOH_4057 # Yes!
		
		piety = -5
		
		event_target:remarkable_shirabyoshi = {
			character_event = { id = soh.4058 days = 1 } # Shirabyoshi chooses how to respond
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:remarkable_shirabyoshi = {
					is_unattractive_trigger = yes
				}
			}
			
			mult_modifier = {
				factor = 5
				event_target:remarkable_shirabyoshi = {
					is_attractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4057 # Try to become friends instead!
		
		event_target:remarkable_shirabyoshi = {
			character_event = { id = soh.4061 days = 1 } # Shirabyoshi chooses how to respond
		}
		
		piety = 5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
			
			mult_modifier = {
				factor = 0.1
				event_target:remarkable_shirabyoshi = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hanami_duel_bad_sport
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_4057 # I don't want to!
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
		}
	}
}

# Tumble?
character_event = {
	id = soh.4058
	desc = EVTDESC_SOH_4058
	picture = GFX_evt_quarrel

	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4058 # Yes!
		
		unprotected_sex_effect = yes
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = soh.4059 }
		}
		
		piety = -5
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
					AND = {
						is_ascetic_trigger = yes
						NOT = {
							trait = lustful
						}
					}
					FROM = {
						is_unattractive_trigger = yes
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4058 # No!
		
		piety = 5
		
		FROM = {
			character_event = { id = soh.4060 }
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				NOR = {
					trait = lustful
					trait = master_seducer
					trait = master_seductress
				}
			}
		}
	}
}

# Got lover
character_event = {
	id = soh.4059
	desc = EVTDESC_SOH_4059
	picture = GFX_evt_lovers

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4059 # Great!
		
		add_lover = FROM
	}
}

# No lover
character_event = {
	id = soh.4060
	desc = EVTDESC_SOH_4060
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4060 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Become friends?
character_event = {
	id = soh.4061
	desc = EVTDESC_SOH_4061
	picture = GFX_evt_quarrel

	prisoner = no

	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4061 # Yes!
		
		add_friend = FROM
		
		FROM = {
			character_event = { id = soh.4062 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_bad_sport
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4061 # I don't need another friend!
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.4063 }
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				has_opinion_modifier = {
					who = FROM
					modifier = hanami_duel_good_sport
				}
			}
		}
	}
}

# Friends!
character_event = {
	id = soh.4062
	desc = EVTDESC_SOH_4062
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4062 # Great!
		add_friend = FROM
	}
}

# Not friends!
character_event = {
	id = soh.4063
	desc = EVTDESC_SOH_4063
	picture = GFX_evt_quarrel

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4063 # Damn!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Remarkable shirabyoshi keeps on impressing people
character_event = {
	id = soh.4064
	desc = EVTDESC_SOH_4064
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4064 # Great!
		
		prestige = 50
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.4065 } # Inform vassals
			}
		}
	}
}

# Remarkable shirabyoshi - vassal
character_event = {
	id = soh.4065
	desc = EVTDESC_SOH_4065
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4065 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Shirabyoshi perform well
character_event = {
	id = soh.4066
	desc = EVTDESC_SOH_4066
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4066 # Good!
		
		prestige = 10
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.4067 } # Inform vassal
			}
		}
	}
}

# Shirabyoshi perform well - vassal
character_event = {
	id = soh.4067
	desc = EVTDESC_SOH_4067
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4067 # She's good!
		
		opinion = {
			who = FROM
			modifier = good_hanami
			months = 12
		}
	}
}

# Vassal insulted by shirabyoshi
character_event = {
	id = soh.4068
	desc = EVTDESC_SOH_4068
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4068 # How rude!
		
		FROM = {
			character_event = { id = soh.4069 days = 1 } # Inform liege
		}
	}
}

# Liege informed
character_event = {
	id = soh.4069
	desc = EVTDESC_SOH_4069
	picture = GFX_evt_emissary

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4069 # Throw them out!
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.4070 } # Inform vassal
			
			opinion = {
				who = ROOT
				modifier = good_hanami
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				opinion = {
					who = FROM
					value >= -25
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4069 # I don't care!
		
		FROM = {
			character_event = { id = soh.4071 } # Inform vassal
			
			opinion = {
				who = ROOT
				modifier = bad_hanami
				months = 12
			}
		}
		
		ai_chance = {
			factor = 50
			
			trigger = {
				opinion = {
					who = FROM
					value < 25
				}
			}
		}
	}
}

# Shirabyoshi thrown out
character_event = {
	id = soh.4070
	desc = EVTDESC_SOH_4070
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4070 # Good!
	}
}

# Shirabyoshi allowed to stay
character_event = {
	id = soh.4071
	desc = EVTDESC_SOH_4071
	picture = GFX_evt_feast

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4071 # I don't like it!
	}
}

### Daytime events 2

# Become friends?
character_event = {
	id = soh.4072
	desc = EVTDESC_SOH_4072
	picture = GFX_evt_children_talking

	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_child_friend_rival = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = no
				prisoner = no
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4072 # I should speak more with X!
		FROM = {
			event_target:hanami_child_friend_rival = {
				character_event = { id = soh.4073 days = 1 }
			}
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4072 # I don't need another friend!
		
		prestige = -5
	}
}

# Become friends?
character_event = {
	id = soh.4073
	desc = EVTDESC_SOH_4073
	picture = GFX_evt_children_talking

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4073 # I should speak more with X!
		
		add_friend = FROM
		
		FROM = {
			character_event = { id = soh.4074 }
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4073 # I don't need another friend!
		
		prestige = -5
		
		FROM = {
			character_event = { id = soh.4074 }
		}
	}
}

# Inform FROM
character_event = {
	id = soh.4074
	
	desc = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		text = EVTDESCA_SOH_4074
	}
	
	desc = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_SOH_4074
	}
	
	picture = GFX_evt_children_talking

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_friend = {
				character = FROM
			}
		}
		
		name = EVTOPTA_SOH_4074 # Good!
		
		add_friend = FROM
	}
	
	option = {
		trigger = {
			NOT = {
				any_friend = {
					character = FROM
				}
			}
		}
		
		name = EVTOPTB_SOH_4074 # Rude!
		
		opinion = {
			who = FROM
			modifier = opinion_upset
			months = 12
		}
	}
}

# Become rivals?
character_event = {
	id = soh.4075
	desc = EVTDESC_SOH_4075
	picture = GFX_evt_child_play
	
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
			event_target:hanami_child_friend_rival = {
				is_alive = yes
				is_inaccessible_or_incapable_trigger = yes
				prisoner = no
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4075 # They'd better apologize!
		FROM = {
			event_target:hanami_child_friend_rival = {
				character_event = { id = soh.4076 days = 1 }
			}
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4075 # Let's not make matters worse...
		
		prestige = -10
	}
}

# Become rivals?
character_event = {
	id = soh.4076
	desc = EVTDESC_SOH_4076
	picture = GFX_evt_child_play

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4076 # I hate you too!
		
		add_rival = FROM
		
		# GRACETODO
		
		FROM = {
			character_event = { id = soh.4077 }
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4076 # Let's make amends...
		
		prestige = -10
		
		FROM = {
			character_event = { id = soh.4077 }
		}
	}
}

# Inform FROM
character_event = {
	id = soh.4077
	
	desc = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		text = EVTDESCA_SOH_4077
	}
	
	desc = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		text = EVTDESCB_SOH_4077
	}
	
	picture = GFX_evt_child_play

	is_triggered_only = yes
	
	option = {
		trigger = {
			any_rival = {
				character = FROM
			}
		}
		
		name = EVTOPTA_SOH_4077 # You're going down!
		
		add_rival = FROM
		
		# GRACETODO
	}
	
	option = {
		trigger = {
			NOT = {
				any_rival = {
					character = FROM
				}
			}
		}
		
		name = EVTOPTB_SOH_4077 # Very well!
		
		opinion = {
			who = FROM
			modifier = opinion_glad
			months = 12
		}
	}
}

# The weather worsens
character_event = {
	id = soh.4078
	desc = EVTDESC_SOH_4078
	picture = GFX_evt_feast

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4078 # I should have picked a better day!
		
		prestige = -10
	}
}

### Nighttime events 2

# A wild fireworks merchant appears!
character_event = {
	id = soh.4079
	desc = EVTDESC_SOH_4079
	picture = GFX_evt_emissary

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			wealth >= 10
		}
		
		name = EVTOPTA_SOH_4079 # Give me some small ones!
		
		wealth = -10
		
		character_event = { id = soh.4080 days = 1 } # Small fireworks
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		trigger = {
			wealth >= 25
		}
		
		name = EVTOPTB_SOH_4079 # Give me some medium ones!
		
		wealth = -25
		
		random_list = {
			90 = {
				character_event = { id = soh.4082 days = 1 } # Medium fireworks - all is well
			}
			
			10 = {
				trigger = {
					learning < 16
				}
				
				mult_modifier = {
					factor = 0.1
					learning = 8
				}
				
				character_event = { id = soh.4084 days = 1 } # Medium fireworks - maimed
			}
		}
		
		ai_chance = {
			factor = 25
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				NOR = {
					trait = lunatic
					trait = possessed
					trait = imbecile
					learning >= 8
				}
			}
		}
	}
	
	option = {
		trigger = {
			wealth >= 100
		}
		
		name = EVTOPTC_SOH_4079 # Give me the biggest fireworks you have!
		
		wealth = -100
		
		random_list = {
			80 = {
				character_event = { id = soh.4086 days = 1 } # Huge fireworks - all is well
			}
			
			15 = {
				mult_modifier = {
					factor = 0.1
					learning >= 32
				}
				
				mult_modifier = {
					factor = 0.1
					learning >= 24
				}
				
				mult_modifier = {
					factor = 0.1
					learning <= 16
				}
				
				character_event = { id = soh.4088 days = 1 } # Huge fireworks - maimed
			}
			
			4 = {
				mult_modifier = {
					factor = 0.1
					learning >= 28
				}
				
				mult_modifier = {
					factor = 0.1
					learning >= 20
				}
				
				mult_modifier = {
					factor = 0.1
					learning >= 12
				}
				
				any_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = fireworks_victim
				}
				
				character_event = { id = soh.4090 days = 1 } # Huge fireworks - bystander killed
			}
			
			1 = {
				mult_modifier = {
					factor = 0.1
					learning >= 24
				}
				
				mult_modifier = {
					factor = 0.1
					learning >= 16
				}
				
				mult_modifier = {
					factor = 0.1
					learning >= 8
				}
				
				any_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = fireworks_victim
				}
				
				any_courtier = {
					limit = {
						prisoner = no
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							character = event_target:fireworks_victim
						}
					}
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = fireworks_victim_2
				}
				
				random = {
					chance = 50
					
					any_courtier = {
						limit = {
							prisoner = no
							is_inaccessible_or_incapable_trigger = no
							NOR = {
								character = event_target:fireworks_victim
								character = event_target:fireworks_victim_2
							}
						}
						score_value = { #Prioritizes selecting an interesting courtier...
							value = 10
							interesting_courtier_selection_score = yes
						}
						
						save_event_target_as = fireworks_victim_3
					}
					
					random = {
						chance = 50
						
						any_courtier = {
							limit = {
								prisoner = no
								is_inaccessible_or_incapable_trigger = no
								NOR = {
									character = event_target:fireworks_victim
									character = event_target:fireworks_victim_2
									character = event_target:fireworks_victim_3
								}
							}
							score_value = { #Prioritizes selecting an interesting courtier...
								value = 10
								interesting_courtier_selection_score = yes
							}
							
							save_event_target_as = fireworks_victim_4
						}
						
						random = {
							chance = 50
							
							any_courtier = {
								limit = {
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
									NOR = {
										character = event_target:fireworks_victim
										character = event_target:fireworks_victim_2
										character = event_target:fireworks_victim_3
										character = event_target:fireworks_victim_4
									}
								}
								score_value = { #Prioritizes selecting an interesting courtier...
									value = 10
									interesting_courtier_selection_score = yes
								}
								
								save_event_target_as = fireworks_victim_5
							}
						}
					}
				}
				
				narrative_event = { id = soh.4093 days = 1 } # Huge fireworks - catastrophe
			}
		}
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NOR = {
					trait = greedy
					trait = craven
				}
			}
			
			modifier = {
				factor = 0.1
				NOR = {
					trait = lunatic
					trait = possessed
					trait = imbecile
					learning >= 16
				}
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_4079 # I can't afford this!
		
		prestige = -10
		
		ai_chance = {
			factor = 25
			
			trigger = {
				NAND = {
					wealth >= 10
					NOT = {
						trait = greedy
					}
				}
			}
		}
	}
}

# Small fireworks
character_event = {
	id = soh.4080
	desc = EVTDESC_SOH_4080
	picture = GFX_evt_comet
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4080 # That was nice!
		
		prestige = 10
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			
			character_event = { id = soh.4081 }
		}
	}
}

# Small fireworks - vassals
character_event = {
	id = soh.4081
	desc = EVTDESC_SOH_4081
	picture = GFX_evt_comet

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4081 # That was nice!
	}
}

# Medium fireworks - all is well
character_event = {
	id = soh.4082
	desc = EVTDESC_SOH_4082
	picture = GFX_evt_comet
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4082 # That was nice!
		
		prestige = 25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			
			character_event = { id = soh.4083 }
		}
	}
}

# Medium fireworks - all is well - vassals
character_event = {
	id = soh.4083
	desc = EVTDESC_SOH_4083
	picture = GFX_evt_comet

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4083 # That was nice!
	}
}

# Medium fireworks - maimed
character_event = {
	id = soh.4084
	desc = EVTDESC_SOH_4084
	picture = GFX_evt_shadowy_cabal
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4084 # Ow!
		
		add_maimed_trait_effect = yes
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			
			character_event = { id = soh.4085 }
		}
	}
}

# Medium fireworks - maimed - vassals
character_event = {
	id = soh.4085
	desc = EVTDESC_SOH_4085
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4085 # Play with fire...
	}
}

# Huge fireworks - all is well
character_event = {
	id = soh.4086
	desc = EVTDESC_SOH_4086
	picture = GFX_evt_comet
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4086 # A most impressive display!
		
		prestige = 100
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_hanami
			}
			
			opinion = {
				who = ROOT
				modifier = good_hanami
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.4087 }
			}
		}
	}
}

# Huge fireworks - all is well - vassals
character_event = {
	id = soh.4087
	desc = EVTDESC_SOH_4087
	picture = GFX_evt_comet

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4087 # A most impressive display!
	}
}

# Huge fireworks - maimed
character_event = {
	id = soh.4088
	desc = EVTDESC_SOH_4088
	picture = GFX_evt_shadowy_cabal
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4088 # Ow!
		
		add_maimed_trait_effect = yes
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			
			character_event = { id = soh.4089 }
		}
	}
}

# Huge fireworks - maimed - vassals
character_event = {
	id = soh.4089
	desc = EVTDESC_SOH_4089
	picture = GFX_evt_shadowy_cabal

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4089 # Play with fire...
	}
}

# Huge fireworks - dead bystander
character_event = {
	id = soh.4090
	desc = EVTDESC_SOH_4090
	picture = GFX_evt_death
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
		event_target:fireworks_victim = {
			is_alive = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4090 # Oh no!
		
		prestige = -100
		
		pacifists_lose_piety_effect = yes
		
		show_portrait = event_target:fireworks_victim
		
		# GRACETODO
		
		event_target:fireworks_victim = {
			character_event = { id = soh.4091 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			character_event = { id = soh.4092 }
		}
	}
}

# Huge fireworks - dead bystanders - target
character_event = {
	id = soh.4091
	desc = EVTDESC_SOH_4091
	picture = GFX_evt_death
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4091 # No!
		
		death = {
			death_reason = death_accident
			killer = FROM
		}
	}
}

# Huge fireworks - dead bystander - vassals
character_event = {
	id = soh.4092
	desc = EVTDESC_SOH_4092
	picture = GFX_evt_death

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4092 # This is bad!
	}
}

# Huge fireworks - catastrophe
narrative_event = {
	id = soh.4093
	title = EVTTITLE_SOH_4093
	desc = EVTDESC_SOH_4093
	picture = GFX_evt_irminsul_burning
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4093 # This is a disaster!
		
		prestige = -500
		
		pacifists_lose_piety_effect = yes
		
		capital_holding = {
			destroy_random_building = yes
			random = {
				chance = 50
				destroy_random_building = yes
				random = {
					chance = 50
					destroy_random_building = yes
					random = {
						chance = 50
						destroy_random_building = yes
						random = {
							chance = 50
							destroy_random_building = yes
						}
					}
				}
			}
		}
		
		show_portrait = event_target:fireworks_victim
		show_portrait = event_target:fireworks_victim_2
		show_portrait = event_target:fireworks_victim_3
		show_portrait = event_target:fireworks_victim_4
		show_portrait = event_target:fireworks_victim_5
		
		capital_scope = {
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				increase_depopulation_effect = yes
			}
			add_province_modifier = {
				name = peasants_upset
				duration = 3650
			}
		}
		
		# GRACETODO
		
		event_target:fireworks_victim = {
			character_event = { id = soh.4091 }
		}
		
		event_target:fireworks_victim_2 = {
			character_event = { id = soh.4091 }
		}
		
		event_target:fireworks_victim_3 = {
			character_event = { id = soh.4091 }
		}
		
		event_target:fireworks_victim_4 = {
			character_event = { id = soh.4091 }
		}
		
		event_target:fireworks_victim_5 = {
			character_event = { id = soh.4091 }
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_hanami
			}
			
			narrative_event = { id = soh.4094 }
		}
	}
}

# Huge fireworks - catastrophe - vassals
narrative_event = {
	id = soh.4094
	title = EVTTITLE_SOH_4094
	desc = EVTDESC_SOH_4094
	picture = GFX_evt_irminsul_burning
	border = GFX_event_narrative_frame_diplomacy

	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
	}
	
	option = {
		name = EVTOPTA_SOH_4094 # What was FROM thinking?
	}
}

# Comet sighted!
character_event = {
	id = soh.4095
	desc = EVTDESC_SOH_4095
	picture = GFX_evt_comet
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4095
		
		prestige = -1
		
		custom_tooltip = {
			text = EVTTOOLTIP_SOH_4095 # Lose 1 Stability (no actual effect)
		}
	}
}

# Fall in love with spouse
character_event = {
	id = soh.4097
	desc = EVTDESC_SOH_4097
	picture = GFX_evt_comet
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4097 # This is love!
		
		spouse = {
			add_lover = ROOT
		}
	}
}

# Befriend child
character_event = {
	id = soh.4098
	desc = EVTDESC_SOH_4098
	picture = GFX_evt_comet
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	immediate = {
		any_child = {
			limit = {
				prisoner = no
				is_inaccessible_or_incapable_trigger = no
				host = {
					character = ROOT
				}
				NOR = {
					is_friend = ROOT
					is_rival = ROOT
				}
				opinion = {
					who = ROOT
					value >= 0
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			
			save_event_target_as = hanami_child_friend
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4098 # Sounds good!
		
		event_target:hanami_child_friend = {
			add_friend = ROOT
		}
	}
}

# Calm, uneventful night
character_event = {
	id = soh.4099
	desc = EVTDESC_SOH_4099
	picture = GFX_evt_comet
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4099 # Just enjoy the view
		
		prestige = 10
	}
}

### Misc events 2

# Sword practice
character_event = {
	id = soh.4100
	desc = EVTDESC_SOH_4100
	picture = GFX_evt_feast
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4100 # Let's do it!
		
		random_list = {
			25 = {
				trigger = {
					NOR = {
						trait = brave
						trait = craven
					}
				}
				
				set_character_flag = hanami_brave
			}
			
			25 = {
				trigger = {
					trait = craven
				}
				
				set_character_flag = hanami_not_craven
			}
			
			100 = {
				set_character_flag = hanami_prestige
			}
			
			25 = {
				trigger = {
					combat_rating < 50
				}
				
				set_character_flag = hanami_wounded
			}
			25 = {
				trigger = {
					lifestyle_traits < 1
					combat_rating >= 50
				}
				
				set_character_flag = hanami_duelist
			}
		}
		
		character_event = { id = soh.4101 days = 1 }
	}
}

# Reveal outcome
character_event = {
	id = soh.4101
	picture = GFX_evt_feast
	desc = {
		trigger = {
			has_character_flag = hanami_brave
		}
		text = EVTDESCA_SOH_4101
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_not_craven
		}
		text = EVTDESCB_SOH_4101
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_prestige
		}
		text = EVTDESCC_SOH_4101
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_wounded
		}
		text = EVTDESCD_SOH_4101
	}
	
	desc = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		text = EVTDESCE_SOH_4101
	}
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROMFROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_brave
		}
		
		name = EVTOPTA_SOH_4101 # Good!
		
		add_trait_brave_effect = yes
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_not_craven
		}
		
		name = EVTOPTB_SOH_4101 # Good!
		
		remove_trait_craven_effect = yes
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_prestige
		}
		
		name = EVTOPTC_SOH_4101 # Not good!
		
		prestige = -10
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_wounded
		}
		
		name = EVTOPTD_SOH_4101 # Ow!
		
		add_trait_wounded_effect = yes
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		
		name = EVTOPTE_SOH_4101 # Yes!
		
		add_trait = duelist
	}
	
	option = {
		trigger = {
			has_character_flag = hanami_duelist
		}
		
		name = EVTOPTF_SOH_4101 # No!
		
		prestige = 25
	}
}

# Strategy discussion went well
character_event = {
	id = soh.4102
	desc = EVTDESC_SOH_4102
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		trigger = {
			has_education_martial_trigger = yes
			NOT = {
				trait = brilliant_strategist
			}
		}
		
		name = EVTOPTA_SOH_4102 # Excellent!
		
		upgrade_education_effect = yes
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		remove_all_education_traits_effect = yes
		
		add_trait = misguided_warrior
		
		name = EVTOPTB_SOH_4102 # This is the future!
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTC_SOH_4102 # I'll just have the glory!
		
		prestige = 25
	}
	
	
	option = {
		trigger = {
			has_education_martial_trigger = no
			NOR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTD_SOH_4102 # Great!
		
		prestige = 25
	}
	
	option = {
		trigger = {
			trait = brilliant_strategist
		}
		
		name = EVTOPTE_SOH_4102 # Great!
		
		prestige = 50
	}
}

# Vassal gets good event
character_event = {
	id = soh.4103
	desc = EVTDESC_SOH_4103
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		trigger = {
			has_education_martial_trigger = yes
			NOT = {
				trait = brilliant_strategist
			}
		}
		
		name = EVTOPTA_SOH_4103 # Good news!
		
		if = {
			limit = {
				trait = skilled_tactician
			}
			add_trait = brilliant_strategist
		}
		if = {
			limit = {
				trait = tough_soldier
			}
			add_trait = skilled_tactician
		}
		if = {
			limit = {
				trait = misguided_warrior
			}
			add_trait = tough_soldier
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTB_SOH_4103 # This is the future!
		
		add_trait = misguided_warrior
	}
	
	option = {
		trigger = {
			OR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTC_SOH_4103 # I'll just have the glory!
		
		prestige = 25
	}
	
	
	option = {
		trigger = {
			has_education_martial_trigger = no
			NOR = {
				trait = naive_appeaser
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		
		name = EVTOPTD_SOH_4103 # Great!
		
		prestige = 25
	}
	
	option = {
		trigger = {
			trait = brilliant_strategist
		}
		
		name = EVTOPTE_SOH_4103 # Great!
		
		prestige = 50
	}
}

# Strategy discussion went poorly
character_event = {
	id = soh.4104
	desc = EVTDESC_SOH_4104
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_4104 # Not good!
		
		prestige = -25
	}
}

# Strategy discussion went poorly
character_event = {
	id = soh.4105
	desc = EVTDESC_SOH_4105
	picture = GFX_evt_council
	
	only_rulers = yes
	capable_only = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4105 # Not good!
		
		prestige = -25
	}
}

# Go victory - liege
character_event = {
	id = soh.4106
	desc = EVTDESC_SOH_4106
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
		event_target:hanami_go_opponent = {
			is_alive = yes
			is_inaccessible_or_incapable_trigger = no
			prisoner = no
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Way of Life"
			lifestyle_traits < 1
		}
		
		name = EVTOPTA_SOH_4106 # Gamer!
		
		add_trait = game_master
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4106 # Prestige!
		
		prestige = 25
		
		ai_chance = {
			factor = 75
		}
	}
}

# Go loss - vassal
character_event = {
	id = soh.4107
	desc = EVTDESC_SOH_4107
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4107 # Not good!
		
		prestige = -10
	}
}

# Go loss - liege
character_event = {
	id = soh.4108
	desc = EVTDESC_SOH_4108
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		has_character_modifier = hanami_in_progress
		event_target:hanami_go_opponent = {
			is_alive = yes
			is_inaccessible_or_incapable_trigger = no
			prisoner = no
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4108 # Not good!
		
		prestige = -10
	}
}

# Go victory - vassal
character_event = {
	id = soh.4109
	desc = EVTDESC_SOH_4109
	picture = GFX_evt_council
	
	only_rulers = yes
	prisoner = no
	war = no
	
	is_triggered_only = yes
	
	trigger = {
		is_actually_incapable_trigger = no
		FROM = {
			has_character_modifier = hanami_in_progress
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Way of Life"
			lifestyle_traits < 1
		}
		
		name = EVTOPTA_SOH_4109 # Gamer!
		
		add_trait = game_master
		
		ai_chance = {
			factor = 25
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4109 # Prestige!
		
		prestige = 25
		
		ai_chance = {
			factor = 75
		}
	}
}



##### End of Hanami + cleanup

# The hanami has ended
character_event = {
	id = soh.4110
	desc = EVTDESC_SOH_4110
	picture = GFX_evt_feast

	prisoner = no

	is_triggered_only = yes

	trigger = {
		has_character_modifier = hanami_in_progress
	}

	option = {
		name = EVTOPTA_SOH_4110 # That was fun!
		
		prestige = 10
		
		set_character_flag = recent_hanami
		
		hidden_tooltip = {
			remove_character_modifier = hanami_in_progress
			clr_character_flag = daytime_hanami
			clr_character_flag = nighttime_hanami
			clr_character_flag = hanami_decorate_capital_event
			clr_character_flag = hanami_capital_decorated
			clr_character_flag = hanami_capital_extremely_decorated
			clr_character_flag = hanami_plain_capital
			clr_character_flag = hanami_offerings_event
			clr_character_flag = hanami_small_offering
			clr_character_flag = hanami_great_offering
			clr_character_flag = hanami_dw_self_sabotage
			clr_character_flag = hanami_dw_sabotage_attempted
			clr_character_flag = hanami_no_offering
			clr_character_flag = hanami_improve_garden_event
			clr_character_flag = hanami_garden_improvement_self
			clr_character_flag = hanami_garden_improvement
			clr_character_flag = hanami_garden_improvement_self_gardener
			clr_character_flag = hanami_weeds
			clr_character_flag = hanami_shirabyoshi_event
			clr_character_flag = hanami_shirabyoshi
			clr_character_flag = hanami_no_entertainers
			clr_character_flag = lavishly_food
			clr_character_flag = medium_food
			clr_character_flag = low_food
			clr_character_flag = sent_invitations
			clr_character_flag = shirabyoshi_noshow
			clr_character_flag = bad_shirabyoshi
			clr_character_flag = inspiring_shirabyoshi
			clr_character_flag = troublesome_shirabyoshi
			clr_character_flag = remarkable_shirabyoshi
			clr_character_flag = banished_shirabyoshi
			clr_character_flag = shirabyoshi_killed
			clr_character_flag = hanami_duel_challengee_won
			clr_character_flag = hanami_duel_draw
			clr_character_flag = hanami_duel_challenger_won
			clr_character_flag = hanami_in_progress
			clr_character_flag = hanami_good_weather
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = do_not_disturb
			clr_character_flag = won_shirabyoshi_duel
			
			any_vassal = {
				limit = {
					has_character_flag = guest_hanami_started
				}
				
				character_event = { id = soh.4111 }
				
				remove_opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
					years = 2
				}
				
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
		}
	}
}

# Vassal: Hanami ended
character_event = {
	id = soh.4111
	desc = EVTDESC_SOH_4111
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4111 # That was fun!
		prestige = 5
	}
}

# The hanami is cancelled
character_event = {
	id = soh.4112
	desc = EVTDESC_SOH_4112
	picture = GFX_evt_burning_house

	only_rulers = yes
	war = yes

	trigger = {
		has_character_modifier = hanami_in_progress
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4112 # I see...
		
		hidden_tooltip = {
			remove_character_modifier = hanami_in_progress
			clr_character_flag = daytime_hanami
			clr_character_flag = nighttime_hanami
			clr_character_flag = hanami_decorate_capital_event
			clr_character_flag = hanami_capital_decorated
			clr_character_flag = hanami_capital_extremely_decorated
			clr_character_flag = hanami_plain_capital
			clr_character_flag = hanami_offerings_event
			clr_character_flag = hanami_small_offering
			clr_character_flag = hanami_great_offering
			clr_character_flag = hanami_dw_self_sabotage
			clr_character_flag = hanami_dw_sabotage_attempted
			clr_character_flag = hanami_no_offering
			clr_character_flag = hanami_improve_garden_event
			clr_character_flag = hanami_garden_improvement_self
			clr_character_flag = hanami_garden_improvement
			clr_character_flag = hanami_garden_improvement_self_gardener
			clr_character_flag = hanami_weeds
			clr_character_flag = hanami_shirabyoshi_event
			clr_character_flag = hanami_shirabyoshi
			clr_character_flag = hanami_no_entertainers
			clr_character_flag = lavishly_food
			clr_character_flag = medium_food
			clr_character_flag = low_food
			clr_character_flag = sent_invitations
			clr_character_flag = shirabyoshi_noshow
			clr_character_flag = bad_shirabyoshi
			clr_character_flag = inspiring_shirabyoshi
			clr_character_flag = troublesome_shirabyoshi
			clr_character_flag = remarkable_shirabyoshi
			clr_character_flag = banished_shirabyoshi
			clr_character_flag = shirabyoshi_killed
			clr_character_flag = hanami_duel_challengee_won
			clr_character_flag = hanami_duel_draw
			clr_character_flag = hanami_duel_challenger_won
			clr_character_flag = hanami_in_progress
			clr_character_flag = hanami_good_weather
			clr_character_flag = hanami_shirabyoshi_duel_hold_back
			clr_character_flag = hanami_shirabyoshi_duel_fair_fight
			clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
			clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
			clr_character_flag = hanami_brave
			clr_character_flag = hanami_not_craven
			clr_character_flag = hanami_prestige
			clr_character_flag = hanami_wounded
			clr_character_flag = hanami_duelist
			clr_character_flag = do_not_disturb
			clr_character_flag = won_shirabyoshi_duel
			
			any_vassal = {
				limit = {
					has_character_flag = guest_hanami_started
				}
				
				letter_event = { id = soh.4113 }
				
				remove_opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_enjoyed_hanami
					who = ROOT
					years = 2
				}
				
				clr_character_flag = coming_to_hanami
				clr_character_flag = guest_hanami_started
				clr_character_flag = hanami_shirabyoshi_duel_hold_back
				clr_character_flag = hanami_shirabyoshi_duel_fair_fight
				clr_character_flag = hanami_shirabyoshi_duel_fight_to_kill
				clr_character_flag = hanami_shirabyoshi_duel_fight_dirty
				clr_character_flag = hanami_brave
				clr_character_flag = hanami_not_craven
				clr_character_flag = hanami_prestige
				clr_character_flag = hanami_wounded
				clr_character_flag = hanami_duelist
				clr_character_flag = shirabyoshi_dueller
				clr_character_flag = won_shirabyoshi_duel
			}
		}
	}
}

# Hanami cancelled: notify invited vassals
letter_event = {
	id = soh.4113
	desc = EVTDESC_SOH_4113

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_4113 # I see...
	}
}

# on_war_started - end Hanami
character_event = {
	id = soh.4114
	hide_window = yes
	
	is_triggered_only = yes # on_war_started
	
	immediate = {
		ROOT = {
			if = {
				limit = {
					has_character_modifier = hanami_in_progress
				}
				
				character_event = { id = soh.4112 }
			}
		}
		
		FROM = {
			if = {
				limit = {
					has_character_modifier = hanami_in_progress
				}
				
				character_event = { id = soh.4112 }
			}
		}
	}
}