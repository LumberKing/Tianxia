# Grace events related to Boons
# By Silverswee(e)per

namespace = soh

# soh.6201-6400 reserved

# Partially inspired by JD logic; MUST be JD-locked

# TODO: AI logic for event options
# TODO: Opinion modifiers
# TODO: Scripted triggers and effects
# TODO: Localization
# TODO: Testing



##### Request Truce

### Independent

# on_yearly_pulse event for the AI
character_event = {
	id = soh.6201
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_independent = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		any_war = {
			attacker = {
				is_chinese_emperor_trigger = yes
			}
			defender = {
				character = ROOT 
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 500
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
				modifier = {
					factor = 0.1
					NOT = {
						relative_power = {
							who = event_target:eoc
							power = 0.5
						}
					}
				}
				modifier = {
					factor = 0.25
					NOT = {
						relative_power = {
							who = event_target:eoc
							power = 1
						}
					}
				}
				modifier = {
					factor = 0.1
					any_war = {
						attacker = {
							event_target:eoc
						}
						defender = {
							character = ROOT 
						}
						war_score <= -25
					}
				}
				modifier = {
					factor = 0
					any_war = {
						attacker = {
							event_target:eoc
						}
						defender = {
							character = ROOT 
						}
						war_score <= -50
					}
				}
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -500
				}
				modifier = {
					factor = 0.1
					is_dumb_trigger = yes
				}
				modifier = {
					factor = 0.2
					trait = brave
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 5
					trait = craven
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					relative_power = {
						who = event_target:eoc
						power = 2
					}
				}
				modifier = {
					factor = 0.5
					root_hates_china_trigger = yes
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_truce_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_truce_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6203 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6204 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6202
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_truce_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_truce_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6203 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6204 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6203
	desc = {
		text = EVTDESCA_SOH_6203
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6203
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6203
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6203 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6203 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6203 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6204 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6204
	is_triggered_only = yes
	title = EVTTITLE_SOH_6204
	desc = {
		text = EVTDESCA_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6204
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6204 # Accept the request
		
		any_war = {
			limit = {
				attacker = {
					character = ROOT 
				}
				defender = {
					character = event_target:grace_decision_taker
				}
			}
			end_war = invalid
		}
		set_truce = {
			who = event_target:grace_decision_taker
			years = 10
		}
		event_target:grace_decision_taker = {
			set_truce = {
				who = ROOT 
				years = 10
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6205 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6204 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6206 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6205
	desc = EVTDESC_SOH_6205
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6205 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6206
	desc = EVTDESC_SOH_6206
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6206 # Really?
	}
}



##### Request Peace Deal

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6207
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_independent = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			has_character_modifier = peace_deal_with_china
			e_china = {
				holder_scope = {
					has_non_aggression_pact_with = ROOT 
				}
			}
		}
		war = no
		in_revolt = no
		independent = yes
		check_variable = {
			which = grace
			value = 500
		}
		NOT = {
			suzerain = {
				is_chinese_emperor_trigger = yes
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
				modifier = {
					factor = 0.1
					NOT = {
						relative_power = {
							who = event_target:eoc
							power = 0.5
						}
					}
				}
				modifier = {
					factor = 0.25
					NOT = {
						relative_power = {
							who = event_target:eoc
							power = 1
						}
					}
				}
				modifier = {
					factor = 0.1
					any_war = {
						attacker = {
							event_target:eoc
						}
						defender = {
							character = ROOT 
						}
						war_score <= -25
					}
				}
				modifier = {
					factor = 0
					any_war = {
						attacker = {
							event_target:eoc
						}
						defender = {
							character = ROOT 
						}
						war_score <= -50
					}
				}
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -500
				}
				modifier = {
					factor = 0.1
					is_dumb_trigger = yes
				}
				modifier = {
					factor = 0.2
					trait = brave
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 5
					trait = craven
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					relative_power = {
						who = event_target:eoc
						power = 2
					}
				}
				modifier = {
					factor = 0.5
					root_hates_china_trigger = yes
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_peace_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_peace_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6209 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6210 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6208
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_peace_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_peace_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6209 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6210 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6209
	desc = {
		text = EVTDESCA_SOH_6209
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6209
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6209
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6209 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6209 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6209 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6210 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6210
	is_triggered_only = yes
	title = EVTTITLE_SOH_6210
	desc = {
		text = EVTDESCA_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6210
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6210 # Accept the request
		
		event_target:grace_decision_taker = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 25
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6211 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6210 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6212 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6211
	desc = EVTDESC_SOH_6211
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6211 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6212
	desc = EVTDESC_SOH_6212
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6212 # Really?
	}
}



##### Request Favor

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6213
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	has_dlc = "Zeus"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		NOR = {
			has_character_modifier = peace_deal_with_china
			e_china = {
				holder_scope = {
					has_non_aggression_pact_with = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 1000
		}
		e_china = {
			holder_scope = {
				NOR = {
					holds_favor_on = ROOT 
					owes_favor_to = ROOT 
				}
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -1000
				}
				modifier = {
					factor = 0.1
					is_dumb_trigger = yes
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 5
					trait = envious
				}
				modifier = {
					factor = 5
					trait = deceitful
				}
				modifier = {
					factor = 5
					trait = arbitrary
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.2
					trait = kind
				}
				modifier = {
					factor = 0.2
					trait = honest
				}
				modifier = {
					factor = 0.2
					trait = just
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_grant_favor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_grant_favor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6215 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6216 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6214
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_grant_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_grant_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6215 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6216 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6215
	desc = {
		text = EVTDESCA_SOH_6215
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6215
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6215
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6215 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6215 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6215 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6216 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6216
	is_triggered_only = yes
	title = EVTTITLE_SOH_6216
	desc = {
		text = EVTDESCA_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6216
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6216 # Accept the request
		
		reverse_add_favor = event_target:grace_decision_taker
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6217 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6216 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6218 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6217
	desc = EVTDESC_SOH_6217
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6217 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6218
	desc = EVTDESC_SOH_6218
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6218 # Really?
	}
}



##### Cancel Favor (Boon)

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6219
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	has_dlc = "Zeus"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		NOR = {
			has_character_modifier = peace_deal_with_china
			e_china = {
				holder_scope = {
					has_non_aggression_pact_with = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 1000
		}
		e_china = {
			holder_scope = {
				holds_favor_on = ROOT 
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -1000
				}
				modifier = {
					factor = 0.1
					is_dumb_trigger = yes
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 5
					trait = envious
				}
				modifier = {
					factor = 5
					trait = deceitful
				}
				modifier = {
					factor = 5
					trait = arbitrary
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.2
					trait = kind
				}
				modifier = {
					factor = 0.2
					trait = honest
				}
				modifier = {
					factor = 0.2
					trait = just
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_cancel_own_favor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_cancel_own_favor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6221 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6222 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6220
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_cancel_own_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_cancel_own_favor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6221 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6222 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6221
	desc = {
		text = EVTDESCA_SOH_6221
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6221
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6221
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6221 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6221 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6221 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6222 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6222
	is_triggered_only = yes
	title = EVTTITLE_SOH_6222
	desc = {
		text = EVTDESCA_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6222
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6222 # Accept the request
		
		remove_favor = event_target:grace_decision_taker
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6223 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6222 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6224 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6223
	desc = EVTDESC_SOH_6223
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6223 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6224
	desc = EVTDESC_SOH_6224
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6224 # Really?
	}
}



##### Request County (self)

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6225
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		NOR = {
			has_character_modifier = peace_deal_with_china
			e_china = {
				holder_scope = {
					has_non_aggression_pact_with = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 2000
			}
			AND = {
				has_minor_title = title_grand_chancellor
				check_variable = {
					which = grace
					value = 1000
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					change_variable = {
						which = grace
						value = -1000
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -2000
					}
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 5
					trait = envious
				}
				modifier = {
					factor = 5
					trait = deceitful
				}
				modifier = {
					factor = 5
					trait = arbitrary
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.2
					trait = kind
				}
				modifier = {
					factor = 0.2
					trait = honest
				}
				modifier = {
					factor = 0.2
					trait = just
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_grant_county_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_grant_county_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6227 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6228 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6226
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_grant_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_grant_county_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6227 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6228 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6227
	desc = {
		text = EVTDESCA_SOH_6227
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6227
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6227
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6227 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6227 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6227 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6228 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6228
	is_triggered_only = yes
	title = EVTTITLE_SOH_6228
	desc = {
		text = EVTDESCA_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6228
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		if = {
			limit = {
				primary_title = {
					NOR = {
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
			}
			random_realm_lord = {
				limit = {
					war = no
					NOT = {
						character = event_target:grace_decision_taker
					}
					NOT = {
						has_minor_title = title_grand_chancellor
					}
					any_demesne_title = {
						count = 2
						tier = count
						location = {
							capital_holding = {
								holding_type = castle
							}
						}
					}
				}
				preferred_limit = {
					NOR = {
						any_friend = {
							character = ROOT 
						}
						any_lover = {
							character = ROOT 
						}
						dynasty = ROOT 
					}
				}
				save_event_target_as = vassal_to_take_county_from
				random_demesne_title = {
					limit = {
						tier = count
						location = {
							capital_holding = {
								holding_type = castle
							}
						}
					}
					preferred_limit = {
						location = {
							NOT = {
								event_target:vassal_to_take_county_from = {
									capital_scope = {
										NOT = {
											province = PREVPREV
										}
									}
								}
							}
						}
					}
					save_event_target_as = vassal_county_to_take
				}
			}
		}
		if = {
			limit = {
				any_demesne_title = {
					count = 2
					tier = count
					location = {
						capital_holding = {
							holding_type = castle
						}
					}
				}
			}
			random_demesne_title = {
				limit = {
					tier = count
					location = {
						capital_holding = {
							holding_type = castle
						}
					}
				}
				preferred_limit = {
					location = {
						NOT = {
							ROOT = {
								capital_scope = {
									NOT = {
										province = PREVPREV
									}
								}
							}
						}
					}
				}
				save_event_target_as = county_to_take
			}
		}
	}
	
	option = {
		trigger = {
			event_target:county_to_take = {
				always = yes
			}
		}
		
		name = EVTOPTA_SOH_6228 # Accept the request
		
		event_target:grace_decision_taker = {
			grant_title_no_opinion = event_target:county_to_take
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6229 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6228 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6230 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_county_to_take = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6228 # Accept the request, using a vassal_county
		
		event_target:grace_decision_taker = {
			grant_title_no_opinion = event_target:vassal_county_to_take
		}
		character_event = { id = soh.6231 } # Give the other vassal something?
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6229 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6229
	desc = EVTDESC_SOH_6229
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6229 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6230
	desc = EVTDESC_SOH_6230
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6230 # Really?
	}
}

# If county was taken from someone else, the EoC is asked to repay them
character_event = {
	id = soh.6231
	desc = EVTDESC_SOH_6231
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6231 # Give the vassal some Grace
		
		custom_tooltip = {
			text = vassal_gets_grace
		}
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6232 } # Inform the vassal
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Zeus"
			NOT = {
				owes_favor_to = event_target:vassal_to_take_county_from
			}
		}
		name = EVTOPTB_SOH_6231 # Give the vassal a Favor
		
		reverse_add_favor = event_target:vassal_to_take_county_from
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6233 } # Inform the vassal
		}
	}
	
	option = {
		trigger = {
			wealth = 500
		}
		name = EVTOPTC_SOH_6231 # Give the vassal some money
		
		wealth = -500
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6234 } # Inform the vassal
		}
	}
	
	option = {
		name = EVTOPTD_SOH_6231 # Give the vassal nothing
		
		event_target:vassal_to_take_county_from = {
			opinion = {
				who = ROOT 
				modifier = opinion_tyrant
			}
			letter_event = { id = soh.6235 } # Inform the vassal
		}
	}
}

# Vassal informed of loss of county and repayment - Grace
letter_event = {
	id = soh.6232
	desc = EVTDESC_SOH_6232
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6232 # I suppose I can live with that...
		
		change_variable = {
			which = grace
			value = 500
		}
	}
}

# Vassal informed of loss of county and repayment - Favor
letter_event = {
	id = soh.6233
	desc = EVTDESC_SOH_6233
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6233 # I suppose I can live with that...
		
		add_favor = FROM
	}
}

# Vassal informed of loss of county and repayment - money
letter_event = {
	id = soh.6234
	desc = EVTDESC_SOH_6234
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6234 # I suppose I can live with that...
		
		wealth = 500
	}
}

# Vassal informed of loss of county and repayment - nothing
letter_event = {
	id = soh.6235
	desc = EVTDESC_SOH_6235
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6235 # I will not forget this!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:grace_decision_taker = {
					any_rival = {
						character = ROOT 
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = wroth
			}
			modifier = {
				factor = 0.1
				trait = envious
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 10
				trait = humble
			}
			modifier = {
				factor = 10
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6235 # I will never forgive this!
		
		if = {
			limit = {
				NOR = {
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
			add_rival = FROM
		}
		else = {
			if = {
				limit = {
					any_friend = {
						character = FROM
					}
				}
				remove_friend = FROM
			}
			if = {
				limit = {
					any_lover = {
						character = FROM
					}
				}
				remove_lover = FROM
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:grace_decision_taker = {
					OR = {
						any_friend = {
							character = ROOT 
						}
						any_lover = {
							character = ROOT 
						}
					}
				}
			}
		}
	}
}



##### Request County (other)

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6236
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		NOR = {
			has_character_modifier = peace_deal_with_china
			e_china = {
				holder_scope = {
					has_non_aggression_pact_with = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 2000
			}
			AND = {
				has_minor_title = title_grand_chancellor
				check_variable = {
					which = grace
					value = 1000
				}
			}
		}
		e_china = {
			holder_scope = {
				holds_favor_on = ROOT 
				is_inaccessible_or_incapable_trigger = no
			}
		}
		any_courtier = {
			is_adult = yes
			prisoner = no
			OR = {
				is_female = no
				ROOT = {
					OR = {
						has_game_rule = {
							name = gender
							value = all
						}
						primary_title = {
							has_law = status_of_women_4
						}
						has_religion_feature = religion_matriarchal
						has_religion_feature = religion_equal
						has_religion_feature = religion_feature_bon
						has_religion_feature = religion_feature_ryukyuan_three_mountains
						has_religion_feature = religion_feature_ryukyuan_historical
					}
				}
			}
			custom_tooltip = {
				text = is_not_incapable_inbred_or_imbecile_tt
				NOT = { trait = incapable }
				NOT = { trait = inbred }
				NOT = { trait = imbecile }
			}
			is_ill = no
			NOT = { trait = incapable }
			is_inaccessible_trigger = no
			NOT = { is_landed = yes }
			OR = {
				dynasty = ROOT 
				any_friend = {
					character = ROOT 
				}
				any_lover = {
					character = ROOT 
				}
				is_close_relative = ROOT 
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_courtier = {
			limit = {
				is_adult = yes
				prisoner = no
				OR = {
					is_female = no
					ROOT = {
						OR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
					}
				}
				custom_tooltip = {
					text = is_not_incapable_inbred_or_imbecile_tt
					NOT = { trait = incapable }
					NOT = { trait = inbred }
					NOT = { trait = imbecile }
				}
				is_ill = no
				NOT = { trait = incapable }
				is_inaccessible_trigger = no
				NOT = { is_landed = yes }
				OR = {
					dynasty = ROOT 
					any_friend = {
						character = ROOT 
					}
					any_lover = {
						character = ROOT 
					}
					is_close_relative = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT 
					}
				}
				any_close_relative = {
					character = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					any_rival = {
						character = ROOT 
					}
				}
			}
			save_event_target_as = character_getting_county
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					change_variable = {
						which = grace
						value = -1000
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -2000
					}
				}
				modifier = {
					factor = 0.1
					trait = ambitious
				}
				modifier = {
					factor = 0.2
					trait = proud
				}
				modifier = {
					factor = 0.2
					trait = envious
				}
				modifier = {
					factor = 0.2
					trait = arbitrary
				}
				modifier = {
					factor = 10
					trait = content
				}
				modifier = {
					factor = 10
					trait = humble
				}
				modifier = {
					factor = 5
					trait = kind
				}
				modifier = {
					factor = 5
					trait = just
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_grant_county_other_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_grant_county_other_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6238 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6239 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6237
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_grant_county_other_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_grant_county_other_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6238 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6239 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6238
	desc = {
		text = EVTDESCA_SOH_6238
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6238
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6238
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6238 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6238 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6238 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6239 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6239
	is_triggered_only = yes
	title = EVTTITLE_SOH_6239
	desc = {
		text = EVTDESCA_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6239
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		if = {
			limit = {
				primary_title = {
					NOR = {
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
			}
			random_realm_lord = {
				limit = {
					war = no
					NOT = {
						has_minor_title = title_grand_chancellor
					}
					any_demesne_title = {
						count = 2
						tier = count
						location = {
							capital_holding = {
								holding_type = castle
							}
						}
					}
				}
				preferred_limit = {
					NOR = {
						any_friend = {
							character = ROOT 
						}
						any_lover = {
							character = ROOT 
						}
						dynasty = ROOT 
						character = event_target:grace_decision_taker
					}
				}
				save_event_target_as = vassal_to_take_county_from
				random_demesne_title = {
					limit = {
						tier = count
						location = {
							capital_holding = {
								holding_type = castle
							}
						}
					}
					preferred_limit = {
						location = {
							NOT = {
								event_target:vassal_to_take_county_from = {
									capital_scope = {
										NOT = {
											province = PREVPREV
										}
									}
								}
							}
						}
					}
					save_event_target_as = vassal_county_to_take
				}
			}
		}
		if = {
			limit = {
				any_demesne_title = {
					count = 2
					tier = count
					location = {
						capital_holding = {
							holding_type = castle
						}
					}
				}
			}
			random_demesne_title = {
				limit = {
					tier = count
					location = {
						capital_holding = {
							holding_type = castle
						}
					}
				}
				preferred_limit = {
					location = {
						NOT = {
							ROOT = {
								capital_scope = {
									NOT = {
										province = PREVPREV
									}
								}
							}
						}
					}
				}
				save_event_target_as = county_to_take
			}
		}
	}
	
	option = {
		trigger = {
			event_target:county_to_take = {
				always = yes
			}
		}
		
		name = EVTOPTA_SOH_6239 # Accept the request
		
		event_target:character_getting_county = {
			grant_title_no_opinion = event_target:county_to_take
			set_defacto_liege = ROOT 
			opinion = {
				who = event_target:grace_decision_taker
				modifier = got_me_a_boon
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6240 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6239 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6241 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:vassal_county_to_take = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_6239 # Accept the request, using a vassal_county
		
		event_target:character_getting_county = {
			grant_title_no_opinion = event_target:vassal_county_to_take
			set_defacto_liege = ROOT 
			opinion = {
				who = event_target:grace_decision_taker
				modifier = got_me_a_boon
			}
		}
		
		if = {
			limit = {
				event_target:vassal_to_take_county_from = {
					NOT = {
						character = event_target:grace_decision_taker
					}
				}
			}
			character_event = { id = soh.6242 } # Give the other vassal something?
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6240 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6240
	desc = EVTDESC_SOH_6240
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6240 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6241
	desc = EVTDESC_SOH_6241
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6241 # Really?
	}
}

# If county was taken from someone else, the EoC is asked to repay them
character_event = {
	id = soh.6242
	desc = EVTDESC_SOH_6242
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6242 # Give the vassal some Grace
		
		custom_tooltip = {
			text = vassal_gets_grace
		}
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6243 } # Inform the vassal
		}
	}
	
	option = {
		trigger = {
			has_dlc = "Zeus"
			NOT = {
				owes_favor_to = event_target:vassal_to_take_county_from
			}
		}
		name = EVTOPTB_SOH_6242 # Give the vassal a Favor
		
		reverse_add_favor = event_target:vassal_to_take_county_from
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6244 } # Inform the vassal
		}
	}
	
	option = {
		trigger = {
			wealth = 500
		}
		name = EVTOPTC_SOH_6242 # Give the vassal some money
		
		wealth = -500
		
		event_target:vassal_to_take_county_from = {
			letter_event = { id = soh.6245 } # Inform the vassal
		}
	}
	
	option = {
		name = EVTOPTD_SOH_6242 # Give the vassal nothing
		
		event_target:vassal_to_take_county_from = {
			opinion = {
				who = ROOT 
				modifier = opinion_tyrant
			}
			letter_event = { id = soh.6246 } # Inform the vassal
		}
	}
}

# Vassal informed of loss of county and repayment - Grace
letter_event = {
	id = soh.6243
	desc = EVTDESC_SOH_6243
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6243 # I suppose I can live with that...
		
		change_variable = {
			which = grace
			value = 500
		}
	}
}

# Vassal informed of loss of county and repayment - Favor
letter_event = {
	id = soh.6244
	desc = EVTDESC_SOH_6244
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6244 # I suppose I can live with that...
		
		add_favor = FROM
	}
}

# Vassal informed of loss of county and repayment - money
letter_event = {
	id = soh.6245
	desc = EVTDESC_SOH_6245
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6245 # I suppose I can live with that...
		
		wealth = 500
	}
}

# Vassal informed of loss of county and repayment - nothing
letter_event = {
	id = soh.6246
	desc = EVTDESC_SOH_6246
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6246 # I will not forget this!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:grace_decision_taker = {
					any_rival = {
						character = ROOT 
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = wroth
			}
			modifier = {
				factor = 0.1
				trait = envious
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 10
				trait = humble
			}
			modifier = {
				factor = 10
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6246 # I will never forgive this!
		
		if = {
			limit = {
				NOR = {
					any_friend = {
						character = FROM
					}
					any_lover = {
						character = FROM
					}
				}
			}
			add_rival = FROM
		}
		else = {
			if = {
				limit = {
					any_friend = {
						character = FROM
					}
				}
				remove_friend = FROM
			}
			if = {
				limit = {
					any_lover = {
						character = FROM
					}
				}
				remove_lover = FROM
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:grace_decision_taker = {
					OR = {
						any_friend = {
							character = ROOT 
						}
						any_lover = {
							character = ROOT 
						}
					}
				}
			}
		}
	}
}



##### Request Physician

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6247
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	has_dlc = "Reapers"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 400
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 200
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -200
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -400
					}
				}
				modifier = {
					factor = 0
					AND = {
						OR = {
							AND = {
								independent = no
								NOT = {
									any_demesne_province = {
										has_disease = yes
									}
								}
							}
							AND = {
								independent = yes
								NOT = {
									any_realm_province = {
										has_disease = yes
									}
								}
							}
						}
						has_disease_trigger = no
						NOT = {
							trait = paranoid
						}
					}
				}
				modifier = {
					factor = 0.2
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
						trait = physician
					}
				}
				modifier = {
					factor = 0.5
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
					}
				}
				modifier = {
					factor = 10
					has_disease_trigger = yes
				}
				modifier = {
					factor = 5
					trait = paranoid
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = depressed
				}
				modifier = {
					factor = 5
					trait = kind
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_chinese_doctor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_chinese_doctor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6249 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6250 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6248
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_chinese_doctor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_chinese_doctor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6249 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6250 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6249
	desc = {
		text = EVTDESCA_SOH_6249
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6249
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6249
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6249 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6249 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6249 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6250 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6250
	is_triggered_only = yes
	title = EVTTITLE_SOH_6250
	desc = {
		text = EVTDESCA_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6250
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6250 # Accept the request
		
		hidden_tooltip = {
			create_chinese_physician_effect = yes
			event_target:new_chinese_doctor = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6251 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6250 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6252 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6251
	desc = EVTDESC_SOH_6251
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6251 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				NOT = {
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
					}
				}
			}
			event_target:new_chinese_doctor = {
				give_minor_title = title_court_physician
			}
		}
	}
}

# Request refused
letter_event = {
	id = soh.6252
	desc = EVTDESC_SOH_6252
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6252 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6253
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	has_dlc = "Reapers"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 200
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -200
				}
				else = {
					change_variable = {
						which = grace
						value = -400
					}
				}
				modifier = {
					factor = 0
					AND = {
						NOT = {
							any_demesne_province = {
								has_disease = yes
							}
						}
						has_disease_trigger = no
						NOT = {
							trait = paranoid
						}
					}
				}
				modifier = {
					factor = 0.2
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
						trait = physician
					}
				}
				modifier = {
					factor = 0.5
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
					}
				}
				modifier = {
					factor = 10
					has_disease_trigger = yes
				}
				modifier = {
					factor = 5
					trait = paranoid
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = depressed
				}
				modifier = {
					factor = 5
					trait = kind
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6255 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6254
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6255 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6255
	is_triggered_only = yes
	desc = EVTDESC_SOH_6255
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6255 # It's not like I can stop it...
		
		hidden_tooltip = {
			create_chinese_physician_effect = yes
			event_target:new_chinese_doctor = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6256 } # Inform sender
		}
	}
}

# Physician arrives
letter_event = {
	id = soh.6256
	desc = EVTDESC_SOH_6256
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6256 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				NOT = {
					any_courtier_or_vassal = {
						has_minor_title = title_court_physician
					}
				}
			}
			event_target:new_chinese_doctor = {
				give_minor_title = title_court_physician
			}
		}
	}
}



##### Request Siege Engineer

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6257
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1000
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 500
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1000
					}
				}
				modifier = {
					factor = 2
					war = yes
				}
				modifier = {
					factor = 5
					has_education_martial_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_siege_engineer_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_siege_engineer_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6259 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6260 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6258
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_siege_engineer_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_siege_engineer_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6259 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6260 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6259
	desc = {
		text = EVTDESCA_SOH_6259
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6259
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6259
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6259 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6259 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6259 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6260 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6260
	is_triggered_only = yes
	title = EVTTITLE_SOH_6260
	desc = {
		text = EVTDESCA_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6260
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6260 # Accept the request
		
		hidden_tooltip = {
			create_chinese_siege_engineer_effect = yes
			event_target:new_siege_engineer = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6261 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6260 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6262 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6261
	desc = EVTDESC_SOH_6261
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6261 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_commander
			}
			event_target:new_siege_engineer = {
				give_minor_title = title_commander
			}
		}
	}
}

# Request refused
letter_event = {
	id = soh.6262
	desc = EVTDESC_SOH_6262
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6262 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6263
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 500
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -500
				}
				modifier = {
					factor = 2
					war = yes
				}
				modifier = {
					factor = 5
					has_education_martial_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6265 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6264
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6265 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6265
	is_triggered_only = yes
	desc = EVTDESC_SOH_6265
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6265 # It's not like I can stop it...
		
		hidden_tooltip = {
			create_chinese_siege_engineer_effect = yes
			event_target:new_siege_engineer = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6266 } # Inform sender
		}
	}
}

# Siege engineer arrives
letter_event = {
	id = soh.6266
	desc = EVTDESC_SOH_6266
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6266 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_commander
			}
			event_target:new_siege_engineer = {
				give_minor_title = title_commander
			}
		}
	}
}



##### Request Strategist

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6267
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1500
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 750
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
				modifier = {
					factor = 2
					war = yes
				}
				modifier = {
					factor = 5
					has_education_martial_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_chinese_strategist_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_chinese_strategist_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6269 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6270 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6268
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_chinese_strategist_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_chinese_strategist_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6269 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6270 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6269
	desc = {
		text = EVTDESCA_SOH_6269
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6269
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6269
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6269 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6269 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6269 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6270 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6270
	is_triggered_only = yes
	title = EVTTITLE_SOH_6270
	desc = {
		text = EVTDESCA_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6270
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6270 # Accept the request
		
		hidden_tooltip = {
			create_chinese_strategist_effect = yes
			event_target:new_strategist = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6271 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6270 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6272 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6271
	desc = EVTDESC_SOH_6271
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6271 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_commander
			}
			event_target:new_strategist = {
				give_minor_title = title_commander
			}
		}
	}
}

# Request refused
letter_event = {
	id = soh.6272
	desc = EVTDESC_SOH_6272
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6272 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6273
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 750
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -750
				}
				modifier = {
					factor = 2
					war = yes
				}
				modifier = {
					factor = 5
					has_education_martial_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6275 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6274
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6275 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6275
	is_triggered_only = yes
	desc = EVTDESC_SOH_6275
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6275 # It's not like I can stop it...
		
		hidden_tooltip = {
			create_chinese_strategist_effect = yes
			event_target:new_strategist = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6276 } # Inform sender
		}
	}
}

# Strategist arrives
letter_event = {
	id = soh.6276
	desc = EVTDESC_SOH_6276
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6276 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_commander
			}
			event_target:new_strategist = {
				give_minor_title = title_commander
			}
		}
	}
}



##### Request Scholar-Bureaucrat

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6277
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1500
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 750
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 5
					has_education_stewardship_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					any_courtier_or_vassal = {
						has_minor_title = title_administrator
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_chinese_administrator_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_chinese_administrator_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6279 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6280 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6278
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_chinese_administrator_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_chinese_administrator_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6279 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6280 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6279
	desc = {
		text = EVTDESCA_SOH_6279
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6279
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6279
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6279 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6279 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6279 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6280 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6280
	is_triggered_only = yes
	title = EVTTITLE_SOH_6280
	desc = {
		text = EVTDESCA_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6280
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6280 # Accept the request
		
		hidden_tooltip = {
			create_chinese_administrator_effect = yes
			event_target:new_administrator = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6281 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6280 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6282 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6281
	desc = EVTDESC_SOH_6281
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6281 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_administrator
			}
			event_target:new_administrator = {
				give_minor_title = title_administrator
			}
		}
	}
}

# Request refused
letter_event = {
	id = soh.6282
	desc = EVTDESC_SOH_6282
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6282 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6283
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 750
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -750
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 5
					has_education_stewardship_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					any_courtier_or_vassal = {
						has_minor_title = title_administrator
					}
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6285 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6284
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6285 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6285
	is_triggered_only = yes
	desc = EVTDESC_SOH_6285
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6285 # It's not like I can stop it...
		
		hidden_tooltip = {
			create_chinese_administrator_effect = yes
			event_target:new_administrator = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6286 } # Inform sender
		}
	}
}

# Scholar-bureaucrat arrives
letter_event = {
	id = soh.6286
	desc = EVTDESC_SOH_6286
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6286 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_administrator
			}
			event_target:new_administrator = {
				give_minor_title = title_administrator
			}
		}
	}
}



##### Request Master Engineer

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6287
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1500
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 750
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -750
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1500
					}
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 5
					has_education_stewardship_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					any_courtier_or_vassal = {
						has_minor_title = title_administrator
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_master_engineer_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_master_engineer_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6289 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6290 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6288
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_master_engineer_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_master_engineer_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6289 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6290 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6289
	desc = {
		text = EVTDESCA_SOH_6289
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6289
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6289
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6289 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6289 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6289 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6290 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6290
	is_triggered_only = yes
	title = EVTTITLE_SOH_6290
	desc = {
		text = EVTDESCA_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6290
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6290 # Accept the request
		
		hidden_tooltip = {
			create_chinese_master_engineer_effect = yes
			event_target:new_master_engineer = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6291 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6290 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6292 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6291
	desc = EVTDESC_SOH_6291
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6291 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_master_engineer
			}
			event_target:new_master_engineer = {
				give_minor_title = title_master_engineer
			}
		}
	}
}

# Request refused
letter_event = {
	id = soh.6292
	desc = EVTDESC_SOH_6292
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6292 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6293
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 750
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -750
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 5
					has_education_stewardship_trigger = yes
				}
				modifier = {
					factor = 0.5
					trait = proud
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 2
					trait = humble
				}
				modifier = {
					factor = 0
					any_courtier_or_vassal = {
						has_minor_title = title_master_engineer
					}
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6295 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6294
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6295 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6295
	is_triggered_only = yes
	desc = EVTDESC_SOH_6295
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6295 # It's not like I can stop it...
		
		hidden_tooltip = {
			create_chinese_master_engineer_effect = yes
			event_target:new_master_engineer = {
				move_character = event_target:grace_decision_taker
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6296 } # Inform sender
		}
	}
}

# Master engineer arrives
letter_event = {
	id = soh.6296
	desc = EVTDESC_SOH_6296
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6296 # Great!
		
		set_character_flag = grace_character
		
		if = {
			limit = {
				can_grant_title = title_master_engineer
			}
			event_target:new_master_engineer = {
				give_minor_title = title_master_engineer
			}
		}
	}
}



##### Request Artifact

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6297
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT 
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT 
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1000
			}
			AND = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
				check_variable = {
					which = grace
					value = 500
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1000
					}
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 2
					trait = proud
				}
				modifier = {
					factor = 5
					trait = greedy
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 0.5
					trait = humble
				}
				modifier = {
					factor = 0.2
					trait = charitable
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_artifact_boon_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_artifact_boon_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								always = yes
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6299 } # EoC's GC has a say
						}
					}
				}
				else = {
					event_target:eoc = {
						narrative_event = { id = soh.6300 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6298
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_artifact_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_artifact_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6299 } # EoC's GC has a say
				}
			}
		}
		else = {
			event_target:eoc = {
				narrative_event = { id = soh.6300 } # EoC gets request
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6299
	desc = {
		text = EVTDESCA_SOH_6299
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6299
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6299
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6299 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6299 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6299 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6300 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6300
	is_triggered_only = yes
	title = EVTTITLE_SOH_6300
	desc = {
		text = EVTDESCA_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6300
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6300 # Accept the request
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6301 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6300 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6302 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6301
	desc = EVTDESC_SOH_6301
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		add_random_chinese_artifact_with_moh_weight_effect = yes
	}
	
	option = {
		name = EVTOPTA_SOH_6301 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6302
	desc = EVTDESC_SOH_6302
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6302 # Really?
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6303
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		is_chinese_emperor_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		check_variable = {
			which = grace
			value = 500
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				change_variable = {
					which = grace
					value = -500
				}
				modifier = {
					factor = 0
					war = yes
				}
				modifier = {
					factor = 2
					trait = proud
				}
				modifier = {
					factor = 5
					trait = greedy
				}
				modifier = {
					factor = 0.5
					trait = content
				}
				modifier = {
					factor = 0.5
					trait = humble
				}
				modifier = {
					factor = 0.2
					trait = charitable
				}
				save_event_target_as = grace_decision_taker
				event_target:eoc = {
					character_event = { id = soh.6305 } # Inform EoC
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6304
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		event_target:eoc = {
			narrative_event = { id = soh.6305 } # Inform EoC
		}
	}
}

# EoC gets the request
character_event = {
	id = soh.6305
	is_triggered_only = yes
	desc = EVTDESC_SOH_6305
	picture = GFX_evt_china_golden_age
	border = TODO
	
	option = {
		name = EVTOPTA_SOH_6305 # It's not like I can stop it...
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6306 } # Inform sender
		}
	}
}

# Vassal gets artifact
letter_event = {
	id = soh.6306
	desc = EVTDESC_SOH_6306
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		add_random_chinese_artifact_with_moh_weight_effect = yes
	}
	
	option = {
		name = EVTOPTA_SOH_6306 # Great!
		
		set_character_flag = grace_character
	}
}



##### Dismiss Councillor

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6307
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		top_liege = {
			any_voter = {
				NOT = {
					character = ROOT 
				}
				OR = {
					AND = {
						has_minor_title = title_grand_chancellor
						e_china = {
							NOT = {
								has_law = grand_chancellor_law_2
							}
						}
						ROOT = {
							check_variable = {
								which = grace
								value = 5000
							}
						}
					}
					AND = {
						NOT = {
							has_minor_title = title_grand_chancellor
						}
						is_landed = yes
						is_powerful_vassal = yes
						e_china = {
							NOR = {
								has_law = ci_vassal_law_3
								has_law = ci_vassal_law_4
							}
						}
						ROOT = {
							OR = {
								AND = {
									has_minor_title = title_grand_chancellor
									check_variable = {
										which = grace
										value = 1000
									}
								}
								check_variable = {
									which = grace
									value = 2000
								}
							}
						}
					}
					AND = {
						NOT = {
							has_minor_title = title_grand_chancellor
						}
						is_landed = yes
						is_powerful_vassal = no
						e_china = {
							NOT= {
								has_law = ci_vassal_law_4
							}
						}
						ROOT = {
							OR = {
								AND = {
									has_minor_title = title_grand_chancellor
									check_variable = {
										which = grace
										value = 500
									}
								}
								check_variable = {
									which = grace
									value = 1000
								}
							}
						}
					}
					AND = {
						NOT = {
							has_minor_title = title_grand_chancellor
						}
						is_landed = no
						is_council_eunuch_trigger = yes
						e_china = {
							NOR= {
								has_law = eunuch_law_3
								has_law = eunuch_law_4
							}
						}
						ROOT = {
							OR = {
								AND = {
									has_minor_title = title_grand_chancellor
									check_variable = {
										which = grace
										value = 500
									}
								}
								check_variable = {
									which = grace
									value = 1000
								}
							}
						}
					}
					AND = {
						NOT = {
							has_minor_title = title_grand_chancellor
						}
						is_landed = no
						is_council_eunuch_trigger = no
						e_china = {
							NOT= {
								has_law = ci_courtier_law_4
							}
						}
						ROOT = {
							OR = {
								AND = {
									has_minor_title = title_grand_chancellor
									check_variable = {
										which = grace
										value = 500
									}
								}
								check_variable = {
									which = grace
									value = 1000
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
				random_voter = {
					limit = {
						NOT = {
							character = ROOT 
						}
						OR = {
							AND = {
								has_minor_title = title_grand_chancellor
								e_china = {
									NOT = {
										has_law = grand_chancellor_law_2
									}
								}
								ROOT = {
									check_variable = {
										which = grace
										value = 5000
									}
								}
							}
							AND = {
								NOT = {
									has_minor_title = title_grand_chancellor
								}
								is_landed = yes
								is_powerful_vassal = yes
								e_china = {
									NOR = {
										has_law = ci_vassal_law_3
										has_law = ci_vassal_law_4
									}
								}
								ROOT = {
									OR = {
										AND = {
											has_minor_title = title_grand_chancellor
											check_variable = {
												which = grace
												value = 1000
											}
										}
										check_variable = {
											which = grace
											value = 2000
										}
									}
								}
							}
							AND = {
								NOT = {
									has_minor_title = title_grand_chancellor
								}
								is_landed = yes
								is_powerful_vassal = no
								e_china = {
									NOT= {
										has_law = ci_vassal_law_4
									}
								}
								ROOT = {
									OR = {
										AND = {
											has_minor_title = title_grand_chancellor
											check_variable = {
												which = grace
												value = 500
											}
										}
										check_variable = {
											which = grace
											value = 1000
										}
									}
								}
							}
							AND = {
								NOT = {
									has_minor_title = title_grand_chancellor
								}
								is_landed = no
								is_council_eunuch_trigger = yes
								e_china = {
									NOR= {
										has_law = eunuch_law_3
										has_law = eunuch_law_4
									}
								}
								ROOT = {
									OR = {
										AND = {
											has_minor_title = title_grand_chancellor
											check_variable = {
												which = grace
												value = 500
											}
										}
										check_variable = {
											which = grace
											value = 1000
										}
									}
								}
							}
							AND = {
								NOT = {
									has_minor_title = title_grand_chancellor
								}
								is_landed = no
								is_council_eunuch_trigger = no
								e_china = {
									NOT= {
										has_law = ci_courtier_law_4
									}
								}
								ROOT = {
									OR = {
										AND = {
											has_minor_title = title_grand_chancellor
											check_variable = {
												which = grace
												value = 500
											}
										}
										check_variable = {
											which = grace
											value = 1000
										}
									}
								}
							}
						}
					}
					preferred_limit = {
						any_rival = {
							character = ROOT 
						}
						NOT = {
							dynasty = ROOT 
						}
						NOT = {
							reverse_has_opinion_modifier = {
								who = ROOT 
								modifier = supporting_as_grand_chancellor
							}
						}
					}
					preferred_limit = {
						any_rival = {
							character = ROOT 
						}
						NOT = {
							reverse_has_opinion_modifier = {
								who = ROOT 
								modifier = supporting_as_grand_chancellor
							}
						}
					}
					preferred_limit = {
						NOR = {
							any_friend = {
								character = ROOT 
							}
							any_lover = {
								character = ROOT 
							}
						}
						NOT = {
							dynasty = ROOT 
						}
						NOT = {
							reverse_has_opinion_modifier = {
								who = ROOT 
								modifier = supporting_as_grand_chancellor
							}
						}
					}
					preferred_limit = {
						NOR = {
							any_friend = {
								character = ROOT 
							}
							any_lover = {
								character = ROOT 
							}
						}
						NOT = {
							reverse_has_opinion_modifier = {
								who = ROOT 
								modifier = supporting_as_grand_chancellor
							}
						}
					}
					preferred_limit = {
						NOR = {
							any_friend = {
								character = ROOT 
							}
							any_lover = {
								character = ROOT 
							}
						}
						NOT = {
							dynasty = ROOT 
						}
					}
					preferred_limit = {
						NOR = {
							any_friend = {
								character = ROOT 
							}
							any_lover = {
								character = ROOT 
							}
						}
					}
					save_event_target_as = councillor_to_fire
				}
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0.01
					event_target:councillor_to_fire = {
						reverse_has_opinion_modifier = {
							who = ROOT 
							modifier = supporting_as_grand_chancellor
						}
						NOT = {
							any_rival = {
								character = ROOT 
							}
						}
					}
				}
				modifier = {
					factor = 10
					any_rival = {
						character = event_target:councillor_to_fire
					}
				}
				modifier = {
					factor = 5
					is_voter = yes
				}
				modifier = {
					factor = 10
					trait = proud
				}
				modifier = {
					factor = 0
					OR = {
						any_friend = {
							character = event_target:councillor_to_fire
						}
						any_lover = {
							character = event_target:councillor_to_fire
						}
					}
					NOR = {
						trait = arbitrary
						trait = deceitful
					}
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 10
					trait = ambitious
					OR = {
						AND = {
							is_voter = no
							liege = {
								is_chinese_emperor_trigger = yes
							}
						}
						AND = {
							has_ambition = obj_become_grand_chancellor
							NOT = {
								check_variable = {
									which = grace
									value = 5000
								}
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 0.1
					NOT = {
						liege = {
							is_chinese_emperor_trigger = yes
						}
					}
				}
				if = {
					limit = {
						event_target:councillor_to_fire = {
							has_minor_title = title_grand_chancellor
						}
					}
					change_variable = {
						which = grace
						value = -5000
					}
				}
				else_if = {
					limit = {
						event_target:councillor_to_fire = {
							is_powerful_vassal = yes
						}
					}
					if = {
						limit = {
							has_minor_title = title_grand_chancellor
						}
						change_variable = {
							which = grace
							value = -1000
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -2000
						}
					}
				}
				else = {
					if = {
						limit = {
							has_minor_title = title_grand_chancellor
						}
						change_variable = {
							which = grace
							value = -500
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -1000
						}
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_dismiss_councillor_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_dismiss_councillor_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6309 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6310 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6308
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_dismiss_councillor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_dismiss_councillor_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6309 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6310 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6309
	desc = {
		text = EVTDESCA_SOH_6309
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6309
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6309
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6309 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6309 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6309 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6310 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6310
	is_triggered_only = yes
	title = EVTTITLE_SOH_6310
	desc = {
		text = EVTDESCA_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6310
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6310 # Accept the request
		
		event_target:councillor_to_fire = {
			character_event = { id = soh.6313 } # Inform the fired councillor
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6311 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6310 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6312 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6311
	desc = EVTDESC_SOH_6311
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6311 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6312
	desc = EVTDESC_SOH_6312
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6312 # Really?
	}
}

# Fired councillor informed
character_event = {
	id = soh.6313
	desc = EVTDESC_SOH_6313
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6313 # They dare?
		
		add_character_modifier = { # Five years
			modifier = forced_off_the_council
			months = 60
		}
		
		if = {
			limit = {
				OR = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
					any_lover = {
						character = event_target:grace_decision_taker
					}
				}
			}
			if = {
				limit = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
				}
				remove_friend = event_target:grace_decision_taker
			}
			else = {
				remove_lover = event_target:grace_decision_taker
			}
		}
		else_if = {
			limit = {
				NOT = {
					any_rival = {
						character = event_target:grace_decision_taker
					}
				}
			}
			random = {
				chance = 50
				add_rival = event_target:grace_decision_taker
			}
		}
		
		if = {
			limit = {
				has_job_title = job_chancellor
			}
			remove_title = job_chancellor
		}
		else_if = {
			limit = {
				has_job_title = job_marshal
			}
			remove_title = job_marshal
		}
		else_if = {
			limit = {
				has_job_title = job_treasurer
			}
			remove_title = job_treasurer
		}
		else_if = {
			limit = {
				has_job_title = job_spymaster
			}
			remove_title = job_spymaster
		}
		else_if = {
			limit = {
				has_job_title = job_spiritual
			}
			remove_title = job_spiritual
		}
		else_if = {
			limit = {
				has_minor_title = title_councilmember_king
			}
			remove_title = title_councilmember_king
		}
		else_if = {
			limit = {
				has_minor_title = title_councilmember_emperor
			}
			remove_title = title_councilmember_emperor
		}
		
		opinion = { # Ten years
			who = event_target:grace_decision_taker
			modifier = got_me_fired
		}
	}
}



##### Request Command

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6314
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
			}
		}
		check_variable = {
			which = grace
			value = 500
		}
		can_hold_title = title_commander
		NOT = {
			has_minor_title = title_commander
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0
					trait = craven
				}
				modifier = {
					factor = 5
					trait = brave
				}
				modifier = {
					factor = 2
					has_education_martial_trigger = yes
				}
				modifier = {
					factor = 2
					has_lifestyle_martial_trigger = yes
				}
				modifier = {
					factor = 10
					trait = proud
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				modifier = {
					factor = 2
					trait = ambitious
				}
				modifier = {
					factor = 0.1
					trait = content
				}
				change_variable = {
					which = grace
					value = -500
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_artifact_boon_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_artifact_boon_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6316 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6317 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6315
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_artifact_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_artifact_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6316 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6317 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6316
	desc = {
		text = EVTDESCA_SOH_6316
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6316
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6316
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6316 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6316 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6316 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6317 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6317
	is_triggered_only = yes
	title = EVTTITLE_SOH_6317
	desc = {
		text = EVTDESCA_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6317
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_courtier_or_vassal = {
			limit = {
				has_minor_title = title_commander
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				is_voter = no
				any_rival = {
					character = event_target:grace_decision_taker
				}
				any_rival = {
					character = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				is_voter = no
				any_rival = {
					character = event_target:grace_decision_taker
				}
				NOR = {
					any_friend = {
						character = ROOT 
					}
					any_lover = {
						character = ROOT 
					}
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				is_voter = no
				NOR = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
					any_lover = {
						character = event_target:grace_decision_taker
					}
				}
				any_rival = {
					character = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				is_voter = no
				NOR = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
					any_lover = {
						character = event_target:grace_decision_taker
					}
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				any_rival = {
					character = event_target:grace_decision_taker
				}
				any_rival = {
					character = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				any_rival = {
					character = event_target:grace_decision_taker
				}
				NOR = {
					any_friend = {
						character = ROOT 
					}
					any_lover = {
						character = ROOT 
					}
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				NOR = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
					any_lover = {
						character = event_target:grace_decision_taker
					}
				}
				any_rival = {
					character = ROOT 
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
				NOR = {
					any_friend = {
						character = event_target:grace_decision_taker
					}
					any_lover = {
						character = event_target:grace_decision_taker
					}
				}
			}
			preferred_limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT 
						modifier = opinion_forced_commander
					}
				}
			}
			save_event_target_as = commander_to_replace
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6317 # Accept the request
		
		event_target:commander_to_replace = {
			remove_title = title_commander
			character_event = { id = soh.6320 } # Inform the fired commander
		}
		event_target:grace_decision_taker = {
			give_minor_title = title_commander
			reverse_opinion = {
				who = ROOT 
				modifier = opinion_forced_commander
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6318 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6317 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6319 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6318
	desc = EVTDESC_SOH_6318
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6318 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6319
	desc = EVTDESC_SOH_6319
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6319 # Really?
	}
}

# Fired commander informed
character_event = {
	id = soh.6320
	desc = EVTDESC_SOH_6320
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6320 # They dare?
	}
}



##### Become Grand Chancellor

# Handled with normal GC events - no events here!



##### Renounce Claims

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6321
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 5000
			}
			AND = {
				has_minor_title = title_grand_chancellor
				check_variable = {
					which = grace
					value = 2500
				}
			}
		}
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				ROOT = {
					any_demesne_title = {
						claimed_by = PREVPREV
					}
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0
					e_china = {
						OR = {
							has_law = ci_vassal_law_3
							has_law = ci_vassal_law_4
						}
					}
				}
				modifier = {
					factor = 0
					event_target:eoc = {
						NOT = {
							relative_power = {
								who = ROOT 
								power = 0.5
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					event_target:eoc = {
						NOT = {
							relative_power = {
								who = ROOT 
								power = 1
							}
						}
					}
				}
				modifier = {
					factor = 0.1
					trait = brave
				}
				modifier = {
					factor = 10
					trait = craven
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 0.2
					trait = humble
				}
				if = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					change_variable = {
						which = grace
						value = -2500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -5000
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_renounce_boon_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_renounce_boon_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6323 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6324 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6322
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_renounce_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_renounce_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6323 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6324 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6323
	desc = {
		text = EVTDESCA_SOH_6323
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6323
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6323
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6323 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6323 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6323 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6324 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6324
	is_triggered_only = yes
	title = EVTTITLE_SOH_6324
	desc = {
		text = EVTDESCA_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6324
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6324 # Accept the request
		
		custom_tooltip = {
			text = china_renounce_all_claims
			event_target:grace_decision_taker = {
				any_demesne_title = {
					limit = {
						claimed_by = ROOT 
					}
					remove_claim = ROOT 
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6325 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6324 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6326 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6325
	desc = EVTDESC_SOH_6325
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6325 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6326
	desc = EVTDESC_SOH_6326
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6326 # Really?
	}
}



##### Request Imperial Praise

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6327
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 2000
			}
			AND = {
				has_minor_title = title_grand_chancellor
				check_variable = {
					which = grace
					value = 1000
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 10
					trait = proud
				}
				modifier = {
					factor = 5
					trait = ambitious
				}
				modifier = {
					factor = 0.2
					trait = content
				}
				modifier = {
					factor = 0.2
					trait = shy
				}
				modifier = {
					factor = 0.1
					trait = paranoid
				}
				modifier = {
					factor = 5
					trait = envious
				}
				if = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					change_variable = {
						which = grace
						value = -1000
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -2000
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_imperial_praise_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_imperial_praise_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6329 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6330 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6328
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_imperial_praise_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_imperial_praise_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6329 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6330 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6329
	desc = {
		text = EVTDESCA_SOH_6329
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6329
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6329
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6329 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6329 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6329 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6330 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6330
	is_triggered_only = yes
	title = EVTTITLE_SOH_6330
	desc = {
		text = EVTDESCA_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6330
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6330 # Accept the request
		
		event_target:grace_decision_taker = {
			add_character_modifier = {
				modifier = imperial_praise_modifier
				days = 1825
			}
			custom_tooltip = {
				text = voters_and_vassals_approve
				ROOT = {
					any_voter = {
						limit = {
							is_landed = no
						}
						opinion = {
							who = event_target:grace_character
							modifier = got_imperial_praise
						}
					}
					any_vassal = {
						opinion = {
							who = event_target:grace_character
							modifier = got_imperial_praise
						}
						if = {
							limit = {
								ai = no
								NOT = {
									character = event_target:grace_decision_taker
								}
							}
							letter_event = { id = soh.6333 } # Inform players
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6331 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6330 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6332 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6331
	desc = EVTDESC_SOH_6331
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6331 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6332
	desc = EVTDESC_SOH_6332
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6332 # Really?
	}
}

# Other vassals informed
letter_event = {
	id = soh.6333
	desc = EVTDESC_SOH_6333
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6333 # Interesting...
	}
}



##### Ask to end mourning

### Vassal

# on_yearly_pulse event for the AI
character_event = {
	id = soh.6334
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		trait = in_mourning
		check_variable = {
			which = grace
			value = 1000
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0
					trait = zealous
				}
				modifier = {
					factor = 100
					trait = cynical
				}
				modifier = {
					factor = 5
					trait = ambitious
				}
				modifier = {
					factor = 0.2
					trait = content
				}
				modifier = {
					factor = 0.1
					trait = slothful
				}
				modifier = {
					factor = 10
					trait = diligent
				}
				modifier = {
					factor = 2
					trait = proud
				}
				modifier = {
					factor = 0.5
					trait = humble
				}
				change_variable = {
					which = grace
					value = -1000
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_end_mourning_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_end_mourning_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6336 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6337 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6335
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_end_mourning_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_end_mourning_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6336 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6337 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6336
	desc = {
		text = EVTDESCA_SOH_6336
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6336
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6336
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6336 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6336 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6336 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6337 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6337
	is_triggered_only = yes
	title = EVTTITLE_SOH_6337
	desc = {
		text = EVTDESCA_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6337
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6337 # Accept the request
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = event_target:grace_decision_taker
				}
			}
			character_event = { id = soh.6340 } # Inform players
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6338 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6337 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6339 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6338
	desc = EVTDESC_SOH_6338
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6338 # Great!
		
		end_mourning_effect = yes
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6339
	desc = EVTDESC_SOH_6339
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6339 # Really?
	}
}

# Other vassals informed
character_event = {
	id = soh.6340
	desc = EVTDESC_SOH_6340
	picture = TODO
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6340 # Interesting...
	}
}



##### Ask to Decreate Tributary Tier

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6341
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_independent = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_chinese_emperor_trigger = no # The EoC cannot pay tribute to himself!
		NOT = {
			top_liege = {
				is_chinese_emperor_trigger = yes # Vassals of the EoC do not use Grace!
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		e_china = {
			holder_scope = {
				is_inaccessible_or_incapable_trigger = no
				war = no
			}
		}
		war = no # Is at peace
		suzerain = {
			is_chinese_emperor_trigger = yes
		}
		OR = {
			AND = {
				is_tributary = {
					type = chinese_client_state
				}
				OR = {
					AND = {
						NOT = { # If a Client State is too distant, China will be more willing to let them go
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
													is_tributary = {
														type = chinese_client_state
													}
													is_tributary = {
														type = chinese_protectorate
													}
													top_liege = {
														OR = {
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
														}
													}
												}
												NOR = {
													character = ROOT 
													top_liege = {
														character = ROOT 
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
															NOR = {
																character = ROOT 
																top_liege = {
																	character = ROOT 
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT 
																	top_liege = {
																		character = ROOT 
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						check_variable = {
							which = grace
							value = 2500
						}
					}
					check_variable = {
						which = grace
						value = 5000
					}
				}
			}
			AND = {
				is_tributary = {
					type = chinese_protectorate
				}
				OR = {
					AND = {
						NOT = { # If a Protectorate is too distant, China will be more willing to let them go
							any_realm_province = {
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													is_chinese_emperor_trigger = yes
													top_liege = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												OR = {
													AND = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
													AND = {
														is_land = no
														any_neighbor_province = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						check_variable = {
							which = grace
							value = 1000
						}
					}
					check_variable = {
						which = grace
						value = 2000
					}
				}
			}
			AND = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
				check_variable = {
					which = grace
					value = 500
				}
			}
			AND = {
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
				check_variable = {
					which = grace
					value = 250
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 10
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT  # If you're far from China, you should want to break free
							}
						}
					}
				}
				modifier = {
					factor = 10 # Make random distant realms more likely to try to break free
					NOT = {
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													OR = {
														is_chinese_emperor_trigger = yes
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
												suzerain = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		suzerain = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				# Kings and nomads are more likely to want to break free
				modifier = {
					factor = 2
					OR = {
						real_tier = king
						is_nomadic = yes
					}
				}
				# Non-nomadic emperors want to break free very frequently
				modifier = {
					factor = 10
					real_tier = emperor
					is_nomadic = no
				}
				# Small realms are more likely to be willing to become tributaries
				modifier = {
					factor = 0.25
					NOT = {
						realm_size = 10
					}
				}
				# Large realms are less likely to be willing to become tributaries
				modifier = {
					factor = 5
					realm_size = 50
				}
				# At this size, the realm is too powerful to willingly become a tributary
				modifier = {
					factor = 10
					realm_size = 100
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 10
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					NOR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Wants to be independent due to traits
				modifier = {
					factor = 5
					OR = {
						trait = proud
						trait = ambitious
						trait = brave
					}
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# Is likely to be scared of China
				modifier = {
					factor = 0.1
					OR = {
						trait = humble
						trait = content
						trait = craven
					}
				}
				# China is less than twice as powerful
				modifier = {
					factor = 2
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.5
								}
							}
						}
					}
				}
				# China is less than four times as powerful
				modifier = {
					factor = 2
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.25
								}
							}
						}
					}
				}
				# China is more than ten times as powerful
				modifier = {
					factor = 0.1
					NOT = {
						e_china = {
							holder_scope = {
								ROOT = {
									relative_power = {
										who = PREV
										power = 0.1
									}
								}
							}
						}
					}
				}
				# Same culture
				modifier = {
					factor = 0.1
					e_china = {
						holder_scope = {
							culture = ROOT 
						}
					}
				}
				# Same culture group
				modifier = {
					factor = 0.5
					e_china = {
						holder_scope = {
							culture_group = ROOT 
							NOT = {
								culture = ROOT 
							}
						}
					}
				}
				modifier = {
					factor = 100
					root_hates_china_trigger = yes # Dislikes the EoC
				}
				# Chinese
				modifier = {
					factor = 0.25
					culture_group = chinese_group
				}
				# Is "Chinese enough"
				modifier = {
					factor = 0.25
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				}
				# Is "Chinese enough"
				modifier = {
					factor = 0.25
					government = chinese_vassal_government
				}
				# We are uncivilized
				modifier = {
					factor = 10
					OR = {
						is_tribal = yes
						is_nomadic = yes
					}
				}
				# We won't willingly join China if we don't have a "Chinese enough" religion
				modifier = {
					factor = 10
					is_tributary = {
						type = chinese_client_state
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# Is a Client State
				modifier = {
					factor = 10
					is_tributary = {
						type = chinese_client_state
					}
				}
				# Is a Protectorate
				modifier = {
					factor = 5
					is_tributary = {
						type = chinese_protectorate
					}
				}
				# Wants to break free on succession
				modifier = {
					factor = 2
					is_tributary = {
						type = chinese_protectorate
					}
				}
				# Controls a religion, is a holy order, or is a mercenary and thus doesn't want to be a tributary
				modifier = {
					factor = 100
					OR = {
						controls_religion = yes
						mercenary = yes
						holy_order = yes
					}
				}
				# I have strong neighbours and protection would be nice
				modifier = {
					factor = 0.5
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.5
								}
							}
						}
					}
					NOT = {
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				modifier = {
					factor = 0.5
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.25
								}
							}
						}
					}
					NOT = {
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				modifier = {
					factor = 0.1
					any_neighbor_independent_ruler = {
						is_china_or_defended_chinese_tributary_trigger = no
						NOT = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
					NOT = {
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
				# Less likely if China is doing well
				modifier = {
					factor = 0.1
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_5
						}
					}
				}
				modifier = {
					factor = 0.25
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_4
						}
					}
				}
				modifier = {
					factor = 5
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_2
						}
					}
				}
				modifier = {
					factor = 10
					e_china = {
						holder_scope = {
							has_character_modifier = mandate_of_heaven_1
						}
					}
				}
				# If someone is just too different, they should want to be free a bit more often
				modifier = {
					factor = 10
					OR = {
						is_nomadic = yes
						is_tribal = yes
					}
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
				}
				# If you have rather little Grace, perhaps you should stay a bit longer...
				modifier = {
					factor = 0.01
					NOT = {
						check_variable = {
							which = grace
							value = 1000
						}
					}
				}
				# If we want to get border adjustments, seriously consider it
				modifier = {
					factor = 0.1
					china_grants_border_adjustment_boon_trigger = yes
					e_china = {
						holder_scope = {
							any_realm_title = {
								tier = count
								NOR = {
									de_jure_liege_or_above = e_china
									region = world_china
								}
								de_jure_liege_or_above = ROOT 
							}
						}
					}
				}
				# Pagans should be more unlikely to become tributaries
				modifier = {
					factor = 5
					religion_group = pagan_group
					can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
					is_reformed_religion = no
				}
				# If we're not in China we should be a bit more likely to want to downgrade if we're a Client State
				modifier = {
					factor = 10
					real_tier = king
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				modifier = {
					factor = 5
					real_tier = duke
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				modifier = {
					factor = 2
					real_tier = count
					is_tributary = {
						type = chinese_client_state
					}
					NOT = {
						capital_scope = {
							OR = {
								region = world_china
								county = {
									de_jure_liege_or_above = e_china
								}
							}
						}
					}
				}
				if = {
					limit = {
						is_tributary = {
							type = chinese_client_state
						}
					}
					if = {
						limit = {
							NOT = { # If a Client State is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
													NOR = {
														character = ROOT 
														top_liege = {
															character = ROOT 
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT 
																	top_liege = {
																		character = ROOT 
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		top_liege = {
																			OR = {
																				is_tributary = {
																					type = chinese_client_state
																				}
																				is_tributary = {
																					type = chinese_protectorate
																				}
																			}
																		}
																	}
																	NOR = {
																		character = ROOT 
																		top_liege = {
																			character = ROOT 
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						change_variable = {
							which = grace
							value = -1000
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -2000
						}
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_protectorate
						}
					}
					if = {
						limit = {
							NOT = { # If a Protectorate is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
						change_variable = {
							which = grace
							value = -1000
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -500
						}
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -250
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_decrease_tributary_tier_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_decrease_tributary_tier_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6343 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6344 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6342
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_decrease_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_decrease_tributary_tier_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6343 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6344 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6343
	desc = {
		text = EVTDESCA_SOH_6343
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6343
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6343
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6343 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6343 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6343 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6344 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6344
	is_triggered_only = yes
	title = EVTTITLE_SOH_6344
	desc = {
		text = EVTDESCA_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6344
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6344 # Accept the request
		
		event_target:grace_decision_taker = {
			decrease_tributary_tier_or_release_effect = yes
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6345 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6344 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6346 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6345
	desc = EVTDESC_SOH_6345
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6345 # Great!
		
		end_mourning_effect = yes
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6346
	desc = EVTDESC_SOH_6346
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6346 # Really?
	}
}



##### Request Border Adjustment

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6347
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	only_independent = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		has_dlc = "Jade Dragon"
		higher_tier_than = count
		is_tribal = no
		is_nomadic = no
		is_tributary = {
			type = chinese_client_state
		}
		suzerain = {
			is_chinese_emperor_trigger = yes
		}
		NOT = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		any_demesne_title = {
			OR = {
				AND = {
					tier = duke
					any_direct_de_jure_vassal_title = {
						holder_scope = {
							top_liege = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
				}
				AND = {
					higher_tier_than = duke
					any_de_jure_vassal_title = {
						holder_scope = {
							top_liege = {
								is_chinese_emperor_trigger = yes
							}
						}
					}
				}
			}
			NOR = {
				region = world_china
				de_jure_liege_or_above = e_china
			}
		}
		war = no
		prisoner = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		has_regent = no
		is_under_regency_trigger = no
		e_china = {
			holder_scope = {
				war = no
				prisoner = no
				NOT = { trait = incapable }
				is_inaccessible_or_incapable_trigger = no
				NOT = {
					has_truce = ROOT 
				}
			}
		}
		check_variable = {
			which = grace
			value = 5000 # Expensive, both because you're getting land from China and because it is meant to be a trap to drain your Grace so that you can't use that to avoid becoming a vassal
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
			random_realm_title = {
				limit = {
					tier = count
					OR = {
						AND = {
							tier = duke
							any_direct_de_jure_vassal_title = {
								holder_scope = {
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
							}
						}
						AND = {
							higher_tier_than = duke
							any_de_jure_vassal_title = {
								holder_scope = {
									top_liege = {
										is_chinese_emperor_trigger = yes
									}
								}
							}
						}
					}
					NOR = {
						region = world_china
						de_jure_liege_or_above = e_china
					}
				}
				preferred_limit = {
					ROOT = {
						primary_title = {
							any_de_jure_vassal_title = {
								title = PREVPREVPREV
							}
						}
					}
				}
				preferred_limit = {
					ROOT = {
						any_demesne_title = {
							tier = emperor
							any_de_jure_vassal_title = {
								title = PREVPREVPREV
							}
						}
					}
				}
				preferred_limit = {
					ROOT = {
						any_demesne_title = {
							tier = king
							any_de_jure_vassal_title = {
								title = PREVPREVPREV
							}
						}
					}
				}
				dejure_liege_title = {
					save_event_target_as = border_adjustment_duchy
				}
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = greedy
				}
				modifier = {
					factor = 2
					trait = proud
				}
				modifier = {
					factor = 0
					trait = content
				}
				modifier = {
					factor = 0.1
					trait = humble
				}
				modifier = {
					factor = 0.25
					trait = charitable
				}
				modifier = {
					factor = 10
					real_tier = emperor
				}
				modifier = {
					factor = 5
					real_tier = king
				}
				change_variable = {
					which = grace
					value = -5000
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_border_adjustment_boon_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_border_adjustment_boon_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6349 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6350 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6348
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_border_adjustment_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_border_adjustment_boon_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6349 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6350 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6349
	desc = {
		text = EVTDESCA_SOH_6349
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6349
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6349
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6349 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6349 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6349 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6350 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6350
	is_triggered_only = yes
	title = EVTTITLE_SOH_6350
	desc = {
		text = EVTDESCA_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6350
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6350 # Accept the request
		
		event_target:border_adjustment_duchy = {
			any_direct_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = {
							character = ROOT 
						}
					}
				}
				if = {
					limit = {
						holder_scope = {
							NOR = {
								any_demesne_title = {
									NOR = {
										de_jure_liege_or_above = event_target:border_adjustment_duchy
										title = event_target:border_adjustment_duchy
									}
								}
								any_vassal = {
									any_demesne_title = {
										NOR = {
											de_jure_liege_or_above = event_target:border_adjustment_duchy
											title = event_target:border_adjustment_duchy
										}
									}
								}
							}
						}
					}
					holder_scope = {
						opinion = {
							who = ROOT 
							modifier = border_adjustment_happened
						}
						set_defacto_liege = event_target:grace_decision_taker
					}
				}
				else = {
					event_target:grace_decision_taker = {
						grant_title_no_opinion = PREV
					}
				}
			}
			if = {
				limit = {
					has_holder = yes
					holder_scope = {
						top_liege = {
							character = ROOT 
						}
					}
				}
				holder_scope = {
					opinion = {
						who = ROOT 
						modifier = border_adjustment_happened
					}
				}
				event_target:grace_decision_taker = {
					grant_title_no_opinion = PREV
				}
			}
		}
		
		any_opinion_modifier_target = {
			limit = {
				ai = no
				reverse_has_opinion_modifier = {
					who = ROOT 
					modifier = border_adjustment_happened
				}
			}
			letter_event = { id = soh.6353 } # Inform affected vassals
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6351 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6350 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6352 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6351
	desc = EVTDESC_SOH_6351
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6351 # Great!
		
		end_mourning_effect = yes
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6352
	desc = EVTDESC_SOH_6352
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6352 # Really?
	}
}

# Affected vassals informed
letter_event = {
	id = soh.6353
	desc = EVTDESC_SOH_6353
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6353 # Really?
	}
}



##### Request Imperial Marriage (non-targeted)

### Independent

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6354
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_new_world_invader_or_vassal_trigger = no
		is_close_to_china_or_along_the_silk_road_trigger = yes
		OR = {
			independent = yes
			real_tier = king
			has_minor_title = title_grand_chancellor
			i_am_appropriate_regent_trigger = yes
			AND = {
				liege = {
					independent = yes
				}
				is_powerful_vassal = yes
			}
		}
		top_liege = {
			NOT = {
				government = chinese_imperial_government # Either under a pretender or a vassal of China
			}
		}
		OR = {
			is_feudal = yes
			is_tribal = yes
			is_nomadic = yes
		}
		e_china = {
			holder_scope = {
				is_chinese_emperor_trigger = yes
				any_dynasty_member = {
					is_valid_dragon_bride_candidate = yes
				}
			}
		}

		NOR = {
			any_war = {
				any_attacker = {
					character = ROOT
				}
				any_defender = {
					is_chinese_emperor_trigger = yes
				}
			}
			any_war = {
				any_attacker = {
					is_chinese_emperor_trigger = yes
				}
				any_defender = {
					character = ROOT
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			AND = {
				NOT = { has_character_modifier = peace_deal_with_china }
				OR = {
					check_variable = {
						which = grace
						value = 2000
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 1500
						}
					}
				}
			}
			AND = {
				has_character_modifier = peace_deal_with_china
				OR = {
					check_variable = {
						which = grace
						value = 1500
					}
					AND = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
						check_variable = {
							which = grace
							value = 1000
						}
					}
				}
			}
		}
		OR = {
			AND = {
				is_adult = yes
				is_married = no
				is_female = no
			}
			OR = {
				any_dynasty_member = {
					is_adult = yes
					is_married = no
					host = { character = ROOT }
					is_female = no
					is_landed = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					can_marry = yes
					is_betrothed = no
				}
				any_close_relative = {
					is_adult = yes
					is_married = no
					host = { character = ROOT }
					NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
					is_female = no
					is_landed = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					can_marry = yes
					is_betrothed = no
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			50 = {
				modifier = {
					factor = 0
					OR = {
						is_adult = no
						is_married = yes
						is_female = yes
						dynasty = event_target:eoc
					}
				}
				modifier = {
					factor = 0.1
					trait = homosexual
				}
				modifier = {
					factor = 0
					OR = {
						trait = eunuch
						trait = celibate
					}
				}
				modifier = {
					factor = 0.2
					trait = celibate
				}
				modifier = {
					factor = 5
					trait = lustful
					NOT = {
						trait = homosexual
					}
				}
				save_event_target_as = husband_to_be
			}
			50 = {
				modifier = {
					factor = 0
					NOR = {
						any_dynasty_member = {
							is_adult = yes
							is_married = no
							host = { character = ROOT }
							is_female = no
							is_landed = no
							prisoner = no
							NOT = { trait = incapable }
							is_inaccessible_trigger = no
							can_marry = yes
							is_betrothed = no
						}
						any_close_relative = {
							is_adult = yes
							is_married = no
							host = { character = ROOT }
							NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
							is_female = no
							is_landed = no
							prisoner = no
							NOT = { trait = incapable }
							is_inaccessible_trigger = no
							can_marry = yes
							is_betrothed = no
						}
					}
				}
				random_list = {
					90 = {
						random_dynasty_member = {
							limit = {
								is_adult = yes
								is_married = no
								host = { character = ROOT }
								is_female = no
								is_landed = no
								prisoner = no
								NOT = { trait = incapable }
								is_inaccessible_trigger = no
								can_marry = yes
								is_betrothed = no
							}
							preferred_limit = {
								any_close_relative = {
									character = ROOT
								}
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								any_close_relative = {
									character = ROOT
								}
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							preferred_limit = {
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							save_event_target_as = husband_to_be
						}
					}
					10 = {
						random_close_relative = {
							limit = {
								is_adult = yes
								is_married = no
								host = { character = ROOT }
								NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
								is_female = no
								is_landed = no
								prisoner = no
								NOT = { trait = incapable }
								is_inaccessible_trigger = no
								can_marry = yes
								is_betrothed = no
							}
							preferred_limit = {
								dynasty = ROOT
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								dynasty = ROOT
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							preferred_limit = {
								dynasty = ROOT
							}
							preferred_limit = {
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							save_event_target_as = husband_to_be
						}
					}
				}
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = FROM # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 0
					trait = content
				}
				modifier = {
					factor = 0.2
					trait = humble
				}
				modifier = {
					factor = 2
					real_tier = emperor
				}
				modifier = {
					factor = 0.1 # slow down
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							higher_tier_than = DUKE
						}
					}
				}
				modifier = {
					factor = 0.75
					FROM = {
						NOT = {
							independent = yes
						}
					}
				}
				if = {
					limit = {
						suzerain = {
							is_chinese_emperor_trigger = yes
						}
						OR = {
							is_tributary = {
								type = chinese_protectorate
							}
							is_tributary = {
								type = chinese_client_state
							}
						}
					}
					if = {
						limit = { has_character_modifier = peace_deal_with_china }
						change_variable = {
							which = grace
							value = -1000
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -1500
						}
						custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
					}	
				}
				else = {
					if = {
						limit = { has_character_modifier = peace_deal_with_china }
						change_variable = {
							which = grace
							value = -1500
						}
					}
					else = {
						change_variable = {
							which = grace
							value = -2000
						}
						custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_imperial_marriage_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_imperial_marriage_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6356 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6357 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6355
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6356 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6357 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6356
	desc = {
		text = EVTDESCA_SOH_6356
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6356
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6356
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6356 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6356 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6356 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6357 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6357
	is_triggered_only = yes
	title = EVTTITLE_SOH_6357
	desc = {
		text = EVTDESCA_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6357
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_dynasty_member = {
			limit = {
				is_valid_dragon_bride_candidate = yes
			}
			preferred_limit = {
				NOT = {
					any_lover = {
						character = ROOT
					}
				}
			}
			save_event_target_as = dragon_bride_to_be
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6357 # Accept the request
		
		event_target:dragon_bride_to_be = {
			remove_trait = dragon_bride_unmarried
			add_trait = dragon_bride_married
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6358 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6357 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6359 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:grace_decision_taker = {
				OR = {
					is_nomadic = yes
					is_tribal = yes
					independent = no
					lower_real_tier_than = king
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTC_SOH_6357 # Let's pick some lesser bride...
		
		character_event = { id = soh.6360 } # Pick some lesser bride
	}
}

# Request accepted
letter_event = {
	id = soh.6358
	desc = EVTDESC_SOH_6358
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6358 # Great!
		
		end_mourning_effect = yes
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6359
	desc = EVTDESC_SOH_6359
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6359 # Really?
	}
}

# Pick a lesser bride
character_event = {
	id = soh.6360
	desc = EVTDESC_SOH_6360
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6360 # A famous courtesan!
		
		create_chinese_courtesan_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6360 # A great beauty!
		
		create_chinese_beauty_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6360 # A famous entertainer!
		
		create_chinese_entertainer_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	after = {
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6361 } # Inform the recipient
		}
	}
}

# Inform the recipient of a non-imperial bride
letter_event = {
	id = soh.6361
	desc = {
		text = EVTDESCA_SOH_6361
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
				NOT = {
					any_child = {
						always = yes
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6361
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
				any_child = {
					always = yes
				}
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6361
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_beauty
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6361
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_entertainer
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
			}
		}
		name = EVTOPTA_SOH_6361 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = chaste
				event_target:husband_to_be = {
					character = ROOT
				}
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_beauty
			}
		}
		name = EVTOPTB_SOH_6361 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				event_target:husband_to_be = {
					character = ROOT
				}
			}
			modifier = {
				factor = 10
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_entertainer
			}
		}
		name = EVTOPTC_SOH_6361 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 2
				trait = poet
			}
			modifier = {
				factor = 2
				trait = scholar
			}
			modifier = {
				factor = 2
				trait = gregarious
			}
			modifier = {
				factor = 10
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			event_target:husband_to_be = {
				has_concubinage = yes
				OR = {
					NOR = {
						government = chinese_imperial_government
						government = eastern_imperial_government
						government = japanese_imperial_government
						government = divine_imperial_government
						num_of_consorts >= 3
					}
					AND = {
						government = eastern_imperial_government
						num_of_consorts < 9
					}
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
		name = EVTOPTD_SOH_6361 # She is only fit to be a concubine!
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
			add_consort = event_target:not_a_dragon_bride
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = cruel
			}
			modifier = {
				factor = 0.1
				event_target:not_a_dragon_bride = {
					trait = fair
				}
				event_target:husband_to_be = {
					character = ROOT
				}
				NOT = {
					trait = homosexual
				}
			}
		}
	}
	
	option = {
		name = EVTOPTE_SOH_6361 # Get out of my sight!
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			leave_court_effect = yes
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				AND = {
					NOT = {
						trait = kind
					}
					trait = zealous
					event_target:not_a_dragon_bride = {
						NOT = {
							religion = ROOT
						}
					}
				}
			}
			NOT = {
				event_target:not_a_dragon_bride = {
					any_child = {
						always = yes
					}
				}
			}
		}
		name = EVTOPTF_SOH_6361 # Guards! Kill her!
		
		if = {
			limit = {
				NOT = {
					trait = cruel
				}
			}
			add_trait = cruel
		}
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = cruel
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				AND = {
					NOT = {
						trait = kind
					}
					trait = zealous
					event_target:not_a_dragon_bride = {
						NOT = {
							religion = ROOT
						}
					}
				}
			}
			event_target:not_a_dragon_bride = {
				any_child = {
					always = yes
				}
			}
		}
		name = EVTOPTG_SOH_6361 # Guards! Kill her... and the children too!
		
		if = {
			limit = {
				NOT = {
					trait = cruel
				}
			}
			add_trait = cruel
		}
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		event_target:bastard_1 = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		event_target:bastard_2 = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = cruel
				}
			}
		}
	}
}

### Vassal

# on_five_year_pulse event for the AI
character_event = {
	id = soh.6362
	hide_window = yes
	
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	war = yes
	min_age = 16
	capable_only = yes
	ai = yes
	
	trigger = {
		is_chinese_emperor_trigger = no
		top_liege = {
			is_chinese_emperor_trigger = yes
		}
		OR = {
			is_feudal = yes
			is_tribal = yes
			is_nomadic = yes
		}
		e_china = {
			holder_scope = {
				is_chinese_emperor_trigger = yes
				any_dynasty_member = {
					is_valid_dragon_bride_candidate = yes
				}
			}
		}
		has_regent = no
		is_under_regency_trigger = no
		NOT = { trait = incapable }
		is_inaccessible_trigger = no
		OR = {
			check_variable = {
				which = grace
				value = 1000
			}
			AND = {
				has_minor_title = title_grand_chancellor
				check_variable = {
					which = grace
					value = 500
				}
			}
		}
		OR = {
			AND = {
				is_adult = yes
				is_married = no
				is_female = no
			}
			OR = {
				any_dynasty_member = {
					is_adult = yes
					is_married = no
					host = { character = ROOT }
					is_female = no
					is_landed = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					can_marry = yes
					is_betrothed = no
				}
				any_close_relative = {
					is_adult = yes
					is_married = no
					host = { character = ROOT }
					NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
					is_female = no
					is_landed = no
					prisoner = no
					NOT = { trait = incapable }
					is_inaccessible_trigger = no
					can_marry = yes
					is_betrothed = no
				}
			}
		}
	}
	
	immediate = {
		clear_grace_decision_flags_effect = yes # TODO
		e_china = {
			holder_scope = {
				save_event_target_as = eoc
			}
		}
		random_list = {
			50 = {
				modifier = {
					factor = 0
					OR = {
						is_adult = no
						is_married = yes
						is_female = yes
						dynasty = event_target:eoc
					}
				}
				modifier = {
					factor = 0.1
					trait = homosexual
				}
				modifier = {
					factor = 0
					OR = {
						trait = eunuch
						trait = celibate
					}
				}
				modifier = {
					factor = 0.2
					trait = celibate
				}
				modifier = {
					factor = 5
					trait = lustful
					NOT = {
						trait = homosexual
					}
				}
				save_event_target_as = husband_to_be
			}
			50 = {
				modifier = {
					factor = 0
					NOR = {
						any_dynasty_member = {
							is_adult = yes
							is_married = no
							host = { character = ROOT }
							is_female = no
							is_landed = no
							prisoner = no
							NOT = { trait = incapable }
							is_inaccessible_trigger = no
							can_marry = yes
							is_betrothed = no
						}
						any_close_relative = {
							is_adult = yes
							is_married = no
							host = { character = ROOT }
							NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
							is_female = no
							is_landed = no
							prisoner = no
							NOT = { trait = incapable }
							is_inaccessible_trigger = no
							can_marry = yes
							is_betrothed = no
						}
					}
				}
				random_list = {
					90 = {
						random_dynasty_member = {
							limit = {
								is_adult = yes
								is_married = no
								host = { character = ROOT }
								is_female = no
								is_landed = no
								prisoner = no
								NOT = { trait = incapable }
								is_inaccessible_trigger = no
								can_marry = yes
								is_betrothed = no
							}
							preferred_limit = {
								any_close_relative = {
									character = ROOT
								}
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								any_close_relative = {
									character = ROOT
								}
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							preferred_limit = {
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							save_event_target_as = husband_to_be
						}
					}
					10 = {
						random_close_relative = {
							limit = {
								is_adult = yes
								is_married = no
								host = { character = ROOT }
								NOT = { any_spouse = { character = ROOT } } #turns out without this, it includes your spouse
								is_female = no
								is_landed = no
								prisoner = no
								NOT = { trait = incapable }
								is_inaccessible_trigger = no
								can_marry = yes
								is_betrothed = no
							}
							preferred_limit = {
								dynasty = ROOT
								any_friend = {
									character = ROOT
								}
							}
							preferred_limit = {
								dynasty = ROOT
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							preferred_limit = {
								dynasty = ROOT
							}
							preferred_limit = {
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							save_event_target_as = husband_to_be
						}
					}
				}
			}
		}
		random_list = {
			75 = {
				# Do nothing
			}
			25 = {
				# Make the request
				modifier = {
					factor = 0
					NOT = {
						e_china = {
							holder_scope = {
								is_within_diplo_range = ROOT # If you're far from China, don't bother
							}
						}
					}
				}
				modifier = {
					factor = 10
					trait = ambitious
				}
				modifier = {
					factor = 5
					trait = proud
				}
				modifier = {
					factor = 0
					trait = content
				}
				modifier = {
					factor = 0.2
					trait = humble
				}
				modifier = {
					factor = 2
					real_tier = emperor
				}
				modifier = {
					factor = 0.1 # slow down
				}
				modifier = {
					factor = 0.5
					NOT = {
						higher_tier_than = DUKE
					}
				}
				modifier = {
					factor = 0.75
					NOT = {
						independent = yes
					}
				}
				if = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					change_variable = {
						which = grace
						value = -500
					}
				}
				else = {
					change_variable = {
						which = grace
						value = -1000
					}
				}
				save_event_target_as = grace_decision_taker
				if = {
					limit = {
						china_would_refuse_imperial_marriage_root_trigger = yes
					}
					set_character_flag = grace_refuse_offer
				}
				else_if = {
					limit = {
						china_would_accept_imperial_marriage_root_trigger = yes
					}
					set_character_flag = grace_accept_offer
				}
				else = {
					set_character_flag = grace_neutral_offer
				}
				if = {
					limit = {
						event_target:eoc = {
							primary_title = {
								OR = {
									has_law = grand_chancellor_law_1
									has_law = grand_chancellor_law_2
								}
							}
							persistent_event_target:my_grand_chancellor = {
								NOT = {
									character = ROOT 
								}
							}
						}
					}
					event_target:eoc = {
						persistent_event_target:my_grand_chancellor = {
							character_event = { id = soh.6364 } # EoC's GC has a say
						}
					}
				}
				else = {
					if = {
						limit = {
							event_target:eoc = {
								primary_title = {
									OR = {
										has_law = grand_chancellor_law_1
										has_law = grand_chancellor_law_2
									}
								}
								persistent_event_target:my_grand_chancellor = {
									character = ROOT 
								}
							}
						}
						set_character_flag = grace_accept_offer_gc
					}
					event_target:eoc = {
						narrative_event = { id = soh.6364 } # EoC gets request
					}
				}
			}
		}
	}
}

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6363
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6364 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6365 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6364
	desc = {
		text = EVTDESCA_SOH_6364
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6364
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6364
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6364 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6364 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6364 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6365 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6365
	is_triggered_only = yes
	title = EVTTITLE_SOH_6365
	desc = {
		text = EVTDESCA_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6365
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		random_dynasty_member = {
			limit = {
				is_valid_dragon_bride_candidate = yes
			}
			preferred_limit = {
				NOT = {
					any_lover = {
						character = ROOT
					}
				}
			}
			save_event_target_as = dragon_bride_to_be
		}
	}
	
	option = {
		name = EVTOPTA_SOH_6365 # Accept the request
		
		event_target:dragon_bride_to_be = {
			remove_trait = dragon_bride_unmarried
			add_trait = dragon_bride_married
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6366 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6365 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6367 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6366
	desc = EVTDESC_SOH_6366
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6366 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6367
	desc = EVTDESC_SOH_6367
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6367 # Really?
	}
}



##### Request Imperial Marriage (targeted)

### Independent

# The AI does not do targeted Imperial Marriages

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6368
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6369 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6370 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6369
	desc = {
		text = EVTDESCA_SOH_6369
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6369
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6369
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6369 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6369 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6369 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6370 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6370
	is_triggered_only = yes
	title = EVTTITLE_SOH_6370
	desc = {
		text = EVTDESCA_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6370
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6370 # Accept the request
		
		event_target:dragon_bride_to_be = {
			remove_trait = dragon_bride_unmarried
			add_trait = dragon_bride_married
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6371 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6370 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6372 } # Inform sender
		}
	}
	
	option = {
		trigger = {
			event_target:grace_decision_taker = {
				OR = {
					is_nomadic = yes
					is_tribal = yes
					independent = no
					lower_real_tier_than = king
					any_rival = {
						character = ROOT
					}
				}
			}
		}
		name = EVTOPTC_SOH_6370 # Let's pick some lesser bride...
		
		character_event = { id = soh.6373 } # Pick some lesser bride
	}
}

# Request accepted
letter_event = {
	id = soh.6371
	desc = EVTDESC_SOH_6371
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6371 # Great!
		
		end_mourning_effect = yes
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6372
	desc = EVTDESC_SOH_6372
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6372 # Really?
	}
}

# Pick a lesser bride
character_event = {
	id = soh.6373
	desc = EVTDESC_SOH_6373
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6373 # A famous courtesan!
		
		create_chinese_courtesan_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6373 # A great beauty!
		
		create_chinese_beauty_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6373 # A famous entertainer!
		
		create_chinese_entertainer_effect = yes
		
		event_target:not_a_dragon_bride = {
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
			if = {
				limit = {
					event_target:bastard_1 = {
						always = yes
					}
				}
				event_target:bastard_1 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
			if = {
				limit = {
					event_target:bastard_2 = {
						always = yes
					}
				}
				event_target:bastard_2 = {
					move_character = event_target:husband_to_be
					force_host = event_target:husband_to_be
				}
			}
		}
	}
	
	after = {
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6374 } # Inform the recipient
		}
	}
}

# Inform the recipient of a non-imperial bride
letter_event = {
	id = soh.6374
	desc = {
		text = EVTDESCA_SOH_6374
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
				NOT = {
					any_child = {
						always = yes
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6374
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
				any_child = {
					always = yes
				}
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6374
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_beauty
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6374
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_entertainer
			}
		}
	}
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_courtesan
			}
		}
		name = EVTOPTA_SOH_6374 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = chaste
				event_target:husband_to_be = {
					character = ROOT
				}
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_beauty
			}
		}
		name = EVTOPTB_SOH_6374 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 10
				trait = lustful
				NOT = {
					trait = homosexual
				}
				event_target:husband_to_be = {
					character = ROOT
				}
			}
			modifier = {
				factor = 10
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			event_target:not_a_dragon_bride = {
				has_character_flag = chinese_entertainer
			}
		}
		name = EVTOPTC_SOH_6374 # Works for me!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 2
				trait = poet
			}
			modifier = {
				factor = 2
				trait = scholar
			}
			modifier = {
				factor = 2
				trait = gregarious
			}
			modifier = {
				factor = 10
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			event_target:husband_to_be = {
				has_concubinage = yes
				OR = {
					NOR = {
						government = chinese_imperial_government
						government = eastern_imperial_government
						government = japanese_imperial_government
						government = divine_imperial_government
						num_of_consorts >= 3
					}
					AND = {
						government = eastern_imperial_government
						num_of_consorts < 9
					}
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
		name = EVTOPTD_SOH_6374 # She is only fit to be a concubine!
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
			add_consort = event_target:not_a_dragon_bride
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 0.1
				trait = cruel
			}
			modifier = {
				factor = 0.1
				event_target:not_a_dragon_bride = {
					trait = fair
				}
				event_target:husband_to_be = {
					character = ROOT
				}
				NOT = {
					trait = homosexual
				}
			}
		}
	}
	
	option = {
		name = EVTOPTE_SOH_6374 # Get out of my sight!
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			leave_court_effect = yes
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = kind
			}
			modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				AND = {
					NOT = {
						trait = kind
					}
					trait = zealous
					event_target:not_a_dragon_bride = {
						NOT = {
							religion = ROOT
						}
					}
				}
			}
			NOT = {
				event_target:not_a_dragon_bride = {
					any_child = {
						always = yes
					}
				}
			}
		}
		name = EVTOPTF_SOH_6374 # Guards! Kill her!
		
		if = {
			limit = {
				NOT = {
					trait = cruel
				}
			}
			add_trait = cruel
		}
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = cruel
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = cruel
				AND = {
					NOT = {
						trait = kind
					}
					trait = zealous
					event_target:not_a_dragon_bride = {
						NOT = {
							religion = ROOT
						}
					}
				}
			}
			event_target:not_a_dragon_bride = {
				any_child = {
					always = yes
				}
			}
		}
		name = EVTOPTG_SOH_6374 # Guards! Kill her... and the children too!
		
		if = {
			limit = {
				NOT = {
					trait = cruel
				}
			}
			add_trait = cruel
		}
		
		event_target:husband_to_be = {
			remove_spouse = event_target:not_a_dragon_bride
		}
		event_target:not_a_dragon_bride = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		event_target:bastard_1 = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		event_target:bastard_2 = {
			death = {
				death_reason = death_execution_beheading
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				NOT = {
					trait = cruel
				}
			}
		}
	}
}

### Vassal

# The AI does not do targeted Imperial Marriages

# Ping EoC and set up scopes if triggered from decision
character_event = {
	id = soh.6375
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = eoc
		clear_grace_decision_flags_effect = yes # TODO
		FROMFROM = {
			save_event_target_as = grace_decision_taker
		}
		if = {
			limit = {
				china_would_refuse_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_refuse_offer
			}
		}
		else_if = {
			limit = {
				china_would_accept_imperial_marriage_fromfrom_trigger = yes
			}
			FROMFROM = {
				set_character_flag = grace_accept_offer
			}
		}
		else = {
			FROMFROM = {
				set_character_flag = grace_neutral_offer
			}
		}
		if = {
			limit = {
				event_target:eoc = {
					primary_title = {
						OR = {
							has_law = grand_chancellor_law_1
							has_law = grand_chancellor_law_2
						}
					}
					persistent_event_target:my_grand_chancellor = {
						always = yes
					}
				}
			}
			event_target:eoc = {
				persistent_event_target:my_grand_chancellor = {
					character_event = { id = soh.6376 } # EoC's GC has a say
				}
			}
		}
		else = {
			if = {
				limit = {
					event_target:eoc = {
						primary_title = {
							OR = {
								has_law = grand_chancellor_law_1
								has_law = grand_chancellor_law_2
							}
						}
						persistent_event_target:my_grand_chancellor = {
							character = FROMFROM
						}
					}
				}
				FROMFROM = {
					set_character_flag = grace_accept_offer_gc
				}
			}
			event_target:eoc = {
				narrative_event = { id = soh.6377 } # EoC gets offer
			}
		}
	}
}

# GC might have a say
character_event = {
	id = soh.6376
	desc = {
		text = EVTDESCA_SOH_6376
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6376
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6376
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
	}
	
	picture = TODO
	border = TODO
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6376 # Indicate that the EOC should refuse
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_refuse_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6376 # Indicate that the EOC should accept
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_accept_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -100
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC_SOH_6376 # Indicate no strong preference
		
		event_target:grace_decision_taker = {
			set_character_flag = grace_neutral_offer_gc
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			prestige = -250
		}
		else_if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_neutral_offer
				}
			}
			prestige = -100
		}
	}
	
	after = {
		event_target:eoc = {
			narrative_event = { id = soh.6377 } # EoC informed of the request and the GC's position
		}
	}
}

# EoC gets the request (and possible recommendation)
narrative_event = {
	id = soh.6377
	is_triggered_only = yes
	title = EVTTITLE_SOH_6377
	desc = {
		text = EVTDESCA_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCB_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCC_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCD_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCE_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCF_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCG_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCH_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCI_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				NOR = {
					has_character_flag = grace_accept_offer_gc
					has_character_flag = grace_neutral_offer_gc
					has_character_flag = grace_refuse_offer_gc
				}
			}
		}
	}
	desc = {
		text = EVTDESCJ_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_accept_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCK_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_neutral_offer_gc
			}
		}
	}
	desc = {
		text = EVTDESCL_SOH_6377
		trigger = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
				has_character_flag = grace_refuse_offer_gc
			}
		}
	}
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_6377 # Accept the request
		
		event_target:dragon_bride_to_be = {
			remove_trait = dragon_bride_unmarried
			add_trait = dragon_bride_married
			
			hidden_tooltip = {
				any_lover = {
					random_list = {
						50 = {
							remove_lover = event_target:tribute_character
							modifier = {
								factor = 0.1
								event_target:tribute_character = {
									trait = homosexual
								}
							}
						}
						50 = {}
					}
				}
			}
			
			move_character = event_target:husband_to_be
			force_host = event_target:husband_to_be
			event_target:husband_to_be = {
				add_spouse = PREV
			}
		}
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_refuse_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6378 } # Inform sender
		}
	}
	
	option = {
		name = EVTOPTB_SOH_6377 # Refuse
		
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer_gc
				}
			}
			prestige = -500
			if = {
				limit = {
					primary_title = {
						has_law = grand_chancellor_law_2
					}
				}
				set_council_malcontent = yes
				any_realm_lord = {
					opinion = {
						who = ROOT 
						modifier = opinion_tyrant
					}
				}
			}
		}
		if = {
			limit = {
				event_target:grace_decision_taker = {
					has_character_flag = grace_accept_offer
				}
			}
			hidden_tooltip = {
				change_variable = {
					which = mandate_of_heaven
					value = -1
				}
			}
		}
		
		event_target:grace_decision_taker = {
			letter_event = { id = soh.6379 } # Inform sender
		}
	}
}

# Request accepted
letter_event = {
	id = soh.6378
	desc = EVTDESC_SOH_6378
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6378 # Great!
		
		set_character_flag = grace_character
	}
}

# Request refused
letter_event = {
	id = soh.6379
	desc = EVTDESC_SOH_6379
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_6379 # Really?
	}
}