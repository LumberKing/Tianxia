# Treasure Fleet major voyage events
# by Silverswee(e)per

namespace = soh

# IDs 8401-8500 reserved

##### Major voyage event setup

# Determine which major voyage event happens
province_event = {
	id = soh.8401
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				# Treasure Fleet becalmed
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8402 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8403 } # Others informed
				}
			}
			
			100 = {
				# Storm
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8404 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8405 } # Others informed
				}
			}
			
			25 = {
				mult_modifier = {
					factor = 0.1
					has_province_flag = treasure_fleet_fireworks
				}
				
				set_province_flag = treasure_fleet_fireworks
				
				# Fireworks
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8415 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8416 } # Others informed
				}
			}
			
			25 = {
				mult_modifier = {
					factor = 0.1
					has_province_flag = treasure_fleet_pirate_attack
				}
				
				set_province_flag = treasure_fleet_pirate_attack
				
				change_variable = {
					which = tf_fighting_value
					which = treasure_fleet_army_strength
				}
				
				multiply_variable = {
					which = tf_fighting_value
					value = 10
				}
				
				# Pirate attack
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8426 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					if = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8427 } # Others informed
					}
					
					any_courtier = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8427 } # Others informed
					}
				}
			}
			
			10 = {
				mult_modifier = {
					factor = 0.1
					has_province_flag = treasure_fleet_mutiny
				}
				
				set_province_flag = treasure_fleet_mutiny
				
				divide_variable = {
					which = treasure_fleet_army_strength
					value = 1.5
				}
				
				divide_variable = {
					which = treasure_fleet_ship_strength
					value = 1.5
				}
				
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_army_strength
								value = 1
							}
						}
					}
					
					set_variable = {
						which = treasure_fleet_army_strength
						value = 1
					}
				}
				
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = treasure_fleet_ship_strength
								value = 1
							}
						}
					}
					
					set_variable = {
						which = treasure_fleet_ship_strength
						value = 1
					}
				}
				
				change_variable = {
					which = tf_fighting_value
					which = treasure_fleet_army_strength
				}
				
				multiply_variable = {
					which = tf_fighting_value
					value = 10
				}
				
				# Great mutiny
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8437 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					if = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8438 } # Others informed
					}
					any_courtier = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8438 } # Others informed
					}
				}
			}
			
			1 = {
				trigger = {
					NOR = {
						has_game_rule = {
							name = supernatural_events
							value = off
						}
						has_province_flag = treasure_fleet_kraken
					}
				}
				
				set_province_flag = treasure_fleet_kraken
				
				change_variable = {
					which = tf_fighting_value
					which = treasure_fleet_army_strength
				}
				
				multiply_variable = {
					which = tf_fighting_value
					value = 10
				}
				
				# Kraken
				d_treasure_fleet = {
					holder_scope = {
						character_event = { id = soh.8449 } # Commander informed
					}
				}
				
				any_playable_ruler = {
					if = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8450 } # Others informed
					}
					
					any_courtier = {
						limit = {
							trait = treasure_fleet_voyage
							NOT = {
								has_character_flag = left_treasure_fleet_voyage
							}
						}
						
						character_event = { id = soh.8450 } # Others informed
					}
				}
			}
		}
	}
}



###### Major voyage events

### Becalmed

# Treasure Fleet becalmed - inform commander
character_event = {
	id = soh.8402
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		decrease_treasure_fleet_supplies_random_effect = yes
	}
}

# Treasure Fleet becalmed - inform anyone aboard
character_event = {
	id = soh.8403
	desc = EVTDESC_SOH_8403
	picture = GFX_evt_treasure_fleet
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8403 # Unfortunate!
	}
}

### Storm

# Storm - commander
character_event = {
	id = soh.8404
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			province_event = { id = soh.8406 days = 5 random = 10 } # Determine outcome
		}
	}
}

# Storm - characters on voyage
character_event = {
	id = soh.8405
	desc = EVTDESC_SOH_8405
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8405 # Grab on to something!
	}
}

# Determine what happens
province_event = {
	id = soh.8406
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8407 } # All ships are fine
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			5 = {
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
						
					character_event = { id = soh.8408 } # Minor damage
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			20 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value >= 2
					}
				}
				
				decrease_treasure_fleet_ship_strength_small_effect = yes
				
				# One ship destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								95 = {
									character_event = { id = soh.8409 } # Other ship destroyed
								}
								
								5 = {
									character_event = { id = soh.8410 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 5
					}
				}
				decrease_treasure_fleet_ship_strength_medium_effect = yes
				
				# A few ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								80 = {
									character_event = { id = soh.8409 } # Other ship destroyed
								}
								
								20 = {
									character_event = { id = soh.8410 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			10 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				decrease_treasure_fleet_ship_strength_large_effect = yes
				
				# Many ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								50 = {
									character_event = { id = soh.8409 } # Other ship destroyed
								}
								
								50 = {
									character_event = { id = soh.8410 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8409 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8410 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			1 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 25
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				# All remaining ships destroyed
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							character_event = { id = soh.8411 } # Treasure Fleet destroyed
						}
						
						character_event = { id = soh.8411 } # Treasure Fleet destroyed
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8411 } # Treasure Fleet destroyed
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8411 } # Treasure Fleet destroyed
							}
						}
						
						character_event = { id = soh.8412 } # Treasure Fleet destroyed
					}
				}
			}
		}
	}
}

# Storm - all ships are fine - inform characters on voyage
character_event = {
	id = soh.8407
	desc = EVTDESC_SOH_8407
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8407 # That wasn't so bad...
	}
}

# Storm - minor damage to ships - inform characters on voyage
character_event = {
	id = soh.8408
	desc = EVTDESC_SOH_8408
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8408 # Could have been a lot worse...
		
		random = {
			chance = 10
			add_trait_wounded_effect = yes
		}
	}
}

# Storm - other ship destroyed - inform characters on voyage
character_event = {
	id = soh.8409
	desc = EVTDESC_SOH_8409
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8409 # We should save all we can!
	}
}

# Storm - your ship destroyed - inform characters on voyage
character_event = {
	id = soh.8410
	desc = EVTDESC_SOH_8410
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8410 # I must swim to safety!
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				
				mult_modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					is_adult = no
				}
				
				death = {
					death_reason = death_drowned_storm
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 5
					is_strong_trigger = yes
				}
			}
		}
	}
}

# Storm - last ship destroyed - inform characters on voyage
character_event = {
	id = soh.8411
	desc = EVTDESC_SOH_8411
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8411 # Not like this!
		
		death = {
			death_reason = death_drowned_storm
		}
	}
}

# Treasure Fleet destroyed due to storm - inform EoC
character_event = {
	id = soh.8412
	desc = EVTDESC_SOH_8412
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8412 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.8413 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.8414 } # Inform the world
		}
	}
}

# Treasure Fleet destroyed due to storm - inform vassals
character_event = {
	id = soh.8413
	desc = EVTDESC_SOH_8413
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8413 # Most inauspicious!
	}
}

# Treasure Fleet destroyed due to storm - inform the world
character_event = {
	id = soh.8414
	desc = EVTDESC_SOH_8414
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_8414 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_8414 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}

### Fireworks

# Fireworks - commander
character_event = {
	id = soh.8415
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			province_event = { id = soh.8417 days = 5 random = 10 } # Determine outcome
		}
	}
}

# Fireworks - characters on voyage
character_event = {
	id = soh.8416
	desc = EVTDESC_SOH_8416
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8416 # Take cover!
	}
}

# Determine what happens
province_event = {
	id = soh.8417
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8418 } # All ships are fine
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			5 = {
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8419 } # Minor damage
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			20 = {
				decrease_treasure_fleet_ship_strength_small_effect = yes
				
				# One ship destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								95 = {
									character_event = { id = soh.8420 } # Other ship destroyed
								}
								
								5 = {
									character_event = { id = soh.8421 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 5
					}
				}
				
				decrease_treasure_fleet_ship_strength_medium_effect = yes
				
				# A few ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								80 = {
									character_event = { id = soh.8420 } # Other ship destroyed
								}
								
								20 = {
									character_event = { id = soh.8421 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			10 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				decrease_treasure_fleet_ship_strength_large_effect = yes
				
				# Many ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								50 = {
									character_event = { id = soh.8420 } # Other ship destroyed
								}
								
								50 = {
									character_event = { id = soh.8421 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8420 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8421 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			1 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 25
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				# All remaining ships destroyed
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							character_event = { id = soh.8422 } # Treasure Fleet destroyed
						}
						
						character_event = { id = soh.8422 } # Treasure Fleet destroyed
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8422 } # Treasure Fleet destroyed
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8422 } # Treasure Fleet destroyed
							}
						}
						
						character_event = { id = soh.8423 } # Treasure Fleet destroyed
					}
				}
			}
		}
	}
}

# Fireworks - all ships are fine - inform characters on voyage
character_event = {
	id = soh.8418
	desc = EVTDESC_SOH_8418
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8418 # That wasn't so bad...
	}
}

# Fireworks - minor damage to ships - inform characters on voyage
character_event = {
	id = soh.8419
	desc = EVTDESC_SOH_8419
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8419 # Could have been a lot worse...
		
		random = {
			chance = 5
			add_trait_wounded_effect = yes
		}
	}
}

# Fireworks - other ship destroyed - inform characters on voyage
character_event = {
	id = soh.8420
	desc = EVTDESC_SOH_8420
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8420 # We should save all we can!
	}
}

# Fireworks - your ship destroyed - inform characters on voyage
character_event = {
	id = soh.8421
	desc = EVTDESC_SOH_8421
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8421 # I must swim to safety!
		
		random_list = {
			75 = {}
			20 = {
				add_trait_wounded_effect = yes
			}
			5 = {
				add_maimed_trait_effect = yes
			}
		}
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				
				mult_modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					is_adult = no
				}
				
				death = {
					death_reason = death_drowned_storm
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 5
					is_strong_trigger = yes
				}
			}
		}
	}
}

# Fireworks - last ship destroyed - inform characters on voyage
character_event = {
	id = soh.8422
	desc = EVTDESC_SOH_8422
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8422 # Not like this!
		
		death = {
			death_reason = death_drowned_storm
		}
	}
}

# Treasure Fleet destroyed due to fireworks - inform EoC
character_event = {
	id = soh.8423
	desc = EVTDESC_SOH_8423
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8423 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.8424 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.8425 } # Inform the world
		}
	}
}

# Treasure Fleet destroyed due to fireworks - inform vassals
character_event = {
	id = soh.8424
	desc = EVTDESC_SOH_8424
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8424 # Most inauspicious!
	}
}

# Treasure Fleet destroyed due to fireworks - inform the world
character_event = {
	id = soh.8425
	desc = EVTDESC_SOH_8425
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_8425 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_8425 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}

### Pirate attack

# Pirates - commander
character_event = {
	id = soh.8426
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		random_list = {
			25 = {
				# Easy fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 50
					}
				}
			}
			
			70 = {
				# Middling fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 100
					}
				}
			}
			
			5 = {
				# Hard fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value = 200
					}
				}
			}
		}
		
		FROM = {
			province_event = { id = soh.8428 days = 5 random = 10 } # Determine outcome
		}
	}
}

# Pirates - characters on voyage
character_event = {
	id = soh.8427
	desc = EVTDESC_SOH_8427
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes
			is_actually_incapable_trigger = no
			combat_rating >= 0
		}
		
		name = EVTOPTA_SOH_8427 # To arms!
		
		add_trait_partially_brave_effect = yes
		
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
				
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_8427 # Hide!
		
		if = {
			limit = {
				is_adult = yes
				is_actually_incapable_trigger = no
			}
			
			add_trait_partially_craven_effect = yes
			
			prestige = -50
		}
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = brave
					is_adult = yes
					is_actually_incapable_trigger = no
					combat_rating >= 0
				}
			}
			
			factor = 100
		}
	}
}

# Determine what happens
province_event = {
	id = soh.8428
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		subtract_variable = {
			which = tf_fighting_value
			which = tf_fight_difficulty
		}
		
		random_list = {
			1 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8429 } # All ships are fine
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			5 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8430 } # Minor damage
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			20 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value < -25
					}
					
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 5
					}
				}
					
				decrease_treasure_fleet_army_strength_small_effect = yes
				
				decrease_treasure_fleet_ship_strength_small_effect = yes
				
				# One ship destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								95 = {
									character_event = { id = soh.8431 } # Other ship destroyed
								}
								
								5 = {
									character_event = { id = soh.8432 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -50
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value >= 25
					}
				}
					
				decrease_treasure_fleet_army_strength_medium_effect = yes
				
				decrease_treasure_fleet_ship_strength_medium_effect = yes
				
				# A few ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								80 = {
									character_event = { id = soh.8431 } # Other ship destroyed
								}
								
								20 = {
									character_event = { id = soh.8432 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			10 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value < 50
					}
					
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -100
					}
				}
					
				decrease_treasure_fleet_army_strength_large_effect = yes
				
				decrease_treasure_fleet_ship_strength_large_effect = yes
				
				# Many ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								50 = {
									character_event = { id = soh.8431 } # Other ship destroyed
								}
								
								50 = {
									character_event = { id = soh.8432 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8431 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8432 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			1 = {
				trigger = {
					OR = {
						check_variable = {
							which = tf_fighting_value
							value < 0
						}
						check_variable = {
							which = treasure_fleet_army_strength
							value < 5
						}
						check_variable = {
							which = treasure_fleet_ship_strength
							value < 5
						}
					}
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 25
					}
					check_variable = {
						which = treasure_fleet_army_strength
						value < 25
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_army_strength
						value < 10
					}
				}
				
				# All remaining ships destroyed
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							character_event = { id = soh.8433 } # Treasure Fleet destroyed
						}
						
						character_event = { id = soh.8433 } # Treasure Fleet destroyed
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8433 } # Treasure Fleet destroyed
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8433 } # Treasure Fleet destroyed
							}
						}
						
						character_event = { id = soh.8434 } # Treasure Fleet destroyed
					}
				}
			}
		}
	}
}

# Pirates - all ships are fine - inform characters on voyage
character_event = {
	id = soh.8429
	desc = EVTDESC_SOH_8429
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8429 # That wasn't so bad...
	}
}

# Pirates - minor damage to ships - inform characters on voyage
character_event = {
	id = soh.8430
	desc = EVTDESC_SOH_8430
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8430 # Could have been a lot worse...
		
		random = {
			chance = 5
			add_trait_wounded_effect = yes
		}
	}
}

# Pirates - other ship destroyed - inform characters on voyage
character_event = {
	id = soh.8431
	desc = EVTDESC_SOH_8431
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8431 # We should save all we can!
	}
}

# Pirates - your ship destroyed - inform characters on voyage
character_event = {
	id = soh.8432
	desc = EVTDESC_SOH_8432
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8432 # I must swim to safety!
		
		random_list = {
			50 = {}
			40 = {
				add_trait_wounded_effect = yes
			}
			10 = {
				add_maimed_trait_effect = yes
			}
			1 = {
				death = {
					death_reason = death_battle
				}
			}
		}
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				
				mult_modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					is_adult = no
				}
				
				death = {
					death_reason = death_accident_drowning
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 5
					is_strong_trigger = yes
				}
			}
		}
	}
}

# Pirates - last ship destroyed - inform characters on voyage
character_event = {
	id = soh.8433
	desc = EVTDESC_SOH_8433
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8433 # Not like this!
		
		death = {
			death_reason = death_battle
		}
	}
}

# Treasure Fleet destroyed due to pirates - inform EoC
character_event = {
	id = soh.8434
	desc = EVTDESC_SOH_8434
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8434 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.8435 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.8436 } # Inform the world
		}
	}
}

# Treasure Fleet destroyed due to pirates - inform vassals
character_event = {
	id = soh.8435
	desc = EVTDESC_SOH_8435
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8435 # Most inauspicious!
	}
}

# Treasure Fleet destroyed due to pirates - inform the world
character_event = {
	id = soh.8436
	desc = EVTDESC_SOH_8436
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_8436 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_8436 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}

### Great mutiny

# Mutiny - commander
character_event = {
	id = soh.8437
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		random_list = {
			25 = {
				# Easy fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value >= 50
					}
				}
			}
			
			70 = {
				# Middling fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value >= 100
					}
				}
			}
			
			5 = {
				# Hard fight
				FROM = {
					set_variable = {
						which = tf_fight_difficulty
						value >= 200
					}
				}
			}
		}
		
		FROM = {
			province_event = { id = soh.8439 days = 5 random = 10 } # Determine outcome
		}
	}
}

# Mutiny - characters on voyage
character_event = {
	id = soh.8438
	desc = EVTDESC_SOH_8438
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes
			is_actually_incapable_trigger = no
			combat_rating >= 0
		}
		
		name = EVTOPTA_SOH_8438 # To arms!
		
		add_trait_partially_brave_effect = yes
		
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
				
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_8438 # Hide!
		
		if = {
			limit = {
				is_adult = yes
				is_actually_incapable_trigger = no
			}
			
			add_trait_partially_craven_effect = yes
			
			prestige = -50
		}
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = brave
					is_adult = yes
					is_actually_incapable_trigger = no
					combat_rating >= 0
				}
			}
			
			factor = 100
		}
	}
}

# Determine what happens

province_event = {
	id = soh.8439
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		subtract_variable = {
			which = tf_fighting_value
			which = tf_fight_difficulty
		}
		
		random_list = {
			1 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8440 } # All ships are fine
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			5 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8441 } # Minor damage
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			20 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value < -25
					}
					
					check_variable = {
						which = treasure_fleet_ship_strength
						value >= 2
					}
				}
					
				decrease_treasure_fleet_army_strength_small_effect = yes
				
				decrease_treasure_fleet_ship_strength_small_effect = yes
				
				# One ship destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								95 = {
									character_event = { id = soh.8442 } # Other ship destroyed
								}
								
								5 = {
									character_event = { id = soh.8443 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 5
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -50
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value >= 25
					}
				}
					
				decrease_treasure_fleet_army_strength_medium_effect = yes
				
				decrease_treasure_fleet_ship_strength_medium_effect = yes
				
				# A few ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								80 = {
									character_event = { id = soh.8442 } # Other ship destroyed
								}
								
								20 = {
									character_event = { id = soh.8443 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			10 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value < 50
					}
					
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -100
					}
				}
					
				decrease_treasure_fleet_army_strength_large_effect = yes
				
				decrease_treasure_fleet_ship_strength_large_effect = yes
				
				# Many ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								50 = {
									character_event = { id = soh.8442 } # Other ship destroyed
								}
								
								50 = {
									character_event = { id = soh.8443 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8442 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8443 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			1 = {
				trigger = {
					OR = {
						check_variable = {
							which = tf_fighting_value
							value < 0
						}
						check_variable = {
							which = treasure_fleet_army_strength
							value < 5
						}
						check_variable = {
							which = treasure_fleet_ship_strength
							value < 5
						}
					}
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 25
					}
					check_variable = {
						which = treasure_fleet_army_strength
						value < 25
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_army_strength
						value < 10
					}
				}
				
				# All remaining ships destroyed
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							character_event = { id = soh.8444 } # Treasure Fleet destroyed
						}
						
						character_event = { id = soh.8444 } # Treasure Fleet destroyed
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8444 } # Treasure Fleet destroyed
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8444 } # Treasure Fleet destroyed
							}
						}
						
						character_event = { id = soh.8445 } # Treasure Fleet destroyed
					}
				}
			}
		}
	}
}

# Mutiny - all ships are fine - inform characters on voyage
character_event = {
	id = soh.8440
	desc = EVTDESC_SOH_8440
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8440 # That wasn't so bad...
	}
}

# Mutiny - minor damage to ships - inform characters on voyage
character_event = {
	id = soh.8441
	desc = EVTDESC_SOH_8441
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8441 # Could have been a lot worse...
		
		random = {
			chance = 5
			add_trait_wounded_effect = yes
		}
	}
}

# Mutiny - other ship destroyed - inform characters on voyage
character_event = {
	id = soh.8442
	desc = EVTDESC_SOH_8442
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8442 # We should save all we can!
	}
}

# Mutiny - your ship destroyed - inform characters on voyage
character_event = {
	id = soh.8443
	desc = EVTDESC_SOH_8443
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8443 # I must swim to safety!
		
		random_list = {
			50 = {}
			40 = {
				add_trait_wounded_effect = yes
			}
			10 = {
				add_maimed_trait_effect = yes
			}
			1 = {
				death = {
					death_reason = death_battle
				}
			}
		}
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				
				mult_modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					is_adult = no
				}
				
				death = {
					death_reason = death_accident_drowning
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 5
					is_strong_trigger = yes
				}
			}
		}
	}
}

# Mutiny - last ship destroyed - inform characters on voyage
character_event = {
	id = soh.8444
	desc = EVTDESC_SOH_8444
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8444 # Not like this!
		
		death = {
			death_reason = death_battle
		}
	}
}

# Treasure Fleet destroyed due to mutiny - inform EoC
character_event = {
	id = soh.8445
	desc = EVTDESC_SOH_8445
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8445 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.8446 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.8447 } # Inform the world
		}
		
		random_independent_ruler = {
			limit = {
				any_realm_province = {
					port = yes
					is_in_next_treasure_fleet_region_trigger = yes
				}
			}
				
			character_event = { id = soh.8448 days = 7 random = 7 } # Mutineers invade
		}
	}
}

# Treasure Fleet destroyed due to mutiny - inform vassals
character_event = {
	id = soh.8446
	desc = EVTDESC_SOH_8446
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8446 # Most inauspicious!
	}
}

# Treasure Fleet destroyed due to mutiny - inform the world
character_event = {
	id = soh.8447
	desc = EVTDESC_SOH_8447
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_8447 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_8447 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}

# Mutineers invade
character_event = {
	id = soh.8448
	desc = EVTDESC_SOH_8448
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		# TIANXIATODO: Scripted effect
		random_realm_province = {
			limit = {
				port = yes
				is_in_next_treasure_fleet_region_trigger = yes
			}
			
			save_event_target_as = invasion_province
		}
		
		FROMFROM = {
			persistent_event_target:treasure_fleet_sender = {
				save_event_target_as = treasure_fleet_sender
			}
		}
		
		create_random_soldier = {
			age = 30
			female = no # TO
			culture = event_target:treasure_fleet_sender
			religion = event_target:treasure_fleet_sender
			
			attributes = {
				martial = 12
				diplomacy = 6
				stewardship = 2
				intrigue = 12
				learning = 0
			}
			
			random_traits = no
			trait = brilliant_strategist
			trait = strategist
			trait = master_of_flame
			trait = levy_coordinator
			trait = ambitious
			trait = deceitful
			trait = greedy
			trait = proud
		}
		
		new_character = {
			save_event_target_as = tf_mutiny_leader
			set_character_flag = hes_a_pirate
			add_trait = pirate
			culture = wako
			
			random = {
				chance = 10
				add_trait = homosexual
			}
			
			detract_grace_super_huge_effect = yes
			
			e_china = {
				holder_scope = {
					opinion = {
						modifier = opinion_traitor
						who = PREVPREV
					}
				}
			}
			
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				adventurer = yes
				culture = PREV
				name = "PIRATE_ADVENTURE"
				holder = PREV
			}
			
			while = {
				count = 10
				spawn_unit = {
					province = event_target:invasion_province
					home = event_target:invasion_province
					owner = event_target:tf_mutiny_leader
					earmark = tf_mutiny
					cannot_inherit = yes
					troops = {
						light_infantry = { 300 300 } # Sailors
						heavy_infantry = { 200 200 }
						pikemen = { 200 200 }
						archers = { 200 200 }
						light_cavalry = { 50 50 } # Very little cavalry; horses are annoying to transport
						knights = { 50 50 } # Very little cavalry; horses are annoying to transport
					}
				}
			}
		
			# Create some decent commander characters
			create_random_soldier = {
				random_traits = yes
				dynasty = none
				religion = PREV
				culture = PREV
				female = no
				age = 30
			}
			
			create_random_soldier = {
				random_traits = yes
				dynasty = none
				religion = PREV
				culture = PREV
				female = no
				age = 25
			}
			
			create_random_soldier = {
				random_traits = yes
				dynasty = none
				religion = PREV
				culture = PREV
				female = no
				age = 33
			}
			
			create_random_soldier = {
				random_traits = yes
				dynasty = none
				religion = PREV
				culture = PREV
				female = no
				age = 29
			}
			
			# Create a fleet, just to be sure
			spawn_fleet = {
				province = closest # closest sea zone
				owner = ROOT
				earmark = tf_mutiny
				cannot_inherit = yes
				troops = {
					galleys = { 100 100 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_8448 # To arms!
		
		event_target:invasion_province = {
			duchy = {
				save_event_target_as = invasion_target
			}
		}
		
		event_target:tf_mutiny_leader = {
			reverse_unsafe_war = {
				target = ROOT
				casus_belli = treasure_fleet_mutiny_invasion
				thirdparty_title = event_target:invasion_target
			}
		}
	}
}

### Kraken

# Kraken - commander
character_event = {
	id = soh.8449
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		FROM = {
			set_variable = {
				which = tf_fight_difficulty
				value = 500
			}
		}
		
		FROM = {
			province_event = { id = soh.8451 days = 5 random = 10 } # Determine outcome
		}
	}
}

# Kraken - characters on voyage
character_event = {
	id = soh.8450
	desc = EVTDESC_SOH_8450
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_adult = yes
			is_actually_incapable_trigger = no
			combat_rating >= 0
		}
		
		name = EVTOPTA_SOH_8450 # To arms!
		
		add_trait_partially_brave_effect = yes
		
		hidden_tooltip = {
			export_to_variable = {
				which = tf_pcs
				value = combat_rating
			}
			
			divide_variable = {
				which = tf_pcs
				value = 10
			}
			
			export_to_variable = {
				which = tf_martial
				value = martial
			}
			
			divide_variable = {
				which = tf_martial
				value = 10
			}
			
			set_variable = {
				which = tf_fighting_value
				which = tf_pcs
			}
			
			change_variable = {
				which = tf_fighting_value
				which = tf_martial
			}
			
			FROM = {
				change_variable = {
					which = tf_fighting_value
					which = ROOT
				}
			}
		}
		
		ai_chance = {
			trigger = {
				NOT = {
					trait = craven
				}
			}
				
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_SOH_8450 # Hide!
		
		if = {
			limit = {
				is_adult = yes
				is_actually_incapable_trigger = no
			}
			
			add_trait_partially_craven_effect = yes
			
			prestige = -50
		}
		
		ai_chance = {
			trigger = {
				NAND = {
					trait = brave
					is_adult = yes
					is_actually_incapable_trigger = no
					combat_rating >= 0
				}
			}
			
			factor = 100
		}
	}
}

# Determine what happens
province_event = {
	id = soh.8451
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		subtract_variable = {
			which = tf_fighting_value
			which = tf_fight_difficulty
		}
		
		random_list = {
			1 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8452 } # All ships are fine
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			5 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= 0
					}
				}
				
				any_playable_ruler = {
					limit = {
						ai = no
						trait = treasure_fleet_voyage
						NOT = {
							has_character_flag = left_treasure_fleet_voyage
						}
					}
					
					character_event = { id = soh.8453 } # Minor damage
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			20 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value >= -25
					}
					
					check_variable = {
						which = treasure_fleet_ship_strength
						value >= 2
					}
				}
					
				decrease_treasure_fleet_army_strength_small_effect = yes
				
				decrease_treasure_fleet_ship_strength_small_effect = yes
				
				# One ship destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								95 = {
									character_event = { id = soh.8454 } # Other ship destroyed
								}
								
								5 = {
									character_event = { id = soh.8455 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									95 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									5 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			50 = {
				trigger = {
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 5
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -50
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value >= 25
					}
				}
					
				decrease_treasure_fleet_army_strength_medium_effect = yes
				
				decrease_treasure_fleet_ship_strength_medium_effect = yes
				
				# A few ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								80 = {
									character_event = { id = soh.8454 } # Other ship destroyed
								}
								
								20 = {
									character_event = { id = soh.8455 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									80 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									20 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			10 = {
				trigger = {
					check_variable = {
						which = tf_fighting_value
						value < 50
					}
					check_variable = {
						which = treasure_fleet_ship_strength
						value > 10
					}
				}
				
				mult_modifier = {
					factor = 0.1
					check_variable = {
						which = tf_fighting_value
						value < -100
					}
				}
					
				decrease_treasure_fleet_army_strength_large_effect = yes
				
				decrease_treasure_fleet_ship_strength_large_effect = yes
				
				# Many ships destroyed
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							random_list = {
								50 = {
									character_event = { id = soh.8454 } # Other ship destroyed
								}
								
								50 = {
									character_event = { id = soh.8455 } # Your ship destroyed
								}
							}
						}
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								random_list = {
									50 = {
										character_event = { id = soh.8454 } # Other ship destroyed
									}
									
									50 = {
										character_event = { id = soh.8455 } # Your ship destroyed
									}
								}
							}
						}
					}
				}
				
				clr_global_flag = treasure_fleet_voyage
				
				set_global_flag = treasure_fleet_arrival
				
				if = {
					limit = {
						has_province_flag = treasure_fleet_going_to_china
					}
					
					set_global_flag = treasure_fleet_next_stop_china
				}
			}
			
			1 = {
				trigger = {
					OR = {
						check_variable = {
							which = tf_fighting_value
							value < 0
						}
						check_variable = {
							which = treasure_fleet_army_strength
							value < 5
						}
						check_variable = {
							which = treasure_fleet_ship_strength
							value < 5
						}
					}
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 25
					}
					check_variable = {
						which = treasure_fleet_army_strength
						value < 25
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_ship_strength
						value < 10
					}
				}
				
				mult_modifier = {
					factor = 10
					check_variable = {
						which = treasure_fleet_army_strength
						value < 10
					}
				}
				
				# All remaining ships destroyed
				set_global_flag = treasure_fleet_destroyed
				
				d_treasure_fleet = {
					holder_scope = {
						any_courtier = {
							limit = {
								is_landed = no
								trait = treasure_fleet_voyage
								NOT = {
									has_character_flag = left_treasure_fleet_voyage
								}
							}
							
							character_event = { id = soh.8456 } # Treasure Fleet destroyed
						}
						
						character_event = { id = soh.8456 } # Treasure Fleet destroyed
					}
				}
				
				e_china = {
					holder_scope = {
						any_realm_lord = {
							if = {
								limit = {
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8456 } # Treasure Fleet destroyed
							}
							
							any_courtier = {
								limit = {
									is_landed = no
									trait = treasure_fleet_voyage
									NOT = {
										has_character_flag = left_treasure_fleet_voyage
									}
								}
								
								character_event = { id = soh.8456 } # Treasure Fleet destroyed
							}
						}
						
						character_event = { id = soh.8457 } # Treasure Fleet destroyed
					}
				}
			}
		}
	}
}

# Kraken - all ships are fine - inform characters on voyage
character_event = {
	id = soh.8452
	desc = EVTDESC_SOH_8452
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8452 # That wasn't so bad...
	}
}

# Kraken - minor damage to ships - inform characters on voyage
character_event = {
	id = soh.8453
	desc = EVTDESC_SOH_8453
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8453 # Could have been a lot worse...
		
		random = {
			chance = 5
			add_trait_wounded_effect = yes
		}
	}
}

# Kraken - other ship destroyed - inform characters on voyage
character_event = {
	id = soh.8454
	desc = EVTDESC_SOH_8454
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8454 # We should save all we can!
	}
}

# Kraken - your ship destroyed - inform characters on voyage
character_event = {
	id = soh.8455
	desc = EVTDESC_SOH_8455
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8455 # I must swim to safety!
		
		random_list = {
			50 = {}
			40 = {
				add_trait_wounded_effect = yes
			}
			10 = {
				add_maimed_trait_effect = yes
			}
			1 = {
				death = {
					death_reason = death_kraken
				}
			}
		}
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 5
					is_weak_trigger = yes
				}
				
				mult_modifier = {
					factor = 5
					is_maimed_trigger = yes
				}
				
				mult_modifier = {
					factor = 2
					is_adult = no
				}
				
				death = {
					death_reason = death_accident_drowning
				}
			}
			
			50 = {
				mult_modifier = {
					factor = 5
					is_strong_trigger = yes
				}
			}
		}
	}
}

# Kraken - last ship destroyed - inform characters on voyage
character_event = {
	id = soh.8456
	desc = EVTDESC_SOH_8456
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8456 # Not like this!
		
		death = {
			death_reason = death_kraken
		}
	}
}

# Treasure Fleet destroyed due to kraken - inform EoC
character_event = {
	id = soh.8457
	desc = EVTDESC_SOH_8457
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8457 # Most inauspicious!
		
		prestige = -1000
		
		hidden_tooltip = {
			mandate_penalty_massive_effect = yes
		}
		
		any_realm_lord = {
			limit = {
				NAND = {
					trait = treasure_fleet_voyage
					NOT = {
						has_character_flag = left_treasure_fleet_voyage
					}
				}
				ai = no
			}
			
			character_event = { id = soh.8458 } # Inform vassals
		}
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					top_liege = {
						character = ROOT
					}
				}
			}
			
			character_event = { id = soh.8459 } # Inform the world
		}
	}
}

# Treasure Fleet destroyed due to kraken - inform vassals
character_event = {
	id = soh.8458
	desc = EVTDESC_SOH_8458
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_8458 # Most inauspicious!
	}
}

# Treasure Fleet destroyed due to kraken - inform the world
character_event = {
	id = soh.8459
	desc = EVTDESC_SOH_8459
	picture = GFX_evt_kraken
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_8459 # So much for that...
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
		}
		
		name = EVTOPTB_SOH_8459 # How auspicious!
		
		hidden_tooltip = {
			mandate_boost_small_effect = yes
		}
	}
}