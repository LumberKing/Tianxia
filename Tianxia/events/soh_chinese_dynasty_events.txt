##### Chinese dynasty events
# by Silverswee(e)per

namespace = soh

# soh.5501-5700 reserved

# TODO: Event pictures
# TODO: Cleanup of old names
# TODO: Lots and lots of options
# TODO: Scripted triggers/effects
# TODO: CI law changes

##### (Re)creating China

# Normal (re)creation of China
narrative_event = {
	id = soh.5501
	is_triggered_only = yes
	title = EVTTITLE_SOH_5501
	desc = EVTDESC_SOH_5501
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		e_china = {
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5501 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5502 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5502
	is_triggered_only = yes
	title = EVTTITLE_SOH_5502
	desc = EVTDESC_SOH_5502
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5502 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5502 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5502 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5502 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5502 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5502 # This does not concern me...
	}
}

# Special CI recreation of China
narrative_event = {
	id = soh.5503
	is_triggered_only = yes
	title = EVTTITLE_SOH_5503
	desc = EVTDESC_SOH_5503
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		e_china = {
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5503 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5504 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5504
	is_triggered_only = yes
	title = EVTTITLE_SOH_5504
	desc = EVTDESC_SOH_5504
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5504 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5504 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5504 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5504 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5504 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5504 # This does not concern me...
	}
}



##### Founding a pretender empire

# Name the pretender
narrative_event = {
	id = soh.5505
	is_triggered_only = yes
	title = EVTTITLE_SOH_5505
	desc = EVTDESC_SOH_5505
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		primary_title = {
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5505 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
						NOT = {
							has_opinion_modifier = {
								who = ROOT
								modifier = breakaway_pretender
							}
						}
					}
				}
				narrative_event = { id = soh.5506 } # Inform the world
			}
			event_target:new_eoc = {
				narrative_event = { id = soh.5507 } # Inform the EoC
			}
			event_target:former_eoc = {
				if = {
					limit = {
						is_landed = yes
					}
					narrative_event = { id = soh.5507 } # Inform the former EoC
				}
				else_if = {
					limit = {
						event_target:former_eoc_heir = {
							independent = yes
						}
					}
					event_target:former_eoc_heir = {
						narrative_event = { id = soh.5508 } # Inform the EoC
					}
				}
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5506
	is_triggered_only = yes
	title = EVTTITLE_SOH_5506
	desc = EVTDESC_SOH_5506
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5506 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5506 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5506 # I am the true Emperor of China!
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5506 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5506 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5506 # This does not concern me...
	}
}

# If relevant, inform new Eoc
narrative_event = {
	id = soh.5507
	is_triggered_only = yes
	title = EVTTITLE_SOH_5507
	desc = EVTDESC_SOH_5507
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5507 # Traitor!
		
		FROM = {
			any_demesne_title = {
				limit = {
					NOT = {
						tier = emperor
					}
				}
				add_weak_pressed_claim = ROOT
			}
		}
	}
}

# If relevant, inform former EoC
narrative_event = {
	id = soh.5508
	is_triggered_only = yes
	title = EVTTITLE_SOH_5508
	desc = EVTDESC_SOH_5508
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5508 # Traitor!
		
		FROM = {
			any_demesne_title = {
				limit = {
					NOT = {
						tier = emperor
					}
				}
				add_weak_pressed_claim = ROOT
			}
		}
	}
}



##### Inheritance of pretender empire

# Hidden setup
character_event = {
	id = soh.5509
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			tier = emperor
			has_title_flag = pretender_chinese_empire
		}
		NOT = {
			any_demesne_title = {
				tier = emperor
				NOT = {
					title = FROM
				}
				OR = {
					title = e_china # Special case: Destroy the pretender empire
					has_title_flag = pretender_chinese_empire # Special case: Destroy the pretender empire
				}
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			save_event_target_as = old_pretender_emperor
		}
		if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
			}
			# Do nothing
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = no
			}
			if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = yes
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
				}
				character_event = { id = soh.5510 } # Wrong culture - convert?
			}
			else_if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = no
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes # If you've got some weird culture, you don't get the choice
					controls_religion = no
				}
				character_event = { id = soh.5511 } # Wrong culture - convert?
			}
			else = {
				narrative_event = { id = soh.5513 } # You are no longer Chinese Imperial
			}
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
			}
			character_event = { id = soh.5515 } # Remain a pretender?
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = no
			}
			narrative_event = { id = soh.5519 } # You are no longer Chinese Imperial
		}
	}
}

# Inherited pretender from the same dynasty or a close relative - ineligible for Chinese Imperial due to culture - convert?
character_event = {
	id = soh.5510
	desc = EVTDESC_SOH_5510
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5510 # I will change my culture!
		
		culture = event_target:old_pretender_emperor
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5510 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5512 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
				e_china = {
					OR = {
						has_holder = no
						holder_scope = {
							OR = {
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
		}
	}
}

# Inherited pretender from the same dynasty or a close relative - ineligible for Chinese Imperial due to religion - convert?
character_event = {
	id = soh.5511
	desc = EVTDESC_SOH_5511
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = zealous
				}
				true_religion = event_target:old_pretender_emperor
			}
		}
		name = EVTOPTA_SOH_5511 # I will change my religion!
		
		religion = event_target:old_pretender_emperor
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5511 # I would rather stop being Chinese Imperial...
		
		piety = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5512 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				true_religion = event_target:old_pretender_emperor
			}
			modifier = {
				factor = 0.1
				trait = cynical
				e_china = {
					OR = {
						has_holder = no
						holder_scope = {
							OR = {
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
			modifier = {
				factor = 0 # One false faith is the same as any other...
				has_secret_religion = yes
			}
		}
	}
}

# The pretender did not convert - inform the world
narrative_event = {
	id = soh.5512
	is_triggered_only = yes
	title = EVTTITLE_SOH_5512
	desc = EVTDESC_SOH_5512
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5512 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5512 # Interesting...
	}
}

# The pretender was wholly ineligible - pretender
narrative_event = {
	id = soh.5513
	is_triggered_only = yes
	title = EVTTITLE_SOH_5513
	desc = EVTDESC_SOH_5513
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5513 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5514 } # Inform the world
		}
	}
}

# Inform the world about ineligible pretender
narrative_event = {
	id = soh.5514
	is_triggered_only = yes
	title = EVTTITLE_SOH_5514
	desc = EVTDESC_SOH_5514
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5514 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5514 # Interesting...
	}
}

# Inherited pretender from another dynasty and not a close relative - eligible - do you want to continue being a pretender?
character_event = {
	id = soh.5515
	desc = EVTDESC_SOH_5515
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5515 # I will continue being a pretender!
		
		narrative_event = { id = soh.5516 } # Rename the pretender empire
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = content
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						OR = {
							has_character_modifier = mandate_of_heaven_5
							has_character_modifier = mandate_of_heaven_4
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5515 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5518 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
				e_china = {
					OR = {
						holder_scope = {
							OR = {
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				e_china = {
					has_holder = no # FDaTK or similar
				}
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# If still a pretender, select a dynasty name
narrative_event = {
	id = soh.5516
	is_triggered_only = yes
	title = EVTTITLE_SOH_5516
	desc = EVTDESC_SOH_5516
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		primary_title = {
			save_pretender_name_effect = yes
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5516 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
						NOT = {
							has_opinion_modifier = {
								who = ROOT
								modifier = breakaway_pretender
							}
						}
					}
				}
				narrative_event = { id = soh.5517 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5517
	is_triggered_only = yes
	title = EVTTITLE_SOH_5517
	desc = EVTDESC_SOH_5517
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5517 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5517 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5517 # I am the true Emperor of China!
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5517 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5517 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5517 # This does not concern me...
	}
}

# Inform the world about a pretender ceasing to be a pretender
narrative_event = {
	id = soh.5518
	is_triggered_only = yes
	title = EVTTITLE_SOH_5518
	desc = EVTDESC_SOH_5518
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5518 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5518 # Interesting...
	}
}

# Inherited pretender from another dynasty and not a close relative - ineligible
narrative_event = {
	id = soh.5519
	is_triggered_only = yes
	title = EVTTITLE_SOH_5519
	desc = EVTDESC_SOH_5519
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5519 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5520 } # Inform the world
		}
	}
}

# Inform the world about a pretender ceasing to be a pretender
narrative_event = {
	id = soh.5520
	is_triggered_only = yes
	title = EVTTITLE_SOH_5520
	desc = EVTDESC_SOH_5520
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5520 # As expected!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5520 # Interesting...
	}
}



##### Inheritance of China

# Hidden setup
character_event = {
	id = soh.5521
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			title = e_china
		}
	}
	
	immediate = {
		FROMFROM = {
			save_event_target_as = old_emperor_of_china
		}
		if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			# Do nothing
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				e_china = {
					has_any_chinese_dynasty_name_trigger = yes
				}
			}
			character_event = { id = soh.5522 } # Inform the new EoC
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				e_china = {
					has_any_chinese_dynasty_name_trigger = no
				}
			}
			narrative_event = { id = soh.5524 } # Select a dynasty name
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			narrative_event = { id = soh.5526 } # New dynasty name selection
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
			}
			narrative_event = { id = soh.5528 } # New dynasty name selection
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			character_event = { id = soh.5530 } # Pretender takes over
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			narrative_event = { id = soh.5533 } # Pretender takes over
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
			}
			narrative_event = { id = soh.5535 } # Pretender takes over
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
			}
			narrative_event = { id = soh.5537 } # Pretender takes over
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_only_religion_trigger = yes
				has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
				FROMFROM = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			narrative_event = { id = soh.5539 } # Ineligible due to culture - convert?
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_only_religion_trigger = no
				has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
				FROMFROM = {
					can_have_chinese_imperial_trigger = yes
				}
				controls_religion = no
			}
			narrative_event = { id = soh.5540 } # Ineligible due to religion - convert?
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = no
			}
			narrative_event = { id = soh.5542 } # Wholly ineligible
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = no
			}
			narrative_event = { id = soh.5544 } # Wholly ineligible
		}
	}
}

# Old EoC was non-CI, China has dynasty name, inherited by same dynasty/close relative non-pretender
character_event = {
	id = soh.5522
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5523 } # Inform the world
		}
	}
}

# Inform the world about the new EoC
narrative_event = {
	id = soh.5523
	is_triggered_only = yes
	title = EVTTITLE_SOH_5523
	desc = EVTDESC_SOH_5523
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5523 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5523 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5523 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5523 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5523 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5523 # This does not concern me...
	}
}

# Old EoC was non-CI, China does not have dynasty name, inherited by same dynasty/close relative non-pretender
narrative_event = {
	id = soh.5524
	is_triggered_only = yes
	title = EVTTITLE_SOH_5524
	desc = EVTDESC_SOH_5524
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5524 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5525 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5525
	is_triggered_only = yes
	title = EVTTITLE_SOH_5525
	desc = EVTDESC_SOH_5525
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5525 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5523 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5525 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5525 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5525 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5525 # This does not concern me...
	}
}

# Old EoC was CI, inherited by other dynasty non-close relative non-pretender
narrative_event = {
	id = soh.5526
	is_triggered_only = yes
	title = EVTTITLE_SOH_5526
	desc = EVTDESC_SOH_5526
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		e_china = {
			save_dynasty_name_effect = yes
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5526 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5527 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5527
	is_triggered_only = yes
	title = EVTTITLE_SOH_5527
	desc = EVTDESC_SOH_5527
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5527 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5527 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5527 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5527 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5527 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5527 # This does not concern me...
	}
}

# Old EoC was non-CI, inherited by other dynasty non-close relative non-pretender
narrative_event = {
	id = soh.5528
	is_triggered_only = yes
	title = EVTTITLE_SOH_5528
	desc = EVTDESC_SOH_5528
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		e_china = {
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5528 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5529 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5529
	is_triggered_only = yes
	title = EVTTITLE_SOH_5529
	desc = EVTDESC_SOH_5529
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5529 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5529 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5529 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5529 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5529 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5529 # This does not concern me...
	}
}

# Old EoC was CI, inherited by same dynasty/close relative pretender
character_event = {
	id = soh.5530
	desc = EVTDESC_SOH_5530
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5530 # I will end the pretender dynasty!
		
		clean_up_chinese_pretender_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5531 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5530 # I will keep the pretender dynasty!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5532 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
}

# Inform the world that the pretender kept the same dynasty
narrative_event = {
	id = soh.5531
	is_triggered_only = yes
	title = EVTTITLE_SOH_5531
	desc = EVTDESC_SOH_5531
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5531 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5531 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5531 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5531 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5531 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5531 # This does not concern me...
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5532
	is_triggered_only = yes
	title = EVTTITLE_SOH_5532
	desc = EVTDESC_SOH_5532
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5532 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5532 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5532 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5532 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5532 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5532 # This does not concern me...
	}
}

# Old EoC was CI, inherited by other dynasty non-close relative pretender
character_event = {
	id = soh.5533
	desc = EVTDESC_SOH_5533
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5533 # My dynasty endures!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5534 } # Inform the world
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5534
	is_triggered_only = yes
	title = EVTTITLE_SOH_5534
	desc = EVTDESC_SOH_5534
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5534 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5534 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5534 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5534 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5534 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5534 # This does not concern me...
	}
}

# Old EoC was non-CI, inherited by same dynasty/close relative pretender
character_event = {
	id = soh.5535
	desc = EVTDESC_SOH_5535
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5535 # My dynasty endures!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5536 } # Inform the world
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5536
	is_triggered_only = yes
	title = EVTTITLE_SOH_5536
	desc = EVTDESC_SOH_5536
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5536 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5536 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5536 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5536 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5536 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5536 # This does not concern me...
	}
}

# Old EoC was non-CI, inherited by other dynasty non-close relative pretender
character_event = {
	id = soh.5537
	desc = EVTDESC_SOH_5537
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5537 # My dynasty endures!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5538 } # Inform the world
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5538
	is_triggered_only = yes
	title = EVTTITLE_SOH_5538
	desc = EVTDESC_SOH_5538
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5538 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5538 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5538 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5538 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5538 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5538 # This does not concern me...
	}
}

# Inherited China from the same dynasty or a close relative - ineligible for Chinese Imperial due to culture - convert?
character_event = {
	id = soh.5539
	desc = EVTDESC_SOH_5539
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5539 # I will change my culture!
		
		culture = event_target:old_emperor_of_china
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5539 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_dynasty_effect = yes # Clear out Grace and Chinese Princesses
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5541 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
}

# Inherited China from the same dynasty or a close relative - ineligible for Chinese Imperial due to religion - convert?
character_event = {
	id = soh.5540
	desc = EVTDESC_SOH_5540
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = zealous
				}
				true_religion = event_target:old_emperor_of_china
			}
		}
		name = EVTOPTA_SOH_5540 # I will change my religion!
		
		religion = event_target:old_emperor_of_china
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5540 # I would rather stop being Chinese Imperial...
		
		piety = 100
		
		clean_up_chinese_dynasty_effect = yes # Clear out Grace and Chinese Princesses
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5541 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				true_religion = event_target:old_emperor_of_china
			}
			modifier = {
				factor = 0.1
				trait = cynical
			}
			modifier = {
				factor = 0 # One false faith is the same as any other...
				has_secret_religion = yes
			}
		}
	}
}

# The new EoC did not convert - inform the world
narrative_event = {
	id = soh.5541
	is_triggered_only = yes
	title = EVTTITLE_SOH_5541
	desc = EVTDESC_SOH_5541
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5541 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5541 # Interesting...
	}
}

# The EoC was wholly ineligible - EoC
narrative_event = {
	id = soh.5542
	is_triggered_only = yes
	title = EVTTITLE_SOH_5542
	desc = EVTDESC_SOH_5542
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5542 # It was not meant to be!
		
		clean_up_chinese_dynasty_effect = yes # Clear out Grace and Chinese Princesses
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5543 } # Inform the world
		}
	}
}

# Inform the world about ineligible EoC
narrative_event = {
	id = soh.5543
	is_triggered_only = yes
	title = EVTTITLE_SOH_5543
	desc = EVTDESC_SOH_5543
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5543 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5543 # Interesting...
	}
}

# Inherited China from another dynasty and not a close relative - ineligible
narrative_event = {
	id = soh.5544
	is_triggered_only = yes
	title = EVTTITLE_SOH_5544
	desc = EVTDESC_SOH_5544
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5544 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5545 } # Inform the world
		}
	}
}

# Inform the world - China is no longer Chinese Imperial
narrative_event = {
	id = soh.5546
	is_triggered_only = yes
	title = EVTTITLE_SOH_5546
	desc = EVTDESC_SOH_5546
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5546 # As expected!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5546 # Interesting...
	}
}



##### Usurpation of pretender

# Hidden setup
character_event = {
	id = soh.5547
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			tier = emperor
			has_title_flag = pretender_chinese_empire
		}
		NOR = {
			has_landed_title = e_china # Special case
			any_demesne_title = {
				NOT = {
					title = FROM
				}
				has_title_flag = pretender_chinese_empire # Special case
			}
		}
	}
	
	immediate = {
		FROMFROM = {
			save_event_target_as = old_pretender_emperor
		}
		if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = yes
			}
			# Do nothing
		}
		else_if = {
			limit = {
				OR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
				can_have_chinese_imperial_trigger = no
			}
			if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = yes
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
				}
				character_event = { id = soh.5548 } # Wrong culture - convert?
			}
			else_if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = no
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes # If you've got some weird culture, you don't get the choice
					controls_religion = no
				}
				character_event = { id = soh.5549 } # Wrong culture - convert?
			}
			else = {
				narrative_event = { id = soh.5551 } # You are no longer Chinese Imperial
			}
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = FROMFROM
					is_close_relative = FROMFROM
				}
			}
			if = {
				limit = {
					can_have_chinese_imperial_trigger = yes
				}
				narrative_event = { id = soh.5553 } # Do you want to keep being a pretender?
			}
			else = {
				narrative_event = { id = soh.5557 } # You are no longer Chinese Imperial
			}
		}
	}
}

# Usurped pretender from the same dynasty or a close relative - ineligible for Chinese Imperial due to culture
character_event = {
	id = soh.5548
	desc = EVTDESC_SOH_5548
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5548 # I will change my culture!
		
		culture = event_target:old_pretender_emperor
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5548 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5550 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
				e_china = {
					OR = {
						has_holder = no
						holder_scope = {
							OR = {
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
		}
	}
}

# Usurped pretender from the same dynasty or a close relative - ineligible for Chinese Imperial due to religion
character_event = {
	id = soh.5549
	desc = EVTDESC_SOH_5549
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = zealous
				}
				true_religion = event_target:old_pretender_emperor
			}
		}
		name = EVTOPTA_SOH_5549 # I will change my religion!
		
		religion = event_target:old_pretender_emperor
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5549 # I would rather stop being Chinese Imperial...
		
		piety = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5550 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				true_religion = event_target:old_pretender_emperor
			}
			modifier = {
				factor = 0.1
				trait = cynical
				e_china = {
					OR = {
						has_holder = no
						holder_scope = {
							OR = {
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
			modifier = {
				factor = 0 # One false faith is the same as any other...
				has_secret_religion = yes
			}
		}
	}
}

# The pretender did not convert - inform the world
narrative_event = {
	id = soh.5550
	is_triggered_only = yes
	title = EVTTITLE_SOH_5550
	desc = EVTDESC_SOH_5550
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5550 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5550 # Interesting...
	}
}

# Wholly ineligible - pretender
narrative_event = {
	id = soh.5551
	is_triggered_only = yes
	title = EVTTITLE_SOH_5551
	desc = EVTDESC_SOH_5551
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5551 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5552 } # Inform the world
		}
	}
}

# Inform the world about a pretender ceasing to be a pretender
narrative_event = {
	id = soh.5552
	is_triggered_only = yes
	title = EVTTITLE_SOH_5552
	desc = EVTDESC_SOH_5552
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5552 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5552 # Interesting...
	}
}

# Usurped pretender from another dynasty and not a close relative - eligible - do you want to continue being a pretender?
character_event = {
	id = soh.5553
	desc = EVTDESC_SOH_5553
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5553 # I will continue being a pretender!
		
		narrative_event = { id = soh.5554 } # Rename the pretender empire
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				trait = content
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						OR = {
							has_character_modifier = mandate_of_heaven_5
							has_character_modifier = mandate_of_heaven_4
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5553 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5556 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
				e_china = {
					OR = {
						holder_scope = {
							OR = 
								NOT = {
									government = chinese_imperial_government
								}
								has_character_modifier = mandate_of_heaven_2
								has_character_modifier = mandate_of_heaven_1
							}
						}
					}
				}
			}
			modifier = {
				factor = 0
				e_china = {
					has_holder = no # FDaTK or similar
				}
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
}

# If still a pretender, select a dynasty name
narrative_event = {
	id = soh.5554
	is_triggered_only = yes
	title = EVTTITLE_SOH_5554
	desc = EVTDESC_SOH_5554
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		primary_title = {
			save_pretender_name_effect = yes
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5554 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
						NOT = {
							has_opinion_modifier = {
								who = ROOT
								modifier = breakaway_pretender
							}
						}
					}
				}
				narrative_event = { id = soh.5555 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5555
	is_triggered_only = yes
	title = EVTTITLE_SOH_5555
	desc = EVTDESC_SOH_5555
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5555 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
				NOT = {
					character = event_target:old_pretender_emperor
				}
			}
		}
		
		name = EVTOPTB_SOH_5555 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_pretender_emperor
			}
		}
		
		name = EVTOPTC_SOH_5555 # I am the true Emperor of China!
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5555 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5555 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5555 # This does not concern me...
	}
}

# Inform the world about a pretender ceasing to be a pretender
narrative_event = {
	id = soh.5556
	is_triggered_only = yes
	title = EVTTITLE_SOH_5556
	desc = EVTDESC_SOH_5556
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5556 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5556 # Interesting...
	}
}

# Usurped pretender from another dynasty and not a close relative - ineligible
narrative_event = {
	id = soh.5557
	is_triggered_only = yes
	title = EVTTITLE_SOH_5557
	desc = EVTDESC_SOH_5557
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5557 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5558 } # Inform the world
		}
	}
}

# Inform the world about a pretender ceasing to be a pretender
narrative_event = {
	id = soh.5558
	is_triggered_only = yes
	title = EVTTITLE_SOH_5558
	desc = EVTDESC_SOH_5558
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5558 # As expected!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5558 # Interesting...
	}
}



##### Usurpation of China

# Hidden start
character_event = {
	id = soh.5559
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			title = e_china
		}
	}
	
	immediate = {
		FROMFROM = {
			save_event_target_as = old_emperor_of_china
		}
		if = {
			limit = {
				event_target:old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			event_target:old_emperor_of_china = {
				character_event = { id = soh.5560 }
			}
		}
		else = {
			character_event = { id = soh.5561 } # If the old EoC wasn't CI, they don't suffer certain penalties
		}
	}
}

# Old EoC informed of loss of tributaries, duchies, and kingdoms
character_event = {
	id = soh.5560
	desc = EVTDESC_SOH_5560
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5560 # This keeps getting worse...
		
		china_usurpation_effect = yes # Destroy duchies and kingdoms of old EoC, downgrade tributaries of old EoC and usurp them
		
		FROM = {
			character_event = { id = soh.5561 } # Determine further fallout
		}
	}
}

# Ping EoC and do the setup
character_event = {
	id = soh.5561
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
			}
			# Do nothing
		}
		else_if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = no
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
			}
			if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = yes
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
				}
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
				character_event = { id = soh.5562 } # Wrong culture - convert?
			}
			else_if = {
				limit = {
					can_have_chinese_imperial_only_religion_trigger = no
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes # If you've got some weird culture, you don't get the choice
					controls_religion = no
				}
				character_event = { id = soh.5563 } # Wrong culture - convert?
			}
			else = {
				narrative_event = { id = soh.5565 } # You are no longer Chinese Imperial!
			}
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = no
			}
			narrative_event = { id = soh.5567 } # You are no longer Chinese Imperial!
		}
		else_if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				e_china = {
					has_any_chinese_dynasty_name_trigger = yes
				}
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
			}
			narrative_event = { id = soh.5569 } # No need to rename China
		}
		else_if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				e_china = {
					has_any_chinese_dynasty_name_trigger = no
				}
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
			}
			narrative_event = { id = soh.5571 } # Need to rename China
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
			}
			narrative_event = { id = soh.5573 } # Need to rename China
		}
		else_if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = yes
				}
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
			}
			narrative_event = { id = soh.5575 } # Keep pretender dynasty?
		}
		else_if = {
			limit = {
				OR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				old_emperor_of_china = {
					can_have_chinese_imperial_trigger = no
				}
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
			}
			narrative_event = { id = soh.5578 } # Keep pretender dynasty
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				any_demesne_title = {
					tier = emperor
					has_title_flag = pretender_chinese_empire
				}
			}
			narrative_event = { id = soh.5580 } # Keep pretender dynasty
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
			}
			narrative_event = { id = soh.5582 } # Need to rename China
		}
		else_if = {
			limit = {
				NOR = {
					dynasty = event_target:old_emperor_of_china
					is_close_relative = event_target:old_emperor_of_china
				}
				can_have_chinese_imperial_trigger = yes
				has_character_flag = china_usurper_claimant_faction_or_takeover
				NOT = {
					any_demesne_title = {
						tier = emperor
						has_title_flag = pretender_chinese_empire
					}
				}
			}
			narrative_event = { id = soh.5584 } # Need to rename China... and could possibly result in interesting times
		}
	}
}

# Usurped China from the same dynasty or a close relative - ineligible for Chinese Imperial due to culture
character_event = {
	id = soh.5562
	desc = EVTDESC_SOH_5562
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5562 # I will change my culture!
		
		culture = event_target:old_emperor_of_china
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5562 # I would rather stop being Chinese Imperial...
		
		prestige = 100
		
		clean_up_chinese_dynasty_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5564 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
}

# Usurped China from the same dynasty or a close relative - ineligible for Chinese Imperial due to religion
character_event = {
	id = soh.5563
	desc = EVTDESC_SOH_5563
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			OR = {
				NOT = {
					trait = zealous
				}
				true_religion = event_target:old_emperor_of_china
			}
		}
		name = EVTOPTA_SOH_5563 # I will change my religion!
		
		religion = event_target:old_emperor_of_china
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
			modifier = {
				factor = 0.1
				OR = {
					has_character_modifier = mandate_of_heaven_2
					has_character_modifier = mandate_of_heaven_1
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					culture_group = FROM
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5563 # I would rather stop being Chinese Imperial...
		
		piety = 100
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5564 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				true_religion = event_target:old_emperor_of_china
			}
			modifier = {
				factor = 0.1
				trait = cynical
			}
			modifier = {
				factor = 0 # One false faith is the same as any other...
				has_secret_religion = yes
			}
		}
	}
}

# The EoC did not convert - inform the world
narrative_event = {
	id = soh.5564
	is_triggered_only = yes
	title = EVTTITLE_SOH_5564
	desc = EVTDESC_SOH_5564
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5564 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5564 # Interesting...
	}
}

# Wholly ineligible - EoC
narrative_event = {
	id = soh.5565
	is_triggered_only = yes
	title = EVTTITLE_SOH_5565
	desc = EVTDESC_SOH_5565
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5513 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5566 } # Inform the world
		}
	}
}

# Inform the world about China ceasing to be CI
narrative_event = {
	id = soh.5566
	is_triggered_only = yes
	title = EVTTITLE_SOH_5566
	desc = EVTDESC_SOH_5566
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5566 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5566 # Interesting...
	}
}

# Usurped China from another dynasty and not a close relative - ineligible
narrative_event = {
	id = soh.5567
	is_triggered_only = yes
	title = EVTTITLE_SOH_5567
	desc = EVTDESC_SOH_5567
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5567 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5568 } # Inform the world
		}
	}
}

# Inform the world about China ceasing to be CI
narrative_event = {
	id = soh.5568
	is_triggered_only = yes
	title = EVTTITLE_SOH_5568
	desc = EVTDESC_SOH_5568
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5568 # As expected!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5568 # Interesting...
	}
}

# Non-pretender usurped China from the same dynasty or a close relative - suddenly Chinese Imperial - no need to rename
character_event = {
	id = soh.5569
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5570 } # Inform the world
		}
	}
}

# Inform the world about the new EoC
narrative_event = {
	id = soh.5570
	is_triggered_only = yes
	title = EVTTITLE_SOH_5570
	desc = EVTDESC_SOH_5570
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5570 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5570 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5570 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5570 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5570 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5570 # This does not concern me...
	}
}

# Non-pretender usurped China from the same dynasty or a close relative - suddenly Chinese Imperial - need to rename
narrative_event = {
	id = soh.5571
	is_triggered_only = yes
	title = EVTTITLE_SOH_5571
	desc = EVTDESC_SOH_5571
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5571 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5572 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5572
	is_triggered_only = yes
	title = EVTTITLE_SOH_5572
	desc = EVTDESC_SOH_5572
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5572 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5572 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5572 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5572 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5572 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5572 # This does not concern me...
	}
}

# Non-pretender usurped China from another dynasty and not a close relative - suddenly Chinese Imperial - need to rename
narrative_event = {
	id = soh.5573
	is_triggered_only = yes
	title = EVTTITLE_SOH_5573
	desc = EVTDESC_SOH_5573
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5573 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5574 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5574
	is_triggered_only = yes
	title = EVTTITLE_SOH_5574
	desc = EVTDESC_SOH_5574
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5574 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5574 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5574 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5574 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5574 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5574 # This does not concern me...
	}
}

# Same dynasty/close relative pretender took over China from CI EoC - keep the dynasty name?
character_event = {
	id = soh.5575
	desc = EVTDESC_SOH_5575
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5575 # I will end the pretender dynasty!
		
		clean_up_chinese_pretender_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5576 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5575 # I will keep the pretender dynasty!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5577 } # Inform the world
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
	}
}

# Inform the world about the same dynasty
narrative_event = {
	id = soh.5576
	is_triggered_only = yes
	title = EVTTITLE_SOH_5576
	desc = EVTDESC_SOH_5576
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5576 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
			NOT = {
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTB_SOH_5576 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTC_SOH_5576 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5576 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5576 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5576 # This does not concern me...
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5577
	is_triggered_only = yes
	title = EVTTITLE_SOH_5577
	desc = EVTDESC_SOH_5577
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5577 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
			NOT = {
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTB_SOH_5577 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTC_SOH_5577 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5577 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5577 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5577 # This does not concern me...
	}
}

# Same dynasty/close relative pretender took over China from non-CI EoC
character_event = {
	id = soh.5578
	desc = EVTDESC_SOH_5578
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5578 # My dynasty endures!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5579 } # Inform the world
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5579
	is_triggered_only = yes
	title = EVTTITLE_SOH_5579
	desc = EVTDESC_SOH_5579
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5579 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5579 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5579 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5579 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5579 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5579 # This does not concern me...
	}
}

# Usurped China from another dynasty and not a close realtive through non-Takeover/Claimant faction war as pretender - inherit name from pretender dynasty
character_event = {
	id = soh.5580
	desc = EVTDESC_SOH_5580
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5580 # My dynasty endures!
		
		copy_pretender_empire_effect = yes
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5581 } # Inform the world
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5581
	is_triggered_only = yes
	title = EVTTITLE_SOH_5581
	desc = EVTDESC_SOH_5581
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5581 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
			NOT = {
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTB_SOH_5581 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTC_SOH_5581 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5581 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5581 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5581 # This does not concern me...
	}
}

# Usurped China from another dynasty and not a close realtive through non-Takeover/Claimant faction war as non-pretender - need to rename
narrative_event = {
	id = soh.5582
	is_triggered_only = yes
	title = EVTTITLE_SOH_5582
	desc = EVTDESC_SOH_5582
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5582 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5583 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5583
	is_triggered_only = yes
	title = EVTTITLE_SOH_5583
	desc = EVTDESC_SOH_5583
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5583 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
			NOT = {
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTB_SOH_5583 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTC_SOH_5583 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5583 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5583 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5583 # This does not concern me...
	}
}

# Usurped China from another dynasty and not a close relative through Takeover/Claimant faction war - need to rename
narrative_event = {
	id = soh.5584
	is_triggered_only = yes
	title = EVTTITLE_SOH_5584
	desc = EVTDESC_SOH_5584
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5584 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
						character = event_target:old_emperor_of_china
					}
				}
				narrative_event = { id = soh.5585 } # Inform the world
			}
		}
	}
}

# Inform the world about the new dynasty
narrative_event = {
	id = soh.5585
	is_triggered_only = yes
	title = EVTTITLE_SOH_5585
	desc = EVTDESC_SOH_5585
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5585 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
			NOT = {
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTB_SOH_5585 # Ten thousand years!
	}
	
	option = {
		trigger = {
			OR = {
				AND = {
					government = chinese_imperial_government
					NOT = {
						character = FROM
					}
				}
				character = event_target:old_emperor_of_china
			}
		}
		
		name = EVTOPTC_SOH_5585 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5585 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5585 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5585 # This does not concern me...
	}
	
	after = {
		if = {
			limit = {
				character = event_target:old_emperor_of_china
				can_have_chinese_imperial_trigger = yes
			}
			# Let the interesting times begin! - TODO KANG YOUWEI
		}
	}
}



##### Religion/culture conversion affecting status as CI

# Pretender converted culture - no longer Chinese Imperial
narrative_event = {
	id = soh.5586
	is_triggered_only = yes
	title = EVTTITLE_SOH_5586
	desc = EVTDESC_SOH_5586
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5586 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5587 } # Inform the world
		}
	}
}

# Inform the world - pretender no longer Chinese Imperial due to culture
narrative_event = {
	id = soh.5587
	is_triggered_only = yes
	title = EVTTITLE_SOH_5587
	desc = EVTDESC_SOH_5587
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5587 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5587 # Interesting...
	}
}

# Pretender converted religion - no longer Chinese Imperial
narrative_event = {
	id = soh.5588
	is_triggered_only = yes
	title = EVTTITLE_SOH_5588
	desc = EVTDESC_SOH_5588
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5588 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5589 } # Inform the world
		}
	}
}

# Inform the world - pretender no longer Chinese Imperial due to religion
narrative_event = {
	id = soh.5589
	is_triggered_only = yes
	title = EVTTITLE_SOH_5589
	desc = EVTDESC_SOH_5589
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5589 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5589 # Interesting...
	}
}

# EoC converted culture - no longer Chinese Imperial
narrative_event = {
	id = soh.5590
	is_triggered_only = yes
	title = EVTTITLE_SOH_5590
	desc = EVTDESC_SOH_5590
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5590 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5591 } # Inform the world
		}
	}
}

# Inform the world - EoC no longer Chinese Imperial due to culture
narrative_event = {
	id = soh.5591
	is_triggered_only = yes
	title = EVTTITLE_SOH_5591
	desc = EVTDESC_SOH_5591
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5591 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5591 # Interesting...
	}
}

# EoC converted religion - no longer Chinese Imperial
narrative_event = {
	id = soh.5592
	is_triggered_only = yes
	title = EVTTITLE_SOH_5592
	desc = EVTDESC_SOH_5592
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_SOH_5592 # It was not meant to be!
		
		clean_up_chinese_pretender_effect = yes
		
		any_independent_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = soh.5593 } # Inform the world
		}
	}
}

# Inform the world - EoC no longer Chinese Imperial due to religion
narrative_event = {
	id = soh.5593
	is_triggered_only = yes
	title = EVTTITLE_SOH_5593
	desc = EVTDESC_SOH_5593
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			top_liege = {
				government = chinese_imperial_government
			}
		}
		
		name = EVTOPTA_SOH_5593 # FROM was only a false dragon!
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
		}
		
		name = EVTOPTB_SOH_5593 # Interesting...
	}
}

# EoC converted culture - now Chinese Imperial - no rename needed
character_event = {
	id = soh.5594
	desc = EVTDESC_SOH_5594
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_china
		can_have_chinese_imperial_trigger = yes
		FROM = {
			can_have_chinese_imperial_trigger = no
		}
		e_china = {
			has_any_chinese_dynasty_name_trigger = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5594 # Ten thousand years!
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5599 } # Inform the world
		}
	}
}

# EoC converted religion - now Chinese Imperial - no rename needed
character_event = {
	id = soh.5595
	desc = EVTDESC_SOH_5595
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_china
		can_have_chinese_imperial_trigger = yes
		FROM = {
			can_have_chinese_imperial_trigger = no
		}
		e_china = {
			has_any_chinese_dynasty_name_trigger = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5595 # Ten thousand years!
		
		any_playable_ruler = {
			limit = {
				OR = {
					ai = no
					government = chinese_imperial_government
				}
			}
			narrative_event = { id = soh.5599 } # Inform the world
		}
	}
}

# EoC converted culture - now Chinese Imperial - rename needed
character_event = {
	id = soh.5596
	desc = EVTDESC_SOH_5596
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_china
		can_have_chinese_imperial_trigger = yes
		FROM = {
			can_have_chinese_imperial_trigger = no
		}
		e_china = {
			has_any_chinese_dynasty_name_trigger = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5594 # Ten thousand years!
		
		character_event = { id = soh.5598 } # Select a dynasty name
	}
}

# EoC converted religion - now Chinese Imperial - rename needed
character_event = {
	id = soh.5597
	desc = EVTDESC_SOH_5597
	picture = GFX_evt_china_golden_age
	border = GFX_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_china
		can_have_chinese_imperial_trigger = yes
		FROM = {
			can_have_chinese_imperial_trigger = no
		}
		e_china = {
			has_any_chinese_dynasty_name_trigger = yes
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5597 # Ten thousand years!
		
		character_event = { id = soh.5598 } # Select a dynasty name
	}
}

# Selecting a new name
narrative_event = {
	id = soh.5598
	is_triggered_only = yes
	title = EVTTITLE_SOH_5598
	desc = EVTDESC_SOH_5598
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		e_china = {
			clear_all_chinese_dynasty_flags_and_update_global_flags_effect = yes
		}
		generate_three_random_chinese_dynasty_names_effect = yes
	}
	
	# TODO: Lots and lots of options
	
	after = {
		clear_all_random_chinese_dynasty_names_effect = yes
		if = {
			limit = {
				NOT = {
					has_character_flag = named_chinese_dynasty
				}
			}
			repeat_event = { id = soh.5598 } # Generate new names
		}
		else = {
			clr_character_flag = named_chinese_dynasty
			any_playable_ruler = {
				limit = {
					OR = {
						ai = no
						government = chinese_imperial_government
					}
				}
				narrative_event = { id = soh.5599 } # Inform the world
			}
		}
	}
}

# Inform the world - China is now CI
narrative_event = {
	id = soh.5599
	is_triggered_only = yes
	title = EVTTITLE_SOH_5599
	desc = EVTDESC_SOH_5599
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			character = FROM
		}
		
		name = EVTOPTA_SOH_5599 # An auspicious day!
		clear_old_china_name_flag_effect = yes
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				character = FROM
			}
		}
		
		name = EVTOPTB_SOH_5599 # Ten thousand years!
	}
	
	option = {
		trigger = {
			government = chinese_imperial_government
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTC_SOH_5599 # I am the true Emperor of China!
		
		e_china = {
			add_weak_pressed_claim = PREV
		}
	}
	
	option = {
		trigger = {
			independent = no
			top_liege = {
				government = chinese_imperial_government
			}
			NOT = {
				character = FROM
			}
		}
		
		name = EVTOPTD_SOH_5599 # Interesting times...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			is_within_diplo_range = FROM
		}
		
		name = EVTOPTE_SOH_5599 # This might affect me...
	}
	
	option = {
		trigger = {
			top_liege = {
				NOT = {
					government = chinese_imperial_government
				}
			}
			NOT = {
				is_within_diplo_range = FROM
			}
		}
		
		name = EVTOPTF_SOH_5599 # This does not concern me...
	}
}



##### Misc

# Destroy any secondary empires gained by a CI ruler (except China itself) outside special circumstances
character_event = {
	id = soh.5600
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		government = chinese_imperial_government
		NOT = {
			has_character_flag = special_chinese_imperial_title_change
		}
		FROM = {
			has_title_flag = pretender_chinese_empire
		}
		any_demesne_title = {
			count = 2
			tier = emperor
		}
	}
	
	immediate = {
		FROM = {
			clean_up_chinese_pretender_title_effect = yes
		}
	}
}

# Yearly cleanup of flags and names for titles without holders
character_event = {
	id = soh.5601
	hide_window = yes
	
	only_playable = yes
	religion = catholic
	
	is_triggered_only = yes
	
	trigger = {
		controls_religion = yes # The Pope is always around!
	}
	
	immediate = {
		clean_up_all_chinese_pretenders_effect = yes
	}
}

# Cleanup of dynasty name if non-CI China is taken over by non-CI ruler
character_event = {
	id = soh.5602
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			government = chinese_imperial_government
		}
		FROM = {
			title = e_china
		}
		e_china = {
			has_any_chinese_dynasty_name_trigger = yes
		}
	}
	
	immediate = {
		e_china = {
			clean_up_chinese_pretender_title_effect = yes
		}
	}
}



##### Special FDaTK-style outcome - TODO KANG YOUWEI

# Leave these be for now; I'm still finishing up the file /Silversweeper