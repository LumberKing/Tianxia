# New Grace events

# by Silverswee(e)per

namespace = grace

##### Tributes (1-40; reserved ids 1-300)

### Send Gift (1-3)

# The EoC gets the gift, can accept or refuse
narrative_event = {
	id = grace.1
	is_triggered_only = yes
	title = EVTTITLE_GRACE_1
	desc = EVTDESC_GRACE_1
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				trait = greedy
				NOT = {
					wealth = 0
				}
			}
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_1 # Accept the gift, and give extra Grace due to greed
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			NOR = {
				trait = greedy
				trait = charitable
			}
			wealth = 0
			NOT = {
				wealth = 10000
			}
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_1 # Accept the gift
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			OR = {
				trait = charitable
				wealth = 10000
			}	
			NOT = {
				trait = greedy
			}
			OR = {
				ai = no
				china_accepts_gold_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_1 # Accept the gift, but give less Grace due to being Charitable
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.2 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_gift
		}
	}
	
	option = {
		trigger = {
			china_accepts_gold_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_1 # Refuse the gift, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.3 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_gold_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTE_GRACE_1 # Refuse the gift, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.3 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
	}
}

# Gift accepted, sender gets Grace and loses the money
letter_event = {
	id = grace.2
	is_triggered_only = yes
    border = GFX_event_letter_frame_diplomacy
	
	desc = {
		trigger = {
			FROM = {
				OR = {
					trait = greedy
					NOT = {
						wealth = 500 # The EoC already got money, so this would be him having < 0 gold when the tribute was accepted
					}
				}
			}
		}
		text = EVTDESC_GRACE_2_A
	}
	
	desc = {
		trigger = {
			FROM = {
				NOR = {
					trait = greedy
					trait = charitable
				}
				wealth = 500 # The EoC already got money, so this would be him having >= 0 gold when the tribute was accepted
				NOT = {
					wealth = 10500 # The EoC already got money, so this would be him having < 10000 gold when the tribute was accepted
				}
			}
		}
		text = EVTDESC_GRACE_2_B
	}
	
	desc = {
		trigger = {
			FROM = {
				OR = {
					trait = charitable
					wealth = 10500 # The EoC already got money, so this would be him having >= 10000 gold when the tribute was accepted
				}	
				NOT = {
					trait = greedy
				}
			}
		}
		text = EVTDESC_GRACE_2_C
	}
	
	option = {
		trigger = {
			FROM = {
				OR = {
					trait = greedy
					NOT = {
						wealth = 500 # The EoC already got money, so this would be him having < 0 gold when the tribute was accepted
					}
				}
			}
		}
		
		name = EVTOPTA_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 450
		}
		set_character_flag = grace_character
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
	
	option = {
		trigger = {
			FROM = {
				NOR = {
					trait = greedy
					trait = charitable
				}
				wealth = 500 # The EoC already got money, so this would be him having >= 0 gold when the tribute was accepted
				NOT = {
					wealth = 10500 # The EoC already got money, so this would be him having < 10000 gold when the tribute was accepted
				}
			}
		}
		
		name = EVTOPTB_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 300
		}
		set_character_flag = grace_character
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
	
	option = {
		trigger = {
			FROM = {
				OR = {
					trait = charitable
					wealth = 10500 # The EoC already got money, so this would be him having >= 10000 gold when the tribute was accepted
				}	
				NOT = {
					trait = greedy
				}
			}
		}
		
		name = EVTOPTC_GRACE_2
		
		wealth = -500
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 150
		}
		set_character_flag = grace_character
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s gold tribute!"
	}
}

# Gift refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.3
	is_triggered_only = yes
	desc = EVTDESC_GRACE_3
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_3
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_gift
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s gold tribute!"
	}
}

### Become Tributary (4-7)

# The EoC gets the offer, can accept or refuse
narrative_event = {
	id = grace.4
	is_triggered_only = yes
	title = EVTTITLE_GRACE_4
	desc = EVTDESC_GRACE_4
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_tributary_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_4 # Accept the tributary
		
		FROMFROM = {
			letter_event = { id = grace.5 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_became_tributary
		}
	}
	
	option = {
		trigger = {
			china_accepts_tributary_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_4 # Refuse the tributary, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.6 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_tributary_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_4 # Refuse the tributary, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.6 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
	}
}

# Tributary status accepted, sender gets Grace and becomes a tributary
letter_event = {
	id = grace.5
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_5
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_5
		
		change_variable = {
			which = grace
			value = 200
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		if = {
			limit = {
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = FROM
											any_liege = {
												character = FROM
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														character = FROM
														any_liege = {
															character = FROM
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													has_owner = yes
													owner = {
														OR = {
															character = FROM
															any_liege = {
																character = FROM
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			FROM = {
				make_tributary = {
					who = ROOT
					tributary_type = chinese_peripheral_tributary
				}
			}
		}
		else = {
			FROM = {
				make_tributary = {
					who = ROOT
					tributary_type = chinese_imperial_tributary
				}
			}
		}
		#hidden_tooltip = {
		#	character_event = { id = grace.7 days = 365 }
		#}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted to make [Root.GetTitledName] a tributary!"
	}
}

# Tributary status refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.6
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_6
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_6
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_tributary
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused to make [Root.GetTitledName] a tributary!"
	}
}

# Yearly Grace gain for being a tributary - now fired on_yearly_pulse
character_event = {
	id = grace.7
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR =  {
			is_tributary = {
				type = chinese_peripheral_tributary
			}
			is_tributary = {
				type = chinese_imperial_tributary
			}
			is_tributary = {
				type = chinese_protectorate
			}
			is_tributary = {
				type = chinese_client_state
			}
		}
		suzerain = {
			is_chinese_emperor_trigger = yes
		}
	}
	
	immediate = {
		set_character_flag = grace_character # To ensure that this character will get their Grace wiped if the imperial dynasty changes
		give_tiered_tributary_grace_effect = yes
		# Extra Grace gain if we have the same culture group and religion as the EoC
		if = {
			limit = {
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			give_tiered_tributary_grace_effect = yes
		}
		# Extra Grace gain if we have the same culture and religion as the EoC
		if = {
			limit = {
				suzerain = {
					culture = ROOT
					religion = ROOT
				}
			}
			give_tiered_tributary_grace_effect = yes
		}
		#repeat_event = { id = grace.7 days = 365 } # Keep the Grace coming
	}
}

### Supply Horses (8-11)

# The EoC gets the offer, can accept or refuse
narrative_event = {
	id = grace.8
	is_triggered_only = yes
	title = EVTTITLE_GRACE_8
	desc = EVTDESC_GRACE_8
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_horses_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_8 # Accept the horses
		
		capital_scope = {
			ROOT = {
				spawn_unit = {
					owner = ROOT
					province = PREV
					troops = {
						knights = { 50 50 }
						light_cavalry = { 100 100 }
						horse_archers = { 150 150 }
					}
					attrition = 1.0
					maintenance_multiplier = 0.5
				}
			}
		}
		
		FROMFROM = {
			letter_event = { id = grace.9 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_supplying_horses
		}
	}
	
	option = {
		trigger = {
			china_accepts_horses_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_8 # Refuse the horses, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.10 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_horses_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_8 # Refuse the horses, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.10 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
	}
}

# Horses accepted, sender gets Grace + negative manpower modifier
letter_event = {
	id = grace.9
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_9
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_9
		
		if = {
			limit = {
				FROM = {
					war = no
				}
			}
			change_variable = {
				which = grace
				value = 200
			}
		}
		if = {
			limit = {
				FROM = {
					war = yes
				}
			}
			change_variable = {
				which = grace
				value = 400
			}
		}
		set_character_flag = grace_character
		manpower = -300
		
		sound_effect = china_grace_gain
		#add_character_modifier = {
		#	inherit = yes # Ensure the Grace gain is inherited!
		#	modifier = china_supply_horses
		#	duration = 1825 # Five years
		#}
		#hidden_tooltip = {
		#	character_event = { id = grace.11 days = 30 } # Deprecated!
		#}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s horse tribute!"
	}
}

# Horses refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.10
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_10
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_10
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_horses
		}
		log = "[From.GetTitledName] refused [Root.GetTitledName]'s horse tribute!"
	}
}

## Monthly Grace gain for supplying horses - DEPRECATED
#character_event = {
#	id = grace.11
#	hide_window = yes
#	is_triggered_only = yes
#	
#	trigger = {
#		has_character_modifier = china_supply_horses
#	}
#	
#	immediate = {
#		if = {
#			limit = {
#				is_nomadic = no
#			}
#			remove_character_modifier = china_supply_horses
#			break = yes
#		}
#		if = {
#			limit = {
#				any_war = {
#					OR = {
#						AND = {
#							any_attacker = {
#								character = ROOT
#							}
#							any_defender = {
#								is_chinese_emperor_trigger = yes
#							}
#						}
#						AND = {
#							any_defender = {
#								character = ROOT
#							}
#							any_attacker = {
#								is_chinese_emperor_trigger = yes
#							}
#						}
#					}
#				}
#			}
#			remove_character_modifier = china_supply_horses
#			break = yes
#		}
#		change_variable = {
#			which = grace
#			value = 2
#		}
#		repeat_event = { id = grace.11 days = 30 } # Keep the Grace coming
#	}
#}
#
#### Stop Supplying Horses (12-13) - DEPRECATED
#
## The EoC is informed of the end of the tribute - DEPRECATED
#narrative_event = {
#	id = grace.12
#	is_triggered_only = yes
#	title = EVTTITLE_GRACE_12
#	desc = EVTDESC_GRACE_12
#	picture = GFX_evt_china_golden_age
#	window = EventWindowOffmap
#	background = GFX_event_window_news_from_china
#	
#	option = {
#		name = EVTOPTA_GRACE_12 # Make your displeasure known
#		
#		FROMFROM = {
#			letter_event = { id = grace.13 }
#		}
#		
#		opinion = {
#			who = FROMFROM
#			modifier = opinion_china_stopped_supplying_horses
#		}
#	}
#}
#
## The sender is informed of the EoC's displeasure + loses Grace - DEPRECATED
#letter_event = {
#	id = grace.13
#	is_triggered_only = yes
#	
#	desc = EVTDESC_GRACE_13
#    border = GFX_event_letter_frame_diplomacy
#	
#	option = {
#		name = EVTOPTA_GRACE_13
#		
#		sound_effect = china_angered_emperor
#		change_variable = {
#			which = grace
#			value = -100
#		}
#		#log = "[Root.GetTitledName] stopped supplying horses to [From.GetTitledName]!"
#	}
#}

### Offer Eunuch (14-17)

# The EoC gets the offer
narrative_event = {
	id = grace.14
	is_triggered_only = yes
	title = EVTTITLE_GRACE_14
	desc = EVTDESC_GRACE_14
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		set_variable = {
			which = eunuch_value
			value = 0 # Reset if already used
		}
		change_variable = {
			which = eunuch_value
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = eunuch_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = eunuch_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = eunuch_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = eunuch_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = eunuch_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = eunuch_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = eunuch_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = eunuch_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = eunuch_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = architect
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = administrator
				}
			}
			change_variable = {
				which = eunuch_value
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = faqih
				}
			}
			change_variable = {
				which = eunuch_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = eunuch_value
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = eunuch_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					is_adult = no
				}
			}
			change_variable = {
				which = eunuch_value
				value = 60
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_eunuch_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_14 # Accept the eunuch
		
		FROMFROM = {
			letter_event = { id = grace.15 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_eunuch
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = eunuch_value
					value = 300
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = eunuch_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_eunuch_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				china_hates_prevprev_trigger = no
			}
		}
		name = EVTOPTB_GRACE_14 # Accept the eunuch, but give him to a vassal
		
		FROMFROM = {
			letter_event = { id = grace.16 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_eunuch_small
		}
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				check_variable = {
					which = eunuch_value
					value = 300
				}
			}
			modifier = {
				factor = 0.1
				check_variable = {
					which = eunuch_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_eunuch_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_14 # Refuse the eunuch, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.17 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_eunuch_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_14 # Refuse the eunuch, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.17 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = eunuch_value
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Eunuch accepted, sender gets Grace
letter_event = {
	id = grace.15
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_15
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = architect
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = administrator
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = faqih
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					is_adult = no
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_15
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			e_china = {
				holder_scope = {
					save_event_target_as = eoc
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s eunuch tribute, [FromFromFromFrom.GetBestName]!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Eunuch accepted but not deemed suitable for the Imperial Court, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.16
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_16
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 50
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = architect
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = administrator
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = faqih # Block if Zealous, increase if Sympathy?
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					is_adult = no
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_16
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV
			}
			any_consort = {
				remove_consort = PREV
			}
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.903 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_eunuch_not_imperial
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Eunuch refused, sender's opinion of the EoC lowered, eunuch gets upset about the attempted snipping off to China
letter_event = {
	id = grace.17
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_17
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_17
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_eunuch
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s eunuch tribute, [FromFromFromFrom.GetBestName]!"
	}
}


### Offer Concubine (18-22)

# The EoC gets the offer
narrative_event = {
	id = grace.18
	is_triggered_only = yes
	title = EVTTITLE_GRACE_18
	desc = EVTDESC_GRACE_18
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		set_variable = {
			which = concubine_value
			value = 0 # Reset if already used
		}
		change_variable = {
			which = concubine_value
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = concubine_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = concubine_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = concubine_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = concubine_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = concubine_value
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = concubine_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = concubine_value
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = concubine_value
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = ugly
				}
			}
			change_variable = {
				which = concubine_value
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = uncouth
				}
			}
			change_variable = {
				which = concubine_value
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = concubine_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = charitable
					ROOT = {
						NOT = {
							trait = greedy # Opposites do not attract in CK2!
						}
					}
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = gregarious
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = kind
					ROOT = {
						# Opposites do not attract in CK2!
						NOR = {
							trait = cruel
							trait = envious
						}
					}
				}
			}
			change_variable = {
				which = concubine_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = lunatic
				}
			}
			change_variable = {
				which = concubine_value
				value = -50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = concubine_value
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = concubine_value
				value = 50
			}
		}
		if = {
			limit = {
				trait = lustful
				is_female = no
			}
			multiply_variable = {
				which = concubine_value
				value = 2
			}
		}
		if = {
			limit = {
				trait = lustful
				is_female = no
				FROMFROMFROM = {
					trait = lustful
				}
			}
			multiply_variable = {
				which = concubine_value
				value = 2
			}
		}
		if = {
			limit = {
				trait = lustful
				is_female = no
				FROMFROMFROM = {
					trait = seductress
				}
			}
			multiply_variable = {
				which = concubine_value
				value = 2
			}
		}
		if = {
			limit = {
				trait = chaste
			}
			multiply_variable = {
				which = concubine_value
				value = 0.5
			}
		}
	}
	
	option = {
		trigger = {
			AND = {
				is_female = no
				is_adult = yes
				NOR = {
					trait = eunuch
					trait = incapable
					trait = celibate # No interest
					trait = homosexual # Should not bother with lots of concubines
				}
				prisoner = no
				is_inaccessible_trigger = no
			}
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_18 # Accept the concubine
		
		FROMFROMFROM = {
			save_event_target_as = concubine_tribute
		}
		
		FROMFROM = {
			letter_event = { id = grace.19 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = concubine_value
					value = 300
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = concubine_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			AND = {
				current_heir = {
					is_female = no
					is_adult = yes
					NOR = {
						trait = eunuch
						trait = incapable
						trait = celibate # No interest
						trait = homosexual # Should not bother with lots of concubines
					}
					prisoner = no
					is_inaccessible_trigger = no
					is_landed = no
				}
			}
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTB_GRACE_18 # Accept the concubine, but give her to your heir
		
		FROMFROMFROM = {
			save_event_target_as = concubine_tribute
		}
		
		FROMFROM = {
			letter_event = { id = grace.20 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = concubine_value
					value = 300
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = concubine_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_concubine_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				china_hates_prevprev_trigger = no
				is_female = no
				has_concubinage = yes
				NOT = {
					num_of_consorts = 3 # Can't take additional concubines
				}
				is_adult = yes
				NOR = {
					trait = celibate
					trait = eunuch
					trait = incapable
				}
				prisoner = no
				is_inaccessible_trigger = no
			}
		}
		name = EVTOPTC_GRACE_18 # Accept the concubine, but give her to a random vassal
		
		FROMFROMFROM = {
			save_event_target_as = concubine_tribute
		}
		
		FROMFROM = {
			letter_event = { id = grace.21 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_concubine_small
		}
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				check_variable = {
					which = concubine_value
					value = 300
				}
			}
			modifier = {
				factor = 0.1
				check_variable = {
					which = concubine_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_concubine_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_18 # Refuse the concubine, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.22 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_concubine_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTE_GRACE_18 # Refuse the eunuch, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.22 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = concubine_value
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Concubine accepted as EoC's personal concubine, sender gets Grace
letter_event = {
	id = grace.19
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_19
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = grace_gain
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = grace_gain
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = ugly
				}
			}
			change_variable = {
				which = grace_gain
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = uncouth
				}
			}
			change_variable = {
				which = grace_gain
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = charitable
					FROM = {
						NOT = {
							trait = greedy # Opposites do not attract in CK2!
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = gregarious
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = kind
					FROM = {
						# Opposites do not attract in CK2!
						NOR = {
							trait = cruel
							trait = envious
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = lunatic
				}
			}
			change_variable = {
				which = grace_gain
				value = -50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROM = {
					trait = lustful
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					trait = lustful
				}
				FROMFROMFROMFROM = {
					trait = lustful
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					trait = lustful
				}
				FROMFROMFROMFROM = {
					trait = seductress
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					trait = chaste
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 0.5
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_19
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROM = {
			event_target:concubine_tribute = {
				any_spouse = {
					remove_spouse = PREV # Should be unnecessary, but...
				}
				any_consort = {
					remove_consort = PREV # Should be unnecessary, but...
				}
				add_trait = sent_to_china # Blocks marriage and disinherits
				prisoner = no
			
			
				e_china = {
					holder_scope = {
						save_event_target_as = eoc
					}
				}
				
				move_character = event_target:eoc
				force_host = event_target:eoc
				event_target:eoc = {
					add_consort = PREV
				}
				
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
			}
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName]!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Concubine accepted as EoC's heir's concubine, sender gets Grace
letter_event = {
	id = grace.20
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_20
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = grace_gain
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = grace_gain
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = ugly
				}
			}
			change_variable = {
				which = grace_gain
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = uncouth
				}
			}
			change_variable = {
				which = grace_gain
				value = -80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = charitable
					FROM = {
						NOT = {
							trait = greedy # Opposites do not attract in CK2!
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = gregarious
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = kind
					FROM = {
						# Opposites do not attract in CK2!
						NOR = {
							trait = cruel
							trait = envious
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = lunatic
				}
			}
			change_variable = {
				which = grace_gain
				value = -50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROM = {
					current_heir = {
						trait = lustful
					}
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					current_heir = {
						trait = lustful
					}
				}
				FROMFROMFROMFROM = {
					trait = lustful
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					current_heir = {
						trait = lustful
					}
				}
				FROMFROMFROMFROM = {
					trait = seductress
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 2
			}
		}
		if = {
			limit = {
				FROM = {
					current_heir = {
						trait = chaste
					}
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 0.5
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_20
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROM = {
			event_target:concubine_tribute = {
				any_spouse = {
					remove_spouse = PREV # Should be unnecessary, but...
				}
				any_consort = {
					remove_consort = PREV # Should be unnecessary, but...
				}
				add_trait = sent_to_china # Blocks marriage and disinherits
				prisoner = no
			
				e_china = {
					holder_scope = {
						save_event_target_as = eoc
					}
				}
				
				move_character = event_target:eoc
				force_host = event_target:eoc
				
				event_target:eoc = {
					current_heir = {
						add_consort = PREVPREV
					}
				}
				
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
			}
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName], for [From.GetHerHis] heir!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Concubine accepted but given to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.21
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_21
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 50
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 8
					NOT = { diplomacy = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 12
					NOT = { diplomacy = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 16
					NOT = { diplomacy = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					diplomacy = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 8
					NOT = { martial = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 8
					NOT = { stewardship = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 12
					NOT = { stewardship = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 16
					NOT = { stewardship = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					stewardship = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 8
					NOT = { intrigue = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 12
					NOT = { intrigue = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 16
					NOT = { intrigue = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					intrigue = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 38 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = fair
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = groomed
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = ugly
				}
			}
			change_variable = {
				which = grace_gain
				value = -40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = uncouth
				}
			}
			change_variable = {
				which = grace_gain
				value = -40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = charitable
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = gregarious
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = kind
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = lunatic
				}
			}
			change_variable = {
				which = grace_gain
				value = -25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = intricate_webweaver
						trait = charismatic_negotiator
						trait = fortune_builder
						trait = skilled_tactician
						trait = scholarly_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					OR = {
						trait = elusive_shadow
						trait = grey_eminence
						trait = midas_touched
						trait = brilliant_strategist
						trait = mastermind_theologian
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_21
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			any_spouse = {
				remove_spouse = PREV # Should be unnecessary, but...
			}
			any_consort = {
				remove_consort = PREV # Should be unnecessary, but...
			}
			add_trait = sent_to_china # Blocks marriage and disinherits
			
			letter_event = { id = grace.901 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_concubine_not_imperial
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Concubine refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.22
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_22
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_22
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_concubine
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s concubine tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Offer Commander (23-26)

# The EoC gets the offer
narrative_event = {
	id = grace.23
	is_triggered_only = yes
	title = EVTTITLE_GRACE_23
	desc = EVTDESC_GRACE_23
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		set_variable = {
			which = commander_value
			value = 0 # Reset if already used
		}
		change_variable = {
			which = commander_value
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 12
					NOT = { martial = 14 }
				}
			}
			change_variable = {
				which = commander_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 14
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 16
					NOT = { martial = 18 }
				}
			}
			change_variable = {
				which = commander_value
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 18
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = commander_value
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 20
					NOT = { martial = 22 }
				}
			}
			change_variable = {
				which = commander_value
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 22
					NOT = { martial = 24 }
				}
			}
			change_variable = {
				which = commander_value
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					martial = 24
				}
			}
			change_variable = {
				which = commander_value
				value = 140
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = commander_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = commander_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = commander_value
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = duelist
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = hunter
				}
			}
			change_variable = {
				which = commander_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = berserker
				}
			}
			change_variable = {
				which = commander_value
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = adventurer
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = commander_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = brave
				}
			}
			change_variable = {
				which = commander_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = commander_value
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = shieldmaiden
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = sapper
				}
			}
			change_variable = {
				which = commander_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = master_of_flame
				}
			}
			change_variable = {
				which = commander_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = logistics_expert
				}
			}
			change_variable = {
				which = commander_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = levy_coordinator
				}
			}
			change_variable = {
				which = commander_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = light_foot_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = heavy_infantry_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = cavalry_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = inspiring_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = trickster
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = organizer
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = defensive_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = experimenter
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = flanker
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = aggressive_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = siege_leader
				}
			}
			change_variable = {
				which = commander_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = skilled_tactician
				}
			}
			change_variable = {
				which = commander_value
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = brilliant_strategist
				}
			}
			change_variable = {
				which = commander_value
				value = 50
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_commander_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_23 # Accept the commander
		
		FROMFROM = {
			letter_event = { id = grace.24 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_commander
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = commander_value
					value = 300
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = commander_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_commander_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				OR = {
					FROMFROMFROM = {
						is_female = no
					}
					primary_title = {
						has_law = status_of_women_4 # Allows female commanders
					}
				}
				china_hates_prevprev_trigger = no
			}
		}
		name = EVTOPTB_GRACE_23 # Accept the commander, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.25 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_commander_small
		}
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				check_variable = {
					which = commander_value
					value = 300
				}
			}
			modifier = {
				factor = 0.1
				check_variable = {
					which = commander_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_commander_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_23 # Refuse the commander, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.26 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_commander_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_23 # Refuse the commander, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.26 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = commander_value
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Commander accepted, sender gets Grace
letter_event = {
	id = grace.24
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_24
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 100
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 14 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 14
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 18 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 18
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 80
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
					NOT = { martial = 22 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 22
					NOT = { martial = 24 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 120
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 24
				}
			}
			change_variable = {
				which = grace_gain
				value = 140
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = duelist
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = hunter
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = berserker
				}
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = adventurer
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = brave
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shieldmaiden
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = sapper
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = master_of_flame
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = logistics_expert
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = levy_coordinator
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = light_foot_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = heavy_infantry_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = cavalry_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = inspiring_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = trickster
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = organizer
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = defensive_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = experimenter
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = flanker
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = aggressive_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = siege_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = skilled_tactician
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = brilliant_strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_24
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			e_china = {
				holder_scope = {
					save_event_target_as = eoc
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s commander tribute, [FromFromFromFrom.GetBestName]!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Commander accepted but sent to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.25
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_25
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 50
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 12
					NOT = { martial = 14 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 14
					NOT = { martial = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 16
					NOT = { martial = 18 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 18
					NOT = { martial = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 20
					NOT = { martial = 22 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 22
					NOT = { martial = 24 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					martial = 24
				}
			}
			change_variable = {
				which = grace_gain
				value = 70
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strong
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = robust
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 15
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = duelist
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = hunter
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = berserker
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = adventurer
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = brave
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = grace_gain
				value = 10
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shieldmaiden
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = sapper
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = master_of_flame
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = logistics_expert
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = levy_coordinator
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = light_foot_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = heavy_infantry_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = cavalry_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = inspiring_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = trickster
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = organizer
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = defensive_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = experimenter
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = flanker
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = aggressive_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = siege_leader
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = skilled_tactician
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = brilliant_strategist
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_25
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.905 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_commander_not_imperial
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Commander refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.26
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_26
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_26
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_commander
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s commander tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Offer Physician (27-30)

# The EoC gets the offer
narrative_event = {
	id = grace.27
	is_triggered_only = yes
	title = EVTTITLE_GRACE_27
	desc = EVTDESC_GRACE_27
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		set_variable = {
			which = physician_value
			value = 0 # Reset if already used
		}
		change_variable = {
			which = physician_value
			value = 100
		}
		
		if = {
			limit = {
				FROMFROMFROM = {
					NOT = { learning = 8 }
				}
			}
			change_variable = {
				which = physician_value
				value = -50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = physician_value
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = physician_value
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = physician_value
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 20
					NOT = { learning = 24 }
				}
			}
			change_variable = {
				which = physician_value
				value = 140
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 24
					NOT = { learning = 28 }
				}
			}
			change_variable = {
				which = physician_value
				value = 180
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 28
					NOT = { learning = 32 }
				}
			}
			change_variable = {
				which = physician_value
				value = 220
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					learning = 32
				}
			}
			change_variable = {
				which = physician_value
				value = 260
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = physician_value
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = physician_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = physician_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = physician
				}
			}
			change_variable = {
				which = physician_value
				value = 150
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = mystic
				}
			}
			change_variable = {
				which = physician_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = physician_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = scholarly_theologian
				}
			}
			change_variable = {
				which = physician_value
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = mastermind_theologian
				}
			}
			change_variable = {
				which = physician_value
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = physician_value
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = physician_value
				value = 25
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_physician_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
		}
		name = EVTOPTA_GRACE_27 # Accept the physician
		
		FROMFROM = {
			letter_event = { id = grace.28 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_physician
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = physician_value
					value = 300
				}
			}
			modifier = {
				factor = 5
				check_variable = {
					which = physician_value
					value = 500
				}
			}
			modifier = {
				factor = 5
				NOT = {
					has_assigned_minor_title = title_court_physician
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_physician_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
				AND = {
					china_hates_fromfromfrom_trigger = yes
					test_grace_acceptance_trigger = no
				}
			}
			any_realm_lord = {
				higher_tier_than = baron
				china_hates_prevprev_trigger = no
			}
		}
		name = EVTOPTB_GRACE_27 # Accept the physician, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.29 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_physician_small
		}
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				check_variable = {
					which = physician_value
					value = 300
				}
			}
			modifier = {
				factor = 0.1
				check_variable = {
					which = physician_value
					value = 500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			OR = {
				china_accepts_physician_tribute_fromfrom_trigger = no
				china_hates_fromfromfrom_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_27 # Refuse the physician, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.30 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_physician_tribute_fromfrom_trigger = yes
			china_hates_fromfromfrom_trigger = no
		}
		name = EVTOPTD_GRACE_27 # Refuse the physician, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.30 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = physician_value
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Physician accepted, sender gets Grace
letter_event = {
	id = grace.28
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_28
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 100
		}
		
		if = {
			limit = {
				FROMFROMFROMFROM = {
					NOT = { learning = 8 }
				}
			}
			change_variable = {
				which = grace_gain
				value = -50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 40
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 60
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
					NOT = { learning = 24 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 140
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 24
					NOT = { learning = 28 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 180
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 28
					NOT = { learning = 32 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 220
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 32
				}
			}
			change_variable = {
				which = grace_gain
				value = 260
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 100
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = physician
				}
			}
			change_variable = {
				which = grace_gain
				value = 150
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = mystic
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholarly_theologian
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = mastermind_theologian
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_28
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			
			e_china = {
				holder_scope = {
					save_event_target_as = eoc
				}
			}
			
			move_character = event_target:eoc
			force_host = event_target:eoc
			
			if = {
				limit = {
					event_target:eoc = {
						NOT = {
							has_assigned_minor_title = title_court_physician
						}
					}
				}
				give_minor_title = title_court_physician
			}
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s physician tribute, [FromFromFromFrom.GetBestName]!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Physician accepted but sent to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.29
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_29
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 50
		}
		
		if = {
			limit = {
				FROMFROMFROMFROM = {
					NOT = { learning = 8 }
				}
			}
			change_variable = {
				which = grace_gain
				value = -25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 8
					NOT = { learning = 12 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 20
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 12
					NOT = { learning = 16 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 30
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 16
					NOT = { learning = 20 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 20
					NOT = { learning = 24 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 70
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 24
					NOT = { learning = 28 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 90
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 28
					NOT = { learning = 32 }
				}
			}
			change_variable = {
				which = grace_gain
				value = 110
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					learning = 32
				}
			}
			change_variable = {
				which = grace_gain
				value = 130
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = genius
				}
			}
			change_variable = {
				which = grace_gain
				value = 50
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = quick
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = shrewd
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = physician
				}
			}
			change_variable = {
				which = grace_gain
				value = 75
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = mystic
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholar
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = scholarly_theologian
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = mastermind_theologian
				}
			}
			change_variable = {
				which = grace_gain
				value = 25
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = patient
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					trait = diligent
				}
			}
			change_variable = {
				which = grace_gain
				value = 13 # Rounded up
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_29
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			add_trait = sent_to_china # Disinherits
			
			letter_event = { id = grace.907 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_physician_not_imperial
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Physician refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.30
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_30
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_30
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_physician
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s physician tribute, [FromFromFromFrom.GetBestName]!"
	}
}

### Send Relief (31-33)

# The EoC gets the offer
narrative_event = {
	id = grace.31
	is_triggered_only = yes
	title = EVTTITLE_GRACE_31
	desc = EVTDESC_GRACE_31
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_relief_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_31 # Accept the relief
		
		character_event = { id = grace.911 days = 30} # Monthly check to see if the relief has any effect
		
		FROMFROM = {
			letter_event = { id = grace.32 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_relief
		}
	}
	
	option = {
		trigger = {
			china_accepts_relief_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_31 # Refuse the relief, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.33 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_relief_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_31 # Refuse the relief, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.33 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
	}
}

# Relief accepted, sender gets Grace
letter_event = {
	id = grace.32
	is_triggered_only = yes
    border = GFX_event_letter_frame_diplomacy
	
	desc = EVTDESC_GRACE_32
	
	option = {
		name = EVTOPTA_GRACE_32
		
		add_character_modifier = {
			modifier = china_send_relief
			days = 3650 # 10 years
		}
		
		sound_effect = china_grace_gain
		change_variable = {
			which = grace
			value = 500
		}
		set_character_flag = grace_character
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s relief tribute!"
	}
}

# Relief refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.33
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_33
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_33
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_relief
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s relief tribute!"
	}
}

### Send Artifact (34-37)

# The EoC gets the offer
narrative_event = {
	id = grace.34
	is_triggered_only = yes
	title = EVTTITLE_GRACE_34
	desc = EVTDESC_GRACE_34
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		set_variable = {
			which = artifact_value
			value = 0 # Reset if already used
		}
		change_variable = {
			which = artifact_value
			value = 500
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 5
				}
			}
			change_variable = {
				which = artifact_value
				value = 9500
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 4
				}
			}
			change_variable = {
				which = artifact_value
				value = 4500
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 3
				}
			}
			change_variable = {
				which = artifact_value
				value = 1500
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 2
				}
			}
			change_variable = {
				which = artifact_value
				value = 500
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality < 4
					has_artifact_flag = lore #Magnum Opus book
					ROOT = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = artifact_value
				value = -200
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 4
					has_artifact_flag = lore #Magnum Opus book
					ROOT = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = artifact_value
				value = -300
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality < 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = artifact_value
				value = -250
			}
		}
		if = {
			limit = {
				FROMFROMFROM = {
					quality == 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = artifact_value
				value = -350
			}
		}
		if = {
			limit = {
				trait = greedy
			}
			multiply_variable = {
				which = artifact_value
				value = 1.5
			}
		}
		if = {
			limit = {
				trait = charitable
			}
			multiply_variable = {
				which = artifact_value
				value = 0.5
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_artifact_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_34 # Accept the artifact
		
		FROMFROM = {
			letter_event = { id = grace.35 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_artifact
		}
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				check_variable = {
					which = artifact_value
					value = 3000
				}
			}
			modifier = {
				factor = 10
				check_variable = {
					which = artifact_value
					value = 5000
				}
			}
			modifier = {
				factor = 100
				check_variable = {
					which = artifact_value
					value = 10000
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_accepts_artifact_tribute_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOR = {
				test_grace_refusal_trigger = yes
			}
			any_realm_lord = {
				higher_tier_than = baron
				china_hates_prevprev_trigger = no
				NOT = {
					has_artifact = FROMFROMFROM
				}
			}
		}
		name = EVTOPTB_GRACE_34 # Accept the artifact, but give them to a random vassal
		
		FROMFROM = {
			letter_event = { id = grace.36 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_sent_artifact_small
		}
		
		ai_chance = {
			factor = 90
			modifier = {
				factor = 0.1
				check_variable = {
					which = artifact_value
					value = 3000
				}
			}
			modifier = {
				factor = 0.1
				check_variable = {
					which = artifact_value
					value = 5000
				}
			}
			modifier = {
				factor = 0
				check_variable = {
					which = artifact_value
					value = 10000
				}
				NOR = {
					trait = charitable
					AND = {
						OR = {
							trait = humble
							trait = content
						}
						NOT = {
							trait = greedy
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			china_accepts_artifact_tribute_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_34 # Refuse the artifact, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.37 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_artifact_tribute_fromfrom_trigger = yes
		}
		name = EVTOPTD_GRACE_34 # Refuse the artifact, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.37 }
		}
		
		prestige = -200
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -200
				}
			}
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = artifact_value
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Artifact accepted, sender gets Grace
letter_event = {
	id = grace.35
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_35
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 500
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 5
				}
			}
			change_variable = {
				which = grace_gain
				value = 9500
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
				}
			}
			change_variable = {
				which = grace_gain
				value = 4500
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 3
				}
			}
			change_variable = {
				which = grace_gain
				value = 1500
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 2
				}
			}
			change_variable = {
				which = grace_gain
				value = 500
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality < 4
					has_artifact_flag = lore #Magnum Opus book
					FROM = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = -200
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
					has_artifact_flag = lore #Magnum Opus book
					FROM = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = -300
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality < 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = grace_gain
				value = -250
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = grace_gain
				value = -350
			}
		}
		if = {
			limit = {
				FROM = {
					trait = greedy
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 1.5
			}
		}
		if = {
			limit = {
				FROM = {
					trait = charitable
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 0.5
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_35
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			transfer_artifact = {
				to = FROM
				from = ROOT
			}
		}
		log = "GRACE SYSTEM: [From.GetTitledName] accepted [Root.GetTitledName]'s artifact tribute!"
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Artifact accepted but given to a vassal, sender gets less Grace + lowered opinion of the EoC
letter_event = {
	id = grace.36
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_36
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		set_variable = {
			which = grace_gain
			value = 0 # Reset if already used
		}
		change_variable = {
			which = grace_gain
			value = 250
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 5
				}
			}
			change_variable = {
				which = grace_gain
				value = 4750
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
				}
			}
			change_variable = {
				which = grace_gain
				value = 2250
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 3
				}
			}
			change_variable = {
				which = grace_gain
				value = 750
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 2
				}
			}
			change_variable = {
				which = grace_gain
				value = 250
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality < 4
					has_artifact_flag = lore #Magnum Opus book
					FROM = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = -200
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
					has_artifact_flag = lore #Magnum Opus book
					FROM = {
						NOT = {
							society_member_of = hermetics
						}
					}
				}
			}
			change_variable = {
				which = grace_gain
				value = -300
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality < 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = grace_gain
				value = -250
			}
		}
		if = {
			limit = {
				FROMFROMFROMFROM = {
					quality == 4
					has_artifact_flag = created
				}
			}
			change_variable = {
				which = grace_gain
				value = -350
			}
		}
		if = {
			limit = {
				FROM = {
					trait = greedy
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 1.5
			}
		}
		if = {
			limit = {
				FROM = {
					trait = charitable
				}
			}
			multiply_variable = {
				which = grace_gain
				value = 0.5
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_36
		
		change_variable = {
			which = grace
			which = grace_gain
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		
		FROMFROMFROMFROM = {
			save_event_target_as = tribute_artifact
		}
		
		FROM = {
			letter_event = { id = grace.909 }
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_artifact_not_imperial
		}
	}
	
	after = {
		hidden_tooltip = {
			set_variable = {
				which = grace_gain
				value = 0 # Clearing it for save game memory optimization
			}
		}
	}
}

# Artifact refused, sender's opinion of the EoC
letter_event = {
	id = grace.37
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_37
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_37
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_artifact
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused [Root.GetTitledName]'s artifact tribute!"
	}
}

### Increase tributary tier or become a subject (38-40)

# The EoC gets the offer, can accept or refuse
narrative_event = {
	id = grace.38
	is_triggered_only = yes
	title = EVTTITLE_GRACE_38
	desc = EVTDESC_GRACE_38
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		log = "GRACE SYSTEM: [FromFrom.GetTitledName] asked to become a higher tier tributary or a subject"
		if = {
			limit = {
				FROMFROM = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			log = "GRACE SYSTEM: [FromFrom.GetTitledName] is currently a Client State"
		}
		else_if = {
			limit = {
				FROMFROM = {
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			log = "GRACE SYSTEM: [FromFrom.GetTitledName] is currently a Protectorate"
		}
		else_if = {
			limit = {
				FROMFROM = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
				}
			}
			log = "GRACE SYSTEM: [FromFrom.GetTitledName] is currently an Imperial Tributary"
		}
		else_if = {
			limit = {
				FROMFROM = {
					is_tributary = {
						type = chinese_peripheral_tributary
					}
				}
			}
			log = "GRACE SYSTEM: [FromFrom.GetTitledName] is currently a Peripheral Tributary"
		}
		else = {
			log = "GRACE SYSTEM: Something is not right!"
		}
	}
	
	option = {
		trigger = {
			#OR = {
			#	ai = no
			#	china_accepts_tributary_fromfrom_trigger = yes
			#	test_grace_acceptance_trigger = yes
			#}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		
		name = {
			trigger = {
				FROMFROM = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			text = EVTOPTA_GRACE_38A # Accept the offer
		}
		name = {
			trigger = {
				NOT = {
					FROMFROM = {
						is_tributary = {
							type = chinese_client_state
						}
					}
				}
			}
			text = EVTOPTA_GRACE_38B # Accept the offer
		}
		
		FROMFROM = {
			letter_event = { id = grace.39 }
		}
		
		opinion = {
			who = FROMFROM
			modifier = opinion_china_became_tributary
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_tributary_fromfrom_trigger = no
			#NOT = {
			#	test_grace_acceptance_trigger = yes
			#}
		}
		name = EVTOPTB_GRACE_38 # Refuse the offer, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.40 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_accepts_tributary_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_38 # Refuse the tributary, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.40 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Tributary status accepted, sender gets Grace and becomes a tributary
letter_event = {
	id = grace.39
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_39
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_39
		
		change_variable = {
			which = grace
			value = 200
		}
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_recently_became_higher_tier_tributary
			}
		}
		set_character_flag = grace_character
		
		sound_effect = china_grace_gain
		increase_tributary_tier_or_vassalize_effect = yes
		log = "GRACE SYSTEM: [From.GetTitledName] accepted the request to increase [Root.GetTitledName]'s tributary tier!"
	}
}

# Tributary status refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.40
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_40
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_40
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_increse_tributary_tier
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused the request to increase [Root.GetTitledName]'s tributary tier!"
	}
}



##### Boons (301-348, reserved ids 301-600)

### Peace Deal (301-303)

# The EoC gets the request
narrative_event = {
	id = grace.301
	is_triggered_only = yes
	title = EVTTITLE_GRACE_301
	desc = EVTDESC_GRACE_301
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_peace_deal_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_301 # Grant the Peace Deal
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.302 }
		}
	}
	
	option = {
		trigger = {
			china_grants_peace_deal_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_301 # Refuse the Peace Deal, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.303 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_peace_deal_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_301 # Refuse the Peace Deal, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.303 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, peace deal signed
letter_event = {
	id = grace.302
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_302
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_302
		
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a Peace Deal by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.303
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_303
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_303
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_peace_deal
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a Peace Deal by [From.GetTitledName]!"
	}
}

### Chinese Physician (304-306)

# The EoC gets the request
narrative_event = {
	id = grace.304
	is_triggered_only = yes
	title = EVTTITLE_GRACE_304
	desc = EVTDESC_GRACE_304
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_physician_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_304 # Grant the Physician
		
		FROMFROM = {
			letter_event = { id = grace.305 }
		}
	}
	
	option = {
		trigger = {
			china_grants_physician_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_304 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.306 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_physician_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_304 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.306 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, physician arrives
letter_event = {
	id = grace.305
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_305
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
		}
        new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_doctor
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_physician
			random_list = {
				50 = { add_trait = scholarly_theologian }
				25 = { add_trait = mastermind_theologian }
			}
			add_trait = physician
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				30 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
			}
			random_list = {
				80 = { } #Nothing
				2 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				4 = { add_trait = lisp }
				4 = { add_trait = stutter }
				2 = { add_trait = ugly }
				2 = { add_trait = dwarf }
				2 = { add_trait = weak }
			}
			random_list = {
				50 = { } #Nothing
				25 = { add_trait = patient }
				25 = { add_trait = diligent }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				20 = { #Combat medic
					set_character_flag = archetype_decisive
					random_list = {
						50 = { add_trait = duelist }
						50 = { add_trait = scholar }
					}
					add_trait = scarred
					add_trait = robust
					random_list = {
						60 = { } #Nothing
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_legged 
						}
						20 = { 
							trigger = { has_dlc = Reapers }
							add_trait = one_eyed 
						}
					}
					add_trait = brave
					random_list = {
						30 = { } #Nothing
						50 = { add_trait = cynical }
						10 = {
							add_trait = cynical
							add_trait = depressed
						}
						10 = {
							add_trait = cynical
							add_trait = depressed
							add_trait = drunkard
						}
					}
					random_list = {
						50 = { } #Nothing
						20 = { add_trait = kind }
						30 = { add_trait = honest }
					}
					remove_trait = dwarf
					remove_trait = weak
				}
				#Dr Jerk
				15 = { 
					set_character_flag = archetype_decisive
					add_trait = scholar
					add_trait = wroth
					remove_trait = patient
					random_list = {
						30 = { add_trait = proud }
						30 = { add_trait = envious }
						40 = { } #Nothing
					}
					add_trait = honest
					add_trait = cynical
					random = {
						chance = 30
						add_trait = drunkard
					}
					random_list = {
						60 = { }
						20 = { 
							add_trait = clubfooted
							set_name = Wu #House
						}
						20 = {
							trigger = { has_dlc = Reapers }
							add_trait = one_legged
							set_name = Wu #House
						}
					}
				}
				10 = { #Mad genius 
					set_character_flag = archetype_sociable
					random_list = {
						50 = { add_trait = impaler }
						50 = { add_trait = mystic }
					}
					random_list = {
						33 = { add_trait = drunkard } 
						33 = { add_trait = lunatic }
						33 = { add_trait = possessed }
					}
					add_trait = genius
					remove_trait = quick
					remove_trait = shrewd
					add_trait = paranoid
					random_list = {
						25 = { add_trait = gluttonous } 
						25 = { add_trait = wroth }
						25 = { add_trait = proud }
						25 = { add_trait = greedy }
					}   
				}
				20 = { #Herbalist
					set_character_flag = archetype_supportive
					add_trait = gardener
					add_trait = diligent
					add_trait = humble
					random_list = {
						33 = { add_trait = content } 
						33 = { add_trait = shy }
						33 = { add_trait = poet }
					}
					random = {
						chance = 50
						add_trait = robust
					}
					remove_trait = weak
				}
				20 = { #Health nut
					set_character_flag = archetype_conservative
					add_trait = mystic
					add_trait = celibate
					add_trait = chaste
					add_trait = temperate
					random_list = {
						50 = { add_trait = craven } 
						25 = { add_trait = shy }
						25 = { add_trait = content }
					}
					set_focus = focus_scholarship
				}
				20 = { #Compassionate doctor
					set_character_flag = archetype_supportive
					random_list = {
						50 = { add_trait = socializer }
						50 = { add_trait = scholar }
					}
					add_trait = kind
					add_trait = patient
					random_list = {
						25 = { add_trait = content } 
						25 = { add_trait = humble }
						25 = { add_trait = trusting }
						25 = { add_trait = charitable }
					}
					set_focus = focus_family
				}
				15 = { #McDreamy
					set_character_flag = archetype_sociable
					if = {
						limit = { is_female = yes }
						add_trait = seductress
					}
					if = {
						limit = { is_female = no }
						add_trait = seducer
					}
					random_list = {
						50 = { } #Nothing
						25 = { add_trait = poet }
						25 = { add_trait = falconer }
					}
					random_list = {
						30 = { add_trait = fair }
						50 = { add_trait = strong }
					}
					add_trait = lustful
					random_list = {
						35 = { add_trait = ambitious }
						35 = { add_trait = gregarious }
						30 = { } #Nothing
					}
					set_focus = focus_seduction
					remove_trait = clubfooted
					remove_trait = harelip
					remove_trait =  hunchback 
					remove_trait = lisp
					remove_trait = stutter
					remove_trait = ugly
					remove_trait = dwarf
					remove_trait = weak
				}
			}
		}
		new_character = {
			if = {
				limit = {
					FROM = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				change_learning = 5
			}
			give_minor_title = title_court_physician
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_305
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a physician by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.306
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_306
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_306
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_physician_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a physician by [From.GetTitledName]!"
	}
}

### Chinese Artifact (307-319)

# The EoC gets the request
narrative_event = {
	id = grace.307
	is_triggered_only = yes
	title = EVTTITLE_GRACE_307
	desc = EVTDESC_GRACE_307
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			FROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_painting_of_glitterhoof
						#has_artifact = chinese_prev_emperor_sculpture # TODO
						has_artifact = chinese_arm_protector
						has_artifact = chinese_serpent_spear
						has_artifact = chinese_tapestry
						has_artifact = chinese_artwork
						has_artifact = chinese_calligraphy
						has_artifact = chinese_sculpture
						has_artifact = chinese_book_history
					}
				}
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_307 # Grant tier 1-2 artifact
		
		letter_event = { id = grace.308 }
		
		ai_chance = {
			factor = 70
			modifier = {
				factor = 100
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
			modifier = {
				factor = 1000
				has_any_opinion_modifier = opinion_my_horse # If the EoC has Glitterhoof, obviously a painting of Glitterhoof is nice to send!
				FROMFROM = {
					NOT = {
						has_artifact = chinese_painting_of_glitterhoof
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
			FROMFROM = {
				NOT = {
					AND = {
						has_artifact = silk_shroud
						has_artifact = chinese_tapestry_grand
						has_artifact = chinese_ji
						has_artifact = chinese_crossbow
						has_artifact = chinese_bronze_sculpture
						has_artifact = chinese_ceremonial_robes
						has_artifact = water_clock
						has_artifact = jian_sword
						has_artifact = chinese_dragon_amulet
						has_artifact = chinese_book_health
						has_artifact = chinese_book_law
						has_artifact = chinese_book_economy
					}
				}
			}
		}
		name = EVTOPTB_GRACE_307 # Grant tier 3-4 artifact
		
		letter_event = { id = grace.313	}
		
		ai_chance = {
			factor = 29
			modifier = {
				factor = 0.1
				trait = greedy
			}
			modifier = {
				factor = 5
				trait = charitable
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_artifact_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
			FROMFROM = {
				NOT = {
					AND = {
						has_artifact = jade_dragon
						has_artifact = art_of_war
						has_artifact = classic_of_poetry
					}
				}
			}
		}
		name = EVTOPTC_GRACE_307 # Grant tier 5 artifact
		
		wealth = -1000
		
		letter_event = { id = grace.920	} # Select tier 5 artifact
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.01
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = charitable
			}
		}
	}
	option = {
		trigger = {
			china_grants_artifact_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTD_GRACE_307 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.319 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_artifact_boon_fromfrom_trigger = yes
		}
		name = EVTOPTE_GRACE_307 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.319 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Select tier 1-2
letter_event = {
	id = grace.308
	is_triggered_only = yes
	desc = EVTDESC_GRACE_308
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_painting_of_glitterhoof
						#has_artifact = chinese_prev_emperor_sculpture # TODO
						has_artifact = chinese_book_history
					}
				}
			}
		}
		
		name = EVTOPTA_GRACE_308 # Tier 1
		
		ai_chance = {
			factor = 70
			modifier = {
				factor = 100
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
			modifier = {
				factor = 1000
				has_any_opinion_modifier = opinion_my_horse # If the EoC has Glitterhoof, obviously a painting of Glitterhoof is nice to send!
				FROMFROMFROM = {
					NOT = {
						has_artifact = chinese_painting_of_glitterhoof
					}
				}
			}
		}
		
		letter_event = { id = grace.309 }
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = chinese_arm_protector
						has_artifact = chinese_serpent_spear
						has_artifact = chinese_tapestry
						has_artifact = chinese_artwork
						has_artifact = chinese_calligraphy
						has_artifact = chinese_sculpture
					}
				}
			}
		}
		
		name = EVTOPTB_GRACE_308 # Tier 2
		
		letter_event = { id = grace.311 }
		
		ai_chance = {
			factor = 30
		}
	}
}

# Select tier 1 artifact
letter_event = {
	id = grace.309
	is_triggered_only = yes
	desc = EVTDESC_GRACE_309
	
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_painting_of_glitterhoof
				}
			}
		}
		
		name = EVTOPTA_GRACE_309
		
		wealth = -50
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_painting_of_glitterhoof
			letter_event = { id = grace.310 }
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1000
				has_any_opinion_modifier = opinion_my_horse # If the EoC has Glitterhoof, obviously a painting of Glitterhoof is nice to send!
			}
		}
	}
	
	option = {
		trigger = {
			always = no # TODO
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_prev_emperor_sculpture # TODO
				}
			}
		}
		
		name = EVTOPTB_GRACE_309
		
		wealth = -50
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_prev_emperor_sculpture
			letter_event = { id = grace.310 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_book_history
				}
			}
		}
		
		name = EVTOPTC_GRACE_309
		
		wealth = -50
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_book_history
			letter_event = { id = grace.310 }
		}
	}
}

# Sender gets tier 1 artifact
letter_event = {
	id = grace.310
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_chinese_painting_of_glitterhoof
		}
		text = EVTDESCA_GRACE_310
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_prev_emperor_sculpture
		}
		text = EVTDESCB_GRACE_310
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_book_history
		}
		text = EVTDESCC_GRACE_310
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_chinese_painting_of_glitterhoof
			}
			add_artifact = chinese_painting_of_glitterhoof
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_prev_emperor_sculpture
			}
			add_artifact = chinese_prev_emperor_sculpture
			new_artifact = {
				set_name="chinese_figurine_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_book_history
			}
			add_artifact = chinese_book_history
			new_artifact = {
				set_name="chinese_book_history_name"
				set_original_owner = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_310
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a tier 1 artifact by [From.GetTitledName]!"
		clr_character_flag = getting_chinese_painting_of_glitterhoof
		clr_character_flag = getting_chinese_prev_emperor_sculpture
		clr_character_flag = getting_chinese_book_history
	}
}

# Select tier 2 artifact (can repeat)
letter_event = {
	id = grace.311
	is_triggered_only = yes
	desc = EVTDESC_GRACE_311
	
	immediate = {
		clr_character_flag = repeat_artifact_choice_event
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_arm_protector
				}
			}
		}
		
		name = EVTOPTA_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_arm_protector
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_serpent_spear
				}
			}
		}
		
		name = EVTOPTB_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_serpent_spear
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_tapestry
				}
			}
		}
		
		name = EVTOPTC_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_tapestry
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
		}
		
		name = EVTOPTD_GRACE_311 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.311 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_artwork
				}
			}
		}
		
		name = EVTOPTE_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_artwork
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_calligraphy
				}
			}
		}
		
		name = EVTOPTF_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_calligraphy
			letter_event = { id = grace.312 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_sculpture
				}
			}
		}
		
		name = EVTOPTG_GRACE_311
		
		wealth = -100
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_sculpture
			letter_event = { id = grace.312 }
		}
	}
	option = {
		trigger = {
			ai = no
			has_character_flag = repeat_artifact_choice_event
		}
		
		name = EVTOPTD_GRACE_311 # More options
		
		clr_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.311 }
	}
	
}

# Sender gets tier 2 artifact
letter_event = {
	id = grace.312
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_chinese_arm_protector
		}
		text = EVTDESCA_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_serpent_spear
		}
		text = EVTDESCB_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_tapestry
		}
		text = EVTDESCC_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_artwork
		}
		text = EVTDESCD_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_calligraphy
		}
		text = EVTDESCE_GRACE_312
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_sculpture
		}
		text = EVTDESCF_GRACE_312
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_chinese_arm_protector
			}
			add_artifact = chinese_arm_protector
			new_artifact = {
				set_name="chinese_arm_protector_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_serpent_spear
			}
			add_artifact = chinese_serpent_spear
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_tapestry
			}
			random_independent_ruler = {
				limit = {
					any_realm_province = {
						trade_route = silk_road
					}
				}
				random_realm_province = {
					limit = {
						trade_route = silk_road
					}
					save_event_target_as = tapestry_target
				}
			}
			add_artifact = chinese_tapestry
			new_artifact = {
				set_name="chinese_tapestry_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_artwork
			}
			add_artifact = chinese_artwork
			new_artifact = {
				set_name="chinese_artwork_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_calligraphy
			}
			add_artifact = chinese_calligraphy
			new_artifact = {
				set_name="chinese_calligraphy_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_sculpture
			}
			add_artifact = chinese_sculpture
			new_artifact = {
				set_name="chinese_sculpture_name"
				set_original_owner = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_312
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a tier 2 artifact by [From.GetTitledName]!"
		clr_character_flag = getting_chinese_arm_protector
		clr_character_flag = getting_chinese_serpent_spear
		clr_character_flag = getting_chinese_tapestry
		clr_character_flag = getting_chinese_artwork
		clr_character_flag = getting_chinese_calligraphy
		clr_character_flag = getting_chinese_sculpture
	}
}

# Select tier 3-4 artifact
letter_event = {
	id = grace.313
	is_triggered_only = yes
	desc = EVTDESC_GRACE_313
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = silk_shroud
						has_artifact = chinese_tapestry_grand
						has_artifact = chinese_ji
						has_artifact = chinese_crossbow
						has_artifact = chinese_bronze_sculpture
						has_artifact = chinese_ceremonial_robes
						has_artifact = chinese_book_health
						has_artifact = chinese_book_law
						has_artifact = chinese_book_economy
					}
				}
			}
		}
		
		name = EVTOPTA_GRACE_313 # Tier 3
		
		ai_chance = {
			factor = 85
			modifier = {
				factor = 100
				trait = greedy
			}
			modifier = {
				factor = 0.1
				trait = charitable
			}
		}
		
		letter_event = { id = grace.314 }
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					AND = {
						has_artifact = water_clock
						has_artifact = jian_sword
						has_artifact = chinese_dragon_amulet
					}
				}
			}
		}
		
		name = EVTOPTB_GRACE_313 # Tier 4
		
		letter_event = { id = grace.316 }
		
		ai_chance = {
			factor = 15
			modifier = {
				factor = 0.01
				trait = greedy
			}
			modifier = {
				factor = 5
				trait = charitable
			}
		}
	}
}

# Select tier 3 artifact (can repeat)
letter_event = {
	id = grace.314
	is_triggered_only = yes
	desc = EVTDESC_GRACE_314
	
	immediate = {
		clr_character_flag = repeat_artifact_choice_event
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = silk_shroud
				}
			}
		}
		
		name = EVTOPTA_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_silk_shroud
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_tapestry_grand
				}
			}
		}
		
		name = EVTOPTB_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_tapestry_grand
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_ji
				}
			}
		}
		
		name = EVTOPTC_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_ji
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			NOT = {
				has_character_flag = repeat_artifact_choice_event
			}
		}
		
		name = EVTOPTD_GRACE_314 # More options
		
		set_character_flag = repeat_artifact_choice_event
		
		repeat_event = { id = grace.314 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_crossbow
				}
			}
		}
		
		name = EVTOPTE_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_crossbow
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_bronze_sculpture
				}
			}
		}
		
		name = EVTOPTF_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_bronze_sculpture
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_ceremonial_robes
				}
			}
		}
		
		name = EVTOPTG_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_ceremonial_robes
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			AND = {
				has_character_flag = repeat_artifact_choice_event
				NOT = {
					has_character_flag = repeat_artifact_choice_event_2
				}
			}
		}
		
		name = EVTOPTD_GRACE_314 # More options
		
		set_character_flag = repeat_artifact_choice_event_2
		
		repeat_event = { id = grace.314 }
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_book_health
				}
			}
		}
		
		name = EVTOPTH_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_book_health
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_book_law
				}
			}
		}
		
		name = EVTOPTI_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_book_law
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = yes
				AND = {
					has_character_flag = repeat_artifact_choice_event
					NOT = {
						has_character_flag = repeat_artifact_choice_event_2
					}
				}
			}
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_book_economy
				}
			}
		}
		
		name = EVTOPTJ_GRACE_314
		
		wealth = -250
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_book_economy
			letter_event = { id = grace.315 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			AND = {
				has_character_flag = repeat_artifact_choice_event
				has_character_flag = repeat_artifact_choice_event_2
			}
		}
		
		name = EVTOPTD_GRACE_314 # More options
		
		clr_character_flag = repeat_artifact_choice_event
		clr_character_flag = repeat_artifact_choice_event_2
		
		repeat_event = { id = grace.314 }
	}
}

# Sender gets tier 3 artifact + small amount of prestige
letter_event = {
	id = grace.315
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_silk_shroud
		}
		text = EVTDESCA_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_tapestry_grand
		}
		text = EVTDESCB_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_ji
		}
		text = EVTDESCC_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_crossbow
		}
		text = EVTDESCD_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_bronze_sculpture
		}
		text = EVTDESCE_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_ceremonial_robes
		}
		text = EVTDESCF_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_book_health
		}
		text = EVTDESCG_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_book_law
		}
		text = EVTDESCH_GRACE_315
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_book_economy
		}
		text = EVTDESCI_GRACE_315
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_silk_shroud
			}
			add_artifact = silk_shroud
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_tapestry_grand
			}
			add_artifact = chinese_tapestry_grand
			new_artifact = {
				set_name="chinese_tapestry_grand_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_ji
			}
			add_artifact = chinese_ji
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_crossbow
			}
			add_artifact = chinese_crossbow
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_bronze_sculpture
			}
			add_artifact = chinese_bronze_sculpture
			new_artifact = {
				set_name="chinese_bronze_sculpture_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_ceremonial_robes
			}
			add_artifact = chinese_ceremonial_robes
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_book_health
			}
			add_artifact = chinese_book_health
			new_artifact = {
				set_name="chinese_book_health_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_book_law
			}
			add_artifact = chinese_book_law
			new_artifact = {
				set_name="chinese_book_law_name"
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_book_economy
			}
			add_artifact = chinese_book_economy
			new_artifact = {
				set_name="chinese_book_economy_name"
				set_original_owner = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_315
		prestige = 200
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a tier 3 artifact by [From.GetTitledName]!"
		clr_character_flag = getting_silk_shroud
		clr_character_flag = getting_chinese_tapestry_grand
		clr_character_flag = getting_chinese_ji
		clr_character_flag = getting_chinese_crossbow
		clr_character_flag = getting_chinese_bronze_sculpture
		clr_character_flag = getting_chinese_ceremonial_robes
		clr_character_flag = getting_chinese_book_health
		clr_character_flag = getting_chinese_book_law
		clr_character_flag = getting_chinese_book_economy
	}
}

# Select tier 4 artifact
letter_event = {
	id = grace.316
	is_triggered_only = yes
	desc = EVTDESC_GRACE_316
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = water_clock
				}
			}
		}
		
		name = EVTOPTA_GRACE_316
		
		wealth = -500
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_water_clock
			letter_event = { id = grace.317 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = jian_sword
				}
			}
		}
		
		name = EVTOPTB_GRACE_316
		
		wealth = -500
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_jian_sword
			letter_event = { id = grace.317 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROMFROM = {
				NOT = {
					has_artifact = chinese_dragon_amulet
				}
			}
		}
		
		name = EVTOPTC_GRACE_316
		
		wealth = -500
		
		FROMFROMFROMFROM = {
			set_character_flag = getting_chinese_dragon_amulet
			letter_event = { id = grace.317 }
		}
	}
}

# Sender gets tier 4 artifact + medium amount of prestige
letter_event = {
	id = grace.317
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_water_clock
		}
		text = EVTDESCA_GRACE_317
	}
	desc = {
		trigger = {
			has_character_flag = getting_jian_sword
		}
		text = EVTDESCB_GRACE_317
	}
	desc = {
		trigger = {
			has_character_flag = getting_chinese_dragon_amulet
		}
		text = EVTDESCC_GRACE_317
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_water_clock
			}
			add_artifact = water_clock
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_jian_sword
			}
			add_artifact = jian_sword
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_chinese_dragon_amulet
			}
			add_artifact = chinese_dragon_amulet
			new_artifact = {
				set_original_owner = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_317
		prestige = 500
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a tier 4 artifact by [From.GetTitledName]!"
		clr_character_flag = getting_water_clock
		clr_character_flag = getting_jian_sword
		clr_character_flag = getting_chinese_dragon_amulet
	}
}

# Sender gets tier 5 artifact + large amount of prestige
letter_event = {
	id = grace.318
	is_triggered_only = yes
	desc = {
		trigger = {
			has_character_flag = getting_jade_dragon
		}
		text = EVTDESCA_GRACE_318
	}
	desc = {
		trigger = {
			has_character_flag = getting_art_of_war
		}
		text = EVTDESCB_GRACE_318
	}
	desc = {
		trigger = {
			has_character_flag = getting_classic_of_poetry
		}
		text = EVTDESCC_GRACE_318
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = getting_jade_dragon
			}
			add_artifact = jade_dragon
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_art_of_war
			}
			add_artifact = art_of_war
			new_artifact = {
				set_original_owner = FROM
			}
		}
		if = {
			limit = {
				has_character_flag = getting_classic_of_poetry
			}
			add_artifact = classic_of_poetry
			new_artifact = {
				set_original_owner = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTA_GRACE_317
		prestige = 1000
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a tier 5 artifact by [From.GetTitledName]!"
		clr_character_flag = getting_jade_dragon
		clr_character_flag = getting_art_of_war
		clr_character_flag = getting_classic_of_poetry
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.319
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_319
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_319
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_artifact_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an artifact by [From.GetTitledName]!"
	}
}

### Siege Engineer (320-322)

# The EoC gets the request
narrative_event = {
	id = grace.320
	is_triggered_only = yes
	title = EVTTITLE_GRACE_320
	desc = EVTDESC_GRACE_320
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_siege_engineer_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_320 # Grant the Siege Engineer
		
		FROMFROM = {
			letter_event = { id = grace.321 }
		}
	}
	
	option = {
		trigger = {
			china_grants_siege_engineer_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_320 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.322 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_siege_engineer_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_320 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.322 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, siege engineer arrives
letter_event = {
	id = grace.321
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_321
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			33 = {
				create_random_soldier = {
					age = 55
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 16
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 35
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
			33 = {
				create_random_soldier = {
					age = 37
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					random_traits = yes
					attributes = {
						diplomacy = 2
						learning = 2
						stewardship = 2
						intrigue = 2
						martial = 8
					}
				}
				new_character = {
					save_event_target_as = chinese_siege_engineer
					set_character_flag = ai_flag_refuse_concubinage
					set_character_flag = ai_flag_refuse_marriage
					set_character_flag = originated_from_chinese_court
					set_character_flag = chinese_courtier_original_court_@PREV
					set_character_flag = no_court_invites
					set_character_flag = taught_chinese_strategy
					set_character_flag = is_chinese_siege_engineer
					
					remove_trait = weak
					remove_trait = slow
					remove_trait = imbecile
					remove_trait = dull
					
					remove_trait = craven
					remove_trait = mystic
					remove_trait = socializer
					remove_trait = gamer
					remove_trait = hedonist
					remove_trait = duelist
					remove_trait = hunter
					remove_trait = strategist
					remove_trait = administrator
					remove_trait = architect
					remove_trait = gardener
					remove_trait = schemer
					remove_trait = impaler
					remove_trait = seducer
					remove_trait = seductress
					remove_trait = theologian
					remove_trait = scholar
					
					add_trait = sapper
					if = {
						limit = {
							FROM = {
								has_character_modifier = mandate_of_heaven_5
							}
						}
						change_martial = 5
					}
					
					random_list = { # Flavor Randomization
						15 = {
							change_martial = 2
						}
						10 = {
							add_trait = robust
						}
						10 = {
							add_trait = duelist
						}
						10 = {
							add_trait = architect
						}
						5 = {
							add_trait = strategist
						}
						5 = {
							change_martial = 4
						}
						5 = {
							if = {
								limit = {
									has_dlc = "Reapers"
								}
								add_trait = one_eyed
							}
						}
						5 = { 
							add_trait = shrewd
						}
					}
					opinion = {
						who = ROOT
						modifier = opinion_servant
						months = 1200
					}
				}
			}
		}
		new_character = {
			give_minor_title = title_commander
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_321
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a siege engineer by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.322
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_322
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_322
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_siege_engineer_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a siege engineer by [From.GetTitledName]!"
	}
}

### Strategist (323-325)

# The EoC gets the request
narrative_event = {
	id = grace.323
	is_triggered_only = yes
	title = EVTTITLE_GRACE_323
	desc = EVTDESC_GRACE_323
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_strategist_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_323 # Grant the Strategist
		
		FROMFROM = {
			letter_event = { id = grace.324 }
		}
	}
	
	option = {
		trigger = {
			china_grants_strategist_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_323 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.325 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_strategist_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_323 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.325 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, strategist arrives
letter_event = {
	id = grace.324
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_324
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_strategist
			add_character_modifier = {
				name = jd_strategist
				duration = -1
			}
			if = {
				limit = {
					FROM = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				random_list = {
					25 = {
						trigger = { NOT = {trait = master_of_flame } }
						add_trait = master_of_flame
					}
					25 = {
						trigger = { NOT = {trait = logistics_expert } }
						add_trait = logistics_expert
					}
					25 = {
						trigger = { NOT = {trait = levy_coordinator } }
						add_trait = levy_coordinator
					}
					25 = {
						trigger = { NOT = {trait = sapper } }
						add_trait = sapper
					}
				}
				set_character_flag = jd_strategist_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = chinese_courtier_original_court_@PREV
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_strategist
			random_list = {
				80 = { add_trait = skilled_tactician }
				20 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { add_trait = brave } 
				20 = { add_trait = strong }
				20 = { add_trait = shrewd }
				40 = { add_trait = robust }
			}
			random_list = {
				71 = { } #Nothing
				20 = { add_trait = scarred }
				5 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_eyed 
					change_martial = 1
				}
				2 = { 
					trigger = { has_dlc = Reapers }
					add_trait = one_handed
					change_martial = 1
				}
				2 = { add_trait = ugly }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						add_trait = strategist
					}
					add_trait = logistics_expert
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = hunter }
							50 = { add_trait = strategist }
						}
					}
					add_trait = sapper 
					add_trait = humble
					add_trait = patient
					random_list = {
						30 = { add_trait = slothful }
						70 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = strategist }
							50 = { add_trait = duelist }
						}
					}
					add_trait = master_of_flame 
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							20 = { add_trait = duelist }
							40 = { add_trait = hunter }
							40 = { add_trait = gamer }
						}
					}
					add_trait = levy_coordinator 
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						33 = { add_trait = envious }
						33 = { add_trait = gluttonous }
						33 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = falconer }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}

			#Add second commander trait
			random_list = {
				10 = {
					trigger = { NOT = {trait = master_of_flame } }
					add_trait = master_of_flame
				}
				10 = {
					trigger = { NOT = {trait = logistics_expert } }
					add_trait = logistics_expert
				}
				10 = {
					trigger = { NOT = {trait = levy_coordinator } }
					add_trait = levy_coordinator
				}
				10 = {
					trigger = { NOT = {trait = sapper } }
					add_trait = sapper
				}
				60 = {}
			}
		}
		new_character = {
			give_minor_title = title_commander
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_324
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a strategist by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.325
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_325
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_325
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_strategist_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a strategist by [From.GetTitledName]!"
	}
}

### Scholar-Bureaucrat (326-328)

# The EoC gets the request
narrative_event = {
	id = grace.326
	is_triggered_only = yes
	title = EVTTITLE_GRACE_326
	desc = EVTDESC_GRACE_326
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_administrator_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_326 # Grant the Scholar-Bureaucrat
		
		FROMFROM = {
			letter_event = { id = grace.327 }
		}
	}
	
	option = {
		trigger = {
			china_grants_administrator_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_326 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.328 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_administrator_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_326 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.328 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, scholar-bureaucrat arrives
letter_event = {
	id = grace.327
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_327
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_administrator
			add_character_modifier = {
				name = jd_administrator
				duration = -1
			}
			if = {
				limit = {
					FROM = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				set_character_flag = jd_administrator_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_administrator
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = martial_cleric }
				15 = { add_trait = scholarly_theologian }
				5 = { add_trait = mastermind_theologian }
			}
			random_list = {
				20 = { } #Nothing
				30 = { add_trait = erudite }
				25 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = {  add_trait = weak }
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative 
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = scholar }
							50 = { add_trait = administrator }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = administrator }
							25 = { add_trait = scholar }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = administrator }
							25 = { add_trait = architect }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = administrator }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}   
				}
			}
			give_minor_title = title_administrator
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_327
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a Scholar-Bureaucrat by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.328
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_328
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_328
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_administrator_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a Scholar-Bureaucrat by [From.GetTitledName]!"
	}
}

### Master Engineer (329-331)

# The EoC gets the request
narrative_event = {
	id = grace.329
	is_triggered_only = yes
	title = EVTTITLE_GRACE_329
	desc = EVTDESC_GRACE_329
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_master_engineer_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_329 # Grant the Master Engineer
		
		FROMFROM = {
			letter_event = { id = grace.330 }
		}
	}
	
	option = {
		trigger = {
			china_grants_master_engineer_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_329 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.331 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_master_engineer_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_329 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.331 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, master engineer arrives
letter_event = {
	id = grace.330
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_330
    border = GFX_event_letter_frame_diplomacy
	
	immediate = {
		random_list = {
			50 = { #Female
				modifier = {
					NOT = {
						has_game_rule = {
							name = gender
							value = all
						}
					}
					factor = 0.05
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
			50 = { #Male
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = FROM
					culture = FROM
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
		}
		new_character = {
			#Education & other basic stuff
			save_event_target_as = chinese_master_engineer
			add_character_modifier = {
				name = jd_master_engineer
				duration = -1
			}
			if = {
				limit = {
					FROM = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
				set_character_flag = china_master_engineer_golden_age
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = originated_from_chinese_court
			set_character_flag = no_court_invites
			set_character_flag = is_chinese_master_engineer
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = tough_soldier }
				15 = { add_trait = skilled_tactician }
				5 = { add_trait = brilliant_strategist }
			}
			random_list = {
				20 = { } #Nothing
				20 = { add_trait = erudite }
				20 = { add_trait = shrewd }
				15 = { add_trait = quick }
				5 = { add_trait = genius }
				10 = { add_trait = robust }
				5 = { add_trait = strong }
				5 = { add_trait = fair }
			}
			random_list = {
				85 = { } #Nothing
				1 = { add_trait = clubfooted }
				2 = { add_trait = harelip }
				2 = { add_trait = hunchback }
				3 = { add_trait = lisp }
				3 = { add_trait = stutter }
				2 = { 
					add_trait = ugly 
					remove_trait = fair 
				}
				1 = { add_trait = dwarf }
				1 = { 
					add_trait = weak 
					remove_trait = strong 
					remove_trait = robust
				}
			}
			random = {
				chance = 10
				add_trait = homosexual
			}
			opinion = {
				who = ROOT
				modifier = opinion_servant
				months = 1200
			}

			#Add archetype 
			random_list = {
				#Conservative
				25 = {
					set_character_flag = archetype_conservative
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							75 = { add_trait = architect }
							25 = { add_trait = theologian }
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
					add_trait = stubborn
					add_trait = temperate
					random_list = {
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = deceitful }
						20 = { add_trait = shy }
						20 = { add_trait = cruel }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = chaste }
						25 = { 
							add_trait = patient
							remove_trait = wroth
						}
						25 = { add_trait = just }
					}
				}
				#Supportive
				25 = {
					set_character_flag = archetype_supportive
					if = {
						limit = { has_dlc = "Way of Life" }    
						random_list = {
							50 = { add_trait = architect }
							25 = { add_trait = socializer }
							25 = { add_trait = gardener }
						}
					}
					add_trait = humble
					add_trait = patient
					random_list = {
						33 = { add_trait = slothful }
						33 = { add_trait = craven }
						33 = { add_trait = shy }
					}
					random_list = {
						25 = { add_trait = content }
						25 = { add_trait = charitable }
						25 = { add_trait = kind }
						25 = { add_trait = trusting }
					}      
				}
				#Decisive
				25 = {
					set_character_flag = archetype_decisive
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							50 = { add_trait = architect }
							50 = { add_trait = strategist }
						}
					}
					add_trait = ambitious
					add_trait = cynical
					random_list = {
						20 = { add_trait = cruel }
						20 = { add_trait = stubborn }
						20 = { add_trait = greedy }
						20 = { add_trait = wroth }
						20 = { add_trait = proud }
					}
					random_list = {
						20 = { add_trait = falconer }
						20 = { add_trait = diligent }
						20 = { add_trait = brave }
						20 = { add_trait = honest }
						20 = { add_trait = gregarious }
					}    
				}
				#Sociable
				25 = {
					set_character_flag = archetype_sociable
					if = {
						limit = { has_dlc = "Way of Life" }
						random_list = {
							25 = { add_trait = architect }
							30 = { add_trait = socializer }
							25 = { add_trait = hedonist}
							20 = {
								trigger = { is_female = yes }
								add_trait = seductress
								add_trait = lustful
							}
							20 = {
								trigger = { is_female = no }
								add_trait = seducer
								add_trait = lustful
							}
						}
					}
					add_trait = gregarious
					add_trait = charitable
					random_list = {
						25 = { add_trait = craven }
						25 = { add_trait = envious }
						25 = { add_trait = gluttonous }
						25 = { add_trait = proud }
					}
					random_list = {
						25 = { add_trait = poet }
						25 = { add_trait = kind }
						25 = { add_trait = honest }
						25 = { add_trait = lustful }
					}
				}
			}
		}
		new_character = {
			set_character_flag = master_engineer_just_spawned
			give_minor_title = title_master_engineer
		}
    }
	
	option = {
		name = EVTOPTA_GRACE_330
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a master engineer by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.331
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_331
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_331
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_master_engineer_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a master engineer by [From.GetTitledName]!"
	}
}

### Trade Contract (332-334)

# The EoC gets the request
narrative_event = {
	id = grace.332
	is_triggered_only = yes
	title = EVTTITLE_GRACE_332
	desc = EVTDESC_GRACE_332
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_trade_contract_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
			NOT = {
				test_grace_refusal_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_332 # Grant the Trade Contract
		
		FROMFROM = {
			add_character_modifier = {
				modifier = chinese_imperial_trade_contract
				inherit = yes
				years = 25
			}
			letter_event = { id = grace.333 }
		}
	}
	
	option = {
		trigger = {
			china_grants_trade_contract_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_332 # Refuse the Boon, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.334 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_trade_contract_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_332 # Refuse the Boon, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.334 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
	}
}

# Request accepted, trade contract signed
letter_event = {
	id = grace.333
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_333
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_333
		
		add_character_modifier = {
			inherit = yes
			name = chinese_imperial_trade_contract
			years = 25
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted a Trade Contract by [From.GetTitledName]!"
	}
}

# Request denied, sender's opinion of the EoC lowered
letter_event = {
	id = grace.334
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_334
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_334
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_trade_contract_boon
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused a Trade Contract by [From.GetTitledName]!"
	}
}

### Imperial Marriage (335-338)

# The EoC gets the request
narrative_event = {
	id = grace.335
	is_triggered_only = yes
	title = EVTTITLE_GRACE_335
	desc = EVTDESC_GRACE_335
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		# Clear previously generated event targets
		clear_event_target = dragon_bride_1
		clear_event_target = dragon_bride_2
		clear_event_target = dragon_bride_3
		# If possible, generate three candidates for the EoC to choose from
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_1
		}
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate!
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_2
		}
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate
					}
					event_target:dragon_bride_2 = {
						character = PREV # Pick a different candidate
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_3
		}
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_1 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_335 # Candidate 1 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_1 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
		
		show_portrait = event_target:dragon_bride_1
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_2 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		name = EVTOPTB_GRACE_335 # Candidate 2 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_2 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
		
		show_portrait = event_target:dragon_bride_2
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_3 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		name = EVTOPTC_GRACE_335 # Candidate 3 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_3 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.336 }
		}
		
		show_portrait = event_target:dragon_bride_3
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
			event_target:dragon_bride_1 = {
				always = no
			}
		}
		name = EVTOPTD_GRACE_335 # No valid candidate!
		
		FROMFROM = {
			letter_event = { id = grace.337 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTE_GRACE_335 # Refuse the Imperial Marriage, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.338 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTF_GRACE_335 # Refuse the Imperial Marriage, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.338 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
}

# Request accepted, Chinese princess arrives, NAP signed
letter_event = {
	id = grace.336
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_336
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_336
		
		FROM = {
			event_target:dragon_bride = {
				hidden_tooltip = {
					remove_trait = dragon_bride_unmarried # Remove marriage blocker
					add_trait = dragon_bride_married # Add inheritance blocker
				}
				move_character = ROOT
				force_host = ROOT
				ROOT = {
					FROMFROMFROMFROM = {
						add_spouse = PREVPREV
					}
				}
			}
		}
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted an Imperial Marriage by [From.GetTitledName]!"
	}
}

# Request refused, no suitable candidate (all available princesses are pregnant, lovers of the EoC, or otherwise non-ideal candidates), Grace refunded
letter_event = {
	id = grace.337
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_337
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_337 # Fair enough!
		
		sound_effect = china_grace_gain
		if = {
			limit = {
				suzerain = {
					is_chinese_emperor_trigger = yes
				}
				OR = {
					is_tributary = {
						type = chinese_protectorate
					}
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			if = {
				limit = { has_character_modifier = peace_deal_with_china }
				change_variable = {
					which = grace
					value = 500
				}
			}
			else = {
				change_variable = {
					which = grace
					value = 750
				}
				custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
			}
		}
		else = {
			if = {
				limit = { has_character_modifier = peace_deal_with_china }
				change_variable = {
					which = grace
					value = 1000
				}
			}
			else = {
				change_variable = {
					which = grace
					value = 1500
				}
				custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
			}
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage_good
			# One year long - should keep the AI (and the player) from spamming the EoC if there's no good candidate (though different AI rulers can still try...)
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName] due to no valid candidate!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.338
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_338
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_338
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName]!"
	}
}

### Targeted Imperial Marriage (339-342)

# The EoC gets the request
narrative_event = {
	id = grace.339
	is_triggered_only = yes
	title = EVTTITLE_GRACE_339
	desc = EVTDESC_GRACE_339
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			FROM = {
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_339 # Of course FROM shall be FROMFROMFROM's bride!
		
		FROM = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			add_character_modifier = {
				inherit = yes
				name = peace_deal_with_china
				years = 50
			}
			letter_event = { id = grace.340 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			FROM = {
				OR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTB_GRACE_339 # I'd rather keep her for myself...
		
		FROMFROM = {
			letter_event = { id = grace.341 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_339 # Refuse the Imperial Marriage, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.342 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTD_GRACE_339 # Refuse the Imperial Marriage, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.342 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
}

# Request accepted, Chinese princess arrives, NAP signed
letter_event = {
	id = grace.340
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_340
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_340
		
		FROM = {
			event_target:dragon_bride = {
				hidden_tooltip = {
					remove_trait = dragon_bride_unmarried # Remove marriage blocker
					add_trait = dragon_bride_married # Add inheritance blocker
				}
				move_character = ROOT
				force_host = ROOT
				ROOT = {
					FROMFROMFROMFROM = {
						add_spouse = PREVPREV
					}
				}
			}
		}
		add_character_modifier = {
			inherit = yes
			name = peace_deal_with_china
			years = 50
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted an Imperial Marriage by [From.GetTitledName]!"
	}
}

# Request refused, candidate not suitable, Grace refunded
letter_event = {
	id = grace.341
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_341
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_341 # Fair enough!
		
		sound_effect = china_grace_gain
		if = {
			limit = { has_character_modifier = peace_deal_with_china }
			change_variable = {
				which = grace
				value = 750
			}
		}
		else = {
			change_variable = {
				which = grace
				value = 1000
			}
			custom_tooltip = { text = chinese_imperial_marriage_peace_deal_tt }	
		}
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage_good
			# One year long - should keep the AI (and the player) from spamming the EoC if there's no good candidate (though different AI rulers can still try...)
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName] due to an invalid candidate!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.342
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_342
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_342
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName]!"
	}
}

### Decrease tributary tier (343-345)

# The EoC gets the request
narrative_event = {
	id = grace.343
	is_triggered_only = yes
	title = EVTTITLE_GRACE_343
	desc = EVTDESC_GRACE_343
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			OR = {
				ai = no
				AND = {
					china_hates_fromfrom_trigger = no
					china_wants_fromfroms_land_trigger = no
				}
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_343 # Accept the request
		
		FROMFROM = {
			letter_event = { id = grace.344 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				china_hates_fromfrom_trigger = yes
				china_wants_fromfroms_land_trigger = yes
			}
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_343 # Refuse the request, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.345 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_hates_fromfrom_trigger = no
			china_wants_fromfroms_land_trigger = no
		}
		name = EVTOPTC_GRACE_343 # Refuse the request, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.345 }
		}
		
		prestige = -1000
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -1000
				}
			}
		}
	}
}

# Request accepted, tributary tier lowered
letter_event = {
	id = grace.344
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_344
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_344
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_recently_became_lower_tier_tributary
			}
		}
		decrease_tributary_tier_or_release_effect = yes
		log = "GRACE SYSTEM: [From.GetTitledName] accepted the request to decrease [Root.GetTitledName]'s tributary tier!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.345
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_345
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_345
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_decrese_tributary_tier
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused the request to decrease [Root.GetTitledName]'s tributary tier!"
	}
}

### Request border adjustment (346-348)

# The EoC gets the request
narrative_event = {
	id = grace.346
	is_triggered_only = yes
	title = EVTTITLE_GRACE_346
	desc = EVTDESC_GRACE_346
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		log = "GRACE SYSTEM: [FromFrom.GetTitledName] is requesting a border adjustment from [Root.GetTitledName]. [From.GetName] is the title."
		opinion = {
			who = FROMFROM
			modifier = opinion_requested_border_adjustment
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				china_grants_border_adjustment_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_346 # Accept the request
		
		event_target:border_adjustment_duchy = {
			any_direct_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = {
							character = ROOT
						}
					}
				}
				if = {
					limit = {
						holder_scope = {
							NOR = {
								any_demesne_title = {
									NOR = {
										de_jure_liege_or_above = event_target:china_border_adjustment_duchy
										title = event_target:china_border_adjustment_duchy
									}
								}
								any_vassal = {
									any_demesne_title = {
										NOR = {
											de_jure_liege_or_above = event_target:china_border_adjustment_duchy
											title = event_target:china_border_adjustment_duchy
										}
									}
								}
							}
						}
					}
					holder_scope = {
						set_defacto_liege = FROMFROM
					}
				}
				else = {
					FROMFROM = {
						grant_title_no_opinion = PREV
					}
				}
			}
			if = {
				limit = {
					has_holder = yes
					holder_scope = {
						top_liege = {
							character = ROOT
						}
					}
				}
				FROMFROM = {
					grant_title_no_opinion = PREV
				}
			}
		}
		
		FROMFROM = {
			letter_event = { id = grace.347 }
		}
	}
	
	option = {
		trigger = {
			china_grants_border_adjustment_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTB_GRACE_346 # Refuse the request, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.348 }
		}
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_border_adjustment_boon_fromfrom_trigger = yes
		}
		name = EVTOPTC_GRACE_346 # Refuse the request, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.348 }
		}
		
		prestige = -1000
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -1000
				}
			}
		}
	}
}

# Request accepted, titles transferred
letter_event = {
	id = grace.347
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_347
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_347
		log = "GRACE SYSTEM: [From.GetTitledName] accepted the request transfer all land in [FromFrom.GetName] to [Root.GetTitledName]!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.348
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_348
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_348
		opinion = {
			who = FROM
			modifier = opinion_china_refused_border_adjustment
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused the request transfer all land in [FromFrom.GetName] to [Root.GetTitledName]!"
	}
}



##### Requests from the EoC (601-614; reserved ids 601-900)

### Tribute enabling/disabling

# The EoC gets a (potentially repeating) event to pick which tribute to enable/disable
letter_event = {
	id = grace.601
	desc = EVTDESC_GRACE_601
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_gold_tributes
			}
		}
		name = EVTOPTA_GRACE_601
		
		set_character_flag = china_no_gold_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_gold_tributes
		}
		name = EVTOPTB_GRACE_601
		
		clr_character_flag = china_no_gold_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_tributaries
			}
		}
		name = EVTOPTC_GRACE_601
		
		set_character_flag = china_no_tributaries
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_tributaries
		}
		name = EVTOPTD_GRACE_601
		
		clr_character_flag = china_no_tributaries
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_horses_tributes
			}
		}
		name = EVTOPTE_GRACE_601
		
		set_character_flag = china_no_horses_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_horses_tributes
		}
		name = EVTOPTF_GRACE_601
		
		clr_character_flag = china_no_horses_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_601_1
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
		}
		name = EVTOPTG_GRACE_601 # More option
		set_character_flag = repeat_grace_601_1
		repeat_event = { id = grace.601 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_eunuch_tributes
			}
		}
		name = EVTOPTH_GRACE_601
		
		set_character_flag = china_no_eunuch_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_eunuch_tributes
		}
		name = EVTOPTI_GRACE_601
		
		clr_character_flag = china_no_eunuch_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_concubine_tributes
			}
		}
		name = EVTOPTJ_GRACE_601
		
		set_character_flag = china_no_concubine_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_concubine_tributes
		}
		name = EVTOPTK_GRACE_601
		
		clr_character_flag = china_no_concubine_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_commander_tributes
			}
		}
		name = EVTOPTL_GRACE_601
		
		set_character_flag = china_no_commander_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_commander_tributes
		}
		name = EVTOPTM_GRACE_601
		
		clr_character_flag = china_no_commander_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			NOR = {
				has_character_flag = repeat_grace_601_2
				has_character_flag = repeat_grace_601_3
			}
		}
		name = EVTOPTG_GRACE_601 # More option
		set_character_flag = repeat_grace_601_2
		repeat_event = { id = grace.601 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_physician_tributes
			}
		}
		name = EVTOPTN_GRACE_601
		
		set_character_flag = china_no_physician_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_physician_tributes
		}
		name = EVTOPTO_GRACE_601
		
		clr_character_flag = china_no_physician_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_relief_tributes
			}
		}
		name = EVTOPTP_GRACE_601
		
		set_character_flag = china_no_relief_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_relief_tributes
		}
		name = EVTOPTQ_GRACE_601
		
		clr_character_flag = china_no_relief_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			NOT = {
				has_character_flag = china_no_artifact_tributes
			}
		}
		name = EVTOPTR_GRACE_601
		
		set_character_flag = china_no_artifact_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
			has_character_flag = china_no_artifact_tributes
		}
		name = EVTOPTS_GRACE_601
		
		clr_character_flag = china_no_artifact_tributes
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.602 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			NOR = {
				has_character_flag = repeat_grace_601_3
			}
		}
		name = EVTOPTG_GRACE_601 # More option
		set_character_flag = repeat_grace_601_3
		repeat_event = { id = grace.601 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			has_character_flag = repeat_grace_601_3
		}
		
		name = EVTOPTT_GRACE_601 # Never mind
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_601_1
			has_character_flag = repeat_grace_601_2
			has_character_flag = repeat_grace_601_3
		}
		
		name = EVTOPTG_GRACE_601 # Start over
		
		clr_character_flag = repeat_grace_601_1
		clr_character_flag = repeat_grace_601_2
		clr_character_flag = repeat_grace_601_3
		repeat_event = { id = grace.601 }
	}
}

# Inform the world!
narrative_event = {
	id = grace.602
	is_triggered_only = yes
	title = EVTTITLE_GRACE_602
	desc = EVTDESC_GRACE_602
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
		option = {
		name = EVTOPTA_GRACE_602 # I see...
	}
}

### Boon enabling/disabling

# The EoC gets a (potentially repeating) event to pick which tribute to enable/disable
letter_event = {
	id = grace.603
	desc = EVTDESC_GRACE_603
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_peace_deal_boons
			}
		}
		name = EVTOPTA_GRACE_603
		
		set_character_flag = china_no_peace_deal_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_peace_deal_boons
		}
		name = EVTOPTB_GRACE_603
		
		clr_character_flag = china_no_peace_deal_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_physician_boons
			}
		}
		name = EVTOPTC_GRACE_603
		
		set_character_flag = china_no_physician_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_physician_boons
		}
		name = EVTOPTD_GRACE_603
		
		clr_character_flag = china_no_physician_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_artifact_boons
			}
		}
		name = EVTOPTE_GRACE_603
		
		set_character_flag = china_no_artifact_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_artifact_boons
		}
		name = EVTOPTF_GRACE_603
		
		clr_character_flag = china_no_artifact_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = repeat_grace_603_1
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
		}
		name = EVTOPTG_GRACE_603 # More option
		set_character_flag = repeat_grace_603_1
		repeat_event = { id = grace.603 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_siege_engineer_boons
			}
		}
		name = EVTOPTH_GRACE_603
		
		set_character_flag = china_no_siege_engineer_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_siege_engineer_boons
		}
		name = EVTOPTI_GRACE_603
		
		clr_character_flag = china_no_siege_engineer_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_strategist_boons
			}
		}
		name = EVTOPTJ_GRACE_603
		
		set_character_flag = china_no_strategist_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_strategist_boons
		}
		name = EVTOPTK_GRACE_603
		
		clr_character_flag = china_no_strategist_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_administrator_boons
			}
		}
		name = EVTOPTL_GRACE_603
		
		set_character_flag = china_no_administrator_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_administrator_boons
		}
		name = EVTOPTM_GRACE_603
		
		clr_character_flag = china_no_administrator_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			NOR = {
				has_character_flag = repeat_grace_603_2
				has_character_flag = repeat_grace_603_3
			}
		}
		name = EVTOPTG_GRACE_603 # More option
		set_character_flag = repeat_grace_603_2
		repeat_event = { id = grace.603 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_master_engineer_boons
			}
		}
		name = EVTOPTN_GRACE_603
		
		set_character_flag = china_no_master_engineer_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_master_engineer_boons
		}
		name = EVTOPTO_GRACE_603
		
		clr_character_flag = china_no_master_engineer_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_trade_contract_boons
			}
		}
		name = EVTOPTP_GRACE_603
		
		set_character_flag = china_no_trade_contract_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_trade_contract_boons
		}
		name = EVTOPTQ_GRACE_603
		
		clr_character_flag = china_no_trade_contract_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			NOT = {
				has_character_flag = china_no_imperial_marriage_boons
			}
		}
		name = EVTOPTR_GRACE_603
		
		set_character_flag = china_no_imperial_marriage_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
			has_character_flag = china_no_imperial_marriage_boons
		}
		name = EVTOPTS_GRACE_603
		
		clr_character_flag = china_no_imperial_marriage_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			NOR = {
				has_character_flag = repeat_grace_603_3
			}
		}
		name = EVTOPTG_GRACE_603 # More option
		set_character_flag = repeat_grace_603_3
		repeat_event = { id = grace.603 }
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			has_character_flag = repeat_grace_603_3
			NOT = {
				has_character_flag = china_no_border_adjustment_boons
			}
		}
		name = EVTOPTU_GRACE_603
		
		set_character_flag = china_no_border_adjustment_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			has_character_flag = repeat_grace_603_3
			has_character_flag = china_no_border_adjustment_boons
		}
		name = EVTOPTV_GRACE_603
		
		clr_character_flag = china_no_border_adjustment_boons
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		change_boon_tribute_disabling_penalty_effect = yes
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = ROOT
					any_realm_province = {
						trade_route = silk_road
					}
				}
				NOT = {
					character = ROOT
				}
			}
			narrative_event = { id = grace.604 }
		}
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			has_character_flag = repeat_grace_603_3
		}
		
		name = EVTOPTT_GRACE_603 # Never mind
	}
	
	option = {
		trigger = {
			has_character_flag = repeat_grace_603_1
			has_character_flag = repeat_grace_603_2
			has_character_flag = repeat_grace_603_3
		}
		
		name = EVTOPTG_GRACE_603 # Start over
		
		clr_character_flag = repeat_grace_603_1
		clr_character_flag = repeat_grace_603_2
		clr_character_flag = repeat_grace_603_3
		repeat_event = { id = grace.603 }
	}
}

# Inform the world!
narrative_event = {
	id = grace.604
	is_triggered_only = yes
	title = EVTTITLE_GRACE_604
	desc = EVTDESC_GRACE_604
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
		
	option = {
		name = EVTOPTA_GRACE_604 # I see...
	}
}

### EoC attempts to increase a tributary's tier (605-611)

# Tributary gets the request, can accept, refuse in exchange for Grace in the bank, refuse outright (which can lead to a war)
narrative_event = {
	id = grace.605
	is_triggered_only = yes
	title = EVTTITLE_GRACE_605
	desc = EVTDESC_GRACE_605
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		log = "GRACE SYSTEM: [Root.GetTitledName] is being asked by [FromFrom.GetTitledName] to become a higher tier tributary!"
		if = {
			limit = {
				is_tributary = {
					type = chinese_client_state
				}
			}
			log = "GRACE SYSTEM: [Root.GetTitledName] is currently a Client State"
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_protectorate
				}
			}
			log = "GRACE SYSTEM: [Root.GetTitledName] is currently a Protectorate"
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			log = "GRACE SYSTEM: [Root.GetTitledName] is currently an Imperial Tributary"
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_peripheral_tributary
				}
			}
			log = "GRACE SYSTEM: [Root.GetTitledName] is currently a Peripheral Tributary"
		}
		else = {
			log = "GRACE SYSTEM: Something is not right!"
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				root_hates_china_trigger = no
			}
		}
		name = EVTOPTA_GRACE_605 # Closer relations with China sounds good!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] accepted the request!"
		
		# If we accept, we get half of the wealth the EoC paid
		if = {
			limit = {
				is_tributary = {
					type = chinese_client_state
				}
			}
			if = {
				limit = {
					tier = emperor
					is_nomadic = no
				}
				wealth = 5000
			}
			else_if = {
				limit = {
					OR = {
						tier = king
						AND = {
							tier = emperor
							is_nomadic = yes
						}
					}
				}
				wealth = 2500
			}
			else = {
				wealth = 500
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_protectorate
				}
			}
			if = {
				limit = {
					tier = emperor
					is_nomadic = no
				}
				wealth = 2500
			}
			else_if = {
				limit = {
					OR = {
						tier = king
						AND = {
							tier = emperor
							is_nomadic = yes
						}
					}
				}
				wealth = 500
			}
			else = {
				wealth = 250
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			if = {
				limit = {
					tier = emperor
					is_nomadic = no
				}
				wealth = 500
			}
			else_if = {
				limit = {
					OR = {
						tier = king
						AND = {
							tier = emperor
							is_nomadic = yes
						}
					}
				}
				wealth = 250
			}
			else = {
				wealth = 50
			}
		}
		else = {
			if = {
				limit = {
					tier = emperor
					is_nomadic = no
				}
				wealth = 250
			}
			else_if = {
				limit = {
					OR = {
						tier = king
						AND = {
							tier = emperor
							is_nomadic = yes
						}
					}
				}
				wealth = 50
			}
			else = {
				wealth = 50
			}
		}
		increase_tributary_tier_or_vassalize_effect = yes
		FROMFROM = {
			letter_event = { id = grace.606 } # Inform China that the request was accepted
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.01
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.01 # Make random distant realms unlikely to try to become higher tier tributaries
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are less willing to upgrade their tier
			modifier = {
				factor = 0.1
				OR = {
					tier = king
					is_nomadic = yes
				}
			}
			# Emperors will refuse to have their tier upgraded
			modifier = {
				factor = 0
				tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 5
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to upgrade their tier
			modifier = {
				factor = 0.1
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly upgrade their tier
			modifier = {
				factor = 0
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.1
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.25
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 10
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 5
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to refuse
			}
			modifier = {
				factor = 0.01
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 2
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 2
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 5
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 0.1
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we aren't someone that thinks their bureaucracy is neat
			modifier = {
				factor = 0
				is_tributary = {
					type = chinese_client_state
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# Would become a vassal
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Would become a Client State
			modifier = {
				factor = 0.25
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Would become a Protectorate
			modifier = {
				factor = 0.5
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 2
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 10
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			# More likely if China is doing well
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 0.1
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# If we want to get border adjustments, seriously consider it
			modifier = {
				factor = 10
				NOT = {
					is_tributary = {
						type = chinese_client_state # Already a client state, which is all we need
					}
				}
				china_grants_border_adjustment_boon_trigger = yes
				e_china = {
					holder_scope = {
						any_realm_title = {
							tier = count
							NOR = {
								de_jure_liege_or_above = e_china
								region = world_china
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				# We have enough Grace to avoid the request (half the cost of downgrading from our current tier)
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					OR = {
						AND = {
							NOT = { # If a Client State is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
													NOR = {
														character = ROOT
														top_liege = {
															character = ROOT
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		top_liege = {
																			OR = {
																				is_tributary = {
																					type = chinese_client_state
																				}
																				is_tributary = {
																					type = chinese_protectorate
																				}
																			}
																		}
																	}
																	NOR = {
																		character = ROOT
																		top_liege = {
																			character = ROOT
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
						check_variable = {
							which = grace
							value = 1000
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					OR = {
						AND = {
							NOT = { # If a Protectorate is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
						check_variable = {
							which = grace
							value = 250
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					check_variable = {
						which = grace
						value = 250
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					check_variable = {
						which = grace
						value = 125
					}
				}
			}
		}
		
		name = EVTOPTB_GRACE_605 # How about I call in some of what you owe me and you forget all about this idea?
		
		log = "GRACE SYSTEM: [Root.GetTitledName] paid Grace to deflect the request!"
		
		if = {
			limit = {
				is_tributary = {
					type = chinese_client_state
				}
			}
			if = {
				limit = {
					NOT = { # If a Client State is too distant, China will be more willing to let them go
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
													}
												}
											}
											NOR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
														NOR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
															NOR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				change_variable = {
					which = grace
					value = -1000
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -2000
				}
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_protectorate
				}
			}
			if = {
				limit = {
					NOT = { # If a Protectorate is too distant, China will be more willing to let them go
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				change_variable = {
					which = grace
					value = -1000
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -500
				}
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			change_variable = {
				which = grace
				value = -500
			}
		}
		else = {
			change_variable = {
				which = grace
				value = -250
			}
		}
		
		FROMFROM = {
			letter_event = { id = grace.607 } # Inform China that ROOT paid Grace to circumvent the request
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, you should want to break free
						}
					}
				}
			}
			modifier = {
				factor = 10 # Make random distant realms more likely to try to break free
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are more likely to want to break free
			modifier = {
				factor = 2
				OR = {
					tier = king
					is_nomadic = yes
				}
			}
			# Non-nomadic emperors want to break free very frequently
			modifier = {
				factor = 10
				tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 0.25
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 5
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 10
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 10
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 5
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 0.1
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 0.5
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 100
				root_hates_china_trigger = yes # Dislikes the EoC
			}
			modifier = {
				factor = 100
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 0.25
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 10
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# Is a Client State
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Is a Protectorate
			modifier = {
				factor = 5
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Wants to break free on succession
			modifier = {
				factor = 2
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Controls a religion, is a holy order, or is a mercenary and thus doesn't want to be a tributary
			modifier = {
				factor = 100
				OR = {
					controls_religion = yes
					mercenary = yes
					holy_order = yes
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.1
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			# Less likely if China is doing well
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 10
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# If you have rather little Grace, perhaps you should stay a bit longer...
			modifier = {
				factor = 0.01
				NOT = {
					check_variable = {
						which = grace
						value = 1000
					}
				}
			}
			# If we want to get border adjustments, seriously consider it
			modifier = {
				factor = 0.1
				NOT = {
					is_tributary = {
						type = chinese_client_state # Already a client state, which is all we need
					}
				}
				china_grants_border_adjustment_boon_trigger = yes
				e_china = {
					holder_scope = {
						any_realm_title = {
							tier = count
							NOR = {
								de_jure_liege_or_above = e_china
								region = world_china
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOR = { # We do not have enough Grace to avoid the request (half the cost of downgrading from our current tier)
				AND = {
					is_tributary = {
						type = chinese_client_state
					}
					OR = {
						AND = {
							NOT = { # If a Client State is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
														top_liege = {
															OR = {
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
															}
														}
													}
													NOR = {
														character = ROOT
														top_liege = {
															character = ROOT
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																	top_liege = {
																		OR = {
																			is_tributary = {
																				type = chinese_client_state
																			}
																			is_tributary = {
																				type = chinese_protectorate
																			}
																		}
																	}
																}
																NOR = {
																	character = ROOT
																	top_liege = {
																		character = ROOT
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																		top_liege = {
																			OR = {
																				is_tributary = {
																					type = chinese_client_state
																				}
																				is_tributary = {
																					type = chinese_protectorate
																				}
																			}
																		}
																	}
																	NOR = {
																		character = ROOT
																		top_liege = {
																			character = ROOT
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
						check_variable = {
							which = grace
							value = 1000
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_protectorate
					}
					OR = {
						AND = {
							NOT = { # If a Protectorate is too distant, China will be more willing to let them go
								any_realm_province = {
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													OR = {
														AND = {
															has_owner = yes
															owner = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	top_liege = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
														}
														AND = {
															is_land = no
															any_neighbor_province = {
																has_owner = yes
																owner = {
																	OR = {
																		is_chinese_emperor_trigger = yes
																		top_liege = {
																			is_chinese_emperor_trigger = yes
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
							check_variable = {
								which = grace
								value = 500
							}
						}
						check_variable = {
							which = grace
							value = 250
						}
					}
				}
				AND = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					check_variable = {
						which = grace
						value = 250
					}
				}
				AND = {
					NOR = {
						is_tributary = {
							type = chinese_client_state
						}
						is_tributary = {
							type = chinese_protectorate
						}
						is_tributary = {
							type = chinese_imperial_tributary
						}
					}
					check_variable = {
						which = grace
						value = 125
					}
				}
			}
		}
		
		# It still costs Grace to refuse, even if you don't have the Grace you need!
		if = {
			limit = {
				is_tributary = {
					type = chinese_client_state
				}
			}
			if = {
				limit = {
					NOT = { # If a Client State is too distant, China will be more willing to let them go
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
												is_tributary = {
													type = chinese_client_state
												}
												is_tributary = {
													type = chinese_protectorate
												}
												top_liege = {
													OR = {
														is_tributary = {
															type = chinese_client_state
														}
														is_tributary = {
															type = chinese_protectorate
														}
													}
												}
											}
											NOR = {
												character = ROOT
												top_liege = {
													character = ROOT
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
															is_tributary = {
																type = chinese_client_state
															}
															is_tributary = {
																type = chinese_protectorate
															}
															top_liege = {
																OR = {
																	is_tributary = {
																		type = chinese_client_state
																	}
																	is_tributary = {
																		type = chinese_protectorate
																	}
																}
															}
														}
														NOR = {
															character = ROOT
															top_liege = {
																character = ROOT
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
																is_tributary = {
																	type = chinese_client_state
																}
																is_tributary = {
																	type = chinese_protectorate
																}
																top_liege = {
																	OR = {
																		is_tributary = {
																			type = chinese_client_state
																		}
																		is_tributary = {
																			type = chinese_protectorate
																		}
																	}
																}
															}
															NOR = {
																character = ROOT
																top_liege = {
																	character = ROOT
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				change_variable = {
					which = grace
					value = -1000
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -2000
				}
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_protectorate
				}
			}
			if = {
				limit = {
					NOT = { # If a Protectorate is too distant, China will be more willing to let them go
						any_realm_province = {
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												is_chinese_emperor_trigger = yes
												top_liege = {
													is_chinese_emperor_trigger = yes
												}
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											OR = {
												AND = {
													has_owner = yes
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
												AND = {
													is_land = no
													any_neighbor_province = {
														has_owner = yes
														owner = {
															OR = {
																is_chinese_emperor_trigger = yes
																top_liege = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
				change_variable = {
					which = grace
					value = -1000
				}
			}
			else = {
				change_variable = {
					which = grace
					value = -500
				}
			}
		}
		else_if = {
			limit = {
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			change_variable = {
				which = grace
				value = -500
			}
		}
		else = {
			change_variable = {
				which = grace
				value = -250
			}
		}
		
		name = EVTOPTC_GRACE_605 # Do your worst!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] refused the request!"
		
		FROMFROM = {
			letter_event = { id = grace.608 } # Inform China that ROOT told them to get lost
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, you should want to break free
						}
					}
				}
			}
			modifier = {
				factor = 10 # Make random distant realms more likely to try to break free
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are more likely to want to break free
			modifier = {
				factor = 2
				OR = {
					tier = king
					is_nomadic = yes
				}
			}
			# Non-nomadic emperors want to break free very frequently
			modifier = {
				factor = 10
				tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 0.25
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 5
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 10
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 10
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 5
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 0.1
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 0.5
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 100
				root_hates_china_trigger = yes # Dislikes the EoC
			}
			modifier = {
				factor = 100
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 0.25
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 10
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# Is a Client State
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Is a Protectorate
			modifier = {
				factor = 5
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Want to break free on succession
			modifier = {
				factor = 2
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Controls a religion, is a holy order, or is a mercenary and thus doesn't want to be a tributary
			modifier = {
				factor = 100
				OR = {
					controls_religion = yes
					mercenary = yes
					holy_order = yes
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.1
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			# Less likely if China is doing well
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 10
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# If you have rather little Grace, perhaps you should stay a bit longer...
			modifier = {
				factor = 0.01
				NOT = {
					check_variable = {
						which = grace
						value = 1000
					}
				}
			}
			# If we want to get border adjustments, seriously consider it
			modifier = {
				factor = 0.1
				NOT = {
					is_tributary = {
						type = chinese_client_state # Already a client state, which is all we need
					}
				}
				china_grants_border_adjustment_boon_trigger = yes
				e_china = {
					holder_scope = {
						any_realm_title = {
							tier = count
							NOR = {
								de_jure_liege_or_above = e_china
								region = world_china
							}
							de_jure_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}
}

# Tributary accepted the request
letter_event = {
	id = grace.606
	desc = EVTDESC_GRACE_606
	is_triggered_only = yes
	
	option = {
		name = {
			trigger = {
				FROM = {
					top_liege = {
						character = ROOT
					}
				}
			}
			text = EVTOPTA_GRACE_606A # As would be expected!
		}
		name = {
			trigger = {
				FROM = {
					NOT = {
						top_liege = {
							character = ROOT
						}
					}
				}
			}
			text = EVTOPTA_GRACE_606B # As would be expected!
		}
		opinion = {
			who = FROM
			modifier = opinion_recently_became_higher_tier_tributary
		}
	}
}

# Tributary used Grace to dodge the request
letter_event = {
	id = grace.607
	desc = EVTDESC_GRACE_607
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_607 # I'll get them next time!
		
		opinion = {
			who = FROM
			modifier = opinion_tributary_refused_increase_tributary_tier
		}
	}
	option = {
		trigger = {
			ai = no
		}
		name = EVTOPTB_GRACE_607 # The hard way it is!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] attempts to force [From.GetTitledName] to comply!"
		
		prestige = -1000
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -5000
				}
			}
		}
		hidden_tooltip = {
			FROM = {
				if = {
					limit = {
						is_tributary = {
							type = chinese_client_state
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_client_state
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_protectorate
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_protectorate
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_imperial_tributary
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_imperial_tributary
					}
				}
				else = {
					opinion = {
						who = ROOT
						modifier = i_was_misc_tributary
					}
				}
			}
		}
		
		unsafe_war = {
			target = FROM
			casus_belli = chinese_tributary_tier_war
		}
		
		opinion = {
			who = FROM
			modifier = opinion_tributary_refused_increase_tributary_tier
		}
	}
}

# Tributary refused the request - EoC can accept or go to war
letter_event = {
	id = grace.608
	desc = EVTDESC_GRACE_608
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_608 # Then prepare for war!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] attempts to force [From.GetTitledName] to comply!"
		
		hidden_tooltip = {
			FROM = {
				if = {
					limit = {
						is_tributary = {
							type = chinese_client_state
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_client_state
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_protectorate
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_protectorate
					}
				}
				else_if = {
					limit = {
						is_tributary = {
							type = chinese_imperial_tributary
							suzerain = ROOT
						}
					}
					opinion = {
						who = ROOT
						modifier = i_was_imperial_tributary
					}
				}
				else = {
					opinion = {
						who = ROOT
						modifier = i_was_misc_tributary
					}
				}
			}
		}
		
		unsafe_war = {
			target = FROM
			casus_belli = chinese_tributary_tier_war
		}
		
		opinion = {
			who = FROM
			modifier = opinion_tributary_refused_increase_tributary_tier
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				relative_power_including_allies_attacker = {
					who = FROM
					power = 2.5
				}
			}
			modifier = {
				factor = 10
				trait = brave
			}
			modifier = {
				factor = 5
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_GRACE_608 # I will remember this!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] did not attempt to force [From.GetTitledName] to comply!"
		
		opinion = {
			who = FROM
			modifier = opinion_tributary_refused_increase_tributary_tier
		}
		
		prestige = -1000
		
		FROM = {
			letter_event = { id = grace.609 } # Inform FROM that the EoC is most displeased
		}
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -1000
				}
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					relative_power_including_allies_attacker = {
						who = FROM
						power = 1.0
					}
				}
			}
			modifier = {
				factor = 10
				trait = craven
			}
			modifier = {
				factor = 5
				trait = content
			}
			modifier = {
				factor = 2
				trait = humble
			}
		}
	}
}

# Inform tributary if the EoC backed down (otherwise, you get an obvious war)
letter_event = {
	id = grace.609
	desc = EVTDESC_GRACE_609
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_609 # Obviously they fear me!
		prestige = 500
	}
}

# Inform other tributaries if the war failed, giving them the chance to downgrade their tier for free
narrative_event = {
	id = grace.610
	is_triggered_only = yes
	title = EVTTITLE_GRACE_610
	desc = EVTDESC_GRACE_610
	picture = GFX_evt_china_civil_war
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_610 # My current relationship with China is fine
		
		log = "GRACE SYSTEM: [Root.GetTitledName] did not opt to reduce their tributary tier!"
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0.01
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, don't bother
						}
					}
				}
			}
			modifier = {
				factor = 0.01 # Make random distant realms unlikely to try to become higher tier tributaries
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are less willing to upgrade their tier
			modifier = {
				factor = 0.1
				OR = {
					tier = king
					is_nomadic = yes
				}
			}
			# Emperors will refuse to have their tier upgraded
			modifier = {
				factor = 0
				tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 5
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to upgrade their tier
			modifier = {
				factor = 0.1
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly upgrade their tier
			modifier = {
				factor = 0
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.1
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 0.25
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 10
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 5
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				root_hates_china_trigger = yes # Dislikes the EoC enough to refuse
			}
			modifier = {
				factor = 0.01
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 2
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 2
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 5
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 0.1
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 0
				is_tributary = {
					type = chinese_client_state
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# Would become a vassal
			modifier = {
				factor = 0.1
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Would become a Client State
			modifier = {
				factor = 0.25
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Would become a Protectorate
			modifier = {
				factor = 0.5
				is_tributary = {
					type = chinese_imperial_tributary
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 2
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			modifier = {
				factor = 10
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOR = {
					is_tributary = {
						type = chinese_client_state
					}
					is_tributary = {
						type = chinese_protectorate
					}
				}
			}
			# More likely if China is doing well
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 0.1
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
		}
	}
	
	option = {
		name = EVTOPTB_GRACE_610 # It is time to re-define our relationship!
		
		log = "GRACE SYSTEM: [Root.GetTitledName] opted to reduce their tributary tier!"
		
		decrease_tributary_tier_or_release_effect = yes
		
		e_china = {
			holder_scope = {
				letter_event = { id = grace.611 } # Inform China that the tributary lowered its tier
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 10
				NOT = {
					e_china = {
						holder_scope = {
							is_within_diplo_range = ROOT # If you're far from China, you should want to break free
						}
					}
				}
			}
			modifier = {
				factor = 10 # Make random distant realms more likely to try to break free
				NOT = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											is_chinese_emperor_trigger = yes
											top_liege = {
												OR = {
													is_chinese_emperor_trigger = yes
													suzerain = {
														is_chinese_emperor_trigger = yes
													}
												}
											}
											suzerain = {
												is_chinese_emperor_trigger = yes
											}
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											AND = {
												has_owner = yes
												owner = {
													OR = {
														is_chinese_emperor_trigger = yes
														top_liege = {
															OR = {
																is_chinese_emperor_trigger = yes
																suzerain = {
																	is_chinese_emperor_trigger = yes
																}
															}
														}
														suzerain = {
															is_chinese_emperor_trigger = yes
														}
													}
												}
											}
											AND = {
												is_land = no
												any_neighbor_province = {
													owner = {
														OR = {
															is_chinese_emperor_trigger = yes
															top_liege = {
																OR = {
																	is_chinese_emperor_trigger = yes
																	suzerain = {
																		is_chinese_emperor_trigger = yes
																	}
																}
															}
															suzerain = {
																is_chinese_emperor_trigger = yes
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
			# Kings and nomads are more likely to want to break free
			modifier = {
				factor = 2
				OR = {
					tier = king
					is_nomadic = yes
				}
			}
			# Non-nomadic emperors want to break free very frequently
			modifier = {
				factor = 10
				tier = emperor
				is_nomadic = no
			}
			# Small realms are more likely to be willing to become tributaries
			modifier = {
				factor = 0.25
				NOT = {
					realm_size = 10
				}
			}
			# Large realms are less likely to be willing to become tributaries
			modifier = {
				factor = 5
				realm_size = 50
			}
			# At this size, the realm is too powerful to willingly become a tributary
			modifier = {
				factor = 10
				realm_size = 100
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 10
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				NOR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Wants to be independent due to traits
			modifier = {
				factor = 5
				OR = {
					trait = proud
					trait = ambitious
					trait = brave
				}
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# Is likely to be scared of China
			modifier = {
				factor = 0.1
				OR = {
					trait = humble
					trait = content
					trait = craven
				}
			}
			# China is less than twice as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
			}
			# China is less than four times as powerful
			modifier = {
				factor = 2
				e_china = {
					holder_scope = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
			}
			# China is more than ten times as powerful
			modifier = {
				factor = 0.1
				NOT = {
					e_china = {
						holder_scope = {
							ROOT = {
								relative_power = {
									who = PREV
									power = 0.1
								}
							}
						}
					}
				}
			}
			# Same culture
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						culture = ROOT
					}
				}
			}
			# Same culture group
			modifier = {
				factor = 0.5
				e_china = {
					holder_scope = {
						culture_group = ROOT
						NOT = {
							culture = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 100
				root_hates_china_trigger = yes # Dislikes the EoC
			}
			modifier = {
				factor = 100
				e_china = {
					holder_scope = {
						is_blocking_all_boons_trigger = yes # If it is impossible to get something back, don't bother
					}
				}
			}
			# Chinese
			modifier = {
				factor = 0.25
				culture_group = chinese_group
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
			}
			# Is "Chinese enough"
			modifier = {
				factor = 0.25
				government = chinese_vassal_government
			}
			# We are uncivilized
			modifier = {
				factor = 10
				OR = {
					is_tribal = yes
					is_nomadic = yes
				}
			}
			# We won't willingly join China if we don't have a "Chinese enough" religion
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# Is a Client State
			modifier = {
				factor = 10
				is_tributary = {
					type = chinese_client_state
				}
			}
			# Is a Protectorate
			modifier = {
				factor = 5
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Wants to break free on succession
			modifier = {
				factor = 2
				is_tributary = {
					type = chinese_protectorate
				}
			}
			# Controls a religion, is a holy order, or is a mercenary and thus doesn't want to be a tributary
			modifier = {
				factor = 100
				OR = {
					controls_religion = yes
					mercenary = yes
					holy_order = yes
				}
			}
			# I have strong neighbours and protection would be nice
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.5
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.5
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.25
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			modifier = {
				factor = 0.1
				any_neighbor_independent_ruler = {
					is_china_or_defended_chinese_tributary_trigger = no
					NOT = {
						ROOT = {
							relative_power = {
								who = PREV
								power = 0.1
							}
						}
					}
				}
				NOT = {
					is_tributary = {
						type = chinese_client_state
					}
				}
			}
			# Less likely if China is doing well
			modifier = {
				factor = 0.1
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_5
					}
				}
			}
			modifier = {
				factor = 0.25
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_4
					}
				}
			}
			modifier = {
				factor = 5
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_2
					}
				}
			}
			modifier = {
				factor = 10
				e_china = {
					holder_scope = {
						has_character_modifier = mandate_of_heaven_1
					}
				}
			}
			# If someone is just too different, they should want to be free a bit more often
			modifier = {
				factor = 10
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = no
			}
			# If you have rather little Grace, perhaps you should stay a bit longer...
			modifier = {
				factor = 0.01
				NOT = {
					check_variable = {
						which = grace
						value = 1000
					}
				}
			}
		}
	}
}

# Inform China if a tributary opted to lower its tier
letter_event = {
	id = grace.611
	desc = EVTDESC_GRACE_611
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_611 # I will remember this!
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		opinion = {
			who = FROM
			modifier = opinion_recently_became_lower_tier_tributary
		}
	}
}

### China requests border adjustment (612-614)

# The tributary gets the request, can accept (getting Grace) or refuse (losing Grace)
narrative_event = {
	id = grace.612
	is_triggered_only = yes
	title = EVTTITLE_GRACE_612
	desc = EVTDESC_GRACE_612
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		log = "GRACE SYSTEM: [FromFrom.GetTitledName] is requesting a border adjustment from [Root.GetTitledName]. [From.GetName] is the title."
		opinion = {
			who = FROMFROM
			modifier = opinion_requested_border_adjustment
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				AND = {
					root_hates_china_trigger = no
					NOT = {
						tier = emperor
					}
				}
			}
		}
		name = EVTOPTA_GRACE_612 # Accept the request
		
		prestige = -250
		change_variable = {
			which = grace
			value = 500
		}
		
		event_target:china_border_adjustment_duchy = {
			any_direct_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						top_liege = {
							character = ROOT
						}
					}
				}
				if = {
					limit = {
						holder_scope = {
							NOR = {
								any_demesne_title = {
									NOR = {
										de_jure_liege_or_above = event_target:china_border_adjustment_duchy
										title = event_target:china_border_adjustment_duchy
									}
								}
								any_vassal = {
									any_demesne_title = {
										NOR = {
											de_jure_liege_or_above = event_target:china_border_adjustment_duchy
											title = event_target:china_border_adjustment_duchy
										}
									}
								}
							}
						}
					}
					holder_scope = {
						set_defacto_liege = FROMFROM
					}
				}
				else = {
					FROMFROM = {
						grant_title_no_opinion = PREV
					}
				}
			}
			if = {
				limit = {
					has_holder = yes
					holder_scope = {
						top_liege = {
							character = ROOT
						}
					}
				}
				FROMFROM = {
					grant_title_no_opinion = PREV
				}
			}
		}
		
		FROMFROM = {
			letter_event = { id = grace.613 }
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				root_hates_china_trigger = yes
				tier = emperor
			}
		}
		
		name = EVTOPTB_GRACE_612 # Refuse the request
		
		FROMFROM = {
			letter_event = { id = grace.614 }
		}
		
		change_variable = {
			which = grace
			value = -1000
		}
	}
}

# Inform China that the request was accepted
letter_event = {
	id = grace.613
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_613
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_613
		log = "GRACE SYSTEM: [From.GetTitledName] accepted the request transfer all land in [FromFrom.GetName] to [Root.GetTitledName]!"
	}
}

# Inform China that the request was refused
letter_event = {
	id = grace.614
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_614
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_614
		opinion = {
			who = FROM
			modifier = opinion_refused_border_adjustment
		}
		log = "GRACE SYSTEM: [From.GetTitledName] refused the request transfer all land in [FromFrom.GetName] to [Root.GetTitledName]!"
	}
}



##### Missing events (901-920, reserved ids 901-949)

### Concubines

# Ping concubine to be given to a random vassal
letter_event = {
	id = grace.901
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
					china_hates_prevprev_trigger = no
					is_female = no
					has_concubinage = yes
					NOT = {
						num_of_consorts = 3 # Can't take additional concubines
					}
					is_adult = yes
					NOR = {
						trait = celibate
						trait = eunuch
						trait = incapable
					}
					prisoner = no
					is_inaccessible_trigger = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				narrative_event = { id = grace.902 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.902
	is_triggered_only = yes
	title = EVTTITLE_GRACE_902
	desc = EVTDESC_GRACE_902
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_902
		
		opinion = {
			who = FROMFROMFROMFROM # EoC
			modifier = opinion_given_concubine
		}
		
		FROM = {
			prisoner = no
			move_character = ROOT
			force_host = ROOT
			ROOT = {
				add_consort = PREV
			}
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was given [FromFrom.GetTitledName]'s concubine tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Eunuchs

# Ping eunuch to be given to a random vassal
letter_event = {
	id = grace.903
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
					china_hates_prevprev_trigger = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				narrative_event = { id = grace.904 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.904
	is_triggered_only = yes
	title = EVTTITLE_GRACE_904
	desc = EVTDESC_GRACE_904
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_904
		
		opinion = {
			who = FROMFROMFROMFROM # EoC
			modifier = opinion_given_eunuch
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was given [FromFrom.GetTitledName]'s eunuch tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Commanders

# Ping commander to be given to a random vassal
letter_event = {
	id = grace.905
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
					OR = {
						ROOT = {
							is_female = no
						}
						primary_title = {
							has_law = status_of_women_4 # Allows female commanders
						}
					}
					china_hates_prevprev_trigger = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				narrative_event = { id = grace.906 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.906
	is_triggered_only = yes
	title = EVTTITLE_GRACE_906
	desc = EVTDESC_GRACE_906
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_906
		
		opinion = {
			who = FROMFROMFROMFROM # EoC
			modifier = opinion_given_commander
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			give_minor_title = title_commander
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was given [FromFrom.GetTitledName]'s commander tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Physicians

# Ping physician to be given to a random vassal
letter_event = {
	id = grace.907
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROMFROM = {
			any_realm_lord = {
				limit = {
					higher_tier_than = baron
					china_hates_prevprev_trigger = no
				}
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				narrative_event = { id = grace.908 }
			}
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.908
	is_triggered_only = yes
	title = EVTTITLE_GRACE_908
	desc = EVTDESC_GRACE_908
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		name = EVTOPTA_GRACE_908
		
		opinion = {
			who = FROMFROMFROMFROM # EoC
			modifier = opinion_given_physician
		}
		
		FROM = {
			move_character = ROOT
			force_host = ROOT
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
		}
		if = {
			limit = {
				NOT = {
					has_assigned_minor_title = title_court_physician
				}
			}
			FROM = {
				give_minor_title = title_court_physician
			}
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was given [FromFrom.GetTitledName]'s physician tribute, [From.GetBestName], by [FromFromFrom.GetTitledName]!"
	}
}

### Artifact

# Ping the EoC
letter_event = {
	id = grace.909
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		any_realm_lord = {
			limit = {
				higher_tier_than = baron
				china_hates_prevprev_trigger = no
				FROM = {
					event_target:tribute_artifact = {
						PREVPREV = {
							NOT = {
								has_artifact = PREV # Might need to split this up...
							}
						}
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			narrative_event = { id = grace.910 }
		}
	}
}

# Inform the vassal
narrative_event = {
	id = grace.910
	is_triggered_only = yes
	title = EVTTITLE_GRACE_910
	desc = EVTDESC_GRACE_910
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		FROMFROM = {
			event_target:tribute_artifact = {
				clear_event_target = tribute_artifact
				transfer_artifact = {
					from = PREV
					to = ROOT
				}
			}
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was given [FromFrom.GetTitledName]'s artifact tribute by [From.GetTitledName]!"
	}
	
	option = {
		name = EVTOPTA_GRACE_910
		
		opinion = {
			who = FROM
			modifier = opinion_given_artifact
		}
	}
}

### Relief monthly event

# Monthly check to see if any realm province loses depopulation due to relief
character_event = {
	id = grace.911
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				is_chinese_emperor_trigger = yes
				FROMFROMFROM = {
					is_landed = yes # If unlanded, they can't send relief!
					has_character_modifier = china_send_relief
				}
			}
			random_list = {
				90 = {} # Nothing happens
				10 = {
					random_realm_province = {
						limit = {
							OR = {
								has_province_modifier = depopulated_1
								has_province_modifier = depopulated_2
								has_province_modifier = depopulated_3
							}
						}
						province_event = { id = RIP.10030 } # Fire RD's event that has a chance of decreasing depopulation
					}
				}
			}
			# Larger realm size of the sender = more relief being sent (presumably; wealth isn't something that necessarily scales), leading to a greater chance of depopulation reduction
			if = {
				limit = {
					FROMFROMFROM = {
						realm_size = 200
					}
				}
				random_list = {
					90 = {} # Nothing happens
					10 = {
						random_realm_province = {
							limit = {
								OR = {
									has_province_modifier = depopulated_1
									has_province_modifier = depopulated_2
									has_province_modifier = depopulated_3
								}
							}
							province_event = { id = RIP.10030 } # Fire RD's event that has a chance of decreasing depopulation
						}
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						realm_size = 400
					}
				}
				random_list = {
					90 = {} # Nothing happens
					10 = {
						random_realm_province = {
							limit = {
								OR = {
									has_province_modifier = depopulated_1
									has_province_modifier = depopulated_2
									has_province_modifier = depopulated_3
								}
							}
							province_event = { id = RIP.10030 } # Fire RD's event that has a chance of decreasing depopulation
						}
					}
				}
			}
			if = {
				limit = {
					FROMFROMFROM = {
						realm_size = 800
					}
				}
				random_list = {
					90 = {} # Nothing happens
					10 = {
						random_realm_province = {
							limit = {
								OR = {
									has_province_modifier = depopulated_1
									has_province_modifier = depopulated_2
									has_province_modifier = depopulated_3
								}
							}
							province_event = { id = RIP.10030 } # Fire RD's event that has a chance of decreasing depopulation
						}
					}
				}
			}
			repeat_event = { id = grace.911 days = 30 }
		}
	}
}

### Imperial Marriage for vassals (912-915)

# The EoC gets the request
narrative_event = {
	id = grace.912
	is_triggered_only = yes
	title = EVTTITLE_GRACE_912
	desc = EVTDESC_GRACE_912
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	immediate = {
		# Clear previously generated event targets
		clear_event_target = dragon_bride_1
		clear_event_target = dragon_bride_2
		clear_event_target = dragon_bride_3
		# If possible, generate three candidates for the EoC to choose from
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_1
		}
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate!
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_2
		}
		any_realm_character = {
			limit = {
				is_valid_dragon_bride_candidate = yes
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
					event_target:dragon_bride_1 = {
						character = PREV # Pick a different candidate
					}
					event_target:dragon_bride_2 = {
						character = PREV # Pick a different candidate
					}
				}
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = dragon_bride_3
		}
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_1 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_912 # Candidate 1 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_1 = {
			save_event_target_as = dragon_bride
		}
		
		wealth = 500
		
		FROMFROM = {
			letter_event = { id = grace.913 }
		}
		
		show_portrait = event_target:dragon_bride_1
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_2 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		wealth = 500
		
		name = EVTOPTB_GRACE_912 # Candidate 2 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_2 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			letter_event = { id = grace.913 }
		}
		
		show_portrait = event_target:dragon_bride_2
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			event_target:dragon_bride_3 = {
				always = yes
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		
		wealth = 500
		
		name = EVTOPTC_GRACE_912 # Candidate 3 shall be FROMFROMFROM's bride!
		
		event_target:dragon_bride_3 = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			letter_event = { id = grace.913 }
		}
		
		show_portrait = event_target:dragon_bride_3
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
			event_target:dragon_bride_1 = {
				always = no
			}
		}
		name = EVTOPTD_GRACE_912 # No valid candidate!
		
		FROMFROM = {
			letter_event = { id = grace.914 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTE_GRACE_912 # Refuse the Imperial Marriage, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.915 }
		}
		
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTF_GRACE_912 # Refuse the Imperial Marriage, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.915 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		show_portrait = FROMFROMFROM
	}
}

# Request accepted, Chinese princess arrives, NAP signed
letter_event = {
	id = grace.913
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_913
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_913
		
		FROM = {
			event_target:dragon_bride = {
				hidden_tooltip = {
					remove_trait = dragon_bride_unmarried # Remove marriage blocker
					add_trait = dragon_bride_married # Add inheritance blocker
				}
				move_character = ROOT
				force_host = ROOT
				ROOT = {
					FROMFROMFROMFROM = {
						add_spouse = PREVPREV
					}
				}
			}
		}
		wealth = -500
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted an Imperial Marriage by [From.GetTitledName]!"
	}
}

# Request refused, no suitable candidate (all available princesses are pregnant, lovers of the EoC, or otherwise non-ideal candidates), Grace refunded
letter_event = {
	id = grace.914
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_914
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_914 # Fair enough!
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage_good
			# One year long - should keep the AI (and the player) from spamming the EoC if there's no good candidate (though different AI rulers can still try...)
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName] due to no valid candidate!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.915
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_915
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_915
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName]!"
	}
}

### Targeted Imperial Marriage for vassals (916-919)

# The EoC gets the request
narrative_event = {
	id = grace.916
	is_triggered_only = yes
	title = EVTTITLE_GRACE_916
	desc = EVTDESC_GRACE_916
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	option = {
		trigger = {
			FROM = {
				NOR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			OR = {
				ai = no
				china_grants_imperial_marriage_boon_fromfrom_trigger = yes
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTA_GRACE_916 # Of course FROM shall be FROMFROMFROM's bride!
		
		wealth = 1000
		
		FROM = {
			save_event_target_as = dragon_bride
		}
		
		FROMFROM = {
			letter_event = { id = grace.917 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			FROM = {
				OR = {
					any_lover = {
						character = ROOT # If they are the lover of the EoC, don't send them!
					}
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_seducing # If the EoC is seducing someone, don't send them!
					}
				}
			}
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTB_GRACE_916 # I'd rather keep her for myself...
		
		FROMFROM = {
			letter_event = { id = grace.918 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			china_grants_imperial_marriage_boon_fromfrom_trigger = no
			NOT = {
				test_grace_acceptance_trigger = yes
			}
		}
		name = EVTOPTC_GRACE_916 # Refuse the Imperial Marriage, for a good reason
		
		FROMFROM = {
			letter_event = { id = grace.919 }
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
	
	option = {
		trigger = {
			ai = no
			china_grants_imperial_marriage_boon_fromfrom_trigger = yes
		}
		name = EVTOPTD_GRACE_916 # Refuse the Imperial Marriage, without a good reason (never used by the AI)
		
		FROMFROM = {
			letter_event = { id = grace.919 }
		}
		
		prestige = -500
		if = {
			limit = {
				has_game_rule = {
					name = mandate_of_heaven
					value = enabled
				}
			}
			custom_tooltip = {
				text = negative_mandate
			}
			hidden_tooltip = {
				change_variable = {
					which = stored_mandate_change
					value = -500
				}
			}
		}
		
		show_portrait = FROM
		show_portrait = FROMFROM
		show_portrait = FROMFROMFROM
	}
}

# Request accepted, Chinese princess arrives, NAP signed
letter_event = {
	id = grace.917
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_917
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_917
		
		FROM = {
			event_target:dragon_bride = {
				hidden_tooltip = {
					remove_trait = dragon_bride_unmarried # Remove marriage blocker
					add_trait = dragon_bride_married # Add inheritance blocker
				}
				move_character = ROOT
				force_host = ROOT
				ROOT = {
					FROMFROMFROMFROM = {
						add_spouse = PREVPREV
					}
				}
			}
		}
		
		wealth = -1000
		
		log = "GRACE SYSTEM: [Root.GetTitledName] was granted an Imperial Marriage by [From.GetTitledName]!"
	}
}

# Request refused, candidate not suitable, Grace refunded
letter_event = {
	id = grace.918
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_918
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_341 # Fair enough!
				
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage_good
			# One year long - should keep the AI (and the player) from spamming the EoC if there's no good candidate (though different AI rulers can still try...)
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName] due to an invalid candidate!"
	}
}

# Request refused, sender's opinion of the EoC lowered
letter_event = {
	id = grace.919
	is_triggered_only = yes
	
	desc = EVTDESC_GRACE_919
    border = GFX_event_letter_frame_diplomacy
	
	option = {
		name = EVTOPTA_GRACE_919
		
		opinion = {
			who = FROM
			modifier = opinion_china_refused_imperial_marriage
		}
		log = "GRACE SYSTEM: [Root.GetTitledName] was refused an Imperial Marriage by [From.GetTitledName]!"
	}
}

### Tier 5 artifacts

# Select tier 5 artifact
letter_event = {
	id = grace.920
	is_triggered_only = yes
	desc = EVTDESC_GRACE_920
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					has_artifact = jade_dragon
				}
			}
		}
		
		name = EVTOPTA_GRACE_920
		
		FROMFROMFROM = {
			set_character_flag = getting_jade_dragon
			letter_event = { id = grace.318 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					has_artifact = art_of_war
				}
			}
		}
		
		name = EVTOPTB_GRACE_920
		
		FROMFROMFROM = {
			set_character_flag = getting_art_of_war
			letter_event = { id = grace.318 }
		}
	}
	
	option = {
		trigger = {
			FROMFROMFROM = {
				NOT = {
					has_artifact = classic_of_poetry
				}
			}
		}
		
		name = EVTOPTC_GRACE_920
		
		FROMFROMFROM = {
			set_character_flag = getting_classic_of_poetry
			letter_event = { id = grace.318 }
		}
	}
}



##### Misc (974-999, reserved ids 950-999)

# on_startup event to ensure that pre-existing tributaries of China start getting Grace
character_event = {
	id = grace.974
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		is_chinese_emperor_trigger = yes
		NOT = {
			has_global_flag = tributary_setup
		}
	}
	
	immediate = {
		set_global_flag = tributary_setup
		any_independent_ruler = {
			limit = {
				suzerain = {
					character = ROOT
				}
			}
			character_event = { id = grace.7 }
		}
	}
}

# Event setting up proper scopes for AI Grace decisions
character_event = {
	id = grace.975
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		log = "GRACE SYSTEM: [Root.GetTitledName] is using the new AI Grace decisions!"
		if = {
			limit = {
				has_character_flag = ai_send_gift_china
			}
			clr_character_flag = ai_send_gift_china
			log = "GRACE SYSTEM: [Root.GetTitledName] sent a gift"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.1 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_become_tributary_china
			}
			clr_character_flag = ai_become_tributary_china
			log = "GRACE SYSTEM: [Root.GetTitledName] offfered to become a tributary"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.4 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_supply_horses_china
			}
			clr_character_flag = ai_supply_horses_china
			log = "GRACE SYSTEM: [Root.GetTitledName] sent horses"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.8 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_send_relief_china
			}
			clr_character_flag = ai_send_relief_china
			log = "GRACE SYSTEM: [Root.GetTitledName] sent relief"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.31 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_peace_deal_china
			}
			clr_character_flag = ai_request_peace_deal_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for a peace deal"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.301 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_artifact_china
			}
			clr_character_flag = ai_request_artifact_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for an artifact"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.307 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_strategist_china
			}
			clr_character_flag = ai_request_strategist_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for a strategist"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.323 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_administrator_china
			}
			clr_character_flag = ai_request_administrator_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for a scholar-bureaucrat"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.326 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_master_engineer_china
			}
			clr_character_flag = ai_request_master_engineer_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for a master engineer"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.329 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_request_silk_road_favoured_status_china
			}
			clr_character_flag = ai_request_silk_road_favoured_status_china
			log = "GRACE SYSTEM: [Root.GetTitledName] asked for a trade contract"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.332 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_ask_to_increase_tributary_tier
			}
			clr_character_flag = ai_ask_to_increase_tributary_tier
			log = "GRACE SYSTEM: [Root.GetTitledName] asked to become a higher tier tributary"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.38 }
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = ai_ask_to_decrease_tributary_tier
			}
			clr_character_flag = ai_ask_to_decrease_tributary_tier
			log = "GRACE SYSTEM: [Root.GetTitledName] asked to become a lower tier tributary"
			e_china = {
				holder_scope = {
					narrative_event = { id = grace.343 }
				}
			}
		}
		else = {
			log = "GRACE SYSTEM: Something weird happened!"
		}
	}
}

# on_new_holder event clearing out Grace for the EoC and any old EoC
character_event = {
	id = grace.976
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		FROM = {
			title = e_china
		}
	}
	
	immediate = {
		set_variable = {
			which = grace
			value = 0
		}
		clr_character_flag = grace_character
		FROMFROM = {
			set_variable = {
				which = grace
				value = 0
			}
			clr_character_flag = grace_character
		}
	}
}

# on_new_holder_usurpation event penalizing taking titles from the EoC and his relatives
character_event = {
	id = grace.977
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		FROMFROM = {
			OR = {
				is_chinese_emperor_trigger = yes
				any_dynasty_member = {
					is_chinese_emperor_trigger = yes
				}
			}
		}
		NOR = {
			is_chinese_emperor_trigger = yes
			any_dynasty_member = {
				is_chinese_emperor_trigger = yes
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				FROMFROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			detract_grace_super_huge_effect = yes
		}
		else_if = {
			limit = {
				FROMFROM = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
			}
			detract_grace_massive_effect = yes
		}
	}
}

# on_divorce event penalizing divorcing of the EoC and his relatives
character_event = {
	id = grace.978
	is_triggered_only = yes
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR = {
			is_chinese_emperor_trigger = yes
			any_dynasty_member = {
				is_chinese_emperor_trigger = yes
			}
		}
		NOT = {
			FROM = {
				is_chinese_emperor_trigger = yes
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_chinese_emperor_trigger = yes
			}
			FROM = {
				detract_grace_super_huge_effect = yes
			}
		}
		else_if = {
			limit = {
				any_close_relative = {
					dynasty = ROOT
					is_chinese_emperor_trigger = yes
				}
			}
			FROM = {
				detract_grace_massive_effect = yes
			}
		}
	}
}

# on_become_imprisoned_any_reason event penalizing imprisonment of the EoC and his relatives
character_event = {
	id = grace.979
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		OR = {
			is_chinese_emperor_trigger = yes
			any_dynasty_member = {
				is_chinese_emperor_trigger = yes
			}
		}
		NOT = {
			FROM = {
				is_chinese_emperor_trigger = yes
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_chinese_emperor_trigger = yes
			}
			FROM = {
				detract_grace_super_huge_effect = yes
			}
		}
		else_if = {
			limit = {
				any_close_relative = {
					dynasty = ROOT
					is_chinese_emperor_trigger = yes
				}
			}
			FROM = {
				detract_grace_massive_effect = yes
			}
		}
	}
}

# Returns whether china_hates_from_trigger is true or not
letter_event = {
	id = grace.980
	is_triggered_only = yes
	
	desc = {
		text = EVTDESCA_GRACE_980
		trigger = {
			china_hates_from_trigger = yes
		}
	}
	desc = {
		text = EVTDESCB_GRACE_980
		trigger = {
			china_hates_from_trigger = no
		}
	}
	
	option = {
		trigger = {
			china_hates_from_trigger = yes
		}
		name = EVTOPTA_GRACE_980
	}
	
	option = {
		trigger = {
			china_hates_from_trigger = no
		}
		name = EVTOPTB_GRACE_980
	}
}

# on_startup event giving the EoC one of each Chinese artifact
character_event = {
	id = grace.981
	is_triggered_only = yes 
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		is_chinese_emperor_trigger = yes
		NOT = {
			has_global_flag = artifacts_for_eoc
		}
		NOT = {
			has_global_flag = china_recreated # To avoid cheesing things in the IC start
		}
	}
	
	immediate = {
		set_global_flag = artifacts_for_eoc
		add_artifact = chinese_artwork
		new_artifact = {
			set_name="chinese_artwork_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_calligraphy
		new_artifact = {
			set_name="chinese_calligraphy_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = silk_shroud
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_sculpture
		new_artifact = {
			set_name="chinese_sculpture_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_ceremonial_robes
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		#OR = {
		#	add_artifact = chinese_prev_emperor_sculpture
		#	#offmap_china = {
		#	#	offmap_prev_ruler = {
		#	#		always = no
		#	#	}
		#	#}
		#}
		add_artifact = chinese_arm_protector
		new_artifact = {
			set_name="chinese_arm_protector_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = jian_sword
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_serpent_spear
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_ji
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_crossbow
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_bronze_sculpture
		new_artifact = {
			set_name="chinese_bronze_sculpture_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_painting_of_glitterhoof
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		random_independent_ruler = {
			limit = {
				any_realm_province = {
					trade_route = silk_road
				}
			}
			random_realm_province = {
				limit = {
					trade_route = silk_road
				}
				save_event_target_as = tapestry_target
			}
		}
		add_artifact = chinese_tapestry
		new_artifact = {
			set_name="chinese_tapestry_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_tapestry_grand
		new_artifact = {
			set_name="chinese_tapestry_grand_name"
			set_creation_date = "-1.1.1"
		}
		# Books
		add_artifact = chinese_book_health
		new_artifact = {
			set_name="chinese_book_health_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_book_law
		new_artifact = {
			set_name="chinese_book_law_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_book_history
		new_artifact = {
			set_name="chinese_book_history_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = chinese_book_economy
		new_artifact = {
			set_name="chinese_book_economy_name"
			set_creation_date = "-1.1.1"
		}
		add_artifact = art_of_war
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
		add_artifact = classic_of_poetry
		new_artifact = {
			set_creation_date = "-1.1.1"
		}
	}
}

# Chinese princess spawn event - for testing - never triggered normally
character_event = {
	id = grace.982
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		e_china = {
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					set_father = PREV
					dynasty = PREV
					add_trait = dragon_bride_unmarried
				}
			}
			holder_scope = {
				create_character = {
					female = yes
					age = 16
					culture = PREV
					religion = PREV
					random_traits = yes
				}
				new_character = {
					dynasty = PREV
					set_father = PREV
					add_trait = dragon_bride_unmarried
				}
			}
		}
	}
}


# Grace cheat event - for testing (or general cheating, I suppose...) - never triggered normally
character_event = {
	id = grace.983
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		change_variable = {
			which = grace
			value = 1000000
		}
		set_character_flag = grace_character
	}
}

# on_yearly_pulse Chinese princess handling
character_event = {
	id = grace.984
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	only_independent = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_landed_title = e_china
		has_game_rule = {
			name = grace_interactions
			value = enabled
		}
		has_game_rule = {
			name = imperial_marriages
			value = enabled
		}
	}
	
	immediate = {
		if = {
			limit = {
				has_character_flag = chinese_princess_update
			}
			clr_character_flag = chinese_princess_update
		}
		set_character_flag = chinese_princess_update
		log = "Chinese Princess update!"
		if = {
			limit = {
				#is_chinese_emperor_trigger = yes # Doesn't work for various on_new_holder on_actions, presumably because the government isn't set at that point
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				e_china = {
					holder_scope = {
						NOT = {
							has_character_flag = china_no_imperial_marriage_boons
						}
					}
					NOR = {
						has_law = cognatic_succession # Ag-Cog; let princesses be possible rulers!
						has_law = true_cognatic_succession
						has_law = enatic_succession # Female heirs only!
						has_law = enatic_cognatic_succession # En-Cog
						has_law = status_of_women_4
					}
				}
			}
			log = "The emperor of China, [Root.GetBestName], should have Chinese Princesses!"
			any_dynasty_member = {
				limit = {
					is_female = yes
					is_alive = yes
				}
				if = {
					limit = {
						is_married = no
						is_consort = no
						is_landed = no
						NOR = {
							trait = dragon_bride_unmarried
							trait = dragon_bride_married # If married off but no longer married, don't add the trait again!
						}
						host = {
							OR = {
								character = ROOT
								any_liege = {
									OR = {
										character = ROOT
										liege_before_war = {
											character = ROOT
										}
									}
								}
								liege_before_war = {
									character = ROOT
								}
							}
						}
					}
					add_trait = dragon_bride_unmarried
					log = "[This.GetBestName] gained dragon_bride_unmarried!"
				}
				else_if = {
					limit = {
						is_married = no
						is_consort = no
						trait = dragon_bride_unmarried
						NOT = {
							host = {
								OR = {
									character = ROOT
									any_liege = {
										OR = {
											character = ROOT
											liege_before_war = {
												character = ROOT
											}
										}
									}
									liege_before_war = {
										character = ROOT
									}
								}
							}
						}
					}
					remove_trait = dragon_bride_unmarried
					log = "[This.GetBestName] lost dragon_bride_unmarried!"
				}
				else_if = {
					limit = {
						OR = {
							is_married = yes
							is_consort = yes
						}
						NOT = {
							trait = dragon_bride_married
						}
					}
					remove_trait = dragon_bride_unmarried
					add_trait = dragon_bride_married
					log = "[This.GetBestName] gained dragon_bride_married!"
				}
			}
		}
		else = {
			log = "The emperor of China, [Root.GetBestName], shouldn't have Chinese Princesses!"
			any_dynasty_member = {
				limit = {
					is_female = yes
					is_alive = yes
				}
				remove_trait = dragon_bride_unmarried
				log = "[This.GetBestName] lost dragon_bride_unmarried!"
			}
		}
	}
}

# on_birth, on_adolescence, on_adulthood event for Chinese princess handling
character_event = {
	id = grace.985
	is_triggered_only = yes
	hide_window = yes
	
	only_women = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_game_rule = {
			name = grace_interactions
			value = enabled
		}
		has_game_rule = {
			name = imperial_marriages
			value = enabled
		}
		is_landed = no
		#is_married = no
		#is_consort = no
		any_dynasty_member = {
			is_chinese_emperor_trigger = yes
			OR = {
				any_realm_character = {
					character = ROOT
				}
				ROOT = {
					host = {
						OR = {
							liege_before_war = {
								is_chinese_emperor_trigger = yes
							}
							any_liege = {
								liege_before_war = {
									is_chinese_emperor_trigger = yes
								}
							}
						}
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				NOT = {
					has_character_flag = china_no_imperial_marriage_boons
				}
			}
			NOR = {
				has_law = cognatic_succession # Ag-Cog; let princesses be possible rulers!
				has_law = true_cognatic_succession
				has_law = enatic_succession # Female heirs only!
				has_law = enatic_cognatic_succession # En-Cog
				has_law = status_of_women_4
			}
		}
		NOR = {
			trait = dragon_bride_unmarried
			trait = dragon_bride_married # If married off but no longer married, don't add the trait again!
		}
	}
	
	immediate = {
		if = {
			limit = {
				OR = {
					is_married = yes
					is_consort = yes
				}
			}
			add_trait = dragon_bride_married
		}
		else = {
			add_trait = dragon_bride_unmarried
		}
	}
}

# on_startup, on_character_convert_religion, on_character_convert_culture event for the EoC
character_event = {
	id = grace.986
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_game_rule = {
			name = grace_interactions
			value = enabled
		}
		has_game_rule = {
			name = imperial_marriages
			value = enabled
		}
		has_landed_title = e_china
	}
	
	immediate = {
		character_event = { id = grace.984 } # Update princesses
	}
}

# on_war_ended_victory, on_war_ended_whitepeace, on_war ended_invalid event for the EoC, triggering further event - deprecated
character_event = {
	id = grace.987
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_game_rule = {
			name = grace_interactions
			value = enabled
		}
		has_game_rule = {
			name = imperial_marriages
			value = enabled
		}
		OR = {
			ROOT = {
				has_landed_title = e_china
			}
			FROM = {
				has_landed_title = e_china
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				FROM = {
					has_landed_title = e_china
				}
			}
			FROM = {
				character_event = { id = grace.986 }
			}
			break = yes
		}
		character_event = { id = grace.986 }
	}
}

# on_new_holder, on_new_holder_inheritance, on_new_holder_usurpation event for the EoC
character_event = {
	id = grace.988
	is_triggered_only = yes
	hide_window = yes
	
	only_playable = yes
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_game_rule = {
			name = grace_interactions
			value = enabled
		}
		has_game_rule = {
			name = imperial_marriages
			value = enabled
		}
		has_landed_title = e_china
		OR = {
			FROM = {
				NOT = {
					title = e_china # EoC inherits random title
				}
			}
			AND = {
				FROM = {
					title = e_china
				}
				FROMFROM = {
					dynasty = ROOT # The former EoC shares our dynasty; otherwise, use the other event!
				}
			}
		}
		OR = {
			NOT = {
				has_character_flag = chinese_princess_update
			}
			had_character_flag = { flag = chinese_princess_update days = 1 } # Don't spam it for every title gained!
		}
	}
	
	immediate = {
		character_event = { id = grace.984 } # Update princesses
	}
}

# on_bi_yearly_pulse chance to make concubines pregnant if their husband is Chinese or Japanese Imperial (to avoid the lack of children after a certain number of children)
character_event = {
	id = grace.989
	hide_window = yes
	
	only_women = yes
	min_age = 16
	max_age = 45
	only_capable = yes
	prisoner = no
	is_triggered_only = yes
	
	trigger = {
		is_inaccessible_trigger = no
		is_consort = yes
		NOT = { # Recently pregnant
			any_child = {
				NOT = {
					age = 1
				}
			}
		}
		NOR = { # This should not happen
			trait = celibate
			any_consort = {
				OR = {
					trait = celibate
					trait = eunuch
					prisoner = yes
					trait = incapable
					is_inaccessible_trigger = yes
				}
			}
		}
		is_pregnant = no
		any_consort = {
			OR = {
				government = chinese_imperial_government
				government = japanese_imperial_government
				government = divine_imperial_government
			}
		}
		NOT = {
			any_consort = {
				NOR = {
					government = chinese_imperial_government
					government = japanese_imperial_government
					government = divine_imperial_government
				}
			}
		}
	}
	
	immediate = {
		random_list = {
			40 = {
				# The player's dynasty should not die out
				modifier = {
					factor = 2
					any_consort = {
						ai = no
					}
				}
				
				# Lustful traits, and similar
				modifier = {
					factor = 1.1
					trait = lustful
				}
				modifier = {
					factor = 1.1
					any_consort = {
						trait = lustful
					}
				}
				modifier = {
					factor = 1.1
					trait = seductress
				}
				modifier = {
					factor = 1.1
					any_consort = {
						trait = seducer
					}
				}
				modifier = {
					factor = 1.1
					trait = hedonist
				}
				modifier = {
					factor = 1.1
					any_consort = {
						trait = hedonist
					}
				}
				
				# Foci
				modifier = {
					factor = 1.1
					any_consort = {
						has_focus = focus_family
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						has_focus = focus_seduction
					}
				}
				
				# Fertility modifiers
				modifier = {
					factor = 1.1
					fertility  = 0.4
				}
				modifier = {
					factor = 1.1
					fertility  = 0.5
				}
				modifier = {
					factor = 1.1
					fertility  = 0.6
				}
				modifier = {
					factor = 1.1
					fertility  = 0.7
				}
				modifier = {
					factor = 1.1
					fertility  = 0.8
				}
				modifier = {
					factor = 1.1
					fertility  = 0.9
				}
				modifier = {
					factor = 1.1
					fertility  = 1.0
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.4
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.5
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.6
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.7
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.8
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 0.9
					}
				}
				modifier = {
					factor = 1.1
					any_consort = {
						fertility  = 1.0
					}
				}
				
				modifier = { # Concubine lover
					factor = 1.5
					any_lover = {
						any_consort = {
							character = ROOT
						}
					}
				}
			
				# As the target is female, we don't need to go for a random consort
				any_consort = {
					impregnate = ROOT
				}
			}
			60 = { # Do nothing; event fires every other year, but only about 40 % chance of it having a result, pre-modifiers...
				# Homosexuality
				modifier = { # Can still happen, but rare
					factor = 10
					trait = homosexual
				}
				
				# Opinion
				modifier = { # Low opinion
					factor = 10
					NOT = {
						any_consort = {
							opinion = {
								who = ROOT
								value = 0
							}
						}
					}
				}
				modifier = { # Low opinion
					factor = 10
					NOT = {
						any_consort = {
							reverse_opinion = {
								who = ROOT
								value = 0
							}
						}
					}
				}
				# Abducted
				modifier = { 
					factor = 10
					NOT = {
						any_consort = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_forced_consort
							}
						}
					}
				}
			}
		}
	}
}

# on_war_started event removing the "Sending Relief to China" modifier if you end up being the primary participant in a war against China
character_event = {
	id = grace.990
	is_triggered_only = yes
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR = {
			# Attacker is EoC, defender has trade contract
			AND = {
				ROOT = {
					has_character_modifier = china_send_relief
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			# Defender is EoC (or a Chinese tributary, if the attacker isn't one), attacker has trade contract
			AND = {
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							OR = {
								is_tributary = {
									type = chinese_imperial_tributary
								}
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				ROOT = {
					has_character_modifier = china_send_relief
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			remove_character_modifier = china_send_relief
			log = "GRACE SYSTEM: [From.GetTitledName] no longer has a Chinese Trade Contract due to war!"
		}
		if = {
			limit = {
				FROM = {
					has_character_modifier = china_send_relief
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
			FROM = {
				remove_character_modifier = china_send_relief
			}
			log = "GRACE SYSTEM: [From.GetTitledName] no longer sends relief due to war!"
		}
	}
}

# Inform target that EoC breaks Peace Deal
letter_event = {
	id = grace.991
	desc = EVTDESC_GRACE_991
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_991
		remove_character_modifier = peace_deal_with_china
		FROMFROM = {
			set_truce = {
				who = ROOT
				years = 2
			}
		}
		FROMFROM = {
			letter_event = { id = grace.992 }
		}
	}
}

# EoC informed of target's displeasure
letter_event = {
	id = grace.992
	desc = EVTDESC_GRACE_992
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_992
		
		FROM = {
			# Lasts 100 years, prevents you from getting a new Peace Deal with them
			opinion = {
				who = ROOT
				modifier = china_peace_deal_breaker
			}
			# Breaks any regular NAP at the same time
			opinion = {
				who = ROOT
				modifier = broken_non_aggression_pact
			}
		}
		add_character_modifier = {
			name = broken_non_aggression_pact_char_modifier
			years = 10
		}
		set_truce = {
			who = FROM
			years = 2
		}
		prestige = -1000
	}
}

# Inform EoC that other party breaks Peace Deal
letter_event = {
	id = grace.993
	desc = EVTDESC_GRACE_993
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_993
		FROMFROM = {
			set_truce = {
				who = ROOT
				years = 2
			}
		}
		FROMFROM = {
			letter_event = { id = grace.994 }
		}
	}
}

# Chinese Peace Deal-breaker informed of the EoC's displeasure, loses a massive amount of Grace and opinion
letter_event = {
	id = grace.994
	desc = EVTDESC_GRACE_994
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_GRACE_994
		
		remove_character_modifier = peace_deal_with_china
		sound_effect = china_angered_emperor
		detract_grace_super_huge_effect = yes # Same as attacking China
		
		FROM = {
			# Lasts 100 years, prevents you from getting a new Peace Deal
			opinion = {
				who = ROOT
				modifier = china_peace_deal_breaker
			}
			# Breaks any regular NAP at the same time
			opinion = {
				who = ROOT
				modifier = broken_non_aggression_pact
			}
		}
		add_character_modifier = {
			name = broken_non_aggression_pact_char_modifier
			years = 10
		}
		set_truce = {
			who = FROM
			years = 2
		}
		prestige = -1000
	}
}

# on_war_started event removing the "Chinese Trade Contract" modifier if you end up being the primary participant in a war against China
character_event = {
	id = grace.995
	is_triggered_only = yes
	hide_window = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		OR = {
			# Attacker is EoC, defender has trade contract
			AND = {
				ROOT = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			# Defender is EoC (or a Chinese tributary, if the attacker isn't one), attacker has trade contract
			AND = {
				FROM = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							OR = {
								is_tributary = {
									type = chinese_imperial_tributary
								}
								is_tributary = {
									type = chinese_protectorate
								}
								is_tributary = {
									type = chinese_client_state
								}
							}
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				ROOT = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				FROM = {
					is_chinese_emperor_trigger = yes
				}
			}
			remove_character_modifier = chinese_imperial_trade_contract
			log = "GRACE SYSTEM: [From.GetTitledName] no longer has a Chinese Trade Contract due to war!"
		}
		if = {
			limit = {
				FROM = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				ROOT = {
					OR = {
						is_chinese_emperor_trigger = yes
						AND = {
							suzerain = {
								is_chinese_emperor_trigger = yes
							}
							FROM = {
								suzerain = {
									is_chinese_emperor_trigger = no
								}
							}
						}
					}
				}
			}
			FROM = {
				remove_character_modifier = chinese_imperial_trade_contract
			}
			log = "GRACE SYSTEM: [From.GetTitledName] no longer has a Chinese Trade Contract due to war!"
		}
	}
}

## on_war_started event cancelling "Supply Horses" if China and the sender end up being the primary participants in a war against one another - DEPRECATED
#character_event = {
#	id = grace.996
#	is_triggered_only = yes
#	hide_window = yes
#	
#	has_dlc = "Jade Dragon"
#	
#	trigger = {
#		always = no # Deprecated!
#		OR = {
#			# Attacker is EoC, defender is supplying horses
#			AND = {
#				ROOT = {
#					has_character_modifier = china_supply_horses
#				}
#				FROM = {
#					is_chinese_emperor_trigger = yes
#				}
#			}
#			# Defender is EoC (or a Chinese tributary, if the attacker isn't one), attacker is supplying horses
#			AND = {
#				FROM = {
#					has_character_modifier = china_supply_horses
#				}
#				ROOT = {
#					OR = {
#						is_chinese_emperor_trigger = yes
#						AND = {
#							suzerain = {
#								is_chinese_emperor_trigger = yes
#							}
#							FROM = {
#								suzerain = {
#									is_chinese_emperor_trigger = no
#								}
#							}
#						}
#					}
#				}
#			}
#		}
#	}
#	
#	immediate = {
#		if = {
#			limit = {
#				ROOT = {
#					has_character_modifier = china_supply_horses
#				}
#				FROM = {
#					is_chinese_emperor_trigger = yes
#				}
#			}
#			remove_character_modifier = china_supply_horses
#			#log = "[Root.GetTitledName] is no longer supplying horses due to war!"
#		}
#		if = {
#			limit = {
#				FROM = {
#					has_character_modifier = china_supply_horses
#				}
#				ROOT = {
#					OR = {
#						is_chinese_emperor_trigger = yes
#						AND = {
#							suzerain = {
#								is_chinese_emperor_trigger = yes
#							}
#							FROM = {
#								suzerain = {
#									is_chinese_emperor_trigger = no
#								}
#							}
#						}
#					}
#				}
#			}
#			FROM = {
#				remove_character_modifier = china_supply_horses
#			}
#			#log = "[From.GetTitledName] is no longer supplying horses due to war!"
#		}
#	}
#}

# Show current Grace - Deprecated
letter_event = {
	id = grace.997
	is_triggered_only = yes
	desc = EVTDESC_GRACE_997
	
	option = {
		name = EVTOPTA_GRACE_997
	}
}

# on_death event handling Grace inheritance
character_event = {
	id = grace.998
	hide_window = yes
	is_triggered_only = yes
	
	#only_playable = yes
	
	has_dlc = "Jade Dragon"
	
	trigger = {
		has_character_flag = grace_character
	}
	
	immediate = {
		if = {
			limit = {
				is_chinese_emperor_trigger = no
				is_playable = yes # We don't care about courtier/baron Grace, particularly not since it easily could be negative due to AI stupidity and could penalize the player for AI stupidity
			}
			# Gives the primary heir
			current_heir = {
				if = {
					limit = {
						is_chinese_emperor_trigger = no
					}
				}
				set_character_flag = grace_character
				# If ROOT is an AI and has negative Grace, only transfer 10 % of the Grace to somewhat reduce the price of AI stupidity
				if = {
					limit = {
						ROOT = {
							ai = yes # If the player has been doing bad things (or has inherited a lot of negative Grace and not fixed the situation), there's no reduction
							NOT = {
								check_variable = {
									which = grace
									value = 0
								}
							}
						}
					}
					ROOT = {
						divide_variable = {
							which = grace
							value = 10
						}
					}
				}
				else_if = {
					limit = {
						ROOT = {
							NOT = {
								check_variable = {
									which = grace
									value = 0
								}
							}
						}
					}
					# China is somewhat forgiving on succession
					ROOT = {
						divide_variable = {
							which = grace
							value = 2
						}
					}
				}
				# Give Grace to heir
				change_variable = {
					which = grace
					which = ROOT
				}
				log = "GRACE SYSTEM: [This.GetTitledName] has inherited the Grace of [Root.GetTitledName]!"
			}
			clr_character_flag = grace_character
			#if = { 
			#	limit = {
			#		OR = {
			#			is_tributary = {
			#				type = chinese_imperial_tributary
			#			}
			#			is_tributary = {
			#				type = chinese_protectorate
			#			}
			#			is_tributary = {
			#				type = chinese_client_state
			#			}
			#		}
			#		suzerain = {
			#			is_chinese_emperor_trigger = yes
			#		}
			#		current_heir = { # This avoids a potential scenario where the heir could get grace.7 more than once due to already being a tributary
			#			NOT = {
			#				AND = {
			#					OR = {
			#						is_tributary = {
			#							type = chinese_imperial_tributary
			#						}
			#						is_tributary = {
			#							type = chinese_protectorate
			#						}
			#						is_tributary = {
			#							type = chinese_client_state
			#						}
			#					}
			#					suzerain = {
			#						is_chinese_emperor_trigger = yes
			#					}
			#				}
			#			}
			#		}
			#	}
			#	current_heir = {
			#		character_event = { id = grace.7 days = 365 } # Keep tributary Grace gain
			#	}
			#}
		}
		clr_character_flag = grace_character
		set_variable = {
			which = grace
			value = 0 # Clearing it for save game memory optimization
		}
	}
}

# on_new_holder (of any type) event clearing out all Grace if the holder of e_china changes dynasty
character_event = {
	id = grace.999
	hide_window = yes
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	
	#trigger = { # Also used to handle the Treasure Fleet cleanup, so this trigger is no longer good!
	#	has_game_rule = {
	#		name = grace_interactions
	#		value = enabled
	#	}
	#}
	
	immediate = {
		2753 = {
			set_province_flag = abort_treasure_fleet_asap
		}
		log = "GRACE SYSTEM: The [Root.GetOnlyDynastyName] dynasty now sits on the Dragon Throne!"
		# We are forced to use any_character here to account for deposed rulers, even though the scope is performance-intensive
		# This event should hopefully only fire rarely, though, so it should be fine
		
		# Clear out Imperial Princesses for the old dynasty
		if = {
			limit = {
				has_game_rule = {
					name = imperial_marriages
					value = enabled
				}
			}
			FROMFROMFROMFROM = {
				any_dynasty_member = {
					limit = {
						is_female = yes
					}
					remove_trait = dragon_bride_unmarried
					#remove_trait = dragon_bride_married # Let them keep it...
				}
			}
			log = "GRACE SYSTEM: Chinsee princesses of the [FromFrom.GetDynasty] dynasty have lost their traits!"
			
			# If the new EoC uses Grace, give the relevant characters the dragon_bride_unmarried/dragon_bride_married traits
			if = {
				limit = {
					ROOT = {
						is_chinese_emperor_trigger = yes
						e_china = {
							NOR = {
								has_law = cognatic_succession # Ag-Cog; let princesses be possible rulers!
								has_law = true_cognatic_succession
								has_law = enatic_succession # Female heirs only!
								has_law = enatic_cognatic_succession # En-Cog
								has_law = status_of_women_4
							}
						}
					}
				}
				any_dynasty_member = {
					limit = {
						is_female = yes
						is_married = no
						is_consort = no
						NOR = {
							trait = dragon_bride_unmarried
							trait = dragon_bride_married # If married off but no longer married, don't add the trait again!
						}
						host = {
							OR = {
								character = ROOT
								any_liege = {
									OR = {
										character = ROOT
										liege_before_war = {
											character = ROOT
										}
									}
								}
								liege_before_war = {
									character = ROOT
								}
							}
						}
					}
					add_trait = dragon_bride_unmarried
				}
				#any_dynasty_member = {
				#	limit = {
				#		is_female = yes
				#		is_married = no
				#		is_consort = no
				#		NOT = {
				#			host = {
				#				OR = {
				#					character = ROOT
				#					any_liege = {
				#						OR = {
				#							character = ROOT
				#							liege_before_war = {
				#								character = ROOT
				#							}
				#						}
				#					}
				#					liege_before_war = {
				#						character = ROOT
				#					}
				#				}
				#			}
				#		}
				#	}
				#	remove_trait = dragon_bride_unmarried
				#}
				any_dynasty_member = {
					limit = {
						is_female = yes
						is_married = yes
					}
					add_trait = dragon_bride_married
				}
				log = "GRACE SYSTEM: Female family members of the EoC have gained the relevant traits!"
			}
		}
		if = {
			limit = {
				has_character_flag = new_chinese_imperial_dynasty
			}
			# Clear all Grace and stop tracking Grace characters
			any_character = {
				limit = {
					has_character_flag = grace_character
				}
				set_variable = {
					which = grace
					value = 0
				}
				clr_character_flag = grace_character
			}
			
			log = "GRACE SYSTEM: All Grace has been removed from all characters!"
			
			# Revoke all Chinese Trade Contracts
			any_character = {
				limit = {
					has_character_modifier = china_send_relief
				}
				remove_character_modifier = china_send_relief
			}
			
			log = "GRACE SYSTEM: All relief expeditions have been ended!"
			
			## Terminate all "Supply Horses" agreements
			#any_character = {
			#	limit = {
			#		has_character_modifier = china_supply_horses
			#	}
			#	remove_character_modifier = china_supply_horses
			#}
			#
			##log = "All agreements to supply horses have been ended!"
			
			# Revoke all Chinese Trade Contracts
			any_character = {
				limit = {
					has_character_modifier = chinese_imperial_trade_contract
				}
				remove_character_modifier = chinese_imperial_trade_contract
			}
			
			log = "GRACE SYSTEM: All Chinese Trade Contracts have been ended!"
			
			# Remove all Chinese Peace Deals
			any_character = {
				limit = {
					has_character_modifier = peace_deal_with_china
				}
				remove_character_modifier = peace_deal_with_china
			}
			
			log = "GRACE SYSTEM: All Chinese Peace Deals have been ended!"
		}
	}
}