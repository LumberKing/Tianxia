# Dragonslayer quest events
# by Silverswee(e)per

# This all relates to a supernatural event you can get during the LNY if western dragons show up

namespace = tianxia

# IDs 201-400 reserved

##### Fredak recovers from his wounds

### dragon_injured cleanup

# Check if we can clear up the flag and do so, otherwise repeat if the dragon lives
province_event = {
	id = tianxia.201
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = {
			has_global_flag = dragon_slain
		}
		has_global_flag = dragon_injured
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_global_flag = ongoing_dragonslaying_attempt
				}
				NOT =  {
					any_character = {
						has_character_flag = in_dragons_lair_queue
					}
				}
			}
			random_list = {
				75 = {
					if = {
						limit = {
							is_variable_equal = {
								which = dragon_wounds
								value = 1
							}
						}
						clr_global_flag = dragon_injured
						set_variable = {
							which = dragon_wounds
							value = 0
						}
						burninate_with_extreme_prejudice_effect = yes
						any_player = {
							character_event = { id = tianxia.202 } # Inform all players that the dragon no longer is injured
						}
						change_variable = {
							which = dragons_hoard
							value = 100
						}
					}
					else_if = {
						check_variable = {
							which = dragon_wounds
							value = 2
						}
						random_list = {
							75 = {
								change_variable = {
									which = dragon_wounds
									value = -1
								}
							}
							25 = {
								change_variable = {
									which = dragon_wounds
									value = -2
								}
							}
						}
					}
					else = {
						change_variable = {
							which = dragon_wounds
							value = -1
						}
					}
				}
				25 = {
					repeat_event = { id = tianxia.202 days = 183 } # Longer recovery; try again
				}
			}
		}
		else = {
			repeat_event = { id = tianxia.202 days = 30 } # Fire the event again, hopefully after all ongoing dragonslayer attemps
		}
	}
}

# Inform the world
character_event = {
	id = tianxia.202
	desc = EVTDESC_SOH_202
	picture = GFX_evt_burning_house
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_202 # Terrible news!
	}
}



##### Dragonslaying event chain - the journey

### Setting out

# Setting out
character_event = {
	id = tianxia.203
	desc = EVTDESC_DRAGON_4
    picture = GFX_evt_pilgrims_epic_journey
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_DRAGON_4 # I'm going on an adventure!
		
		add_trait = hunting_dragons # Will need a regent
		set_character_flag = do_not_disturb
		
		any_courtier = {
			limit = {
				is_landed = no
				prisoner = no
				is_inaccessible_or_incapable_trigger = no
				has_character_flag = dragonslayer_wannabe
			}
			add_trait = hunting_dragons # Will need a regent
			opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
		}
		
		hidden_tooltip = {
			log = "[Root.GetBestName] has set off to slay Fredak, the Emperor of Embers!"
			set_variable = {
				which = dragons_lair_travel_progress
				value = 0
			}
			if = {
				limit = {
					capital_scope = {
						2861 = { # Chang'an
							persistent_event_target:dragons_lair_province = {
								NOT = {
									distance = {
										where = PREVPREV
										value = 200
									}
								}
							}
						}
					}
				}
				set_variable = {
					which = dragons_lair_travel_distance
					value = 2
				}
			}
			else_if = {
				limit = {
					capital_scope = {
						2861 = { # Chang'an
							persistent_event_target:dragons_lair_province = {
								NOT = {
									distance = {
										where = PREVPREV
										value = 400
									}
								}
							}
						}
					}
				}
				set_variable = {
					which = dragons_lair_travel_distance
					value = 4
				}
			}
			else_if = {
				limit = {
					capital_scope = {
						2861 = { # Chang'an
							persistent_event_target:dragons_lair_province = {
								NOT = {
									distance = {
										where = PREVPREV
										value = 600
									}
								}
							}
						}
					}
				}
				set_variable = {
					which = dragons_lair_travel_distance
					value = 6
				}
			}
			else_if = {
				limit = {
					capital_scope = {
						2861 = { # Chang'an
							persistent_event_target:dragons_lair_province = {
								NOT = {
									distance = {
										where = PREVPREV
										value = 800
									}
								}
							}
						}
					}
				}
				set_variable = {
					which = dragons_lair_travel_distance
					value = 8
				}
			}
			else_if = {
				limit = {
					capital_scope = {
						2861 = { # Chang'an
							persistent_event_target:dragons_lair_province = {
								NOT = {
									distance = {
										where = PREVPREV
										value = 1000
									}
								}
							}
						}
					}
				}
				set_variable = {
					which = dragons_lair_travel_distance
					value = 10
				}
			}
			else = {
				set_variable = {
					which = dragons_lair_travel_distance
					value = 12
				}
			}
			character_event = { id = tianxia.204 days = 60 random  = 30 }
			
			character_event = { id = tianxia.394 } # Clean up flags
			character_event = { id = tianxia.397 years = 5 } # If stuck after this long, return home...
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		name = EVTOPTB_DRAGON_4 # On second thought, let's not...
		remove_character_modifier = recent_dragon_hunt
	}
}


# Travel progress and sub-chain selection
character_event = {
	id = tianxia.204
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					is_landed = no
					is_incapable = yes
					prisoner = yes
				}
			}
			remove_trait = hunting_dragons
			any_opinion_modifier_target = {
				limit = {
					has_opinion_modifier = {
						who = ROOT
						modifier = hunting_dragons_together
					}
				}
				remove_trait = hunting_dragons
				remove_opinion = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			
			character_event = { id = tianxia.394 } # Flag cleanup
			character_event = { id = tianxia.395 } # Return home
		}
		else = {
			if = {
				limit = {
					is_variable_equal = {
						which = dragons_lair_travel_progress
						which = dragons_lair_travel_distance
					}
				}
				if = {
					limit = {
						NOT = {
							has_global_flag = dragons_lair_looted # In this case, go directly to the end
						}
					}
					character_event = { id = tianxia.341 } # Go to the queue
				}
				else = {
					character_event = { id = tianxia.342 } # You are too late!
				}
			}
			else = {
				# Sub-chain selection
				random_list = {
					5 = {
						modifier = {
							factor = 0
							NOT = {
								any_playable_ruler = {
									NOR = {
										character = ROOT
										any_friend = {
											character = ROOT
										}
										any_lover = {
											character = ROOT
										}
									}
								}
							}
						}
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_rival_dragonslayer
						}
						set_character_flag = dragonslaying_rival_dragonslayer
						random_playable_ruler = {
							limit = {
								NOR = {
									character = ROOT
									any_friend = {
										character = ROOT
									}
									any_lover = {
										character = ROOT
									}
									has_character_flag = dragonslaying_rival_dragonslayer
								}
							}
							preferred_limit = {
								any_rival = {
									character = ROOT
								}
							}
							save_event_target_as = rival_dragonslayer
						}
						character_event = { id = tianxia.205 } # Spot rival party; attack them openly, attack them under the cover of darkness, or simply try to travel faster than them
					}
					10 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_prayed_at_shrine
						}
						modifier = {
							factor = 0
							has_secret_religion = yes
						}
						set_character_flag = dragonslaying_prayed_at_shrine
						character_event = { id = tianxia.222 } # Pray at shrine?
					}
					5 = {
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_tumbling_villagers
						}
						modifier = {
							factor = 0
							trait = celibate
						}
						modifier = {
							factor = 0
							is_pregnant = yes
						}
						modifier = {
							factor = 2
							trait = lustful
						}
						set_character_flag = dragonslaying_tumbling_villagers
						character_event = { id = tianxia.228 } # Spot someone attractive in a village - tumble them?
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_bandits
						}
						set_character_flag = dragonslaying_bandits
						character_event = { id = tianxia.230 } # Spot bandits about to attack a village - help the village?
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_legend
						}
						set_character_flag = dragonslaying_legend
						character_event = { id = tianxia.238 } # Storyteller speaks of legendary dragonslayers - listen?
					}
					5 = {
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_disagreement
						}
						modifier = {
							factor = 0
							NOT = {
								any_opinion_modifier_target = {
									has_opinion_modifier = {
										who = ROOT
										modifier = hunting_dragons_together
									}
									NOT = {
										any_rival = {
											character = ROOT
										}
									}
								}
							}
						}
						random_opinion_modifier_target = {
							limit = {
								has_opinion_modifier = {
									who = ROOT
									modifier = hunting_dragons_together
								}
								NOT = {
									any_rival = {
										character = ROOT
									}
								}
							}
							save_event_target_as = disagreement_target
						}
						set_character_flag = dragonslaying_disagreement
						character_event = { id = tianxia.244 } # Disagreement with companion, what now?
					}
					5 = {
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_friendship
						}
						modifier = {
							factor = 0
							NOT = {
								any_opinion_modifier_target = {
									has_opinion_modifier = {
										who = ROOT
										modifier = hunting_dragons_together
									}
									NOT = {
										any_friend = {
											character = ROOT
										}
									}
								}
							}
						}
						random_opinion_modifier_target = {
							limit = {
								has_opinion_modifier = {
									who = ROOT
									modifier = hunting_dragons_together
								}
								NOT = {
									any_friend = {
										character = ROOT
									}
								}
							}
							save_event_target_as = friendship_target
						}
						set_character_flag = dragonslaying_friendship
						character_event = { id = tianxia.248 } # Budding friendship?
					}
					5 = {
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_lover
						}
						modifier = {
							factor = 0
							NOT = {
								any_opinion_modifier_target = {
									has_opinion_modifier = {
										who = ROOT
										modifier = hunting_dragons_together
									}
									NOR = {
										any_lover = {
											character = ROOT
										}
										trait = celibate
										is_pregnant = yes
									}
									attacted_to_root_trigger = yes # Vanilla typo!
									ROOT = {
										attacted_to_prev_trigger = yes # Vanilla typo!
									}
								}
							}
						}
						modifier = {
							factor = 0
							trait = celibate
						}
						modifier = {
							factor = 0
							is_pregnant = yes
						}
						set_character_flag = dragonslaying_lover
						random_opinion_modifier_target = {
							limit = {
								has_opinion_modifier = {
									who = ROOT
									modifier = hunting_dragons_together
								}
								NOR = {
									any_lover = {
										character = ROOT
									}
									trait = celibate
									is_pregnant = yes
								}
								attacted_to_root_trigger = yes # Vanilla typo!
								ROOT = {
									attacted_to_prev_trigger = yes # Vanilla typo!
								}
							}
							save_event_target_as = lover_target
						}
						character_event = { id = tianxia.249 } # Tumble travelling companion?
					}
					1 = {
						# Supernatural events will be on if Fredak has been spawned, and the AI will only get this chain if the AI can get supernatural stuff
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_mabs_offer
						}
						modifier = {
							factor = 0
							OR = {
								has_character_flag = mabs_boon
								has_character_flag = mabs_curse
							}
						}
						modifier = {
							factor = 0.1
							NOT= {
								culture_group = celtic
							}
						}
						set_character_flag = dragonslaying_mabs_offer
						narrative_event = { id = tianxia.255 } # The Queen of Air and Darkness has an offer to make...
					}
					5 = {
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_devastation
						}
						set_character_flag = dragonslaying_devastation
						character_event = { id = tianxia.261 } # Devastation might make people have second thoughts
					}
					1 = { # Extremely good if successful, thus rarer...
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_dodecahedron
						}
						modifier = {
							factor = 2
							trait = gamer
						}
						set_character_flag = dragonslaying_dodecahedron
						character_event = { id = tianxia.262 } # Spot the dodecahedron
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_assassin
						}
						modifier = {
							factor = 0
							NOT = {
								any_rival = {
									is_adult = yes
									prisoner = no
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
						random_rival = {
							limit = {
								is_adult = yes
								prisoner = no
								is_inaccessible_or_incapable_trigger = no
							}
							preferred_limit = {
								is_landed = yes
							}
							save_event_target_as = dragonslayer_assassin_sender
						}
						set_character_flag = dragonslaying_assassin
						event_target:dragonslayer_assassin_sender = {
							character_event = { id = tianxia.273 } # Send an assassin?
						}
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_old_ruins
						}
						set_character_flag = dragonslaying_old_ruins
						character_event = { id = tianxia.287 } # Old ruins discovered by the road
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_merchant
						}
						set_character_flag = dragonslaying_merchant
						character_event = { id = tianxia.319 } # Merchant selling advice - buy some?
					}
					5 = {
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_preacher
						}
						set_character_flag = dragonslaying_preacher
						character_event = { id = tianxia.330 } # Preacher suggests conversion
					}
					50 = { # High chance of happening as we ideally want there to be at least one dragonslayer around
						modifier = {
							factor = 0
							has_character_flag = dragonslaying_recruited_dragonslayer
						}
						set_character_flag = dragonslaying_recruited_dragonslayer
						character_event = { id = tianxia.101 } # Dragonslayer selection
					}
					25 = { # High chance of happening as we ideally want there to be multiple dragonslayers around
						modifier = {
							factor = 0.1
							has_character_flag = dragonslaying_recruited_dragonslayer_2
						}
						modifier = {
							factor = 0
							NOT = {
								has_character_flag = dragonslaying_recruited_dragonslayer
							}
						}
						set_character_flag = dragonslaying_recruited_dragonslayer_2
						character_event = { id = tianxia.101 } # Dragonslayer selection
					}
					10 = {
						modifier = {
							factor = 0
							NOT = {
								trait = stressed
							}
						}
						set_character_flag = dragonslaying_lose_stressed
						character_event = { id = tianxia.131 } # Relaxing journey - lose Stressed
					}
					5 = {
						modifier = {
							factor = 0
							trait = wroth
						}
						set_character_flag = dragonslaying_are_we_there_yet
						character_event = { id = tianxia.132 } # Impatient to get to the destination
					}
					10 = {
						modifier = {
							factor = 0
							trait = uncouth
						}
						set_character_flag = dragonslaying_dirty
						character_event = { id = tianxia.133 } # Hard to stay clean on the road
					}
					10 = {
						modifier = {
							factor = 0
							lifestyle_traits = 1
						}
						set_character_flag = dragonslaying_hunter
						character_event = { id = tianxia.134 } # Is hunting my thing?
					}
					5 = {
						modifier = {
							factor = 0
							trait = stubborn
						}
						set_character_flag = dragonslaying_stubborn
						character_event = { id = tianxia.135 } # How important is this, really?
					}
					10 = {
						modifier = {
							factor = 0
							trait = greedy
						}
						set_character_flag = dragonslaying_greed
						character_event = { id = tianxia.136 } # The treasures at the end will be nice, right?
					}
					5 = {
						modifier = {
							factor = 0
							lifestyle_traits = 1
						}
						set_character_flag = dragonslaying_gamer
						character_event = { id = tianxia.137 } # Playing games on the road
					}
					5 = {
						modifier = {
							factor = 0
							lifestyle_traits = 1
						}
						set_character_flag = dragonslayer_strategist
						character_event = { id = tianxia.138 } # Planning battle strategy
					}
					5 = {
						modifier = {
							factor = 0
							lifestyle_traits = 1
						}
						set_character_flag = dragonslaying_duelist
						character_event = { id = tianxia.139 } # Weapon practice on the road
					}
					5 = {
						modifier = {
							factor = 0
							trait = slothful
						}
						set_character_flag = dragonslaying_taking_your_time
						character_event = { id = tianxia.140 } # Taking it slow
					}
					# - Travel takes you to interesting places - lose depressed
					25 = {
						# Just keep on going
						hidden_tooltip = {
							change_variable = {
								which = dragons_lair_travel_progress
								value = 1
							}
							character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
						}
					}
				}
			}
		}
	}
}

### Rival party

# Spot the rival party - fight or not?
character_event = {
	id = tianxia.205
	desc = EVTDESC_TIANXIA_205
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_205 # Challenge the leader!
		
		event_target:rival_dragonslayer = {
			set_character_flag = dragonslaying_rival_dragonslayer
			character_event = { id = tianxia.206 } # Dragonslayer is challenged
		}
		
		ai_chance = {
			factor = 0.01
			modifier = {
				factor = 0
				OR = {
					trait = craven
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				event_target:rival_dragonslayer = {
					OR = {
						any_lover = {
							character = ROOT
						}
						any_friend = {
							character = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					combat_rating_diff = {
						who = event_target:rival_dragonslayer
						value >= 1
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					combat_rating_diff = {
						character = event_target:rival_dragonslayer
						value >= -25
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_205 # Sneak into their camp and attempt an assassination
		
		piety = -100
		
		event_target:rival_dragonslayer = {
			set_character_flag = dragonslaying_rival_dragonslayer
			random_list = {
				10 = {
					modifier = {
						factor = 0
						ai = no
					}
					modifier = {
						factor = 0
						intrigue = 20
					}
					modifier = {
						factor = 0.01
						intrigue = 10
					}
					modifier = {
						factor = 0
						attribute_diff = {
							character = ROOT
							attribute = intrigue
							value >= 10
						}
					}
					character_event = { id = tianxia.212 days = 1 } # Target is killed in their sleep
				}
				25 = {
					modifier = {
						factor = 0.1
						intrigue = 10
					}
					modifier = {
						factor = 0
						attribute_diff = {
							character = ROOT
							attribute = intrigue
							value >= 5
						}
					}
					character_event = { id = tianxia.214 days = 1 } # Target is wounded by initial strike
				}
				50 = {
					character_event = { id = tianxia.216 days = 1 } # Target wakes up early
				}
				10 = {
					modifier = {
						factor = 0.1
						NOT = {
							intrigue = 20
						}
					}
					modifier = {
						factor = 0
						NOT = {
							intrigue = 10
						}
					}
					modifier = {
						factor = 0
						attribute_diff = {
							character = ROOT
							attribute = intrigue
							value <= -5
						}
					}
					character_event = { id = tianxia.218 days = 1 } # Target set a counter-ambush
				}
				5 = {
					modifier = {
						factor = 0
						ROOT = {
							ai = no
						}
					}
					modifier = {
						factor = 0.1
						NOT = {
							intrigue = 25
						}
					}
					modifier = {
						factor = 0
						NOT = {
							intrigue = 15
						}
					}
					modifier = {
						factor = 0
						attribute_diff = {
							character = ROOT
							attribute = intrigue
							value <= -10
						}
					}
					character_event = { id = tianxia.220 days = 1 } # Counter-ambush critically succeeds
				}
			}
		}
		
		if = {
			limit = {
				trait = just
			}
			remove_trait = just
		}
		else = {
			add_trait = arbitrary
		}
		if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
		}
		else = {
			add_trait = deceitful
		}
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		else = {
			add_trait = cruel
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.01
				OR = {
					trait = brave
					trait = honest
				}
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 0
				event_target:rival_dragonslayer = {
					OR = {
						any_lover = {
							character = ROOT
						}
						any_friend = {
							character = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					attribute_diff = {
						character = event_target:rival_dragonslayer
						attribute = intrigue
						value >= -5
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_205 # Just keep on travelling
		
		piety = 25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 30 random = 15 } # Back to main travel event; you get a speed boost
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:rival_dragonslayer = {
					any_rival = {
						character = ROOT
					}
				}
				NOR = {
					trait = craven
					trait = patient
					trait = kind
				}
			}
		}
	}
}

# Rival is challenged - fight or flight?
character_event = {
	id = tianxia.206
	desc = EVTDESC_TIANXIA_206
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_206 # A challenge? I accept!
		
		character_event = { id = tianxia.211 } # Fight!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_206 # Discretion is the better part of valor...
		
		
		# It is still attempted murder...
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					any_artifact = {
						has_flag = dragonslayer
					}
				}
				character_event = { id = tianxia.207 } # Left something behind...
			}
			else = {
				character_event = { id = tianxia.209 } # Ran away, but lost some time hiding
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0.1
				NOT = {
					combat_rating_diff = {
						who = FROM
						value >= 1
					}
				}
			}
			modifier = {
				factor = 0
				NOT = {
					combat_rating_diff = {
						character = FROM
						value >= -25
					}
				}
			}
		}
	}
}

# Rival flees but forgot something - rival
character_event = {
	id = tianxia.207
	desc = EVTDESC_TIANXIA_207
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_artifact = {
			limit = {
				has_flag = dragonslayer
			}
			save_event_target_as = lost_artifact
		}
	}
	
	option = {
		name = EVTOPTA_TIANXIA_207 # Curses!
		FROMFROM = {
			character_event = { id = tianxia.208 } # FROMFROM discovers the artifact
		}
		if = {
			limit = {
				NOT = {
					any_rival = {
						character = FROMFROM
					}
				}
			}
			add_rival = FROMFROM
		}
	}
}

# Artifact found
character_event = {
	id = tianxia.208
	desc = EVTDESC_TIANXIA_208
	picture = GFX_evt_relic_box
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_208 # This was a great idea!
		event_target:lost_artifact = {
			transfer_artifact = {
				from = FROM
				to = ROOT
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Rival fled - rival
character_event = {
	id = tianxia.209
	desc = EVTDESC_TIANXIA_209
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_209 # At least I'm alive...
		
		FROMFROM = {
			character_event = { id = tianxia.210 } # FROMFROM is unable to find ROOT
		}
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = -2
			}
		}
		
		if = {
			limit = {
				NOT = {
					any_rival = {
						character = FROMFROM
					}
				}
			}
			add_rival = FROMFROM
		}
		
		if = {
			limit = {
				NOT = {
					trait = brave
				}
			}
			random = {
				chance = 33
				add_trait = craven
			}
		}
		else = {
			random = {
				chance = 33
				remove_trait = brave
			}
		}
	}
}

# FROM fled
character_event = {
	id = tianxia.210
	desc = EVTDESC_TIANXIA_210
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_210 # Hopefully this means FROM won't reach the lair ahead of me!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Duel
character_event = {
	id = tianxia.211
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		save_event_target_as = combatant_1
		set_character_flag = flag_duel_no_draws # To the death!
		FROM = {
			save_event_target_as = combatant_2
		}
		character_event = {	id = HFP.10100 } # The duel is fought!
		clr_character_flag = flag_duel_no_draws
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassinated in your sleep - target
character_event = {
	id = tianxia.212
	desc = EVTDESC_TIANXIA_212
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_212 # Do not want!
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
		FROM = {
			character_event = { id = tianxia.213 } # Inform FROM
		}
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			death = {
				death_reason = death_murder_unknown
				killer = FROM
			}
		}
	}
}

# Assassinated them in their sleep - attacker
character_event = {
	id = tianxia.213
	desc = EVTDESC_TIANXIA_213
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_213 # Got you!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Target wounded non-fatally - target!
character_event = {
	id = tianxia.214
	desc = EVTDESC_TIANXIA_214
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_214 # You'll pay for this!
		
		add_trait = wounded
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_trait = wounded
		}
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		FROM = {
			character_event = { id = tianxia.215 }
		}
	}
}

# Target wounded non-fatally - attacker!
character_event = {
	id = tianxia.215
	desc = EVTDESC_TIANXIA_215
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_215 # You're already bleeding!
		
		character_event = { id = tianxia.211 } # Duel!
	}
}

# Target woke up early - target
character_event = {
	id = tianxia.216
	desc = EVTDESC_TIANXIA_216
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_216 # I am a light sleeper!
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		FROM = {
			character_event = { id = tianxia.217 }
		}
	}
}

# Target woke up early - attacker!
character_event = {
	id = tianxia.217
	desc = EVTDESC_TIANXIA_217
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_217 # I will still kill you!
		
		character_event = { id = tianxia.211 } # Duel!
	}
}

# Target set a counter-ambush - target
character_event = {
	id = tianxia.218
	desc = EVTDESC_TIANXIA_218
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_218 # I knew I heard something!
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		FROM = {
			character_event = { id = tianxia.219 }
		}
	}
}

# Target set a counter-ambush - attacker!
character_event = {
	id = tianxia.219
	desc = EVTDESC_TIANXIA_219
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_219 # I can still fight!
		
		add_trait = wounded
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_trait = wounded
		}
		
		character_event = { id = tianxia.211 } # Duel!
	}
}

# Critical success on counter-ambush - target
character_event = {
	id = tianxia.220
	desc = EVTDESC_TIANXIA_220
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_220 # And so you die!
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		FROM = {
			character_event = { id = tianxia.221 }
		}
	}
}

# Critical success on counter-ambush - attacker!
character_event = {
	id = tianxia.221
	desc = EVTDESC_TIANXIA_221
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_221 # Do not want!
		
		death = {
			death_reason = death_battle
			killer = FROM
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			death = {
				death_reason = death_battle
				killer = FROM
			}
		}
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
	}
}

### Pray at shrine?

# Hear of a nearby shrine - head to it to pray?
character_event = {
	id = tianxia.222
	desc = EVTDESC_TIANXIA_222
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_222 # Yes!
		
		random_list = {
			20 = {
				character_event = { id = tianxia.223 days = 1 random = 3 } # Praying goes well - gain Zealous or a lot of piety
			}
			20 = {
				character_event = { id = tianxia.224 days = 1 random = 3 } # Praying goes well - gain some piety
			}
			20 = {
				character_event = { id = tianxia.225 days = 1 random = 3 } # Neutral outcome
			}
			20 = {
				character_event = { id = tianxia.226 days = 1 random = 3 } # Praying goes poorly - lose some piety
			}
			20 = {
				character_event = { id = tianxia.227 days = 1 random = 3 } # Praying goes poorly - gain Cynical or lose a lot of piety
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cynical
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_222 # No!
		
		piety = -50
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = zealous
			}
		}
	}
}

# Praying goes extremely well
character_event = {
	id = tianxia.223
	desc = EVTDESC_TIANXIA_223
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_223 # I will kill the dragon for Highgod!
		
		random_list = {
			50 = {
				piety = 100
			}
			50 = {
				modifier = {
					factor = 0
					trait = zealous
				}
				if = {
					limit = {
						NOT = {
							trait = cynical
						}
					}
					random = {
						chance = 50
						add_trait = zealous
					}
				}
				else = {
					random = {
						chance = 50
						remove_trait = zealous
					}
				}
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Praying goes well
character_event = {
	id = tianxia.224
	desc = EVTDESC_TIANXIA_224
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_224 # That made me feel better!
		
		piety = 50
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Praying neutral
character_event = {
	id = tianxia.225
	desc = EVTDESC_TIANXIA_225
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_225 # Not sure anything happened...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Praying goes poorly
character_event = {
	id = tianxia.226
	desc = EVTDESC_TIANXIA_226
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_226 # This was a waste of time...
		
		piety = -25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Praying goes extremely poorly
character_event = {
	id = tianxia.227
	desc = EVTDESC_TIANXIA_227
	picture = GFX_evt_tribal_shrine
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_226 # Highgod is dead!
		
		random_list = {
			50 = {
				piety = -100
			}
			50 = {
				modifier = {
					factor = 0
					trait = cynical
				}
				if = {
					limit = {
						NOT = {
							trait = zealous
						}
					}
					random = {
						chance = 50
						add_trait = cynical
					}
				}
				else = {
					random = {
						chance = 50
						remove_trait = zealous
					}
				}
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Tumbling opportunity

# Spot someone good-looking in a village - tumble?
character_event = {
	id = tianxia.228
	desc = EVTDESC_TIANXIA_228
	picture = GFX_evt_market
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		2861 = { # Chang'an
			persistent_event_target:dragons_lair_province = {
				random_province = {
					limit = {
						has_owner = yes
						NOT = {
							distance = {
								where = PREV
								value = 500
							}
						}
					}
					save_event_target_as = lover_province
				}
			}
		}
		if = {
			limit = {
				is_female = no
				NOT = {
					trait = homosexual
				}
			}
			create_character = {
				age = 17
				female = yes
				dynasty = none
				culture = event_target:lover_province
				religion = event_target:lover_province
				random_traits = yes
				trait = fair
				trait = lustful
				trait = kind
				trait = charismatic_negotiator
				attributes = {
					intrigue = 5
					stewardship = 3
					learning = 1
					martial = 2
					diplomacy = 4
				}
			}
			new_character = {
				remove_trait = homosexual
				remove_trait = celibate
			}
		}
		else_if = {
			limit = {
				is_female = yes
				trait = homosexual
			}
			create_character = {
				age = 17
				female = yes
				dynasty = none
				culture = event_target:lover_province
				religion = event_target:lover_province
				random_traits = yes
				trait = fair
				trait = lustful
				trait = kind
				trait = charismatic_negotiator
				trait = homosexual
				attributes = {
					intrigue = 5
					stewardship = 3
					learning = 1
					martial = 2
					diplomacy = 4
				}
			}
			new_character = {
				remove_trait = celibate
			}
		}
		else_if = {
			limit = {
				is_female = no
				trait = homosexual
			}
			create_character = {
				age = 17
				female = no
				dynasty = none
				culture = event_target:lover_province
				religion = event_target:lover_province
				random_traits = yes
				trait = fair
				trait = lustful
				trait = kind
				trait = charismatic_negotiator
				remove_trait = homosexual
				attributes = {
					intrigue = 5
					stewardship = 3
					learning = 1
					martial = 2
					diplomacy = 4
				}
			}
			new_character = {
				remove_trait = celibate
			}
		}
		else_if = {
			limit = {
				is_female = yes
				NOT = {
					trait = homosexual
				}
			}
			create_character = {
				age = 17
				female = no
				dynasty = none
				culture = event_target:lover_province
				religion = event_target:lover_province
				random_traits = yes
				trait = fair
				trait = lustful
				trait = kind
				trait = charismatic_negotiator
				attributes = {
					intrigue = 5
					stewardship = 3
					learning = 1
					martial = 2
					diplomacy = 4
				}
			}
			new_character = {
				remove_trait = homosexual
				remove_trait = celibate
			}
		}
		new_character = {
			save_event_target_as = potential_lover
		}
	}
	
	option = {
		name = EVTOPTA_TIANXIA_228 # How about you and I...?
		character_event = { id = tianxia.229 days = 1 }
		event_target:potential_lover = {
			save_event_target_as = sex_partner
			hidden_tooltip = {
				random = {
					chance = 5
					add_trait = lovers_pox # Hidden so that the player can't check it beforehand
				}
			}
		}
		
		piety = -25
		
		if = {
			limit = {
				trait = chaste
			}
			remove_trait = chaste
		}
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				has_character_modifier = mourning_celibate
			}
			remove_character_modifier = mourning_celibate
		}
		
		unprotected_sex_effect_event_target = yes
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				any_spouse = {
					any_lover = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				any_consort = {
					any_lover = {
						character = ROOT
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_228 # I'll just be on my way...
		
		prestige = -10
		
		event_target:potential_lover = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Post-tumbling - recruit them as a dragonslayer, send them to your court, or send them away?
character_event = {
	id = tianxia.229
	desc = EVTDESC_TIANXIA_229
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_229 # You should come with me!
		
		event_target:potential_lover = {
			add_lover = ROOT
			add_trait = hunting_dragons
			opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
			set_character_flag = dragonslayer_wannabe
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				event_target:potential_lover = {
					is_female = yes
				}
				ROOT = {
					NOR = {
						is_female = yes
						primary_title = {
							has_law = status_of_women_4
						}
						has_religion_feature = religion_matriarchal
						has_religion_feature = religion_equal
						has_religion_feature = religion_feature_bon
						has_religion_feature = religion_feature_ryukyuan_historical
						has_religion_feature = religion_feature_ryukyuan_three_mountains
					}
				}
			}
			modifier = {
				factor = 0
				event_target:potential_lover = {
					is_female = no
				}
				ROOT = {
					is_female = yes
					has_religion_feature = religion_matriarchal
				}
			}
			modifier = {
				factor = 0
				event_target:potential_lover = {
					is_female = yes
				}
				ROOT = {
					is_female = no
					has_religion_feature = religion_patriarchal
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_229 # There's a place for you at in court
		
		event_target:potential_lover = {
			add_lover = ROOT
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = cruel
			}
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_229 # Silly boy/girl; this was just a one-time thing!
		
		event_target:potential_lover = {
			add_rival = ROOT
			hidden_tooltip = {
				remove_trait = kind
				add_trait = deceitful
				add_trait = cynical
			}
			leave_court_effect = yes
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 100
				trait = cruel
			}
			modifier = {
				factor = 0.1
				trait = humble
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Bandit attack

# Spot bandits - stop them, leave the area, or join them?
character_event = {
	id = tianxia.230
	desc = EVTDESC_TIANXIA_230
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_230 # Begone, foul knaves!
		
		random_list = {
			33 = {
				modifier = {
					factor = 0
					NOT = {
						martial = 8
					}
				}
				character_event = { id = tianxia.231 days = 1 } # Fight goes well
			}
			34 = {
				character_event = { id = tianxia.232 days = 1 } # Wounded
			}
			34 = {
				modifier = {
					factor = 0
					martial = 16
				}
				character_event = { id = tianxia.233 days = 1 } # Maimed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0
				trait = cruel # There's another, more fun, option...
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_230 # Time for me to leave...
		
		prestige = -25
		piety = -25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_230 # I know a thing or two about raiding villages...
		
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		else = {
			add_trait = cruel
		}
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		else = {
			add_trait = greedy
		}
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					NOT = {
						martial = 8
					}
				}
				character_event = { id = tianxia.234 days = 1 } # Fight goes well
			}
			25 = {
				character_event = { id = tianxia.235 days = 1 } # Wounded
			}
			25 = {
				modifier = {
					factor = 0
					martial = 16
				}
				character_event = { id = tianxia.236 days = 1 } # Maimed
			}
			25 = {
				modifier = {
					factor = 0
					martial = 12
				}
				character_event = { id = tianxia.237 days = 1 } # Killed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
			modifier = {
				factor = 0
				NOT = {
					trait = cruel
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				trait = charitable
			}
			modifier = {
				factor = 10
				trait = greedy
			}
		}
	}
}

# Fight bandits - everything goes well
character_event = {
	id = tianxia.231
	desc = EVTDESC_TIANXIA_231
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_231 # We sure showed them!
		
		prestige = 50
		piety = 50
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Fight bandits - wounded
character_event = {
	id = tianxia.232
	desc = EVTDESC_TIANXIA_232
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_232 # A difficult battle, to be sure, but we still won...
		
		prestige = 20
		piety = 20
		
		add_trait = wounded
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_trait = wounded
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Fight bandits - maimed
character_event = {
	id = tianxia.233
	desc = EVTDESC_TIANXIA_233
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_233 # Ow!
		
		prestige = 10
		piety = 10
		
		add_maimed_trait_effect = yes
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_maimed_trait_effect = yes
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Join bandits - everything goes well
character_event = {
	id = tianxia.234
	desc = EVTDESC_TIANXIA_234
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_234 # Look at them burn!
		
		prestige = 50
		piety = -50
		wealth = 100
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Join bandits - wounded
character_event = {
	id = tianxia.235
	desc = EVTDESC_TIANXIA_235
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_235 # Those wretched peasants dared to fight back?
		
		prestige = 25
		piety = -50
		wealth = 100
		
		add_trait = wounded
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_trait = wounded
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Join bandits - maimed
character_event = {
	id = tianxia.236
	desc = EVTDESC_TIANXIA_236
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_236 # They dared to hurt ME?
		
		prestige = -25
		piety = -50
		wealth = 100
		
		add_maimed_trait_effect = yes
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			add_maimed_trait_effect = yes
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Join bandits - killed
character_event = {
	id = tianxia.237
	desc = EVTDESC_TIANXIA_237
	picture = GFX_evt_bandits
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_237 # Not like this?
		
		prestige = -100
		piety = -50
		
		death = {
			death_reason = death_battle
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = Root
					modifier = hunting_dragons_together
				}
			}
			death = {
				death_reason = death_battle
			}
		}
	}
}

### Legend - stay a while and listen?

# A wild storyteller appeared!
character_event = {
	id = tianxia.238
	desc = EVTDESC_TIANXIA_238
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_238 # Stay a while and listen
		
		random_list = {
			20 = {
				modifier = {
					factor = 0
					NOT = {
						learning = 8
					}
				}
				character_event = { id = tianxia.239 days = 1 } # Actually good advice, and you know how to act on it!
			}
			20 = {
				modifier = {
					factor = 0
					learning = 12
				}
				character_event = { id = tianxia.240 days = 1  } # Actually good advice, but you don't quite know how to act on it!
			}
			20 = {
				character_event = { id = tianxia.241 days = 1  } # Just an interesting story
			}
			20 = {
				modifier = {
					factor = 0
					NOT = {
						learning = 4
					}
				}
				character_event = { id = tianxia.242 days = 1  } # Terrible advice, and you catch on!
			}
			20 = {
				modifier = {
					factor = 0
					learning = 16
				}
				character_event = { id = tianxia.243 days = 1  } # Terrible advice, and you don't catch on!
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = patient
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_238 # Boring!
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = patient
			}
		}
	}
}

# Good advice - you know how to act on it!
character_event = {
	id = tianxia.239
	desc = EVTDESC_TIANXIA_239
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_239 # "Dont stand in the fire!"? Well, that seems simple enough...
		
		set_character_flag = dragonslayer_legend_great_advice
		prestige = 100
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Good advince - you don't know how to act on it!
character_event = {
	id = tianxia.240
	desc = EVTDESC_TIANXIA_240
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_240 # What do you mean, "Don't stand in the fire!"?
		
		set_character_flag = dragonslayer_legend_good_advice
		prestige = 25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Just an interesting story
character_event = {
	id = tianxia.241
	desc = EVTDESC_TIANXIA_241
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_241 # Well, at least it wasn't boring...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Bad advince - you catch on!
character_event = {
	id = tianxia.242
	desc = EVTDESC_TIANXIA_242
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_242 # I don't think "Stand in the fire!" is the right plan...
		
		set_character_flag = dragonslayer_legend_bad_advice
		prestige = -25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Bad advice - you don't catch on!
character_event = {
	id = tianxia.243
	desc = EVTDESC_TIANXIA_243
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_243 # "Stand in the fire!"? Seems legit!
		
		set_character_flag = dragonslayer_legend_terrible_advice
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Disagreement with recruited dragonslayer

# You and one of your companions disagree about something - what do you do?
character_event = {
	id = tianxia.244
	desc = EVTDESC_TIANXIA_244
	picture = GFX_evt_poke_king_in_chest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			diplomacy = 16
		}
		name = EVTOPTA_TIANXIA_244 # Luckily I knew just what to say!
		
		prestige = 25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			NOT = {
				diplomacy = 16
			}
		}
		name = EVTOPTB_TIANXIA_244 # Perhaps I phrased that poorly...
		
		random_list = {
			25 = {
				modifier = {
					factor = 2
					diplomacy = 12
				}
				modifier = {
					factor = 2
					trait = gregarious
				}
				modifier = {
					factor = 2
					trait = socializer
				}
				modifier = {
					factor = 0.1
					trait = shy
				}
				character_event = { id = tianxia.245 days = 1 } # Smooth over the misunderstanding
			}
			50 = {
				character_event = { id = tianxia.246 days = 1 } # Dragonslayer remains upset
			}
			25 = {
				modifier = {
					factor = 2
					NOT = {
						diplomacy = 6
					}
				}
				modifier = {
					factor = 2
					trait = stubborn
				}
				modifier = {
					factor = 2
					trait = cruel
				}
				modifier = {
					factor = 2
					trait = wroth
				}
				character_event = { id = tianxia.247 days = 1 } # Rivalry/end of friendship/stop being lovers
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = stubborn
			}
			modifier = {
				factor = 0
				trait = proud
			}
			modifier = {
				factor = 0
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				diplomacy = 16
			}
		}
		name = EVTOPTC_TIANXIA_244 # Why don't you just leave?
		
		prestige = -25
		
		event_target:disagreement_target = {
			leave_court_effect = yes
			remove_trait = hunting_dragons
			remove_opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
			if = {
				limit = {
					any_friend = {
						character = ROOT
					}
				}
				remove_friend = ROOT
			}
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = humble
			}
			modifier = {
				factor = 10
				trait = wroth
			}
		}
	}
}

# You smooth things over
character_event = {
	id = tianxia.245
	desc = EVTDESC_TIANXIA_245
	picture = GFX_evt_rider_adventure # Might be worth replacing if there are better options
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_245 # Good enough...
		
		prestige = 10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Things get a little better
character_event = {
	id = tianxia.246
	desc = EVTDESC_TIANXIA_246
	picture = GFX_evt_bad_news
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_246 # Let's just put this behind us...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Things don't go exactly as planned
character_event = {
	id = tianxia.247
	desc = EVTDESC_TIANXIA_247
	picture = GFX_evt_poke_king_in_chest
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_247 # I hate you too!
		
		prestige = -25
		if = {
			limit = {
				event_target:disagreement_target = {
					NOR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
			}
			event_target:disagreement_target = {
				add_rival = ROOT
			}
		}
		else_if = {
			limit = {
				event_target:disagreement_target = {
					any_friend = {
						character = ROOT
					}
				}
			}
			event_target:disagreement_target = {
				remove_friend = ROOT
			}
		}
		else = {
			event_target:disagreement_target = {
				remove_lover = ROOT
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Budding friendship

# You and one of your companions are becoming friends
character_event = {
	id = tianxia.248
	desc = EVTDESC_TIANXIA_248
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_248 # We shall fight side by side!
		
		prestige = 10
		
		event_target:friendship_target = {
			add_friend = ROOT
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Tumbling (and potential romance)

# Attracted to a companion - attempt to tumble?
character_event = {
	id = tianxia.249
	desc = EVTDESC_TIANXIA_249
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_249 # How about you sleep in my tent tonight?
		
		piety = -10
		
		if = {
			limit = {
				trait = chaste
			}
			remove_trait = chaste
		}
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				has_character_modifier = mourning_celibate
			}
			remove_character_modifier = mourning_celibate
		}
		
		event_target:lover_target = {
			character_event = { id = tianxia.250 } # Potential tumble target gets to respond
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				any_spouse = {
					any_lover = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				any_consort = {
					any_lover = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				event_target:lover_target = {
					is_unattractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_249 # Best not to risk it...
		
		piety = 10
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0.1
				event_target:lover_target = {
					is_attractive_trigger = yes
				}
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Potential tumble target gets notified
character_event = {
	id = tianxia.250
	desc = EVTDESC_TIANXIA_250
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_250 # I don't see either of us doing a lot of sleeping...
		
		piety = -10
		
		if = {
			limit = {
				trait = chaste
			}
			remove_trait = chaste
		}
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		if = {
			limit = {
				has_character_modifier = mourning_celibate
			}
			remove_character_modifier = mourning_celibate
		}
		
		event_target:potential_lover = {
			save_event_target_as = sex_partner
		}
		unprotected_sex_effect_event_target = yes
		
		FROM = {
			character_event = { id = tianxia.251 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = chaste
			}
			modifier = {
				factor = 0
				trait = celibate
			}
			modifier = {
				factor = 0
				any_spouse = {
					any_lover = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				any_consort = {
					any_lover = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				FROM = {
					is_unattractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_250 # I don't think so...
		
		piety = 10
		
		FROM = {
			character_event = { id = tianxia.254 days = 1 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = lustful
			}
			modifier = {
				factor = 0.1
				FROM = {
					is_attractive_trigger = yes
				}
			}
		}
	}
}

# Tumbling - what's next?
character_event = {
	id = tianxia.251
	desc = EVTDESC_TIANXIA_251
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_251 # This must be love!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		add_lover = FROM
		
		FROM = {
			character_event = { id = tianxia.252 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_251 # I don't think it'll happen again...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		FROM = {
			character_event = { id = tianxia.253 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = humble
			}
			modifier = {
				factor = 10
				trait = cruel
			}
		}
	}
}

# Tumbled - lovers
character_event = {
	id = tianxia.252
	desc = EVTDESC_TIANXIA_252
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_252 # This must be love!
		
		add_lover = FROM
	}
}

# Tumbled - not lovers
character_event = {
	id = tianxia.253
	desc = EVTDESC_TIANXIA_253
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_253 # If you change your mind, you know where to find me...
	}
}

# Rebuffed
character_event = {
	id = tianxia.254
	desc = EVTDESC_TIANXIA_254
	picture = GFX_evt_campfire_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_254 # Women!/Men!
		
		prestige = -25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### An offer from the Queen of Air and Darkness

# The offer is made
narrative_event = {
	id = tianxia.255
	title = EVTTITLE_TIANXIA_255
	picture = GFX_evt_campfire_hf
	border = GFX_event_narrative_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		# Set up the price
		random_list = {
			20 = {
				# Memories
				modifier = {
					factor = 0
					OR = {
						trait = naive_appeaser
						trait = misguided_warrior
						trait = indulgent_wastrel
						trait = amateurish_plotter
						trait = detached_priest
					}
				}
				modifier = {
					factor = 2
					OR = {
						trait = charismatic_negotiator
						trait = skilled_tactician
						trait = fortune_builder
						trait = intricate_webweaver
						trait = scholarly_theologian
					}
				}
				modifier = {
					factor = 5
					OR = {
						trait = grey_eminence
						trait = brilliant_strategist
						trait = midas_touched
						trait = elusive_shadow
						trait = mastermind_theologian
					}
				}
				set_character_flag = mabs_price_memories
			}
			20 = {
				# An artifact
				modifier = {
					factor = 0
					NOT = {
						any_artifact = {
							NOT = {
								has_flag = dragonslayer
							}
							is_indestructible = no
						}
					}
				}
				modifier = {
					factor = 2
					any_artifact = {
						NOT = {
							has_flag = dragonslayer
						}
						is_indestructible = no
						quality == 3
					}
				}
				modifier = {
					factor = 5
					any_artifact = {
						NOT = {
							has_flag = dragonslayer
						}
						is_indestructible = no
						quality == 4
					}
				}
				modifier = {
					factor = 10
					any_artifact = {
						NOT = {
							has_flag = dragonslayer
						}
						is_indestructible = no
						quality == 5
					}
				}
				random_artifact = {
					limit = {
						NOT = {
							has_flag = dragonslayer
						}
						is_indestructible = no
					}
					save_event_target_as = mabs_price_artifact
				}
				set_character_flag = mabs_price_artifact
			}
			20 = {
				# Your firstborn
				modifier = {
					factor = 0
					NOT = {
						any_character = {
							ai = yes
							is_adult = no
							is_alive = yes
							OR = {
								mother = {
									character = ROOT
								}
								real_father = {
									character = ROOT
								}
							}
						}
					}
				}
				random_character = {
					limit = {
						ai = yes
						is_adult = no
						is_alive = yes
						OR = {
							mother = {
								character = ROOT
							}
							real_father = {
								character = ROOT
							}
						}
						NOT = {
							any_character = {
								is_older_than = PREV
								is_alive = yes
								OR = {
									mother = {
										character = ROOT
									}
									real_father = {
										character = ROOT
									}
								}
							}
						}
					}
					save_event_target_as = mabs_price_firstborn
				}
				set_character_flag = mabs_price_firstborn
			}
			20 = {
				# A few years off of your life
				modifier = {
					factor = 0
					NOT = {
						health = 5
					}
				}
				set_character_flag = mabs_price_health
			}
			20 = {
				# A lover
				modifier = {
					factor = 10
					any_spouse = {
						any_lover = {
							ai = yes
							character = ROOT
						}
					}
				}
				modifier = {
					factor = 5
					any_consort = {
						any_lover = {
							ai = yes
							character = ROOT
						}
					}
				}
				modifier = {
					factor = 0
					NOT = {
						any_lover = {
							ai = yes
						}
					}
				}
				random_lover = {
					limit = {
						ai = yes
					}
					preferred_limit = {
						any_spouse = {
							character = ROOT
						}
					}
					preferred_limit = {
						any_consort = {
							character = ROOT
						}
					}
					save_event_target_as = mabs_price_lover
				}
				set_character_flag = mabs_price_lover
			}
		}
	}
	
	desc = {
		trigger = {
			has_character_flag = mabs_price_memories
		}
		text = EVTDESC_TIANXIA_255_A
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_artifact
		}
		text = EVTDESC_TIANXIA_255_B
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_firstborn
		}
		text = EVTDESC_TIANXIA_255_C
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_health
		}
		text = EVTDESC_TIANXIA_255_D
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_lover
		}
		text = EVTDESC_TIANXIA_255_E
	}
	
	option = {
		name = EVTOPTA_TIANXIA_255 # No, thank you!
		
		narrative_event = { id = tianxia.256 days = 3 } # Again I will ask...
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = charitable
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				trait = scholar
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = physician
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_255 # This seems like a good deal!
		
		character_event = { id = tianxia.259 days = 1 } # Done, done, and done!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				NOR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = greedy
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = depressed
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_255 # BE GONE!
		
		custom_tooltip = {
			text = DRAW_STEEL
		}
		
		character_event = { id = tianxia.260 days = 1 } # You would wield cold iron (or steel) against MAB? FOOL!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = wroth
				}
			}
		}
	}
}

# Again I will ask...
narrative_event = {
	id = tianxia.256
	title = EVTTITLE_TIANXIA_255
	picture = GFX_evt_campfire_hf
	border = GFX_event_narrative_frame_intrigue
	
	is_triggered_only = yes
	
	desc = {
		trigger = {
			has_character_flag = mabs_price_memories
		}
		text = EVTDESC_TIANXIA_256_A
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_artifact
		}
		text = EVTDESC_TIANXIA_256_B
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_firstborn
		}
		text = EVTDESC_TIANXIA_256_C
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_health
		}
		text = EVTDESC_TIANXIA_256_D
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_lover
		}
		text = EVTDESC_TIANXIA_256_E
	}
	
	option = {
		name = EVTOPTA_TIANXIA_256 # Still not interested!
		
		narrative_event = { id = tianxia.257 days = 3 } # Thrice I ask and done...
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = charitable
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				trait = scholar
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = physician
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_255 # On second thought...
		
		character_event = { id = tianxia.259 days = 1 } # Done, done, and done!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = stubborn
			}
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				NOR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = greedy
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = depressed
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_255 # BE GONE!
		
		custom_tooltip = {
			text = DRAW_STEEL
		}
		
		character_event = { id = tianxia.260 } # You would wield cold iron (or steel) against MAB? FOOL!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = wroth
				}
			}
		}
	}
}

# Thrice I ask and done...
narrative_event = {
	id = tianxia.257
	title = EVTTITLE_TIANXIA_255
	picture = GFX_evt_campfire_hf
	border = GFX_event_narrative_frame_intrigue
	
	is_triggered_only = yes
	
	desc = {
		trigger = {
			has_character_flag = mabs_price_memories
		}
		text = EVTDESC_TIANXIA_257_A
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_artifact
		}
		text = EVTDESC_TIANXIA_257_B
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_firstborn
		}
		text = EVTDESC_TIANXIA_257_C
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_health
		}
		text = EVTDESC_TIANXIA_257_D
	}
	desc = {
		trigger = {
			has_character_flag = mabs_price_lover
		}
		text = EVTDESC_TIANXIA_257_E
	}
	
	option = {
		name = EVTOPTA_TIANXIA_257 # And thrice I shall refuse!
		
		character_event = { id = tianxia.258 days = 1 } # You have treated fairly; good luck on your journey!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				OR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = charitable
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				trait = scholar
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = physician
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_257 # Well, if you insist...
		
		character_event = { id = tianxia.259 days = 1 } # Done, done, and done!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = stubborn
			}
			modifier = {
				factor = 0
				OR = {
					has_character_flag = mabs_price_firstborn
					has_character_flag = mabs_price_lover
				}
				NOR = {
					trait = cruel
					trait = deceitful
				}
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_artifact
				trait = greedy
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_memories
				is_dumb_trigger = yes
			}
			modifier = {
				factor = 0
				has_character_flag = mabs_price_health
				trait = depressed
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_255 # BE GONE!
		
		custom_tooltip = {
			text = DRAW_STEEL
		}
		
		character_event = { id = tianxia.260 days = 1 } # You would wield cold iron (or steel) against MAB? FOOL!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = wroth
				}
			}
		}
	}
}

# Refused thrice
character_event = {
	id = tianxia.258
	desc = EVTDESC_TIANXIA_258
	picture = GFX_evt_matriarchy_throne_room
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_258 # I hope she won't return tomorrow...
		
		prestige = 100
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# The price is paid
character_event = {
	id = tianxia.259
	desc = EVTDESC_TIANXIA_259
	picture = GFX_evt_matriarchy_throne_room
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_259 # This had better be worth it!
		
		piety = -100
		
		set_character_flag = mabs_boon
		if = {
			limit = {
				has_character_flag = mabs_price_memories
			}
			# Diplomacy
			if = {
				limit = {
					trait = grey_eminence
				}
				remove_trait = grey_eminence
				add_trait = charismatic_negotiator
			}
			else_if = {
				limit = {
					trait = charismatic_negotiator
				}
				remove_trait = charismatic_negotiator
				add_trait = underhanded_rogue
			}
			else_if = {
				limit = {
					trait = underhanded_rogue
				}
				remove_trait = underhanded_rogue
				add_trait = naive_appeaser
			}
			# Martial
			else_if = {
				limit = {
					trait = brilliant_strategist
				}
				remove_trait = brilliant_strategist
				add_trait = skilled_tactician
			}
			else_if = {
				limit = {
					trait = skilled_tactician
				}
				remove_trait = skilled_tactician
				add_trait = tough_soldier
			}
			else_if = {
				limit = {
					trait = tough_soldier
				}
				remove_trait = tough_soldier
				add_trait = misguided_warrior
			}
			# Stewardship
			else_if = {
				limit = {
					trait = midas_touched
				}
				remove_trait = midas_touched
				add_trait = fortune_builder
			}
			else_if = {
				limit = {
					trait = fortune_builder
				}
				remove_trait = fortune_builder
				add_trait = thrifty_clerk
			}
			else_if = {
				limit = {
					trait = thrifty_clerk
				}
				remove_trait = thrifty_clerk
				add_trait = indulgent_wastrel
			}
			# Intrigue
			else_if = {
				limit = {
					trait = elusive_shadow
				}
				remove_trait = elusive_shadow
				add_trait = intricate_webweaver
			}
			else_if = {
				limit = {
					trait = intricate_webweaver
				}
				remove_trait = intricate_webweaver
				add_trait = flamboyant_schemer
			}
			else_if = {
				limit = {
					trait = flamboyant_schemer
				}
				remove_trait = flamboyant_schemer
				add_trait = amateurish_plotter
			}
			# Learning
			else_if = {
				limit = {
					trait = mastermind_theologian
				}
				remove_trait = mastermind_theologian
				add_trait = scholarly_theologian
			}
			else_if = {
				limit = {
					trait = scholarly_theologian
				}
				remove_trait = scholarly_theologian
				add_trait = martial_cleric
			}
			else_if = {
				limit = {
					trait = martial_cleric
				}
				remove_trait = martial_cleric
				add_trait = detached_priest
			}
		}
		else_if = {
			limit = {
				has_character_flag = mabs_price_artifact
			}
			event_target:mabs_price_artifact = {
				destroy_artifact = yes
			}
		}
		else_if = {
			limit = {
				has_character_flag = mabs_price_firstborn
			}
			event_target:mabs_price_firstborn = {
				death = {
					death_reason = death_missing
				}
			}
		}
		else_if = {
			limit = {
				has_character_flag = mabs_price_health
			}
			health = -2
		}
		else_if = {
			limit = {
				has_character_flag = mabs_price_lover
			}
			event_target:mabs_price_lover = {
				remove_lover = ROOT
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Steel is drawn
character_event = {
	id = tianxia.260
	desc = EVTDESC_TIANXIA_260
	picture = GFX_evt_matriarchy_throne_room
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_260 # That felt... odd...
		
		set_character_flag = mabs_curse
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Devastation

# Is it time to turn around?
character_event = {
	id = tianxia.261
	desc = EVTDESC_TIANXIA_261
	picture = GFX_evt_burning_house
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_261 # I must continue!
		
		if = {
			limit = {
				trait = craven
			}
			remove_trait = craven
		}
		
		prestige = 50
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = brave
				}
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_261 # I should turn back...
		
		prestige = -50
		
		if = {
			limit = {
				trait = brave
			}
			remove_trait = brave
		}
		
		custom_tooltip = {
			text = RETURN_HOME
		}
		
		character_event = { id = tianxia.184 } # Flag cleanup
		character_event = { id = tianxia.185 days = 90 random = 30 } # Return home
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = craven
				}
			}
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

### Dodecahedron

# Spot the dodecahedron - approach or leave
character_event = {
	id = tianxia.262
	desc = EVTDESC_TIANXIA_262
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_262 # Approach it!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0
					intrigue = 16
				}
				modifier = {
					factor = 0.5
					trait = gamer
				}
				character_event = { id = tianxia.263 days = 1 } # Step on something triangular
			}
			50 = {
				character_event = { id = tianxia.264 days = 1 } # Hooded stranger
			}
			25 = {
				modifier = {
					factor = 2
					trait = gamer
				}
				character_event = { id = tianxia.272 days = 1 } # Dodecahedron is unattended
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = craven
			}
			modifier = {
				factor = 0
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_262 # This could be a trap of some kind...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = scholar
			}
			modifier = {
				factor = 0
				trait = gamer
			}
		}
	}
}

# Take 1d4 damage to your foot!
character_event = {
	id = tianxia.263
	desc = EVTDESC_TIANXIA_263
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_263 # Ow!
		
		add_trait = wounded
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Hooded stranger - reason with them, fight them, or leave?
character_event = {
	id = tianxia.264
	desc = EVTDESC_TIANXIA_264
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_264 # Surely a quick look couldn't hurt?
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						diplomacy = 16
					}
				}
				modifier = {
					factor = 0.1
					NOT = {
						diplomacy = 20
					}
				}
				modifier = {
					factor = 2
					trait = gregarious
				}
				character_event = { id = tianxia.265 days = 1 }
			}
			50 = {
				modifier = {
					factor = 2
					trait = stutter
				}
				modifier = {
					factor = 2
					trait = lisp
				}
				character_event = { id = tianxia.266 days = 1 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = gregarious
			}
			modifier = {
				factor = 0
				trait = shy
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_264 # You shall not stop me!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 50 # What are you even doing on here?
					}
				}
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # What are you even doing on here?
					}
				}
				character_event = { id = tianxia.267 days = 1 } # Win, and get the dodecahedron
			}
			25 = {
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 25 # What are you even doing on here?
					}
				}
				modifier = {
					factor = 0.5
					combat_rating = 50 # What are you even doing on here?
				}
				character_event = { id = tianxia.269 days = 1 } # Wounded, no dodecahedron
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 50
				}
				character_event = { id = tianxia.270 days = 1 } # Maimed, no dodecahedron
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 50 # What are you even doing on here?
				}
				modifier = {
					factor = 0.5
					combat_rating = 25 # What are you even doing on here?
				}
				character_event = { id = tianxia.271 days = 1 } # Killed, obviously no dodecahedron
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 0
				trait = kind
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_264 # Sorry to have bothered you!
		
		prestige = -25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# You convince them
character_event = {
	id = tianxia.265
	desc = EVTDESC_TIANXIA_265
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_265 # Such power!
		
		prestige = 25
		
		set_character_flag = fragment_of_possibility # Extremely good!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
	}
}

# They insist that you leave - comply or fight?
character_event = {
	id = tianxia.266
	desc = EVTDESC_TIANXIA_266
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_266 # You shall not stop me!
		
		random_list = {
			25 = {
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 50 # What are you even doing on here?
					}
				}
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # What are you even doing on here?
					}
				}
				character_event = { id = tianxia.268 days = 1 } # Win, and get the dodecahedron
			}
			25 = {
				modifier = {
					factor = 0.1
					NOT = {
						combat_rating = 25 # What are you even doing on here?
					}
				}
				modifier = {
					factor = 0.5
					combat_rating = 50 # What are you even doing on here?
				}
				character_event = { id = tianxia.269 days = 1 } # Wounded, no dodecahedron
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 50
				}
				character_event = { id = tianxia.270 days = 1 } # Maimed, no dodecahedron
			}
			25 = {
				modifier = {
					factor = 0
					combat_rating = 50 # What are you even doing on here?
				}
				modifier = {
					factor = 0.5
					combat_rating = 25 # What are you even doing on here?
				}
				character_event = { id = tianxia.271 days = 1 } # Killed, obviously no dodecahedron
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_266 # Sorry to have bothered you!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Fight goes well
character_event = {
	id = tianxia.267
	desc = EVTDESC_TIANXIA_267
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_267 # Such power!
		
		prestige = 50
		
		set_character_flag = fragment_of_possibility # Extremely good!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
	}
}

# Fight goes well, but no dodecahedron
character_event = {
	id = tianxia.268
	desc = EVTDESC_TIANXIA_268
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_268 # At least I prevailed...
		
		prestige = 25
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
	}
}

# Fight goes poorly - wounded
character_event = {
	id = tianxia.269
	desc = EVTDESC_TIANXIA_269
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_269 # Ow!
		
		prestige = -10
		add_trait = wounded
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
	}
}

# Fight goes poorly - maimed
character_event = {
	id = tianxia.270
	desc = EVTDESC_TIANXIA_270
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_270 # Curses!
		
		prestige = -25
		add_maimed_trait_effect = yes
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
	}
}

# Fight goes poorly - killed
character_event = {
	id = tianxia.271
	desc = EVTDESC_TIANXIA_271
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_271 # This encounter was poorly designed!
		
		prestige = -50
		
		death = {
			death_reason = death_battle
		}
	}
}

# Dodecahedron unattended
character_event = {
	id = tianxia.272
	desc = EVTDESC_TIANXIA_272
	picture = GFX_evt_powerful_tower
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_272 # Such power!
		
		prestige = 25
		
		set_character_flag = fragment_of_possibility # Extremely good!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Assassin

# Attempt to assassinate FROM?
character_event = {
	id = tianxia.273
	desc = EVTDESC_TIANXIA_273
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_273 # Yes!		
		
		piety = -50
		wealth = -100
		
		random_list = {
			33 = {
				modifier = {
					factor = 0
					FROM = {
						intrigue = 24
					}
				}
				modifier = {
					factor = 0.1
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 8
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 4
						}
					}
				}
				random_list = {
					50 = {
						FROM = {
							character_event = { id = tianxia.274 days = 1 } # Killed by assassin, unknown sender
						}
					}
					50 = {
						modifier = {
							factor = 2
							FROM = {
								intrigue = 20
							}
						}
						modifier = {
							factor = 2
							FROM = {
								intrigue = 25
							}
						}
						modifier = {
							factor = 2
							FROM = {
								intrigue = 30
							}
						}
						FROM = {
							character_event = { id = tianxia.275 days = 1 } # Killed by assassin, known sender
						}
					}
				}
			}
			34 = {
				random_list = {
					33 = {
						FROM = {
							character_event = { id = tianxia.277 days = 1 } # Wounded by assassin, assassin escapes
						}
					}
					34 = {
						FROM = {
							character_event = { id = tianxia.279 days = 1 } # Wounded by assassin, assassin dies
						}
					}
					33 = {
						modifier = {
							factor = 2
							FROM = {
								intrigue = 20
							}
						}
						modifier = {
							factor = 2
							FROM = {
								intrigue = 25
							}
						}
						modifier = {
							factor = 2
							FROM = {
								intrigue = 30
							}
						}
						FROM = {
							character_event = { id = tianxia.281 days = 1 } # Wounded by assassin, assassin talks before dying
						}
					}
				}
			}
			33 = {
				modifier = {
					factor = 5
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 16
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 8
						}
					}
				}
				modifier = {
					factor = 0
					FROM = {
						NOT = {
							intrigue = 4
						}
					}
				}
				random_list = {
					50 = {
						FROM = {
							character_event = { id = tianxia.283 days = 1 } # Kills assassin, no clue about sender
						}
					}
					50 = {
						modifier = {
							factor = 2
							FROM = {
								intrigue = 20
							}
						}
						modifier = {
							factor = 2
							FROM = {
								intrigue = 30
							}
						}
						FROM = {
							character_event = { id = tianxia.285 days = 1 } # Kills assassin, discovers sender
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				trait = just
			}
			remove_trait = just
		}
		else = {
			add_trait = arbitrary
		}
		if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
		}
		else = {
			add_trait = deceitful
		}
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		else = {
			add_trait = cruel
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = honest
					trait = kind
					trait = just
				}
				NOR = {
					trait = deceitful
					trait = cruel
					trait = arbitrary
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_273 # No!
		
		piety = 50
		prestige = -50
		
		FROM = {
			hidden_tooltip = {
				change_variable = {
					which = dragons_lair_travel_progress
					value = 1
				}
				character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = honest
					trait = kind
					trait = just
				}
				OR = {
					trait = deceitful
					trait = cruel
					trait = arbitrary
				}
			}
		}
	}
}

# Attacked by assassin - killed
character_event = {
	id = tianxia.274
	desc = EVTDESC_TIANXIA_274
	picture = GFX_evt_slit_throat_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_274 # So it ends...
		
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
		
		FROM = {
			character_event = { id = tianxia.276 } # Inform the sender
		}
	}
}

# Killed by assassin - assassin reveals the sender
character_event = {
	id = tianxia.275
	desc = EVTDESC_TIANXIA_275
	picture = GFX_evt_slit_throat_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_275 # Avenge me!
		
		death = {
			death_reason = death_murder
			killer = FROM
		}
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 10 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		
		FROM = {
			character_event = { id = tianxia.276 } # Inform the sender
		}
	}
}

# FROM died - inform the sender - clean up loose ends?
character_event = {
	id = tianxia.276
	desc = EVTDESC_TIANXIA_276
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_276 # You've served your purpose!
		
		prestige = -50
		
		if = {
			limit = {
				trait = just
			}
			remove_trait = just
		}
		else = {
			add_trait = arbitrary
		}
		if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
		}
		else = {
			add_trait = deceitful
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = deceitful
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_276 # And here's the second half!
		
		prestige = 50
		wealth = -100
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = deceitful
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
}

# Attacked by assassin - wounded, assassin escapes
character_event = {
	id = tianxia.277
	desc = EVTDESC_TIANXIA_277
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_277 # Who could have sent them?
		
		add_trait = wounded
		
		FROM = {
			character_event = { id = tianxia.278 } # Inform the sender
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassin reports back - clean up loose ends?
character_event = {
	id = tianxia.278
	desc = EVTDESC_TIANXIA_278
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_278 # You've failed me for the last time!
		
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		else = {
			add_trait = cruel
		}
		
		prestige = 25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = deceitful
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_278 # You disappoint me!
		
		prestige = -25
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = deceitful
					trait = arbitrary
					trait = cruel
				}
			}
		}
	}
}

# Attacked by assasin - wounded, assassin dies without talking
character_event = {
	id = tianxia.279
	desc = EVTDESC_TIANXIA_279
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_279 # Who could have sent them?
		
		add_trait = wounded
		
		FROM = {
			character_event = { id = tianxia.280 } # Inform the sender
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassin fails to report back, learn that FROM was wounded
character_event = {
	id = tianxia.280
	desc = EVTDESC_TIANXIA_280
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_280 # At least my involvement remains secret!
	}
}

# Attacked by assassin - wounded, assassin talks
character_event = {
	id = tianxia.281
	desc = EVTDESC_TIANXIA_281
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_281 # It was YOU!
		
		add_trait = wounded
		
		opinion = {
			who = FROM
			modifier = attempted_murder
		}
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 11 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		
		FROM = {
			character_event = { id = tianxia.282 } # Inform the sender
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassin fails to report back, learn that FROM was wounded and learned who sent the assassin
character_event = {
	id = tianxia.282
	desc = EVTDESC_TIANXIA_282
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_282 # Incompetent fool!
		
		prestige = -50
	}
}

# Assassin killed - unclear sender
character_event = {
	id = tianxia.283
	desc = EVTDESC_TIANXIA_283
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_283 # Who could have sent them?
		
		FROM = {
			character_event = { id = tianxia.284 } # Inform the sender
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassin fails to report back, learn that FROM wasn't wounded
character_event = {
	id = tianxia.284
	desc = EVTDESC_TIANXIA_284
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_284 # At least my involvement remains secret!
	}
}

# Assassin killed - reveals who sent them
character_event = {
	id = tianxia.285
	desc = EVTDESC_TIANXIA_285
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_285 # It was YOU!
		
		opinion = {
			who = FROM
			modifier = attempted_murder
		}
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 11 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		
		if = {
			limit = {
				FROM = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
			}
			if = {
				limit = {
					is_chinese_emperor_trigger = yes
				}
				FROM = {
					detract_grace_super_huge_effect = yes
				}
			}
			else_if = {
				limit = {
					any_close_relative = {
						dynasty = PREV
						is_chinese_emperor_trigger = yes
					}
				}
				FROM = {
					detract_grace_massive_effect = yes
				}
			}
		}
		
		FROM = {
			character_event = { id = tianxia.286 } # Inform the sender
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Assassin fails to report back, learn that FROM wasn't wounded and learned who sent the assassin
character_event = {
	id = tianxia.286
	desc = EVTDESC_TIANXIA_286
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_286 # Incompetent fool!
		
		prestige = -50
	}
}

### Old ruins

# Discovers entrance to old ruins - enter them?
character_event = {
	id = tianxia.287
	desc = EVTDESC_TIANXIA_287
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_287 # Investigate the ruins
		
		character_event = { id = tianxia.288 } # Select first obstacle
	}
	
	option = {
		name = EVTOPTB_TIANXIA_287 # This is an unnecessary delay...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = patient
			}
			modifier = {
				factor = 0.1
				trait = scholar
			}
		}
	}
}

# First obstacle selection
character_event = {
	id = tianxia.288
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			33 = {
				character_event = { id = tianxia.289 days = 1 } # Puzzle door
			}
			34 = {
				character_event = { id = tianxia.293 days = 1 } # Bandits
			}
			33 = {
				character_event = { id = tianxia.298 days = 1 } # Rock fall trap
			}
		}
	}
}

# Ruins - puzzle door (learning)
character_event = {
	id = tianxia.289
	desc = EVTDESC_TIANXIA_289
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_289 # Pick a random configuration and hope for the best
		
		random_list = {
			10 = {
				character_event = { id = tianxia.290 days = 1 }
				modifier = {
					factor = 2
					learning = 12
				}
				modifier = {
					factor = 2
					learning = 16
				}
			}
			90 = {
				character_event = { id = tianxia.292 days = 1 }
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				learning = 15
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		trigger = {
			learning = 20
		}
		
		name = EVTOPTB_TIANXIA_289 # Inspect the key
		
		character_event = { id = tianxia.291 days = 1 }
	}
	
	option = {
		name = EVTOPTC_TIANXIA_289 # Leave the ruins
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				learning = 15
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
}

# Got past the door
character_event = {
	id = tianxia.290
	desc = EVTDESC_TIANXIA_290
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_290 # A lucky guess, but it worked!
		
		prestige = 10
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}
	
# Got past the door - high learning
character_event = {
	id = tianxia.291
	desc = EVTDESC_TIANXIA_291
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_291 # Who puts the solution on the key?
		
		prestige = 50
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}

# Wounded, time to withdraw
character_event = {
	id = tianxia.292
	desc = EVTDESC_TIANXIA_292
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_292 # I can't risk getting injured again...
		
		add_trait = wounded
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Ruins - bandits (combat_rating)
character_event = {
	id = tianxia.293
	desc = EVTDESC_TIANXIA_293
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_293 # I can deal with some bandits!
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					combat_rating = 50
				}
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # Why are you even here?
					}
				}
				character_event = { id = tianxia.294 days = 1 } # Deafeated the bandits with ease
			}
			25 = {
				modifier = {
					factor = 0.2
					combat_rating = 50
				}
				character_event = { id = tianxia.295 days = 1 } # Deafeated the bandits but got wounded
			}
			10 = {
				modifier = {
					factor = 0
					combat_rating = 50
				}
				modifier = {
					factor = 0.5
					combat_rating = 25
				}
				character_event = { id = tianxia.296 days = 1 } # Defeated the bandits but got maimed - can't continue
			}
			5 = {
				modifier = {
					factor = 0
					combat_rating = 25
				}
				character_event = { id = tianxia.297 days = 1 } # Killed by the bandits
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_293 # This is too risky...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}	
}

# Got past the bandits
character_event = {
	id = tianxia.294
	desc = EVTDESC_TIANXIA_294
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_294 # Victory is mine!
		
		prestige = 50
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}

# Wounded, but can continue
character_event = {
	id = tianxia.295
	desc = EVTDESC_TIANXIA_295
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_295 # A difficult battle, but I still won!
		
		prestige = 25
		
		add_trait = wounded
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}

# Maimed, time to withdraw
character_event = {
	id = tianxia.296
	desc = EVTDESC_TIANXIA_296
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_296 # I must withdraw...
		
		prestige = -5
		
		add_maimed_trait_effect = yes
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Killed
character_event = {
	id = tianxia.297
	desc = EVTDESC_TIANXIA_297
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_297 # Not like this!
		
		prestige = -50
		
		death = {
			death_reason = death_battle
		}
	}
}

# Ruins - rock fall trap (intrigue)
character_event = {
	id = tianxia.298
	desc = EVTDESC_TIANXIA_298
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_298 # Onwards!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					intrigue = 20
				}
				character_event = { id = tianxia.299 days = 1 } # Spot the trap
			}
			25 = {
				modifier = {
					factor = 0.2
					intrigue = 20
				}
				character_event = { id = tianxia.300 days = 1 } # Wounded by trap
			}
			10 = {
				modifier = {
					factor = 0
					intrigue = 20
				}
				modifier = {
					factor = 0
					intrigue = 12
				}
				character_event = { id = tianxia.301 days = 1 } # Maimed by trap - can't continue
			}
			5 = {
				modifier = {
					factor = 0
					intrigue = 16
				}
				character_event = { id = tianxia.302 days = 1 } # Killed by trap
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_298 # This is too risky...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}	
}

# Got past the trap
character_event = {
	id = tianxia.299
	desc = EVTDESC_TIANXIA_299
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_299 # Child's play!
		
		prestige = 50
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}

# Wounded, but can continue
character_event = {
	id = tianxia.300
	desc = EVTDESC_TIANXIA_300
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_300 # Clever, but not clever enough!
		
		prestige = 25
		
		add_trait = wounded
		
		character_event = { id = tianxia.303 } # Second obstacle selection
	}
}

# Maimed, time to withdraw
character_event = {
	id = tianxia.301
	desc = EVTDESC_TIANXIA_301
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_301 # I must withdraw...
		
		prestige = -5
		
		add_maimed_trait_effect = yes
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Killed
character_event = {
	id = tianxia.302
	desc = EVTDESC_TIANXIA_302
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_302 # Not like this!
		
		prestige = -50
		
		death = {
			death_reason = death_accident
		}
	}
}

# Second obstacle selection
character_event = {
	id = tianxia.303
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			33 = {
				character_event = { id = tianxia.304 days = 1 } # Rotating symbols
			}
			34 = {
				character_event = { id = tianxia.308 days = 1 } # Swinging blades
			}
			33 = {
				character_event = { id = tianxia.312 days = 1 } # Safe spots
			}
		}
	}
}

# Ruins - rotating symbols (learning)
character_event = {
	id = tianxia.304
	desc = EVTDESC_TIANXIA_304
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_304 # Pick a random configuration and hope for the best
		
		random_list = {
			10 = {
				character_event = { id = tianxia.305 days = 1 } # It works
				modifier = {
					factor = 2
					learning = 12
				}
				modifier = {
					factor = 2
					learning = 16
				}
			}
			90 = {
				character_event = { id = tianxia.307 days = 1 } # It doesn't work
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				learning = 15
			}
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		trigger = {
			learning = 20
		}
		
		name = EVTOPTB_TIANXIA_304 # Inspect the walls
		
		character_event = { id = tianxia.306 days = 1 } # You spot the solution
	}
	
	option = {
		name = EVTOPTC_TIANXIA_304 # Leave the ruins
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				learning = 15
			}
			modifier = {
				factor = 0.1
				trait = ambitious
			}
			modifier = {
				factor = 0.1
				trait = brave
			}
		}
	}
}

# Got past the door
character_event = {
	id = tianxia.305
	desc = EVTDESC_TIANXIA_305
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_305 # A lucky guess!
		
		prestige = 10
		
		character_event = { id = tianxia.315 days = 1 } # The final room
	}
}

# Got past the door - high learning
character_event = {
	id = tianxia.306
	desc = EVTDESC_TIANXIA_306
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_306 # These people need to work on their puzzles...
		
		prestige = 50
		
		character_event = { id = tianxia.315 days = 1 } # The final room
	}
}

# Wounded, time to withdraw
character_event = {
	id = tianxia.307
	desc = EVTDESC_TIANXIA_307
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_307 # I can't risk getting injured again...
		
		add_trait = wounded
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Ruins - swinging blades (combat rating)
character_event = {
	id = tianxia.308
	desc = EVTDESC_TIANXIA_308
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_308 # I think I see the way through!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # Why are you even here?
					}
				}
				modifier = {
					factor = 2
					trait = patient # Stuided the pattern carefully
				}
				character_event = { id = tianxia.309 days = 1 } # Got past the trap with ease
			}
			30 = {
				modifier = {
					factor = 0
					combat_rating = 50
				}
				modifier = {
					factor = 0.3
					combat_rating = 25
				}
				character_event = { id = tianxia.310 days = 1 } # Maimed - time to withdraw
			}
			20 = {
				modifier = {
					factor = 0
					combat_rating = 25
				}
				modifier = {
					factor = 2
					trait = wroth # Impatient
				}
				character_event = { id = tianxia.311 days = 1 } # Killed by the trap
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_308 # This is too risky...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}	
}

# Got past the blades
character_event = {
	id = tianxia.309
	desc = EVTDESC_TIANXIA_309
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_309 # That wasn't so bad!
		
		prestige = 50
		
		character_event = { id = tianxia.315 days = 1 } # The final room
	}
}

# Maimed, time to withdraw
character_event = {
	id = tianxia.310
	desc = EVTDESC_TIANXIA_310
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_310 # I must withdraw...
		
		prestige = -5
		
		add_maimed_trait_effect = yes
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Killed
character_event = {
	id = tianxia.311
	desc = EVTDESC_TIANXIA_311
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_311 # Not like this!
		
		prestige = -50
		
		death = {
			death_reason = death_accident
		}
	}
}

# Ruins - safe spots (intrigue)
character_event = {
	id = tianxia.312
	desc = EVTDESC_TIANXIA_312
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_312 # I think I can see the pattern...
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 2
					intrigue = 16
				}
				character_event = { id = tianxia.313 days = 1 } # Spot the trap
			}
			50 = {
				modifier = {
					factor = 0.1
					intrigue = 20
				}
				modifier = {
					factor = 0
					intrigue = 25
				}
				character_event = { id = tianxia.314 days = 1 } # Killed by trap
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_312 # This is too risky...
		
		prestige = -10
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}	
}

# Stepped in the right places
character_event = {
	id = tianxia.313
	desc = EVTDESC_TIANXIA_313
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_313 # That wasn't so bad!
		
		prestige = 50
		
		character_event = { id = tianxia.315 days = 1 } # The final room
	}
}

# Killed
character_event = {
	id = tianxia.314
	desc = EVTDESC_TIANXIA_314
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_314 # Not like this!
		
		prestige = -50
		
		death = {
			death_reason = death_accident
		}
	}
}

# Final room - investigate glowing wall?
character_event = {
	id = tianxia.315
	desc = EVTDESC_TIANXIA_315
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_315 # Investigate the wall
		
		random_list = {
			80 = {
				character_event = { id = tianxia.316 days = 1 } # Dragon secret
			}
			10 = {
				character_event = { id = tianxia.317 days = 1 } # Interesting symbols
			}
			10 = {
				character_event = { id = tianxia.318 days = 1 } # Gemstones
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_315 # This must be another death trap...
		
		if = {
			limit = {
				trait = trusting
			}
			remove_trait = trusting
		}
		else = {
			add_trait = paranoid
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 0
		}
	}	
}

# Glowing wall reveals dragon secret
character_event = {
	id = tianxia.316
	desc = EVTDESC_TIANXIA_316
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_316 # This was well worth it!
		
		prestige = 50
		
		set_character_flag = secret_of_the_ruins
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Glowing wall reveals strange words
character_event = {
	id = tianxia.317
	desc = EVTDESC_TIANXIA_317
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_317 # Interesting...
		
		prestige = 100
		change_learning = 1
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		trigger = {
			NOT = {
				lifestyle_traits = 1
			}
		}
		name = EVTOPTB_TIANXIA_317 # I must look for similar symbols!
		
		add_trait = mystic
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Glowing wall contains gemstones
character_event = {
	id = tianxia.318
	desc = EVTDESC_TIANXIA_318
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_318 # This was well worth it!
		
		prestige = 50
		
		wealth = 1000
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Merchant selling advice - buy some?

# Merchant makes an offer
character_event = {
	id = tianxia.319
	desc = EVTDESC_TIANXIA_319
	picture = GFX_evt_market
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_319 # Give me one of those books!
		
		wealth = -100
		
		random_list = {
			10 = {
				character_event = { id = tianxia.320 days = 1 random = 2 } # Children's stories
			}
			10 = {
				character_event = { id = tianxia.321 days = 1 random = 2 } # Highermost Darkstone Pinnacle
			}
			10 = {
				character_event = { id = tianxia.322 days = 1 random = 2 } # Fire bad! Fire very bad!
			}
			10 = {
				character_event = { id = tianxia.323 days = 1 random = 2 } # Tip 1: Don't fight dragons!
			}
			10 = {
				character_event = { id = tianxia.324 days = 1 random = 2 } # Never tickle a sleeping dragon
			}
			10 = {
				character_event = { id = tianxia.325 days = 1 random = 2 } # Just Shout at it!
			}
			10 = {
				character_event = { id = tianxia.326 days = 1 random = 2 } # Watch out for the tail!
			}
			10 = {
				character_event = { id = tianxia.327 days = 1 random = 2 } # Known Weaknesses of the Celestial Dragon
			}
			10 = {
				character_event = { id = tianxia.328 days = 1 random = 2 } # If it breathes deeply, move away!
			}
			10 = {
				character_event = { id = tianxia.329 days = 1 random = 2 } # Dragon or Lizard - how to tell the difference
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 10
				trait = scholar
			}
		}
	}
		
	option = {
		name = EVTOPTB_TIANXIA_319 # No thanks!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Children's stories
character_event = {
	id = tianxia.320
	desc = EVTDESC_TIANXIA_320
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_320 # This was a waste of time...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Highermost Darkstone Pinnacle
character_event = {
	id = tianxia.321
	desc = EVTDESC_TIANXIA_321
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = gluttonous
			}
		}
		name = EVTOPTA_TIANXIA_321 # What an odd story...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		trigger = {
			trait = gluttonous
		}
		name = EVTOPTB_TIANXIA_321 # I wish I had chicken...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Fire bad!
character_event = {
	id = tianxia.322
	desc = EVTDESC_TIANXIA_322
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_322 # "Fire bad!"? Huh...
		
		set_character_flag = minor_dragon_advice
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Don't fight dragons, you fool!
character_event = {
	id = tianxia.323
	desc = EVTDESC_TIANXIA_323
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_323 # I don't have a choice, do I?
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Don't tickle the dragon!
character_event = {
	id = tianxia.324
	desc = EVTDESC_TIANXIA_324
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_324 # It wasn't the plan...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Shout at it!
character_event = {
	id = tianxia.325
	desc = EVTDESC_TIANXIA_325
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_325 # Just any battlecry, right?
		
		set_character_flag = minor_dragon_advice
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Mind the tail
character_event = {
	id = tianxia.326
	desc = EVTDESC_TIANXIA_326
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_326 # I suppose that's solid advice...
		
		set_character_flag = medium_dragon_advice
		set_character_flag = dragon_tail_advice
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Known Weaknesses of the Celestial Dragon
character_event = {
	id = tianxia.327
	desc = EVTDESC_TIANXIA_327
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_327 # Not quite what I was looking for...
		
		set_character_flag = minor_dragon_advice
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Deep breath = bad!
character_event = {
	id = tianxia.328
	desc = EVTDESC_TIANXIA_328
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_328 # I wonder how often that happens...
		
		set_character_flag = medium_dragon_advice
		set_character_flag = dragon_deep_breath
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Dragon or Lizard
character_event = {
	id = tianxia.329
	desc = EVTDESC_TIANXIA_329
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_329 # I would think "Dragons can fly" would be enough...
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

### Preacher

# Preacher suggests conversion because their god(s) surely would help
character_event = {
	id = tianxia.330
	desc = EVTDESC_TIANXIA_330
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	immediate = {
		random_province = {
			limit = {
				has_owner = yes
				any_independent_ruler = {
					any_realm_province = {
						has_province_flag = dragons_lair_province
						NOT = {
							distance = {
								where = PREVPREV
								value = 500
							}
						}
					}
				}
				NOT = {
					religion = ROOT
				}
			}
			save_event_target_as = conversion_province
		}
	}
	
	option = {
		trigger = {
			controls_religion = no
		}
		
		name = EVTOPTA_TIANXIA_330 # You make a compelling argument!
		
		religion = event_target:conversion_province
		
		# No actual effect!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				NOT = {
					trait = cynical
				}
			}
			modifier = {
				factor = 0.1
				NOT = {
					event_target:conversion_province = {
						religion_group = ROOT
					}
				}
			}
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 0
				event_target:conversion_province = {
					religion_group = pagan_group
					is_reformed_religion = yes
				}
				NOT = {
					religion_group = pagan_group
					is_reformed_religion = no
				}
			}
			modifier = {
				factor = 0
				government = chinese_imperial_government
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_330 # I don't think so!
		
		piety = 50
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.1
				trait = cynical
			}
		}
	}
}

### Misc trait events on the road

# Lose Stressed
character_event = {
	id = tianxia.331
	desc = EVTDESC_TIANXIA_331
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_331 # I feel so relaxed!
		
		remove_trait = stressed
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Become less patient
character_event = {
	id = tianxia.332
	desc = EVTDESC_TIANXIA_332
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_332 # Are we there yet?
		
		if = {
			limit = {
				trait = patient
			}
			remove_trait = patient
		}
		else = {
			add_trait = wroth
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Become less well groomed
character_event = {
	id = tianxia.333
	desc = EVTDESC_TIANXIA_333
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_333 # It's hard to stay clean on the road...
		
		prestige = -5
		
		if = {
			limit = {
				trait = groomed
			}
			remove_trait = groomed
		}
		else = {
			add_trait = uncouth
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Become a Hunter?
character_event = {
	id = tianxia.334
	desc = EVTDESC_TIANXIA_334
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_334 # Yes!
		
		add_trait = hunter
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_334 # No!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# How important is this?
character_event = {
	id = tianxia.335
	desc = EVTDESC_TIANXIA_335
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_335 # It is extremely important!
		
		add_trait = stubborn
		
		if = {
			limit = {
				trait = content
			}
			random = {
				chance = 25
				remove_trait = content
			}
		}
		else = {
			random = {
				chance = 25
				add_trait = ambitious
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Treasures
character_event = {
	id = tianxia.336
	desc = EVTDESC_TIANXIA_336
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_336 # Just think of the treasures at the end!
		
		if = {
			limit = {
				trait = charitable
			}
			remove_trait = charitable
		}
		else = {
			add_trait = greedy
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}

# Become a Gamer?
character_event = {
	id = tianxia.337
	desc = EVTDESC_TIANXIA_337
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_337 # Yes!
		
		add_trait = gamer
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_337 # No!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become a Strategist?
character_event = {
	id = tianxia.338
	desc = EVTDESC_TIANXIA_338
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_338 # Yes!
		
		add_trait = strategist
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_338 # No!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Become a Duelist?
character_event = {
	id = tianxia.339
	desc = EVTDESC_TIANXIA_339
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_339 # Yes!
		
		add_trait = duelist
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_339 # No!
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = 1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Take your time
character_event = {
	id = tianxia.340
	desc = EVTDESC_TIANXIA_340
	picture = GFX_evt_library
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_340 # We aren't really in a hurry...
		
		if = {
			limit = {
				trait = diligent
			}
			remove_trait = diligent
		}
		else = {
			add_trait = slothful
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragons_lair_travel_progress
				value = -1
			}
			character_event = { id = tianxia.204 days = 60 random = 30 } # Back to main travel event
		}
	}
}



##### At the lair

# Queue handling event
character_event = {
	id = tianxia.341
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				month = 3 # April; all LNY celebrations are over
			}
			if = {
				limit = {
					NOR = {
						has_global_flag = dragons_lair_looted
						has_global_flag = dragon_slain
					}
				}
				if = {
					limit = {
						NOT = {
							has_global_flag = ongoing_dragonslaying_attempt
						}
						OR = { # The human player gets to jump ahead
							ai = no
							NOT = {
								any_playable_ruler = {
									ai = no
									has_character_flag = in_dragons_lair_queue
								}
							}
						}
					}
					set_global_flag = ongoing_dragonslaying_attempt
					clr_character_flag = in_dragons_lair_queue
					narrative_event = { id = tianxia.343 } # Arrived at the lair
					2861 = { # Chang'an
						persistent_event_target:dragons_lair_province = {
							province_event = { id = tianxia.398 days = 30 } # If the ongoing_dragonslaying_attempt flag sticks around after it should be cleaned up, remove it!
						}
					}
				}
				else = {
					set_character_flag = in_dragons_lair_queue
					repeat_event = { id = tianxia.341 days = 10 } # If someone else is at the lair, wait for your turn
				}
			}
			else_if = {
				limit = {
					has_global_flag = dragons_lair_looted
				}
				character_event = { id = tianxia.342 } # You are too late!
			}
			else = {
				set_global_flag = dragons_lair_looted
				character_event = { id = tianxia.392 } # Loot the unattended treasures
			}
		}
		else = {
			repeat_event = { id = tianxia.341 days = 20 } # Try again later!
		}
	}
}

# Lair already looted - time to go home...
character_event = {
	id = tianxia.342
	desc = EVTDESC_TIANXIA_342
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_342 # I am too late...
		
		prestige = -100
		
		character_event = { id = tianxia.394 } # Flag cleanup
		character_event = { id = tianxia.395 days = 90 random = 30 } # Return home
	}
}

# Arrival at the lair - last chance to quit
narrative_event = {
	id = tianxia.343
	title = EVTTITLE_TIANXIA_343
	desc = EVTDESC_TIANXIA_343
	picture = GFX_evt_pagan
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] has arrived at the lair of Fredak, the Emperor of Embers!"
	}
	
	option = {
		name = EVTOPTA_TIANXIA_343 # We should sneak in!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0.25
					has_global_flag = dragon_injured
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.8
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					intrigue = 24
				}
				character_event = { id = tianxia.344 days = 1 } # Sneaking fails
			}
			50 = {
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 8
					}
				}
				modifier = {
					factor = 0
					NOT = {
						intrigue = 4
					}
				}
				character_event = { id = tianxia.345 days = 1 } # Sneaking succeeds - treasure room
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
				NOT = {
					trait = greedy
				}
			}
			modifier = {
				factor = 0
				trait = just
			}
			modifier = {
				factor = 0
				trait = honest
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_343 # The direct approach is best!
		
		if = {
			limit = {
				trait = craven
			}
			remove_trait = craven
		}
		
		character_event = { id = tianxia.352 days = 1 } # Combat begins
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = brave
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_TIANXIA_343 # I'm having second thoughts...
		
		clr_global_flag = ongoing_dragonslaying_attempt
		
		if = {
			limit = {
				trait = brave
			}
			remove_trait = brave
		}
		
		prestige = -100
		
		character_event = { id = tianxia.394 } # Flag cleanup
		character_event = { id = tianxia.395 days = 90 random = 30 } # Return home
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOT = {
					trait = craven
				}
			}
		}
	}
}

### Sneaking

# Sneaking in - got discovered - Fredak gets a bonus!
character_event = {
	id = tianxia.344
	desc = EVTDESC_TIANXIA_344
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_344 # Face me, foul beast!
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Sneaking in - treasures spotted - steal something?
character_event = {
	id = tianxia.345
	desc = EVTDESC_TIANXIA_345
	picture = GFX_evt_pagan_artifacts
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_345 # Grab what you can!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0.25
					has_global_flag = dragon_injured
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.8
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					intrigue = 24
				}
				character_event = { id = tianxia.346 days = 1 } # Got discovered in treasure chamber
			}
			50 = {
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 8
					}
				}
				random_list = {
					# Joke artifacts
					10 = {
						set_character_flag = got_incomplete_deck_of_cards
					}
					10 = {
						modifier = {
							factor = 0
							has_global_flag = talking_wand_exists
						}
						set_character_flag = got_talking_wand
						set_global_flag = talking_wand_exists
					}
					10 = {
						set_character_flag = got_book_of_burninating
					}
					10 = {
						set_character_flag = got_shiny_bauble
					}
					10 = {
						set_character_flag = got_dragon_eggshell # Only in the lair
					}
					10 = {
						set_character_flag = got_fantasy_world_map
					}
					10 = {
						set_character_flag = got_princess_doll
					}
					10 = {
						set_character_flag = got_hammer_of_banning
					}
				}
				character_event = { id = tianxia.347 days = 1 random = 2 } # Stole something
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = just # Stealing is wrong!
				NOT = {
					trait = greedy
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_345 # Just keep sneaking
		
		random_list = {
			50 = {
				modifier = {
					factor = 0.25
					has_global_flag = dragon_injured
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.8
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					intrigue = 24
				}
				character_event = { id = tianxia.348 days = 1 } # Got discovered sneaking
			}
			50 = {
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 8
					}
				}
				character_event = { id = tianxia.349 days = 1 } # Sneaking goes well
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = greedy
			}
		}
	}
}

# Treasure chamber - got discovered - Fredak gets a bonus!
character_event = {
	id = tianxia.346
	desc = EVTDESC_TIANXIA_346
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_346 # Face me, foul beast!
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Treasure chamber - got a tresure/some gold - leave the lair?
character_event = {
	id = tianxia.347
	desc = EVTDESC_TIANXIA_347
	picture = GFX_evt_pagan_artifacts
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_347 # A nice treasure, but we must continue!
		
		wealth = 100
		
		# Joke artifact
		if = {
			limit = {
				has_character_flag = got_incomplete_deck_of_cards
			}
			add_artifact = incomplete_deck_of_cards
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_talking_wand
			}
			add_artifact = talking_wand
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_book_of_burninating
			}
			add_artifact = book_of_burninating
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_shiny_bauble
			}
			add_artifact = shiny_bauble
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_fantasy_world_map
			}
			add_artifact = fantasy_world_map
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_princess_doll
			}
			add_artifact = princess_doll
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_hammer_of_banning
			}
			add_artifact = hammer_of_banning
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		
		random_list = {
			75 = {
				modifier = {
					factor = 0.25
					has_global_flag = dragon_injured
				}
				modifier = {
					factor = 0.8
					intrigue = 16
				}
				modifier = {
					factor = 0.8
					intrigue = 20
				}
				modifier = {
					factor = 0.8
					intrigue = 24
				}
				character_event = { id = tianxia.348 days = 1 } # Got discovered sneaking
			}
			25 = {
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 12
					}
				}
				modifier = {
					factor = 0.8
					NOT = {
						intrigue = 8
					}
				}
				character_event = { id = tianxia.349 days = 1 } # Sneaking goes well
			}
		}
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_347 # I think we'll leave now...
		
		wealth = 100
		prestige = -100
		
		if = {
			limit = {
				trait = brave
			}
			remove_trait = brave
		}
		
		# Joke artifact
		if = {
			limit = {
				has_character_flag = got_incomplete_deck_of_cards
			}
			add_artifact = incomplete_deck_of_cards
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_talking_wand
			}
			add_artifact = talking_wand
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_book_of_burninating
			}
			add_artifact = book_of_burninating
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_shiny_bauble
			}
			add_artifact = shiny_bauble
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_fantasy_world_map
			}
			add_artifact = fantasy_world_map
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_princess_doll
			}
			add_artifact = princess_doll
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		else_if = {
			limit = {
				has_character_flag = got_hammer_of_banning
			}
			add_artifact = hammer_of_banning
			new_artifact = {
				set_creation_date = "-1.1.1"
				set_artifact_flag = dragon_loot
			}
		}
		
		clr_global_flag = ongoing_dragonslaying_attempt
		
		character_event = { id = tianxia.394 } # Flag cleanup
		character_event = { id = tianxia.395 days = 90 random = 30 } # Return home
		
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Post-treasure chamber sneaking - got discovered (greater chance if you stole something) - Fredak gets a bonus!
character_event = {
	id = tianxia.348
	desc = EVTDESC_TIANXIA_348
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_348 # Face me, foul beast!
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Come across an unsuspecting Fredak - attack!
character_event = {
	id = tianxia.349
	desc = EVTDESC_TIANXIA_349
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_349 # Sneak attack! (Obviously you call your attacks even when sneak attacking!)
		
		random_list = {
			50 = {
				character_event = { id = tianxia.350 days = 1 } # Sneak attack fails
			}
			50 = {
				modifier = {
					factor = 2
					any_artifact = {
						has_flag = dragonslayer
					}
				}
				character_event = { id = tianxia.351 days = 1 } # Sneak attack works
			}
		}
	}
}

# First strike fails - no bonus
character_event = {
	id = tianxia.350
	desc = EVTDESC_TIANXIA_350
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_350 # Face me, foul beast!
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = 0
			}
		}
	}
}

# First strike succeeds - you get a bonus
character_event = {
	id = tianxia.351
	desc = EVTDESC_TIANXIA_351
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_351 # Face me, foul beast!
		
		hidden_tooltip = {
			set_global_flag = dragon_injured
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 1
					}
				}
			}
		}
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = 2
			}
		}
	}
}

# Rest of combat handled with non-sneaking events

### Direct approach

# Reach Fredak - fight starts!
character_event = {
	id = tianxia.352
	desc = EVTDESC_TIANXIA_352
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_352 # Face me, foul beast!
		
		character_event = { id = tianxia.353 days = 1 } # Combat event 1
		
		hidden_tooltip = {
			set_variable = { # Shouldn't ever be set prior to this point, but best to be sure...
				which = dragon_combat_bonus
				value = 0
			}
		}
	}
}

# Combat event 1 selection
character_event = {
	id = tianxia.353
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
						}
					}
				}
				random_opinion_modifier_target = {
					limit = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hunting_dragons_together
						}
					}
					preferred_limit = {
						any_rival = {
							character = ROOT
						}
					}
					save_event_target_as = live_bait
				}
				character_event = { id = tianxia.354 } # Dragonslayer in danger
			}
			25 = {
				character_event = { id = tianxia.360 } # Tail swipe
			}
			25 = {
				modifier = {
					factor = 2
					trait = craven
				}
				character_event = { id = tianxia.363 } # Intimidate
			}
		}
	}
}

# Dragonslayer in danger - save them or use them as bait?
character_event = {
	id = tianxia.354
	desc = EVTDESC_TIANXIA_354
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_354 # I must help them!
		
		random_list = {
			33 = {
				character_event = { id = tianxia.355 days = 1 } # Saved them
			}
			34 = {
				character_event = { id = tianxia.356 days = 1 } # Saved them but got wounded
			}
			33 = {
				character_event = { id = tianxia.357 days = 1 } # Saved them but got maimed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					event_target:live_bait = {
						any_rival = {
							character = ROOT
						}
					}
					trait = cruel
					trait = arbitrary
					trait = deceitful
				}
			}
			modifier = {
				factor = 0.01
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_354 # Live bait is good!
		
		if = {
			limit = {
				trait = kind
			}
			remove_trait = kind
		}
		else = {
			add_trait = cruel
		}
		if = {
			limit = {
				trait = just
			}
			remove_trait = just
		}
		else = {
			add_trait = arbitrary
		}
		if = {
			limit = {
				trait = honest
			}
			remove_trait = honest
		}
		else = {
			add_trait = deceitful
		}
		
		random_list = {
			50 = {
				character_event = { id = tianxia.358 days = 1 } # They die - gain a bonus
			}
			50 = {
				character_event = { id = tianxia.359 days = 1 } # They live and hate you
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				event_target:live_bait = {
					OR = {
						any_friend = {
							character = ROOT
						}
						any_lover = {
							character = ROOT
						}
					}
				}
			}
			modifier = {
				factor = 0.01
				trait = brave
			}
			modifier = {
				factor = 0.1
				trait = just
			}
		}
	}
}

# Saved dragonslayer - all is well
character_event = {
	id = tianxia.355
	desc = EVTDESC_TIANXIA_355
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_355 # Think nothing of it!
		
		prestige = 50
		
		if = {
			limit = {
				event_target:live_bait = {
					any_rival = {
						character = ROOT
					}
				}
			}
			event_target:live_bait = {
				remove_rival = ROOT
			}
		}
		else_if = {
			limit = {
				event_target:live_bait = {
					NOT = {
						any_friend = {
							character = ROOT
						}
					}
				}
			}
			event_target:live_bait = {
				add_friend = ROOT
			}
		}
		else = {
			prestige = 100
			character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		}
	}
}

# Saved dragonslayer - wounded
character_event = {
	id = tianxia.356
	desc = EVTDESC_TIANXIA_356
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_356 # Think nothing of it!
		
		prestige = 50
		
		add_trait = wounded
		
		if = {
			limit = {
				event_target:live_bait = {
					any_rival = {
						character  =ROOT
					}
				}
			}
			event_target:live_bait = {
				remove_rival = ROOT
			}
		}
		else_if = {
			limit = {
				event_target:live_bait = {
					NOT = {
						any_friend = {
							character  =ROOT
						}
					}
				}
			}
			event_target:live_bait = {
				add_friend = ROOT
			}
		}
		else = {
			prestige = 100
			character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		}
	}
}

# Saved dragonslayer - maimed
character_event = {
	id = tianxia.357
	desc = EVTDESC_TIANXIA_357
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_357 # Think nothing of it!
		
		prestige = 50
		
		add_maimed_trait_effect = yes
		
		if = {
			limit = {
				event_target:live_bait = {
					any_rival = {
						character  =ROOT
					}
				}
			}
			event_target:live_bait = {
				remove_rival = ROOT
			}
		}
		else_if = {
			limit = {
				event_target:live_bait = {
					NOT = {
						any_friend = {
							character  =ROOT
						}
					}
				}
			}
			event_target:live_bait = {
				add_friend = ROOT
			}
		}
		else = {
			prestige = 100
			character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		}
	}
}

# Dragonslayer used as bait and dies - you get a bonus
character_event = {
	id = tianxia.358
	desc = EVTDESC_TIANXIA_358
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_358 # Nothing personal!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		event_target:live_bait = {
			if = {
				limit = {
					has_character_flag = dragonslayer_the_old_crusader
					ROOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_squire
						}
					}
				}
				ROOT = {
					any_opinion_modifier_target = {
						limit = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_squire
						}
						add_rival = ROOT
					}
				}
			}
			else_if = {
				limit = {
					has_character_flag = dragonslayer_the_squire
					ROOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_old_crusader
						}
					}
				}
				ROOT = {
					any_opinion_modifier_target = {
						limit = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_old_crusader
						}
						add_rival = ROOT
					}
				}
			}
			death = {
				death_reason = death_evil_dragon
			}
		}
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
	}
}

# Dragonslayer used as bait and survives - gain their enmity
character_event = {
	id = tianxia.359
	desc = EVTDESC_TIANXIA_359
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_359 # Nothing personal!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		event_target:live_bait = {
			if = {
				limit = {
					any_friend = {
						character = ROOT
					}
				}
				remove_friend = ROOT
			}
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
			if = {
				limit = {
					NOT = {
						any_rival = {
							character = ROOT
						}
					}
				}
				add_rival = ROOT
			}
			if = {
				limit = {
					has_character_flag = dragonslayer_the_old_crusader
					ROOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_squire
						}
					}
				}
				ROOT = {
					any_opinion_modifier_target = {
						limit = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_squire
						}
						add_rival = ROOT
					}
				}
			}
			else_if = {
				limit = {
					has_character_flag = dragonslayer_the_squire
					ROOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_old_crusader
						}
					}
				}
				ROOT = {
					any_opinion_modifier_target = {
						limit = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							has_character_flag = dragonslayer_the_old_crusader
						}
						add_rival = ROOT
					}
				}
			}
			opinion = {
				who = ROOT
				modifier = attempted_murder
			}
			hidden_tooltip = {
				save_event_target_as = target_victim
				ROOT = { character_event = { id = 11 } } # Consequences of discovery
				clear_event_target = target_victim
			}
		}
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
	}
}


# Tail swipe - dodge left or right?
character_event = {
	id = tianxia.360
	desc = EVTDESC_TIANXIA_360
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_360 # Dodge left!
		random_list = {
			50 = {
				modifier = {
					factor = 5
					has_character_flag = dragon_tail_advice
				}
				character_event = { id = tianxia.361 days = 1 } # Dodged
			}
			50 = {
				character_event = { id = tianxia.362 days = 1 } # Did not dodge
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_360 # Dodge right!
		random_list = {
			50 = {
				modifier = {
					factor = 5
					has_character_flag = dragon_tail_advice
				}
				character_event = { id = tianxia.361 days = 1 } # Dodged
			}
			50 = {
				character_event = { id = tianxia.362 days = 1 } # Did not dodge
			}
		}
	}
}
	
# Dodge succeeds - you get a bonus
character_event = {
	id = tianxia.361
	desc = EVTDESC_TIANXIA_361
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_361 # I avoided the tail!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 2
			}
		}
	}
}

# Dodge fails - wounded - Fredak gets a bonus
character_event = {
	id = tianxia.362
	desc = EVTDESC_TIANXIA_362
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_362 # I did not avoid the tail...
		
		add_trait = wounded
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Fredak used Intimidate!
character_event = {
	id = tianxia.363
	desc = EVTDESC_TIANXIA_363
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_363 # He lies!
		
		random_list = {
			50 = {
				modifier = {
					factor = 10
					trait = brave
				}
				modifier = {
					factor = 2
					trait = stubborn
				}
				modifier = {
					factor = 5
					trait = proud
				}
				character_event = { id = tianxia.364 days = 1 } # Not intimidated
			}
			50 = {
				modifier = {
					factor = 10
					trait = craven
				}
				modifier = {
					factor = 2
					trait = paranoid
				}
				modifier = {
					factor = 5
					trait = cynical
				}
				character_event = { id = tianxia.365 days = 1 } # Intimidated
			}
		}
	}
}

# Intimidation fails - you get a bonus
character_event = {
	id = tianxia.364
	desc = EVTDESC_TIANXIA_364
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_364 # I have heard scarier threats from children!
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 2
			}
		}
	}
}

# Intimidation succeeds - Fredak gets a bonus
character_event = {
	id = tianxia.365
	desc = EVTDESC_TIANXIA_365
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_365 # I don't want to die!
		
		character_event = { id = tianxia.366 days = 1 random = 3 } # Combat event 2
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Combat event 2 selection
character_event = {
	id = tianxia.366
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				random_opinion_modifier_target = {
					limit = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hunting_dragons_together
						}
						any_rival = {
							character = ROOT
						}
					}
					preferred_limit = {
						character = event_target:live_bait
					}
					save_event_target_as = would_be_traitor
				}
				character_event = { id = tianxia.367 } # Tripped by rival
			}
			25 = {
				modifier = {
					factor = 0
					NOT = {
						any_opinion_modifier_target = {
							has_opinion_modifier = {
								who = ROOT
								modifier = hunting_dragons_together
							}
							OR = {
								any_friend = {
									character = ROOT
								}
								any_lover = {
									character = ROOT
								}
							}
						}
					}
				}
				random_opinion_modifier_target = {
					limit = {
						has_opinion_modifier = {
							who = ROOT
							modifier = hunting_dragons_together
						}
						OR = {
							any_friend = {
								character = ROOT
							}
							any_lover = {
								character = ROOT
							}
						}
					}
					preferred_limit = {
						character = event_target:live_bait
					}
					save_event_target_as = died_for_you
				}
				character_event = { id = tianxia.372 } # Friend or lover sacrifices themself
			}
			25 = {
				character_event = { id = tianxia.373 } # Rocks fall
			}
		}
	}
}

# Rival dragonslayer trips you - focus on standing up or on making them pay?
character_event = {
	id = tianxia.367
	desc = EVTDESC_TIANXIA_367
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_367 # How dare you!
		
		character_event = { id = tianxia.368 days = 1 } # Stood up
		
		event_target:would_be_traitor = {
			reverse_opinion = {
				who = ROOT
				modifier = attempted_murder
			}
			hidden_tooltip = {
				ROOT = {
					save_event_target_as = target_victim
					PREV = { character_event = { id = 11 } } # Consequences of discovery
					clear_event_target = target_victim
				}
			}
		
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					is_chinese_emperor_trigger = no
				}
				if = {
					limit = {
						ROOT = {
							is_chinese_emperor_trigger = yes
						}
					}
					detract_grace_super_huge_effect = yes
				}
				else_if = {
					limit = {
						ROOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
					}
					detract_grace_massive_effect = yes
				}
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				OR = {
					trait = wroth
					trait = cruel
					trait = deceitful
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_367 # I can trip you too!
		
		random_list = {
			33 = {
				character_event = { id = tianxia.369 days = 1 } # Trip them, they get maimed
			}
			34 = {
				character_event = { id = tianxia.370 days = 1 } # Trip them, both get maimed
			}
			33 = {
				character_event = { id = tianxia.371 days = 1 } # Fail to trip them, you get maimed
			}
		}
		
		event_target:would_be_traitor = {
			reverse_opinion = {
				who = ROOT
				modifier = attempted_murder
			}
			ROOT = {
				hidden_tooltip = {
					save_event_target_as = target_victim
					PREV = { character_event = { id = 11 } } # Consequences of discovery
					clear_event_target = target_victim
				}
			}
			opinion = {
				who = ROOT
				modifier = attempted_murder
			}
			hidden_tooltip = {
				save_event_target_as = target_victim
				ROOT = { character_event = { id = 11 } } # Consequences of discovery
				clear_event_target = target_victim
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = kind
			}
		}
	}
}

# Stood up - no penalty
character_event = {
	id = tianxia.368
	desc = EVTDESC_TIANXIA_368
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_368 # I will deal with YOU later...
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
	}
}

# Failed to drag them down - you get maimed - Fredak gets a bonus
character_event = {
	id = tianxia.369
	desc = EVTDESC_TIANXIA_369
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_369 # Curse you!
		
		add_maimed_trait_effect = yes
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Dragged them down - both maimed - Fredak gets a big bonus
character_event = {
	id = tianxia.370
	desc = EVTDESC_TIANXIA_370
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_370 # At least they also got hurt...
		
		add_maimed_trait_effect = yes
		
		event_target:would_be_traitor = {
			add_maimed_trait_effect = yes
		}
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Dragged them down - they get maimed - Fredak gets a bonus
character_event = {
	id = tianxia.371
	desc = EVTDESC_TIANXIA_371
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_371 # That's what you get!
		
		event_target:would_be_traitor = {
			add_maimed_trait_effect = yes
		}
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Friend or lover dragonslayer sacrifices themself to protect you - you get a bonus
character_event = {
	id = tianxia.372
	desc = EVTDESC_TIANXIA_372
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_372 # I will avenge you!
		
		event_target:died_for_you = {
			death = {
				death_reason = death_evil_dragon
			}
		}
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 7 # Counters the fact that you've lost a dragonslayer, plus 2 extra
			}
		}
	}
}

# Lair shakes and rocks fall from the ceiling - dodge
character_event = {
	id = tianxia.373
	desc = EVTDESC_TIANXIA_373
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_373 # Take cover!
		random_list = {
			50 = {
				character_event = { id = tianxia.374 days = 1 } # Dodged
			}
			50 = {
				character_event = { id = tianxia.375 days = 1 } # Did not dodge
			}
		}
	}
}
	
# Dodge succeeds
character_event = {
	id = tianxia.374
	desc = EVTDESC_TIANXIA_374
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_374 # I avoided the rocks!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 2
			}
		}
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
	}
}

# Dodge fails - wounded
character_event = {
	id = tianxia.375
	desc = EVTDESC_TIANXIA_375
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_375 # I did not avoid the rocks...
		
		add_trait = wounded
		
		character_event = { id = tianxia.376 days = 1 random = 3 } # Combat event 3
	}
}

# Combat event 3 selection
character_event = {
	id = tianxia.376
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			25 = {
				character_event = { id = tianxia.377 } # Distraction?
			}
			50 = {
				modifier = {
					factor = 2
					has_character_flag = dragon_deep_breath
				}
				character_event = { id = tianxia.380 } # Deep breath
			}
			25 = {
				modifier = {
					factor = 2
					has_global_flag = dragon_injured
				}
				character_event = { id = tianxia.383 } # Spot potential weak spot
			}
		}
	}
}

# Attempt to distract Fredak?
character_event = {
	id = tianxia.377
	desc = EVTDESC_TIANXIA_377
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_377 # Look behind you!
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						intrigue = 12
					}
				}
				character_event = { id = tianxia.378 days = 1 } # Fredak is tricked
			}
			50 = {
				modifier = {
					factor = 0.1
					intrigue = 24
				}
				character_event = { id = tianxia.379 days = 1 } # Fredak is not tricked
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = honest
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_377 # It wouldn't work...
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = deceitful
			}
		}
	}
}

# Distraction works - you get a bonus
character_event = {
	id = tianxia.378
	desc = EVTDESC_TIANXIA_378
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_378 # I tricked him!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 2
			}
		}
	}
}

# Distraction backfires - Fredak gets a bonus
character_event = {
	id = tianxia.379
	desc = EVTDESC_TIANXIA_379
	picture = GFX_evt_pagan
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_379 # Worth a shot
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Fredak takes a deep breath - attempt to strike before he can breathe out or hide?
character_event = {
	id = tianxia.380
	desc = EVTDESC_TIANXIA_380
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_380 # Strike at him
		
		random_list = {
			50 = {
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # Why are you even here?
					}
				}
				modifier = {
					factor = 2
					has_character_flag = dragon_deep_breath
				}
				character_event = { id = tianxia.381 days = 1 } # You succeeded
			}
			50 = {
				modifier = {
					factor = 0
					combat_rating = 75
				}
				character_event = { id = tianxia.382 days = 1 } # You failed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_380 # It wouldn't work...
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Attacked Fredak - you get a bonus
character_event = {
	id = tianxia.381
	desc = EVTDESC_TIANXIA_381
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_381 # So predictable!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
			}
		}
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 2
			}
		}
	}
}

# Attacked Fredak and got wounded
character_event = {
	id = tianxia.382
	desc = EVTDESC_TIANXIA_382
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_382 # That didn't work...
		
		add_trait = wounded
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# You see an old wound - strike at it?
character_event = {
	id = tianxia.383
	desc = EVTDESC_TIANXIA_383
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_383 # Strike at the wound
		
		random_list = {
			50 = {
				modifier = {
					factor = 2
					has_global_flag = dragon_injured # Not-so-old wound
				}
				modifier = {
					factor = 0
					NOT = {
						combat_rating = 25 # Why are you even here?
					}
				}
				character_event = { id = tianxia.384 days = 1 } # You succeeded
			}
			50 = {
				modifier = {
					factor = 0
					combat_rating = 75
				}
				modifier = {
					factor = 0
					combat_rating = 50
					has_global_flag = dragon_injured
				}
				character_event = { id = tianxia.385 days = 1 } # You failed
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = craven
			}
		}
	}
	
	option = {
		name = EVTOPTB_TIANXIA_383 # It wouldn't work...
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				trait = brave
			}
		}
	}
}

# Blow succeeds - you get a bonus
character_event = {
	id = tianxia.384
	desc = EVTDESC_TIANXIA_384
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_384 # It was super effective!
		
		set_global_flag = dragon_injured
		hidden_tooltip = {
			2861 = { # Chang'an
				persistent_event_target:dragons_lair_province = {
					change_variable = {
						which = dragon_wounds
						value = 5
					}
				}
			}
		}
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = 5
			}
		}
	}
}

# Blow fails - Fredak gets a bonus
character_event = {
	id = tianxia.385
	desc = EVTDESC_TIANXIA_385
	picture = GFX_evt_burning_man_hf
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_385 # It wasn't a wound!
		
		character_event = { id = tianxia.386 days = 1 } # Final combat outcome is decided
		
		hidden_tooltip = {
			change_variable = {
				which = dragon_combat_bonus
				value = -2
			}
		}
	}
}

# Final combat calculation (LNY calculation minus LNY modifiers, plus new modifiers) - you either WIN or DIE!
character_event = {
	id = tianxia.386
	hide_window = yes
	is_triggered_only = yes
	
	immediate = { # Note: It is supposed to be VERY difficult to win if you're not a great warrior AND roll well, because the rewards are VERY good!
		hidden_tooltip = {
			random_list = {
				19 = {
					set_character_flag = dragon_combat_undecided
					random_list = {
						1 = {
							set_variable = {
								which = d20
								value = 25 # Due to plot armor, a crit is only +5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 19
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 18
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 17
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 16
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 15
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 14
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 13
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 12
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 11
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 10
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 9
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 8
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 7
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 6
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 5
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 4
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 3
							}
						}
						1 = {
							set_variable = {
								which = d20
								value = 2
							}
						}
					}
				}
				1 = {  # Critical failure
					set_variable = {
						which = d20
						value = 1
					}
				}
			}
			if = {
				limit = {
					has_character_flag = fragment_of_possibility
				}
				random_list = {
					1 = {
						set_variable = {
							which = d20_2
							value = 25 # Due to plot armor, a crit is only +5
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 19
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 18
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 17
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 16
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 15
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 14
						}
					}
					1 = {
						set_variable = {
							which = d20
							value = 13
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 12
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 11
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 10
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 9
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 8
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 7
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 6
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 5
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 4
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 3
						}
					}
					1 = {
						set_variable = {
							which = d20_2
							value = 2
						}
					}
				}
				1 = {  # Critical failure
					set_variable = {
						which = d20_2
						value = 1
					}
				}
			}
			
			if = {
				limit = {
					check_variable = {
						which = d20_2
						which = d20
					}
				}
				set_variable = {
					which = d20
					which = d20_2
				}
			}
			
			if = {
				limit = {
					is_variable_equal = {
						which = d20
						value = 1
					}
				}
				clr_character_flag = dragon_combat_undecided
				narrative_event = { id = tianxia.388 } # You have died!
			}
			
			if = {
				limit = {
					has_character_flag = dragon_combat_undecided
				}
				if = {
					limit = {
						OR = {
							trait = hunter
							trait = strategist
							trait = duelist
							trait = gamer # Obviously very relevant!
						}
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				if = {
					limit = {
						OR = {
							AND = {
								ai = yes
								any_artifact = {
									has_flag = dragonslayer
								}
							}
							any_artifact = {
								is_artifact_equipped = yes
								has_flag = dragonslayer
							}
						}
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				# Combat rating - checks up to 500 in case someone has some insane bloodline stacking or the like
				if = {
					limit = {
						combat_rating = 500
					}
					change_variable = {
						which = d20
						value = 50
					}
				}
				else_if = {
					limit = {
						combat_rating = 490
					}
					change_variable = {
						which = d20
						value = 49
					}
				}
				else_if = {
					limit = {
						combat_rating = 480
					}
					change_variable = {
						which = d20
						value = 48
					}
				}
				else_if = {
					limit = {
						combat_rating = 470
					}
					change_variable = {
						which = d20
						value = 47
					}
				}
				else_if = {
					limit = {
						combat_rating = 460
					}
					change_variable = {
						which = d20
						value = 46
					}
				}
				else_if = {
					limit = {
						combat_rating = 450
					}
					change_variable = {
						which = d20
						value = 45
					}
				}
				else_if = {
					limit = {
						combat_rating = 440
					}
					change_variable = {
						which = d20
						value = 44
					}
				}
				else_if = {
					limit = {
						combat_rating = 430
					}
					change_variable = {
						which = d20
						value = 43
					}
				}
				else_if = {
					limit = {
						combat_rating = 420
					}
					change_variable = {
						which = d20
						value = 42
					}
				}
				else_if = {
					limit = {
						combat_rating = 410
					}
					change_variable = {
						which = d20
						value = 41
					}
				}
				else_if = {
					limit = {
						combat_rating = 400
					}
					change_variable = {
						which = d20
						value = 40
					}
				}
				else_if = {
					limit = {
						combat_rating = 390
					}
					change_variable = {
						which = d20
						value = 39
					}
				}
				else_if = {
					limit = {
						combat_rating = 380
					}
					change_variable = {
						which = d20
						value = 38
					}
				}
				else_if = {
					limit = {
						combat_rating = 370
					}
					change_variable = {
						which = d20
						value = 37
					}
				}
				else_if = {
					limit = {
						combat_rating = 360
					}
					change_variable = {
						which = d20
						value = 36
					}
				}
				else_if = {
					limit = {
						combat_rating = 350
					}
					change_variable = {
						which = d20
						value = 35
					}
				}
				else_if = {
					limit = {
						combat_rating = 340
					}
					change_variable = {
						which = d20
						value = 34
					}
				}
				else_if = {
					limit = {
						combat_rating = 330
					}
					change_variable = {
						which = d20
						value = 33
					}
				}
				else_if = {
					limit = {
						combat_rating = 320
					}
					change_variable = {
						which = d20
						value = 32
					}
				}
				else_if = {
					limit = {
						combat_rating = 310
					}
					change_variable = {
						which = d20
						value = 31
					}
				}
				else_if = {
					limit = {
						combat_rating = 300
					}
					change_variable = {
						which = d20
						value = 30
					}
				}
				else_if = {
					limit = {
						combat_rating = 290
					}
					change_variable = {
						which = d20
						value = 29
					}
				}
				else_if = {
					limit = {
						combat_rating = 280
					}
					change_variable = {
						which = d20
						value = 28
					}
				}
				else_if = {
					limit = {
						combat_rating = 270
					}
					change_variable = {
						which = d20
						value = 27
					}
				}
				else_if = {
					limit = {
						combat_rating = 260
					}
					change_variable = {
						which = d20
						value = 26
					}
				}
				else_if = {
					limit = {
						combat_rating = 250
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						combat_rating = 240
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						combat_rating = 230
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						combat_rating = 220
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						combat_rating = 210
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						combat_rating = 200
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						combat_rating = 190
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						combat_rating = 180
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						combat_rating = 170
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						combat_rating = 160
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						combat_rating = 150
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						combat_rating = 140
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						combat_rating = 130
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						combat_rating = 120
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						combat_rating = 110
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						combat_rating = 100
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						combat_rating = 90
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						combat_rating = 80
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						combat_rating = 70
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						combat_rating = 60
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						combat_rating = 50
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						combat_rating = 40
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						combat_rating = 30
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						combat_rating = 20
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						combat_rating = 10
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				# Martial - checks up to 50 in case of a lot of stacking, every other point is +1
				if = {
					limit = {
						martial = 50
					}
					change_variable = {
						which = d20
						value = 25
					}
				}
				else_if = {
					limit = {
						martial = 48
					}
					change_variable = {
						which = d20
						value = 24
					}
				}
				else_if = {
					limit = {
						martial = 46
					}
					change_variable = {
						which = d20
						value = 23
					}
				}
				else_if = {
					limit = {
						martial = 44
					}
					change_variable = {
						which = d20
						value = 22
					}
				}
				else_if = {
					limit = {
						martial = 42
					}
					change_variable = {
						which = d20
						value = 21
					}
				}
				else_if = {
					limit = {
						martial = 40
					}
					change_variable = {
						which = d20
						value = 20
					}
				}
				else_if = {
					limit = {
						martial = 38
					}
					change_variable = {
						which = d20
						value = 19
					}
				}
				else_if = {
					limit = {
						martial = 36
					}
					change_variable = {
						which = d20
						value = 18
					}
				}
				else_if = {
					limit = {
						martial = 34
					}
					change_variable = {
						which = d20
						value = 17
					}
				}
				else_if = {
					limit = {
						martial = 32
					}
					change_variable = {
						which = d20
						value = 16
					}
				}
				else_if = {
					limit = {
						martial = 30
					}
					change_variable = {
						which = d20
						value = 15
					}
				}
				else_if = {
					limit = {
						martial = 28
					}
					change_variable = {
						which = d20
						value = 14
					}
				}
				else_if = {
					limit = {
						martial = 26
					}
					change_variable = {
						which = d20
						value = 13
					}
				}
				else_if = {
					limit = {
						martial = 24
					}
					change_variable = {
						which = d20
						value = 12
					}
				}
				else_if = {
					limit = {
						martial = 22
					}
					change_variable = {
						which = d20
						value = 11
					}
				}
				else_if = {
					limit = {
						martial = 20
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				else_if = {
					limit = {
						martial = 18
					}
					change_variable = {
						which = d20
						value = 9
					}
				}
				else_if = {
					limit = {
						martial = 16
					}
					change_variable = {
						which = d20
						value = 8
					}
				}
				else_if = {
					limit = {
						martial = 14
					}
					change_variable = {
						which = d20
						value = 7
					}
				}
				else_if = {
					limit = {
						martial = 12
					}
					change_variable = {
						which = d20
						value = 6
					}
				}
				else_if = {
					limit = {
						martial = 10
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				else_if = {
					limit = {
						martial = 8
					}
					change_variable = {
						which = d20
						value = 4
					}
				}
				else_if = {
					limit = {
						martial = 6
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				else_if = {
					limit = {
						martial = 4
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						martial = 2
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				any_opinion_modifier_target = {
					limit = {
						has_character_flag = dragonslayer_wannabe
						has_opinion_modifier = {
							who = ROOT
							modifier = hunting_dragons_together
						}
					}
					ROOT = {
						change_variable = {
							which = d20
							value = 10 # Higher than for the LNY; they are caught unawares during the LNY...
						}
					}
				}
				if = {
					limit = {
						tier = duke
					}
					change_variable = {
						which = d20
						value = 1
					}
				}
				else_if = {
					limit = {
						tier = king
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				else_if = {
					limit = {
						tier = emperor
					}
					change_variable = {
						which = d20
						value = 3
					}
				}
				
				if = {
					limit = {
						has_global_flag = dragon_injured
					}
					change_variable = {
						which = d20
						value = dragon_wounds
					}
				}
				
				# Misc bonuses from the journey
				if = {
					limit = {
						has_character_flag = dragonslayer_legend_great_advice
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				if = {
					limit = {
						has_character_flag = dragonslayer_legend_good_advice
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				if = {
					limit = {
						has_character_flag = dragonslayer_legend_bad_advice
					}
					change_variable = {
						which = d20
						value = -2
					}
				}
				if = {
					limit = {
						has_character_flag = dragonslayer_legend_terrible_advice
					}
					change_variable = {
						which = d20
						value = -5
					}
				}
				if = {
					limit = {
						has_character_flag = mabs_boon
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				if = {
					limit = {
						has_character_flag = mabs_curse
					}
					change_variable = {
						which = d20
						value = -10
					}
				}
				if = {
					limit = {
						has_character_flag = secret_of_the_ruins
					}
					change_variable = {
						which = d20
						value = 10
					}
				}
				if = {
					limit = {
						has_character_flag = minor_dragon_advice
					}
					change_variable = {
						which = d20
						value = 2
					}
				}
				if = {
					limit = {
						has_character_flag = medium_dragon_advice
					}
					change_variable = {
						which = d20
						value = 5
					}
				}
				
				# Misc bonuses from the lair
				change_variable = {
					which = d20
					which = dragon_combat_bonus
				}
				
				# Calculate outcome
				if = {
					limit = {
						check_variable = {
							which = d20
							value = 100
						}
					}
					narrative_event = { id = tianxia.390 } # Dragon killed
				}
				else_if = {
					limit = {
						NOT = { 
							check_variable = {
								which = d20
								value = 100
							}
						}
						OR = {
							check_variable = {
								which = d20
								value = 23
							}
							has_global_flag = dragon_injured # Possibly already injured
						}
					}
					set_global_flag = dragon_injured
					narrative_event = { id = tianxia.389 } # You have died, but you left a wound...
				}
				else = {
					narrative_event = { id = tianxia.388 } # You have died!
				}
			}
		}
	}
}

# You have died!
narrative_event = {
	id = tianxia.388
	title = EVTTITLE_TIANXIA_388
	desc = EVTDESC_TIANXIA_388
	picture = GFX_evt_burning_man_hf
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] was killed by Fredak, the Emperor of Embers!"
	}
	
	option = {
		name = EVTOPTA_TIANXIA_388 # NOOO!
		
		death = {
			death_reason = death_evil_dragon
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_character_flag = dragonslayer_wannabe
				has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			death = {
				death_reason = death_evil_dragon
			}
		}
		
		# If you looted something, you can't keep it
		if = {
			limit = {
				OR = {
					has_character_flag = got_incomplete_deck_of_cards
					has_character_flag = got_talking_wand
					has_character_flag = got_book_of_burninating
					has_character_flag = got_shiny_bauble
					has_character_flag = got_fantasy_world_map
					has_character_flag = got_princess_doll
					has_character_flag = got_hammer_of_banning
				}
			}
			if = {
				limit = {
					has_character_flag = got_talking_wand
				}
				clr_global_flag = talking_wand_exists
			}
			if = {
				limit = {
					has_character_flag = got_the_plus_one_ring
				}
				clr_global_flag = the_plus_one_ring_exists
			}
			if = {
				limit = {
					has_character_flag = got_sword_of_two_minds
				}
				clr_global_flag = sword_of_two_minds_exists
			}
			any_artifact = {
				limit = {
					has_flag = dragon_loot
				}
				unsafe_destroy_artifact = yes
			}
		}
		
		clr_global_flag = ongoing_dragonslaying_attempt
	}
}

# Died, but wounded the dragon
narrative_event = {
	id = tianxia.389
	title = EVTTITLE_TIANXIA_389
	desc = EVTDESC_TIANXIA_389
	picture = GFX_evt_burning_man_hf
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] was killed by Fredak, the Emperor of Embers, but wounded the dragon!"
		set_global_flag = dragon_injured
		2861 = { # Chang'an
			persistent_event_target:dragons_lair_province = {
				if = {
					limit = {
						ROOT = {
							check_variable = {
								which = d20
								value = 75
							}
						}
					}
					change_variable = {
						which = dragon_wounds
						value = 5
					}
				}
				else_if = {
					limit = {
						ROOT = {
							check_variable = {
								which = d20
								value = 50
							}
						}
					}
					change_variable = {
						which = dragon_wounds
						value = 2
					}
				}
				else = {
					change_variable = {
						which = dragon_wounds
						value = 1
					}
				}
				
				province_event = { id = tianxia.201 days = 365 random = 183 } # Fredak recovers
			}
		}
	}
	
	option = {
		name = EVTOPTA_TIANXIA_389 # Avenge me!
		
		death = {
			death_reason = death_evil_dragon
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_character_flag = dragonslayer_wannabe
				has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			death = {
				death_reason = death_evil_dragon
			}
		}
		
		# If you looted something, you can't keep it
		if = {
			limit = {
				OR = {
					has_character_flag = got_incomplete_deck_of_cards
					has_character_flag = got_talking_wand
					has_character_flag = got_book_of_burninating
					has_character_flag = got_shiny_bauble
					has_character_flag = got_fantasy_world_map
					has_character_flag = got_princess_doll
					has_character_flag = got_hammer_of_banning
				}
			}
			if = {
				limit = {
					has_character_flag = got_talking_wand
				}
				clr_global_flag = talking_wand_exists
			}
			any_artifact = {
				limit = {
					has_flag = dragon_loot
				}
				unsafe_destroy_artifact = yes
			}
		}
		
		clr_global_flag = ongoing_dragonslaying_attempt
	}
}

# Victory is yours
narrative_event = {
	id = tianxia.390
	title = EVTTITLE_TIANXIA_390
	desc = EVTDESC_TIANXIA_390
	picture = GFX_evt_society_joining
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		log = "Fredak, the Emperor of Embers, has been slain! [Root.GetBestName] is now the Dragonslayer."
	}
	
	option = {
		name = EVTOPTA_TIANXIA_390 # Now bring me a REAL challenge!
		
		# These rewards are supposed to be very good, considering that it is difficult to pull off
		give_nickname = nick_the_dragonslayer
		
		set_global_flag = dragon_slain
		set_character_flag = killed_the_dragon
		
		prestige = 10000
		piety = 10000
		
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = dragonslayer_bloodline
			}
		}
		else = {
			create_bloodline = {
				type = dragonslayer_bloodline
				inheritance = matrilineal
			}
		}
		
		random_list = {
			95 = {}
			4 = {
				modifier = {
					factor = 0
					combat_rating = 100
				}
				modifier = {
					factor = 0.5
					combat_rating = 75
				}
				add_trait = wounded
			}
			1 = {
				modifier = {
					factor = 0
					combat_rating = 50
				}
				modifier = {
					factor = 0.5
					combat_rating = 25
				}
				add_maimed_trait_effect = yes
			}
		}
		
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			random_list = {
				95 = {}
				4 = {
					modifier = {
						factor = 0
						combat_rating = 100
					}
					modifier = {
						factor = 0.5
						combat_rating = 75
					}
					add_trait = wounded
				}
				1 = {
					modifier = {
						factor = 0
						combat_rating = 50
					}
					modifier = {
						factor = 0.5
						combat_rating = 25
					}
					add_maimed_trait_effect = yes
				}
			}
		}
		
		any_playable_ruler = {
			limit = {
				NOT = {
					character = ROOT
				}
			}
			character_event = { id = tianxia.391 days = 2 } # Inform the world
		}
		
		set_global_flag = dragons_lair_looted # Prevents others from looting the lair
		character_event = { id = tianxia.392 days = 1 }
		clr_global_flag = ongoing_dragonslaying_attempt
	}
}

### To the victor, the spoils

# Inform the world and send other dragonslayers home right away
character_event = {
	id = tianxia.391
	desc = EVTDESC_TIANXIA_391
	picture = GFX_evt_society_joining
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOT = {
				trait = hunting_dragons
			}
		}
		name = EVTOPTA_TIANXIA_391 # At last the dragon is dead!
	}
	
	option = {
		trigger = {
			trait = hunting_dragons
		}
		name = EVTOPTB_TIANXIA_391 # Time to go home...
		
		character_event = { id = tianxia.394 } # Clean up flags
		character_event = { id = tianxia.395 days = 90 random = 30 } # Go home
	}
}

# Loot the lair - get treasures based on the hoard value
character_event = {
	id = tianxia.392
	desc = EVTDESC_TIANXIA_392
	picture = GFX_evt_treasure_chamber
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		log = "[Root.GetBestName] is looting the lair of Fredak, the Emperor of Embers!"
		
		set_variable = {
			which = T5
			value = 0
		}
		set_variable = {
			which = T3
			value = 0
		}
		set_variable = {
			which = T1
			value = 0
		}
		set_variable = {
			which = gold_tier
			value = 0
		}
		
		# Determine how many artifacts and how much gold you get
		while = {
			limit = {
				NOR = {
					check_variable = {
						which = dragons_hoard
						value = 0
					}
					AND = {
						is_variable_equal = {
							which = T5
							value = 3
						}
						is_variable_equal = {
							which = T3
							value = 4
						}
						is_variable_equal = {
							which = T1
							value = 5
						}
						is_variable_equal = {
							which = gold_tier
							value = 10
						}
					}
				}
			}
			change_variable = {
				which = dragons_hoard
				value = -10000
			}
			if = {
				limit = {
					NOT = {
						is_variable_equal = {
							which = T5
							value = 3
						}
					}
				}
				if = {
					limit = {
						is_variable_equal = {
							which = T5
							value = 0
						}
					}
					change_variable = {
						which = T5
						value = 1
					}
				}
				else = {
					random = {
						chance = 50
						change_variable = {
							which = T5
							value = 1
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						is_variable_equal = {
							which = T3
							value = 4
						}
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = T3
								value = 2
							}
						}
					}
					change_variable = {
						which = T3
						value = 1
					}
				}
				else = {
					random = {
						chance = 50
						change_variable = {
							which = T3
							value = 1
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						is_variable_equal = {
							which = T1
							value = 5
						}
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = T1
								value = 3
							}
						}
					}
					change_variable = {
						which = T1
						value = 1
					}
				}
				else = {
					random = {
						chance = 50
						change_variable = {
							which = T1
							value = 1
						}
					}
				}
			}
			if = {
				limit = {
					NOT = {
						is_variable_equal = {
							which = gold_tier
							value = 10
						}
					}
				}
				if = {
					limit = {
						NOT = {
							check_variable = {
								which = gold_tier
								value = 5
							}
						}
					}
					change_variable = {
						which = gold_tier
						value = 1
					}
				}
				else = {
					random = {
						chance = 50
						change_variable = {
							which = gold_tier
							value = 1
						}
					}
				}
			}
		}
		
		# Joke artifacts - up to 5
		while = {
			limit = {
				check_variable = {
					which = T1
					value = 1
				}
			}
			change_variable = {
				which = T1
				value = -1
			}
			random_list = {
				5 = {
					set_character_flag = got_incomplete_deck_of_cards
				}
				5 = {
					modifier = {
						factor = 0
						has_global_flag = talking_wand_exists
					}
					set_character_flag = got_talking_wand
					set_global_flag = talking_wand_exists
				}
				5 = {
					set_character_flag = got_book_of_burninating
				}
				5 = {
					set_character_flag = got_shiny_bauble
				}
				#5 = {
				#	set_character_flag = got_dragon_eggshell # Only in the lair
				#}
				5 = {
					set_character_flag = got_fantasy_world_map
				}
				5 = {
					set_character_flag = got_princess_doll
				}
				5 = {
					set_character_flag = got_hammer_of_banning
				}
			}
		}
		
		# Less powerful artifacts - up to 4
		while = {
			limit = {
				check_variable = {
					which = T3
					value = 1
				}
			}
			change_variable = {
				which = T3
				value = -1
			}
			random_list = {
				5 = {
					set_character_flag = got_the_plus_one_ring
				}
				5 = {
					set_character_flag = got_draught_of_healing
				}
				5 = {
					set_character_flag = got_dragonscale_shield
				}
				5 = {
					set_character_flag = got_sword_of_two_minds
				}
				5 = {
					set_character_flag = got_draconic_lineages
				}
				5 = {
					set_character_flag = got_ornate_holy_symbol
				}
				5 = {
					set_character_flag = got_prestigious_ring
				}
			}
		}
		
		# Very powerful artifacts - up to 3
		while = {
			limit = {
				check_variable = {
					which = T5
					value = 1
				}
			}
			change_variable = {
				which = T5
				value = -1
			}
			random_list = {
				5 = {
					modifier = {
						factor = 2
						trait = lunatic
					}
					modifier = {
						factor = 2
						trait = possessed
					}
					set_character_flag = got_sanitys_demise
				}
				5 = {
					modifier = {
						factor = 2
						religion = taoist # TODO: Update once a certain thing is added
					}
					set_character_flag = got_vial_of_immortality
				}
				5 = {
					modifier = {
						factor = 2
						trait = cruel
					}
					set_character_flag = got_living_flame
				}
				5 = {
					modifier = {
						factor = 2
						trait = cruel
					}
					set_character_flag = got_hungering_blade
				}
				5 = {
					modifier = {
						factor = 2
						is_feudal = yes
						can_have_chinese_imperial_trigger = yes
					}
					set_character_flag = got_deed_to_the_dragon_throne
				}
				5 = {
					modifier = {
						factor = 2
						has_education_diplomacy_trigger = yes
					}
					modifier = {
						factor = 2
						has_lifestyle_diplomacy_trigger = yes
					}
					set_character_flag = got_diplomacy_ring
				}
				5 = {
					modifier = {
						factor = 2
						has_education_martial_trigger = yes
					}
					modifier = {
						factor = 2
						has_lifestyle_martial_trigger = yes
					}
					set_character_flag = got_martial_ring
				}
				5 = {
					modifier = {
						factor = 2
						has_education_stewardship_trigger = yes
					}
					modifier = {
						factor = 2
						has_lifestyle_stewardship_trigger = yes
					}
					set_character_flag = got_stewardship_ring
				}
				5 = {
					modifier = {
						factor = 2
						has_education_intrigue_trigger = yes
					}
					modifier = {
						factor = 2
						has_lifestyle_intrigue_trigger = yes
					}
					set_character_flag = got_intrigue_ring
				}
				5 = {
					modifier = {
						factor = 2
						has_education_learning_trigger = yes
					}
					modifier = {
						factor = 2
						has_lifestyle_learning_trigger = yes
					}
					set_character_flag = got_learning_ring
				}
				5 = {
					modifier = {
						factor = 2
						culture = roman
					}
					modifier = {
						factor = 2
						OR = {
							has_landed_title = e_byzantium
							has_landed_title = e_roman_empire
							has_landed_title = e_nicaea
						}
					}
					modifier = {
						factor = 0 # German and Frankish pretenders need not apply!
						OR = {
							has_landed_title = e_hre
							has_landed_title = e_latin_empire
						}
					}
					set_character_flag = got_lost_roman_eagle
				}
			}
		}
		
		2861 = { # Chang'an
			persistent_event_target:dragons_lair_province = {
				province_event = { id = tianxia.393 days = 1 } # Remove the lair modifier
			}
		}
	}
	
	option = {
		name = EVTOPTA_TIANXIA_392 # This will be put to good use!
		
		# Gold
		if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 10
				}
			}
			wealth = 50000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 9
				}
			}
			wealth = 45000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 8
				}
			}
			wealth = 40000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 7
				}
			}
			wealth = 35000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 6
				}
			}
			wealth = 30000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 5
				}
			}
			wealth = 25000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 4
				}
			}
			wealth = 20000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 3
				}
			}
			wealth = 15000
		}
		else_if = {
			limit = {
				check_variable = {
					which = gold_tier
					value = 2
				}
			}
			wealth = 10000
		}
		else = {
			wealth = 5000
		}
		
		# Joke artifact
		if = {
			limit = {
				has_character_flag = got_incomplete_deck_of_cards
			}
			add_artifact = incomplete_deck_of_cards
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_talking_wand
			}
			add_artifact = talking_wand
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_book_of_burninating
			}
			add_artifact = book_of_burninating
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_shiny_bauble
			}
			add_artifact = shiny_bauble
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_fantasy_world_map
			}
			add_artifact = fantasy_world_map
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_princess_doll
			}
			add_artifact = princess_doll
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_hammer_of_banning
			}
			add_artifact = hammer_of_banning
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		
		# Less powerful artifact
		if = {
			limit = {
				has_character_flag = got_the_plus_one_ring
			}
			add_artifact = the_plus_one_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_draught_of_healing
			}
			add_artifact = draught_of_healing
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_dragonscale_shield
			}
			add_artifact = dragonscale_shield
			# Actually created at this date
		}
		if = {
			limit = {
				has_character_flag = got_sword_of_two_minds
			}
			add_artifact = sword_of_two_minds
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_draconic_lineages
			}
			add_artifact = draconic_lineages
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_ornate_holy_symbol
			}
			add_artifact = ornate_holy_symbol
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_prestigious_ring
			}
			add_artifact = prestigious_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		
		# Very powerful artifact
		if = {
			limit = {
				has_character_flag = got_sanitys_demise
			}
			add_artifact = sanitys_demise
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_vial_of_immortality
			}
			add_artifact = vial_of_immortality
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_living_flame
			}
			add_artifact = living_flame
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_hungering_blade
			}
			add_artifact = hungering_blade
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_deed_to_the_dragon_throne
			}
			add_artifact = deed_to_the_dragon_throne
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_diplomacy_ring
			}
			add_artifact = diplomacy_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_martial_ring
			}
			add_artifact = martial_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_stewardship_ring
			}
			add_artifact = stewardship_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_intrigue_ring
			}
			add_artifact = intrigue_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_learning_ring
			}
			add_artifact = learning_ring
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		if = {
			limit = {
				has_character_flag = got_lost_roman_eagle
			}
			add_artifact = lost_roman_eagle
			new_artifact = {
				set_creation_date = "-1.1.1"
			}
		}
		
		character_event = { id = tianxia.395 days = 180 random = 90 } # Cleanup
	}
}

# Clean up the lair modifier on the province
province_event = {
	id = tianxia.393
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		remove_province_modifier = dragons_lair
	}
}



##### Cleanup events

# Clean up flags - start and end
character_event = {
	id = tianxia.394
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		# Clear all flags!
		clr_character_flag = dragonslaying_rival_dragonslayer
		clr_character_flag = dragonslaying_prayed_at_shrine
		clr_character_flag = dragonslaying_tumbling_villagers
		clr_character_flag = dragonslaying_bandits
		clr_character_flag = dragonslaying_legend
		clr_character_flag = dragonslaying_disagreement
		clr_character_flag = dragonslaying_friendship
		clr_character_flag = dragonslaying_lover
		clr_character_flag = dragonslaying_mabs_offer
		clr_character_flag = dragonslaying_devastation
		clr_character_flag = dragonslaying_dodecahedron
		clr_character_flag = dragonslaying_assassin
		clr_character_flag = dragonslaying_old_ruins
		clr_character_flag = dragonslaying_merchant
		clr_character_flag = dragonslaying_preacher
		clr_character_flag = dragonslaying_recruited_dragonslayer
		clr_character_flag = dragonslaying_recruited_dragonslayer_2
		set_character_flag = dragonslaying_lose_stressed
		set_character_flag = dragonslaying_are_we_there_yet
		set_character_flag = dragonslaying_dirty
		set_character_flag = dragonslaying_hunter
		set_character_flag = dragonslaying_stubborn
		set_character_flag = dragonslaying_greed
		set_character_flag = dragonslaying_gamer
		set_character_flag = dragonslayer_strategist
		set_character_flag = dragonslaying_duelist
		set_character_flag = dragonslaying_taking_your_time

		clr_character_flag = dragonslayer_legend_great_advice
		clr_character_flag = dragonslayer_legend_good_advice
		clr_character_flag = dragonslayer_legend_bad_advice
		clr_character_flag = dragonslayer_legend_terrible_advice

		clr_character_flag = mabs_price_memories
		clr_character_flag = mabs_price_artifact
		clr_character_flag = mabs_price_firstborn
		clr_character_flag = mabs_price_health
		clr_character_flag = mabs_price_lover

		#clr_character_flag = mabs_boon
		#clr_character_flag = mabs_curse

		clr_character_flag = fragment_of_possibility

		clr_character_flag = secret_of_the_ruins

		clr_character_flag = minor_dragon_advice
		clr_character_flag = medium_dragon_advice

		clr_character_flag = in_dragons_lair_queue

		clr_character_flag = got_incomplete_deck_of_cards
		clr_character_flag = got_talking_wand
		clr_character_flag = got_book_of_burninating
		clr_character_flag = got_shiny_bauble
		clr_character_flag = got_dragon_eggshell
		clr_character_flag = got_fantasy_world_map
		clr_character_flag = got_princess_doll
		clr_character_flag = got_hammer_of_banning

		clr_character_flag = got_the_plus_one_ring
		clr_character_flag = got_draught_of_healing
		clr_character_flag = got_dragonscale_shield
		clr_character_flag = got_sword_of_two_minds
		clr_character_flag = got_draconic_lineages
		clr_character_flag = got_ornate_holy_symbol
		clr_character_flag = got_prestigious_ring
		clr_character_flag = got_gold

		clr_character_flag = dragon_combat_undecided
		clr_character_flag = killed_the_dragon

		clr_character_flag = got_sanitys_demise
		clr_character_flag = got_vial_of_immortality
		clr_character_flag = got_living_flame
		clr_character_flag = got_hungering_blade
		clr_character_flag = got_deed_to_the_dragon_throne
		clr_character_flag = got_diplomacy_ring
		clr_character_flag = got_martial_ring
		clr_character_flag = got_stewardship_ring
		clr_character_flag = got_intrigue_ring
		clr_character_flag = got_learning_ring
		clr_character_flag = got_lost_roman_eagle
		
		# Clear the generic dragonslayers, not the rest
		clr_character_flag = got_sir_genericus
		clr_character_flag = got_dame_generica
		
		clr_character_flag = do_not_disturb
	}
}

# Clean up traits and opinions - end
character_event = {
	id = tianxia.395
	desc = EVTDESC_TIANXIA_395
	picture = GFX_evt_relaxed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_TIANXIA_395 # Home at last!
		
		remove_trait = hunting_dragons
		character_event = { id = tianxia.394 } # Flag cleanup
		any_opinion_modifier_target = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			remove_trait = hunting_dragons
			remove_opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
		}
	}
}

# Clean up people stuck hunting dragons that get landed on_new_holder
character_event = {
	id = tianxia.396
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_opinion_modifier_target = {
			reverse_has_opinion_modifier = {
				who = ROOT
				modifier = hunting_dragons_together
			}
		}
	}
	
	immediate = {
		remove_trait = hunting_dragons
		clr_character_flag = do_not_disturb
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
		}
	}
}


# Clean up people stuck hunting dragons if 5 years have passed (should not be possible under normal circumstances unless there's a long queue at the lair, which the player gets to jump ahead in...)
character_event = {
	id = tianxia.397
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		remove_trait = hunting_dragons
		any_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = hunting_dragons_together
				}
			}
			remove_trait = hunting_dragons
			clr_character_flag = do_not_disturb
			reverse_remove_opinion = {
				who = ROOT
				modifier = hunting_dragons_together
			}
		}
	}
}

# Clean up ongoing_dragonslaying_attempt after a month, in case something weird happens
province_event = {
	id = tianxia.398
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				had_global_flag = { flag = ongoing_dragonslaying_attempt days = 30 }
			}
			clr_global_flag = ongoing_dragonslaying_attempt
		}
	}
}