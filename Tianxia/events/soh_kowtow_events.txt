# Additional Kowtow events

# by Silverswee(e)per

namespace = kowtow

### Lord invites you to stay at their castle

# Ask the lord if they want to invite the kowtow character
character_event = {
	id = kowtow.1
	title = EVTTITLE_KOWTOW_1
	desc = EVTDESC_KOWTOW_1
	picture = GFX_evt_courier
    border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_1 # Invite them in (no murder attempt)
		
		FROM = {
			character_event = {
				id = JD.32110 # Invite event
			}
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			is_rival = FROM
		}
		name = EVTOPTB_KOWTOW_1 # Invite them in and try to kill them
		
		opinion = {
			who = FROM
			modifier = opinion_kowtow_murder_target
		}
		
		FROM = {
			character_event = {
				id = JD.32110 # Invite event
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 10
				trait = deceitful
			}
			modifier = {
				factor = 0
				OR = {
					trait = honest
					trait = just
					trait = kind
				}
			}
		}
	}
	
	option = {
		trigger = {
			is_rival = FROM
		}
		name = EVTOPTC_KOWTOW_1 # Do not invite them
		
		FROM = {
			character_event = {
				id = JD.32005 # Back to the tombola
			}
		}
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 100
				trait = craven
			}
		}
	}
}

# If a murder attempt is made, who makes the attempt?
character_event = {
	id = kowtow.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			# Guest
			50 = {
				modifier = {
					factor = 0
					NOT = {
						reverse_has_opinion_modifier = {
							who = FROM
							modifier = opinion_kowtow_murder_target # The host isn't trying to murder ROOT
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						trait = schemer
					}
				}
				modifier = {
					factor = 0.5
					ROOT = {
						trait = schemer
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 30
					}
					NOT =  {
						intrigue = 25
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 25
					}
					NOT =  {
						intrigue = 20
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 20
					}
					NOT =  {
						intrigue = 15
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 15
					}
					NOT =  {
						intrigue = 10
					}
				}
				modifier = {
					factor = 2
					FROM = {
						intrigue = 10
					}
					NOT =  {
						intrigue = 5
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 25
						}
					}
					intrigue = 30
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 20
						}
					}
					intrigue = 25
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 15
						}
					}
					intrigue = 20
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 10
						}
					}
					intrigue = 15
				}
				modifier = {
					factor = 0.5
					FROM = {
						NOT = {
							intrigue = 5
						}
					}
					intrigue = 10
				}
				FROM = {
					narrative_event = { id = JD.32113 } # FROM attempts to murder ROOT
				}
			}
			# Host
			50 = {
				modifier = {
					factor = 0
					NOT = {
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_kowtow_murder_target # The host isn't trying to murder ROOT
						}
					}
				}
				modifier = {
					factor = 2
					FROM = {
						trait = schemer
					}
				}
				modifier = {
					factor = 0.5
					ROOT = {
						trait = schemer
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 30
					}
					NOT =  {
						intrigue = 25
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 25
					}
					NOT =  {
						intrigue = 20
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 20
					}
					NOT =  {
						intrigue = 15
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 15
					}
					NOT =  {
						intrigue = 10
					}
				}
				modifier = {
					factor = 0.5
					FROM = {
						intrigue = 10
					}
					NOT =  {
						intrigue = 5
					}
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 25
						}
					}
					intrigue = 30
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 20
						}
					}
					intrigue = 25
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 15
						}
					}
					intrigue = 20
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 10
						}
					}
					intrigue = 15
				}
				modifier = {
					factor = 2
					FROM = {
						NOT = {
							intrigue = 5
						}
					}
					intrigue = 10
				}
				narrative_event = { id = kowtow.3 } # ROOT attempts to murder FROM
			}
		}
	}
}

# The host attempts to murder the guest
narrative_event = {
	id = kowtow.3
	has_dlc = "Jade Dragon"
	
	title = EVTTITLE_JD_32113
	desc = {
		text = EVTDESCA_KOWTOW_3
		trigger = {
			has_character_flag = successful_murder
		}
	}
	desc = {
		text = EVTDESCB_KOWTOW_3
		trigger = {
			has_character_flag = murder_failed_got_caught
		}
	}
	desc = {
		text = EVTDESCC_KOWTOW_3
		trigger = {
			has_character_flag = murder_failed
		}
	}
	picture = GFX_evt_feast
    border = GFX_event_narrative_frame_intrigue
	
	portrait = FROMFROM
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			15 = { # Target dies
				modifier = {
					factor = 3
					intrigue = 18
				}
				modifier = {
					factor = 2
					trait = elusive_shadow
				}
				
				set_character_flag = successful_murder
			}
			30 = { # Target survives, got caught
				modifier = {
					factor = 0.6
					intrigue = 16
				}
				modifier = {
					factor = 0.5
					FROMFROM = {
						trait = trusting
					}
				}
				modifier = {
					factor = 3
					FROMFROM = {
						intrigue = 14
					}
				}
				modifier = {
					factor = 1.5
					FROMFROM = {
						trait = paranoid
					}
				}
				set_character_flag = murder_failed_got_caught
			}
			30 = { # Target survives, but attempt fails
				set_character_flag = murder_failed
			}
		}
	}
	
	option = {
		name = EVTOPTA_KOWTOW_3
		trigger = {
			has_character_flag = successful_murder
		}
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROMFROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			narrative_event = { id = kowtow.4 } # Inform guest
			death = {
				death_reason = death_murder_poison
				killer = ROOT
			}
		}
		change_intrigue = 1
	}
	option = {
		name = EVTOPTB_KOWTOW_3
		trigger = {
			has_character_flag = murder_failed_got_caught
		}
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROMFROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			narrative_event = { id = kowtow.4 } # Inform guest
		}
	}
	option = {
		name = EVTOPTC_KOWTOW_3
		trigger = {
			NOT = {
				has_character_flag = successful_murder
				has_character_flag = murder_failed_got_caught
			}
		}
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROMFROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			narrative_event = { id = kowtow.4 } # Inform guest
		}
	}
}

# Inform the guest of the outcome
narrative_event = {
	id = kowtow.4
	
	title = EVTTITLE_KOWTOW_4
	desc = {
		text = EVTDESCA_KOWTOW_4
		trigger = {
			FROM = {
				has_character_flag = successful_murder
			}
		}
	}
	desc = {
		text = EVTDESCB_KOWTOW_4
		trigger = {
			FROM = {
				has_character_flag = murder_failed_got_caught
			}
		}
	}
	desc = {
		text = EVTDESCC_KOWTOW_4
		trigger = {
			FROM = {
				has_character_flag = murder_failed
			}
		}
	}
	picture = GFX_evt_feast
    border = GFX_event_narrative_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_4 # Die
		trigger = {
			FROM = {
				has_character_flag = successful_murder
			}
		}
		
		# Fallout
		hidden_tooltip = {
			FROM = {
				if = {
					limit = { NOT = { has_character_modifier = known_murderer } }
					add_character_modifier = {
						name = known_murderer
						years = 50
					}
				}
			}
		
			FROM = {
				ROOT = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
			}
			
			any_liege = {
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { character = FROM }
						NOT = { is_close_relative = FROM }
					}
					opinion = {
						who = FROM
						modifier = opinion_regicide_traitor
					}
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
					if = {
						limit = { FROM = { any_spouse = { character = ROOT } } }
						opinion = {
							who = FROM
							modifier = opinion_spouse_slayer
							months = 60
						}
					}
				}
			}
			
			top_liege = {
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
				any_realm_lord = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			religion_head = {
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROM }
						NOT = { is_mother = FROM }
					}
				}
				mother = {
					opinion = {
						who = FROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROM
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROM }
						NOT = { is_father = FROM }
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROM
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROM }
					NOT = { is_child_of = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
				add_rival = FROM
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROM }
					NOT = { sibling = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
			}
		}
		
		death = {
			death_reason = death_murder_poison
			killer = FROM
		}
		FROM = {
			clr_character_flag = successful_murder
		}
	}
	
	option = {
		name = EVTOPTB_KOWTOW_4 # Fight!
		trigger = {
			has_character_flag = murder_failed_got_caught
			NOT = {
				trait = craven
			}
		}
		
		# Fallout
		opinion = {
			who = FROM
			modifier = opinion_murder_attempt
			months = 600
		}
		
		hidden_tooltip = {
			any_liege = {
				limit = {
					is_close_relative = ROOT
					NOT = { character = FROM }
					NOT = { dynasty = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROM }
						NOT = { is_mother = FROM }
					}
				}
				mother = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROM }
						NOT = { is_father = FROM }
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROM }
					NOT = { is_child_of = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_parent
					months = 120
				}
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROM }
					NOT = { sibling = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_sibling
					months = 60
				}
			}
		}
		
		# Guest is at a disadvantage because of host's home field advantage, but this is mostly based on WoL duel logic
		hidden_effect = {
			random_list = {
				80 = {
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 10 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 20 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 30 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 40 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 50 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 60 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 70 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 80 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 90 }
					}
					modifier = {
						factor = 0.7
						combat_rating_diff = { who = FROM value = 100 }
					}
					FROM = {
						narrative_event = { id = kowtow.12 } # Inform host that guest killed them
					}
					narrative_event = { id = kowtow.13 } # Inform guest that they killed host
				}
				
				20 = {
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 10 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 20 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 30 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 40 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 50 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 60 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 70 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 80 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 90 }
						}
					}
					modifier = {
						factor = 0.7
						FROM = {
							combat_rating_diff = { who = ROOT value = 100 }
						}
					}
					FROM = {
						narrative_event = { id = kowtow.14 } # Inform host that they killed guest
					}
					narrative_event = { id = kowtow.15 } # Inform guest that host killed them
				}
			}
		}
		
		FROM = {
			clr_character_flag = murder_failed_got_caught
		}
	}
	
	option = {
		name = EVTOPTC_KOWTOW_4 # Flee!
		trigger = {
			FROM = {
				has_character_flag = murder_failed_got_caught
			}
		}
		
		# Fallout
		opinion = {
			who = FROM
			modifier = opinion_murder_attempt
			months = 600
		}
		
		hidden_tooltip = {
			any_liege = {
				limit = {
					is_close_relative = FROM
					NOT = { character = FROM }
					NOT = { dynasty = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROM }
						NOT = { is_mother = FROM }
					}
				}
				mother = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROM }
						NOT = { is_father = FROM }
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROM }
					NOT = { is_child_of = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_parent
					months = 120
				}
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROM }
					NOT = { sibling = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_sibling
					months = 60
				}
			}
		}
		
		FROM = {
			clr_character_flag = murder_failed_got_caught
		}
		
		# Reuses logic from MNM assassins recruitment fleeing
		hidden_effect = {
			random_list = {
				#Getaway
				33 = {
					set_character_flag = escape_successful

					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 2 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 4 }
					}
					modifier = {
						factor = 1.4
						attribute_diff = { character = FROM attribute = intrigue value = 6 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 10 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 20 }
					}
					modifier = {
						factor = 1.4
						combat_rating_diff = { character = FROM value = 30 }
					}
				}
				#Injured
				33 = {
					set_character_flag = escape_injured
				}
				#Death
				33 = {
					set_character_flag = escape_death
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 2 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 4 } }
					}
					modifier = {
						factor = 1.4
						FROM = { attribute_diff = { character = ROOT attribute = intrigue value = 6 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 10 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 20 } }
					}
					modifier = {
						factor = 1.4
						FROM = { combat_rating_diff = { character = ROOT value = 30 } }
					}
				}
			}
			# Successful escape, but possibly injured
			if = {
				limit = {
					NOT = {
						has_character_flag = escape_death
					}
				}
				narrative_event = { id = kowtow.8 }
				FROM = {
					narrative_event = { id = kowtow.9 }
				}
				break = yes
			}
			# Died while fleeing
			narrative_event = { id = kowtow.10 }
			FROM = {
				narrative_event = { id = kowtow.11 }
			}
		}
	}
	
	option = {
		name = EVTOPTD_KOWTOW_4
		trigger = {
			FROM = {
				NOT = {
					has_character_flag = successful_murder
					has_character_flag = murder_failed_got_caught
				}
			}
		}
		
		return_to_travel_tombola_effect = yes
		
		FROM = {
			clr_character_flag = murder_failed
		}
	}
}

# Guest attempted to murder the host - inform host
narrative_event = {
	id = kowtow.5
	has_dlc = "Jade Dragon"
	
	title = EVTTITLE_JD_32113
	desc = {
		text = EVTDESCA_KOWTOW_5
		trigger = {
			has_character_flag = got_murdered
		}
	}
	desc = {
		text = EVTDESCB_KOWTOW_5
		trigger = {
			has_character_flag = got_murdered_murderer_got_caught
		}
	}
	desc = {
		text = EVTDESCC_KOWTOW_5
		trigger = {
			has_character_flag = no_murder_attacker_caught
		}
	}
	
	picture = GFX_evt_feast
    border = GFX_event_narrative_frame_intrigue
	
	portrait = FROM
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_5
		trigger = {
			has_character_flag = got_murdered
		}
		
		# Fallout
		hidden_tooltip = {
			FROM = {
				if = {
					limit = { NOT = { has_character_modifier = known_murderer } }
					add_character_modifier = {
						name = known_murderer
						years = 50
					}
				}
			}
		
			FROM = {
				ROOT = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
			}
			
			any_liege = {
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { character = FROM }
						NOT = { is_close_relative = FROM }
					}
					opinion = {
						who = FROM
						modifier = opinion_regicide_traitor
					}
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
					if = {
						limit = { FROM = { any_spouse = { character = ROOT } } }
						opinion = {
							who = FROM
							modifier = opinion_spouse_slayer
							months = 60
						}
					}
				}
			}
			
			top_liege = {
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
				any_realm_lord = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			religion_head = {
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROM }
						NOT = { is_mother = FROM }
					}
				}
				mother = {
					opinion = {
						who = FROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROM
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROM }
						NOT = { is_father = FROM }
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROM
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROM }
					NOT = { is_child_of = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
				add_rival = FROM
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROM }
					NOT = { sibling = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
			}
		}
		
		death = {
			death_reason = death_murder_poison
			killer = FROM
		}
	}
	
	option = {
		name = EVTOPTB_KOWTOW_5
		trigger = {
			has_character_flag = murder_failed_got_caught
		}
		
		# Fallout
		opinion = {
			who = FROM
			modifier = opinion_murder_attempt
			months = 600
		}
		
		hidden_tooltip = {
			any_liege = {
				limit = {
					is_close_relative = ROOT
					NOT = { character = FROM }
					NOT = { dynasty = FROM }
				}
				opinion = {
					who = FROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROM }
						NOT = { is_mother = FROM }
					}
				}
				mother = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROM }
						NOT = { is_father = FROM }
					}
				}
				father = {
					opinion = {
						who = FROM
						modifier = attempted_murder_of_child
						months = 120
					}
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROM }
					NOT = { is_child_of = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_parent
					months = 120
				}
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROM }
					NOT = { sibling = FROM }
				}
				opinion = {
					who = FROM
					modifier = attempted_murder_of_sibling
					months = 60
				}
			}
		}
		
		FROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_murder
				killer = ROOT
			}
		}
	}
	option = {
		name = EVTOPTC_KOWTOW_5
		trigger = {
			has_character_flag = no_murder_attacker_caught
		}
		FROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_murder
				killer = event_target:target_host
			}
		}
		
		clr_character_flag = no_murder_attacker_caught
	}
}

# Friendship formed - inform host
character_event = {
	id = kowtow.6
	title = EVTTITLE_KOWTOW_6
	desc = EVTDESC_KOWTOW_6
	picture = GFX_evt_feast
    border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_6
		add_friend = FROM
	}
}

# Normal evening - inform host
character_event = {
	id = kowtow.7
	title = EVTTITLE_KOWTOW_7
	desc = EVTDESC_KOWTOW_7
	picture = GFX_evt_feast
    border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_7
		if = {
			limit = {
				is_rival = FROM
			}
			remove_rival = FROM
		}
	}
}

# Guest successfully runs away - inform host
narrative_event = {
	id = kowtow.8
	title = EVTTITLE_KOWTOW_8
	desc = EVTDESC_KOWTOW_8
	picture = GFX_evt_burning_house
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_8
		
		prestige = -100
	}
}

# Guest successfully runs away - inform guest
narrative_event = {
	id = kowtow.9
	title = EVTTITLE_KOWTOW_9
	
	desc = {
		trigger = {
			has_character_flag = escape_successful
		}
		text = EVTDESCA_KOWTOW_9
	}
	desc = {
		trigger = {
			has_character_flag = escape_injured
		}
		text = EVTDESCB_KOWTOW_9
	}
	
	picture = "GFX_evt_hiding_from_pursuers"
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	
	option = {
		trigger = {
			has_character_flag = escape_successful
		}
		name = EVTOPTA_KOWTOW_9
		
		return_to_travel_tombola_effect = yes
		
		clr_character_flag = escape_successful
	}
	
	option = {
		trigger = {
			has_character_flag = escape_injured
		}
		name = EVTOPTB_KOWTOW_9

		add_maimed_trait_effect = yes
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
		}
		
		return_to_travel_tombola_effect = yes
		
		clr_character_flag =  escape_injured
	}
}

# Guest unsuccessfully runs away - inform host
narrative_event = {
	id = kowtow.10
	title = EVTTITLE_KOWTOW_10
	desc = EVTDESC_KOWTOW_10
	picture = GFX_evt_longbowman
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_10
		
		prestige = 100
		
		FROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_murder
				killer = ROOT
			}
		}
	}
}

# Guest unsuccessfully runs away - inform guest
narrative_event = {
	id = kowtow.11
	title = EVTTITLE_KOWTOW_11
	desc = EVTDESC_KOWTOW_11
	picture = GFX_event_longbowman
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_11
		
		prestige = 100
		
		# Fallout
		hidden_tooltip = {
			FROMFROM = {
				if = {
					limit = { NOT = { has_character_modifier = known_murderer } }
					add_character_modifier = {
						name = known_murderer
						years = 50
					}
				}
			}
		
			FROMFROM = {
				ROOT = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
			}
			
			any_liege = {
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { character = FROMFROM }
						NOT = { is_close_relative = FROMFROM }
					}
					opinion = {
						who = FROMFROM
						modifier = opinion_regicide_traitor
					}
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROMFROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROMFROM
						modifier = opinion_dishonorable
						months = 60
					}
					if = {
						limit = { FROMFROM = { any_spouse = { character = ROOT } } }
						opinion = {
							who = FROMFROM
							modifier = opinion_spouse_slayer
							months = 60
						}
					}
				}
			}
			
			top_liege = {
				opinion = {
					who = FROMFROM
					modifier = opinion_dishonorable
					months = 60
				}
				any_realm_lord = {
					opinion = {
						who = FROMFROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			religion_head = {
				opinion = {
					who = FROMFROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROMFROM }
						NOT = { is_mother = FROMFROM }
					}
				}
				mother = {
					opinion = {
						who = FROMFROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROMFROM
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROMFROM }
						NOT = { is_father = FROMFROM }
					}
				}
				father = {
					opinion = {
						who = FROMFROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROMFROM
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROMFROM }
					NOT = { is_child_of = FROMFROM }
				}
				opinion = {
					who = FROMFROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
				add_rival = FROMFROM
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROMFROM }
					NOT = { sibling = FROMFROM }
				}
				opinion = {
					who = FROMFROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
			}
		}
		
		death = {
			death_reason = death_murder
			killer = FROMFROM
		}
	}
}

# Guest kills host after bungled attempt by host - inform host
narrative_event = {
	id = kowtow.12
	title = EVTTITLE_KOWTOW_12
	desc = EVTDESC_KOWTOW_12
	picture = "GFX_evt_burning_house"
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_12
		
		death = {
			death_reason = death_duel
			killer = FROM
		}
	}
}

# Guest kills host after bungled attempt by host - inform guest
narrative_event = {
	id = kowtow.13
	title = EVTTITLE_KOWTOW_13
	desc = EVTDESC_KOWTOW_13
	picture = "GFX_evt_burning_house"
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_13
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROMFROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		prestige = 100
		
		return_to_travel_tombola_effect = yes
	}
}

# Host kills guest after bungled attempt by host - inform host
narrative_event = {
	id = kowtow.14
	title = EVTTITLE_KOWTOW_14
	desc = EVTDESC_KOWTOW_14
	picture = "GFX_evt_shadowy_cabal"
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_14
		
		FROMFROM = {
			if = {
				limit = {
					has_dlc = "Jade Dragon"
					# ROOT cannot be the EoC
				}
				# FROMFROM cannot be the EoC
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						any_close_relative = {
							dynasty = PREV
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_massive_effect = yes
					}
				}
				if = {
					limit = {
						is_chinese_emperor_trigger = no
						NOT = {
							any_close_relative = {
								dynasty = PREV
								is_chinese_emperor_trigger = yes
							}
						}
						any_dynasty_member = {
							is_chinese_emperor_trigger = yes
						}
					}
					ROOT = {
						detract_grace_major_effect = yes
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		prestige = 100
	}
}

# Host kills guest after bungled attempt by host - inform guest
narrative_event = {
	id = kowtow.15
	title = EVTTITLE_KOWTOW_15
	desc = EVTDESC_KOWTOW_15
	picture = "GFX_evt_shadowy_cabal"
    border = GFX_event_narrative_frame_intrigue
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_15
		
		# Fallout
		hidden_tooltip = {
			FROMFROM = {
				if = {
					limit = { NOT = { has_character_modifier = known_murderer } }
					add_character_modifier = {
						name = known_murderer
						years = 50
					}
				}
			}
		
			FROMFROM = {
				ROOT = { save_event_target_as = kinslayer_target }
				add_kinslayer_trait_effect = yes
			}
			
			any_liege = {
				if = {
					limit = {
						is_close_relative = ROOT
						NOT = { character = FROMFROM }
						NOT = { is_close_relative = FROMFROM }
					}
					opinion = {
						who = FROMFROM
						modifier = opinion_regicide_traitor
					}
				}
			}
			
			if = {
				limit = {
					NOT = { dynasty = FROMFROM }
				}
				any_dynasty_member = {
					opinion = {
						who = FROMFROM
						modifier = opinion_dishonorable
						months = 60
					}
					if = {
						limit = { FROMFROM = { any_spouse = { character = ROOT } } }
						opinion = {
							who = FROMFROM
							modifier = opinion_spouse_slayer
							months = 60
						}
					}
				}
			}
			
			top_liege = {
				opinion = {
					who = FROMFROM
					modifier = opinion_dishonorable
					months = 60
				}
				any_realm_lord = {
					opinion = {
						who = FROMFROM
						modifier = opinion_dishonorable
						months = 60
					}
				}
			}
			
			religion_head = {
				opinion = {
					who = FROMFROM
					modifier = opinion_dishonorable
					months = 60
				}
			}
			
			if = {
				limit = {
					mother = {
						NOT = { character = FROMFROM }
						NOT = { is_mother = FROMFROM }
					}
				}
				mother = {
					opinion = {
						who = FROMFROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROMFROM
				}
			}
			if = {
				limit = {
					father = {
						NOT = { character = FROMFROM }
						NOT = { is_father = FROMFROM }
					}
				}
				father = {
					opinion = {
						who = FROMFROM
						modifier = opinion_killed_close_kin
						months = 1200
					}
					add_rival = FROMFROM
				}
			}
			
			any_child = {
				limit = {
					NOT = { character = FROMFROM }
					NOT = { is_child_of = FROMFROM }
				}
				opinion = {
					who = FROMFROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
				add_rival = FROMFROM
			}
			
			any_sibling = {
				limit = {
					NOT = { character = FROMFROM }
					NOT = { sibling = FROMFROM }
				}
				opinion = {
					who = FROMFROM
					modifier = opinion_killed_close_kin
					months = 1200
				}
			}
		}
		
		death = {
			death_reason = death_duel
			killer = FROMFROM
		}
	}
}

# Inform host that guest refused to come
character_event = {
	id = kowtow.16
	desc = EVTDESC_KOWTOW_16
	picture = GFX_evt_emissary
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_16
		
		prestige = -25
		
		opinion = {
			who = FROM
			modifier = opinion_disappointed
		}
	}
}

### Meeting the EoC?

# Check if the EoC is available
character_event = {
	id = kowtow.17
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				e_china = {
					holder_scope = {
						prisoner = no
						NOT = {
							trait = incapable
						}
						is_inaccessible_trigger = no
						is_adult = yes
					}
				}
			}
			e_china = {
				holder_scope = {
					character_event = { id = kowtow.18 } # Ask EoC if he wants to meet ROOT personally
				}
			}
			break = yes
		}
		set_character_flag = no_emperor_meeting
		e_china = {
			holder_scope = {
				character_event = { id = kowtow.20 } # Ping the EoC
			}
		}
	}
}

# EoC gets to choose whether to meet FROM
character_event = {
	id = kowtow.18
	title = EVTTITLE_KOWTOW_18
	picture = GFX_evt_china_golden_age
    border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	desc = {
		text = EVTDESCA_KOWTOW_18 # You dislike FROM and should perhaps not meet them
		trigger = {
			china_hates_from_trigger = yes
		}
	}
	desc = {
		text = EVTDESCB_KOWTOW_18 # FROM is not impressing you
		trigger = {
			china_hates_from_trigger = no
			NOT = {
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 10
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCC_KOWTOW_18 # FROM is doing okay
		trigger = {
			china_hates_from_trigger = no
			FROM = {
				check_variable = {	
					which = kow_tow_emperor_impression_evaluation
					value = 10
				}
			}
			NOT = {
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 23
					}
				}
			}
		}
	}
	desc = {
		text = EVTDESCD_KOWTOW_18 # FROM is impressing you
		trigger = {
			china_hates_from_trigger = no
			FROM = {
				check_variable = {	
					which = kow_tow_emperor_impression_evaluation
					value = 23
				}
			}
		}
	}
	
	immediate = {
		FROM = {
			export_to_variable = {
				which = kow_tow_temp_calc
				value = diplomacy
			}
			divide_variable = {
				which = kow_tow_temp_calc
				value = 2
			}
			change_variable = {
				which = kow_tow_emperor_impression_evaluation
				which = kow_tow_temp_calc
			}
			set_variable = { # Clearing it for save game memory optimization
				which = kow_tow_temp_calc
				value = 0
			}
			if = {
				limit = {
					real_tier = KING
				}
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 7
				}
			}
			else_if = {
				limit = {
					real_tier = EMPEROR
				}
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 14
				}
			}
		}
		if = {
			limit = {
				china_hates_from_trigger = yes
			}
			FROM = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = -20
				}
			}
		}
		if = {
			limit = {
				NOT = {
					opinion = {
						who = FROM
						value = -25
					}
				}
			}
			FROM = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = -5
				}
			}
		}
		if = {
			limit = {
				is_rival = FROM
			}
			FROM = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = -100
				}
			}
		}
		if = {
			limit = {
				is_friend = FROM
			}
			FROM = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 50
				}
			}
		}
		if = {
			limit = {
				is_lover = FROM
			}
			FROM = {
				change_variable = {
					which = kow_tow_emperor_impression_evaluation
					value = 100
				}
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 23
					}
				}
			}
		}
		
		name = EVTOPTA_KOWTOW_18 # I have no interest in meeting FROM!
		
		ai_chance = {
			factor = 45
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 12
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 13
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 14
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 15
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 17
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 19
					}
				}
			}
			modifier = {
				factor = 0.85
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 21
					}
				}
			}
		}
		FROM = {
			set_character_flag = kow_tow_bad_outcome
			character_event = { id = JD.32290 } # Actual kowtow event
		}
	}
		
	option = {
		trigger = {
			china_hates_from_trigger = no
		}
		name = EVTOPTB_KOWTOW_18 # Let them kowtow before you, but have someone tell them to be quick about it
		
		ai_chance = {
			factor = 45
		}
		FROM = {
			set_character_flag = kow_tow_okay_outcome
			character_event = { id = JD.32290 } # Actual kowtow event
		}
	}
	
	option = {
		trigger = {
			china_hates_from_trigger = no
			FROM = {
				check_variable = {	
					which = kow_tow_emperor_impression_evaluation
					value = 10
				}
			}
		}
		name = EVTOPTC_KOWTOW_18 # I'm impressed; make sure they kowtow before me
		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 12
					}
				}
			}
			#modifier = {
			#	factor = 1.1
			#	check_variable = {	
			#		which = kow_tow_emperor_impression_evaluation
			#		value = 12
			#	}
			#}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 13
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 14
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 15
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 17
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 19
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 21
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 23
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 25
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 27
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 29
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 31
					}
				}
			}
			modifier = {
				factor = 1.1
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 33
					}
				}
			}
			modifier = {
				factor = 100
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 50
					}
				}
			}
			modifier = {
				factor = 1000
				FROM = {
					check_variable = {	
						which = kow_tow_emperor_impression_evaluation
						value = 100
					}
				}
			}
		}
		FROM = {
			set_character_flag = kow_tow_great_outcome
			character_event = { id = JD.32290 } # Actual kowtow event
		}
	}
	
	option = {
		trigger = {
			china_hates_from_trigger = yes
		}
		
		name = EVTOPTD_KOWTOW_18 # I'll meet FROM... in the dungeon!
		
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				NOR = {
					trait = arbitrary
					is_rival = FROM
					# China can "hate" FROM enough to refuse tributes without wanting to take action against FROM
					NOT = {
						opinion = {
							who = FROM
							value = -25
						}
					}
				}
			}
		}
		
		FROM = {
			character_event = { id = kowtow.19 }
		}
	}
}

# FROM is imprisoned by the EoC
character_event = {
	id = kowtow.19
	title = EVTTITLE_KOWTOW_19
	desc = EVTDESC_KOWTOW_19
	picture = GFX_evt_into_the_dungeon
    border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_KOWTOW_19 # This is bad...
		
		clean_up_after_kow_tow_effect = yes
		
		imprison = FROM # Imprisoned by the EoC
		remove_trait = kow_tow_travels
	}
}

# Ping event to ensure that scopes are correct
character_event = {
	id = kowtow.20
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = JD.32290 } # Actual kowtow event
		}
	}
}

# Hidden event to hand out monthly Grace post-kowtow
character_event = {
	id =  kowtow.21
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					trait = kow_tow_completed_tier_1
					trait = kow_tow_completed_tier_2
					trait = kow_tow_completed_tier_3
				}
			}
			if = {
				limit = {
					trait = kow_tow_completed_tier_1
				}
				change_variable = {
					which = grace
					value = 12
				}
			}
			if = {
				limit = {
					trait = kow_tow_completed_tier_2
				}
				change_variable = {
					which = grace
					value = 24
				}
			}
			if = {
				limit = {
					trait = kow_tow_completed_tier_3
				}
				change_variable = {
					which = grace
					value = 48
				}
			}
			repeat_event = { id = kowtow.21 days = 365 }
		}
	}
}