# TODO: Sort

change_boon_tribute_disabling_penalty_effect = {
	hidden_tooltip = {
		# Reset the variable
		set_variable = {
			which = penalty
			value = 0
		}
		# Check which flags are set
		if = {
			limit = {
				has_character_flag = china_no_gold_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_tributaries
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_horses_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_eunuch_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_concubine_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_commander_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_physician_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_relief_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_artifact_tributes
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_peace_deal_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_physician_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_artifact_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_siege_engineer_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_strategist_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_administrator_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_master_engineer_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_trade_contract_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_imperial_marriage_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		if = {
			limit = {
				has_character_flag = china_no_border_adjustment_boons
			}
			change_variable = {
				which = penalty
				value = 1
			}
		}
		# Check how big the penalty is and apply the correct modifier
		clear_boon_refusal_modifiers_effect = yes
		if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 0
				}
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 1
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_1
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 2
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_2
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 3
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_3
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 4
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_4
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 5
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_5
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 6
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_6
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 7
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_7
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 8
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_8
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 9
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_9
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 10
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_10
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 11
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_11
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 12
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_12
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 13
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_13
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 14
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_14
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 15
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_15
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 16
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_16
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 17
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_17
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 18
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_18
				duration = -1
			}
		}
		else_if = {
			limit = {
				is_variable_equal = {
					which = penalty
					value = 18
				}
			}
			add_character_modifier = {
				name = tribute_boon_refusal_19
				duration = -1
			}
		}
	}
}

clear_boon_refusal_modifiers_effect = {
	remove_character_modifier = tribute_boon_refusal_1
	remove_character_modifier = tribute_boon_refusal_2
	remove_character_modifier = tribute_boon_refusal_3
	remove_character_modifier = tribute_boon_refusal_4
	remove_character_modifier = tribute_boon_refusal_5
	remove_character_modifier = tribute_boon_refusal_6
	remove_character_modifier = tribute_boon_refusal_7
	remove_character_modifier = tribute_boon_refusal_8
	remove_character_modifier = tribute_boon_refusal_9
	remove_character_modifier = tribute_boon_refusal_10
	remove_character_modifier = tribute_boon_refusal_11
	remove_character_modifier = tribute_boon_refusal_12
	remove_character_modifier = tribute_boon_refusal_13
	remove_character_modifier = tribute_boon_refusal_14
	remove_character_modifier = tribute_boon_refusal_15
	remove_character_modifier = tribute_boon_refusal_16
	remove_character_modifier = tribute_boon_refusal_17
	remove_character_modifier = tribute_boon_refusal_18
	remove_character_modifier = tribute_boon_refusal_19
}


### Chinese Imperial Bloodline (real and pretender) creation

create_real_chinese_imperial_bloodline_effect = {
	if = {
		limit = {
			e_china = {
				has_title_flag = tang_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_tang
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_tang
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = jin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_jin
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_jin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = wei_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_wei
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_wei
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qi_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qi
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qi
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = zhou_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_zhou
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_zhou
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = han_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_han
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_han
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qin
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yan_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yan
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yan
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = zhao_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_zhao
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_zhao
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = liao_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_liao
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_liao
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yuan_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yuan
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yuan
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = xia_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_xia
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_xia
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qing_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qing
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_qing
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = dai_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_dai
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_dai
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = cheng_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_cheng
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_cheng
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = liang_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_liang
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_liang
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = song_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_song
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_song
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = ming_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_ming
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_ming
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = shu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_shu
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_shu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = wu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_wu
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_wu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = chu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_chu
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_chu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yue_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yue
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yue
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yin
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_yin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = shun_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_shun
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_shun
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = sui_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_sui
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_sui
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = min_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = real_chinese_imperial_bloodline_min
			}
		}
		else = {
			create_bloodline = {
				type = real_chinese_imperial_bloodline_min
				inheritance = matrilineal
			}
		}
	}
}

create_pretender_chinese_imperial_bloodline_effect = {
	if = {
		limit = {
			primary_title = {
				has_title_flag = tang_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_tang
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_tang
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = jin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_jin
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_jin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = wei_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_wei
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_wei
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = qi_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qi
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qi
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = zhou_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_zhou
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_zhou
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = han_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_han
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_han
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = qin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qin
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = yan_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yan
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yan
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = zhao_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_zhao
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_zhao
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = liao_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_liao
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_liao
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = yuan_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yuan
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yuan
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = xia_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_xia
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_xia
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = qing_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qing
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_qing
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = dai_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_dai
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_dai
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = cheng_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_cheng
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_cheng
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = liang_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_liang
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_liang
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = song_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_song
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_song
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = ming_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_ming
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_ming
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = shu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_shu
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_shu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = wu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_wu
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_wu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = chu_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_chu
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_chu
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = yue_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yue
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yue
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = yin_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yin
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_yin
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = shun_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_shun
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_shun
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = sui_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_sui
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_sui
				inheritance = matrilineal
			}
		}
	}
	else_if = {
		limit = {
			primary_title = {
				has_title_flag = min_china
			}
		}
		if = {
			limit = {
				is_female = no
			}
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_min
			}
		}
		else = {
			create_bloodline = {
				type = pretender_chinese_imperial_bloodline_min
				inheritance = matrilineal
			}
		}
	}
}

### Renaming China/pretender empire

update_global_china_name_flag_effect = {
	# Remove old flags
	clr_global_flag = tang_china_exists
	clr_global_flag = jin_china_exists
	clr_global_flag = wei_china_exists
	clr_global_flag = qi_china_exists
	clr_global_flag = zhou_china_exists
	clr_global_flag = han_china_exists
	clr_global_flag = qin_china_exists
	clr_global_flag = yan_china_exists
	clr_global_flag = zhao_china_exists
	clr_global_flag = liao_china_exists
	clr_global_flag = yuan_china_exists
	clr_global_flag = xia_china_exists
	clr_global_flag = qing_china_exists
	clr_global_flag = dai_china_exists
	clr_global_flag = cheng_china_exists
	clr_global_flag = liang_china_exists
	clr_global_flag = song_china_exists
	clr_global_flag = ming_china_exists
	clr_global_flag = shu_china_exists
	clr_global_flag = wu_china_exists
	clr_global_flag = chu_china_exists
	clr_global_flag = yue_china_exists
	clr_global_flag = yin_china_exists
	clr_global_flag = shun_china_exists
	clr_global_flag = sui_china_exists
	clr_global_flag = min_china_exists
	
	if = {
		limit = {
			e_china = {
				has_title_flag = tang_china
			}
		}
		set_global_flag = tang_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = jin_china
			}
		}
		set_global_flag = jin_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = wei_china
			}
		}
		set_global_flag = wei_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qi_china
			}
		}
		set_global_flag = qi_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = zhou_china
			}
		}
		set_global_flag = zhou_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = han_china
			}
		}
		set_global_flag = han_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qin_china
			}
		}
		set_global_flag = qin_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yan_china
			}
		}
		set_global_flag = yan_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = zhao_china
			}
		}
		set_global_flag = zhao_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = liao_china
			}
		}
		set_global_flag = liao_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yuan_china
			}
		}
		set_global_flag = yuan_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = xia_china
			}
		}
		set_global_flag = xia_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = qing_china
			}
		}
		set_global_flag = qing_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = dai_china
			}
		}
		set_global_flag = dai_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = cheng_china
			}
		}
		set_global_flag = cheng_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = liang_china
			}
		}
		set_global_flag = liang_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = song_china
			}
		}
		set_global_flag = song_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = ming_china
			}
		}
		set_global_flag = ming_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = shu_china
			}
		}
		set_global_flag = shu_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = wu_china
			}
		}
		set_global_flag = wu_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = chu_china
			}
		}
		set_global_flag = chu_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yue_china
			}
		}
		set_global_flag = yue_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = yin_china
			}
		}
		set_global_flag = yin_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = shun_china
			}
		}
		set_global_flag = shun_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = sui_china
			}
		}
		set_global_flag = sui_china_exists
	}
	else_if = {
		limit = {
			e_china = {
				has_title_flag = min_china
			}
		}
		set_global_flag = min_china_exists
	}
}

add_global_pretender_china_name_flag_effect = {
	if = {
		limit = {
			has_title_flag = tang_china
		}
		set_global_flag = pretender_tang_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = jin_china
		}
		set_global_flag = pretender_jin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = wei_china
		}
		set_global_flag = pretender_wei_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qi_china
		}
		set_global_flag = pretender_qi_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = zhou_china
		}
		set_global_flag = pretender_zhou_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = han_china
		}
		set_global_flag = pretender_han_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qin_china
		}
		set_global_flag = pretender_qin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yan_china
		}
		set_global_flag = pretender_yan_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = zhao_china
		}
		set_global_flag = pretender_zhao_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = liao_china
		}
		set_global_flag = pretender_liao_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yuan_china
		}
		set_global_flag = pretender_yuan_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = xia_china
		}
		set_global_flag = pretender_xia_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qing_china
		}
		set_global_flag = pretender_qing_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = dai_china
		}
		set_global_flag = pretender_dai_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = cheng_china
		}
		set_global_flag = pretender_cheng_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = liang_china
		}
		set_global_flag = pretender_liang_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = song_china
		}
		set_global_flag = pretender_song_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = ming_china
		}
		set_global_flag = pretender_ming_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = shu_china
		}
		set_global_flag = pretender_shu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = wu_china
		}
		set_global_flag = pretender_wu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = chu_china
		}
		set_global_flag = pretender_chu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yue_china
		}
		set_global_flag = pretender_yue_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yin_china
		}
		set_global_flag = pretender_yin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = shun_china
		}
		set_global_flag = pretender_shun_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = sui_china
		}
		set_global_flag = pretender_sui_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = min_china
		}
		set_global_flag = pretender_min_china_exists
	}
}

remove_global_pretender_china_name_flag_effect = {
	if = {
		limit = {
			has_title_flag = tang_china
		}
		clr_global_flag = pretender_tang_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = jin_china
		}
		clr_global_flag = pretender_jin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = wei_china
		}
		clr_global_flag = pretender_wei_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qi_china
		}
		clr_global_flag = pretender_qi_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = zhou_china
		}
		clr_global_flag = pretender_zhou_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = han_china
		}
		clr_global_flag = pretender_han_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qin_china
		}
		clr_global_flag = pretender_qin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yan_china
		}
		clr_global_flag = pretender_yan_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = zhao_china
		}
		clr_global_flag = pretender_zhao_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = liao_china
		}
		clr_global_flag = pretender_liao_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yuan_china
		}
		clr_global_flag = pretender_yuan_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = xia_china
		}
		clr_global_flag = pretender_xia_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = qing_china
		}
		clr_global_flag = pretender_qing_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = dai_china
		}
		clr_global_flag = pretender_dai_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = cheng_china
		}
		clr_global_flag = pretender_cheng_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = liang_china
		}
		clr_global_flag = pretender_liang_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = song_china
		}
		clr_global_flag = pretender_song_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = ming_china
		}
		clr_global_flag = pretender_ming_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = shu_china_china
		}
		clr_global_flag = pretender_shu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = wu_china
		}
		clr_global_flag = pretender_wu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = chu_china
		}
		clr_global_flag = pretender_chu_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yue_china
		}
		clr_global_flag = pretender_yue_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = yin_china
		}
		clr_global_flag = pretender_yin_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = shun_china
		}
		clr_global_flag = pretender_shun_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = sui_china
		}
		clr_global_flag = pretender_sui_china_exists
	}
	else_if = {
		limit = {
			has_title_flag = min_china
		}
		clr_global_flag = pretender_min_china_exists
	}
}

rename_china_after_pretender_title_or_bloodline_effect = {
	# Priority is as follows:
	# 1. Real CI bloodline and matching pretender empire name
	# 2. Real CI bloodline NOT matching pretender empire name (if not in use)
	# 3. Pretender CI bloodline matching pretender empire name
	# 4. Pretender bloodline NOT matching pretender empire name (if not in use)
	# 5. Pretender empire name
	# It should be impossible for none of the above to be true, since the fifth option always is on the table
	holder_scope = {
		if = {
			limit = {
				primary_title = {
					title_matches_my_real_chinese_bloodline_trigger = yes
				}
			}
			log = "China renamed after matching pretender empire + real bloodline!"
			primary_title = {
				rename_china_after_this_title_effect = yes
			}
		}
		else_if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = real_chinese_imperial_bloodline
					bloodline_could_name_china_trigger = yes
				}
			}
			log = "China renamed after random real bloodline!"
			random_owned_bloodline = {
				limit = {
					has_bloodline_flag = real_chinese_imperial_bloodline
					bloodline_could_name_china_trigger = yes
				}
				rename_china_after_this_bloodline_effect = yes
			}
		}
		else_if = {
			limit = {
				primary_title = {
					title_matches_my_chinese_bloodline_trigger = yes
				}
			}
			log = "China renamed after matching pretender empire + pretender bloodline!"
			primary_title = {
				rename_china_after_this_title_effect = yes
			}
		}
		else_if = {
			limit = {
				any_owned_bloodline = {
					has_bloodline_flag = pretender_chinese_imperial_bloodline
					bloodline_could_name_china_trigger = yes
				}
			}
			log = "China renamed after random pretender bloodline!"
			random_owned_bloodline = {
				limit = {
					has_bloodline_flag = pretender_chinese_imperial_bloodline
					bloodline_could_name_china_trigger = yes
				}
				rename_china_after_this_bloodline_effect = yes
			}
		}
		else = {
			log = "China renamed after pretender empire!"
			primary_title = {
				rename_china_after_this_title_effect = yes
			}
		}
	}
}

rename_china_after_this_title_effect = {
	if = {
		limit = {
			has_title_flag = tang_china
		}
		e_china = {
			set_name = "Tang"
			adjective = "Tang"
			set_title_flag = tang_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = jin_china
		}
		e_china = {
			set_name = "Jin"
			adjective = "Jin"
			set_title_flag = jin_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = wei_china
		}
		e_china = {
			set_name = "Wei"
			adjective = "Wei"
			set_title_flag = wei_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = qi_china
		}
		e_china = {
			set_name = "Qi"
			adjective = "Qi"
			set_title_flag = qi_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = zhou_china
		}
		e_china = {
			set_name = "Zhou"
			adjective = "Zhou"
			set_title_flag = zhou_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = han_china
		}
		e_china = {
			set_name = "Han"
			adjective = "Han"
			set_title_flag = han_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = qin_china
		}
		e_china = {
			set_name = "Qin"
			adjective = "Qin"
			set_title_flag = qin_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = yan_china
		}
		e_china = {
			set_name = "Yan"
			adjective = "Yan"
			set_title_flag = yan_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = zhao_china
		}
		e_china = {
			set_name = "Zhao"
			adjective = "Zhao"
			set_title_flag = zhao_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = liao_china
		}
		e_china = {
			set_name = "Liao"
			adjective = "Liao"
			set_title_flag = liao_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = yuan_china
		}
		e_china = {
			set_name = "Yuan"
			adjective = "Yuan"
			set_title_flag = yuan_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = xia_china
		}
		e_china = {
			set_name = "Xia"
			adjective = "Xia"
			set_title_flag = xia_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = qing_china
		}
		e_china = {
			set_name = "Qing"
			adjective = "Qing"
			set_title_flag = qing_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = dai_china
		}
		e_china = {
			set_name = "Dai"
			adjective = "Dai"
			set_title_flag = dai_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = cheng_china
		}
		e_china = {
			set_name = "Cheng"
			adjective = "Cheng"
			set_title_flag = cheng_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = liang_china
		}
		e_china = {
			set_name = "Liang"
			adjective = "Liang"
			set_title_flag = liang_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = song_china
		}
		e_china = {
			set_name = "Song"
			adjective = "Song"
			set_title_flag = song_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = ming_china
		}
		e_china = {
			set_name = "Ming"
			adjective = "Ming"
			set_title_flag = ming
		}
	}
	else_if = {
		limit = {
			has_title_flag = shu_china
		}
		e_china = {
			set_name = "Shu"
			adjective = "Shu"
			set_title_flag = shu_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = wu_china
		}
		e_china = {
			set_name = "Wu"
			adjective = "Wu"
			set_title_flag = wu_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = chu_china
		}
		e_china = {
			set_name = "Chu"
			adjective = "Chu"
			set_title_flag = chu_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = yue_china
		}
		e_china = {
			set_name = "Yue"
			adjective = "Yue"
			set_title_flag = yue_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = yin_china
		}
		e_china = {
			set_name = "Yin"
			adjective = "Yin"
			set_title_flag = yin_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = shun_china
		}
		e_china = {
			set_name = "Shun"
			adjective = "Shun"
			set_title_flag = shun_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = sui_china
		}
		e_china = {
			set_name = "Sui"
			adjective = "Sui"
			set_title_flag = sui_china
		}
	}
	else_if = {
		limit = {
			has_title_flag = min_china
		}
		e_china = {
			set_name = "Min"
			adjective = "Min"
			set_title_flag = min_china
		}
	}
	else = {
		log = "Failed to rename China after title!"
	}
}

rename_china_after_this_bloodline_effect = {
	if = {
		limit = {
			has_bloodline_flag = tang_china
		}
		e_china = {
			set_name = "Tang"
			adjective = "Tang"
			set_title_flag = tang_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = jin_china
		}
		e_china = {
			set_name = "Jin"
			adjective = "Jin"
			set_title_flag = jin_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = wei_china
		}
		e_china = {
			set_name = "Wei"
			adjective = "Wei"
			set_title_flag = wei_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = qi_china
		}
		e_china = {
			set_name = "Qi"
			adjective = "Qi"
			set_title_flag = qi_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = zhou_china
		}
		e_china = {
			set_name = "Zhou"
			adjective = "Zhou"
			set_title_flag = zhou_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = han_china
		}
		e_china = {
			set_name = "Han"
			adjective = "Han"
			set_title_flag = han_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = qin_china
		}
		e_china = {
			set_name = "Qin"
			adjective = "Qin"
			set_title_flag = qin_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = yan_china
		}
		e_china = {
			set_name = "Yan"
			adjective = "Yan"
			set_title_flag = yan_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = zhao_china
		}
		e_china = {
			set_name = "Zhao"
			adjective = "Zhao"
			set_title_flag = zhao_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = liao_china
		}
		e_china = {
			set_name = "Liao"
			adjective = "Liao"
			set_title_flag = liao_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = yuan_china
		}
		e_china = {
			set_name = "Yuan"
			adjective = "Yuan"
			set_title_flag = yuan_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = xia_china
		}
		e_china = {
			set_name = "Xia"
			adjective = "Xia"
			set_title_flag = xia_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = qing_china
		}
		e_china = {
			set_name = "Qing"
			adjective = "Qing"
			set_title_flag = qing_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = dai_china
		}
		e_china = {
			set_name = "Dai"
			adjective = "Dai"
			set_title_flag = dai_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = cheng_china
		}
		e_china = {
			set_name = "Cheng"
			adjective = "Cheng"
			set_title_flag = cheng_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = liang_china
		}
		e_china = {
			set_name = "Liang"
			adjective = "Liang"
			set_title_flag = liang_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = song_china
		}
		e_china = {
			set_name = "Song"
			adjective = "Song"
			set_title_flag = song_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = ming_china
		}
		e_china = {
			set_name = "Ming"
			adjective = "Ming"
			set_title_flag = ming
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = shu_china
		}
		e_china = {
			set_name = "Shu"
			adjective = "Shu"
			set_title_flag = shu_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = wu_china
		}
		e_china = {
			set_name = "Wu"
			adjective = "Wu"
			set_title_flag = wu_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = chu_china
		}
		e_china = {
			set_name = "Chu"
			adjective = "Chu"
			set_title_flag = chu_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = yue_china
		}
		e_china = {
			set_name = "Yue"
			adjective = "Yue"
			set_title_flag = yue_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = yin_china
		}
		e_china = {
			set_name = "Yin"
			adjective = "Yin"
			set_title_flag = yin_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = shun_china
		}
		e_china = {
			set_name = "Shun"
			adjective = "Shun"
			set_title_flag = shun_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = sui_china
		}
		e_china = {
			set_name = "Sui"
			adjective = "Sui"
			set_title_flag = sui_china
		}
	}
	else_if = {
		limit = {
			has_bloodline_flag = min_china
		}
		e_china = {
			set_name = "Min"
			adjective = "Min"
			set_title_flag = min_china
		}
	}
	else = {
		log = "Failed to rename China after bloodline!"
	}
}

create_new_court_eunuch_effect = {
	# Based on JD scholar-bureaucrats
	# Only fires if JD is active
	random_realm_province = {
		save_event_target_as = eunuch_origin
	}
	
	create_character = {
		age = 30
		dynasty = NONE
		religion = event_target:eunuch_origin
		culture = event_target:eunuch_origin
		female = no
		health = 6
		random_traits = yes
	}
	
	new_character = {
		# Randomize religion
		random = {
			chance = 25
			religion = ROOT
		}
		
		# Randomize culture
		random = {
			chance = 25
			culture = ROOT
		}
		
		# Randomize age
		random_list = {
			1 = {
				add_age = -10
			}
			5 = {
				add_age = -5
			}
			10 = {}
			15 = {
				add_age = 5
			}
			15 = {
				add_age = 10
			}
			15 = {
				add_age = 15
			}
			15 = {
				add_age = 20
			}
			10 = {
				add_age = 25
			}
			10 = {
				add_age = 30
			}
			10 = {
				add_age = 35
			}
			10 = {
				add_age = 40
			}
			5 = {
				add_age = 45
			}
			5 = {
				add_age = 50
			}
			2 = {
				add_age = 55
			}
			1 = {
				add_age = 60
			}
		}
		random_list = {
			10 =  {
				add_age = -4
			}
			10 =  {
				add_age = -3
			}
			10 =  {
				add_age = -2
			}
			10 =  {
				add_age = -1
			}
			10 =  {}
			10 =  {
				add_age = 1
			}
			10 =  {
				add_age = 2
			}
			10 =  {
				add_age = 3
			}
			10 =  {
				add_age = 4
			}
		}
		
		add_trait = eunuch # Important!
		
		#Education & other basic stuff
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = originated_from_chinese_court
		set_character_flag = no_court_invites
		random = {
			chance = 50
			remove_education_effect = yes
			random_list = {
				30 = { add_trait = thrifty_clerk }
				15 = { add_trait = fortune_builder }
				5 = { add_trait = midas_touched }
				30 = { add_trait = martial_cleric }
				15 = { add_trait = scholarly_theologian }
				5 = { add_trait = mastermind_theologian }
				30 = { add_trait = flamboyant_schemer }
				15 = { add_trait = intricate_webweaver }
				5 = { add_trait = elusive_shadow }
			}
		}
		random_list = {
			100 = { } #Nothing
			30 = { add_trait = erudite }
			25 = { add_trait = shrewd }
			15 = { add_trait = quick }
			5 = { add_trait = genius }
			5 = { add_trait = fair }
		}
		random_list = {
			85 = { } #Nothing
			1 = { add_trait = clubfooted }
			2 = { add_trait = harelip }
			2 = { add_trait = hunchback }
			3 = { add_trait = lisp }
			3 = { add_trait = stutter }
			2 = { 
				add_trait = ugly 
				remove_trait = fair 
			}
			1 = { add_trait = dwarf }
			1 = {  add_trait = weak }
		}
		random = {
			chance = 10
			add_trait = homosexual
		}

		#Add archetype 
		random_list = {
			#Conservative 
			25 = {
				set_character_flag = archetype_conservative
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = scholar }
						50 = { add_trait = administrator }
					}
				}
				random = {
					chance = 50
					add_trait = zealous
				}
				add_trait = stubborn
				add_trait = temperate
				random_list = {
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = deceitful }
					20 = { add_trait = shy }
					20 = { add_trait = cruel }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = chaste }
					25 = { 
						add_trait = patient
						remove_trait = wroth
					}
					25 = { add_trait = just }
				}
			}
			#Supportive
			25 = {
				set_character_flag = archetype_supportive
				if = {
					limit = { has_dlc = "Way of Life" }    
					random_list = {
						50 = { add_trait = administrator }
						25 = { add_trait = scholar }
						25 = { add_trait = gardener }
					}
				}
				add_trait = humble
				add_trait = patient
				random_list = {
					33 = { add_trait = slothful }
					33 = { add_trait = craven }
					33 = { add_trait = shy }
				}
				random_list = {
					25 = { add_trait = content }
					25 = { add_trait = charitable }
					25 = { add_trait = kind }
					25 = { add_trait = trusting }
				}      
			}
			#Decisive
			25 = {
				set_character_flag = archetype_decisive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						75 = { add_trait = administrator }
						25 = { add_trait = architect }
					}
				}
				add_trait = ambitious
				add_trait = cynical
				random_list = {
					20 = { add_trait = cruel }
					20 = { add_trait = stubborn }
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = proud }
				}
				random_list = {
					20 = { add_trait = falconer }
					20 = { add_trait = diligent }
					20 = { add_trait = brave }
					20 = { add_trait = honest }
					20 = { add_trait = gregarious }
				}    
			}
			#Sociable
			25 = {
				set_character_flag = archetype_sociable
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						25 = { add_trait = administrator }
						30 = { add_trait = socializer }
						25 = { add_trait = hedonist}
						20 = { # Technically fine...
							trigger = { is_female = no }
							add_trait = seducer
							add_trait = lustful
						}
					}
				}
				add_trait = gregarious
				add_trait = charitable
				random_list = {
					25 = { add_trait = craven }
					25 = { add_trait = envious }
					25 = { add_trait = gluttonous }
					25 = { add_trait = proud }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = kind }
					25 = { add_trait = honest }
					25 = { add_trait = lustful }
				}   
			}
			500 = {} # Nothing; random traits are set initially, so this could be good
		}
	}
}

give_tiered_tributary_grace_effect = {
	if = {
		limit = {
			is_tributary = {
				type = chinese_peripheral_tributary
			}
		}
		change_variable = {
			which = grace
			value = 12
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_imperial_tributary
			}
		}
		change_variable = {
			which = grace
			value = 24
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_protectorate
			}
		}
		change_variable = {
			which = grace
			value = 36
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_client_state
			}
		}
		change_variable = {
			which = grace
			value = 48
		}
	}
}

increase_tributary_tier_or_vassalize_effect = {
	save_event_target_as = target_tributary
	if = {
		limit = {
			is_tributary = {
				type = chinese_client_state
			}
		}
		any_vassal = {
			limit = {
				tier = king
			}
			set_defacto_liege = e_china
		}
		any_demesne_title = {
			limit = {
				tier = emperor
			}
			unsafe_destroy_landed_title = THIS
		}
		hidden_tooltip = {
			e_china = {
				holder_scope = {
					hidden_tooltip = {
						remove_tributary = event_target:target_tributary
					}
					remove_tributary = event_target:target_tributary
				}
			}
		}
		set_defacto_liege = e_china
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_protectorate
			}
		}
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_client_state
				}
			}
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_imperial_tributary
			}
		}
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	else = {
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	clear_event_target = target_tributary
}

increase_tributary_tier_or_vassalize_end_of_war_effect = {
	save_event_target_as = target_tributary
	if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_client_state
					}
				}
			}
		}
		any_vassal = {
			limit = {
				tier = king
			}
			set_defacto_liege = e_china
		}
		any_demesne_title = {
			limit = {
				tier = emperor
			}
			unsafe_destroy_landed_title = THIS
		}
		hidden_tooltip = {
			e_china = {
				holder_scope = {
					hidden_tooltip = {
						remove_tributary = event_target:target_tributary
						reverse_remove_opinion = {
							who = event_target:target_tributary
							modifier = i_was_client_state
						}
					}
					remove_tributary = event_target:target_tributary
				}
			}
		}
		set_defacto_liege = e_china
	}
	else_if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_protectorate
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_protectorate
					}
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_client_state
				}
			}
		}
	}
	else_if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_imperial_tributary
					}
				}
			}
		}
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_imperial_tributary
					}
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	else = {
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_misc_tributary
					}
				}
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	clear_event_target = target_tributary
}

decrease_tributary_tier_or_release_effect = {
	save_event_target_as = target_tributary
	if = {
		limit = {
			is_tributary = {
				type = chinese_client_state
			}
		}
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_protectorate
			}
		}
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_imperial_tributary
			}
		}
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_peripheral_tributary
				}
			}
		}
	}
	else = {
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
			opinion = {
				who = event_target:target_tributary
				modifier = opinion_china_breakaway_tributary
			}
		}
	}
	clear_event_target = target_tributary
}

clear_all_chinese_name_title_flags_effect = {
	clr_title_flag = tang_china
	clr_title_flag = jin_china
	clr_title_flag = wei_china
	clr_title_flag = qi_china
	clr_title_flag = zhou_china
	clr_title_flag = han_china
	clr_title_flag = qin_china
	clr_title_flag = yan_china
	clr_title_flag = zhao_china
	clr_title_flag = liao_china
	clr_title_flag = yuan_china
	clr_title_flag = xia_china
	clr_title_flag = qing_china
	clr_title_flag = dai_china
	clr_title_flag = cheng_china
	clr_title_flag = liang_china
	clr_title_flag = song_china
	clr_title_flag = ming_china
	clr_title_flag = shu_china
	clr_title_flag = wu_china
	clr_title_flag = chu_china
	clr_title_flag = yue_china
	clr_title_flag = yin_china
	clr_title_flag = shun_china
	clr_title_flag = sui_china
	clr_title_flag = min_china
}

sixteen_prefectures_transfer_effect = { # (Later) Jin/Tang to Liao
	log = "The Sixteen Prefectures are being handed over"
	# Kings
	any_realm_lord = {
		limit = {
			tier = king
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Liao tributary
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			# Take care of sub-vassals that shouldn't become Liao tributaries
			any_realm_lord = {
				limit = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
				log = "[This.GetBestName] remains with the Black Turtle!"
				set_defacto_liege = e_black_turtle
			}
			log = "[This.GetBestName] became a Liao tributary!"
			set_defacto_liege = THIS
			event_target:liao_emperor = {
				make_tributary = {
					who = PREV
					tributary_type = nomadic
				}
			}
		}
		# A new ruler is created as a Liao tributary
		else = {
			log = "[This.GetBestName] holds land elsewhere!"
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = ROOT
				culture = ROOT
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = liao_tributary_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:liao_tributary_character
			}
			event_target:liao_tributary_character = {
				log = "[This.GetBestName] is the actual Liao tributary!"
				set_defacto_liege = THIS
				event_target:liao_emperor = {
					make_tributary = {
						who = PREV
						tributary_type = nomadic
					}
				}
			}
		}
	}

	# Dukes
	any_realm_lord = {
		limit = {
			tier = duke
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Liao tributary
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			# Take care of sub-vassals that shouldn't become Liao tributaries
			any_realm_lord = {
				limit = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
				log = "[This.GetBestName] remains with the Black Turtle!"
				set_defacto_liege = e_black_turtle
			}
			log = "[This.GetBestName] became a Liao tributary!"
			set_defacto_liege = THIS
			event_target:liao_emperor = {
				make_tributary = {
					who = PREV
					tributary_type = nomadic
				}
			}
		}
		# A new ruler is created as a Liao tributary
		else = {
			log = "[This.GetBestName] holds land elsewhere!"
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = ROOT
				culture = ROOT
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = liao_tributary_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:liao_tributary_character
			}
			event_target:liao_tributary_character = {
				log = "[This.GetBestName] is the actual Liao tributary!"
				set_defacto_liege = THIS
				event_target:liao_emperor = {
					make_tributary = {
						who = PREV
						tributary_type = nomadic
					}
				}
			}
		}
	}

	# Counts
	any_realm_lord = {
		limit = {
			tier = count
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Liao tributary
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			log = "[This.GetBestName] became a Liao tributary!"
			set_defacto_liege = THIS
			event_target:liao_emperor = {
				make_tributary = {
					who = PREV
					tributary_type = nomadic
				}
			}
		}
		# A new ruler is created as a Liao tributary
		else = {
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = ROOT
				culture = ROOT
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = liao_tributary_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:liao_tributary_character
			}
			event_target:liao_tributary_character = {
				log = "[This.GetBestName] is the actual Liao tributary!"
				set_defacto_liege = THIS
				event_target:liao_emperor = {
					make_tributary = {
						who = PREV
						tributary_type = nomadic
					}
				}
			}
		}
	}

	# ROOT, if relevant
	if = {
		limit = {
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		# A new ruler is created as a Liao tributary
		create_random_soldier = {
			random_traits = yes
			dynasty = random
			religion = ROOT
			culture = ROOT
			female = no
			age = 25
		}
		new_character = {
			save_event_target_as = liao_tributary_character
		}
		any_demesne_title = {
			limit = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
			grant_title_no_opinion = event_target:liao_tributary_character
		}
		event_target:liao_tributary_character = {
			log = "[This.GetBestName] is the actual Liao tributary!"
			set_defacto_liege = THIS
			event_target:liao_emperor = {
				make_tributary = {
					who = PREV
					tributary_type = nomadic
				}
			}
		}
	}
}

sixteen_prefectures_transfer_2_effect = { # (Jurchen) Jin to Song
	log = "The Sixteen Prefectures are being handed over"
	# Kings
	any_realm_lord = {
		limit = {
			tier = king
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Song vassal
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			# Take care of sub-vassals that shouldn't become Song vassals
			any_realm_lord = {
				limit = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
				log = "[This.GetBestName] remains with Jurchen Jin!"
				set_defacto_liege = e_golden_river
			}
			log = "[This.GetBestName] became a Song vassal!"
			set_defacto_liege = e_china
		}
		# A new ruler is created as a Song vassal
		else = {
			log = "[This.GetBestName] holds land elsewhere!"
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = confucian
				culture = han
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = song_vassal_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:song_vassal_character
			}
			event_target:song_vassal_character = {
				log = "[This.GetBestName] is the actual Song vassal!"
				set_defacto_liege = e_china
			}
		}
	}

	# Dukes
	any_realm_lord = {
		limit = {
			tier = duke
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Song vassal
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			# Take care of sub-vassals that shouldn't become Liao tributaries
			any_realm_lord = {
				limit = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
				log = "[This.GetBestName] remains with Jurchen Jin!"
				set_defacto_liege = e_golden_river
			}
			log = "[This.GetBestName] became a Song vassal!"
			set_defacto_liege = e_china
		}
		# A new ruler is created as a Song vassal
		else = {
			log = "[This.GetBestName] holds land elsewhere!"
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = confucian
				culture = han
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = song_vassal_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:song_vassal_character
			}
			event_target:song_vassal_character = {
				log = "[This.GetBestName] is the actual Song vassal!"
				set_defacto_liege = e_china
			}
		}
	}

	# Counts
	any_realm_lord = {
		limit = {
			tier = count
			# Owns land in the Sixteen Prefectures
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		log = "[This.GetBestName] holds land in the Sixteen Prefectures!"
		# The vassal becomes a Song vassal
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOR = {
							title = c_wuzhai
							title = c_shuozhou
							title = c_datong
							title = c_dadu
							title = c_zhangjiakou
							title = c_chengde
							title = c_kaiping
						}
					}
				}
			}
			log = "[This.GetBestName] holds no land elsewhere!"
			log = "[This.GetBestName] became a Song vassal!"
			set_defacto_liege = e_china
		}
		# A new ruler is created as a Song vassal
		else = {
			create_random_soldier = {
				random_traits = yes
				dynasty = random
				religion = confucian
				culture = han
				female = no
				age = 25
			}
			new_character = {
				save_event_target_as = song_vassal_character
			}
			any_demesne_title = {
				limit = {
					OR = {
						title = c_wuzhai
						title = c_shuozhou
						title = c_datong
						title = c_dadu
						title = c_zhangjiakou
						title = c_chengde
						title = c_kaiping
					}
				}
				grant_title_no_opinion = event_target:song_vassal_character
			}
			event_target:song_vassal_character = {
				log = "[This.GetBestName] is the actual Song vassal!"
				set_defacto_liege = e_china
			}
		}
	}

	# ROOT, if relevant
	if = {
		limit = {
			any_demesne_title = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
		}
		# A new ruler is created as a Song vassal
		create_random_soldier = {
			random_traits = yes
			dynasty = random
			religion = confucian
			culture = han
			female = no
			age = 25
		}
		new_character = {
			save_event_target_as = song_vassal_character
		}
		any_demesne_title = {
			limit = {
				OR = {
					title = c_wuzhai
					title = c_shuozhou
					title = c_datong
					title = c_dadu
					title = c_zhangjiakou
					title = c_chengde
					title = c_kaiping
				}
			}
			grant_title_no_opinion = event_target:song_vassal_character
		}
		event_target:song_vassal_character = {
			log = "[This.GetBestName] is the actual Song vassal!"
			set_defacto_liege = e_china
		}
	}
}

create_chinese_strategist_effect = {
	random_list = {
		50 = { #Female
			modifier = {
				NOR = {
					has_game_rule = {
						name = gender
						value = all
					}
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_ryukyuan_three_mountains
					has_religion_feature = religion_feature_ryukyuan_historical
				}
				factor = 0
			}
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = yes
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = yes
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
		}
		50 = { #Male
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = no
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = no
					health = 7
					random_traits = no
					attributes = {
						martial = 6
						diplomacy = 2
						stewardship = 3
						intrigue = 4
						learning = 2
					}
				}
			}
		}
	}
	new_character = {
		#Education & other basic stuff
		save_event_target_as = chinese_strategist
		add_character_modifier = {
			name = jd_strategist
			duration = -1
		}
		if = {
			limit = {
				ROOT = { # TODO: Check appropriate character
					has_character_modifier = mandate_of_heaven_5
				}
			}
			random_list = {
				25 = {
					trigger = { NOT = {trait = master_of_flame } }
					add_trait = master_of_flame
				}
				25 = {
					trigger = { NOT = {trait = logistics_expert } }
					add_trait = logistics_expert
				}
				25 = {
					trigger = { NOT = {trait = levy_coordinator } }
					add_trait = levy_coordinator
				}
				25 = {
					trigger = { NOT = {trait = sapper } }
					add_trait = sapper
				}
			}
			set_character_flag = jd_strategist_golden_age
		}
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = originated_from_chinese_court
		set_character_flag = no_court_invites
		set_character_flag = is_chinese_strategist
		random_list = {
			80 = { add_trait = skilled_tactician }
			20 = { add_trait = brilliant_strategist }
		}
		random_list = {
			20 = { add_trait = brave } 
			20 = { add_trait = strong }
			20 = { add_trait = shrewd }
			40 = { add_trait = robust }
		}
		random_list = {
			71 = { } #Nothing
			20 = { add_trait = scarred }
			5 = { 
				trigger = { has_dlc = Reapers }
				add_trait = one_eyed 
				change_martial = 1
			}
			2 = { 
				trigger = { has_dlc = Reapers }
				add_trait = one_handed
				change_martial = 1
			}
			2 = { add_trait = ugly }
		}
		random = {
			chance = 10
			add_trait = homosexual
		}
		opinion = {
			who = ROOT
			modifier = opinion_servant
			months = 1200
		}

		#Add archetype 
		random_list = {
			#Conservative 
			25 = {
				set_character_flag = archetype_conservative
				if = {
					limit = { has_dlc = "Way of Life" }
					add_trait = strategist
				}
				add_trait = logistics_expert
				random = {
					chance = 50
					add_trait = zealous
				}
				add_trait = stubborn
				add_trait = temperate
				random_list = {
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = deceitful }
					20 = { add_trait = shy }
					20 = { add_trait = cruel }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = chaste }
					25 = { 
						add_trait = patient
						remove_trait = wroth
					}
					25 = { add_trait = just }
				}
			}
			#Supportive
			25 = {
				set_character_flag = archetype_supportive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = hunter }
						50 = { add_trait = strategist }
					}
				}
				add_trait = sapper 
				add_trait = humble
				add_trait = patient
				random_list = {
					30 = { add_trait = slothful }
					70 = { add_trait = shy }
				}
				random_list = {
					25 = { add_trait = content }
					25 = { add_trait = charitable }
					25 = { add_trait = kind }
					25 = { add_trait = trusting }
				}  
			}
			#Decisive
			25 = {
				set_character_flag = archetype_decisive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = strategist }
						50 = { add_trait = duelist }
					}
				}
				add_trait = master_of_flame 
				add_trait = ambitious
				add_trait = cynical
				random_list = {
					20 = { add_trait = cruel }
					20 = { add_trait = stubborn }
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = proud }
				}
				random_list = {
					20 = { add_trait = falconer }
					20 = { add_trait = diligent }
					20 = { add_trait = brave }
					20 = { add_trait = honest }
					20 = { add_trait = gregarious }
				}
			}
			#Sociable
			25 = {
				set_character_flag = archetype_sociable
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						20 = { add_trait = duelist }
						40 = { add_trait = hunter }
						40 = { add_trait = gamer }
					}
				}
				add_trait = levy_coordinator 
				add_trait = gregarious
				add_trait = charitable
				random_list = {
					33 = { add_trait = envious }
					33 = { add_trait = gluttonous }
					33 = { add_trait = proud }
				}
				random_list = {
					25 = { add_trait = falconer }
					25 = { add_trait = kind }
					25 = { add_trait = honest }
					25 = { add_trait = lustful }
				}   
			}
		}

		#Add second commander trait
		random_list = {
			10 = {
				trigger = { NOT = {trait = master_of_flame } }
				add_trait = master_of_flame
			}
			10 = {
				trigger = { NOT = {trait = logistics_expert } }
				add_trait = logistics_expert
			}
			10 = {
				trigger = { NOT = {trait = levy_coordinator } }
				add_trait = levy_coordinator
			}
			10 = {
				trigger = { NOT = {trait = sapper } }
				add_trait = sapper
			}
			60 = {}
		}
	}
	new_character = {
		save_event_target_as = new_strategist
	}
}

create_chinese_siege_engineer_effect = {
	random_list = {
		33 = {
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 55
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 16
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 55
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 16
						}
					}
				}
			}
			else = {
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 55
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 16
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 55
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 16
						}
					}
				}
			}
			new_character = {
				save_event_target_as = chinese_siege_engineer
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = originated_from_chinese_court
				set_character_flag = no_court_invites
				set_character_flag = taught_chinese_strategy
				set_character_flag = is_chinese_siege_engineer
				
				remove_trait = weak
				remove_trait = slow
				remove_trait = imbecile
				remove_trait = dull
				
				remove_trait = craven
				remove_trait = mystic
				remove_trait = socializer
				remove_trait = gamer
				remove_trait = hedonist
				remove_trait = duelist
				remove_trait = hunter
				remove_trait = strategist
				remove_trait = administrator
				remove_trait = architect
				remove_trait = gardener
				remove_trait = schemer
				remove_trait = impaler
				remove_trait = seducer
				remove_trait = seductress
				remove_trait = theologian
				remove_trait = scholar
				
				add_trait = sapper
				if = {
					limit = {
						ROOT = { # TODO: Check appropriate character
							has_character_modifier = mandate_of_heaven_5
						}
					}
					change_martial = 5
				}
				
				random_list = { # Flavor Randomization
					15 = {
						change_martial = 2
					}
					10 = {
						add_trait = robust
					}
					10 = {
						add_trait = duelist
					}
					10 = {
						add_trait = architect
					}
					5 = {
						add_trait = strategist
					}
					5 = {
						change_martial = 4
					}
					5 = {
						if = {
							limit = {
								has_dlc = "Reapers"
							}
							add_trait = one_eyed
						}
					}
					5 = { 
						add_trait = shrewd
					}
				}
				opinion = {
					who = ROOT
					modifier = opinion_servant
					months = 1200
				}
			}
		}
		33 = {
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 35
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 35
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
			}
			else = {
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 35
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 35
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
			}
			new_character = {
				save_event_target_as = chinese_siege_engineer
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = originated_from_chinese_court
				set_character_flag = no_court_invites
				set_character_flag = taught_chinese_strategy
				set_character_flag = is_chinese_siege_engineer
				
				remove_trait = weak
				remove_trait = slow
				remove_trait = imbecile
				remove_trait = dull
				
				remove_trait = craven
				remove_trait = mystic
				remove_trait = socializer
				remove_trait = gamer
				remove_trait = hedonist
				remove_trait = duelist
				remove_trait = hunter
				remove_trait = strategist
				remove_trait = administrator
				remove_trait = architect
				remove_trait = gardener
				remove_trait = schemer
				remove_trait = impaler
				remove_trait = seducer
				remove_trait = seductress
				remove_trait = theologian
				remove_trait = scholar
				
				add_trait = sapper
				random_list = { # Flavor Randomization
					15 = {
						change_martial = 2
					}
					10 = {
						add_trait = robust
					}
					10 = {
						add_trait = duelist
					}
					10 = {
						add_trait = architect
					}
					5 = {
						add_trait = strategist
					}
					5 = {
						change_martial = 4
					}
					5 = {
						if = {
							limit = {
								has_dlc = "Reapers"
							}
							add_trait = one_eyed
						}
					}
					5 = { 
						add_trait = shrewd
					}
				}
				opinion = {
					who = ROOT
					modifier = opinion_servant
					months = 1200
				}
			}
		}
		33 = {
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 37
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 37
						dynasty = actually_culture
						religion = ROOT
						culture = ROOT
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
			}
			else = {
				50 = { #Female
					modifier = {
						NOR = {
							has_game_rule = {
								name = gender
								value = all
							}
							primary_title = {
								has_law = status_of_women_4
							}
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_equal
							has_religion_feature = religion_feature_bon
							has_religion_feature = religion_feature_ryukyuan_three_mountains
							has_religion_feature = religion_feature_ryukyuan_historical
						}
						factor = 0
					}
					create_random_soldier = {
						age = 37
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = yes
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
				50 = {
					create_random_soldier = {
						age = 37
						dynasty = actually_culture
						religion = confucian
						culture = han
						female = no
						random_traits = yes
						attributes = {
							diplomacy = 2
							learning = 2
							stewardship = 2
							intrigue = 2
							martial = 8
						}
					}
				}
			}
			new_character = {
				save_event_target_as = chinese_siege_engineer
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = originated_from_chinese_court
				set_character_flag = no_court_invites
				set_character_flag = taught_chinese_strategy
				set_character_flag = is_chinese_siege_engineer
				
				remove_trait = weak
				remove_trait = slow
				remove_trait = imbecile
				remove_trait = dull
				
				remove_trait = craven
				remove_trait = mystic
				remove_trait = socializer
				remove_trait = gamer
				remove_trait = hedonist
				remove_trait = duelist
				remove_trait = hunter
				remove_trait = strategist
				remove_trait = administrator
				remove_trait = architect
				remove_trait = gardener
				remove_trait = schemer
				remove_trait = impaler
				remove_trait = seducer
				remove_trait = seductress
				remove_trait = theologian
				remove_trait = scholar
				
				add_trait = sapper
				
				random_list = { # Flavor Randomization
					15 = {
						change_martial = 2
					}
					10 = {
						add_trait = robust
					}
					10 = {
						add_trait = duelist
					}
					10 = {
						add_trait = architect
					}
					5 = {
						add_trait = strategist
					}
					5 = {
						change_martial = 4
					}
					5 = {
						if = {
							limit = {
								has_dlc = "Reapers"
							}
							add_trait = one_eyed
						}
					}
					5 = { 
						add_trait = shrewd
					}
				}
				opinion = {
					who = ROOT
					modifier = opinion_servant
					months = 1200
				}
			}
		}
	}
	new_character = {
		save_event_target_as = new_siege_engineer
	}
}

create_chinese_administrator_effect = {
	random_list = {
		50 = { #Female
			modifier = {
				NOR = {
					has_game_rule = {
						name = gender
						value = all
					}
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_ryukyuan_three_mountains
					has_religion_feature = religion_feature_ryukyuan_historical
				}
				factor = 0.05
			}
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
		}
		50 = { #Male
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 4
						stewardship = 6
						intrigue = 2
						learning = 5
					}
				}
			}
		}
	}
	new_character = {
		#Education & other basic stuff
		save_event_target_as = chinese_administrator
		add_character_modifier = {
			name = jd_administrator
			duration = -1
		}
		if = {
			limit = {
				ROOT = { # TODO: Check appropriate character
					has_character_modifier = mandate_of_heaven_5
				}
			}
			set_character_flag = jd_administrator_golden_age
		}
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = originated_from_chinese_court
		set_character_flag = no_court_invites
		set_character_flag = is_chinese_administrator
		random_list = {
			30 = { add_trait = thrifty_clerk }
			15 = { add_trait = fortune_builder }
			5 = { add_trait = midas_touched }
			30 = { add_trait = martial_cleric }
			15 = { add_trait = scholarly_theologian }
			5 = { add_trait = mastermind_theologian }
		}
		random_list = {
			20 = { } #Nothing
			30 = { add_trait = erudite }
			25 = { add_trait = shrewd }
			15 = { add_trait = quick }
			5 = { add_trait = genius }
			5 = { add_trait = fair }
		}
		random_list = {
			85 = { } #Nothing
			1 = { add_trait = clubfooted }
			2 = { add_trait = harelip }
			2 = { add_trait = hunchback }
			3 = { add_trait = lisp }
			3 = { add_trait = stutter }
			2 = { 
				add_trait = ugly 
				remove_trait = fair 
			}
			1 = { add_trait = dwarf }
			1 = {  add_trait = weak }
		}
		random = {
			chance = 10
			add_trait = homosexual
		}
		opinion = {
			who = ROOT
			modifier = opinion_servant
			months = 1200
		}

		#Add archetype 
		random_list = {
			#Conservative 
			25 = {
				set_character_flag = archetype_conservative
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = scholar }
						50 = { add_trait = administrator }
					}
				}
				random = {
					chance = 50
					add_trait = zealous
				}
				add_trait = stubborn
				add_trait = temperate
				random_list = {
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = deceitful }
					20 = { add_trait = shy }
					20 = { add_trait = cruel }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = chaste }
					25 = { 
						add_trait = patient
						remove_trait = wroth
					}
					25 = { add_trait = just }
				}
			}
			#Supportive
			25 = {
				set_character_flag = archetype_supportive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = administrator }
						25 = { add_trait = scholar }
						25 = { add_trait = gardener }
					}
				}
				add_trait = humble
				add_trait = patient
				random_list = {
					33 = { add_trait = slothful }
					33 = { add_trait = craven }
					33 = { add_trait = shy }
				}
				random_list = {
					25 = { add_trait = content }
					25 = { add_trait = charitable }
					25 = { add_trait = kind }
					25 = { add_trait = trusting }
				}  
			}
			#Decisive
			25 = {
				set_character_flag = archetype_decisive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						75 = { add_trait = administrator }
						25 = { add_trait = architect }
					}
				}
				add_trait = ambitious
				add_trait = cynical
				random_list = {
					20 = { add_trait = cruel }
					20 = { add_trait = stubborn }
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = proud }
				}
				random_list = {
					20 = { add_trait = falconer }
					20 = { add_trait = diligent }
					20 = { add_trait = brave }
					20 = { add_trait = honest }
					20 = { add_trait = gregarious }
				}
			}
			#Sociable
			25 = {
				set_character_flag = archetype_sociable
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						25 = { add_trait = administrator }
						30 = { add_trait = socializer }
						25 = { add_trait = hedonist}
						20 = {
							trigger = { is_female = yes }
							add_trait = seductress
							add_trait = lustful
						}
						20 = {
							trigger = { is_female = no }
							add_trait = seducer
							add_trait = lustful
						}
					}
				}
				add_trait = gregarious
				add_trait = charitable
				random_list = {
					25 = { add_trait = craven }
					25 = { add_trait = envious }
					25 = { add_trait = gluttonous }
					25 = { add_trait = proud }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = kind }
					25 = { add_trait = honest }
					25 = { add_trait = lustful }
				}   
			}
		}
	}
	new_character = {
		save_event_target_as = new_administrator
	}
}

create_chinese_master_engineer_effect = {
	random_list = {
		50 = { #Female
			modifier = {
				NOR = {
					has_game_rule = {
						name = gender
						value = all
					}
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_ryukyuan_three_mountains
					has_religion_feature = religion_feature_ryukyuan_historical
				}
				factor = 0.05
			}
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
		}
		50 = { #Male
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
			else = {
				create_character = {
					age = 30
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 5
						diplomacy = 2
						stewardship = 6
						intrigue = 3
						learning = 3
					}
				}
			}
		}
	}
	new_character = {
		#Education & other basic stuff
		save_event_target_as = chinese_master_engineer
		add_character_modifier = {
			name = jd_master_engineer
			duration = -1
		}
		set_character_flag = master_engineer_just_spawned
		if = {
			limit = {
				ROOT = { # TODO: Check appropriate character
					has_character_modifier = mandate_of_heaven_5
				}
			}
			set_character_flag = china_master_engineer_golden_age
		}
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = originated_from_chinese_court
		set_character_flag = no_court_invites
		set_character_flag = is_chinese_master_engineer
		random_list = {
			30 = { add_trait = thrifty_clerk }
			15 = { add_trait = fortune_builder }
			5 = { add_trait = midas_touched }
			30 = { add_trait = tough_soldier }
			15 = { add_trait = skilled_tactician }
			5 = { add_trait = brilliant_strategist }
		}
		random_list = {
			20 = { } #Nothing
			20 = { add_trait = erudite }
			20 = { add_trait = shrewd }
			15 = { add_trait = quick }
			5 = { add_trait = genius }
			10 = { add_trait = robust }
			5 = { add_trait = strong }
			5 = { add_trait = fair }
		}
		random_list = {
			85 = { } #Nothing
			1 = { add_trait = clubfooted }
			2 = { add_trait = harelip }
			2 = { add_trait = hunchback }
			3 = { add_trait = lisp }
			3 = { add_trait = stutter }
			2 = { 
				add_trait = ugly 
				remove_trait = fair 
			}
			1 = { add_trait = dwarf }
			1 = { 
				add_trait = weak 
				remove_trait = strong 
				remove_trait = robust
			}
		}
		random = {
			chance = 10
			add_trait = homosexual
		}
		opinion = {
			who = ROOT
			modifier = opinion_servant
			months = 1200
		}

		#Add archetype 
		random_list = {
			#Conservative
			25 = {
				set_character_flag = archetype_conservative
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						75 = { add_trait = architect }
						25 = { add_trait = theologian }
					}
				}
				random = {
					chance = 50
					add_trait = zealous
				}
				add_trait = stubborn
				add_trait = temperate
				random_list = {
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = deceitful }
					20 = { add_trait = shy }
					20 = { add_trait = cruel }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = chaste }
					25 = { 
						add_trait = patient
						remove_trait = wroth
					}
					25 = { add_trait = just }
				}
			}
			#Supportive
			25 = {
				set_character_flag = archetype_supportive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = architect }
						25 = { add_trait = socializer }
						25 = { add_trait = gardener }
					}
				}
				add_trait = humble
				add_trait = patient
				random_list = {
					33 = { add_trait = slothful }
					33 = { add_trait = craven }
					33 = { add_trait = shy }
				}
				random_list = {
					25 = { add_trait = content }
					25 = { add_trait = charitable }
					25 = { add_trait = kind }
					25 = { add_trait = trusting }
				}  
			}
			#Decisive
			25 = {
				set_character_flag = archetype_decisive
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						50 = { add_trait = architect }
						50 = { add_trait = strategist }
					}
				}
				add_trait = ambitious
				add_trait = cynical
				random_list = {
					20 = { add_trait = cruel }
					20 = { add_trait = stubborn }
					20 = { add_trait = greedy }
					20 = { add_trait = wroth }
					20 = { add_trait = proud }
				}
				random_list = {
					20 = { add_trait = falconer }
					20 = { add_trait = diligent }
					20 = { add_trait = brave }
					20 = { add_trait = honest }
					20 = { add_trait = gregarious }
				}
			}
			#Sociable
			25 = {
				set_character_flag = archetype_sociable
				if = {
					limit = { has_dlc = "Way of Life" }
					random_list = {
						25 = { add_trait = architect }
						30 = { add_trait = socializer }
						25 = { add_trait = hedonist}
						20 = {
							trigger = { is_female = yes }
							add_trait = seductress
							add_trait = lustful
						}
						20 = {
							trigger = { is_female = no }
							add_trait = seducer
							add_trait = lustful
						}
					}
				}
				add_trait = gregarious
				add_trait = charitable
				random_list = {
					25 = { add_trait = craven }
					25 = { add_trait = envious }
					25 = { add_trait = gluttonous }
					25 = { add_trait = proud }
				}
				random_list = {
					25 = { add_trait = poet }
					25 = { add_trait = kind }
					25 = { add_trait = honest }
					25 = { add_trait = lustful }
				}
			}
		}
	}
	new_character = {
		save_event_target_as = new_master_engineer
	}
}

create_chinese_physician_effect = {
	random_list = {
		50 = { #Female
			modifier = {
				NOR = {
					has_game_rule = {
						name = gender
						value = all
					}
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_ryukyuan_three_mountains
					has_religion_feature = religion_feature_ryukyuan_historical
				}
				factor = 0.05
			}
		}
		50 = { #Female
			modifier = {
				NOR = {
					has_game_rule = {
						name = gender
						value = all
					}
					primary_title = {
						has_law = status_of_women_4
					}
					has_religion_feature = religion_matriarchal
					has_religion_feature = religion_equal
					has_religion_feature = religion_feature_bon
					has_religion_feature = religion_feature_ryukyuan_three_mountains
					has_religion_feature = religion_feature_ryukyuan_historical
				}
				factor = 0.05
			}
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
			else = {
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = yes
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
		}
		50 = { #Male
			if = {
				limit = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					can_have_confucian_bureaucracy_and_eastern_imperial_only_religion_trigger = yes
				}
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = ROOT
					culture = ROOT
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
			else = {
				create_character = {
					age = 35
					dynasty = actually_culture
					religion = confucian
					culture = han
					female = no
					health = 6
					random_traits = no
					attributes = {
						martial = 2
						diplomacy = 5
						stewardship = 3
						intrigue = 3
						learning = 6
					}
				}
			}
		}
	}
	new_character = {
		#Education & other basic stuff
		set_character_flag = ai_flag_refuse_concubinage
		set_character_flag = ai_flag_refuse_marriage
		set_character_flag = originated_from_chinese_court
		set_character_flag = no_court_invites
		set_character_flag = is_chinese_physician
		random_list = {
			50 = { add_trait = scholarly_theologian }
			25 = { add_trait = mastermind_theologian }
		}
		add_trait = physician
		random_list = {
			20 = { } #Nothing
			30 = { add_trait = erudite }
			30 = { add_trait = shrewd }
			15 = { add_trait = quick }
			5 = { add_trait = genius }
		}
		random_list = {
			80 = { } #Nothing
			2 = { add_trait = clubfooted }
			2 = { add_trait = harelip }
			2 = { add_trait = hunchback }
			4 = { add_trait = lisp }
			4 = { add_trait = stutter }
			2 = { add_trait = ugly }
			2 = { add_trait = dwarf }
			2 = { add_trait = weak }
		}
		random_list = {
			50 = { } #Nothing
			25 = { add_trait = patient }
			25 = { add_trait = diligent }
		}
		random = {
			chance = 10
			add_trait = homosexual
		}
		opinion = {
			who = ROOT
			modifier = opinion_servant
			months = 1200
		}

		#Add archetype 
		random_list = {
			20 = { #Combat medic
				set_character_flag = archetype_decisive
				random_list = {
					50 = { add_trait = duelist }
					50 = { add_trait = scholar }
				}
				add_trait = scarred
				add_trait = robust
				random_list = {
					60 = { } #Nothing
					20 = { 
						trigger = { has_dlc = Reapers }
						add_trait = one_legged 
					}
					20 = { 
						trigger = { has_dlc = Reapers }
						add_trait = one_eyed 
					}
				}
				add_trait = brave
				random_list = {
					30 = { } #Nothing
					50 = { add_trait = cynical }
					10 = {
						add_trait = cynical
						add_trait = depressed
					}
					10 = {
						add_trait = cynical
						add_trait = depressed
						add_trait = drunkard
					}
				}
				random_list = {
					50 = { } #Nothing
					20 = { add_trait = kind }
					30 = { add_trait = honest }
				}
				remove_trait = dwarf
				remove_trait = weak
			}
			#Dr Jerk
			15 = { 
				set_character_flag = archetype_decisive
				add_trait = scholar
				add_trait = wroth
				remove_trait = patient
				random_list = {
					30 = { add_trait = proud }
					30 = { add_trait = envious }
					40 = { } #Nothing
				}
				add_trait = honest
				add_trait = cynical
				random = {
					chance = 30
					add_trait = drunkard
				}
				random_list = {
					60 = { }
					20 = { 
						add_trait = clubfooted
						set_name = Wu #House
					}
					20 = {
						trigger = { has_dlc = Reapers }
						add_trait = one_legged
						set_name = Wu #House
					}
				}
			}
			10 = { #Mad genius 
				set_character_flag = archetype_sociable
				random_list = {
					50 = { add_trait = impaler }
					50 = { add_trait = mystic }
				}
				random_list = {
					33 = { add_trait = drunkard } 
					33 = { add_trait = lunatic }
					33 = { add_trait = possessed }
				}
				add_trait = genius
				remove_trait = quick
				remove_trait = shrewd
				add_trait = paranoid
				random_list = {
					25 = { add_trait = gluttonous } 
					25 = { add_trait = wroth }
					25 = { add_trait = proud }
					25 = { add_trait = greedy }
				}   
			}
			20 = { #Herbalist
				set_character_flag = archetype_supportive
				add_trait = gardener
				add_trait = diligent
				add_trait = humble
				random_list = {
					33 = { add_trait = content } 
					33 = { add_trait = shy }
					33 = { add_trait = poet }
				}
				random = {
					chance = 50
					add_trait = robust
				}
				remove_trait = weak
			}
			20 = { #Health nut
				set_character_flag = archetype_conservative
				add_trait = mystic
				add_trait = celibate
				add_trait = chaste
				add_trait = temperate
				random_list = {
					50 = { add_trait = craven } 
					25 = { add_trait = shy }
					25 = { add_trait = content }
				}
				set_focus = focus_scholarship
			}
			20 = { #Compassionate doctor
				set_character_flag = archetype_supportive
				random_list = {
					50 = { add_trait = socializer }
					50 = { add_trait = scholar }
				}
				add_trait = kind
				add_trait = patient
				random_list = {
					25 = { add_trait = content } 
					25 = { add_trait = humble }
					25 = { add_trait = trusting }
					25 = { add_trait = charitable }
				}
				set_focus = focus_family
			}
			15 = { #McDreamy
				set_character_flag = archetype_sociable
				if = {
					limit = { is_female = yes }
					add_trait = seductress
				}
				if = {
					limit = { is_female = no }
					add_trait = seducer
				}
				random_list = {
					50 = { } #Nothing
					25 = { add_trait = poet }
					25 = { add_trait = falconer }
				}
				random_list = {
					30 = { add_trait = fair }
					50 = { add_trait = strong }
				}
				add_trait = lustful
				random_list = {
					35 = { add_trait = ambitious }
					35 = { add_trait = gregarious }
					30 = { } #Nothing
				}
				set_focus = focus_seduction
				remove_trait = clubfooted
				remove_trait = harelip
				remove_trait =  hunchback 
				remove_trait = lisp
				remove_trait = stutter
				remove_trait = ugly
				remove_trait = dwarf
				remove_trait = weak
			}
		}
	}
	new_character = {
		if = {
			limit = { # TODO: Check appropriate character
				has_character_modifier = mandate_of_heaven_5
			}
			change_learning = 5
		}
		save_event_target_as = new_chinese_doctor
	}
}