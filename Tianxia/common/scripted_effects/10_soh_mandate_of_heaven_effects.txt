# calculate_mandate_of_heaven_effect

# calculate_mandate_change_effect
# calculate_mandate_change_realm_effect
# calculate_mandate_change_ruler_effect
# calculate_mandate_change_misc_effect
# calculate_mandate_change_multiplier_effect
# multiply_with_game_rule_multiplier_effect

# save_then_remove_all_mandate_modifiers_effect
# remove_all_mandate_modifiers_effect

# update_mandate_modifier_effect
# update_mandate_modifier_but_ignore_laws_effect

# mandate_penalty_trivial_effect
# mandate_penalty_small_effect
# mandate_penalty_medium_effect
# mandate_penalty_large_effect
# mandate_penalty_massive_effect

# mandate_boost_trivial_effect
# mandate_boost_small_effect
# mandate_boost_medium_effect
# mandate_boost_large_effect
# mandate_boost_massive_effect

# attacker_mandate_penalty_trivial_effect
# attacker_mandate_penalty_small_effect
# attacker_mandate_penalty_medium_effect
# attacker_mandate_penalty_large_effect
# attacker_mandate_penalty_massive_effect

# attacker_mandate_boost_trivial_effect
# attacker_mandate_boost_small_effect
# attacker_mandate_boost_medium_effect
# attacker_mandate_boost_large_effect
# attacker_mandate_boost_massive_effect

# defender_mandate_penalty_trivial_effect
# defender_mandate_penalty_small_effect
# defender_mandate_penalty_medium_effect
# defender_mandate_penalty_large_effect
# defender_mandate_penalty_massive_effect

# defender_mandate_boost_trivial_effect
# defender_mandate_boost_small_effect
# defender_mandate_boost_medium_effect
# defender_mandate_boost_large_effect
# defender_mandate_boost_massive_effect

# set_starting_mandate_effect

calculate_mandate_of_heaven_effect = {
	#log = "Mandate update for [Root.GetTitledName]!"
	
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 1 # Slight increase
		}
		
		if = {
			limit = {
				NOT = {
					has_character_flag = mandate_variable_set
				}
			}
			
			set_character_flag = mandate_variable_set
			
			set_starting_mandate_effect = yes
		}
		
		calculate_mandate_change_effect = yes
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		divide_variable = { # Re-scale; TIANXIATODO: Rescale calculate_mandate_change_effect's sub-effects
			which = mandate_change
			value = 2
		}
		
		if = {
			limit = {
				check_variable = {
					which = mandate_change
					value > 5
				}
			}
			
			set_variable = {
				which = mandate_change
				value = 5
			}
		}
		
		else_if = {
			limit = {
				check_variable = {
					which = mandate_change
					value < -5
				}
			}
			
			set_variable = {
				which = mandate_change
				value = -5
			}
		}
		
		multiply_with_game_rule_multiplier_effect = yes
	}
	
	update_mandate_modifier_effect = yes
}

calculate_mandate_change_effect = {
	calculate_mandate_change_realm_effect = yes
	calculate_mandate_change_ruler_effect = yes
	calculate_mandate_change_misc_effect = yes
}

calculate_mandate_change_realm_effect = {
	set_variable = {
		which = mandate_change_realm
		value = 0
	}
	
	# China gets a bonus just for being China
	if = {
		limit = {
			has_landed_title = e_china
		}
		change_variable = {
			which = mandate_change_realm
			value = 2
		}
	}
	
	# Interest group laws
	primary_title = {
		trigger_switch = {
			on_trigger = has_law
			
			eunuch_law_0 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = 1
					}
				}
			}
			
			# eunuch_law_1 has no effect
			
			eunuch_law_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -1
					}
				}
			}
			
			eunuch_law_3 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -2
					}
				}
			}
			
			eunuch_law_4 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -5
					}
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_law
			
			# grand_chancellor_law_0 has no effect
			
			grand_chancellor_law_1 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -1
					}
				}
			}
			
			grand_chancellor_law_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -2
					}
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_law
			
			ci_courtier_law_0 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = 1
					}
				}
			}
			
			# ci_courtier_law_1 has no effect
			
			ci_courtier_law_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -1
					}
				}
			}
			
			ci_courtier_law_3 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -2
					}
				}
			}
			
			ci_courtier_law_4 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -5
					}
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_law
			
			# ci_vassal_law_0 has no effect
			
			ci_vassal_law_1 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -0.5
					}
				}
			}
			
			ci_vassal_law_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -1
					}
				}
			}
			
			ci_vassal_law_3 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -2
					}
				}
			}
			
			ci_vassal_law_4 = {
				ROOT = {
					change_variable = {
						which = mandate_change_realm
						value = -5
					}
				}
			}
		}
	}
	
	# Vassals
	set_variable = {
		which = duke_and_king_vassals
		value = 0
	}
	
	set_variable = {
		which = viceroy_percentage
		value = 0
	}
	
	any_vassal = {
		limit = {
			higher_real_tier_than = count
		}
		
		ROOT = {
			change_variable = {
				which = duke_and_king_vassals
				value = 1
			}
		}
		
		if = {
			limit = {
				NOT = {
					any_demesne_title = {
						tier = PREV
						is_vice_royalty = no
					}
				}
			}
			
			ROOT = {
				change_variable = {
					which = viceroy_percentage
					value = 1
				}
			}
		}
	}
	
	divide_variable = {
		which = viceroy_percentage
		which = duke_and_king_vassals
	}
	
	if = {
		limit = {
			NOT = {
				is_variable_equal = {
					which = viceroy_percentage
					value = 1
				}
			}
		}
		
		set_variable = {
			which = temp_mandate_change_variable
			value = -2
		}
		
		multiply_variable = {
			which = viceroy_percentage
			value = 2
		}
		
		change_variable = {
			which = temp_mandate_change_variable
			which = viceroy_percentage
		}
		
		change_variable = {
			which = mandate_change_realm
			which = temp_mandate_change_variable
		}
	}
	
	# Infighting
	if = {
		limit = {
			any_realm_lord = {
				any_war = {
					attacker = {
						top_liege = {
							character = ROOT
						}
					}
					defender = {
						top_liege = {
							character = ROOT
						}
					}
				}
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -1
		}
	}
	
	# China under attack
	if = {
		limit = {
			any_war = { # China should not be under attack
				defender = {
					character = ROOT
				}
				
				attacker = {
					NOT = {
						liege_before_war = {
							character = ROOT
						}
					}
				}
				
				NOR = {
					using_cb = peasant_revolt
					using_cb = heretic_revolt
					using_cb = religious_revolt
					using_cb = liberation_revolt
					using_cb = cb_minor_clan_revolt
					using_cb = mandate_of_heaven_uprising
					using_cb = jin_tang_cb
					using_cb = fang_las_rebellion
					using_cb = go_yeongchang
				}
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -1
		}
	}
	
	# Ongoing civil wars or rebellions
	if = {
		limit = {
			any_war = { # In a civil war
				defender = {
					character = ROOT
				}
				
				OR = {
					attacker = {
						liege_before_war = {
							character = ROOT
						}
					}
					
					using_cb = jin_tang_cb
					using_cb = fang_las_rebellion
					using_cb = go_yeongchang
				}
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -2
		}
	}
	
	if = {
		limit = {
			any_war = { # Fighting against a revolt
				defender = {
					character = ROOT
				}
				
				OR = {
					using_cb = peasant_revolt
					using_cb = heretic_revolt
					using_cb = religious_revolt
					using_cb = liberation_revolt
					using_cb = cb_minor_clan_revolt
					using_cb = mandate_of_heaven_uprising
				}
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -5
		}
	}
	
	# Realm size
	if = {
		limit = {
			realm_size >= 500
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 2
		}
	}
	
	else_if = {
		limit = {
			realm_size >= 400
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 1
		}
	}
	
	
	else_if = {
		limit = {
			realm_size < 250
			realm_size >= 200
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -1
		}
	}
	
	else_if = {
		limit = {
			realm_size < 200
			realm_size >= 100
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -2
		}
	}
	
	else_if = {
		limit = {
			realm_size < 100
			realm_size >= 50
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -3
		}
	}
	
	else_if = {
		limit = {
			realm_size < 50
		}
		
		change_variable = {
			which = mandate_change_realm
			value = -5
		}
	}
	
	if = {
		limit = {
			any_realm_wonder = {
				is_active = yes
				wonder_stage == 4
				is_damaged = no
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 1
		}
	}
	
	else_if = {
		limit = {
			any_realm_wonder = {
				is_active = yes
				wonder_stage == 3
				is_damaged = no
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 0.75
		}
	}
	
	else_if = {
		limit = {
			any_realm_wonder = {
				is_active = yes
				wonder_stage == 2
				is_damaged = no
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 0.5
		}
	}
	
	else_if = {
		limit = {
			any_realm_wonder = {
				is_active = yes
				wonder_stage == 1
				is_damaged = no
			}
		}
		
		change_variable = {
			which = mandate_change_realm
			value = 0.25
		}
	}
	
	# Major bad modifiers
	any_realm_province = {
		if = {
			limit = {
				has_province_modifier = dragons_lair
			}
			
			ROOT = {
				change_variable = {
					which = mandate_change_realm
					value = -1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = burninated_province
			}
			
			ROOT = {
				change_variable = {
					which = mandate_change_realm
					value = -1
				}
			}
		}
	}
	
	set_variable = {
		which = temp_mandate_change_variable
		value = 0
	}
	
	set_variable = {
		which = realm_size_variable
		value = 0
	}
	
	# Prosperity/depopulation, lack of castles/cities, improper culture, improper religion, disease, certain modifiers
	any_realm_province = {
		ROOT = {
			change_variable = {
				which = realm_size_variable
				value = 1
			}
		}
		
		if = {
			limit = {
				NOT = {
					any_province_holding = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
			
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -1
				}
			}
		}
		
		if = {
			limit = {
				OR = {
					AND = {
						has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
						NOT = {
							culture_group = japonic
						}
					}
					
					# TIANXIATODO: Improve the logic below; it is meant to penalize e.g. expanding into the steppes as a Chinese culture group character
					AND = {
						culture = kaifeng
						ROOT = {
							NOT = {
								culture = kaifeng
							}
						}
					}
					
					AND = {
						culture_group = altaic
						ROOT = {
							NOT = {
								culture_group = altaic
							}
						}
					}
					
					AND = {
						culture_group = tibetan_group
						ROOT = {
							NOT = {
								culture_group = tibetan_group
							}
						}
					}
					
					AND = {
						culture = yi
						ROOT = {
							NOT = {
								culture = yi
							}
						}
					}
					
					AND = {
						culture_group = hmongmien
						ROOT = {
							NOT = {
								culture_group = hmongmien
							}
						}
					}
					
					AND = {
						culture_group = rauic_group
						ROOT = {
							NOT = {
								culture_group = rauic_group
							}
						}
					}
					
					AND = {
						culture_group = japonic
						ROOT = {
							NOT = {
								culture_group = japonic
							}
						}
					}
				}
			}
			
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -1
				}
			}
		}
		
		if = {
			limit = {
				could_have_chinese_government_province_trigger = no
				OR = {
					could_have_japanese_government_province_trigger = no
					NOT = {
						culture_group = ROOT
					}
				}
			}
			
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -1
				}
			}
		}
		
		if = {
			limit = {
				has_epidemic = yes
			}
			
			if = {
				limit = {
					disease = bubonic_plague
				}
				
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = -3
					}
				}
			}
			
			else = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = -1
					}
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_province_modifier
			
			prosperity_modifier_1 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = 1
					}
				}
			}
			
			prosperity_modifier_2 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = 2
					}
				}
			}
			
			prosperity_modifier_3 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = 3
					}
				}
			}
			
			depopulated_1 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = -1
					}
				}
			}
			
			depopulated_2 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = -2
					}
				}
			}
			
			depopulated_3 = {
				ROOT = {
					change_variable = {
						which = temp_mandate_change_variable
						value = -3
					}
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = nomad_agitation
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = recent_revolt
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = religious_tension
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = force_converting
			}
			ROOT = {
				change_variable = {
					which = mandate_change_realm
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = heretic_stronghold
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = incompetent_rule
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = thugs_rampant
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = peasants_protected
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = 0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = temple_corruption
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = local_death_cult
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = peasants_scorned
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = peasant_unrest
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = religious_unrest
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = cultural_unrest
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = minor_pagan_border_raids
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = major_pagan_border_raids
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = prima_noctae
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = rampaging_nomads
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				OR = {
					has_province_modifier = burnt_the_land
					has_province_modifier = recently_burnt_the_land
					has_province_modifier = recently_burnt_the_land_not_owner
				}
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = recent_county_uprising
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = peasant_crisis
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = ordered_our_prophet_executed
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = scholar_foundation_province
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = 0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = great_library_province
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = 0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = zealots_running_amok
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				OR = {
					has_province_modifier = capital_thrall_workers_01
					has_province_modifier = capital_thrall_workers_02
					has_province_modifier = capital_thrall_workers_03
				}
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		else_if = {
			limit = {
				OR = {
					has_province_modifier = capital_thrall_workers_04
					has_province_modifier = capital_thrall_workers_05
					has_province_modifier = capital_thrall_workers_06
				}
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = bloodthirsty_mass_sacrifice_province_1
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		else_if = {
			limit = {
				has_province_modifier = bloodthirsty_mass_sacrifice_province_2
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.25
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = bloodthirsty_flower_war_province
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = shepherds_chaos
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = -0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = religious_tolerance
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = 0.1
				}
			}
		}
		
		if = {
			limit = {
				has_province_modifier = peasants_happy
			}
			ROOT = {
				change_variable = {
					which = temp_mandate_change_variable
					value = 0.1
				}
			}
		}
	}
	
	divide_variable = {
		which = temp_mandate_change_variable
		which = realm_size_variable
	}
	
	change_variable = {
		which = mandate_change_realm
		which = temp_mandate_change_variable
	}
	
	change_variable = {
		which = mandate_change
		which = mandate_change_realm
	}
}

calculate_mandate_change_ruler_effect = {
	set_variable = {
		which = mandate_change_ruler
		value = 0
	}
	
	# Treasure Fleet boosts MoH while being prepared or active
	if = {
		limit = {
			has_landed_title = e_china
			
			OR = {
				trait = treasure_fleet_preparation
				
				d_treasure_fleet = {
					has_holder = yes
				}
			}
		}
		
		change_variable = {
			which = mandate_change_ruler
			value = 2
		}
	}
	
	# The Child of Destiny should not have Mandate troubles
	if = {
		limit = {
			has_character_flag = is_child_of_destiny
		}
		change_variable = {
			which = mandate_change_ruler
			value = 10
		}
	}
	
	# Having a regency is bad
	if = {
		limit = {
			has_regent = yes
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	if = {
		limit = {
			is_adult = no
		}
		change_variable = {
			which = mandate_change_ruler
			value = -5
		}
	}
	
	# Sexism
	if = {
		limit = {
			is_female = yes
			gender_equality_trigger = no
		}
		
		if = {
			limit = {
				NOT = {
					has_dlc = "Conclave"
				}
			}
			change_variable = {
				which = mandate_change_ruler
				value = -5
			}
		}
		
		else = {
			trigger_switch = {
				on_trigger = has_law
				
				status_of_women_0 = {
					change_variable = {
						which = mandate_change_ruler
						value = -5
					}
				}
				
				status_of_women_1 = {
					change_variable = {
						which = mandate_change_ruler
						value = -4
					}
				}
				
				status_of_women_2 = {
					change_variable = {
						which = mandate_change_ruler
						value = -2
					}
				}
				
				status_of_women_4 = {
					change_variable = {
						which = mandate_change_ruler
						value = -1
					}
				}
			}
		}
	}
	
	# Bloodline or lack thereof
	if = {
		limit = {
			any_owned_bloodline = { # Related by blood to the founder of a Chinese dynasty
				has_bloodline_flag = real_chinese_imperial_bloodline
				bloodline_is_active_for = ROOT
			}
		}
		
		change_variable = {
			which = mandate_change_ruler
			value = 2
		}
		
		if = {
			limit = {
				any_owned_bloodline = { # Related by blood to the founder of a Chinese dynasty
					has_bloodline_flag = real_chinese_imperial_bloodline
					bloodline_is_active_for = ROOT
					founder = {
						character = ROOT
					}
				}
			}
			
			change_variable = {
				which = mandate_change_ruler
				value = 2
			}
		}
	}
	
	else_if = {
		limit = {
			any_owned_bloodline = { # Related by blood to the founder of a pretender dynasty (and not currently the EoC)
				has_bloodline_flag = pretender_chinese_imperial_bloodline
				bloodline_is_active_for = ROOT
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
		
		if = {
			limit = {
				any_owned_bloodline = { # Related by blood to the founder of a Chinese dynasty
					has_bloodline_flag = pretender_chinese_imperial_bloodline
					bloodline_is_active_for = ROOT
					founder = {
						character = ROOT
					}
				}
			}
			change_variable = {
				which = mandate_change_ruler
				value = 1
			}
		}
	}
	
	# Culture
	if = {
		limit = {
			OR = {
				culture = han
				culture = dragon_culture
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	
	else_if = {
		limit = {
			culture_group = chinese_group
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	
	else_if = {
		limit = {
			OR = {
				culture_group = koreanic
				culture = viet
				culture_group = japonic
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	
	# Religion
	if = {
		limit = {
			has_chinese_eastern_religion_trigger = yes
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	else_if = {
		limit = {
			NOR = { # Preferred religions, even if others are allowd
				has_chinese_eastern_religion_trigger = yes
				religion = buddhist
				religion_openly_chinese_or_reformed_trigger = yes
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = truce_breaker
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	if = {
		limit = {
			has_character_modifier = negative_money
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	# Mourning stuff
	if = {
		limit = {
			trait = in_mourning
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = unfilial_descendant
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = mourning_shack
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = mourning_diet
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = mourning_celibate
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = not_in_sangfu
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	
	# Particularly noticeable traits
	if = {
		limit = {
			trait = depressed # Ruling China is supposed to feel good; something must be wrong with China if the EoC doesn't!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.1
		}
	}
	if = {
		limit = {
			trait = drunkard # Gives in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.1
		}
	}
	if = {
		limit = {
			trait = immortal # Taoists might seek immortality, and if the EoC succeeds they must be great!
		}
		change_variable = {
			which = mandate_change_ruler
			value = 2
		}
	}
	if = {
		limit = {
			OR = {
				trait = incapable # The ruler of China should be capable
				trait = incapable_according_to_regent
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			trait = infirm # The ruler of China shouldn't be infirm
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = lunatic # The ruler of China shouldn't be a lunatic
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = possessed # The ruler of China shouldn't be possessed
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	# Lifestyles
	if = {
		limit = {
			OR = {
				trait = administrator
				trait = scholar
				trait = strategist
				trait = socializer
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	else_if = {
		limit = {
			OR = {
				trait = architect
				trait = game_master
				trait = gardener
				trait = master_schemer
				trait = theologian
				trait = mystic
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	else_if = {
		limit = {
			OR = {
				trait = hedonist
				trait = impaler
				trait = master_seducer
				trait = master_seductress
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	
	# Education
	if = {
		limit = {
			OR = {
				# Poor education
				trait = naive_appeaser
				trait = misguided_warrior
				trait = indulgent_wastrel
				trait = amateurish_plotter
				trait = detached_priest
			}
		}
		change_variable = {
			which = personal_mandate_of_heaven
			value = -1
		}
	}
	else_if = {
		limit = {
			OR = {
				# Great education
				trait = grey_eminence
				trait = brilliant_strategist
				trait = midas_touched
				trait = elusive_shadow
				trait = mastermind_theologian
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	
	# Major illness
	if = {
		limit = {
			trait = bubonic_plague
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	else_if = {
		limit = {
			OR = {
				trait = aztec_disease
				trait = slow_fever
				trait = cancer
				trait = consumption
				trait = dancing_plague
				trait = dysentery
				trait = great_pox
				trait = ill
				trait = leper
				trait = measles
				trait = pneumonic
				trait = rabies
				trait = scurvy
				trait = sickly
				trait = smallpox
				trait = lovers_pox
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	
	# Maimed
	if = {
		limit = {
			trait = eunuch
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			OR = {
				trait = disfigured
				trait = mangled
				trait = one_eyed
				trait = one_handed
				trait = one_legged
				trait = blinded
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	
	# Birth traits
	if = {
		limit = {
			trait = bastard # The ruler of China should not be a bastard
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = born_in_the_purple # Having other imperial claims isn't bad
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = child_of_consort # Children of consorts are slightly penalized
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = child_of_consort_male # Children of consorts are slightly penalized
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = legit_bastard # The ruler of China should not be a bastard, even if legitimized
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	
	# Genetic traits
	if = {
		limit = {
			trait = genius # Being smart is good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	else_if = {
		limit = {
			trait = quick # Being smart is good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	else_if = {
		limit = {
			trait = shrewd # Being smart is good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	else_if = {
		limit = {
			trait = dull # The EoC should be smart
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	else_if = {
		limit = {
			trait = slow # THe EoC should be smart
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	else_if = {
		limit = {
			trait = imbecile # The EoC should be smart
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = inbred # The EoC shouldn't be inbred
		}
		change_variable = {
			which = mandate_change_ruler
			value = -5
		}
	}
	if = {
		limit = {
			trait = lefthanded # Used to be stigmatized
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	
	# Personality (sins, virtues, others)
	if = {
		limit = {
			trait = chaste # Doesn't give in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = temperate # Doesn't give in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = charitable # Good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = diligent # Works hard
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = patient # Calm
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = kind # Good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = humble # China is not humble!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = lustful # Gives in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = gluttonous # Gives in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = greedy # Gives in to excess
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = slothful # Does not work hard
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = wroth # China shouldn't be wroth
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = envious # China is obviously the best; why is the EoC envious of someone?
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = proud # Ruling China is obviously something to be proud of!
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = ambitious # Goal-oriented
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = arbitrary # China should follow its own laws!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			trait = cruel # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = cynical # Don't have a negative view of things!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = deceitful # Crafty
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = erudite # Learned
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			trait = gregarious # Well-spoken
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = honest # Keeping your word is good
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			trait = just # China is obviously just
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			trait = paranoid # Everyone isn't out to get you!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			trait = shy # China shouldn't be shy!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = stubborn # China knows what China wants, and China expects what China wants!
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			trait = trusting # China isn't foolhardy
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = zealous # Traditionalist
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}

	# Kinslayer traits
	if = {
		limit = {
			trait = tribal_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	else_if = {
		limit = {
			trait = dynastic_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	else_if = {
		limit = {
			trait = familial_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	else_if = {
		limit = {
			trait = kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	# Misc
	if = {
		limit = {
			trait = augustus # Possesses another imperial claim
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = cannibal # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			trait = cat # China shouldn't be ruled by a cat, even though cats obviously are superior to mere humans!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -10
		}
	}
	if = {
		limit = {
			trait = horse # China shouldn't be ruled by a horse!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -10
		}
	}
	if = {
		limit = {
			trait = in_hiding # The EoC shouldn't hide!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	
	# Major modifiers	
	if = {
		limit = {
			has_character_modifier = dragon_boon_rulership
		}
		change_variable = {
			which = mandate_change_ruler
			value = 5
		}
	}
	if = {
		limit = {
			has_character_modifier = unworthy_of_dragon_boon
		}
		change_variable = {
			which = mandate_change_ruler
			value = -5
		}
	}
	
	# Less major modifiers
	# Raiding traits
	if = {
		limit = {
			trait = viking # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = pirate # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	if = {
		limit = {
			trait = ravager # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			trait = sea_king # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			trait = sea_queen # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}

	# Kinslayer traits
	if = {
		limit = {
			trait = tribal_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.25
		}
	}
	else_if = {
		limit = {
			trait = dynastic_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	else_if = {
		limit = {
			trait = familial_kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	else_if = {
		limit = {
			trait = kinslayer # The EoC shouldn't be a kinslayer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	# Mourning
	if = {
		limit = {
			has_character_modifier = unfilial_descendant
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = failure_to_mourn
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	
	# Misc
	if = {
		limit = {
			trait = augustus # Possesses another imperial claim
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.1
		}
	}
	if = {
		limit = {
			trait = cannibal # China shouldn't be barbaric!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			trait = cat # China shouldn't be ruled by a cat, even though cats obviously are superior to mere humans!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -10
		}
	}
	if = {
		limit = {
			trait = horse # China shouldn't be ruled by a horse!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -10
		}
	}
	if = {
		limit = {
			trait = in_hiding # The EoC shouldn't hide!
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = broken_spirit
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = crushed_revolt
		}
		change_variable = {
			which = mandate_change_ruler
			value = 2
		}
	}
	if = {
		limit = {
			has_character_modifier = crushed_major_revolt
		}
		change_variable = {
			which = mandate_change_ruler
			value = 5
		}
	}
	if = {
		limit = {
			has_character_modifier = demon_child_non_pagan
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = suspected_demon_spawn
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = suspected_witch
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = known_witch
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = incestuous_adulterer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = incestuous_adulteress
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = adulterer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = adulteress
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = known_satanist
		}
		change_variable = {
			which = mandate_change_ruler
			value = -10
		}
	}
	if = {
		limit = {
			has_character_modifier = wol_patriarch_1
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = wol_patriarch_2
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = wol_matriarch_1
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = wol_matriarch_2
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = vicious_rumors
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = vicious_rumors_2
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = known_murderer
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = merciless
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = disloyal_peasantry
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = groomed_to_perfection
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = commoners_abandoned
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = alliance_breaker
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = broken_non_aggression_pact_char_modifier
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = crazy_cannibal
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = skull_trophy
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = skull_trophies
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = graverobber
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = bedridden_illness
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = corrupting_magic_minor
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = corrupting_magic_major
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = popular_ruler
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	if = {
		limit = {
			has_character_modifier = under_suspicion
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = highly_suspect
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = tarnished_reputation
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = cowardly_infanticide
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = munificent_modifier
		}
		change_variable = {
			which = mandate_change_ruler
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = jolly_matron_modifier
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			has_character_modifier = jolly_patriarch_modifier
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.25
		}
	}
	if = {
		limit = {
			has_character_modifier = cowardly_ruler
		}
		change_variable = {
			which = mandate_change_ruler
			value = -0.1
		}
	}
	if = {
		limit = {
			has_character_modifier = ate_beating_heart
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	if = {
		limit = {
			has_character_modifier = plundering_leader_modifier
		}
		change_variable = {
			which = mandate_change_ruler
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = employing_jd_administrator
		}
		change_variable = {
			which = mandate_change_ruler
			value = 0.5
		}
	}
	
	if = {
		limit = {
			any_realm_lord = {
				higher_real_tier_than = baron # Simplify
				is_feudal = yes # We don't care about tribals, nomads, theocracies, or republics!
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tyrant
				}
				OR = {
					could_have_chinese_government_trigger = yes
					could_have_japanese_government_trigger = yes
				}
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -5
		}
	}
	else_if = {
		limit = {
			any_realm_lord = {
				higher_real_tier_than = baron # Simplify
				is_feudal = yes # We don't care about tribals, nomads, theocracies, or republics!
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_tyrant
				}
			}
		}
		change_variable = {
			which = mandate_change_ruler
			value = -2
		}
	}
	
	change_variable = {
		which = mandate_change
		which = mandate_change_ruler
	}
}

calculate_mandate_change_misc_effect = {
	set_variable = {
		which = mandate_change_misc
		value = 0
	}
	
	# Owning the Heirloom Seal of the Realm is good
	if = {
		limit = {
			has_artifact = heirloom_seal_of_the_realm
		}
		change_variable = {
			which = mandate_change_misc
			value = 2
		}
	}
	
	# Current MoH
	if = {
		limit = {
			has_character_modifier = mandate_of_heaven_5
		}
		change_variable = {
			which = mandate_change_misc
			value = 2
		}
	}
	else_if = {
		limit = {
			has_character_modifier = mandate_of_heaven_1
		}
		change_variable = {
			which = mandate_change_misc
			value = 1
		}
	}
	if = {
		limit = {
			has_character_modifier = mandate_of_heaven_2
		}
		change_variable = {
			which = mandate_change_misc
			value = -1
		}
	}
	if = {
		limit = {
			has_character_modifier = mandate_of_heaven_1
		}
		change_variable = {
			which = mandate_change_misc
			value = -2
		}
	}
	
	# Other CI realms doing better
	if = {
		limit = {
			NOT = {
				has_character_modifier = mandate_of_heaven_5
			}
		}
		
		if = {
			limit = {
				has_character_modifier = mandate_of_heaven_4
				
				any_independent_ruler = {
					tier = emperor
					has_character_modifier = mandate_of_heaven_5
				}
			}
			change_variable = {
				which = mandate_change_misc
				value = -0.5
			}
		}
		
		else_if = {
			limit = {
				has_character_modifier = mandate_of_heaven_3
			}
			
			if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_5
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -1
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_4
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -0.5
				}
			}
		}
		
		else_if = {
			limit = {
				has_character_modifier = mandate_of_heaven_2
			}
			
			if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_5
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -1.5
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_4
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -1
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_3
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -0.5
				}
			}
		}
		
		else_if = {
			limit = {
				has_character_modifier = mandate_of_heaven_1
			}
			if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_5
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -2
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_4
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -1.5
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_3
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -1
				}
			}
			
			else_if = {
				limit = {
					any_independent_ruler = {
						tier = emperor
						has_character_modifier = mandate_of_heaven_2
					}
				}
				change_variable = {
					which = mandate_change_misc
					value = -0.5
				}
			}
		}
	}
	
	# Someone else we care about has a larger realm; the more inferior we consider them, the worse it is
	if = {
		limit = {
			any_independent_ruler = {
				higher_real_tier_than = duke
				OR = {
					government = chinese_vassal_government
					government = japanese_bureaucracy_government
				}
				relative_realm_size = {
					who = ROOT
					size >= 1
				}
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = -2
		}
	}
	
	else_if = {
		limit = {
			any_independent_ruler = {
				OR = {
					government = eastern_imperial_government
					government = japanese_imperial_government
					government = divine_imperial_government
				}
				relative_realm_size = {
					who = ROOT
					size >= 1
				}
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = -1
		}
	}
	
	else_if = {
		limit = {
			any_independent_ruler = {
				government = chinese_imperial_government
				relative_realm_size = {
					who = ROOT
					size >= 1
				}
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = -0.5
		}
	}
	
	# Being a tributary
	if = {
		limit = {
			is_tributary = yes
			suzerain = {
				government = chinese_imperial_government
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = -5
		}
	}
	
	else_if = {
		limit = {
			is_tributary = yes
		}
		change_variable = {
			which = mandate_change_misc
			value = -2
		}
	}
	
	# Having nice tributaries
	if = {
		limit = {
			any_tributary = {
				is_tributary = {
					type = chinese_client_state
				}
				OR = {
					tier = emperor
					tier = king
				}
				is_nomadic = no
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = 2
		}
	}
	
	else_if = {
		limit = {
			OR = {
				any_tributary = {
					is_tributary = {
						type = chinese_client_state
					}
					tier = duke
				}
				
				any_tributary = {
					is_tributary = {
						type = chinese_protectorate
					}
					OR = {
						tier = emperor
						tier = king
					}
					is_nomadic = no
				}
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = 1
		}
	}
	
	else_if = {
		limit = {
			OR = {
				any_tributary = {
					is_tributary = {
						type = chinese_protectorate
					}
					tier = duke
				}
				
				any_tributary = {
					is_tributary = {
						type = chinese_imperial_tributary
					}
					OR = {
						tier = emperor
						tier = king
					}
					is_nomadic = no
				}
			}
		}
		change_variable = {
			which = mandate_change_misc
			value = 0.5
		}
	}
	
	change_variable = {
		which = mandate_change
		which = mandate_change_misc
	}
}

calculate_mandate_change_multiplier_effect = {
	# The overall health of the realm affects the outcome quite a bit
	set_variable = {
		which = mandate_change_multiplier
		value = 1
	}
	
	set_variable = {
		which = realm_size_factor
		value = 0
	}
	
	set_variable = {
		which = mandate_change_multiplier_nontribal
		value = 1
	}
	
	set_variable = {
		which = mandate_change_multiplier_good_culture
		value = 1
	}
	
	set_variable = {
		which = mandate_change_multiplier_good_religion
		value = 1
	}
	
	set_variable = {
		which = mandate_change_multiplier_no_disease
		value = 1
	}
	
	set_variable = {
		which = mandate_change_multiplier_prosperity
		value = 1
	}
	
	set_variable = {
		which = mandate_change_multiplier_depopulation
		value = 1
	}
	
	any_realm_province = {
		ROOT = {
			change_variable = {
				which = realm_size_factor
				value = 1
			}
		}
		
		if = {
			limit = {
				any_province_holding = {
					OR = {
						holding_type = castle
						holding_type = city
					}
				}
			}
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_nontribal
					value = 1
				}
			}
		}
		if = {
			limit = {
				NOR = {
					AND = {
						has_chinese_or_historical_culture_for_chinese_imperial_trigger = no
						NOT = {
							culture_group = japonic
						}
					}
					
					# TIANXIATODO: Improve the logic below; it is meant to penalize e.g. expanding into the steppes as a Chinese culture group character
					AND = {
						culture = kaifeng
						ROOT = {
							NOT = {
								culture = kaifeng
							}
						}
					}
					
					AND = {
						culture_group = altaic
						ROOT = {
							NOT = {
								culture_group = altaic
							}
						}
					}
					
					AND = {
						culture_group = tibetan_group
						ROOT = {
							NOT = {
								culture_group = tibetan_group
							}
						}
					}
					
					AND = {
						culture = yi
						ROOT = {
							NOT = {
								culture = yi
							}
						}
					}
					
					AND = {
						culture_group = hmongmien
						ROOT = {
							NOT = {
								culture_group = hmongmien
							}
						}
					}
					
					AND = {
						culture_group = rauic_group
						ROOT = {
							NOT = {
								culture_group = rauic_group
							}
						}
					}
					
					AND = {
						culture_group = japonic
						ROOT = {
							NOT = {
								culture_group = japonic
							}
						}
					}
				}
			}
			
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_good_culture
					value = 1
				}
			}
		}
		
		else_if = {
			limit = {
				OR = {
					has_chinese_or_historical_culture_for_chinese_imperial_trigger = yes
					culture_group = japonic
				}
			}
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_good_culture
					value = 0.5
				}
			}
		}
		
		if = {
			limit = {
				can_have_chinese_imperial_only_religion_trigger = yes
			}
			
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_good_religion
					value = 1
				}
			}
		}
		
		else_if = {
			limit = {
				OR = {
					could_have_chinese_government_province_trigger = yes
					could_have_japanese_government_province_trigger = yes
				}
			}
			
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_nontribal
					value = 0.5
				}
			}
		}
		
		if = {
			limit = {
				has_epidemic = no
			}
			ROOT = {
				change_variable = {
					which = mandate_change_multiplier_no_disease
					value = 1
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_province_modifier
			
			prosperity_modifier_1 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_prosperity
						value = 1
					}
				}
			}
			
			prosperity_modifier_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_prosperity
						value = 2
					}
				}
			}
			
			prosperity_modifier_3 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_prosperity
						value = 3
					}
				}
			}
		}
		
		trigger_switch = {
			on_trigger = has_province_modifier
			
			depopulated_1 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_depopulation
						value = 1
					}
				}
			}
			
			depopulated_2 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_depopulation
						value = 2
					}
				}
			}
			
			depopulated_3 = {
				ROOT = {
					change_variable = {
						which = mandate_change_multiplier_depopulation
						value = 3
					}
				}
			}
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_nontribal
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_nontribal
			value = 1
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_good_culture
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_good_culture
			value = 1
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_good_religion
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_good_religion
			value = 1
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_no_disease
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_no_disease
			value = 1
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_prosperity
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_prosperity
			value = 1
		}
	}
	
	if = {
		limit = {
			is_variable_equal = {
				which = mandate_change_multiplier_depopulation
				value = 0
			}
		}
		set_variable = {
			which = mandate_change_multiplier_depopulation
			value = 1
		}
	}
	
	divide_variable = {
		which = mandate_change_multiplier_nontribal
		which = realm_size_factor
	}
	
	divide_variable = {
		which = mandate_change_multiplier_good_culture
		which = realm_size_factor
	}
	
	divide_variable = {
		which = mandate_change_multiplier_good_religion
		which = realm_size_factor
	}
	
	divide_variable = {
		which = mandate_change_multiplier_no_disease
		which = realm_size_factor
	}
	
	divide_variable = {
		which = mandate_change_multiplier_prosperity
		which = realm_size_factor
	}
	
	change_variable = {
		which = mandate_change_multiplier_prosperity
		value = 1
	}
	
	divide_variable = {
		which = mandate_change_multiplier_depopulation
		which = realm_size_factor
	}
	
	change_variable = {
		which = mandate_change_multiplier_depopulation
		value = 1
	}
	
	multiply_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_nontribal
	}
	
	multiply_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_good_culture
	}
	
	multiply_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_good_religion
	}
	
	multiply_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_no_disease
	}
	
	multiply_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_prosperity
	}
	
	divide_variable = {
		which = mandate_change_multiplier
		which = mandate_change_multiplier_depopulation
	}
	
	if = {
		limit = {
			has_landed_title = e_china
		}
		multiply_variable = {
			which = mandate_change_multiplier
			value = 1.1 # Small boost
		}
	}
	
	if = {
		limit = {
			check_variable = {
				which = mandate_change
				value < 0
			}
		}
		
		set_variable = {
			which = temp_mandate_change_multiplier
			value = 1
		}
		
		divide_variable = {
			which = temp_mandate_change_multiplier
			which = mandate_change_multiplier
		}
		
		set_variable = {
			which = mandate_change_multiplier
			which = temp_mandate_change_multiplier
		}
	}
}

multiply_with_game_rule_multiplier_effect = {
	if = {
		limit = {
			has_game_rule = {
				name = mandate_of_heaven_severity
				value = harsh
			}
		}
		
		set_variable = {
			which = mandate_game_rule_multiplier
			value = 2
		}
	}
	
	else_if = {
		limit = {
			has_game_rule = {
				name = mandate_of_heaven_severity
				value = average
			}
		}
		
		set_variable = {
			which = mandate_game_rule_multiplier
			value = 1
		}
	}
	
	else = {
		set_variable = {
			which = mandate_game_rule_multiplier
			value = 0.5
		}
	}
	
	multiply_variable = {
		which = mandate_change
		which = mandate_game_rule_multiplier
	}
}

save_then_remove_all_mandate_modifiers_effect = {
	set_character_flag = was_chinese_imperial
	
	trigger_switch = {
		on_trigger = has_character_modifier
		
		mandate_of_heaven_1 = { set_character_flag = moh_1 }
		mandate_of_heaven_2 = { set_character_flag = moh_2 }
		mandate_of_heaven_3 = { set_character_flag = moh_3 }
		mandate_of_heaven_4 = { set_character_flag = moh_4 }
		mandate_of_heaven_5 = { set_character_flag = moh_5 }
	}
	
	remove_all_mandate_modifiers_effect = yes
}

remove_all_mandate_modifiers_effect = {
	remove_character_modifier = mandate_of_heaven_5
	remove_character_modifier = mandate_of_heaven_4
	remove_character_modifier = mandate_of_heaven_3
	remove_character_modifier = mandate_of_heaven_2
	remove_character_modifier = mandate_of_heaven_1
}

update_mandate_modifier_effect = {
	hidden_tooltip = {
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
		
		if = {
			limit = {
				check_variable = {
					which = mandate_of_heaven
					value > 100
				}
			}
			
			set_variable = {
				which = mandate_of_heaven
				value = 100
			}
		}
		
		else_if = {
			limit =  {
				check_variable = {
					which = mandate_of_heaven
					value < -100
				}
			}
			
			set_variable = {
				which = mandate_of_heaven
				value = -100
			}
		}
		
		save_then_remove_all_mandate_modifiers_effect = yes
	}
	
	if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= 80
			}
			
			has_landed_title = e_china # Only China can have an Unquestioned Mandate rating
			
			is_adult = yes # Children are always questioned!
			
			is_actually_incapable_trigger = no
			
			prisoner = no
			
			OR = {
				realm_size >= 800
				has_character_flag = moh_5
			}
			
			OR = {
				any_owned_bloodline = {
					has_bloodline_flag = real_chinese_imperial_bloodline
					founder = {
						character = ROOT
					}
				}
				
				NOT = {
					any_independent_ruler = {
						government = chinese_imperial_government
						NOT = {
							character = ROOT
						}
					}
				}
			}
			
			OR = {
				primary_title = {
					NOR = {
						has_law = eunuch_law_2
						has_law = eunuch_law_3
						has_law = eunuch_law_4
						has_law = grand_chancellor_law_1
						has_law = grand_chancellor_law_2
						has_law = ci_courtier_law_2
						has_law = ci_courtier_law_3
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_2
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
				
				has_character_flag = moh_5
			}
		}
		
		add_character_modifier = {
			modifier = mandate_of_heaven_5
			duration = -1
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= 30
			}
			
			OR = {
				primary_title = {
					NOR = {
						has_law = eunuch_law_3
						has_law = eunuch_law_4
						has_law = grand_chancellor_law_2
						has_law = ci_courtier_law_3
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
				has_character_flag = moh_4
			}
			
			OR = {
				realm_size >= 500
				has_character_flag = moh_5
				has_character_flag = moh_4
			}
		}
		
		add_character_modifier = {
			modifier = mandate_of_heaven_4
			duration = -1
		}
		
		# Remove some excess positive Mandate, if relevant
		if = {
			limit = {
				primary_title = {
					OR = {
						has_law = eunuch_law_2
						has_law = eunuch_law_3
						has_law = eunuch_law_4
						has_law = grand_chancellor_law_1
						has_law = grand_chancellor_law_2
						has_law = ci_courtier_law_2
						has_law = ci_courtier_law_3
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_2
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
				check_variable = {
					which = mandate_of_heaven
					value >= 80
				}
			}
			
			set_variable = {
				which = mandate_of_heaven
				value = 80
			}
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= -30
			}
			
			OR = {
				primary_title = {
					NOR = {
						has_law = eunuch_law_4
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_4
					}
				}
				has_character_flag = moh_3
			}
			
			OR = {
				realm_size >= 300
				has_character_flag = moh_5
				has_character_flag = moh_4
				has_character_flag = moh_3
			}
		}
		
		add_character_modifier = {
			modifier = mandate_of_heaven_3
			duration = -1
		}
		
		# Remove some excess positive Mandate, if relevant
		if = {
			limit = {
				primary_title = {
					OR = {
						has_law = eunuch_law_3
						has_law = eunuch_law_4
						has_law = grand_chancellor_law_2
						has_law = ci_courtier_law_3
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_3
						has_law = ci_vassal_law_4
					}
				}
				check_variable = {
					which = mandate_of_heaven
					value = 30
				}
			}
			
			set_variable = {
				which = mandate_of_heaven
				value >= 30
			}
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= -80
			}
			
			OR = {
				realm_size >= 100
				has_character_flag = moh_5
				has_character_flag = moh_4
				has_character_flag = moh_3
				has_character_flag = moh_2
			}
		}
		
		add_character_modifier = {
			modifier = mandate_of_heaven_2
			duration = -1
		}
		
		# Remove some excess positive Mandate, if relevant
		if = {
			limit = {
				primary_title = {
					OR = {
						has_law = eunuch_law_4
						has_law = ci_courtier_law_4
						has_law = ci_vassal_law_4
					}
				}
				check_variable = {
					which = mandate_of_heaven
					value = -30
				}
			}
			
			set_variable = {
				which = mandate_of_heaven
				value <= -30
			}
		}
	}
	
	else = {
		add_character_modifier = {
			modifier = mandate_of_heaven_1
			duration = -1
		}
	}
	
	if = {
		limit = {
			NOR = {
				AND = {
					has_character_flag = moh_5
					has_character_modifier = mandate_of_heaven_5
				}
				AND = {
					has_character_flag = moh_4
					has_character_modifier = mandate_of_heaven_4
				}
				AND = {
					has_character_flag = moh_3
					has_character_modifier = mandate_of_heaven_3
				}
				AND = {
					has_character_flag = moh_2
					has_character_modifier = mandate_of_heaven_2
				}
				AND = {
					has_character_flag = moh_1
					has_character_modifier = mandate_of_heaven_1
				}
			}
		}
		set_character_flag = run_moh_update_event
	}
	
	clr_character_flag = moh_5
	clr_character_flag = moh_4
	clr_character_flag = moh_3
	clr_character_flag = moh_2
	clr_character_flag = moh_1
	
	save_event_target_as = mandate_update_character
	
	if = {
		limit = { has_character_flag = run_moh_update_event }
		clr_character_flag = run_moh_update_event
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = event_target:mandate_update_character
					top_liege = {
						government = chinese_imperial_government
					}
				}
			}
			narrative_event = { id = soh.5608 } # Inform the world
		}
	}
}

update_mandate_modifier_but_ignore_laws_effect = {
	hidden_tooltip = {
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
		if = {
			limit = {
				check_variable = {
					which = mandate_of_heaven
					value > 100
				}
			}
			set_variable = {
				which = mandate_of_heaven
				value = 100
			}
		}
		else_if = {
			limit =  {
				check_variable = {
					which = mandate_of_heaven
					value < -100
				}
			}
			set_variable = {
				which = mandate_of_heaven
				value = -100
			}
		}
		save_then_remove_all_mandate_modifiers_effect = yes
	}
	
	if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= 80
			}
			
			has_landed_title = e_china # Only China can have an Unquestioned Mandate rating
			
			is_adult = yes # Children are always questioned!
			
			is_actually_incapable_trigger = no
			
			OR = {
				any_owned_bloodline = {
					has_bloodline_flag = real_chinese_imperial_bloodline
					founder = {
						character = ROOT
					}
				}
				
				NOT = {
					any_independent_ruler = {
						government = chinese_imperial_government
						NOT = {
							character = ROOT
						}
					}
				}
			}
		}
		add_character_modifier = {
			modifier = mandate_of_heaven_5
			duration = -1
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= 30
			}
		}
		add_character_modifier = {
			modifier = mandate_of_heaven_4
			duration = -1
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= -30
			}
		}
		add_character_modifier = {
			modifier = mandate_of_heaven_3
			duration = -1
		}
	}
	
	else_if = {
		limit = {
			check_variable = {
				which = mandate_of_heaven
				value >= -80
			}
		}
		add_character_modifier = {
			modifier = mandate_of_heaven_2
			duration = -1
		}
	}
	
	else = {
		add_character_modifier = {
			modifier = mandate_of_heaven_1
			duration = -1
		}
	}
	if = {
		limit = {
			NOR = {
				AND = {
					has_character_flag = moh_5
					has_character_modifier = mandate_of_heaven_5
				}
				AND = {
					has_character_flag = moh_4
					has_character_modifier = mandate_of_heaven_4
				}
				AND = {
					has_character_flag = moh_3
					has_character_modifier = mandate_of_heaven_3
				}
				AND = {
					has_character_flag = moh_2
					has_character_modifier = mandate_of_heaven_2
				}
				AND = {
					has_character_flag = moh_1
					has_character_modifier = mandate_of_heaven_1
				}
			}
		}
		set_character_flag = run_moh_update_event
	}
	
	clr_character_flag = moh_5
	clr_character_flag = moh_4
	clr_character_flag = moh_3
	clr_character_flag = moh_2
	clr_character_flag = moh_1
	
	save_event_target_as = mandate_update_character
	
	if = {
		limit = { has_character_flag = run_moh_update_event }
		clr_character_flag = run_moh_update_event
		
		any_player = {
			limit = {
				OR = {
					is_within_diplo_range = event_target:mandate_update_character
					top_liege = {
						government = chinese_imperial_government
					}
				}
			}
			narrative_event = { id = soh.5608 } # Inform the world
		}
	}
}

mandate_penalty_trivial_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = -0.5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_penalty_small_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = -1
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_penalty_medium_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = -2.5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_penalty_large_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = -5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_penalty_massive_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = -10
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_boost_trivial_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 0.5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_boost_small_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 1
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_boost_medium_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 2.5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_boost_large_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 5
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

mandate_boost_massive_effect = {
	hidden_tooltip = {
		set_variable = {
			which = mandate_change
			value = 10
		}
		
		calculate_mandate_change_multiplier_effect = yes
		
		multiply_variable = {
			which = mandate_change
			which = mandate_change_multiplier
		}
		
		multiply_with_game_rule_multiplier_effect = yes
		
		change_variable = {
			which = mandate_of_heaven
			which = mandate_change
		}
	}
}

attacker_mandate_penalty_trivial_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = trivial_mandate_penalty
			attacker = {
				mandate_boost_trivial_effect = yes
			}
		}
	}
}

attacker_mandate_penalty_small_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = small_mandate_penalty
			attacker = {
				mandate_boost_small_effect = yes
			}
		}
	}
}

attacker_mandate_penalty_medium_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = medium_mandate_penalty
			attacker = {
				mandate_boost_medium_effect = yes
			}
		}
	}
}

attacker_mandate_penalty_large_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = large_mandate_penalty
			attacker = {
				mandate_boost_large_effect = yes
			}
		}
	}
}

attacker_mandate_penalty_massive_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = massive_mandate_penalty
			attacker = {
				mandate_boost_massive_effect = yes
			}
		}
	}
}

attacker_mandate_boost_trivial_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = trivial_mandate_boost
			attacker = {
				mandate_boost_trivial_effect = yes
			}
		}
	}
}

attacker_mandate_boost_small_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = small_mandate_boost
			attacker = {
				mandate_boost_small_effect = yes
			}
		}
	}
}

attacker_mandate_boost_medium_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = medium_mandate_boost
			attacker = {
				mandate_boost_medium_effect = yes
			}
		}
	}
}

attacker_mandate_boost_large_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = large_mandate_boost
			attacker = {
				mandate_boost_large_effect = yes
			}
		}
	}
}

attacker_mandate_boost_massive_effect = {
	if = {
		limit = {
			attacker = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = massive_mandate_boost
			attacker = {
				mandate_boost_massive_effect = yes
			}
		}
	}
}

defender_mandate_penalty_trivial_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = trivial_mandate_penalty
			defender = {
				mandate_boost_trivial_effect = yes
			}
		}
	}
}

defender_mandate_penalty_small_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = small_mandate_penalty
			defender = {
				mandate_boost_small_effect = yes
			}
		}
	}
}

defender_mandate_penalty_medium_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = medium_mandate_penalty
			defender = {
				mandate_boost_medium_effect = yes
			}
		}
	}
}

defender_mandate_penalty_large_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = large_mandate_penalty
			defender = {
				mandate_boost_large_effect = yes
			}
		}
	}
}

defender_mandate_penalty_massive_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = massive_mandate_penalty
			defender = {
				mandate_boost_massive_effect = yes
			}
		}
	}
}

defender_mandate_boost_trivial_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = trivial_mandate_boost
			defender = {
				mandate_boost_trivial_effect = yes
			}
		}
	}
}

defender_mandate_boost_small_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = small_mandate_boost
			defender = {
				mandate_boost_small_effect = yes
			}
		}
	}
}

defender_mandate_boost_medium_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = medium_mandate_boost
			defender = {
				mandate_boost_medium_effect = yes
			}
		}
	}
}

defender_mandate_boost_large_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = large_mandate_boost
			defender = {
				mandate_boost_large_effect = yes
			}
		}
	}
}

defender_mandate_boost_massive_effect = {
	if = {
		limit = {
			defender = {
				government = chinese_imperial_government
			}
		}
		
		custom_tooltip = {
			text = massive_mandate_boost
			defender = {
				mandate_boost_massive_effect = yes
			}
		}
	}
}

set_starting_mandate_effect = {
	# Fallback
	set_variable = {
		which = mandate_of_heaven
		value = 0
	}
	
	# Modifier
	trigger_switch = {
		on_trigger = has_character_modifier
		
		mandate_of_heaven_1 = { set_character_flag = moh_1 }
		mandate_of_heaven_2 = { set_character_flag = moh_2 }
		mandate_of_heaven_3 = { set_character_flag = moh_3 }
		mandate_of_heaven_4 = { set_character_flag = moh_4 }
		mandate_of_heaven_5 = { set_character_flag = moh_5 }
	}
	
	# Flag
	trigger_switch = {
		on_trigger = has_character_flag
		
		moh_1 = {
			clr_character_flag = moh_1
			
			set_variable = {
				which = mandate_of_heaven
				value = -90
			}
		}
		
		moh_2 = {
			clr_character_flag = moh_2
			
			set_variable = {
				which = mandate_of_heaven
				value = -50
			}
		}
		
		moh_3 = {
			clr_character_flag = moh_3
			
			set_variable = {
				which = mandate_of_heaven
				value = 0
			}
		}
		
		moh_4 = {
			clr_character_flag = moh_4
			
			set_variable = {
				which = mandate_of_heaven
				value = 50
			}
		}
		
		moh_5 = {
			clr_character_flag = moh_5
			
			set_variable = {
				which = mandate_of_heaven
				value = 90
			}
		}
	}
}