# gc_accept_grace_offer_effect
# gc_refuse_grace_offer_effect
# gc_neutral_grace_offer_effect

# eoc_accept_grace_offer_effect
# eoc_refuse_grace_offer_effect

# grace_change_effect

# clear_grace_decision_flags_effect

# add_random_chinese_artifact_effect
# add_random_chinese_artifact_with_moh_weight_effect
# add_random_chinese_artifact_with_tf_moh_weight_effect

# increase_tributary_tier_or_vassalize_effect
# increase_tributary_tier_or_vassalize_end_of_war_effect
# decrease_tributary_tier_or_release_effect

gc_accept_grace_offer_effect = {
	event_target:grace_decision_taker = {
		set_character_flag = grace_accept_offer_gc
	}
	
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
		prestige = -100
	}
	
	else_if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
		prestige = -100
	}
}

gc_refuse_grace_offer_effect = {
	event_target:grace_decision_taker = {
		set_character_flag = grace_refuse_offer_gc
	}
	
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
		prestige = -250
	}
	
	else_if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_neutral_offer
			}
		}
		prestige = -100
	}
}

gc_neutral_grace_offer_effect = {
	event_target:grace_decision_taker = {
		set_character_flag = grace_neutral_offer_gc
	}
	
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
		prestige = -250
	}
	
	else_if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
		prestige = -100
	}
}

eoc_accept_grace_offer_effect = {
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer_gc
			}
		}
		
		prestige = -500
		
		if = {
			limit = {
				primary_title = {
					has_law = grand_chancellor_law_2
				}
			}
			
			set_council_malcontent = yes
			
			any_realm_lord = {
				opinion = {
					who = ROOT
					modifier = opinion_tyrant
				}
			}
		}
	}
	
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_refuse_offer
			}
		}
		
		hidden_tooltip = {
			mandate_penalty_trivial_effect = yes
		}
	}
}

eoc_refuse_grace_offer_effect = {
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer_gc
			}
		}
		
		prestige = -500
		
		if = {
			limit = {
				primary_title = {
					has_law = grand_chancellor_law_2
				}
			}
			
			set_council_malcontent = yes
			
			any_realm_lord = {
				opinion = {
					who = ROOT
					modifier = opinion_tyrant
				}
			}
		}
	}
	
	if = {
		limit = {
			event_target:grace_decision_taker = {
				has_character_flag = grace_accept_offer
			}
		}
		
		hidden_tooltip = {
			mandate_penalty_trivial_effect = yes
		}
	}
}

grace_change_effect = {
	set_character_flag = grace_character
	
	change_variable = {
		which = grace
		which = grace_gain
	}
}



clear_grace_decision_flags_effect = {
	clr_character_flag = grace_refuse_offer
	clr_character_flag = grace_accept_offer
	clr_character_flag = grace_neutral_offer
	clr_character_flag = grace_refuse_offer_gc
	clr_character_flag = grace_accept_offer_gc
	clr_character_flag = grace_neutral_offer_gc
}

add_random_chinese_artifact_effect = {} # TIANXIATODO

add_random_chinese_artifact_with_moh_weight_effect = {} # TIANXIATODO

add_random_chinese_artifact_with_tf_moh_weight_effect = {} # TIANXIATODO

increase_tributary_tier_or_vassalize_effect = {
	save_event_target_as = target_tributary
	
	if = {
		limit = {
			is_tributary = {
				type = chinese_client_state
			}
		}
		
		any_vassal = {
			limit = {
				tier = king
			}
			
			set_defacto_liege = e_china
		}
		
		any_demesne_title = {
			limit = {
				tier = emperor
			}
			
			unsafe_destroy_landed_title = THIS
		}
		
		hidden_tooltip = {
			e_china = {
				holder_scope = {
					hidden_tooltip = {
						remove_tributary = event_target:target_tributary
					}
					remove_tributary = event_target:target_tributary
				}
			}
		}
		
		set_defacto_liege = e_china
	}
	
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_protectorate
			}
		}
		
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_client_state
				}
			}
		}
	}
	
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_imperial_tributary
			}
		}
		
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	
	else = {
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	
	e_china = {
		holder_scope = {
			opinion = {
				who = event_target:target_tributary
				modifier = opinion_grace_increased_tributary_tier
			}
		}
	}
	
	clear_event_target = target_tributary
}

increase_tributary_tier_or_vassalize_end_of_war_effect = {
	save_event_target_as = target_tributary
	
	if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_client_state
					}
				}
			}
		}
		
		any_vassal = {
			limit = {
				tier = king
			}
			
			set_defacto_liege = e_china
		}
		
		any_demesne_title = {
			limit = {
				tier = emperor
			}
			
			unsafe_destroy_landed_title = THIS
		}
		
		hidden_tooltip = {
			e_china = {
				holder_scope = {
					hidden_tooltip = {
						remove_tributary = event_target:target_tributary
						reverse_remove_opinion = {
							who = event_target:target_tributary
							modifier = i_was_client_state
						}
					}
					
					remove_tributary = event_target:target_tributary
				}
			}
		}
		
		set_defacto_liege = e_china
	}
	
	else_if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_protectorate
					}
				}
			}
		}
		
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_protectorate
					}
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_client_state
				}
			}
		}
	}
	
	else_if = {
		limit = {
			e_china = {
				holder_scope = {
					reverse_has_opinion_modifier = {
						who = event_target:target_tributary
						modifier = i_was_imperial_tributary
					}
				}
			}
		}
		
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_imperial_tributary
					}
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	
	else = {
		e_china = {
			holder_scope = {
				hidden_tooltip = {
					remove_tributary = event_target:target_tributary
					reverse_remove_opinion = {
						who = event_target:target_tributary
						modifier = i_was_misc_tributary
					}
				}
				
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	
	e_china = {
		holder_scope = {
			opinion = {
				who = event_target:target_tributary
				modifier = opinion_grace_increased_tributary_tier
			}
		}
	}
	
	clear_event_target = target_tributary
}

decrease_tributary_tier_or_release_effect = {
	save_event_target_as = target_tributary
	
	if = {
		limit = {
			is_tributary = {
				type = chinese_client_state
			}
		}
		
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_protectorate
				}
			}
		}
	}
	
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_protectorate
			}
		}
		
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_imperial_tributary
				}
			}
		}
	}
	
	else_if = {
		limit = {
			is_tributary = {
				type = chinese_imperial_tributary
			}
		}
		
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
		}
		
		e_china = {
			holder_scope = {
				make_tributary = {
					who = event_target:target_tributary
					tributary_type = chinese_peripheral_tributary
				}
			}
		}
	}
	
	else = {
		suzerain = {
			hidden_tooltip = {
				remove_tributary = event_target:target_tributary
			}
			
			opinion = {
				who = event_target:target_tributary
				modifier = opinion_china_breakaway_tributary
			}
		}
	}
	
	e_china = {
		holder_scope = {
			opinion = {
				who = event_target:target_tributary
				modifier = opinion_grace_decreased_tributary_tier
			}
		}
	}
	
	clear_event_target = target_tributary
}