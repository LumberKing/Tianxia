# Bear festival events
# By Silverswee(e)per

namespace = soh

# Reserved ids soh.9801-9900

##### Preparation

# Preparation begins
character_event = {
	id = soh.9801
	desc = EVTDESC_SOH_9801
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		# Clear old flags
		clr_character_flag = coming_to_bear_festival
		clr_character_flag = do_not_disturb
		clr_character_flag = great_bear_costume
		clr_character_flag = okay_bear_costume
		clr_character_flag = bad_bear_costume
		clr_character_flag = great_bear_food
		clr_character_flag = okay_bear_food
		clr_character_flag = bad_bear_food
		clr_character_flag = guest_bear_festival_started
		clr_character_flag = host_bear_festival_started
		clr_character_flag = lavishly_food
		clr_character_flag = low_food
		clr_character_flag = medium_food
		clr_character_flag = recent_bear_festival
		clr_character_flag = sent_invitations
		clr_character_flag = bear_festival_no_sacrifice
	}
	
	option = {
		name = EVTOPTA_SOH_9801 # Time for the preparations to begin
		
		character_event = { id = soh.9802 days = 1 random = 2 } # Costume for bear
		
		character_event = { id = soh.9803 days = 4 random = 2 } # Foor for bear
		
		character_event = { id = soh.9804 days = 7 random = 2 } # Food preparation
		
		character_event = { id = soh.9805 days = 10 random = 2 } # Invitations
	}
}

# Preparing the bear's costume
character_event = {
	id = soh.9802
	desc = EVTDESC_SOH_9802
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9802 # We must give it a great costume!
		
		wealth = -10
		piety = 15
		
		set_character_flag = great_bear_costume
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9802 # I will give it an okay costume
		
		piety = 10
		wealth = -5
		
		set_character_flag = okay_bear_costume
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}

			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9802 # I don't want to spend much on its costume...
		
		piety = -10
		
		set_character_flag = bad_bear_costume
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Preparing the bear's food
character_event = {
	id = soh.9803
	desc = EVTDESC_SOH_9803
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9803 # The bear deserves a great amount of food!
		
		wealth = -10
		piety = 15
		
		set_character_flag = great_bear_food
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9803 # The bear deserves some okay food
		
		piety = 10
		wealth = -5
		
		set_character_flag = okay_bear_food
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = cynical
				NOT = {
					trait = charitable
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0
				trait = greedy
				NOT = {
					trait = zealous
				}
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9803 # The bear deserves rather little food
		
		piety = -10
		
		set_character_flag = bad_bear_food
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = zealous
			}
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Food preparations - copied from vanilla
character_event = {
	id = soh.9804
	desc = EVTDESC_SOH_9804
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		is_actually_incapable_trigger = no
		NOR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
	}

	immediate = {
		if = {
			limit = {
				any_artifact = {
					has_artifact_flag = cooking
					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}
			}

			random_artifact = {
				limit = {
					has_artifact_flag = cooking

					OR = {
						is_artifact_equipped = yes

						# If ROOT already cannibal, someone else should be around to become cannical...
						trigger_if = {
							limit = {
								artifact_type = the_omnivore
								ROOT = { trait = cannibal }
							}

							ROOT = {
								any_courtier = {
									is_adult = yes
									NOT = { trait = cannibal }
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}

					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}

				preferred_limit = {
					quality >= 3
				}

				preferred_limit = {
					quality >= 2
				}

				preferred_limit = {
					quality >= 1
				}

				save_event_target_as = book_target
			}

			if = { # If ROOT is already a cannibal...
				limit = {
					trait = cannibal

					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				random_courtier = {
					limit = {
						NOT = { trait = cannibal }
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
						is_evil_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
					}

					preferred_limit = {
						family_of_root_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
					}

					save_event_target_as = potential_cannibal
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTD72003 # Why don't we use this as inspiration?
			trigger = {
				event_target:book_target = { quality > 1 }
			}
		}
		name = {
			text = EVTOPTD72003_cheap # Let's make use of this little thing
			trigger = {
				event_target:book_target = { quality < 2 }
			}
		}

		tooltip_info_custom = available_because_books_tt

		trigger = {
			event_target:book_target = { always = yes }
		}

		if = {
			limit = {
				event_target:book_target = {
					quality < 2
				}
			}

			set_character_flag = low_food
			prestige = -5
		}
		else_if = {
			limit = {
				event_target:book_target = {
					quality == 2
				}
			}

			if = {
				limit = {
					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				if = {
					limit = { trait = cannibal }

					custom_tooltip = { text = EVTOPTD72003_buddy_cannibal_tt }

					event_target:potential_cannibal = {
						show_scope_change = no

						add_trait = cannibal
					}
				}
				else = {
					custom_tooltip = { text = EVTOPTD72003_cannibal_tt }
					add_trait = cannibal
				}

				set_character_flag = lavishly_food
				wealth = -10
				prestige = 20
			}
			else = {
				set_character_flag = medium_food
				wealth = -5
				prestige = 5
			}
		}
		else = { # Means it's quality 3/higher
			set_character_flag = lavishly_food
			wealth = -10
			prestige = 20
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTA72003 # Spend lavishly on food

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		set_character_flag = lavishly_food
		wealth = -20
		prestige = 10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				trait = greedy
			}

			mult_modifier = {
				factor = 3
				trait = gluttonous
			}

			mult_modifier = {
				factor = 0.1
				trait = temperate
			}

			mult_modifier = {
				factor = 2
				higher_real_tier_than = DUKE
			}
		}
	}

	option = {
		name = EVTOPTB72003 # Spend medium on food

		set_character_flag = medium_food
		wealth = -10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTC72003 # Spend low on food

		trigger = {
			NOT = { trait = gluttonous }
		}

		set_character_flag = low_food
		wealth = -5
		prestige = -5

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 2.5
				trait = greedy
			}

			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}

			mult_modifier = {
				factor = 2
				real_tier = COUNT
			}
		}
	}
}

# Time to send invitations
character_event = {
	id = soh.9805
	desc = EVTDESC_SOH_9805
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
		is_actually_incapable_trigger = no
	}

	option = {
		name = EVTOPTA72010

		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000

			set_character_flag = sent_invitations

			character_event = {
				id = soh.9808
				days = 20
			}

			any_vassal = {
				limit = {
					war = no
					block_general_event_trigger = no
					NOT = { has_character_modifier = holding_large_feast }
					NOT = {
						trait = treasure_fleet_preparation
					}
				}

				letter_event = {
					id = soh.9806
					days = 2
					# tooltip = EVTTOOLTIP72011
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = soh.9806
	desc = EVTDESC_SOH_9806

	is_triggered_only = yes

	trigger = { is_inaccessible_trigger = no }

	option = {
		name = EVTOPTA72011 # Travel to the feast

		set_character_flag = coming_to_bear_festival

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -40
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -20
				}
			}
		}
	}

	option = {
		name = EVTOPTB72011 # Refuse

		FROM = {
			show_scope_change = no

			letter_event = {
				id = soh.9807
				days = 1
				random = 2
				tooltip = EVTTOOLTIP72012
			}

			opinion = {
				name = opinion_dislike
				who = ROOT
				years = 10
			}
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -60
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -80
				}
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = soh.9807
	desc = EVTDESC_SOH_9807

	is_triggered_only = yes
	
	ai = no

	option = {
		name = "EVTOPTA72012"
		
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}



##### Arrival

# Guests arrive - host
character_event = {
	id = soh.9808
	desc = EVTDESC_SOH_9808
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9808 # Welcome! Welcome!
		
		set_character_flag = host_bear_festival_started
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			set_character_flag = guest_bear_festival_started
			character_event = { id = soh.9809 } # Vassals informed
		}
		
		character_event = { id = soh.9810 days = 2 } # Event group 1 event selection
	}
}

# Guest arrives - guest
character_event = {
	id = soh.9809
	desc = EVTDESC_SOH_9809
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9809 # I hope this will be fun!
	}
}



##### Event group 1

# Event selection
character_event = {
	id = soh.9810
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	immediate = {
		random_list = {
			10 = { # Lavish food (vassal)
				trigger = {
					has_character_flag = lavishly_food

					any_vassal = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.9811 }
				}
			}

			10 = { # Medium food (vassal)
				trigger = {
					has_character_flag = medium_food

					any_vassal = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.9812 }
				}
			}

			10 = { # Low food (vassal)
				trigger = {
					has_character_flag = low_food

					any_vassal = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_bear_festival_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.9813 }
				}
			}
		}
		
		# Possible friendship or rivalry
		random_list = {
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_bear_festival
						NOR = {
							is_friend = ROOT
							is_rival = ROOT
							is_lover = ROOT
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_bear_festival
						NOR = {
							is_friend = ROOT
							is_rival = ROOT
							is_lover = ROOT
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = bear_festival_friend
					
					ROOT = {
						character_event = { id = soh.9816 days = 3 random = 2 } # Host made a friend
					}
				}
			}
			
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_bear_festival
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_bear_festival
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_bear_festival
						war = no
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_bear_festival
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = bear_festival_friend_character_1
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_bear_festival
						NOR = {
							character = event_target:bear_festival_friend_character_1
							is_friend = event_target:bear_festival_friend_character_1
							is_rival = event_target:bear_festival_friend_character_1
							is_lover = event_target:bear_festival_friend_character_1
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = bear_festival_friend_character_2
				}
				
				event_target:bear_festival_friend_character_1 = {
					character_event = { id = soh.9818 days = 3 random = 2 } # Vassal befriended another vassal
				}
			}
			
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_bear_festival
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_bear_festival
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_bear_festival
						war = no
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_bear_festival
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = bear_festival_rival_character_1
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_bear_festival
						NOR = {
							character = event_target:bear_festival_rival_character_1
							is_friend = event_target:bear_festival_rival_character_1
							is_rival = event_target:bear_festival_rival_character_1
							is_lover = event_target:bear_festival_rival_character_1
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = bear_festival_rival_character_2
				}
				
				event_target:bear_festival_rival_character_1 = {
					character_event = { id = soh.9821 days = 3 random = 2 } # Vassal rivalled another vassal
				}
			}
			10 = {
				# Nothing
			}
		}
		
		# Bear event
		random_list = {
			5 = {
				mult_modifier = {
					factor = 2
					has_character_flag = bad_bear_food
				}
				mult_modifier = {
					factor = 0.1
					has_character_flag = great_bear_food
				}
				
				# Bear escapes
				character_event = { id = soh.9824 days = 6 random = 3 }
			}
			
			5 = {
				mult_modifier = {
					factor = 2
					has_character_flag = bad_bear_food
				}
				mult_modifier = {
					factor = 0.1
					has_character_flag = great_bear_food
				}
				
				# Bear hurts someone
				character_event = { id = soh.9826 days = 6 random = 3 }
			}
			
			20 = {
				mult_modifier = {
					factor = 2
					has_character_flag = bad_bear_food
				}
				
				# Bear breaks free but it goes well
				character_event = { id = soh.9829 days = 6 random = 3 }
			}
			
			30 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_bear_festival
					}
				}
				
				# Bear is truly impressive
				character_event = { id = soh.9831 days = 6 random = 3 }
				
			}
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_bear_festival
					}
				}
				
				# Bear is truly unimpressive
				character_event = { id = soh.9833 days = 6 random = 3 }
			}
			30 = {
				# Nothing
			}
		}
		
		# Go to the next event selection
		character_event = { id = soh.9835 days = 10 random = 2 }
	}
}

### Food complaints - based on vanilla

# Lavish Food
character_event = {
	id = soh.9811
	desc = EVTDESC_SOH_9811
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9811 # Approve publicly

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9814
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9811 # Disapprove

		trigger = {
			NOT = { trait = gluttonous }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9815
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9811

		prestige = -10
	}
}

# Medium Food
character_event = {
	id = soh.9812
	desc = EVTDESC_SOH_9812
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9812 # Approve publicly

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9814
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9812 # Disapprove

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9815
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9812

		prestige = -10
	}
}

# Low Food
character_event = {
	id = soh.9813
	desc = EVTDESC_SOH_9813
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9813 # Approve publicly

		trigger = {
			NOT = { trait = gluttonous }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9814
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}

	option = {
		name = EVTOPTAB_SOH_9813 # Disapprove

		trigger = {
			NOT = { trait = temperate }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.9815
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9813

		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = soh.9814
	desc = EVTDESC_SOH_9814
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9814 # Good!

		opinion = {
			name = opinion_happy
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = soh.9815
	desc = EVTDESC_SOH_9815
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9815 # Shut up!

		opinion = {
			name = opinion_irritated
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Friendship or rivalry

# Friendship with guest - host
character_event = {
	id = soh.9816
	desc = EVTDESC_SOH_9816
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9816 # That's great!
		
		event_target:bear_festival_friend = {
			add_friend = ROOT
			
			character_event = { id = soh.9817 } # Inform guest
		}
	}
}

# Friendship with host - guest
character_event = {
	id = soh.9817
	desc = EVTDESC_SOH_9817
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9817 # That's great!
		
		add_friend = FROM
	}
}

# Friendship with other guest - guest 1
character_event = {
	id = soh.9818
	desc = EVTDESC_SOH_9818
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = bear_festival_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9818 # That's great!
		
		event_target:bear_festival_friend_character_2 = {
			add_friend = ROOT
			
			character_event = { id = soh.9819 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = soh.9820 } # Inform host
		}
	}
}

# Friendship with other guest - guest 2
character_event = {
	id = soh.9819
	desc = EVTDESC_SOH_9819
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9819 # That's great!
		
		add_friend = FROM
	}
}

# Inform host
character_event = {
	id = soh.9820
	desc = EVTDESC_SOH_9820
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9820 # I see...
	}
}

# Rivalry with other guest - guest 1
character_event = {
	id = soh.9821
	desc = EVTDESC_SOH_9821
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = bear_festival_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9821 # I hate them!
		
		event_target:bear_festival_rival_character_2 = {
			add_rival = ROOT
			
			character_event = { id = soh.9822 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = soh.9823 } # Inform host
		}
	}
}

# Rivalry with other guest - guest 2
character_event = {
	id = soh.9822
	desc = EVTDESC_SOH_9822
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9822 # I hate them!
		
		add_rival = FROM
	}
}

# Inform host
character_event = {
	id = soh.9823
	desc = EVTDESC_SOH_9823
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9823 # I see...
	}
}

### Poor preparations

# Bear tied up very poorly - it escapes - host
character_event = {
	id = soh.9824
	desc = EVTDESC_SOH_9824
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9824 # Oh no!
		
		prestige = -50
		piety = -100
		
		set_character_flag = bear_festival_no_sacrifice
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9825 } # Inform guests
		}
	}
}

# Inform guests that the bear escaped
character_event = {
	id = soh.9825
	desc = EVTDESC_SOH_9825
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9825 # How embarassing!
	}
}

# Bear tied up very poorly - it wounds someone - host
character_event = {
	id = soh.9826
	desc = EVTDESC_SOH_9826
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				any_vassal = {
					has_character_flag = coming_to_bear_festival
					war = no
				}
			}
			
			any_vassal = {
				limit = { 
					has_character_flag = coming_to_bear_festival
					war = no
				}
				
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = bear_festival_wounded_guest
			}
		}
		else = {
			any_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
				}
				
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = bear_festival_wounded_guest
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9826 # That's bad...
		
		prestige = -25
		piety = -25
		
		event_target:bear_festival_wounded_guest = {
			character_event = { id = soh.9827 } # Inform wounded guest
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
				NOT = {
					character = event_target:bear_festival_wounded_guest
				}
			}
			
			character_event = { id = soh.9828 } # Inform other guests
		}
	}
}

# Inform wounded guest
character_event = {
	id = soh.9827
	desc = EVTDESC_SOH_9827
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9827 # Ow!
		
		add_trait = wounded
	}
}

# Inform other guests
character_event = {
	id = soh.9828
	desc = EVTDESC_SOH_9828
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9828 # At least I didn't get hurt...
	}
}

# Bear tied up very poorly - it goes well - host
character_event = {
	id = soh.9829
	desc = EVTDESC_SOH_9829
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9829 # That could have been bad...
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9830 } # Inform guests
		}
	}
}

# Inform guests
character_event = {
	id = soh.9830
	desc = EVTDESC_SOH_9830
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9830 # That could have been bad...
	}
}

### Impressive/unimpressive bear

# Host has impressive bear - guest
character_event = {
	id = soh.9831
	desc = EVTDESC_SOH_9831
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = bear_festival_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9831 # Impressive!
		
		FROM = {
			character_event = { id = soh.9832 } # Inform host
		}
	}
}

# Host told that guest was impressed
character_event = {
	id = soh.9832
	desc = EVTDESC_SOH_9832
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9832 # That's great!
		
		prestige = 50
	}
}

# Host has an unimpressive bear - guest
character_event = {
	id = soh.9833
	desc = EVTDESC_SOH_9833
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = bear_festival_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_9833 # Unimpressive!
		
		FROM = {
			character_event = { id = soh.9834 } # Inform host
		}
	}
}

# Host told that guest was unimpressed
character_event = {
	id = soh.9834
	desc = EVTDESC_SOH_9834
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9834 # I see...
		
		prestige = -50
	}
}

##### Event group 2

# Event selection - if there is a bear, sacrifice it; else go to the end of the Bear Festival
character_event = {
	id = soh.9835
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	immediate = {
		# Check if the sacrifice still is possible and handle that
		if = {
			limit = {
				NOT = {
					has_character_flag = bear_festival_no_sacrifice
				}
			}
			
			# Bear costume
			random_list = {
				10 = { # Great costume
					trigger = {
						has_character_flag = great_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9836 }
					}
				}

				10 = { # Okay costume
					trigger = {
						has_character_flag = okay_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9837 }
					}
				}

				10 = { # Bad costume
					trigger = {
						has_character_flag = bad_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9838 }
					}
				}
			}
			
			# Bear food
			random_list = {
				10 = { # Bear got great food
					trigger = {
						has_character_flag = great_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9841 days = 2 random = 1 }
					}
				}

				10 = { # Bear got okay food
					trigger = {
						has_character_flag = okay_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9842 days = 2 random = 1 }
					}
				}

				10 = { # Bear got bad food
					trigger = {
						has_character_flag = bad_bear_costume

						any_vassal = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}
					}

					any_vassal = {
						limit = {
							has_character_flag = guest_bear_festival_started
							is_actually_incapable_trigger = no
							prisoner = no
							war = no
						}

						score_value = {
							value = 10
							interesting_courtier_selection_score = yes
						}

						character_event = { id = soh.9843 days = 2 random = 1 }
					}
				}
			}
			
			# Bear sacrifice
			character_event = { id = soh.9846 days = 5 }
		}
		else = {
			character_event = { id = soh.9855 } # End of Bear Festival
		}
	}
}

### Bear sacrifice - bear costume complaints

# Great costume
character_event = {
	id = soh.9836
	desc = EVTDESC_SOH_9836
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9836 # Approve publicly

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9839
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9836 # Disapprove

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9840
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9836

		prestige = -10
	}
}

# Okay costume
character_event = {
	id = soh.9837
	desc = EVTDESC_SOH_9837
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9837 # Approve publicly

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9839
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9837 # Disapprove

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9840
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9837

		prestige = -10
	}
}

# Bad costume
character_event = {
	id = soh.9838
	desc = EVTDESC_SOH_9838
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9838 # Approve publicly

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9839
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTAB_SOH_9838 # Disapprove

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9840
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9838

		prestige = -10
	}
}

# Liege is glad
character_event = {
	id = soh.9839
	desc = EVTDESC_SOH_9839
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9839 # Good!

		opinion = {
			name = opinion_happy
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining
character_event = {
	id = soh.9840
	desc = EVTDESC_SOH_9840
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9840 # Shut up!

		opinion = {
			name = opinion_irritated
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Bear sacrifice - bear food complaints

# Great food for the bear
character_event = {
	id = soh.9841
	desc = EVTDESC_SOH_9841
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9841 # Approve publicly

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9844
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9841 # Disapprove

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9845
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9841

		prestige = -10
	}
}

# Okay food for the bear
character_event = {
	id = soh.9842
	desc = EVTDESC_SOH_9842
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9842 # Approve publicly

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9844
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_9842 # Disapprove

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9845
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9842

		prestige = -10
	}
}

# Bad food for the bear
character_event = {
	id = soh.9843
	desc = EVTDESC_SOH_9843
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9843 # Approve publicly

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9844
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTAB_SOH_9843 # Disapprove

		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
		}

		event_target:feast_host = {
			show_scope_change = no

			character_event = {
				id = soh.9845
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = zealous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_9843

		prestige = -10
	}
}

# Liege is glad
character_event = {
	id = soh.9844
	desc = EVTDESC_SOH_9844
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9844 # Good!

		opinion = {
			name = opinion_happy
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining
character_event = {
	id = soh.9845
	desc = EVTDESC_SOH_9845
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9845 # Shut up!

		opinion = {
			name = opinion_irritated
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Bear sacrifice - arrows, eating the bear's flesh, who was the bear?

# Bear sacrifice - host
character_event = {
	id = soh.9846
	desc = EVTDESC_SOH_9846
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9846 # Let the ceremony commence!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9847 } # Inform vassals
		}
		
		character_event = { id = soh.9848 days = 2 random = 1 } # Eating the flesh
	}
}

# Bear sacrificed - guests
character_event = {
	id = soh.9847
	desc = EVTDESC_SOH_9847
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9847 # Let the ceremony commence!
	}
}

# Eating the bear's flesh - host
character_event = {
	id = soh.9848
	desc = EVTDESC_SOH_9848
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9848 # I will share, of course!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9849 } # Host shared - eat?
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.2
				trait = temperate
			}
			
			mult_modifier = {
				factor = 0.2
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9848 # I won't be having any!
		
		piety = 50
		
		add_trait_partially_temperate_effect = yes
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9849 } # Host shared - eat?
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9848 # I won't be sharing!
		
		piety = -50
		
		add_trait_partially_gluttonous_effect = yes
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_bear_festival
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.9850 } # Host refused to share
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = temperate
			}
		}
	}
	
	after = {
		character_event = { id = soh.9851 days = 2 } # Who was the bear?
	}
}

# Host shared the bear's flesh - eat?
character_event = {
	id = soh.9849
	desc = EVTDESC_SOH_9849
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9849 # I will eat some!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.2
				trait = temperate
			}
			
			mult_modifier = {
				factor = 0.2
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9848 # I won't be having any!
		
		piety = 10
		
		add_trait_partially_temperate_effect = yes
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9848 # I will eat more than my fair share!
		
		piety = -10
		
		add_trait_partially_gluttonous_effect = yes
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = temperate
			}
		}
	}
}

# Host refused to share - guests
character_event = {
	id = soh.9850
	desc = EVTDESC_SOH_9850
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9850 # How rude!
		
		opinion = {
			who = FROM
			modifier = opinion_displeased
		}
	}
}

# Who was the bear?
character_event = {
	id = soh.9851
	desc = EVTDESC_SOH_9851
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	immediate = {
		random_list = {
			10 = {
				trigger = {
					any_child_even_if_dead = {
						dynasty = ROOT
						is_alive = no
					}
				}
				
				random_child_even_if_dead = {
					limit = {
						dynasty = ROOT
						is_alive = no
					}
					
					save_event_target_as = dead_kin_target
				}
			}
			
			10 = {
				trigger = {
					any_sibling_even_if_dead = {
						dynasty = ROOT
						is_alive = no
					}
				}
				
				random_sibling_even_if_dead = {
					limit = {
						dynasty = ROOT
						is_alive = no
					}
					
					save_event_target_as = dead_kin_target
				}
			}
			
			10 = {
				trigger = {
					any_spouse_even_if_dead = {
						dynasty = ROOT
						is_alive = no
					}
				}
				
				random_spouse_even_if_dead = {
					limit = {
						dynasty = ROOT
						is_alive = no
					}
					
					save_event_target_as = dead_kin_target
				}
			}
			
			50 = {
				trigger = {
					father_even_if_dead = {
						dynasty = ROOT
						is_alive = no
					}
				}
				
				father_even_if_dead = {
					save_event_target_as = dead_kin_target
				}
			}
			
			50 = {
				trigger = {
					mother_even_if_dead = {
						dynasty = ROOT
						is_alive = no
					}
				}
				
				mother_even_if_dead = {
					save_event_target_as = dead_kin_target
				}
			}
			
			100 = {
				trigger = {
					any_dynasty_member_even_if_dead = {
						is_alive = no
						is_ancestor_of = ROOT
						NOT = {
							any_child_even_if_dead = {
								character = ROOT
							}
						}
					}
				}
				
				random_dynasty_member_even_if_dead = {
					limit = {
						is_alive = no
						is_ancestor_of = ROOT
						NOT = {
							any_child_even_if_dead = {
								character = ROOT
							}
						}
					}
					
					save_event_target_as = dead_kin_target
				}
			}
		}
	}
	
	option = {
		trigger = {
			event_target:dead_kin_target = {
				always = yes
			}
		}
		
		name = EVTOPTA_SOH_9851 # It was the spirit of a dead kins(wo)man!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9852 } # Bear was dead kin
		}
		
		any_dynasty_member = {
			limit = {
				religion_openly_nivkh_or_reformed_trigger = yes
				OR = {
					is_close_relative = ROOT
					liege = {
						character = ROOT
					}
				}
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_approves
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.2
				trait = cynical
			}
			
			mult_modifier = {
				factor = 0
				is_any_kinslayer_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_9851 # It was a nature spirit!
		
		piety = 50
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_bear_festival
			}
			
			character_event = { id = soh.9853 } # Bear was nature spirit
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.2
				trait = cynical
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_9851 # It was just a bear...
		
		piety = -50
		
		add_trait_partially_cynical_effect = yes
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_bear_festival
			}
			
			if = {
				limit = {
					religion_openly_nivkh_or_reformed_trigger = yes
				}
				opinion = {
					who = ROOT
					modifier = opinion_displeased
				}
			}
			else = {
				opinion = {
					who = ROOT
					modifier = opinion_approves
				}
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.9854 } # Bear was just a bear
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0
				trait = zealous
			}
		}
	}
	
	after = {
		character_event = { id = soh.9855 days = 2 } # End of Bear Festival
	}
}

# Bear was dead kin - guests
character_event = {
	id = soh.9852
	desc = EVTDESC_SOH_9852
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
			dynasty = FROM
		}
		
		name = EVTOPTA_SOH_9852 # That's good to hear!
	}
	
	option = {
		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
			NOT = {
				dynasty = FROM
			}
		}
		
		name = EVTOPTB_SOH_9852 # I see...
	}
	
	option = {
		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}
		
		name = EVTOPTC_SOH_9852 # And... you ate them?
	}
}

# Bear was nature spirit - guests
character_event = {
	id = soh.9853
	desc = EVTDESC_SOH_9853
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9853 # I see...
	}
}

# Bear was just a bear - guests
character_event = {
	id = soh.9854
	desc = EVTDESC_SOH_9854
	picture = GFX_evt_tribal_shrine

	is_triggered_only = yes
	
	option = {
		trigger = {
			religion_openly_nivkh_or_reformed_trigger = yes
		}
		
		name = EVTOPTA_SOH_9854 # It was clearly not just a bear!
	}
	
	option = {
		trigger = {
			religion_openly_nivkh_or_reformed_trigger = no
		}
		
		name = EVTOPTB_SOH_9854 # That's right!
	}
}

##### End of Bear Festival

# Check which ending is relevant
character_event = {
	id = soh.9855
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = bear_festival_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_character_flag = bear_festival_no_sacrifice
				}
			}
			character_event = { id = soh.9856 } # Normal end
		}
		
		else = {
			character_event = { id = soh.9858 } # No sacrifice
		}
	}
}

# End of normal Bear Festival - host
character_event = {
	id = soh.9856
	desc = EVTDESC_SOH_9856
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9856 # Until next time!
		
		prestige = 25
		piety = 25
		set_character_flag = recent_bear_festival
		
		hidden_tooltip = {
			# Clear flags
			clr_character_flag = coming_to_bear_festival
			clr_character_flag = do_not_disturb
			clr_character_flag = great_bear_costume
			clr_character_flag = okay_bear_costume
			clr_character_flag = bad_bear_costume
			clr_character_flag = great_bear_food
			clr_character_flag = okay_bear_food
			clr_character_flag = bad_bear_food
			clr_character_flag = guest_bear_festival_started
			clr_character_flag = host_bear_festival_started
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = recent_bear_festival
			clr_character_flag = sent_invitations
			clr_character_flag = bear_festival_no_sacrifice
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_bear_festival
				}
				
				character_event = { id = soh.9857 } # Inform vassals
				
				remove_opinion = {
					modifier = opinion_enjoyed_bear_festival
					who = ROOT
				}
				
				remove_opinion = {
					modifier = opinion_did_not_enjoy_bear_festival
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_enjoyed_bear_festival
					who = ROOT
					years = 2
				}
				
				# Clear flags
				clr_character_flag = coming_to_bear_festival
				clr_character_flag = guest_bear_festival_started
			}
		}
	}
}

# End of normal Bear Festival - guest
character_event = {
	id = soh.9857
	desc = EVTDESC_SOH_9857
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9857 # Until next time!
		
		prestige = 5
	}
}

# End of Bear Festival without a sacrifice - host
character_event = {
	id = soh.9858
	desc = EVTDESC_SOH_9858
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9858 # Maybe the next one will be a proper one...
		
		prestige = -10
		piety = -10
		set_character_flag = recent_bear_festival
		
		hidden_tooltip = {
			# Clear flags
			clr_character_flag = coming_to_bear_festival
			clr_character_flag = do_not_disturb
			clr_character_flag = great_bear_costume
			clr_character_flag = okay_bear_costume
			clr_character_flag = bad_bear_costume
			clr_character_flag = great_bear_food
			clr_character_flag = okay_bear_food
			clr_character_flag = bad_bear_food
			clr_character_flag = guest_bear_festival_started
			clr_character_flag = host_bear_festival_started
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = recent_bear_festival
			clr_character_flag = sent_invitations
			clr_character_flag = bear_festival_no_sacrifice
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_bear_festival
				}
				
				character_event = { id = soh.9859 } # Inform vassals
				
				remove_opinion = {
					modifier = opinion_enjoyed_bear_festival
					who = ROOT
				}
				
				remove_opinion = {
					modifier = opinion_did_not_enjoy_bear_festival
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_did_not_enjoy_bear_festival
					who = ROOT
					years = 2
				}
				
				# Clear flags
				clr_character_flag = coming_to_bear_festival
				clr_character_flag = guest_bear_festival_started
			}
		}
	}
}

# End of Iyomante without a sacrifice - guest
character_event = {
	id = soh.9859
	desc = EVTDESC_SOH_9859
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_9859 # Maybe the next one will be a proper one...
	}
}

# Bear Festival cancelled - host
character_event = {
	id = soh.9860
	desc = EVTDESC_SOH_9860
	picture = GFX_evt_feast

	only_rulers = yes
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9860 # I see...
		hidden_tooltip = {
			remove_character_modifier = bear_festival_in_progress
			# Clear flags
			clr_character_flag = coming_to_bear_festival
			clr_character_flag = do_not_disturb
			clr_character_flag = great_bear_costume
			clr_character_flag = okay_bear_costume
			clr_character_flag = bad_bear_costume
			clr_character_flag = great_bear_food
			clr_character_flag = okay_bear_food
			clr_character_flag = bad_bear_food
			clr_character_flag = guest_bear_festival_started
			clr_character_flag = host_bear_festival_started
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = recent_bear_festival
			clr_character_flag = sent_invitations
			clr_character_flag = bear_festival_no_sacrifice
			
			any_vassal = {
				limit = {
					has_character_flag = guest_bear_festival_started
				}
				
				# Clear flags
				clr_character_flag = coming_to_bear_festival
				clr_character_flag = guest_bear_festival_started
				
				letter_event = { id = soh.9861 } # Inform vassals
			}
		}
	}
}

# Iyomante cancelled - vassals
letter_event = {
	id = soh.9861
	desc = EVTDESC_SOH_9861

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_9861 # I see...
	}
}

# on_war_started - cancel Iyomante
character_event = {
	id = soh.9862
	hide_window = yes
	
	is_triggered_only = yes # on_war_started

	immediate = {
		ROOT = {
			if = {
				limit = { has_character_modifier = bear_festival_in_progress }
				character_event = { id = soh.9860 }
			}
		}

		FROM = {
			if = {
				limit = { has_character_flag = bear_festival_in_progress }
				character_event = { id = soh.9860 }
			}
		}
	}
}