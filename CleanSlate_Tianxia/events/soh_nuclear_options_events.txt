# "Nuclear" options for dealing with the eunuchs/courtiers being far too powerful # TIANXIATODO: Travel-style trait? DND flag?
# By Silverswee(e)per

namespace = soh

# soh.5101-5300 reserved

##### Setup

# Check if one or both groups at court are too powerful on_decade_pulse
character_event = {
	id = soh.5101
	hide_window = yes
	
	is_triggered_only = yes # on_decade_pulse
	
	has_dlc = "Jade Dragon"
	has_dlc = "Conclave"
	
	only_independent = yes
	
	war = no
	
	trigger = {
		real_tier = emperor
		
		OR = {
			government = chinese_imperial_government
			government = eastern_imperial_government
		}
		
		is_inaccessible_trigger = no
		
		primary_title = {
			OR = {
				has_law = eunuch_law_4
				has_law = ci_courtier_law_4
			}
		}
		
		NOR = {
			has_character_modifier = ci_nuclear_option_in_effect
			has_character_modifier = ongoing_ci_law_challenge
		}
	}
	
	immediate = {
		clr_character_flag = ci_nuclear_option_supporting_gc
		clr_character_flag = ci_nuclear_option_supporting_court
		clr_character_flag = ci_nuclear_option_neutral
		clr_character_flag = ci_nuclear_option_playing_both_sides
		
		random_list = {
			25 = {
				trigger = {
					has_regent = no
					
					any_vassal = {
						is_playable = yes
						is_inaccessible_or_incapable_trigger = no
						has_regent = no
						can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
						
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
					}
				}
				
				# Liege gets to decide
				random_vassal = {
					limit = {
						is_playable = yes
						is_inaccessible_or_incapable_trigger = no
						has_regent = no
						can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
						
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = vassal_assisting
				}
				
				if = {
					limit = {
						primary_title = {
							has_law = eunuch_law_4
							NOT = {
								has_law = ci_courtier_law_4
							}
						}
					}
					
					character_event = { id = soh.5102 } # Call in GC or powerful vassal?
				}
				
				else_if = {
					limit = {
						primary_title = {
							NOT = {
								has_law = eunuch_law_4
							}
							has_law = ci_courtier_law_4
						}
					}
					
					character_event = { id = soh.5103 } # Call in GC or powerful vassal?
				}
				
				else = {
					character_event = { id = soh.5104 } # Call in GC or powerful vassal?
				}
			}
			
			25 = {
				trigger = {
					any_vassal = {
						is_playable = yes
						is_inaccessible_or_incapable_trigger = no
						has_regent = no
						can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
						
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
					}
				}
				
				random_vassal = {
					limit = {
						is_playable = yes
						is_inaccessible_or_incapable_trigger = no
						has_regent = no
						can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
						
						OR = {
							has_minor_title = title_grand_chancellor
							is_powerful_vassal = yes
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
						OR = {
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						NOT = {
							dynasty = ROOT
						}
					}
					
					preferred_limit = {
						OR = {
							is_friend = ROOT
							is_lover = ROOT
							is_rival = ROOT
						}
					}
					
					save_event_target_as = vassal_assisting
				}
				
				# GC/powerful vassal gets to decide
				if = {
					limit = {
						primary_title = {
							has_law = eunuch_law_4
							NOT = {
								has_law = ci_courtier_law_4
							}
						}
					}
					
					event_target:vassal_assisting = {
						character_event = { id = soh.5112 } # "Help" liege?
					}
				}
				
				else_if = {
					limit = {
						primary_title = {
							NOT = {
								has_law = eunuch_law_4
							}
							has_law = ci_courtier_law_4
						}
					}
					
					event_target:vassal_assisting = {
						character_event = { id = soh.5113 } # "Help" liege?
					}
				}
				
				else = {
					event_target:vassal_assisting = {
						character_event = { id = soh.5114 } # "Help" liege?
					}
				}
			}
			
			50 = {
				# Nothing; there shouldn't always be "help"
			}
		}
	}
}	

### Liege initiates

# Eunuchs overwhelming - call on GC or powerful vassal?
character_event = {
	id = soh.5102
	desc = EVTDESC_SOH_5102
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		add_character_modifier = {
			modifier = recently_considered_nuclear_option
			months = 12
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5102 # I will ask for help!
		
		set_character_flag = ci_nuclear_option_supporting_gc
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			intrigue >= 10
		}
		
		name = EVTOPTB_SOH_5102 # I will play both sides!
		
		set_character_flag = ci_nuclear_option_playing_both_sides
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = master_schemer
			}
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5102 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
}

# Courtiers overwhelming - call on GC or powerful vassal?
character_event = {
	id = soh.5103
	desc = EVTDESC_SOH_5103
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5103 # I will ask for help!
		
		set_character_flag = ci_nuclear_option_supporting_gc
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			intrigue >= 10
		}
		
		name = EVTOPTB_SOH_5103 # I will play both sides!
		
		set_character_flag = ci_nuclear_option_playing_both_sides
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = master_schemer
			}
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5103 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
}

# Eunuchs and courtiers overwhelming - call on GC or powerful vassal?
character_event = {
	id = soh.5104
	desc = EVTDESC_SOH_5104
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5104 # I will ask for help!
		
		set_character_flag = ci_nuclear_option_supporting_gc
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			intrigue >= 10
		}
		
		name = EVTOPTB_SOH_5104 # I will play both sides!
		
		set_character_flag = ci_nuclear_option_playing_both_sides
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = master_schemer
			}
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5104 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
}

# Inform liege if liege used the decision instead
character_event = {
	id = soh.5105
	desc = EVTDESC_SOH_5105
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes # nuclear_option_decision; TIANXIATODO
	
	immediate = {
		random_vassal = {
			limit = {
				is_playable = yes
				is_inaccessible_or_incapable_trigger = no
				has_regent = no
				can_have_confucian_bureaucracy_and_eastern_imperial_trigger = yes
				
				OR = {
					has_minor_title = title_grand_chancellor
					is_powerful_vassal = yes
				}
			}
			
			preferred_limit = {
				dynasty = ROOT
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				OR = {
					is_friend = ROOT
					is_lover = ROOT
				}
			}
			
			preferred_limit = {
				dynasty = ROOT
				NOT = {
					is_rival = ROOT
				}
			}
			
			preferred_limit = {
				NOT = {
					is_rival = ROOT
				}
			}
			
			save_event_target_as = vassal_assisting
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5105 # I will ask for help!
		
		set_character_flag = ci_nuclear_option_supporting_gc
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			intrigue >= 10
		}
		
		name = EVTOPTB_SOH_5105 # I will play both sides!
		
		set_character_flag = ci_nuclear_option_playing_both_sides
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5106 } # Call in the vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				ai = no
				NOT = {
					has_character_flag = took_nuclear_option
				}
			}
		}
		
		name = EVTOPTC_SOH_5105 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	after = {
		clr_character_flag = took_nuclear_option
	}
}

# GC/powerful vassal called in - accept?
character_event = {
	id = soh.5106
	desc = EVTDESC_SOH_5106
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5106 # I will help!
		
		add_character_modifier = {
			modifier = ci_nuclear_option_vassal_assisting # TIANXIATODO: Faction blocker
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_regent = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			character_event = { id = soh.5107 } # Vassals of GC/powerful vassal asked to join
		}
		
		FROM = {
			character_event = { id = soh.5110 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_rival = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5106 # I don't want to risk it...
		
		prestige = -200
		
		FROM = {
			character_event = { id = soh.5111 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_rival = FROM
			}
		}
	}
}

# Inform vassals of GC/powerful vassal if GC/powerful vassal accepted
character_event = {
	id = soh.5107
	desc = EVTDESC_SOH_5107
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5107 # I will help!
		
		FROM = {
			character_event = { id = soh.5108 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROMFROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROMFROM
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = FROMFROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5107 # I don't want to risk it...
		
		prestige = -100
		
		FROM = {
			character_event = { id = soh.5109 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_friend = FROMFROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_lover = FROMFROM
			}
			
			mult_modifier = {
				factor = 100
				is_rival = FROMFROM
			}
		}
	}
}

# Inform GC/powerful vassal - vassal is helping
character_event = {
	id = soh.5108
	desc = EVTDESC_SOH_5108
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5108 # Excellent!
		
		opinion = {
			modifier = opinion_ci_nuclear_option_help
			who = FROM
			months = 6
		}
		
		top_liege = {
			opinion = {
				modifier = opinion_ci_nuclear_option_help
				who = FROM
				months = 6
			}
		}
	}
}

# Inform GC/powerful vassal - vassal is not helping
character_event = {
	id = soh.5109
	desc = EVTDESC_SOH_5109
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5109 # I will remember this when I am emp-... I will remember this!
		
		opinion = {
			modifier = opinion_ci_nuclear_option_no_help
			who = FROM
			months = 6
		}
		
		top_liege = {
			opinion = {
				modifier = opinion_ci_nuclear_option_no_help
				who = FROM
				months = 6
			}
		}
	}
}

# Inform liege - GC/powerful vassal helping
character_event = {
	id = soh.5110
	desc = EVTDESC_SOH_5110
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5110 # Excellent!
		
		character_event = { id = soh.5120 days = 15 random = 30 } # See if the eunuchs/courtiers discover it
		
		opinion = {
			modifier = opinion_ci_nuclear_option_help
			who = FROM
			months = 6
		}
		
		opinion = {
			modifier = opinion_ci_nuclear_option_help_vassal_assisting
			who = FROM
			months = 6
		}
		
		add_character_modifier = {
			modifier = ci_nuclear_option_in_effect
			months = 12
		}
	}
}

# Inform liege - GC/powerful vassal not helping
character_event = {
	id = soh.5111
	desc = EVTDESC_SOH_5111
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5111 # I will remember this!
		
		opinion = {
			modifier = opinion_ci_nuclear_option_no_help
			who = FROM
			months = 6
		}
	}
}

### GC/powerful vassal initiates

# Eunuchs overwhelming - GC or powerful vassal to the "rescue"?
character_event = {
	id = soh.5112
	desc = EVTDESC_SOH_5112
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5112 # I will help!
		
		save_event_target_as = vassal_assisting
		
		add_character_modifier = {
			modifier = ci_nuclear_option_vassal_assisting # TIANXIATODO: Faction blocker
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_regent = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			character_event = { id = soh.5116 } # Vassals of GC/powerful vassal asked to join
		}
		
		liege = {
			character_event = { id = soh.5119 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5112 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
}

# Courtiers overwhelming - GC or powerful vassal to the "rescue"?
character_event = {
	id = soh.5113
	desc = EVTDESC_SOH_5113
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5113 # I will help!
		
		save_event_target_as = vassal_assisting
		
		add_character_modifier = {
			modifier = ci_nuclear_option_vassal_assisting # TIANXIATODO: Faction blocker
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_regent = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			character_event = { id = soh.5116 } # Vassals of GC/powerful vassal asked to join
		}
		
		liege = {
			character_event = { id = soh.5119 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5113 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
}

# Eunuchs and courtiers overwhelming - GC or powerful vassal to the "rescue"?
character_event = {
	id = soh.5114
	desc = EVTDESC_SOH_5114
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5114 # I will help!
		
		save_event_target_as = vassal_assisting
		
		add_character_modifier = {
			modifier = ci_nuclear_option_vassal_assisting # TIANXIATODO: Faction blocker
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_regent = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			character_event = { id = soh.5116 } # Vassals of GC/powerful vassal asked to join
		}
		
		liege = {
			character_event = { id = soh.5119 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 10
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5114 # I don't want to risk it...
		
		prestige = -200
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_friend = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_lover = ROOT
				}
			}
			
			mult_modifier = {
				factor = 0.1
				liege = {
					is_rival = ROOT
				}
			}
		}
	}
}

# Inform GC/powerful vassal if they used the decision
character_event = {
	id = soh.5115
	desc = EVTDESC_SOH_5115
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5115 # I will help!
		
		save_event_target_as = vassal_assisting
		
		add_character_modifier = {
			modifier = ci_nuclear_option_vassal_assisting # TIANXIATODO: Faction blocker
			months = 12
		}
		
		any_vassal = {
			limit = {
				has_regent = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			character_event = { id = soh.5116 } # Vassals of GC/powerful vassal asked to join
		}
		
		liege = {
			character_event = { id = soh.5119 } # Inform liege
		}
	}
}

# Inform vassals of GC/powerful vassal that GC/powerful vassal is doing the thing
character_event = {
	id = soh.5116
	desc = EVTDESC_SOH_5116
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5116 # I will help!
		
		FROM = {
			character_event = { id = soh.5117 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROMFROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROMFROM
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = FROMFROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5116 # I don't want to risk it...
		
		prestige = -100
		
		FROM = {
			character_event = { id = soh.5118 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_friend = FROMFROM
			}
			
			mult_modifier = {
				factor = 0.1
				is_lover = FROMFROM
			}
			
			mult_modifier = {
				factor = 100
				is_rival = FROMFROM
			}
		}
	}
}

# Inform GC/powerful vassal - vassal is helping
character_event = {
	id = soh.5117
	desc = EVTDESC_SOH_5117
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5117 # Excellent!
		
		opinion = {
			modifier = opinion_ci_nuclear_option_help
			who = FROM
			months = 6
		}
		
		top_liege = {
			opinion = {
				modifier = opinion_ci_nuclear_option_help
				who = FROM
				months = 6
			}
		}
		
		add_character_modifier = {
			modifier = ci_nuclear_option_in_effect
			months = 12
		}
	}
}

# Inform GC/powerful vassal - vassal is not helping
character_event = {
	id = soh.5118
	desc = EVTDESC_SOH_5118
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5118 # I will remember this when I am emp-... I will remember this!
		
		opinion = {
			modifier = opinion_ci_nuclear_option_no_help
			who = FROM
			months = 6
		}
		
		top_liege = {
			opinion = {
				modifier = opinion_ci_nuclear_option_no_help
				who = FROM
				months = 6
			}
		}
	}
}

# Liege informed that GC/powerful vassal is "helping" - pick a side?
character_event = {
	id = soh.5119
	desc = EVTDESC_SOH_5119
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		opinion = {
			modifier = opinion_ci_nuclear_option_help
			who = FROM
			months = 6
		}
		
		opinion = {
			modifier = opinion_ci_nuclear_option_help_vassal_assisting
			who = FROM
			months = 6
		}
		
		add_character_modifier = {
			modifier = ci_nuclear_option_in_effect
			months = 12
		}
	}
	
	option = {
		trigger = {
			has_regent = no
		}
		
		name = EVTOPTA_SOH_5119 # I appreciate the help!
		
		set_character_flag = ci_nuclear_option_supporting_gc
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			has_regent = no
			intrigue >= 10
		}
		
		name = EVTOPTB_SOH_5119 # I will play both sides!
		
		set_character_flag = ci_nuclear_option_playing_both_sides
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			has_regent = no
		}
		
		name = EVTOPTC_SOH_5119 # I'd rather support the court!
		
		set_character_flag = ci_nuclear_option_supporting_court
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 0.01
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 0.01
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		trigger = {
			has_regent = yes
		}
		
		name = EVTOPTD_SOH_5119 # I can't get involved...
		
		set_character_flag = ci_nuclear_option_neutral
	}
	
	after = {
		character_event = { id = soh.5120 days = 15 random = 30 } # See if the eunuchs/courtiers discover it
	}
}

### GC/powerful vassal arrives at the capital

# Ping liege to see if eunuchs/courtiers discover GC/powerful vassal
character_event = {
	id = soh.5120
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Conclave"
	
	only_independent = yes
	
	trigger = {
		real_tier = emperor
		OR = {
			government = chinese_imperial_government
			government = eastern_imperial_government
		}
		
		has_character_modifier = ci_nuclear_option_in_effect
	}
	
	immediate = {
		clr_character_flag = ci_nuclear_option_liege_revealed
		
		set_variable = {
			which = ci_nuclear_option_vassal_score
			value = 100
		}
		
		if = {
			limit = {
				event_target:vassal_assisting = {
					lower_real_tier_than = duke
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_vassal_score
				value = -50
			}
		}
		
		else_if = {
			limit = {
				event_target:vassal_assisting = {
					real_tier = king
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_vassal_score
				value = 50
			}
		}
		
		set_variable = {
			which = ci_nuclear_option_court_score
			value = 100
		}
		
		if = {
			limit = {
				primary_title = {
					has_law = eunuch_law_4
				}
			}
			
			if = {
				limit = {
					has_global_flag = yulin_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = longwu_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = shenwu_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = shence_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = pengri_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = tianwu_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = longwei_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
			
			if = {
				limit = {
					has_global_flag = shenwei_guard_eunuchs
				}
				
				change_variable = {
					which = ci_nuclear_option_court_score
					value = 25
				}
			}
		}
		
		if = {
			limit = {
				primary_title = {
					has_law = ci_courtier_law_4
				}
			}
			
			any_voter = {
				limit = {
					is_landed = no
					is_council_eunuch_trigger = no
				}
				
				ROOT = {
					change_variable = {
						which = ci_nuclear_option_court_score
						value = 15
					}
				}
			}
		}
		
		set_variable = {
			which = ci_nuclear_option_liege_score
			value = 100
		}
		if = {
			limit = {
				has_global_flag = yulin_guard_exists
				NOT = {
					has_global_flag = yulin_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = longwu_guard_exists
				NOT = {
					has_global_flag = longwu_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = shenwu_guard_exists
				NOT = {
					has_global_flag = shenwu_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = shence_guard_exists
				NOT = {
					has_global_flag = shence_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = pengri_guard_exists
				NOT = {
					has_global_flag = pengri_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = tianwu_guard_exists
				NOT = {
					has_global_flag = tianwu_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = longwei_guard_exists
				NOT = {
					has_global_flag = longwei_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_global_flag = shenwei_guard_exists
				NOT = {
					has_global_flag = shenwei_guard_eunuchs
				}
			}
			
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = 25
			}
		}
		
		if = {
			limit = {
				has_character_flag = ci_nuclear_option_playing_both_sides
			}
			
			change_variable = {
				which = ci_nuclear_option_court_score
				value = -25
			}
			
			change_variable = {
				which = ci_nuclear_option_vassal_score
				value = -25
			}
		}
		
		else_if = {
			limit = {
				has_character_flag = ci_nuclear_option_supporting_gc
			}
			
			change_variable = {
				which = ci_nuclear_option_vassal_score
				which = ci_nuclear_option_liege_score
			}
			
			set_variable = {
				which = ci_nuclear_option_liege_score
				value = 0
			}
		}
		
		if = {
			limit = {
				has_character_flag = ci_nuclear_option_supporting_court
			}
			
			event_target:vassal_assisting = {
				character_event = { id = soh.5121 } # Inform vassal that liege is opposing them
			}
			
			change_variable = {
				which = ci_nuclear_option_court_score
				which = ci_nuclear_option_liege_score
			}
			
			set_variable = {
				which = ci_nuclear_option_liege_score
				value = 0
			}
		}
		
		else = {
			# Find someone to possibly notice
			random_list = {
				50 = {
					trigger = {
						primary_title = {
							has_law = eunuch_law_4
						}
					}
					
					random_voter = {
						limit = {
							is_council_eunuch_trigger = yes
						}
						
						preferred_limit = {
							any_rival = {
								character = event_target:vassal_assisting
							}
						}
						
						save_event_target_as = possibly_noticing
					}
				}
				
				50 = {
					trigger = {
						primary_title = {
							has_law = ci_courtier_law_4
						}
					}
					
					random_courtier = {
						limit = {
							is_adult = yes
							prisoner = no
							is_council_eunuch_trigger = no
							
							NAND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = ROOT
								}
								any_consort = {
									character = ROOT
								}
								any_child = {
									character = ROOT
								}
								any_child_even_if_dead = {
									any_child = {
										character = ROOT
									}
								}
							}
						}
						
						preferred_limit = {
							any_rival = {
								character = event_target:vassal_assisting
							}
						}
						
						save_event_target_as = possibly_noticing
					}
				}
			}
			
			# Then see if they notice
			random_list = {
				50 = {
					mult_modifier = {
						factor = 0.5
						has_character_flag = ci_nuclear_option_supporting_gc
					}
					
					mult_modifier = {
						factor = 2
						event_target:possibly_noticing = {
							attribute_diff = {
								character = event_target:vassal_assisting
								attribute = intrigue
								value >= 5
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						event_target:possibly_noticing = {
							attribute_diff = {
								character = event_target:vassal_assisting
								attribute = intrigue
								value >= 10
							}
						}
					}
					
					event_target:vassal_assisting = {
						character_event = { id = soh.5123 } # Inform vassal that they have been discovered
					}
					
					change_variable = {
						which = ci_nuclear_option_vassal_score
						value = -25
					}
				}
				
				50 = {
					mult_modifier = {
						factor = 2
						event_target:possibly_noticing = {
							attribute_diff = {
								character = event_target:vassal_assisting
								attribute = intrigue
								value <= -5
							}
						}
					}
					
					mult_modifier = {
						factor = 2
						event_target:possibly_noticing = {
							attribute_diff = {
								character = event_target:vassal_assisting
								attribute = intrigue
								value <= -10
							}
						}
					}
					
					event_target:vassal_assisting = {
						character_event = { id = soh.5125 } # Inform vassal that they did not get detected
					}
					
					change_variable = {
						which = ci_nuclear_option_court_score
						value = -25
					}
				}
			}
		}
		
		character_event = { id = soh.5127 days = 1 random = 5 }
		
		top_liege = {
			any_realm_lord = {
				limit = {
					ai = no
					NOR = {
						character = ROOT
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_ci_nuclear_option_help
						}
					}
				}
				
				narrative_event = { id = soh.5261 } # Inform the realm
			}
		}
	}
}

# GC/powerful vassal arrives at capital - discovered because liege is supporting the opposition
character_event = {
	id = soh.5121
	desc = EVTDESC_SOH_5121
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5121 # I will remember this when I am emp-... I will remember this!
		
		FROM = {
			character_event = { id = soh.5122 } # Inform liege
		}
		
		opinion = {
			modifier = opinion_ci_nuclear_option_no_help
			who = FROM
			months = 6
		}
	}
}

# Inform liege - GC/powerful vassal arrived and knows you oppose him
character_event = {
	id = soh.5122
	desc = EVTDESC_SOH_5122
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5122 # It is for the good of the realm...
	}
}

# GC/powerful vassal arrives at capital - discovered
character_event = {
	id = soh.5123
	desc = EVTDESC_SOH_5123
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5123 # Curses!
		
		FROM = {
			character_event = { id = soh.5124 } # Inform liege
		}
	}
}

# Inform liege - GC/powerful vassal arrived and was discovered
character_event = {
	id = soh.5124
	desc = EVTDESC_SOH_5124
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_supporting_gc
		}
		
		name = EVTOPTA_SOH_5124 # I see...
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_playing_both_sides
		}
		
		name = EVTOPTB_SOH_5124 # Now we wait...
	}
}

# GC/powerful vassal arrives at capital - not discovered
character_event = {
	id = soh.5125
	desc = EVTDESC_SOH_5125
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5117 # Excellent!
		
		FROM = {
			character_event = { id = soh.5126 } # Inform liege
		}
	}
}

# Inform liege - GC/powerful vassal arrived without being discovered
character_event = {
	id = soh.5126
	desc = EVTDESC_SOH_5126
	picture = GFX_evt_china_expansionist
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_supporting_gc
		}
		
		name = EVTOPTA_SOH_5126 # Excellent!
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_playing_both_sides
		}
		
		name = EVTOPTB_SOH_5126 # Now we wait...
	}
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = ci_nuclear_option_supporting_gc
				has_character_flag = ci_nuclear_option_playing_both_sides
			}
		}
		
		name = EVTOPTC_SOH_5126 # I see...
	}
}



##### Fighting

# Ping liege for fighting progress
character_event = {
	id = soh.5127
	hide_window = yes
	
	is_triggered_only = yes
	
	has_dlc = "Jade Dragon"
	has_dlc = "Conclave"
	
	only_independent = yes
	
	trigger = {
		real_tier = emperor
		
		OR = {
			government = chinese_imperial_government
			government = eastern_imperial_government
		}
		
		has_character_modifier = ci_nuclear_option_in_effect
	}
	
	immediate = {
		# First see if it is time to end the fight
		if = {
			limit = {
				OR = {
					AND = {
						OR = {
							check_variable = {
								which = ci_nuclear_option_court_score
								value < 0
							}
							
							check_variable = {
								which = ci_nuclear_option_vassal_score
								value < 0
							}
						}
						
						NOT = {
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
					
					NAND = {
						check_variable = {
							which = ci_nuclear_option_court_score
							value >= 0
						}
						check_variable = {
							which = ci_nuclear_option_vassal_score
							value >= 0
						}
					}
					
					NAND = {
						check_variable = {
							which = ci_nuclear_option_court_score
							value >= 0
						}
						check_variable = {
							which = ci_nuclear_option_liege_score
							value >= 0
						}
					}
					
					NAND = {
						check_variable = {
							which = ci_nuclear_option_vassal_score
							value >= 0
						}
						check_variable = {
							which = ci_nuclear_option_liege_score
							value >= 0
						}
					}
					
					event_target:vassal_assisting = {
						is_alive = no # Impossible for the vassal to win, so pick a winner
					}
				}
			}
			
			if = {
				limit = {
					OR = {
						check_variable = {
							which = ci_nuclear_option_vassal_score
							value < 0
						}
						
						event_target:vassal_assisting = {
							is_alive = no
						}
					}
					
					check_variable = {
						which = ci_nuclear_option_court_score
						value >= 0
					}
					
					NOT = {
						has_character_flag = ci_nuclear_option_liege_revealed
					}
				}
				
				if = {
					limit = {
						primary_title = {
							has_law = eunuch_law_4
							NOT = {
								has_law = ci_courtier_law_4
							}
						}
					}
					
					character_event = { id = soh.5190 } # Eunuchs winning
				}
				
				else_if = {
					limit = {
						primary_title = {
							has_law = ci_courtier_law_4
							NOT = {
								has_law = eunuch_law_4
							}
						}
					}
					
					character_event = { id = soh.5191 } # Courtiers winning
				}
				
				else = {
					character_event = { id = soh.5192 } # Eunuchs and courtiers winning
				}
			}
			
			else_if = {
				limit = {
					check_variable = {
						which = ci_nuclear_option_court_score
						value < 0
					}
					
					check_variable = {
						which = ci_nuclear_option_vassal_score
						value >= 0
					}
					
					NOT = {
						has_character_flag = ci_nuclear_option_liege_revealed
					}
				}
				
				character_event = { id = soh.5193 } # GC/powerful vassal winning winning
			}
			
			else = {
				narrative_event = { id = soh.5240 } # Liege won
			}
		}
		
		else = {
			# Fight! Fight! Fight!
			# First pick someone to lead the opposition against the vassal
			random_list = {
				50 = {
					trigger = {
						primary_title = {
							has_law = eunuch_law_4
						}
					}
					
					random_voter = {
						limit = {
							is_council_eunuch_trigger = yes
							is_incapable = no
						}
						
						preferred_limit = {
							character = event_target:possibly_noticing
						}
						
						preferred_limit = {
							is_rival = event_target:vassal_assisting
						}
						
						preferred_limit = {
							NOR = {
								is_friend = event_target:vassal_assisting
								is_lover = event_target:vassal_assisting
							}
						}
						
						save_event_target_as = leads_the_fight
					}
				}
				
				50 = {
					trigger = {
						primary_title = {
							has_law = ci_courtier_law_4
						}
					}
					
					random_courtier = {
						limit = {
							is_adult = yes
							prisoner = no
							is_council_eunuch_trigger = no
							is_incapable = no
							
							NAND = {
								dynasty = ROOT
								any_close_relative = {
									character = ROOT
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = ROOT
								}
								any_consort = {
									character = ROOT
								}
								any_child = {
									character = ROOT
								}
								any_child_even_if_dead = {
									any_child = {
										character = ROOT
									}
								}
							}
						}
						
						preferred_limit = {
							character = event_target:possibly_noticing
						}
						
						preferred_limit = {
							is_rival = event_target:vassal_assisting
						}
						
						preferred_limit = {
							NOR = {
								is_friend = event_target:vassal_assisting
								is_lover = event_target:vassal_assisting
							}
						}
						
						save_event_target_as = leads_the_fight
					}
				}
			}
			
			# Then have the vassal and the court faction(s) fight, if relevant
			if = {
				limit = {
					check_variable = {
						which = ci_nuclear_option_court_score
						value >= 0
					}
					
					check_variable = {
						which = ci_nuclear_option_vassal_score
						value >= 0
					}
					
				}
				random_list = {
					50 = {
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value <= -5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value <= -10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value <= -15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value <= -20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -25
								}
							}
						}
					}
					
					50 = {
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value >= 5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value >= 10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value >= 15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = event_target:vassal_assisting
									attribute = martial
									value >= 20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -25
								}
							}
						}
					}
				}
			}
			
			# Then have the court fight the liege, if relevant
			if = {
				limit = {
					check_variable = {
						which = ci_nuclear_option_court_score
						value >= 0
					}
					
					check_variable = {
						which = ci_nuclear_option_liege_score
						value >= 0
					}
					
					has_character_flag = ci_nuclear_option_liege_revealed
				}
				
				random_list = {
					50 = {
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -25
								}
							}
						}
					}
					
					50 = {
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:leads_the_fight = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -25
								}
							}
						}
					}
				}
			}
						
			# Then have the vassal fight the liege, if relevant
			if = {
				limit = {
					check_variable = {
						which = ci_nuclear_option_vassal_score
						value >= 0
					}
					
					check_variable = {
						which = ci_nuclear_option_liege_score
						value >= 0
					}
					
					has_character_flag = ci_nuclear_option_liege_revealed
				}
				
				random_list = {
					50 = {
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value <= -20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_court_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_vassal_score
									value = -25
								}
							}
						}
					}
					
					50 = {
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 5
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 10
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 15
								}
							}
						}
						
						mult_modifier = {
							factor = 2
							event_target:vassal_assisting = {
								attribute_diff = {
									character = ROOT
									attribute = martial
									value >= 20
								}
							}
						}
						
						random_list = {
							5 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -5
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -10
								}
							}
							
							60 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -15
								}
							}
							
							15 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -20
								}
							}
							
							5 = {
								change_variable = {
									which = ci_nuclear_option_liege_score
									value = -25
								}
							}
						}
					}
				}
			}
			
			# Then figure out who is winning
			if = {
				limit = {
					has_character_flag = ci_nuclear_option_liege_revealed
				}
				
				if = {
					limit = {
						check_variable = {
							which = ci_nuclear_option_vassal_score
							which = ci_nuclear_option_court_score
						}
						
						check_variable = {
							which = ci_nuclear_option_vassal_score
							which = ci_nuclear_option_liege_score
						}
					}
					
					character_event = { id = soh.5128 } # GC/powerful vassal is winning
				}
				
				else_if = {
					limit = {
						check_variable = {
							which = ci_nuclear_option_court_score
							which = ci_nuclear_option_vassal_score
						}
						
						check_variable = {
							which = ci_nuclear_option_court_score
							which = ci_nuclear_option_liege_score
						}
					}
					
					character_event = { id = soh.5151 } # Eunuchs/courtiers winning
				}
				
				else = {
					character_event = { id = soh.5171 } # Liege winning
				}
			}
			
			else = {
				if = {
					limit = {
						check_variable = {
							which = ci_nuclear_option_vassal_score
							which = ci_nuclear_option_court_score
						}
					}
					
					character_event = { id = soh.5128 } # GC/powerful vassal is winning
				}
				
				else = {
					character_event = { id = soh.5151 } # Eunuchs/courtiers winning
				}
			}
		}
		
		repeat_event = { id = soh.5127 days = 2 random = 5 }
	}
}

### GC/powerful vassal winning

# Liege informed
character_event = {
	id = soh.5128
	desc = EVTDESC_SOH_5128
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = ci_nuclear_option_liege_revealed
				has_character_flag = ci_nuclear_option_supporting_court
				has_character_flag = ci_nuclear_option_supporting_gc
			}
		}
		
		name = EVTOPTA_SOH_5128 # I see...
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5129 } # Event selection
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = wroth
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_supporting_gc
		}
		
		name = EVTOPTB_SOH_5128 # Great!
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5129 } # Event selection
		}
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = ci_nuclear_option_supporting_court
				has_character_flag = ci_nuclear_option_liege_revealed
			}
		}
		
		name = EVTOPTC_SOH_5128 # Not good!
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5129 } # Event selection
		}
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_playing_both_sides
			NOT = {
				has_character_flag = ci_nuclear_option_liege_revealed
			}
		}
		
		name = EVTOPTD_SOH_5128 # Time to change that!
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = patient
			}
		}
	}
}

# Hidden event to decide what GC/powerful vassal gets
character_event = {
	id = soh.5129
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				character_event = { id = soh.5130 } # Fighting goes well
			}
			
			10 = {
				trigger = {
					FROM = {
						any_courtier = {
							is_adult = yes
							prisoner = no
							
							NAND = {
								dynasty = FROM
								any_close_relative = {
									character = FROM
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							any_rival = {
								character = ROOT
							}
						}
					}
				}
				
				FROM = {
					random_courtier = {
						limit = {
							is_adult = yes
							prisoner = no
							
							NAND = {
								dynasty = FROM
								any_close_relative = {
									character = FROM
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							is_rival = ROOT
						}
						
						save_event_target_as = cornered_rival
					}
				}
				
				character_event = { id = soh.5131 }  # Cornered a rival
			}
			
			10 = {
				trigger = {
					FROM = {
						any_courtier = {
							is_adult = yes
							prisoner = no
							
							NAND = {
								dynasty = FROM
								any_close_relative = {
									character = FROM
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							
							NOR = {
								is_rival = ROOT
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_you_will_be_spared
								}
							}
							
							FROM = {
								any_courtier = {
									is_adult = yes
									prisoner = no
									
									NAND = {
										dynasty = FROM
										any_close_relative = {
											character = FROM
										}
									}
									
									OR = {
										is_voter = yes
										any_spouse = {
											character = FROM
										}
										any_consort = {
											character = FROM
										}
										any_child = {
											character = FROM
										}
										any_child_even_if_dead = {
											any_child = {
												character = FROM
											}
										}
									}
									
									is_rival = PREVPREV
									
									NOT = {
										reverse_has_opinion_modifier = {
											who = ROOT
											modifier = opinion_you_will_be_spared
										}
									}
								}
							}
						}
					}
				}
				
				FROM = {
					random_courtier = {
						limit = {
							is_adult = yes
							prisoner = no
							
							NAND = {
								dynasty = FROM
								any_close_relative = {
									character = FROM
								}
							}
							
							OR = {
								is_voter = yes
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							
							NOR = {
								is_rival = ROOT
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_you_will_be_spared
								}
							}
							
							FROM = {
								any_courtier = {
									is_adult = yes
									prisoner = no
									
									NAND = {
										dynasty = FROM
										any_close_relative = {
											character = FROM
										}
									}
									
									OR = {
										is_voter = yes
										any_spouse = {
											character = FROM
										}
										any_consort = {
											character = FROM
										}
										any_child = {
											character = FROM
										}
										any_child_even_if_dead = {
											any_child = {
												character = FROM
											}
										}
									}
									
									is_rival = PREVPREV
									
									NOT = {
										reverse_has_opinion_modifier = {
											who = ROOT
											modifier = opinion_you_will_be_spared
										}
									}
								}
							}
						}
						
						save_event_target_as = traitor_courtier
						
						FROM = {
							random_courtier = {
								limit = {
									is_adult = yes
									prisoner = no
									
									NAND = {
										dynasty = FROM
										any_close_relative = {
											character = FROM
										}
									}
									
									OR = {
										is_voter = yes
										any_spouse = {
											character = FROM
										}
										any_consort = {
											character = FROM
										}
										any_child = {
											character = FROM
										}
										any_child_even_if_dead = {
											any_child = {
												character = FROM
											}
										}
									}
									
									is_rival = event_target:traitor_courtier
									
									NOT = {
										reverse_has_opinion_modifier = {
											who = ROOT
											modifier = opinion_you_will_be_spared
										}
									}
								}
								
								save_event_target_as = betrayed_courtier
							}
						}
					}
				}
				
				character_event = { id = soh.5132 } # Eunuch/courtier betrays fellow eunuch/courtier
			}
			
			10 = {
				character_event = { id = soh.5133 } # Discovered money
			}
			
			10 = {
				character_event = { id = soh.5134 } # Discovered artifact
			}
			
			10 = {
				trigger = {
					FROM = {
						OR = {
							has_character_flag = ci_nuclear_option_supporting_court
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
					
					FROM = {
						any_courtier = {
							has_minor_title = title_commander
							
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								is_voter = yes
							}
							
							NOR = {
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							
							NOT = {
								is_rival = ROOT
							}
						}
					}
				}
				
				FROM = {
					random_courtier = {
						limit = {
							has_minor_title = title_commander
							
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								is_voter = yes
							}
							
							NOR = {
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
							}
							
							NOT = {
								is_rival = ROOT
							}
						}
						
						preferred_limit = {
							OR = {
								dynasty = ROOT
								is_friend = ROOT
								is_lover = ROOT
							}
						}
						
						save_event_target_as = traitor_courtier
					}
				}
				
				character_event = { id = soh.5135 } # Courtier commander offers to switch side
			}
			
			10 = {
				trigger = {
					any_rival = {
						is_adult = yes
						prisoner = yes
						host = {
							character = FROM
						}
					}
				}
				
				random_rival = {
					limit = {
						is_adult = yes
						prisoner = yes
						host = {
							character = FROM
						}
					}
					
					save_event_target_as = discovered_prisoner
				}
				
				character_event = { id = soh.5137 } # Chance to kill imprisoned rival
			}
			
			10 = {
				trigger = {
					OR = {
						any_friend = {
							prisoner = yes
							host = {
								character = FROM
							}
						}
						
						any_lover = {
							prisoner = yes
							host = {
								character = FROM
							}
						}
						
						any_spouse = {
							prisoner = yes
							host = {
								character = FROM
							}
							NOT = {
								is_rival = ROOT
							}
						}
						
						any_consort = {
							prisoner = yes
							host = {
								character = FROM
							}
							NOR = {
								is_rival = ROOT
								has_opinion_modifier = {
									who = ROOT
									modifier = opinion_forced_consort
								}
							}
						}
					}
				}
				
				random_list = {
					25 = {
						trigger = {
							any_friend = {
								prisoner = yes
								host = {
									character = FROM
								}
							}
						}
						
						random_friend = {
							limit = {
								prisoner = yes
								host = {
									character = FROM
								}
							}
							
							save_event_target_as = discovered_prisoner
						}
					}
					
					25 = {
						trigger = {
							any_lover = {
								prisoner = yes
								host = {
									character = FROM
								}
							}
						}
						
						random_lover = {
							limit = {
								prisoner = yes
								host = {
									character = FROM
								}
							}
							
							save_event_target_as = discovered_prisoner
						}
					}
					
					25 = {
						trigger = {
							any_spouse = {
								prisoner = yes
								host = {
									character = FROM
								}
								NOT = {
									is_rival = ROOT
								}
							}
						}
						
						random_spouse = {
							limit = {
								prisoner = yes
								host = {
									character = FROM
								}
								NOT = {
									is_rival = ROOT
								}
							}
							
							save_event_target_as = discovered_prisoner
						}
					}
					
					25 = {
						trigger = {
							any_consort = {
								prisoner = yes
								host = {
									character = FROM
								}
								NOR = {
									is_rival = ROOT
									has_opinion_modifier = {
										who = ROOT
										modifier = opinion_forced_consort
									}
								}
							}
						}
						random_consort = {
							limit = {
								prisoner = yes
								host = {
									character = FROM
								}
								NOR = {
									is_rival = ROOT
									has_opinion_modifier = {
										who = ROOT
										modifier = opinion_forced_consort
									}
								}
							}
							
							save_event_target_as = discovered_prisoner
						}
					}
				}
				
				character_event = { id = soh.5139 } # Chance to free friend/lover/spouse/consort
			}
			
			10 = {
				trigger = {
					any_dynasty_member = {
						prisoner = yes
						host = {
							character = FROM
						}
						NOT = {
							is_rival = ROOT
						}
					}
				}
				
				random_dynasty_member = {
					limit = {
						prisoner = yes
						host = {
							character = FROM
						}
						NOT = {
							is_rival = ROOT
						}
					}
					
					preferred_limit = {
						is_close_relative = ROOT
					}
					
					save_event_target_as = discovered_prisoner
				}
				
				character_event = { id = soh.5143 } # Chance to free release kins(wo)man
			}
			
			10 = {
				trigger = {
					OR = {
						any_courtier = {
							has_minor_title = title_commander
							NOR = {
								is_rival = ROOT
								is_friend = ROOT
							}
						}
						
						any_vassal = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_ci_nuclear_option_help
							}
							NOR = {
								is_rival = ROOT
								is_friend = ROOT
							}
						}
					}
				}
				
				random_list = {
					50 = {
						trigger = {
							any_courtier = {
								has_minor_title = title_commander
								NOR = {
									is_rival = ROOT
									is_friend = ROOT
								}
							}
						}
						
						random_courtier = {
							limit = {
								has_minor_title = title_commander
								NOR = {
									is_rival = ROOT
									is_friend = ROOT
								}
							}
							
							save_event_target_as = commander_friend
						}
					}
					
					50 = {
						trigger = {
							any_vassal = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
								NOR = {
									is_rival = ROOT
									is_friend = ROOT
								}
							}
						}
						
						random_vassal = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
								NOR = {
									is_rival = ROOT
									is_friend = ROOT
								}
							}
							
							save_event_target_as = commander_friend
						}
					}
				}
				
				character_event = { id = soh.5146 } # Befriended own commander
			}
			
			10 = {
				trigger = {
					FROM = {
						has_character_flag = ci_nuclear_option_supporting_gc
						
						any_courtier = {
							has_minor_title = title_commander
							
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								is_voter = yes
								
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
								
								is_rival = ROOT
							}
						}
					}
				}
				
				FROM = {
					random_courtier = {
						limit = {
							has_minor_title = title_commander
							
							NOR = {
								dynasty = FROM
								is_close_relative = FROM
								is_voter = yes
								
								any_spouse = {
									character = FROM
								}
								any_consort = {
									character = FROM
								}
								any_child = {
									character = FROM
								}
								any_child_even_if_dead = {
									any_child = {
										character = FROM
									}
								}
								
								is_rival = ROOT
							}
						}
						
						save_event_target_as = commander_friend
					}
				}
				
				character_event = { id = soh.5148 } # Befriended liege's commander
			}
			
			10 = {
				trigger = {
					FROM = {
						has_character_flag = ci_nuclear_option_playing_both_sides
						NOT = {
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 5
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 10
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 15
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 20
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -5
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -10
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -15
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -20
					}
				}
				
				character_event = { id = soh.5149 } # Discovered that liege is scheming
			}
		}
	}
}

# Generic "Fighting goes well" event
character_event = {
	id = soh.5130
	desc = EVTDESC_SOH_5130
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5130 # Everything is proceeding exactly as I have foreseen!
	}
}

# Rival eunuch/courtier cornered
character_event = {
	id = soh.5131
	desc = EVTDESC_SOH_5131
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5131 # And now you die!
		
		event_target:cornered_rival = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:cornered_rival = {
			death = {
				death_reason = death_palace_fighting
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
			
			mult_modifier = {
				factor = 0.1
				dynasty = event_target:cornered_rival
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5131 # Guards! Take them away!
		
		event_target:cornered_rival = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wroth
			}
			
			mult_modifier = {
				factor = 0.01
				trait = cruel
			}
		}
	}
}

# Eunuch/courtier offers to sell out fellow eunuch/courtier
character_event = {
	id = soh.5132
	desc = EVTDESC_SOH_5132
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5132 # Very well; you will be spared!
		
		event_target:traitor_courtier = {
			reverse_opinion = {
				who = ROOT
				modifier = opinion_you_will_be_spared
			}
		}
		
		event_target:betrayed_courtier = {
			imprison = ROOT
			opinion = {
				who = event_target:traitor_courtier
				modifier = opinion_traitor
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = honest
			}
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				dynasty = event_target:traitor_courtier
			}
			
			mult_modifier = {
				factor = 0.1
				dynasty = event_target:betrayed_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5132 # And why exactly should I spare you?
		
		event_target:traitor_courtier = {
			imprison = ROOT
		}
		
		event_target:betrayed_courtier = {
			imprison = ROOT
			
			opinion = {
				who = event_target:traitor_courtier
				modifier = opinion_traitor
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = deceitful
			}
		}
	}
}

# Discovered money
character_event = {
	id = soh.5133
	desc = EVTDESC_SOH_5133
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5133 # Excellent!
		
		wealth = 1000
	}
}

# Discovered artifact
character_event = {
	id = soh.5134
	desc = EVTDESC_SOH_5134
	picture = GFX_evt_china_diplomatic_success
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5134 # Excellent!
		
		#add_random_chinese_artifact_effect = yes # TIANXIATODO
	}
}

# Palace commander offers to switch side
character_event = {
	id = soh.5135
	desc = EVTDESC_SOH_5135
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5135 # Sounds like a plan!
		
		event_target:traitor_courtier = {
			move_character = ROOT
		}
		
		liege = {
			character_event = { id = soh.5136 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = envious
			}
			
			mult_modifier = {
				factor = 10
				dynasty = event_target:traitor_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5135 # I will reward you as a traitor deserves!
		
		event_target:traitor_courtier = {
			imprison = ROOT
			
			opinion = {
				who = ROOT
				modifier = opinion_dishonest
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = paranoid
			}
		}
	}
}

# Inform liege
character_event = {
	id = soh.5136
	desc = EVTDESC_SOH_5136
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5136 # It's treason, then!
		
		opinion = {
			who = event_target:traitor_courtier
			modifier = opinion_traitor
		}
	}
}

# Opportunity to reach liege's prison and kill rival
character_event = {
	id = soh.5137
	desc = EVTDESC_SOH_5137
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5137 # And now you die!
		
		event_target:discovered_prisoner = {
			character_event = { id = soh.5138 } # Inform rival
			
			death = {
				death_reason = death_murder_unknown
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
			
			mult_modifier = {
				factor = 0.1
				dynasty = event_target:discovered_prisoner
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5137 # They are where they belong!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = wroth
			}
			
			mult_modifier = {
				factor = 0.01
				trait = cruel
			}
		}
	}
}

# Inform rival
character_event = {
	id = soh.5138
	desc = EVTDESC_SOH_5138
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5138 # No! Get away from me!
		
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
	}
}

# Opportunity to reach liege's prison and release friend/lover/spouse/consort
character_event = {
	id = soh.5139
	desc = EVTDESC_SOH_5139
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5139 # I will free them!
		
		event_target:discovered_prisoner = {
			character_event = { id = soh.5140 } # Inform target
		}
		
		FROMFROM = {
			character_event = { id = soh.5142 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 100
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5139 # They are where they belong!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
		}
	}
}

# Inform friend/lover/spouse/consort
character_event = {
	id = soh.5140
	desc = EVTDESC_SOH_5140
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5140 # My thanks!
		
		if = {
			limit = {
				is_landed = no
			}
			
			move_character = FROM
		}
		
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		trigger = {
			OR = {
				any_spouse = {
					character = FROM
				}
				any_consort = {
					character = FROM
				}
			}
			
			is_valid_romance_target = FROM
			FROM = {
				is_valid_romance_target = ROOT
			}
			
			NOR = {
				is_lover = FROM
				trait = celibate
				FROM = {
					trait = celibate
				}
			}
		}
		
		name = EVTOPTB_SOH_5140 # This must be true love!
		
		add_lover = FROM
		
		
		FROM = {
			character_event = { id = soh.5141 } # Inform FROM
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				opinion = {
					who = FROM
					value < 25
				}
			}
			
			mult_modifier = {
				factor = 0.1
				any_lover = {
					NOT = {
						character = FROM
					}
				}
			}
		}
	}
}

# Rescue romance - inform GC/powerful vassal
character_event = {
	id = soh.5141
	desc = EVTDESC_SOH_5141
	picture = GFX_evt_lovers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5141 # Here? Now? Really? Fine!
		
		add_lover = FROM
		
		unprotected_sex_effect = yes
		
		hidden_tooltip = { # You'll hardly be leading troops for a little bit...
			FROMFROMFROM = {
				change_variable = {
					which = ci_nuclear_option_vassal_score
					value = -5
				}
			}
		}
	}
}

# Inform liege
character_event = {
	id = soh.5142
	desc = EVTDESC_SOH_5142
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5142 # Escaped in the fighting?
	}
}

# Opportunity to reach liege's prison and release kins(wo)man
character_event = {
	id = soh.5143
	desc = EVTDESC_SOH_5143
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5143 # I will free them!
		
		event_target:discovered_prisoner = {
			character_event = { id = soh.5144 } # Inform target
		}
		
		FROMFROM = {
			character_event = { id = soh.5145 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 100
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5143 # They are where they belong!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
		}
	}
}

# Inform kins(wo)man
character_event = {
	id = soh.5144
	desc = EVTDESC_SOH_5144
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5144 # My thanks!
		
		if = {
			limit = {
				is_landed = no
			}
			
			move_character = FROM
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Inform liege
character_event = {
	id = soh.5145
	desc = EVTDESC_SOH_5145
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5145 # Escaped in the fighting?
	}
}

# Befriended own commander
character_event = {
	id = soh.5146
	desc = EVTDESC_SOH_5146
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5146 # Together, we shall prevail!
		
		event_target:commander_friend = {
			add_friend = ROOT
			
			character_event = { id = soh.5147 }
		}
	}
}

# Inform commander, if non-AI
character_event = {
	id = soh.5147
	desc = EVTDESC_SOH_5147
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5147 # Together, we shall prevail!
		
		add_friend = FROM
	}
}

# Befriended liege's commander (if liege supports GC/powerful vassal)
character_event = {
	id = soh.5148
	desc = EVTDESC_SOH_5148
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5148 # Together, we shall prevail!
		
		event_target:commander_friend = {
			add_friend = ROOT
		}
	}
}

# Discover that liege is plotting bad stuff
character_event = {
	id = soh.5149
	desc = EVTDESC_SOH_5149
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5149 # It's a trap!
		
		FROMFROM = {
			character_event = { id = soh.5150 } # Inform liege
		}
	}
}

# Inform liege of discovery
character_event = {
	id = soh.5150
	desc = EVTDESC_SOH_5150
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5150 # Curses!
		
		prestige = -200
		
		set_character_flag = ci_nuclear_option_liege_revealed
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = -25
			}
		}
	}
}

### Eunuchs/courtiers winning

# Liege informed
character_event = {
	id = soh.5151
	desc = EVTDESC_SOH_5151
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = ci_nuclear_option_liege_revealed
				has_character_flag = ci_nuclear_option_supporting_court
				has_character_flag = ci_nuclear_option_supporting_gc
			}
		}
		
		name = EVTOPTA_SOH_5151 # I see...
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5152 } # Event selection
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = wroth
			}
		}
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_supporting_court
		}
		
		name = EVTOPTB_SOH_5151 # Great!
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5152 } # Event selection
		}
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = ci_nuclear_option_supporting_gc
				has_character_flag = ci_nuclear_option_liege_revealed
			}
		}
		
		name = EVTOPTC_SOH_5151 # Not good!
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5152 } # Event selection
		}
	}
	
	option = {
		trigger = {
			has_character_flag = ci_nuclear_option_playing_both_sides
			NOT = {
				has_character_flag = ci_nuclear_option_liege_revealed
			}
		}
		
		name = EVTOPTD_SOH_5151 # Time to change that!
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = patient
			}
		}
	}
}

# Hidden event to decide what GC/powerful vassal gets
character_event = {
	id = soh.5152
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				character_event = { id = soh.5153 } # Fighting goes poorly
			}
			
			10 = {
				trigger = {
					FROM = {
						# Liege has lost, hope the eunuchs/courtiers will have mercy...
						has_character_flag = ci_nuclear_option_liege_revealed
						check_variable = {
							which = ci_nuclear_option_liege_score
							value < 0
						}
					}
					
					any_vassal = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_ci_nuclear_option_help
						}
						
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
				}
				
				random_vassal = {
					limit = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_ci_nuclear_option_help
						}
						
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					save_event_target_as = traitor_vassal
				}
				
				event_target:traitor_vassal = {
					character_event = { id = soh.5154 } # Vassal might betray GC
				}
			}
			
			10 = {
				trigger = {
					OR = {
						any_courtier = {
							has_minor_title = title_commander
						}
						
						any_vassal = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_ci_nuclear_option_help
							}
						}
					}
				}
				
				random_list = {
					50 = {
						trigger = {
							any_courtier = {
								has_minor_title = title_commander
							}
						}
						
						random_courtier = {
							limit = {
								has_minor_title = title_commander
							}
							
							preferred_limit = {
								combat_rating < 0
							}
							
							preferred_limit = {
								combat_rating < 10
							}
							
							preferred_limit = {
								combat_rating < 20
							}
							
							preferred_limit = {
								combat_rating < 30
							}
							
							preferred_limit = {
								combat_rating < 40
							}
							
							preferred_limit = {
								combat_rating < 50
							}
							
							preferred_limit = {
								combat_rating < 60
							}
							
							preferred_limit = {
								combat_rating < 70
							}
							
							preferred_limit = {
								combat_rating < 80
							}
							
							preferred_limit = {
								combat_rating < 90
							}
							
							preferred_limit = {
								combat_rating < 100
							}
							
							save_event_target_as = killed_commander
						}
					}
					50 = {
						trigger = {
							any_vassal = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
							}
						}
						
						random_vassal = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
							}
							
							preferred_limit = {
								combat_rating < 0
							}
							
							preferred_limit = {
								combat_rating < 10
							}
							
							preferred_limit = {
								combat_rating < 20
							}
							
							preferred_limit = {
								combat_rating < 30
							}
							
							preferred_limit = {
								combat_rating < 40
							}
							
							preferred_limit = {
								combat_rating < 50
							}
							
							preferred_limit = {
								combat_rating < 60
							}
							
							preferred_limit = {
								combat_rating < 70
							}
							
							preferred_limit = {
								combat_rating < 80
							}
							
							preferred_limit = {
								combat_rating < 90
							}
							
							preferred_limit = {
								combat_rating < 100
							}
							
							save_event_target_as = killed_commander
						}
					}
				}
				
				event_target:killed_commander = {
					character_event = { id = soh.5162 } # Commander killed in the fighting
				}
			}
			
			10 = {
				trigger = {
					combat_rating < 100
				}
				
				mult_modifier = {
					factor = 0.1
					combat_rating >= 50
				}
				
				
				mult_modifier = {
					factor = 2
					combat_rating < 25
				}
				
				character_event = { id = soh.5164 } # Injured in the fighting
			}
			
			10 = {
				trigger = {
					OR = {
						any_friend = {
							is_landed = no
							prisoner = no
							
							host = {
								character = FROM
							}
							
							NOT = {
								FROM = {
									any_courtier = {
										is_adult = yes
										prisoner = no
										
										NAND = {
											dynasty = FROM
											any_close_relative = {
												character = FROM
											}
										}
										
										OR = {
											is_voter = yes
											any_spouse = {
												character = FROM
											}
											any_consort = {
												character = FROM
											}
											any_child = {
												character = FROM
											}
											any_child_even_if_dead = {
												any_child = {
													character = FROM
												}
											}
										}
										
										character = PREVPREV
									}
								}
							}
						}
						
						any_lover = {
							is_landed = no
							prisoner = no
							
							host = {
								character = FROM
							}
							
							NOT = {
								FROM = {
									any_courtier = {
										is_adult = yes
										prisoner = no
										
										NAND = {
											dynasty = FROM
											any_close_relative = {
												character = FROM
											}
										}
										
										OR = {
											is_voter = yes
											any_spouse = {
												character = FROM
											}
											any_consort = {
												character = FROM
											}
											any_child = {
												character = FROM
											}
											any_child_even_if_dead = {
												any_child = {
													character = FROM
												}
											}
										}
										
										character = PREVPREV
									}
								}
							}
						}
					}
				}
				
				random_list = {
					50 = {
						trigger = {
							any_friend = {
								is_landed = no
								prisoner = no
								
								host = {
									character = FROM
								}
								
								NOT = {
									FROM = {
										any_courtier = {
											is_adult = yes
											prisoner = no
											
											NAND = {
												dynasty = FROM
												any_close_relative = {
													character = FROM
												}
											}
											
											OR = {
												is_voter = yes
												any_spouse = {
													character = FROM
												}
												any_consort = {
													character = FROM
												}
												any_child = {
													character = FROM
												}
												any_child_even_if_dead = {
													any_child = {
														character = FROM
													}
												}
											}
											
											character = PREVPREV
										}
									}
								}
							}
						}
						
						random_friend = {
							limit = {
								is_landed = no
								prisoner = no
								
								host = {
									character = FROM
								}
								
								NOT = {
									FROM = {
										any_courtier = {
											is_adult = yes
											prisoner = no
											
											NAND = {
												dynasty = FROM
												any_close_relative = {
													character = FROM
												}
											}
											
											OR = {
												is_voter = yes
												any_spouse = {
													character = FROM
												}
												any_consort = {
													character = FROM
												}
												any_child = {
													character = FROM
												}
												any_child_even_if_dead = {
													any_child = {
														character = FROM
													}
												}
											}
											
											character = PREVPREV
										}
									}
								}
							}
							
							save_event_target_as = slain_relation
						}
					}
					
					50 = {
						trigger = {
							any_lover = {
								is_landed = no
								prisoner = no
								
								host = {
									character = FROM
								}
								
								NOT = {
									FROM = {
										any_courtier = {
											is_adult = yes
											prisoner = no
											
											NAND = {
												dynasty = FROM
												any_close_relative = {
													character = FROM
												}
											}
											
											OR = {
												is_voter = yes
												any_spouse = {
													character = FROM
												}
												any_consort = {
													character = FROM
												}
												any_child = {
													character = FROM
												}
												any_child_even_if_dead = {
													any_child = {
														character = FROM
													}
												}
											}
											
											character = PREVPREV
										}
									}
								}
							}
						}
						
						random_lover = {
							limit = {
								is_landed = no
								prisoner = no
								
								host = {
									character = FROM
								}
								
								NOT = {
									FROM = {
										any_courtier = {
											is_adult = yes
											prisoner = no
											
											NAND = {
												dynasty = FROM
												any_close_relative = {
													character = FROM
												}
											}
											
											OR = {
												is_voter = yes
												any_spouse = {
													character = FROM
												}
												any_consort = {
													character = FROM
												}
												any_child = {
													character = FROM
												}
												any_child_even_if_dead = {
													any_child = {
														character = FROM
													}
												}
											}
											
											character = PREVPREV
										}
									}
								}
							}
							
							save_event_target_as = slain_relation
						}
					}
				}
				
				if = {
					limit = {
						event_target:slain_relation = {
							any_rival = {
								FROM = {
									any_courtier = {
										is_adult = yes
										prisoner = no
										
										NAND = {
											dynasty = FROM
											any_close_relative = {
												character = FROM
											}
										}
										
										OR = {
											is_voter = yes
											any_spouse = {
												character = FROM
											}
											any_consort = {
												character = FROM
											}
											any_child = {
												character = FROM
											}
											any_child_even_if_dead = {
												any_child = {
													character = FROM
												}
											}
										}
										
										character = PREVPREV
									}
								}
							}
						}
					}
					
					event_target:slain_relation = {
						random_rival = {
							limit = {
								FROM = {
									any_courtier = {
										is_adult = yes
										prisoner = no
										
										NAND = {
											dynasty = FROM
											any_close_relative = {
												character = FROM
											}
										}
										
										OR = {
											is_voter = yes
											any_spouse = {
												character = FROM
											}
											any_consort = {
												character = FROM
											}
											any_child = {
												character = FROM
											}
											any_child_even_if_dead = {
												any_child = {
													character = FROM
												}
											}
										}
										
										character = PREVPREV
									}
								}
							}
							
							save_event_target_as = unknown_killer
						}
					}
				}
				
				event_target:slain_relation = {
					character_event = { id = soh.5165 } # Found dead friend/lover
				}
			}
			
			10 = {
				trigger = {
					FROM = {
						has_character_flag = ci_nuclear_option_playing_both_sides
						NOT = {
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 5
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 10
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 15
					}
				}
				
				mult_modifier = {
					factor = 2
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value >= 20
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -5
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -10
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -15
					}
				}
				
				mult_modifier = {
					factor = 0.5
					attribute_diff = {
						who = FROM
						attribute = intrigue
						value <= -20
					}
				}
				
				character_event = { id = soh.5167 } # Discovered that liege is scheming
			}
		}
	}
}

# Generic "Fighting goes poorly" event
character_event = {
	id = soh.5153
	desc = EVTDESC_SOH_5153
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5153 # We can still win this!
	}
}

# GC/powerful vassal's vassal might betray GC/powerful vassal
character_event = {
	id = soh.5154
	desc = EVTDESC_SOH_5154
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5154 # It's time to save my own skin!
		
		FROM = {
			character_event = { id = soh.5156 days = 1 } # Inform GC/powerful vassal of betrayal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 100
				is_rival = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5154 # It's too risky...
		
		FROMFROM = {
			character_event = { id = soh.5155 } # Ping top liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cruel
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
}

# If no betrayal, ping liege then go to GC
character_event = {
	id = soh.5155
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.5153 } # Fighting goes poorly
		}
	}
}

# Betrayal - GC/powerful vassal
character_event = {
	id = soh.5156
	desc = EVTDESC_SOH_5156
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5156 # It's treason, then!
		
		save_event_target_as = combatant_1
		
		set_character_flag = ci_nuclear_option_duel
		
		log = "[Root.GetBestName] is fighting a backstabbing backstabber that backstabs!"
		
		FROM = {
			save_event_target_as = combatant_2
		}
		
		character_event = {	id = HFP.10100 } # The duel is fought!
	}
}

# Killed betrayer - GC/powerful vassal
character_event = {
	id = soh.5157
	desc = EVTDESC_SOH_5157
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5157 # Thus, always, to traitors!
		
		event_target:traitor_vassal = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:traitor_vassal = {
			character_event = { id = soh.5158 }
			
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = event_target:traitor_vassal
				}
				
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			character_event = { id = soh.5263 } # Inform others
		}
	}
}

# Killed betrayer - betrayer
character_event = {
	id = soh.5158
	desc = EVTDESC_SOH_5158
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5158 # Do not want!
		
		death = {
			death_reason = death_duel
			killer = FROM
		}
	}
}
		

# Killed by betrayer - GC/powerful vassal
character_event = {
	id = soh.5159
	desc = EVTDESC_SOH_5159
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5159 # Do not want!
		
		liege = {
			save_event_target_as = my_liege
		}
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					character = event_target:traitor_vassal
				}
			}
			
			reverse_opinion = {
				who = event_target:my_liege
				modifier = opinion_ci_nuclear_option_traitor
			}
		}
		
		event_target:traitor_vassal = {
			character_event = { id = soh.5160 }
		}
		
		death = {
			death_reason = death_duel
			killer = event_target:traitor_vassal
		}
	}
}

# Killed by betrayer - betrayer
character_event = {
	id = soh.5160
	desc = EVTDESC_SOH_5160
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5160 # As expected!
		
		FROM = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		any_vassal = {
			limit = {
				NOT = {
					character = FROM
				}
				
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			narrative_event = { id = soh.5262 } # Inform other supporters that they are about to die
		}
		
		FROM = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		event_target:my_liege = {
			character_event = { id = soh.5161 } # Inform the liege
		}
	}
}

# Inform liege of special outcome
character_event = {
	id = soh.5161
	desc = EVTDESC_SOH_5161
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				has_character_flag = ci_nuclear_option_liege_revealed
				has_character_flag = ci_nuclear_option_supporting_gc
			}
		}
			
		name = EVTOPTA_SOH_5161 # I see...
		
		narrative_event = { id = soh.5200 } # It could be worse...
	}
	
	option = {
		trigger = {
			OR = {
				has_character_flag = ci_nuclear_option_liege_revealed
				has_character_flag = ci_nuclear_option_supporting_gc
			}
		}
			
		name = EVTOPTB_SOH_5161 # But that means...!
		
		narrative_event = { id = soh.5198 } # Time to die...
	}
}

# GC/powerful vassal's vassal/commander killed in the fighting - vassal
character_event = {
	id = soh.5162
	desc = EVTDESC_SOH_5162
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5162 # Do not want!
		
		FROM = {
			character_event = { id = soh.5163 }
		}
		
		event_target:leads_the_fight = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_palace_fighting
			killer = event_target:leads_the_fight
		}
	}
}

# GC/powerful vassal's vassal/commander killed in the fighting - GC/powerful vassal
character_event = {
	id = soh.5163
	desc = EVTDESC_SOH_5163
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5163 # Curses!
	}
}

# Injured in the fighting
character_event = {
	id = soh.5164
	desc = EVTDESC_SOH_5164
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5164 # Curses!
		
		if = {
			limit = {
				trait = wounded
			}
			
			add_maimed_trait_effect = yes
		}
		
		else = {
			add_trait = wounded
		}
	}
}

# Friend/lover at court potentially killed by eunuch/courtier
character_event = {
	id = soh.5165
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = soh.5166 } # Inform FROM
		}
		
		if = {
			limit = {
				event_target:unknown_killer = {
					is_rival = ROOT
				}
			}
			
			death = {
				death_reason = death_murder_unknown
				killer = event_target:unknown_killer
			}
		}
		
		else = {
			death = {
				death_reason = death_murder_unknown
			}
		}
	}
}

# Found dead friend/lover
character_event = {
	id = soh.5166
	desc = EVTDESC_SOH_5166
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5166 # Who could have done this?
	}
}

# Discover that liege is plotting bad stuff
character_event = {
	id = soh.5167
	desc = EVTDESC_SOH_5167
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5167 # It's a trap!
		
		FROMFROM = {
			character_event = { id = soh.5168 } # Inform liege
		}
	}
}

# Inform liege of discovery
character_event = {
	id = soh.5168
	desc = EVTDESC_SOH_5168
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5168 # Curses!
		
		prestige = -200
		
		set_character_flag = ci_nuclear_option_liege_revealed
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = -25
			}
		}
	}
}

### Liege enters the fight

# Liege gets involved
character_event = {
	id = soh.5169
	desc = EVTDESC_SOH_5169
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5169 # Execute Order Sixty-Six!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_court_score
				value = -10
			}
			
			change_variable = {
				which = ci_nuclear_option_vassal_score
				value = -10
			}
		}
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5170 } # Inform GC/powerful vassal just how much their help is appreciated
		}
	}
}

# Inform GC/powerful vassal
character_event = {
	id = soh.5170
	desc = EVTDESC_SOH_5170
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5170 # It's a trap!
	}
}

### Liege winning

# Inform liege
character_event = {
	id = soh.5171
	desc = EVTDESC_SOH_5171
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5171 # None can stand against the Dragon!
		
		event_target:vassal_assisting = {
			character_event = { id = soh.5172 } # Event selection
		}
	}
}

# Event selection
character_event = {
	id = soh.5172
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			100 = {
				character_event = { id = soh.5173 } # Fight goes poorly
			}
			
			10 = {
				trigger = {
					# Eunuchs/courtiers have lost
					FROM = {
						check_variable = {
							which = ci_nuclear_option_court_score
							value < 0
						}
					}
					
					any_vassal = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_ci_nuclear_option_help
						}
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
				}
				
				random_vassal = {
					limit = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_ci_nuclear_option_help
						}
						
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					save_event_target_as = traitor_vassal
				}
				
				event_target:traitor_vassal = {
					character_event = { id = soh.5174 } # Vassal might betray GC
				}
			}
			
			10 = {
				trigger = {
					OR = {
						any_courtier = {
							has_minor_title = title_commander
						}
						any_vassal = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_ci_nuclear_option_help
							}
						}
					}
				}
				
				random_list = {
					50 = {
						trigger = {
							any_courtier = {
								has_minor_title = title_commander
							}
						}
						
						random_courtier = {
							limit = {
								has_minor_title = title_commander
							}
							
							preferred_limit = {
								is_rival = FROM
								OR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							preferred_limit = {
								is_rival = FROM
								NOT = {
									is_rival = ROOT
								}
							}
							
							preferred_limit = {
								NOR = {
									is_friend = FROM
									is_lover = FROM
								}
								OR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							preferred_limit = {
								NOR = {
									is_friend = FROM
									is_lover = FROM
									is_rival = ROOT
								}
							}
							
							save_event_target_as = cornered_commander
						}
					}
					
					50 = {
						trigger = {
							any_vassal = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
							}
						}
						
						random_vassal = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = opinion_ci_nuclear_option_help
								}
							}
							
							preferred_limit = {
								is_rival = FROM
								OR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							preferred_limit = {
								is_rival = FROM
								NOT = {
									is_rival = ROOT
								}
							}
							
							preferred_limit = {
								NOR = {
									is_friend = FROM
									is_lover = FROM
								}
								OR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							preferred_limit = {
								NOR = {
									is_friend = FROM
									is_lover = FROM
									is_rival = ROOT
								}
							}
							
							save_event_target_as = cornered_commander
						}
					}
				}
				
				event_target:cornered_commander = {
					character_event = { id = soh.5182 } # Commander captured or killed by liege's forces
				}
			}
			
			10 = {
				trigger = {
					FROM = {
						check_variable = {
							which = ci_nuclear_option_court_score
							value >= 0
						}
					}
				}
				
				character_event = { id = soh.5187 } # Decide whether to focus on the eunuchs/courtiers or the liege
			}
		}
	}
}

# Generic "Fighting goes poorly" event
character_event = {
	id = soh.5173
	desc = EVTDESC_SOH_5173
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5173 # We can still win this!
	}
}

# GC/powerful vassal's vassal might betray GC/powerful vassal
character_event = {
	id = soh.5174
	desc = EVTDESC_SOH_5154
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5174 # It's time to save my own skin!
		
		FROM = {
			character_event = { id = soh.5176 days = 1 } # Inform GC/powerful vassal of betrayal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = honest
			}
			
			mult_modifier = {
				factor = 0.1
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 100
				is_rival = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5174 # It's too risky...
		
		FROMFROM = {
			character_event = { id = soh.5175 } # Ping top liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = deceitful
			}
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cruel
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
		}
	}
}

# If no betrayal, ping liege then go to GC
character_event = {
	id = soh.5175
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.5173 } # Fighting goes poorly
		}
	}
}

# Betrayal - GC/powerful vassal
character_event = {
	id = soh.5176
	desc = EVTDESC_SOH_5176
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5176 # It's treason, then!
		
		save_event_target_as = combatant_1
		
		set_character_flag = ci_nuclear_option_duel
		
		set_character_flag = ci_nuclear_option_duel_case_2
		
		log = "[Root.GetBestName] is fighting a backstabbing backstabber that backstabs!"
		
		FROM = {
			save_event_target_as = combatant_2
		}
		
		character_event = {	id = HFP.10100 } # The duel is fought!
	}
}

# Killed betrayer - GC/powerful vassal
character_event = {
	id = soh.5177
	desc = EVTDESC_SOH_5177
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5177 # Thus, always, to traitors!
		
		event_target:traitor_vassal = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:traitor_vassal = {
			character_event = { id = soh.5178 }
			
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = event_target:traitor_vassal
				}
				
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			character_event = { id = soh.5263 } # Inform others
		}
	}
}

# Killed betrayer - betrayer
character_event = {
	id = soh.5178
	desc = EVTDESC_SOH_5178
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5158 # Do not want!
		
		death = {
			death_reason = death_duel
			killer = FROM
		}
	}
}

# Killed by betrayer - GC/powerful vassal
character_event = {
	id = soh.5179
	desc = EVTDESC_SOH_5179
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5179 # Do not want!
		
		liege = {
			save_event_target_as = my_liege
		}
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					character = event_target:traitor_vassal
				}
			}
			
			reverse_opinion = {
				who = event_target:my_liege
				modifier = opinion_ci_nuclear_option_traitor
			}
		}
		
		event_target:traitor_vassal = {
			character_event = { id = soh.5180 }
		}
		
		death = {
			death_reason = death_duel
			killer = event_target:traitor_vassal
		}
	}
}

# Killed by betrayer - betrayer
character_event = {
	id = soh.5180
	desc = EVTDESC_SOH_5180
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5180 # As expected!
		
		FROM = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		FROM = {
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		
		event_target:my_liege = {
			character_event = { id = soh.5181 } # Inform the liege
		}
	}
}

# Inform liege of special outcome
character_event = {
	id = soh.5181
	desc = EVTDESC_SOH_5181
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5181 # I suppose treason is its own reward...
		
		narrative_event = { id = soh.5249 } # Go to the correct ending
	}
}

# Vassal/commander of GC/powerful vassal caught by liege's forces - vassal/commander
character_event = {
	id = soh.5182
	desc = EVTDESC_SOH_5182
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5182 # You will never take me alive!
		
		prestige = 100
		
		FROMFROM = {
			character_event = { id = soh.5183 } # Inform liege
		}
		
		FROM = {
			character_event = { id = soh.5184 } # Inform GC/powerful vassal
		}
		
		death = {
			death_reason = death_palace_fighting
			killer = FROMFROM
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = brave
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = stubborn
			}
			
			mult_modifier = {
				factor = 10
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5182 # I yield! I yield!
		
		FROMFROM = {
			character_event = { id = soh.5185 } # Inform liege
		}
		
		FROM = {
			character_event = { id = soh.5186 } # Inform GC/powerful vassal
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 100
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
			
			mult_modifier = {
				factor = 100
				is_rival = FROM
			}
		}
	}
}

# Inform liege that vassal/commander of GC/powerful vassal was caught and killed
character_event = {
	id = soh.5183
	desc = EVTDESC_SOH_5183
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5183 # Thus, always, to traitors!
	}
}

# Inform GC/powerful vassal that vassal/commander of GC/powerful vassal was caught and killed
character_event = {
	id = soh.5184
	desc = EVTDESC_SOH_5184
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5184 # At least they died fighting...
	}
}

# Inform liege that vassal/commander of GC/powerful vassal was caught and imprisoned
character_event = {
	id = soh.5185
	desc = EVTDESC_SOH_5185
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5185 # I will deal with them later!
	}
}

# Inform GC/powerful vassal that vassal/commander of GC/powerful vassal was caught and imprisoned
character_event = {
	id = soh.5186
	desc = EVTDESC_SOH_5186
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5186 # They should have died fighting!
	}
}

# GC/powerful vassal might choose to focus on liege or eunuchs/courtiers
character_event = {
	id = soh.5187
	desc = EVTDESC_SOH_5187
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5187 # I will focus my liege's forces!
		
		FROMFROM = {
			character_event = { id = soh.5188 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 100
				is_rival = FROMFROM
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5187 # I will focus the court's forces!
		
		FROMFROM = {
			character_event = { id = soh.5189 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
		}
	}
}

# Inform liege - GC/powerful vassal focuses liege
character_event = {
	id = soh.5188
	desc = EVTDESC_SOH_5188
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5188 # Not ideal...
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_liege_score
				value = -10
			}
		}
	}
}

# Inform liege - GC/powerful vassal focuses on eunuchs/courtiers
character_event = {
	id = soh.5189
	desc = EVTDESC_SOH_5189
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5189 # Good! Good! Now destroy them!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_court_score
				value = -10
			}
		}
	}
}

### Eunuchs about to win

# Inform liege - last chance for betrayal if that's still the plan
character_event = {
	id = soh.5190
	desc = EVTDESC_SOH_5190
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5190 # You think you have won? Fools!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_court_score
				value = 10
			}
		}
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5190 # Well done! I was definitely a Despicable Neutral the whole time!
		
		event_target:vassal_assisting = {
			narrative_event = { id = soh.5194 } # GC/powerful vassal informed
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					character = event_target:vassal_assisting
				}
			}
			
			character_event = { id = soh.5195 } # Ping vassal
		}
		
		character_event = { id = soh.5197 } # Ping
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				is_smart_trigger = yes
			}
		}
	}
}

### Courtiers about to win

# Inform liege - last chance for betrayal if that's still the plan
character_event = {
	id = soh.5191
	desc = EVTDESC_SOH_5191
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5191 # You think you have won? Fools!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_court_score
				value = 10
			}
		}
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5191 # Well done! I was definitely a Despicable Neutral the whole time!
		
		event_target:vassal_assisting = {
			narrative_event = { id = soh.5203 } # GC/powerful vassal informed
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					character = event_target:vassal_assisting
				}
			}
			
			character_event = { id = soh.5204 } # Ping vassal
		}
		
		character_event = { id = soh.5206 } # Ping liege
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				is_smart_trigger = yes
			}
		}
	}
}

### Eunuchs and courtiers about to win

# Inform liege - last chance for betrayal if that's still the plan
character_event = {
	id = soh.5192
	desc = EVTDESC_SOH_5192
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5192 # You think you have won? Fools!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_court_score
				value = 10
			}
		}
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5192 # Well done! I was definitely a Despicable Neutral the whole time!
		
		event_target:vassal_assisting = {
			narrative_event = { id = soh.5212 } # GC/powerful vassal informed
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					character = event_target:vassal_assisting
				}
			}
			
			character_event = { id = soh.5213 } # Ping vassal
		}
		
		character_event = { id = soh.5215 } # Ping liege
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				is_smart_trigger = yes
			}
		}
	}
}

### GC/powerful vassal about to win

# Inform liege - last chance for betrayal if that's still the plan
character_event = {
	id = soh.5193
	desc = EVTDESC_SOH_5193
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5193 # You think you have won? Fool!
		
		hidden_tooltip = {
			change_variable = {
				which = ci_nuclear_option_vassal_score
				value = 10
			}
		}
		
		character_event = { id = soh.5169 } # Execute Order Sixty-Six!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
			
			mult_modifier = {
				factor = 0.1
				trait = humble
			}
			
			mult_modifier = {
				factor = 0.1
				trait = slothful
			}
			
			mult_modifier = {
				factor = 0.1
				is_dumb_trigger = yes
			}
			
			mult_modifier = {
				factor = 100
				is_rival = event_target:vassal_assisting
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5190 # Well done! I was definitely a Despicable Neutral the whole time!
		
		event_target:vassal_assisting = {
			narrative_event = { id = soh.5221 } # GC/powerful vassal informed
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 0.1
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = proud
			}
			
			mult_modifier = {
				factor = 0.1
				trait = envious
			}
			
			mult_modifier = {
				factor = 0.1
				is_smart_trigger = yes
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
		}
	}
}



##### Outcomes

### Eunuchs win

# Eunuchs win - GC
narrative_event = {
	id = soh.5194
	title = EVTTITLE_SOH_5194
	desc = EVTDESC_SOH_5194
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_rival = {
					character = event_target:leads_the_fight
				}
			}
			
			event_target:leads_the_fight = {
				save_event_target_as = killing_me
			}
		}
		
		else = {
			FROM = {
				random_voter = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					preferred_limit = {
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					save_event_target_as = killing_me
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5194 # This cannot be!
		
		event_target:killing_me = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:killing_me
		}
	}
}
		
# Ping supporting vassal
character_event = {
	id = soh.5195
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_rival = {
					character = event_target:leads_the_fight
				}
			}
			
			event_target:leads_the_fight = {
				save_event_target_as = killing_me
			}
		}
		
		else = {
			top_liege = {
				random_voter = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					preferred_limit = {
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					save_event_target_as = killing_me
				}
			}
		}
		
		narrative_event = { id = soh.5196 } # The eunuchs send their regards!
	}
}

# Eunuchs win - supporting vassals
narrative_event = {
	id = soh.5196
	title = EVTTITLE_SOH_5196
	desc = EVTDESC_SOH_5196
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5196 # Not like this!
		
		event_target:killing_me = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:killing_me
		}
	}
}

# Ping liege
character_event = {
	id = soh.5197
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = ci_nuclear_option_in_effect
		
		if = {
			limit = {
				OR = {
					has_character_flag = ci_nuclear_option_supporting_gc
					has_character_flag = ci_nuclear_option_liege_revealed
				}
			}
			
			if = {
				limit = {
					any_rival = {
						character = event_target:leads_the_fight
					}
				}
				
				event_target:leads_the_fight = {
					save_event_target_as = killing_me
				}
			}
			
			else = {
				random_voter = {
					limit = {
						is_council_eunuch_trigger = yes
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					preferred_limit = {
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					save_event_target_as = killing_me
				}
			}
			
			narrative_event = { id = soh.5198 } # The eunuchs send their regards!
		}
		
		else_if = {
			limit = {
				has_character_flag = ci_nuclear_option_neutral
			}
			
			narrative_event = { id = soh.5200 } # Inform liege
		}
		
		else = {
			narrative_event = { id = soh.5201 } # Inform liege
		}
	}
}

# Eunuchs win despite liege's opposition - liege
narrative_event = {
	id = soh.5198
	desc = EVTDESC_SOH_5198
	title = EVTTITLE_SOH_5198
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5198 # Not like this!
		
		prestige = -5000
		
		custom_tooltip = {
			text = eunuchs_take_imperial_guards
			
			if = {
				limit = {
					has_global_flag = yulin_guard_exists
				}
				
				set_global_flag = yulin_guard_eunuchs
			}
			
			if = {
				limit = {
					has_global_flag = longwu_guard_exists
				}
				
				set_global_flag = longwu_guard_eunuchs
			}
			
			if = {
				limit = {
					has_global_flag = shenwu_guard_exists
				}
				
				set_global_flag = shenwu_guard_eunuchs
			}
			
			if = {
				limit = {
					has_global_flag = shence_guard_exists
				}
				
				set_global_flag = shence_guard_eunuchs
			}
			
			if = {
				limit = {
					has_global_flag = pengri_guard_exists
				}
				
				set_global_flag = pengri_guard_exists
			}
			
			if = {
				limit = {
					has_global_flag = tianwu_guard_exists
				}
				
				set_global_flag = tianwu_guard_exists
			}
			
			if = {
				limit = {
					has_global_flag = longwei_guard_exists
				}
				
				set_global_flag = longwei_guard_eunuchs
			}
			
			if = {
				limit = {
					has_global_flag = shenwei_guard_exists
				}
				
				set_global_flag = shenwei_guard_eunuchs
			}
		}
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_courtier_law_4 = { add_law = ci_courtier_law_3 }
				ci_courtier_law_3 = { add_law = ci_courtier_law_2 }
				ci_courtier_law_2 = { add_law = ci_courtier_law_1 }
				ci_courtier_law_1 = { add_law = ci_courtier_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#
		#		mandate_penalty_massive_effect = yes
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5199 } # Inform vassals
		}
		
		death = {
			death_reason = death_murder_unknown
			killer = event_target:killing_me
		}
	}
}

# Inform the realm that the eunuchs won - liege killed "in the fighting"
narrative_event = {
	id = soh.5199
	desc = EVTDESC_SOH_5199
	title = EVTTITLE_SOH_5199
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5199 # How inauspicious!
	}
}

# Eunuchs win on their own - liege
narrative_event = {
	id = soh.5200
	title = EVTTITLE_SOH_5200
	desc = EVTDESC_SOH_5200
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5200 # Good for them, I suppose...
		
		prestige = -1000
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_courtier_law_4 = { add_law = ci_courtier_law_3 }
				ci_courtier_law_3 = { add_law = ci_courtier_law_2 }
				ci_courtier_law_2 = { add_law = ci_courtier_law_1 }
				ci_courtier_law_1 = { add_law = ci_courtier_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5202 } # Inform vassals
		}
	}
}

# Eunuchs win with liege's support - liege
narrative_event = {
	id = soh.5201
	title = EVTTITLE_SOH_5201
	desc = EVTDESC_SOH_5201
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5201 # Go team!
		
		prestige = 100
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_courtier_law_4 = { add_law = ci_courtier_law_3 }
				ci_courtier_law_3 = { add_law = ci_courtier_law_2 }
				ci_courtier_law_2 = { add_law = ci_courtier_law_1 }
				ci_courtier_law_1 = { add_law = ci_courtier_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_large_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5202 } # Inform vassals
		}
	}
}

# Inform the realm that the eunuchs won
narrative_event = {
	id = soh.5202
	title = EVTTITLE_SOH_5202
	desc = EVTDESC_SOH_5202
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5202 # I see...
	}
}

### Courtiers win

# Courtiers win - GC
narrative_event = {
	id = soh.5203
	title = EVTTITLE_SOH_5203
	desc = EVTDESC_SOH_5203
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5203 # This cannot be!
		
		event_target:leads_the_fight = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:leads_the_fight
		}
	}
}
		
# Ping supporting vassal
character_event = {
	id = soh.5204
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_rival = {
					character = event_target:leads_the_fight
				}
			}
			
			event_target:leads_the_fight = {
				save_event_target_as = killing_me
			}
		}
		
		else = {
			top_liege = {
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						is_incapable = no
						
						NAND = {
							dynasty = PREV
							any_close_relative = {
								character = PREV
							}
						}
						
						OR = {
							is_voter = yes
							any_spouse = {
								character = PREV
							}
							any_consort = {
								character = PREV
							}
							any_child = {
								character = PREV
							}
							any_child_even_if_dead = {
								any_child = {
									character = PREVPREV
								}
							}
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					preferred_limit = {
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					save_event_target_as = killing_me
				}
			}
		}
		
		narrative_event = { id = soh.5205 } # The courtiers send their regards!
	}
}

# Courtiers win - supporting vassals
narrative_event = {
	id = soh.5205
	title = EVTTITLE_SOH_5205
	desc = EVTDESC_SOH_5205
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5205 # Not like this!
		
		event_target:killing_me = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:killing_me
		}
	}
}

# Ping liege
character_event = {
	id = soh.5206
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = ci_nuclear_option_in_effect
		
		if = {
			limit = {
				OR = {
					has_character_flag = ci_nuclear_option_supporting_gc
					has_character_flag = ci_nuclear_option_liege_revealed
				}
			}
			
			if = {
				limit = {
					any_rival = {
						character = event_target:leads_the_fight
					}
				}
				
				event_target:leads_the_fight = {
					save_event_target_as = killing_me
				}
			}
			
			else = {
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						is_incapable = no
						
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						
						OR = {
							is_voter = yes
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
						
					save_event_target_as = killing_me
				}
			}
			
			narrative_event = { id = soh.5207 } # The courtiers send their regards!
		}
		
		else_if = {
			limit = {
				has_character_flag = ci_nuclear_option_neutral
			}
			
			narrative_event = { id = soh.5209 } # Inform liege
		}
		
		else = {
			narrative_event = { id = soh.5210 } # Inform liege
		}
	}
}

# Courtiers win despite liege's opposition - liege
narrative_event = {
	id = soh.5207
	title = EVTTITLE_SOH_5207
	desc = EVTDESC_SOH_5207
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5207 # Not like this!
		
		prestige = -5000
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				eunuch_law_4 = { add_law = eunuch_law_3 }
				eunuch_law_3 = { add_law = eunuch_law_2 }
				eunuch_law_2 = { add_law = eunuch_law_1 }
				eunuch_law_1 = { add_law = eunuch_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5208 } # Inform vassals
		}
		
		death = {
			death_reason = death_murder_unknown
			killer = event_target:killing_me
		}
	}
}

# Inform the realm that the courtiers won - liege killed "in the fighting"
narrative_event = {
	id = soh.5208
	title = EVTTITLE_SOH_5208
	desc = EVTDESC_SOH_5208
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5208 # How inauspicious!
	}
}

# Courtiers win on their own - liege
narrative_event = {
	id = soh.5209
	title = EVTTITLE_SOH_5209
	desc = EVTDESC_SOH_5209
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5209 # Good for them, I suppose...
		
		prestige = -1000
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				eunuch_law_4 = { add_law = eunuch_law_3 }
				eunuch_law_3 = { add_law = eunuch_law_2 }
				eunuch_law_2 = { add_law = eunuch_law_1 }
				eunuch_law_1 = { add_law = eunuch_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5211 } # Inform vassals
		}
	}
}

# Courtiers win with liege's support - liege
narrative_event = {
	id = soh.5210
	title = EVTTITLE_SOH_5210
	desc = EVTDESC_SOH_5210
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5210 # Go team!
		
		prestige = 100
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			trigger_switch = {
				on_trigger = has_law
				
				eunuch_law_4 = { add_law = eunuch_law_3 }
				eunuch_law_3 = { add_law = eunuch_law_2 }
				eunuch_law_2 = { add_law = eunuch_law_1 }
				eunuch_law_1 = { add_law = eunuch_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_large_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5211 } # Inform vassals
		}
	}
}

# Inform the realm that the courtiers won
narrative_event = {
	id = soh.5211
	title = EVTTITLE_SOH_5211
	desc = EVTDESC_SOH_5211
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5211 # I see...
	}
}

### Eunuchs and courtiers win

# Eunuchs and courtiers win - GC
narrative_event = {
	id = soh.5212
	title = EVTTITLE_SOH_5212
	desc = EVTDESC_SOH_5212
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5212 # This cannot be!
		
		event_target:leads_the_fight = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:leads_the_fight
		}
	}
}
		
# Ping supporting vassal
character_event = {
	id = soh.5213
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_rival = {
					character = event_target:leads_the_fight
				}
			}
			
			event_target:leads_the_fight = {
				save_event_target_as = killing_me
			}
		}
		
		else = {
			top_liege = {
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_incapable = no
						
						NAND = {
							dynasty = PREV
							any_close_relative = {
								character = PREV
							}
						}
						
						OR = {
							is_voter = yes
							any_spouse = {
								character = PREV
							}
							any_consort = {
								character = PREV
							}
							any_child = {
								character = PREV
							}
							any_child_even_if_dead = {
								any_child = {
									character = PREVPREV
								}
							}
						}
					}
					
					preferred_limit = {
						is_rival = ROOT
					}
					
					preferred_limit = {
						NOR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
					
					save_event_target_as = killing_me
				}
			}
		}
		
		narrative_event = { id = soh.5214 } # The eunuchs and courtiers send their regards!
	}
}

# Eunuchs and courtiers win - supporting vassals
narrative_event = {
	id = soh.5214
	title = EVTTITLE_SOH_5214
	desc = EVTDESC_SOH_5214
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5214 # Not like this!
		
		event_target:killing_me = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:killing_me
		}
	}
}

# Ping liege
character_event = {
	id = soh.5215
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = ci_nuclear_option_in_effect
		
		if = {
			limit = {
				OR = {
					has_character_flag = ci_nuclear_option_supporting_gc
					has_character_flag = ci_nuclear_option_liege_revealed
				}
			}
			
			if = {
				limit = {
					any_rival = {
						character = event_target:leads_the_fight
					}
				}
				
				event_target:leads_the_fight = {
					save_event_target_as = killing_me
				}
			}
			
			else = {
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_incapable = no
						NAND = {
							dynasty = ROOT
							any_close_relative = {
								character = ROOT
							}
						}
						OR = {
							is_voter = yes
							any_spouse = {
								character = ROOT
							}
							any_consort = {
								character = ROOT
							}
							any_child = {
								character = ROOT
							}
							any_child_even_if_dead = {
								any_child = {
									character = ROOT
								}
							}
						}
					}
					
					save_event_target_as = killing_me
				}
			}
			
			narrative_event = { id = soh.5216 } # The eunuchs and courtiers send their regards!
		}
		
		else_if = {
			limit = {
				OR = {
					has_character_flag = ci_nuclear_option_neutral
					AND = {
						has_character_flag = ci_nuclear_option_playing_both_sides
						NOT = {
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
				}
			}
			
			narrative_event = { id = soh.5218 } # Inform liege
		}
		
		else = {
			narrative_event = { id = soh.5219 } # Inform liege
		}
	}
}

# Eunuchs and courtiers win despite liege's opposition - liege
narrative_event = {
	id = soh.5216
	title = EVTTITLE_SOH_5216
	desc = EVTDESC_SOH_5216
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5207 # Not like this!
		
		prestige = -5000
		
		custom_tooltip = {
			text = eunuchs_might_take_imperial_guards
			
			if = {
				limit = {
					has_global_flag = yulin_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = yulin_guard_eunuchs
				}
			}
			
			if = {
				limit = {
					has_global_flag = longwu_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = longwu_guard_eunuchs
				}
			}
			
			if = {
				limit = {
					has_global_flag = shenwu_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = shenwu_guard_eunuchs
				}
			}
			
			if = {
				limit = {
					has_global_flag = shence_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = shence_guard_eunuchs
				}
			}
			
			if = {
				limit = {
					has_global_flag = pengri_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = pengri_guard_exists
				}
			}
			
			if = {
				limit = {
					has_global_flag = tianwu_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = tianwu_guard_exists
				}
			}
			
			if = {
				limit = {
					has_global_flag = longwei_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = longwei_guard_eunuchs
				}
			}
			
			if = {
				limit = {
					has_global_flag = shenwei_guard_exists
				}
				
				random = {
					chance = 50
					set_global_flag = shenwei_guard_eunuchs
				}
			}
		}
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5217 } # Inform vassals
		}
		
		death = {
			death_reason = death_murder_unknown
			killer = event_target:killing_me
		}
	}
}

# Inform the realm that the eunuchs and courtiers won - liege killed "in the fighting"
narrative_event = {
	id = soh.5217
	title = EVTTITLE_SOH_5217
	desc = EVTDESC_SOH_5217
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5217 # How inauspicious!
	}
}

# Eunuchs and courtiers win on their own - liege
narrative_event = {
	id = soh.5218
	title = EVTTITLE_SOH_5218
	desc = EVTDESC_SOH_5218
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5218 # Good for them, I suppose...
		
		prestige = -1000
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5220 } # Inform vassals
		}
	}
}

# Eunuchs and courtiers win with liege's support - liege
narrative_event = {
	id = soh.5219
	title = EVTTITLE_SOH_5219
	desc = EVTDESC_SOH_5219
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5219 # Go team!
		
		prestige = 100
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
		}
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_large_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
			}
			
			narrative_event = { id = soh.5220 } # Inform vassals
		}
	}
}

# Inform the realm that the eunuchs and courtiers won
narrative_event = {
	id = soh.5220
	title = EVTTITLE_SOH_5220
	desc = EVTDESC_SOH_5220
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5220 # I see...
	}
}

### GC/powerful vassal wins

# GC/powerful vassal wins - become GC and/or get bloodline if relevant - GC/powerful vassal
narrative_event = {
	id = soh.5221
	desc = EVTDESC_SOH_5221
	title = EVTTITLE_SOH_5221
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5221 # An auspicious event!
		
		remove_character_modifier = ci_nuclear_option_vassal_assisting
		
		# If our liege has been getting cute...
		if = {
			limit = {
				liege = {
					independent = no
				}
			}
			
			liege = {
				top_liege = {
					ROOT = {
						set_defacto_liege = PREV
					}
				}
			}
		}
		
		if = {
			limit = {
				NOT = {
					any_owned_bloodline = {
						has_bloodline_flag = grand_chancellor_nuclear_option_bloodline
						founder = {
							character = ROOT
						}
					}
				}
			}
			
			if = {
				limit = {
					is_female = no
				}
				
				create_bloodline = {
					type = grand_chancellor_bloodline_nuclear
				}
			}
			
			else = {
				create_bloodline = {
					type = grand_chancellor_bloodline_nuclear
					inheritance = matrilineal
				}
			}
			
			set_character_flag = special_marshal
		}
		
		if = {
			limit = {
				liege = {
					any_voter = {
						has_minor_title = title_grand_chancellor
						NOT = {
							character = ROOT
						}
					}
				}
			}
			
			liege = {
				set_character_flag = special_grand_chancellor_loss
				
				any_voter = {
					limit = {
						has_minor_title = title_grand_chancellor
					}
					
					remove_title = title_grand_chancellor
					
					character_event = { id = soh.5222 } # Inform former GC
				}
				
				clr_character_flag = special_grand_chancellor_loss
			}
		}
		
		if = {
			limit = {
				is_voter = yes
			}
			
			give_minor_title = title_grand_chancellor
		}
		
		else = {
			random_list = {
				1 = {
					trigger = {
						can_be_chancellor_trigger = yes
					}
					
					mult_modifier = {
						factor = 100
						has_education_diplomacy_trigger = yes
					}
				
					liege = {
						job_chancellor = {
							remove_title = job_chancellor
						}
					}
					
					give_job_title = job_chancellor
					
					give_minor_title = title_grand_chancellor
				}
				
				1 = {
					trigger = {
						can_be_marshal_trigger = yes
					}
					
					mult_modifier = {
						factor = 100
						has_education_martial_trigger = yes
					}
				
					liege = {
						job_marshal = {
							remove_title = job_marshal
						}
					}
					
					give_job_title = job_marshal
					
					give_minor_title = title_grand_chancellor
				}
				
				1 = {
					trigger = {
						can_be_treasurer_trigger = yes
					}
					
					mult_modifier = {
						factor = 100
						has_education_stewardship_trigger = yes
					}
				
					liege = {
						job_treasurer = {
							remove_title = job_treasurer
						}
					}
					
					give_job_title = job_treasurer
					
					give_minor_title = title_grand_chancellor
				}
				
				1 = {
					trigger = {
						can_be_spymaster_trigger = yes
					}
					
					mult_modifier = {
						factor = 100
						has_education_intrigue_trigger = yes
					}
				
					liege = {
						job_spymaster = {
							remove_title = job_spymaster
						}
					}
					
					give_job_title = job_spymaster
					
					give_minor_title = title_grand_chancellor
				}
				
				1 = {
					trigger = {
						can_be_spiritual_trigger = yes
					}
					
					mult_modifier = {
						factor = 100
						has_education_learning_trigger = yes
					}
				
					liege = {
						job_spiritual = {
							remove_title = job_spiritual
						}
					}
					
					give_job_title = job_spiritual
					
					give_minor_title = title_grand_chancellor
				}
			}
		}
		
		narrative_event = { id = soh.5223 } # Reward supporters or not
	}
}

# Powerful vassal became GC - old GC, if relevant
character_event = {
	id = soh.5222
	desc = EVTDESC_SOH_5222
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5222 # Curses!
		
		prestige = -500
	}
}

# Reward supporting vassals or not
narrative_event = {
	id = soh.5223
	title = EVTTITLE_SOH_5223
	desc = EVTDESC_SOH_5223
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5223 # They all deseve a Favor!
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			add_favor = ROOT
			
			if = {
				limit = {
					ai = no
				}
				
				narrative_event = { id = soh.5224 } # Inform vassal
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5223 # They all deseve gold!
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			wealth = 500
			
			ROOT = {
				wealth = -500
			}
			
			if = {
				limit = {
					ai = no
				}
				
				narrative_event = { id = soh.5225 } # Inform vassal
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = greedy
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5223 # They deserve nothing!
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_most_ungrateful
			}
			
			narrative_event = { id = soh.5226 } # Inform vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = just
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
		}
	}
	
	after = {
		character_event = { id = soh.5227 } # Deal with the next target
	}
}

# Inform supporting vassals - rewarded with Favor
narrative_event = {
	id = soh.5224
	title = EVTTITLE_SOH_5224
	desc = EVTDESC_SOH_5224
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5224 # Excellent!
		
		add_favor = FROM
	}
}

# Inform supporting vassals - rewarded with gold
narrative_event = {
	id = soh.5225
	title = EVTTITLE_SOH_5225
	desc = EVTDESC_SOH_5225
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5225 # Excellent!
		
		tooltip = {
			wealth = 500
		}
	}
}

# Inform supporting vassals - not rewarded
narrative_event = {
	id = soh.5226
	title = EVTTITLE_SOH_5226
	desc = EVTDESC_SOH_5226
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5226 # Is that what my help is worth?
		
		opinion = {
			who = FROM
			modifier = opinion_most_ungrateful
		}
		
		if = {
			limit = {
				is_friend = FROM
			}
			
			remove_friend = FROM
		}
		
		if = {
			limit = {
				is_lover = FROM
			}
			
			remove_lover = FROM
		}
	}
}

# Ping GC to see if he has dealt with all the relevant eunuchs/courtiers
character_event = {
	id = soh.5227
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		liege = {
			save_event_target_as = my_liege
		}
		
		if = {
			limit = {
				liege = {
					primary_title = {
						has_law = eunuch_law_4
					}
					
					any_voter = {
						is_council_eunuch_trigger = yes
						
						NOR = {
							has_opinion_modifier = {
								who = ROOT
								modifier = dealt_with_me_appropriately
							}
							
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_you_will_be_spared
							}
						}
					}
				}
			}
			
			liege = {
				random_voter = {
					limit = {
						is_council_eunuch_trigger = yes
						
						NOR = {
							has_opinion_modifier = {
								who = ROOT
								modifier = dealt_with_me_appropriately
							}
							
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_you_will_be_spared
							}
						}
					}
					
					save_event_target_as = to_be_dealt_with
				}
			}
			
			character_event = { id = soh.5228 } # Deal with the target
		}
		
		else_if = {
			limit = {
				liege = {
					primary_title = {
						has_law = ci_courtier_law_4
					}
					
					any_courtier = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						
						NAND = {
							dynasty = event_target:my_liege
							any_close_relative = {
								character = event_target:my_liege
							}
						}
						
						OR = {
							is_voter = yes
							any_spouse = {
								character = event_target:my_liege
							}
							any_consort = {
								character = event_target:my_liege
							}
							any_child = {
								character = event_target:my_liege
							}
							any_child_even_if_dead = {
								any_child = {
									character = event_target:my_liege
								}
							}
						}
						
						NOR = {
							has_opinion_modifier = {
								who = ROOT
								modifier = dealt_with_me_appropriately
							}
							
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_you_will_be_spared
							}
						}
					}
				}
			}
			
			liege = {
				random_courtier = {
					limit = {
						is_adult = yes
						prisoner = no
						is_council_eunuch_trigger = no
						
						NAND = {
							dynasty = event_target:my_liege
							any_close_relative = {
								character = event_target:my_liege
							}
						}
						
						OR = {
							is_voter = yes
							any_spouse = {
								character = event_target:my_liege
							}
							any_consort = {
								character = event_target:my_liege
							}
							any_child = {
								character = event_target:my_liege
							}
							any_child_even_if_dead = {
								any_child = {
									character = event_target:my_liege
								}
							}
						}
						
						NOR = {
							has_opinion_modifier = {
								who = ROOT
								modifier = dealt_with_me_appropriately
							}
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = opinion_you_will_be_spared
							}
						}
					}
					
					save_event_target_as = to_be_dealt_with
				}
			}
			
			character_event = { id = soh.5228 } # Deal with the target
		}
		
		else = {
			liege = {
				character_event = { id = soh.5229 } # Continue to the next step
			}
		}
	}
}

# GC/powerful vassal gets to deal with relevant eunuchs/courtiers one by one
character_event = {
	id = soh.5228
	desc = EVTDESC_SOH_5228
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:to_be_dealt_with = {
			opinion = {
				who = ROOT
				modifier = dealt_with_me_appropriately
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5228 # Death really is too good for you...
		
		event_target:to_be_dealt_with = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:to_be_dealt_with = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 100
				is_rival = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 0.01
				dynasty = event_target:to_be_dealt_with
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5228 # You will be imprisoned!
		
		event_target:to_be_dealt_with = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5228 # You obviously go free!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:to_be_dealt_with
			}
		}
	}
	
	after = {
		character_event = { id = soh.5227 } # Deal with the next target
	}
}

# Ping liege to select appropriate outcome
character_event = {
	id = soh.5229
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		remove_character_modifier = ci_nuclear_option_in_effect
		
		if = {
			limit = {
				has_character_flag = ci_nuclear_option_supporting_gc
			}
			
			narrative_event = { id = soh.5230 } # Liege informed of victory
		}
		
		else_if = {
			limit = {
				OR = {
					has_character_flag = ci_nuclear_option_neutral
					AND = {
						has_character_flag = ci_nuclear_option_playing_both_sides
						NOT = {
							has_character_flag = ci_nuclear_option_liege_revealed
						}
					}
				}
			}
			
			FROM = {
				narrative_event = { id = soh.5231 } # GC gets to decide how to deal with the situation
			}
		}
		
		else = {
			FROM = {
				narrative_event = { id = soh.5234 } # GC gets to decide how to deal with the situation
			}
		}
	}
}

# GC/powerful vassal won with liege's help - liege
narrative_event = {
	id = soh.5230
	title = EVTTITLE_SOH_5230
	desc = EVTDESC_SOH_5230
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5230 # Go team!
		
		custom_tooltip = {
			text = restore_all_imperial_guards
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		prestige = 100
		
		primary_title = {
			add_law = grand_chancellor_law_2
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_0 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_4 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = FROM
				}
			}
			narrative_event = { id = soh.5237 } # Inform vassals
		}
	}
}

# Liege was neutral - what do?
narrative_event = {
	id = soh.5231
	title = EVTTITLE_SOH_5231
	desc = EVTDESC_SOH_5231
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5231 # I'm sure my liege meant well...
		
		FROM = {
			narrative_event = { id = soh.5232 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = paranoid
					is_rival = FROM
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5231 # Certain steps must be taken...
		
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_traitor
			}
			
			narrative_event = { id = soh.5233 } # Inform liege
			
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
		}
	}
}

# GC/powerful vassal won on his own and didn't hold it against liege - liege
narrative_event = {
	id = soh.5232
	title = EVTTITLE_SOH_5232
	desc = EVTDESC_SOH_5232
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5232 # Phew!
		
		prestige = -1000
		
		custom_tooltip = {
			text = restore_all_imperial_guards
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		primary_title = {
			add_law = grand_chancellor_law_2
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_large_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = FROM
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_ci_nuclear_option_help
					}
				}
			}
			
			narrative_event = { id = soh.5237 } # Inform vassals
		}
	}
}

# GC/powerful vassal won on his own and imprisoned liege - liege
narrative_event = {
	id = soh.5233
	title = EVTTITLE_SOH_5233
	desc = EVTDESC_SOH_5233
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5233 # This isn't right!
		
		prestige = -2000
		
		custom_tooltip = {
			text = restore_all_imperial_guards
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		opinion = {
			who = FROM
			modifier = opinion_traitor
		}
		
		primary_title = {
			add_law = grand_chancellor_law_2
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_0 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_4 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = FROM
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_ci_nuclear_option_help
					}
				}
			}
			
			narrative_event = { id = soh.5238 } # Inform vassals
		}
	}
}

# Liege opposed - what do?
narrative_event = {
	id = soh.5234
	title = EVTTITLE_SOH_5234
	desc = EVTDESC_SOH_5234
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5234 # I need to take certain steps...
		
		FROM = {
			imprison = ROOT
			
			opinion = {
				who = ROOT
				modifier = opinion_traitor
			}
			
			primary_title = {
				add_claim = ROOT
			}
			
			any_demesne_title = {
				limit = {
					OR = {
						tier = king
						tier = duke
					}
					
					controls_religion = no
				}
				
				custom_tooltip = {
					text = usurp_duchies_and_kingdoms
				}
				
				custom_tooltip = {
					text = take_all_money
				}
			}
			
			narrative_event = { id = soh.5235 } # Inform liege
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
			
			mult_modifier = {
				factor = 0.001
				is_rival = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_friend = FROM
			}
			
			mult_modifier = {
				factor = 10
				is_lover = FROM
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5234 # I think FROM has outlived their usefulness...
		
		FROM = {
			opinion = {
				who = ROOT
				modifier = opinion_traitor
			}
			
			primary_title = {
				add_claim = ROOT
			}
			
			any_demesne_title = {
				limit = {
					OR = {
						tier = king
						tier = duke
					}
					controls_religion = no
				}
				
				custom_tooltip = {
					text = usurp_duchies_and_kingdoms
				}
				
				custom_tooltip = {
					text = take_all_money
				}
			}
			
			narrative_event = { id = soh.5236 } # Inform liege
			
			death = {
				death_reason = death_murder_unknown
				killer = ROOT
			}
			# Also imprison the heir, after succession recalculation!
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
		}
	}
}

# GC/powerful vassal won despite liege's opposition and imprisoned liege - liege
narrative_event = {
	id = soh.5235
	title = EVTTITLE_SOH_5235
	desc = EVTDESC_SOH_5235
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5235 # This isn't right!
		
		prestige = -2000
		
		custom_tooltip = {
			text = disband_all_imperial_guards
			clr_global_flag = yulin_guard_exists
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_exists
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_exists
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_exists
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_exists
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_exists
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_exists
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_exists
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		opinion = {
			who = FROM
			modifier = opinion_traitor
		}
		
		primary_title = {
			add_claim = FROM
		}
		
		any_demesne_title = {
			limit = {
				OR = {
					tier = king
					tier = duke
				}
				controls_religion = no
			}
			
			usurp_title = FROM
			
			add_law = succ_primogeniture
		}
		
		if = {
			limit = {
				wealth > 0
			}
			
			transfer_scaled_wealth = {
				to = FROM
				value = all
			}
		}
		
		primary_title = {
			add_law = grand_chancellor_law_2
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_0 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_4 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = FROM
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_ci_nuclear_option_help
					}
				}
			}
			
			narrative_event = { id = soh.5238 } # Inform vassals
		}
	}
}

# GC/powerful vassal won despite liege's opposition and killed liege - liege
narrative_event = {
	id = soh.5236
	title = EVTTITLE_SOH_5236
	desc = EVTDESC_SOH_5236
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5236 # This is treason, you know!
		
		primary_title = {
			add_claim = FROM
		}
		
		any_demesne_title = {
			limit = {
				OR = {
					tier = king
					tier = duke
				}
				controls_religion = no
			}
			
			usurp_title = FROM
			
			add_law = succ_primogeniture
		}
		
		if = {
			limit = {
				wealth > 0
			}
			
			transfer_scaled_wealth = {
				to = FROM
				value = all
			}
		}
		
		prestige = -5000
		
		custom_tooltip = {
			text = disband_all_imperial_guards
			clr_global_flag = yulin_guard_exists
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_exists
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_exists
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_exists
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_exists
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_exists
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_exists
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_exists
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		opinion = {
			who = FROM
			modifier = opinion_traitor
		}
		
		primary_title = {
			add_law = grand_chancellor_law_2
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_0 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_4 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_4 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_penalty_massive_effect = yes
		#		mandate_penalty_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_vassal = {
			limit = {
				ai = no
				NOT = {
					character = FROM
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = FROM
						modifier = opinion_ci_nuclear_option_help
					}
				}
			}
			
			narrative_event = { id = soh.5239 } # Inform vassals
		}
		
		current_heir = {
			if = {
				limit = {
					is_landed = no
					prisoner = no
					dynasty = ROOT
				}
				
				imprison = FROM
			}
		}
		
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
	}
}

# Inform the realm that the GC won
narrative_event = {
	id = soh.5237
	title = EVTTITLE_SOH_5237
	desc = EVTDESC_SOH_5237
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5237 # I see...
	}
}

# Inform the realm that the GC won - liege imprisoned by GC
narrative_event = {
	id = soh.5238
	title = EVTTITLE_SOH_5238
	desc = EVTDESC_SOH_5238
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5238 # Isn't that treason?
	}
}

# Inform the realm that the GC won - liege killed "in the fighting"
narrative_event = {
	id = soh.5239
	title = EVTTITLE_SOH_5239
	desc = EVTDESC_SOH_5239
	picture = GFX_evt_china_expansionist
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5239 # How awfully convenient...
	}
}

### Liege wins

# Inform liege
narrative_event = {
	id = soh.5240
	title = EVTTITLE_SOH_5240
	desc = EVTDESC_SOH_5240
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5240 # Assuming direct control!
		
		remove_character_modifier = ci_nuclear_option_in_effect
		
		prestige = 5000
		
		custom_tooltip = {
			text = restore_all_imperial_guards
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_0 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_boost_massive_effect = yes
		#		mandate_boost_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
			}
			
			reverse_opinion = {
				who = ROOT
				modifier = opinion_traitor
			}
			
			imprison = ROOT
			
			narrative_event = { id = soh.5241 } # Inform vassal
		}
	}
}

# GC/powerful vassal's vassals that assisted get imprisoned - vassal
narrative_event = {
	id = soh.5241
	title = EVTTITLE_SOH_5241
	desc = EVTDESC_SOH_5241
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5241 # At least I still have my head...
		
		prestige = -500
		
		if = {
			limit = {
				event_target:vassal_assisting = {
					character = ROOT
				}
			}
			
			FROM = {
				narrative_event = { id = soh.5242 } # Dealing with the GC/powerful vassal
			}
		}
	}
}

# How do you wish to deal with the GC/powerful vassal?
narrative_event = {
	id = soh.5242
	title = EVTTITLE_SOH_5242
	desc = EVTDESC_SOH_5242
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5242 # I need to take certain steps...
		
		event_target:vassal_assisting = {
			imprison = ROOT
			
			any_demesne_title = {
				limit = {
					higher_tier_than = count
					controls_religion = no
				}
				
				custom_tooltip = {
					text = destroy_duchies_and_kingdoms
				}
			}
			
			narrative_event = { id = soh.5243 } # Inform GC/powerful vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
			
			mult_modifier = {
				factor = 0.001
				is_rival = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:vassal_assisting
			}
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5242 # I think they have outlived their usefulness...
		
		event_target:vassal_assisting = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:vassal_assisting = {
			any_demesne_title = {
				limit = {
					higher_tier_than = count
					controls_religion = no
				}
				
				custom_tooltip = {
					text = destroy_duchies_and_kingdoms
				}
			}
			
			narrative_event = { id = soh.5245 } # Inform GC/powerful vassal
			
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = kind
				}
			}
			
			mult_modifier = {
				factor = 0.01
				trait = ambitious
			}
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
			
			mult_modifier = {
				factor = 10
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
		}
	}
	
	after = {
		character_event = { id = soh.5247 } # Time to deal with the eunuchs/courtiers
	}
}

# Liege imprisoned GC/powerful vassal - GC/powerful vassal
narrative_event = {
	id = soh.5243
	title = EVTTITLE_SOH_5243
	desc = EVTDESC_SOH_5243
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5243 # At least I still have my head...
		
		prestige = -1000
		
		any_vassal = {
			limit = {
				higher_tier_than = baron
			}
			
			set_defacto_liege = FROM
		}
		
		any_demesne_title = {
			limit = {
				higher_tier_than = count
				controls_religion = no
			}
			
			unsafe_destroy_landed_title = THIS
		}
		
		FROM = {
			any_vassal = {
				limit = {
					ai = no
					NOT = {
						reverse_has_opinion_modifier = {
							who = FROM
							modifier = opinion_ci_nuclear_option_help
						}
					}
				}
				
				narrative_event = { id = soh.5244 } # Inform vassals
			}
		}
	}
}

# Inform the realm - liege won and imprisoned GC/powerful vassal
narrative_event = {
	id = soh.5244
	title = EVTTITLE_SOH_5244
	desc = EVTDESC_SOH_5244
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5244 # I see...
	}
}

# Liege killed GC/powerful vassal - GC/powerful vassal
narrative_event = {
	id = soh.5245
	title = EVTTITLE_SOH_5245
	desc = EVTDESC_SOH_5245
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5245 # This wasn't supposed to happen!
		
		prestige = -1000
		
		any_vassal = {
			limit = {
				higher_tier_than = baron
			}
			
			set_defacto_liege = FROM
		}
		
		any_demesne_title = {
			limit = {
				higher_tier_than = count
				controls_religion = no
			}
			
			unsafe_destroy_landed_title = THIS
		}
		
		FROM = {
			any_vassal = {
				limit = {
					ai = no
					NOT = {
						reverse_has_opinion_modifier = {
							who = FROM
							modifier = opinion_ci_nuclear_option_help
						}
					}
				}
				
				narrative_event = { id = soh.5246 } # Inform vassals
			}
		}
		
		death = {
			death_reason = death_execution
			killer = FROM
		}
	}
}

# Inform the realm - liege won and killed GC/powerful vassal
narrative_event = {
	id = soh.5246
	title = EVTTITLE_SOH_5246
	desc = EVTDESC_SOH_5246
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5246 # I see...
	}
}

# Now to deal with the eunuchs/courtiers...
character_event = {
	id = soh.5247
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_courtier = {
					is_adult = yes
					prisoner = no
					
					NAND = {
						dynasty = ROOT
						any_close_relative = {
							character = ROOT
						}
					}
					
					OR = {
						is_voter = yes
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						any_child = {
							character = ROOT
						}
						any_child_even_if_dead = {
							any_child = {
								character = ROOT
							}
						}
					}
					
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = dealt_with_me_appropriately
						}
					}
				}
			}
			
			random_courtier = {
				limit = {
					is_adult = yes
					prisoner = no
					
					NAND = {
						dynasty = ROOT
						any_close_relative = {
							character = ROOT
						}
					}
					
					OR = {
						is_voter = yes
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						any_child = {
							character = ROOT
						}
						any_child_even_if_dead = {
							any_child = {
								character = ROOT
							}
						}
					}
					
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = dealt_with_me_appropriately
						}
					}
				}
				
				save_event_target_as = to_be_dealt_with
			}
			
			character_event = { id = soh.5248 } # Deal with the target
		}
	}
}

# Liege gets to deal with eunuchs/courtiers one after the other
character_event = {
	id = soh.5248
	desc = EVTDESC_SOH_5248
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:to_be_dealt_with = {
			opinion = {
				who = ROOT
				modifier = dealt_with_me_appropriately
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5248 # Death really is too good for you...
		
		event_target:to_be_dealt_with = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:to_be_dealt_with = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 100
				is_rival = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 0.01
				dynasty = event_target:to_be_dealt_with
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5248 # You will be imprisoned!
		
		event_target:to_be_dealt_with = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5248 # You obviously go free!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:to_be_dealt_with
			}
		}
	}
	
	after = {
		character_event = { id = soh.5247 } # Deal with the next target
	}
}

### Liege won because GC was betrayed

# Inform liege
narrative_event = {
	id = soh.5249
	title = EVTTITLE_SOH_5249
	desc = EVTDESC_SOH_5249
	picture = GFX_evt_emissary
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5249 # Assuming direct(er) control!
		
		remove_character_modifier = ci_nuclear_option_in_effect
		
		prestige = 2000
		
		custom_tooltip = {
			text = restore_all_imperial_guards
			clr_global_flag = yulin_guard_eunuchs
			clr_global_flag = longwu_guard_eunuchs
			clr_global_flag = shenwu_guard_eunuchs
			clr_global_flag = shence_guard_eunuchs
			clr_global_flag = pengri_guard_eunuchs
			clr_global_flag = tianwu_guard_eunuchs
			clr_global_flag = longwei_guard_eunuchs
			clr_global_flag = shenwei_guard_eunuchs
		}
		
		event_target:traitor_vassal = {
			set_defacto_liege = ROOT
		}
		
		primary_title = {
			add_law = grand_chancellor_law_0
			
			
			trigger_switch = {
				on_trigger = has_law
				
				ci_vassal_law_4 = { add_law = ci_vassal_law_3 }
				ci_vassal_law_3 = { add_law = ci_vassal_law_2 }
				ci_vassal_law_2 = { add_law = ci_vassal_law_1 }
				ci_vassal_law_1 = { add_law = ci_vassal_law_0 }
			}
			
			add_law = ci_courtier_law_0
			
			add_law = eunuch_law_0
		}
		
		recalc_succession = yes
		
		#hidden_tooltip = { # TIANXIATODO
		#	if = {
		#		limit = {
		#			government = chinese_imperial_government
		#		}
		#		
		#		mandate_boost_massive_effect = yes
		#	}
		#}
		
		#update_mandate_modifier_effect = yes # TIANXIATODO
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_traitor
				}
			}
			
			reverse_opinion = {
				who = ROOT
				modifier = opinion_traitor
			}
			
			imprison = ROOT
			
			narrative_event = { id = soh.5250 } # Inform vassal
		}
		
		any_vassal = {
			limit = {
				ai = no
				NOR = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_ci_nuclear_option_traitor
					}
					character = event_target:traitor_vassal
				}
			}
			
			narrative_event = { id = soh.5251 } # Inform vassals
		}
		
		narrative_event = { id = soh.5252 } # Reward the traitor, or not
	}
}

# GC/powerful vassal's vassals that assisted get imprisoned - vassal
narrative_event = {
	id = soh.5250
	title = EVTTITLE_SOH_5250
	desc = EVTDESC_SOH_5250
	picture = GFX_evt_china_golden_age
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5250 # At least I still have my head...
		
		prestige = -500
	}
}

# Inform the realm - liege won due to betrayal
narrative_event = {
	id = soh.5251
	title = EVTTITLE_SOH_5251
	desc = EVTDESC_SOH_5251
	picture = GFX_evt_emissary
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5251 # I see...
	}
}

# Now to reward the betrayer, or not
narrative_event = {
	id = soh.5252
	title = EVTTITLE_SOH_5252
	desc = EVTDESC_SOH_5252
	picture = GFX_evt_chinese_bureaucrat
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			is_chinese_emperor_trigger = no
		}
		
		name = EVTOPTA_SOH_5252 # They deserve some money!
		
		wealth = 1000
		
		event_target:traitor_vassal = {
			wealth = 1000
			narrative_event = { id = soh.5253 } # Inform the vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = greedy
					is_rival = event_target:traitor_vassal
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = charitable
			}
		}
	}
	
	option = {
		trigger = {
			is_chinese_emperor_trigger = yes
		}
		
		name = EVTOPTB_SOH_5252 # They deserve some Grace!
		
		event_target:traitor_vassal = {
			narrative_event = { id = soh.5254 } # Inform the vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = proud
					is_rival = event_target:traitor_vassal
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5252 # They deserve a Favor!
		
		event_target:traitor_vassal = {
			add_favor = ROOT
			narrative_event = { id = soh.5255 } # Inform the vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = paranoid
					is_rival = event_target:traitor_vassal
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_5252 # They should be the new GC!
		
		set_character_flag = special_grand_chancellor_loss
		
		any_voter = {
			limit = {
				has_minor_title = title_grand_chancellor
			}
			
			remove_title = title_grand_chancellor
			
			character_event = { id = soh.5257 } # Inform former GC
		}
		
		event_target:traitor_vassal = {
			narrative_event = { id = soh.5256 } # Inform the vassal
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = paranoid
					is_rival = event_target:traitor_vassal
				}
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:traitor_vassal
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:traitor_vassal
			}
		}
	}
	
	option = {
		name = EVTOPTE_SOH_5252 # Traitors deserve no rewards!
		
		event_target:traitor_vassal = {
			narrative_event = { id = soh.5258 } # Inform the vassal
			
			opinion = {
				who = ROOT
				modifier = opinion_most_ungrateful
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = trusting
			}
		}
	}
	
	after = {
		character_event = { id = soh.5259 } # Time to deal with eunuchs/courtiers
	}
}

# Betrayer got money - betrayer
narrative_event = {
	id = soh.5253
	title = EVTTITLE_SOH_5253
	desc = EVTDESC_SOH_5253
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5253 # Excellent!
		
		tooltip = {
			wealth = 1000
		}
	}
}

# Betrayer got Grace - betrayer
narrative_event = {
	id = soh.5254
	title = EVTTITLE_SOH_5254
	desc = EVTDESC_SOH_5254
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5254 # Excellent!
		
		add_grace_super_huge_effect = yes
	}
}

# Betrayer got Favor - betrayer
narrative_event = {
	id = soh.5255
	title = EVTTITLE_SOH_5255
	desc = EVTDESC_SOH_5255
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5255 # Excellent!
		
		add_favor = FROM
	}
}

# Betrayer became GC (still depowered) - betrayer
narrative_event = {
	id = soh.5256
	title = EVTTITLE_SOH_5256
	desc = EVTDESC_SOH_5256
	picture = GFX_evt_china_diplomatic_success
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5256 # Excellent!
		
		if = {
			limit = {
				NOT = {
					any_owned_bloodline = {
						has_bloodline_flag = grand_chancellor_nuclear_option_betrayer_bloodline
						founder = {
							character = ROOT
						}
					}
				}
			}
			
			if = {
				limit = {
					is_female = no
				}
				
				create_bloodline = {
					type = grand_chancellor_bloodline_nuclear_betrayer
				}
			}
			
			else = {
				create_bloodline = {
					type = grand_chancellor_bloodline_nuclear_betrayer
					inheritance = matrilineal
				}
			}
			
			set_character_flag = special_marshal
		}
		
		set_defacto_liege = FROM
		
		random_list = {
			1 = {
				trigger = {
					can_be_chancellor_trigger = yes
				}
				
				mult_modifier = {
					factor = 100
					has_education_diplomacy_trigger = yes
				}
			
				liege = {
					job_chancellor = {
						remove_title = job_chancellor
					}
				}
				
				give_job_title = job_chancellor
				
				give_minor_title = title_grand_chancellor
			}
			
			1 = {
				trigger = {
					can_be_marshal_trigger = yes
				}
				
				mult_modifier = {
					factor = 100
					has_education_martial_trigger = yes
				}
			
				liege = {
					job_marshal = {
						remove_title = job_marshal
					}
				}
				
				give_job_title = job_marshal
				
				give_minor_title = title_grand_chancellor
			}
			
			1 = {
				trigger = {
					can_be_treasurer_trigger = yes
				}
				
				mult_modifier = {
					factor = 100
					has_education_stewardship_trigger = yes
				}
			
				liege = {
					job_treasurer = {
						remove_title = job_treasurer
					}
				}
				
				give_job_title = job_treasurer
				
				give_minor_title = title_grand_chancellor
			}
			
			1 = {
				trigger = {
					can_be_spymaster_trigger = yes
				}
				
				mult_modifier = {
					factor = 100
					has_education_intrigue_trigger = yes
				}
			
				liege = {
					job_spymaster = {
						remove_title = job_spymaster
					}
				}
				
				give_job_title = job_spymaster
				
				give_minor_title = title_grand_chancellor
			}
			
			1 = {
				trigger = {
					can_be_spiritual_trigger = yes
				}
				
				mult_modifier = {
					factor = 100
					has_education_learning_trigger = yes
				}
			
				liege = {
					job_spiritual = {
						remove_title = job_spiritual
					}
				}
				
				give_job_title = job_spiritual
				
				give_minor_title = title_grand_chancellor
			}
		}
		
		liege = {
			clr_character_flag = special_grand_chancellor_loss
		}
	}
}

# Betrayer became GC - old GC, if relevant
character_event = {
	id = soh.5257
	desc = EVTDESC_SOH_5257
	picture = GFX_evt_china_diplomatic_incident
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5257 # Curses!
		
		prestige = -500
	}
}

# Betrayer got nothing - betrayer
narrative_event = {
	id = soh.5258
	title = EVTTITLE_SOH_5258
	desc = EVTDESC_SOH_5258
	picture = GFX_evt_china_diplomatic_incident
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5258 # Is that what my help is worth?
		
		opinion = {
			who = FROM
			modifier = opinion_most_ungrateful
		}
		
		if = {
			limit = {
				is_friend = FROM
			}
			
			remove_friend = FROM
		}
		
		if = {
			limit = {
				is_lover = FROM
			}
			
			remove_lover = FROM
		}
	}
}

# Now to deal with the eunuchs/courtiers...
character_event = {
	id = soh.5259
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				any_courtier = {
					is_adult = yes
					prisoner = no
					
					NAND = {
						dynasty = ROOT
						any_close_relative = {
							character = ROOT
						}
					}
					
					OR = {
						is_voter = yes
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						any_child = {
							character = ROOT
						}
						any_child_even_if_dead = {
							any_child = {
								character = ROOT
							}
						}
					}
					
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = dealt_with_me_appropriately
						}
					}
				}
			}
			
			random_courtier = {
				limit = {
					is_adult = yes
					prisoner = no
					
					NAND = {
						dynasty = ROOT
						any_close_relative = {
							character = ROOT
						}
					}
					
					OR = {
						is_voter = yes
						any_spouse = {
							character = ROOT
						}
						any_consort = {
							character = ROOT
						}
						any_child = {
							character = ROOT
						}
						any_child_even_if_dead = {
							any_child = {
								character = ROOT
							}
						}
					}
					
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = dealt_with_me_appropriately
						}
					}
				}
				
				save_event_target_as = to_be_dealt_with
			}
			
			character_event = { id = soh.5260 } # Deal with the target
		}
	}
}

# Liege gets to deal with eunuchs/courtiers one after the other
character_event = {
	id = soh.5260
	desc = EVTDESC_SOH_5260
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		event_target:to_be_dealt_with = {
			opinion = {
				who = ROOT
				modifier = dealt_with_me_appropriately
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5260 # Death really is too good for you...
		
		event_target:to_be_dealt_with = { save_event_target_as = kinslayer_target }
		
		add_kinslayer_trait_effect = yes
		
		event_target:to_be_dealt_with = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = cruel
			}
			
			mult_modifier = {
				factor = 10
				trait = wroth
			}
			
			mult_modifier = {
				factor = 100
				is_rival = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 0.01
				dynasty = event_target:to_be_dealt_with
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_5260 # You will be imprisoned!
		
		event_target:to_be_dealt_with = {
			imprison = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 10
				trait = ambitious
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_5260 # You obviously go free!
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = kind
			}
			
			mult_modifier = {
				factor = 10
				trait = trusting
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:to_be_dealt_with
			}
			
			mult_modifier = {
				factor = 10
				is_lover = event_target:to_be_dealt_with
			}
		}
	}
	
	after = {
		character_event = { id = soh.5259 } # Deal with the next target
	}
}



##### Misc 

# Inform all vassals that the GC/powerful vassal is at the capital
narrative_event = {
	id = soh.5261
	title = EVTTITLE_SOH_5261
	desc = EVTDESC_SOH_5261
	picture = GFX_evt_china_civil_war
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5261 # Interesting times...
	}
}

# Inform supporters of what happened if there was a betrayal in favor of the eunuchs/courtiers
narrative_event = {
	id = soh.5262
	title = EVTTITLE_SOH_5262
	desc = EVTDESC_SOH_5262
	picture = GFX_evt_china_civil_war
	window = EventWindowOffmap
	background = GFX_event_window_news_from_china
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				event_target:leads_the_fight = {
					is_rival = ROOT
				}
			}
			
			event_target:leads_the_fight = {
				save_event_target_as = killing_me
			}
		}
		
		else = {
			top_liege = {
				random_list = {
					50 = {
						trigger = {
							primary_title = {
								NOT = {
									has_law = eunuch_law_4
								}
							}
						}
						
						random_voter = {
							limit = {
								is_council_eunuch_trigger = yes
								is_incapable = no
							}
							
							preferred_limit = {
								is_rival = ROOT
							}
							
							preferred_limit = {
								NOR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							save_event_target_as = killing_me
						}
					}
					
					50 = {
						trigger = {
							primary_title = {
								NOT = {
									has_law = ci_courtier_law_4
								}
							}
						}
						
						random_courtier = {
							limit = {
								is_adult = yes
								prisoner = no
								is_council_eunuch_trigger = no
								is_incapable = no
								
								NAND = {
									dynasty = ROOT
									any_close_relative = {
										character = ROOT
									}
								}
								
								OR = {
									is_voter = yes
									any_spouse = {
										character = ROOT
									}
									any_consort = {
										character = ROOT
									}
									any_child = {
										character = ROOT
									}
									any_child_even_if_dead = {
										any_child = {
											character = ROOT
										}
									}
								}
							}
							
							preferred_limit = {
								is_rival = ROOT
							}
							
							preferred_limit = {
								NOR = {
									is_friend = ROOT
									is_lover = ROOT
								}
							}
							
							save_event_target_as = killing_me
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5262 # Not like this!
		
		event_target:killing_me = {
			ROOT = { save_event_target_as = kinslayer_target }
			add_kinslayer_trait_effect = yes
		}
		
		death = {
			death_reason = death_execution
			killer = event_target:killing_me
		}
	}
}

# Inform supporting vassals of failed betrayal
character_event = {
	id = soh.5263
	desc = EVTDESC_SOH_5263
	picture = GFX_evt_china_civil_war
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5263 # They are not to be underestimated...
	}
}

### on_death of liege: End of intervention - forces loyal to vassal withdraw

# Liege died - hidden event for liege
character_event = {
	id = soh.5264
	hide_window = yes
	
	is_triggered_only = yes # on_death
	
	trigger = {
		real_tier = emperor
		
		OR = {
			government = chinese_imperial_government
			government = eastern_imperial_government
		}
		
		has_character_modifier = ci_nuclear_option_in_effect
	}
	
	immediate = {
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help_vassal_assisting
				}
			}
			
			save_event_target_as = vassal_assisting
			
			character_event = { id = soh.5265 days = 1 } # Inform the primary vassal
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5266 days = 1 } # Inform those assisting
		}
		
		any_realm_lord = {
			limit = {
				ai = no
				
				NOR = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_ci_nuclear_option_help
					}
					
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5267 days = 1 } # Inform others
		}
	}
}

# Liege died - vassal intervening
character_event = {
	id = soh.5265
	desc = EVTDESC_SOH_5265
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5265 # Maybe I should try again later...
		
		prestige = -500
	}
}

# Liege died - other vassals intervening
character_event = {
	id = soh.5266
	desc = EVTDESC_SOH_5266
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5266 # Maybe we should try again later...
		
		prestige = -100
	}
}

# Liege died - other vassals
character_event = {
	id = soh.5267
	desc = EVTDESC_SOH_5267
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5267 # I guess that's that...
	}
}

### on_new_holder_usurpation for liege - forces loyal to vassal withdraw

# Usurpation - new liege
character_event = {
	id = soh.5268
	desc = EVTDESC_SOH_5268
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes # on_new_holder_usurpatio
	
	trigger = {
		real_tier = emperor
		
		FROM = {
			tier = emperor
		}
		
		FROMFROM = {
			has_character_modifier = ci_nuclear_option_in_effect
			
			NOT = {
				real_tier = emperor
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5268 # Peace in our time!
		
		FROMFROM = {
			remove_character_modifier = ci_nuclear_option_in_effect
		}
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = FROMFROM
					modifier = opinion_ci_nuclear_option_help_vassal_assisting
				}
			}
			
			save_event_target_as = vassal_assisting
			
			character_event = { id = soh.5269 days = 1 } # Inform the primary vassal
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = FROMFROM
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5270 days = 1 } # Inform those assisting
		}
		
		any_realm_lord = {
			limit = {
				ai = no
				
				NOR = {
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help
					}
					
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5271 days = 1 } # Inform others
		}
	}
}

# Usurpation - primary vassal intervening
character_event = {
	id = soh.5269
	desc = EVTDESC_SOH_5269
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5269 # Maybe I should try again later...
		
		prestige = -500
	}
}

# Usurpation - intervening vassals
character_event = {
	id = soh.5270
	desc = EVTDESC_SOH_5270
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5270 # Maybe we should try again later...
		
		prestige = -100
	}
}

# Usurpation - other vassals
character_event = {
	id = soh.5271
	desc = EVTDESC_SOH_5271
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5271 # Peace in our time!
	}
}

### on_new_holder_inheritance for liege - forces loyal to vassal withdraw

# Inheritance - new liege
character_event = {
	id = soh.5272
	desc = EVTDESC_SOH_5272
	picture = GFX_evt_china_golden_age
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes # on_new_holder_inheritance
	
	trigger = {
		real_tier = emperor
		
		FROM = {
			tier = emperor
		}
		
		FROMFROM = {
			has_character_modifier = ci_nuclear_option_in_effect
			
			is_dying = no
			
			NOT = {
				real_tier = emperor
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_5272 # Peace in our time!
		
		FROMFROM = {
			remove_character_modifier = ci_nuclear_option_in_effect
		}
		
		any_vassal = {
			limit = {
				reverse_has_opinion_modifier = {
					who = FROMFROM
					modifier = opinion_ci_nuclear_option_help_vassal_assisting
				}
			}
			
			save_event_target_as = vassal_assisting
			
			character_event = { id = soh.5273 days = 1 } # Inform the primary vassal
		}
		
		any_realm_lord = {
			limit = {
				reverse_has_opinion_modifier = {
					who = FROMFROM
					modifier = opinion_ci_nuclear_option_help
				}
				
				NOT = {
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5274 days = 1 } # Inform those assisting
		}
		
		any_realm_lord = {
			limit = {
				ai = no
				
				NOR = {
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help
					}
					
					reverse_has_opinion_modifier = {
						who = FROMFROM
						modifier = opinion_ci_nuclear_option_help_vassal_assisting
					}
				}
			}
			
			character_event = { id = soh.5275 days = 1 } # Inform others
		}
	}
}

# Inheritance - primary vassal intervening
character_event = {
	id = soh.5273
	desc = EVTDESC_SOH_5273
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5273 # Maybe I should try again later...
		
		prestige = -500
	}
}

# Inheritance - intervening vassals
character_event = {
	id = soh.5274
	desc = EVTDESC_SOH_5274
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5274 # Maybe we should try again later...
		
		prestige = -100
	}
}

# Inheritance - other vassals
character_event = {
	id = soh.5275
	desc = EVTDESC_SOH_5275
	picture = GFX_evt_chinese_bureaucrat
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_5275 # Peace in our time!
	}
}