# Kitsune events
# by Silverswee(e)per

namespace = soh

# IDs 4301-4400 reserved

##### Kitsune events

### Start + side events for "fakes" + event selection

# Approached by a beautiful woman at night - do you let her stay at your court?
character_event = {
	id = soh.4301
	desc = EVTDESC_SOH_4301
	picture = GFX_evt_sleeping_town_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	only_playable = yes
	
	min_age = 16
	prisoner = no
	
	trigger = {
		# We are in Japan, are from the correct subset of the Japonic culture group, or are Shinto, Shugendo, or Koshin
		OR = {
			any_realm_province = {
				region = world_japan # Initial de jure
				region = world_ryukyu # Ryukyu
			}
			culture = yamato
			culture = japanese
			culture = wako
			has_japanese_religion_trigger = yes
		}
		
		is_inaccessible_or_incapable_trigger = no
		
		# Would be attracted to her
		OR = {
			AND = {
				is_female = no
				NOT = {
					trait = homosexual
				}
			}
			
			AND = {
				is_female = yes
				trait = homosexual
			}
		}
		
		NOT = {
			has_character_flag = got_kitsune_event
		}
	}
	
	immediate = {
		set_character_flag = got_kitsune_event
		
		if = {
			limit = {
				OR = {
					culture = yamato
					culture = japanese
					culture = wako
				}
			}
			
			create_character = {
				age = 16
				female = yes
				dynasty = none
				culture = ROOT
				religion = shinto
				health = 6
				fertility = 0.8
				
				attributes = {
					diplomacy = 6
					martial = 2
					stewardship = 1
					intrigue = 6 # Elusive shadow + Shinto add a lot...
					learning = 3
				}
				
				trait = elusive_shadow
				trait = attractive
				trait = lustful
				trait = deceitful
				trait = shrewd
				trait = gregarious
				random_traits = no
			}
		}
		
		else = {
			create_character = {
				age = 16
				female = yes
				dynasty = none
				culture = japanese
				religion = shinto
				health = 6
				fertility = 0.8
				
				attributes = {
					diplomacy = 6
					martial = 2
					stewardship = 1
					intrigue = 6 # Elusive shadow + Shinto add a lot...
					learning = 3
				}
				
				trait = elusive_shadow
				trait = attractive
				trait = lustful
				trait = deceitful
				trait = shrewd
				trait = gregarious
				random_traits = no
			}
		}
		new_character = {
			save_event_target_as = new_kitsune_or_not
			set_immune_to_pruning = yes
			set_character_flag = ai_flag_refuse_concubinage
			set_character_flag = ai_flag_refuse_marriage
			set_character_flag = ai_flag_refuse_conversion
			set_character_flag = no_court_invites
			
			# Initial setup of character type
			random_list = {
				1 = {
					trigger = {
						NOR = {
							has_game_rule = {
								name = supernatural_events
								value = off
							}
							AND = {
								has_game_rule = {
									name = supernatural_events
									value = on
								}
								ai = yes
							}
						}
					}
					
					set_character_flag = kitsune_actual_kitsune
					
					random_list = {
						1 = {
							set_character_flag = kitsune_one_tail
							change_diplomacy = 1
							change_intrigue = 1
						}
						
						1 = {
							set_character_flag = kitsune_five_tails
							change_diplomacy = 5
							change_intrigue = 5
						}
						
						1 = {
							set_character_flag = kitsune_seven_tails
							change_diplomacy = 7
							change_intrigue = 7
						}
						
						1 = {
							set_character_flag = kitsune_nine_tails
							give_nickname = nick_of_the_nine_tails
							change_diplomacy = 9
							change_intrigue = 9
						}
					}
					
					add_trait = kitsune
					
					random_list = {
						1 = {
							add_trait = master_seductress
						}
						
						1 = {
							add_trait = master_schemer
						}
						
						1 = {
							add_trait = mystic
						}
						
						1 = {
							add_trait = socializer
						}
						
						1 = {
							add_trait = hedonist
						}
					}						
				}
				
				10 = {
					set_character_flag = kitsune_chastey_mcchasteface
					remove_trait = lustful
					add_trait = chaste
					
					random_list = {
						1 = {
							# Nothing
						}
						
						1 = {
							remove_trait = elusive_shadow
							add_trait = intricate_webweaver
						}
						
						1 = {
							remove_trait = elusive_shadow
							add_trait = flamboyant_schemer
						}
						
						1 = {
							remove_trait = elusive_shadow
							add_trait = amateurish_plotter
						}
					}
				}
				
				10 = {
					set_character_flag = kitsune_thief
					add_trait = greedy
				}
				
				10 = {
					set_character_flag = kitsune_yandere
					add_trait = wroth
					add_trait = lunatic
				}
				
				10 = {
					set_character_flag = kitsune_future_nun
					change_learning = 4
					change_diplomacy = -1
					change_intrigue = -2
				}
				
				10 = {
					set_character_flag = kitsune_ill_girl
					health = -3
				}
				
				10 = {
					set_character_flag = kitsune_generic_non_kitsune
				}
			}
			
			# Stat randomization
			random_list = {
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					random_list = {
						1 = {
							change_diplomacy = 2
							change_intrigue = 2
						}
						
						1 = {
							change_diplomacy = 1
							change_intrigue = 1
						}
					}
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_chastey_mcchasteface
						}
					}
					
					random_list = {
						1 = {
							change_diplomacy = -2
							change_intrigue = 2
						}
						
						1 = {
							change_diplomacy = -1
							change_intrigue = 1
						}
					}
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_thief
						}
					}
					
					random_list = {
						1 = {
							change_diplomacy = 2
							change_intrigue = -2
						}
						
						1 = {
							change_diplomacy = 1
							change_intrigue = -1
						}
					}
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_yandere
						}
					}
					
					random_list = {
						1 = {
							change_learning = 2
							change_martial = -2
						}
						
						1 = {
							change_learning = 1
							change_martial = -1
						}
					}
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					random_list = {
						1 = {
							change_learning = -2
							change_martial = 2
						}
						
						1 = {
							change_learning = -1
							change_martial = 1
						}
					}
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_ill_girl
						}
					}
					
					random_list = {
						1 = {
							health = 2
						}
						
						1 = {
							health = 1
						}
						
						1 = {
							health = -1
						}
						
						1 = {
							health = -2
						}
					}
				}
				
				1 = {
					change_stewardship = 2
				}
			}
			
			# Trait randomization
			random_list = {
				1 = {
					add_trait = lunatic
				}
				
				1 = {
					add_trait = possessed
				}
				
				1 = {
					add_trait = physician
				}
				
				1 = {
					add_trait = genius
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_ill_girl
						}
					}
					
					add_trait = strong
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = genius
					remove_trait = shrewd
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = quick
					remove_trait = shrewd
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = groomed
					remove_trait = attractive
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = hedonist
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = master_schemer
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = master_seductress
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = mystic
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_actual_kitsune
						}
					}
					
					add_trait = socializer
				}
				
				1 = {
					add_trait = poet
				}
				
				1 = {
					add_trait = temperate
				}
				
				1 = {
					add_trait = diligent
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_yandere
						}
					}
					
					add_trait = kind
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_yandere
							has_character_flag = kitsune_thief
						}
					}
					
					add_trait = humble
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = envious
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = wroth
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = proud
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = ambitious
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = arbitrary
				}
				
				1 = {
					add_trait = brave
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_yandere
							has_character_flag = kitsune_thief
						}
					}
					
					add_trait = content
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_yandere
						}
					}
					
					add_trait = craven
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_future_nun
							has_character_flag = kitsune_ill_girl
						}
					}
					
					add_trait = cruel
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = cynical
				}
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_thief
						}
					}
					
					add_trait = honest
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_thief
						}
					}
					
					add_trait = just
				}
				
				1 = {
					add_trait = paranoid
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_yandere
						}
					}
					
					add_trait = shy
				}
				
				1 = {
					trigger = {
						NOR = {
							has_character_flag = kitsune_actual_kitsune
							has_character_flag = kitsune_yandere
							has_character_flag = kitsune_thief
						}
					}
					
					add_trait = trusting
				}
				
				1 = {
					trigger = {
						NOT = {
							has_character_flag = kitsune_future_nun
						}
					}
					
					add_trait = zealous # Will convert religion...
				}
				
				1 = {
					add_trait = sympathy_pagans
				}
			}
			
			# Ensure attraction
			if = {
				limit = {
					ROOT = {
						is_female = yes
					}
				}
				add_trait = homosexual
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4301 # Of course you can stay at my court!
		
		piety = 5
		
		event_target:new_kitsune_or_not = {
			opinion = {
				who = ROOT
				modifier = kitsune_opinion
				years = 1000
			}
			
			character_event = { id = soh.4302 days = 30 random = 60 } # Time to become lovers
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4301 # Begone!
		
		piety = -5
		
		event_target:new_kitsune_or_not = {
			leave_court_and_die_effect = yes
		}
		
		ai_chance = {
			factor = 0
		}
	}
}

# Hidden event to check if she's become a wife or concubine; if so, become lovers right away if possible or skip this step otherwise
character_event = {
	id = soh.4302
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = {
					is_alive = yes
				}
			}
			
			if = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					FROM = {
						is_inaccessible_or_incapable_trigger = no
					}
				}
				
				if = {
					limit = {
						ai = yes
						is_landed = no
					}
					
					if = {
						limit = {
							is_married = no
							is_consort = no
							FROM = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
								
								# Is attracted to her
								OR = {
									AND = {
										is_female = no
										NOT = {
											trait = homosexual
										}
									}
									AND = {
										is_female = yes
										trait = homosexual
									}
								}
								NOT = {
									any_lover = {
										character = ROOT
									}
								}
							}
						}
						
						FROM = {
							character_event = { id = soh.4303 } # Pretty kitsune - become lovers?
						}
					}
					
					else_if = {
						limit = {
							OR = {
								any_spouse = {
									character = FROM
									# Is attracted to her
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
										}
									}
									NOT = {
										any_lover = {
											character = ROOT
										}
									}
								}
								
								any_consort = {
									character = FROM
									# Is attracted to her
									OR = {
										AND = {
											is_female = no
											NOT = {
												trait = homosexual
											}
										}
										AND = {
											is_female = yes
											trait = homosexual
										}
									}
									NOT = {
										any_lover = {
											character = ROOT
										}
									}
								}
							}
						}
						
						FROM = {
							character_event = { id = soh.4307 } # Become lovers
						}
					}
					
					else = {
						character_event = { id = soh.4310 } # Next event
					}
				}
			}
			
			else = {
				repeat_event = { id = soh.4302 days = 30 random = 30 }
			}
		}
	}
}

# Possible kitsune really is pretty - take her as a lover?
character_event = {
	id = soh.4303
	desc = EVTDESC_SOH_4303
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4303 # Oh, yes!
		
		piety = -10
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_chastey_mcchasteface
					NOT = {
						trait = lustful
					}
				}
			}
			
			character_event = { id = soh.4304 days = 1 } # Chaste person leaves your court
		}
		
		else_if = {
			limit = {
				FROM = {
					NOR = {
						has_character_flag = kitsune_actual_kitsune
						has_character_flag = kitsune_thief
						has_character_flag = kitsune_yandere
					}
				}
				ROOT = {
					is_unattractive_trigger = yes
				}
			}
			
			character_event = { id = soh.4304 days = 1 } # If they don't want to sleep with you for some other reason, attractiveness is a factor...
		}
		
		else = {
			hidden_tooltip = {
				FROM = {
					remove_trait = chaste
				}
			}
			
			if = {
				limit = {
					ROOT = {
						is_female = yes
					}
				}
				
				character_event = { id = soh.4305 days = 1 } # Lovers
			}
			
			else = {
				character_event = { id = soh.4306 days = 1 } # Lovers and possibly more
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = chaste
					trait = celibate
				}
			}
			
			mult_modifier = {
				factor = 0.1
				FROM = {
					is_unattractive_trigger = yes
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4303 # Nope!
		
		piety = 10
		
		remove_trait_lustful_effect = yes
		
		FROM = {
			character_event = { id = soh.4308 days = 7 random = 7 } # Kitsune/other leaves court
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				OR = {
					trait = chaste
					trait = celibate
				}
			}
		}
	}
}

# Not a kitsune - refused seduction and left
character_event = {
	id = soh.4304
	desc = EVTDESC_SOH_4304
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4304 # Really?
		
		prestige = -10
		
		FROMFROM = {
			leave_court_and_die_effect = yes
		}
	}
}

# Lovers - you are a woman and thus you can't get further options
character_event = {
	id = soh.4305
	desc = EVTDESC_SOH_4305
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.4310 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4305 # That's great!
		
		add_lover = FROMFROM
		
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		
		unprotected_sex_effect_event_target = yes
	}
}

# Lovers - become more?
character_event = {
	id = soh.4306
	desc = EVTDESC_SOH_4306
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.4310 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4306 # We'll just be lovers...
		
		add_lover = FROMFROM
		
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		
		unprotected_sex_effect_event_target = yes
	}
	
	option = {
		trigger = {
			NOT = {
				has_religion_feature = religion_matriarchal
			}
			
			OR = {
				NOR = {
					religion_group = muslim
					has_religion_feature = religion_harems
					has_religion_feature = religion_feature_zun
					has_religion_feature = religion_feature_tengri
				}
				is_tribal = yes
				is_nomadic = yes
			}
			
			OR = {
				NOT = {
					num_of_consorts = 3
				}
				NAND = {
					government = eastern_imperial_government
					num_of_consorts = 10
				}
				
				government = japanese_imperial_government # We'll assume you don't have the full 100 consorts...
				government = chinese_imperial_government # We'll assume you don't have the full 100 consorts...
				government = divine_imperial_government # We'll assume you don't have the full 100 consorts...
			}
		}
		
		name = EVTOPTB_SOH_4306 # I'l make her a concubine
		
		add_lover = FROMFROM
		
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		
		unprotected_sex_effect_event_target = yes
		
		add_consort = FROMFROM
	}
	
	option = {
		trigger = {
			NOT = {
				has_religion_feature = religion_matriarchal
			}
			
			OR = {
				AND = {
					OR = {
						religion_group = muslim
						has_religion_feature = religion_harems
						has_religion_feature = religion_feature_zun
						has_religion_feature = religion_feature_tengri
					}
					is_tribal = no
					is_nomadic = no
					NOT = {
						num_of_spouses = 4
					}
				}
				is_married = no
			}
		}
		
		name = EVTOPTB_SOH_4306 # I'l make her my wife!
		
		if = {
			limit = {
				is_betrothed = yes
			}
			break_betrothal = yes # Just to be sure...
		}
		
		add_lover = FROMFROM
		
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		
		unprotected_sex_effect_event_target = yes
		
		add_spouse = FROMFROM
	}
}

# Already your spouse/concubine - become lovers
character_event = {
	id = soh.4307
	desc = EVTDESC_SOH_4307
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROM = {
			character_event = { id = soh.4310 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4307 # This must be love!
		
		add_lover = FROM
		
		FROMFROM = {
			save_event_target_as = sex_partner
		}
		
		unprotected_sex_effect_event_target = yes
	}
}

# Ping in case kitsune has become landed/married/etc.
character_event = {
	id = soh.4308
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
				is_married = no
				is_consort = no
				NOT = {
					any_lover = {
						character = FROM
					}
				}
			}
			
			FROM = {
				character_event = { id = soh.4309 } # Kitsune/other leaves court
			}
		}
	}
}

# Kitsune/other leaves court if not in some kind of intimate relationship
character_event = {
	id = soh.4309
	desc = EVTDESC_SOH_4309
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4309 # I see...
		
		FROM = {
			leave_court_and_die_effect = yes
		}
	}
}

# See if the advice event needs to be fired
character_event = {
	id = soh.4310
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					
					random_list = {
						1 = {
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								
								character_event = { id = soh.4311 } # Advice
							}
						}
						
						1 = {
							trigger = {
								NOT = {
									has_character_flag = kitsune_thief
								}
							}
							
							character_event = { id = soh.4315 } # Next event
						}
					}
				}
				
				else = {
					repeat_event = { id = soh.4310 days = 30 random = 30 }
				}
			}
		}
	}
}

# Possible kitsune really is smart - take her advice into consideration?
character_event = {
	id = soh.4311
	desc = EVTDESC_SOH_4311
	picture = GFX_evt_throne_room
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4311 # That seems like a good idea!
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_thief
				}
			}
			
			character_event = { id = soh.4312 days = 7 random = 7 } # Thief steals money and leaves
		}
		
		else = {
			character_event = { id = soh.4313 days = 7 random = 7 } # Random thief caugt
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4311 # I don't think so!
		
		if = {
			limit = {
				FROM = {
					has_character_flag = kitsune_thief
					is_married = no
					is_consort = no
				}
			}
			
			character_event = { id = soh.4314 days = 1 } # Would-be thief leaves
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = trusting
				}
			}
		}
	}
}

# Not a kitsune - thief
character_event = {
	id = soh.4312
	desc = EVTDESC_SOH_4312
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4312 # It was a setup!
		
		prestige = -25
		
		transfer_scaled_wealth = {
			from = ROOT
			to = FROMFROM
			value = 1
			min = 25
			max = 1000
		}
		
		FROMFROM = {
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
			
			leave_court_effect = yes
			
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
			
			add_rival = ROOT
			
			reverse_opinion = {
				who = ROOT
				modifier = opinion_thief
			}
		}
	}
}

# Advice was good - random thief caught
character_event = {
	id = soh.4313
	desc = EVTDESC_SOH_4313
	picture = GFX_evt_catching_heretic
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		FROMFROM = {
			character_event = { id = soh.4315 days = 30 random = 60 } # Next event
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4313 # Her advice was good!
		
		prestige = 10
		
		FROMFROM = {
			prestige = 25
		}
	}
}

# Did not take advice into consideration - would-be thief leaves court and ends relationship if not married or a consort
character_event = {
	id = soh.4314
	desc = EVTDESC_SOH_4314
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4314 # Really?
		
		prestige = -10
		
		FROMFROM = {
			if = {
				limit = {
					any_lover = {
						character = ROOT
					}
				}
				remove_lover = ROOT
			}
			
			leave_court_effect = yes
			
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
	}
}

# Ping to see if there's a possible yandere target; if not, skip to the next step
character_event = {
	id = soh.4315
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					
					random_list = {
						1 = {
							trigger = {
								has_character_flag = kitsune_yandere
								
								any_opinion_modifier_target = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
									
									NOR = {
										any_spouse = {
											NOT = {
												character = ROOT
											}
										}
										any_consort = {
											NOT = {
												character = ROOT
											}
										}
										any_lover = {
											NOT = {
												character = ROOT
											}
										}
									}
								}
							}
							
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								
								save_event_target_as = yandere_obsession
								
								character_event = { id = soh.4316 } # Yandere does her thing
								
								any_spouse = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									
									character_event = { id = soh.4317 } # Yandere does her thing
								}
								
								any_consort = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									
									character_event = { id = soh.4317 } # Yandere does her thing
								}
								
								any_lover = {
									limit = {
										NOT = {
											character = ROOT
										}
									}
									
									character_event = { id = soh.4317 } # Yandere does her thing
								}
							}
						}
						
						1 = {
							trigger = {
								NOT = {
									has_character_flag = kitsune_yandere
								}
								
								any_opinion_modifier_target = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
									
									OR = {
										any_spouse = {
											NOT = {
												character = ROOT
											}
										}
										any_consort = {
											NOT = {
												character = ROOT
											}
										}
										any_lover = {
											NOT = {
												character = ROOT
											}
										}
									}
								}
							}
							
							any_opinion_modifier_target = {
								limit = {
									reverse_has_opinion_modifier = {
										who = ROOT
										modifier = kitsune_opinion
									}
								}
								
								character_event = { id = soh.4318 } # Rivalry
							}
						}
						
						1 = {
							trigger = {
								NOT = {
									has_character_flag = kitsune_yandere
								}
							}
							
							character_event = { id = soh.4320 } # Next event
						}
						
						1 = {
							trigger = {
								has_character_flag = kitsune_yandere
							}
							
							repeat_event = { id = soh.4315 days = 365 random = 365 } # Keep on yandere-ing!
						}
					}
				}
				
				else = {
					repeat_event = { id = soh.4315 days = 30 random = 30 }
				}
			}
		}
	}
}

# Not a kitsune - yandere
character_event = {
	id = soh.4316
	desc = EVTDESC_SOH_4316
	picture = GFX_evt_staked_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4316 # Off with her head!
		
		remove_lover = FROM
		
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.01
				trait = kind
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4316 # Throw her in a cell!
		
		remove_lover = FROM
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = arbitrary
			}
			
			mult_modifier = {
				factor = 0.01
				trait = cruel
			}
		}
	}
	
	option = {
		trigger = {
			FROM = {
				is_valid_romance_target = ROOT
				ROOT = {
					is_valid_romance_target = PREV
				}
			}
		}
		
		name = EVTOPTC_SOH_4316 # She's the only one for me!
	
		FROM = {
			if = {
				limit = {
					NOT = {
						any_lover = {
							character = ROOT
						}
					}
				}
				add_lover = ROOT
			}
			
			ROOT = {
				save_event_target_as = sex_partner
			}
			
			unprotected_sex_effect_event_target = yes
			
			character_event = { id = soh.4315 days = 365 random = 365 } # Yandere must keep on yandere-ing!
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = just
				}
			}
		}
	}
}

# Inform anyone killed by yandere
character_event = {
	id = soh.4317
	desc = EVTDESC_SOH_4317
	picture = GFX_evt_staked_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4317 # No! Get away from me!
		
		hidden_tooltip = {
			save_event_target_as = target_victim
			FROM = { character_event = { id = 10 } } # Consequences of discovery
			clear_event_target = target_victim
		}
		
		death = {
			death_reason = death_murder
			killer = FROM
		}
	}
}

# Rivalry with your spouse/concubine/lover
character_event = {
	id = soh.4318
	desc = EVTDESC_SOH_4318
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			1 = {
				trigger = {
					any_spouse = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
				}
				
				random_spouse = {
					limit = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
					
					save_event_target_as = kitsune_rival
					
					character_event = { id = soh.4319 }
				}
			}
			
			1 = {
				trigger = {
					any_consort = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
				}
				
				random_consort = {
					limit = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
					
					save_event_target_as = kitsune_rival
					
					character_event = { id = soh.4319 }
				}
			}
			
			1 = {
				trigger = {
					any_lover = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
				}
				
				random_lover = {
					limit = {
						NOR = {
							character = FROM
							is_rival = FROM
						}
					}
					
					save_event_target_as = kitsune_rival
					
					character_event = { id = soh.4319 }
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4318 # I see...
	}
}

# Inform rival
character_event = {
	id = soh.4319
	desc = EVTDESC_SOH_4319
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4319 # I hate you too!
		
		add_rival = FROMFROM
	}
}

# Ping to see if Buddhist nun or ill girl option is on the table
character_event = {
	id = soh.4320
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
			}
			
			if = {
				limit = {
					any_opinion_modifier_target = {
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = kitsune_opinion
						}
						is_alive = yes
					}
				}
				
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						any_opinion_modifier_target = {
							reverse_has_opinion_modifier = {
								who = ROOT
								modifier = kitsune_opinion
							}
							is_inaccessible_or_incapable_trigger = no
						}
					}
					
					if = {
						limit = {
							has_character_flag = kitsune_future_nun
							NAND = {
								NOT = {
									true_religion = buddhist
								}
								trait = zealous
							}
						}
						
						any_opinion_modifier_target = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
							}
							
							character_event = { id = soh.4321 } # Ask to become a nun
						}
					}
					
					else_if = {
						limit = {
							has_character_flag = kitsune_ill_girl
						}
						
						any_opinion_modifier_target = {
							limit = {
								reverse_has_opinion_modifier = {
									who = ROOT
									modifier = kitsune_opinion
								}
							}
							character_event = { id = soh.4324 } # Ill girl is ill
						}
					}
					
					else = {
						character_event = { id = soh.4326 }
					}
				}
				
				else = {
					repeat_event = { id = soh.4320 days = 30 random = 30 }
				}
			}
		}
	}
}

# Not a kitsune - asks to become a Buddhist nun
character_event = {
	id = soh.4321
	desc = EVTDESC_SOH_4321
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4321 # If that is your wish...
		
		if = {
			limit = {
				any_lover = {
					character = FROM
				}
			}
			
			remove_lover = FROM
		}
		
		FROM = {
			if = {
				limit = {
					is_married = yes
				}
				any_spouse = {
					remove_spouse = FROM
				}
			}
			
			else_if = {
				limit = {
					is_consort = yes
				}
				any_consort = {
					remove_consort = FROM
				}
			}
			
			else_if = {
				limit = {
					is_betrothed = yes
				}
				break_betrothal = yes
			}
			
			religion = buddhist
			
			add_trait = bhikkhuni
			
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					trait = zealous
					NOT = {
						true_religion = buddhist
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4321 # I forbid it!
		
		if = {
			limit = {
				religion = buddhist
			}
			piety = -100
		}
		
		if = {
			limit = {
				FROM = {
					OR = {
						is_married = yes
						is_consort = yes
					}
				}
			}
			
			character_event = { id = soh.4322 days = 7 random = 7 } # Stops being your lover
		}
		
		else = {
			character_event = { id = soh.4323 days = 1 } # Leaves
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NAND = {
					true_religion = buddhist
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 0.1
				true_religion = buddhist
			}
		}
	}
}

# Refused to let her become a nun - stop being lovers
character_event = {
	id = soh.4322
	desc = EVTDESC_SOH_4322
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4322 # I see...
		
		remove_lover = FROMFROM
	}
}

# Refused to let her become a nun - would-be nun leaves court and ends relationship if not married or a consort
character_event = {
	id = soh.4323
	desc = EVTDESC_SOH_4323
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4323 # I see...
		
		remove_lover = FROMFROM
		
		FROMFROM = {
			religion = buddhist
			add_trait = bhikkhuni
			
			leave_court_effect = yes
			
			clr_character_flag = ai_flag_refuse_concubinage
			clr_character_flag = ai_flag_refuse_marriage
			clr_character_flag = ai_flag_refuse_conversion
			clr_character_flag = no_court_invites
			
			remove_opinion = {
				who = ROOT
				modifier = kitsune_opinion
			}
		}
	}
}

# Not a kitsune - ill girl is ill
character_event = {
	id = soh.4324
	desc = EVTDESC_SOH_4324
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4324 # Poor thing!
		
		FROM = {
			if = {
				limit = {
					has_dlc = "Reapers"
				}
				random_list = {
					1 = {
						give_pneumonic_effect = yes
					}
					1 = {
						give_flu_effect = yes
					}
					1 = {
						give_food_poisoning_effect = yes
					}
				}
			}
			
			else = {
				give_ill_effect = yes
			}
		}
		
		FROM = {
			character_event = { id = soh.4325 days = 365 random = 730 }
		}
	}
}

# Hidden event for ill girl to become ill again
character_event = {
	id = soh.4325
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				is_landed = no
				is_ill = no
			}
			
			if = {
				limit = {
					FROM = {
						is_alive = yes
					}
				}
				
				if = {
					limit = {
						is_inaccessible_or_incapable_trigger = no
						FROM = {
							is_inaccessible_or_incapable_trigger = no
						}
					}
					
					FROM = {
						character_event = { id = soh.4324 } # Ill girl is ill
					}
				}
				
				else = {
					repeat_event = { id = soh.4325 days = 180 random = 180 }
				}
			}
		}
	}
}

# Let's see if we've actually got a kitsune and go to event selection if so
character_event = {
	id = soh.4326
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				has_any_opinion_modifier = kitsune_opinion
				has_character_flag = kitsune_actual_kitsune
			}
			
			any_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = kitsune_opinion
					}
				}
				
				save_event_target_as = kitsune_target
			}
			
			save_persistent_event_target = {
				name = kitsune_target
				scope = event_target:kitsune_target
			}
			
			set_character_flag = kitsune_looping_event
		}
	}
}

### Actual kitsune events

# Kitsune event selection
character_event = {
	id = soh.4327
	hide_window = yes
	
	is_triggered_only = yes # on_bi_yearly_pulse -> random_events -> kitsune_events
	
	only_women = yes
	min_age = 16
	has_character_flag = kitsune_looping_event
	
	trigger = {
		trait = kitsune
		is_actually_incapable_trigger = no
	}
	
	immediate = {
		random_list = {
			1 = {
				trigger = {
					NOT = {
						has_character_flag = kitsune_nine_tails
					}
				}
				
				mult_modifier = {
					factor = 0.1
					has_character_flag = kitsune_eight_tails
				}
				
				mult_modifier = {
					factor = 0.2
					has_character_flag = kitsune_seven_tails
				}
				
				mult_modifier = {
					factor = 0.3
					has_character_flag = kitsune_six_tails
				}
				
				mult_modifier = {
					factor = 0.4
					has_character_flag = kitsune_five_tails
				}
				
				mult_modifier = {
					factor = 0.5
					has_character_flag = kitsune_four_tails
				}
				
				mult_modifier = {
					factor = 0.7
					has_character_flag = kitsune_three_tails
				}
				
				mult_modifier = {
					factor = 0.8
					has_character_flag = kitsune_two_tails
				}
				
				character_event = { id = soh.4328 } # Kitsune gets another tail
			}
			10 = {
				trigger = {
					NAND = {
						trait = elusive_shadow
						trait = attractive
						NOT = {
							trait = celibate
						}
						trait = lustful
						trait = deceitful
						trait = shrewd
						trait = gregarious
					}
				}
				
				character_event = { id = soh.4329 } # Kitsune's traits change back
			}
			
			10 = {
				trigger = {
					any_lover = {
						ROOT = {
							persistent_event_target:kitsune_target = {
								NOT = {
									character = PREVPREV
								}
							}
						}
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4330 } # Kitsune discards irrlevant lovers
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_rival = ROOT
					}
				}
				
				character_event = { id = soh.4332 } # Kitsune stops being a rival of her target
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_inaccessible_or_incapable_trigger = no
						NOT = {
							any_lover = {
								character = ROOT
							}
						}
						
						OR = {
							NOT = {
								trait = homosexual
							}
							is_female = yes
						}
						
						ROOT = {
							OR = {
								NOT = {
									trait = homosexual
								}
								persistent_event_target:kitsune_target = {
									is_female = yes
								}
							}
						}
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4334 } # Kitsune and target fall in love again
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						OR = {
							any_spouse = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
							any_consort = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
							any_lover = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4336 } # Kitsune removes "obstacles"
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_inaccessible_or_incapable_trigger = no
						is_landed = yes
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4339 } # Kitsune impresses courtier
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_inaccessible_or_incapable_trigger = no
						is_landed = yes
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
					
					is_landed = no
				}
				
				character_event = { id = soh.4342 } # Kitsune slips up
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_inaccessible_or_incapable_trigger = no
						is_landed = yes
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
					
					age >= 40
					
					is_landed = no
				}
				
				mult_modifier = {
					factor = 10
					age >= 80
				}
				
				persistent_event_target:kitsune_target = {
					character_event = { id = soh.4355 } # Kitsune looks far too young
				}
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_alive = yes
						is_inaccessible_or_incapable_trigger = no
					}
				}
				
				character_event = { id = soh.4362 } # Kitsune makes target ill
			}
			
			10 = {
				trigger = {
					any_child = {
						is_inaccessible_or_incapable_trigger = yes
						is_alive = yes
						is_adult = no
						NOT = {
							has_character_flag = kitsune_lesson
						}
					}
				}
				
				character_event = { id = soh.4364 } # Kitsune gives her child a lesson
			}
			
			10 = {
				character_event = { id = soh.4366 } # Kitsune is visited by foxes
			}
			
			10 = {
				character_event = { id = soh.4368 } # Kitsune visits someone's dreams
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_alive = yes
						is_inaccessible_or_incapable_trigger = no
					}
					
					NOT = {
						trait = celibate
					}
				}
				
				character_event = { id = soh.4370 } # Kitsune feeds on sex
			}
			
			10 = {
				trigger = {
					top_liege = {
						any_realm_lord = {
							is_theocracy = yes
							NOT = {
								is_rival = ROOT
							}
						}
					}
				}
				
				character_event = { id = soh.4372 } # Kitsune disliks priest
			}
			
			10 = {
				trigger = {
					top_liege = {
						any_realm_lord = {
							is_theocracy = yes
							is_rival = ROOT
						}
					}
				}
				
				character_event = { id = soh.4374 } # Kitsune kills priest
			}
			
			100 = {
				trigger = {
					prisoner = yes
				}
				
				character_event = { id = soh.4376 } # Kitsune escapes prison
			}
			
			100 = {}
		}
	}
}

# Kitsune gets another tail
character_event = {
	id = soh.4328
	desc = EVTDESC_SOH_4328
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4328 # My power grows!
		
		trigger_switch = {
			on_trigger = has_character_flag
			
			kitsune_eight_tails = {
				clr_character_flag = kitsune_eight_tails
				set_character_flag = kitsune_nine_tails
				if = {
					limit = {
						this_has_super_cool_nickname_trigger = no
					}
					give_nickname = nick_of_the_nine_tails
				}
			}
			
			kitsune_seven_tails = {
				clr_character_flag = kitsune_seven_tails
				set_character_flag = kitsune_eight_tails
			}
			
			kitsune_six_tails = {
				clr_character_flag = kitsune_six_tails
				set_character_flag = kitsune_seven_tails
			}
			
			kitsune_five_tails = {
				clr_character_flag = kitsune_five_tails
				set_character_flag = kitsune_six_tails
			}
			
			kitsune_four_tails = {
				clr_character_flag = kitsune_four_tails
				set_character_flag = kitsune_five_tails
			}
			
			kitsune_three_tails = {
				clr_character_flag = kitsune_three_tails
				set_character_flag = kitsune_four_tails
			}
			
			kitsune_two_tails = {
				clr_character_flag = kitsune_two_tails
				set_character_flag = kitsune_three_tails
			}
			
			kitsune_one_tail = {
				clr_character_flag = kitsune_one_tail
				set_character_flag = kitsune_two_tails
			}
		}
		
		change_diplomacy = 1
		change_intrigue = 1
	}
}

# Kitsune becomes more kitsune-like if her traits have changed too much
character_event = {
	id = soh.4329
	desc = EVTDESC_SOH_4329
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4329 # My true nature cannot remain hidden!
		
		if = {
			limit = {
				NOT = {
					trait = elusive_shadow
				}
			}
			remove_all_education_traits_effect = yes
			add_trait = elusive_shadow
		}
		
		remove_all_negative_congenital_traits_effect = yes
		
		if = {
			limit = {
				NOT = {
					trait = attractive
				}
			}
			add_trait = attractive
		}
		
		if = {
			limit = {
				trait = celibate
			}
			remove_trait = celibate
		}
		
		if = {
			limit = {
				has_character_modifier = mourning_celibate
			}
			remove_character_modifier = mourning_celibate
		}
		
		if = {
			limit = {
				NOT = {
					trait = lustful
				}
			}
			
			add_trait_fully_lustful_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = deceitful
				}
			}
			
			add_trait_fully_deceitful_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = shrewd
				}
			}
			
			add_trait_shrewd_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = gregarious
				}
			}
			
			add_trait_fully_gregarious_effect = yes
		}
	}
}

# Kitsune discards lovers that aren't her target
character_event = {
	id = soh.4330
	desc = EVTDESC_SOH_4330
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4330 # I need to remain focused!
		
		any_lover = {
			limit = {
				NOT = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = kitsune_opinion
					}
				}
			}
			
			remove_lover = ROOT
			
			character_event = { id = soh.4331 }
		}
	}
}

# Lovers notified
character_event = {
	id = soh.4331
	desc = EVTDESC_SOH_4331
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4331 # I see...
		
		remove_lover = FROM
	}
}

# If a rival with your target, lose that
character_event = {
	id = soh.4332
	desc = EVTDESC_SOH_4332
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4332 # I need to remain focused!
		
		any_rival = {
			limit = {
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = kitsune_opinion
				}
			}
			
			remove_rival = ROOT
			
			character_event = { id = soh.4333 }
		}
	}
}

# Target notified
character_event = {
	id = soh.4333
	desc = EVTDESC_SOH_4333
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4333 # It was just a misunderstanding!
		
		remove_rival = FROM
	}
}

# If possible, become lovers with your target again
character_event = {
	id = soh.4334
	desc = EVTDESC_SOH_4334
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4334 # I need to remain focused!
		
		persistent_event_target:kitsune_target = {
			add_lover = ROOT
			
			character_event = { id = soh.4335 }
		}
	}
}

# Target notified
character_event = {
	id = soh.4335
	desc = EVTDESC_SOH_4335
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4335 # It was just a misunderstanding!
		
		add_lover = FROM
	}
}

# Kitsune might arrange for an accident for a spouse/concubine/lover of their target
character_event = {
	id = soh.4336
	desc = EVTDESC_SOH_4336
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		persistent_event_target:kitsune_target = {
			random_list = {
				1 = {
					trigger = {
						any_spouse = {
							NOT = {
								character = ROOT
							}
						}
					}
					
					random_spouse = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
				
				1 = {
					trigger = {
						any_consort = {
							NOT = {
								character = ROOT
							}
						}
					}
					
					random_consort = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
				1 = {
					trigger = {
						any_lover = {
							NOT = {
								character = ROOT
							}
						}
					}
					
					random_lover = {
						limit = {
							NOT = {
								character = ROOT
							}
						}
						save_event_target_as = kitsune_rival
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4336 # Yes!
		
		event_target:kitsune_rival = {
			character_event = { id = soh.4337 } # Inform victim
		}
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4338 } # Inform target
		}
		
		ai_chance = {
			factor = 1
			
			trigger = {
				NOT = {
					event_target:kitsune_rival = {
						OR = {
							is_friend = ROOT
							is_lover = ROOT
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4336 # No!
		
		ai_chance = {
			factor = 1
			
			trigger = {
				event_target:kitsune_rival = {
					OR = {
						is_friend = ROOT
						is_lover = ROOT
					}
				}
			}
		}
	}
}

# Victim dies
character_event = {
	id = soh.4337
	desc = EVTDESC_SOH_4337
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4337 # You? No!
		
		death = {
			death_reason = death_murder_unknown
			killer = FROM
		}
	}
}

# Target notified
character_event = {
	id = soh.4338
	desc = EVTDESC_SOH_4338
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4338 # Who could have done this...?
	}
}

# Kitsune impresses courtier
character_event = {
	id = soh.4339
	desc = EVTDESC_SOH_4339
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		persistent_event_target:kitsune_target = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
				}
				
				save_event_target_as = kitsune_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4339 # Great!
		
		prestige = 25
		
		event_target:kitsune_courtier = {
			character_event = { id = soh.4340 }
		}
	}
}

# Courtier notified
character_event = {
	id = soh.4340
	desc = EVTDESC_SOH_4340
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4340 # She sure is well-spoken!
		
		FROM = {
			persistent_event_target:kitsune_target = {
				character_event = { id = soh.4341 }
			}
		}
	}
}

# Target notified
character_event = {
	id = soh.4341
	desc = EVTDESC_SOH_4341
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4341 # That's good to hear!
	}
}

# Kitsune makes courtier suspicious
character_event = {
	id = soh.4342
	desc = EVTDESC_SOH_4342
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		persistent_event_target:kitsune_target = {
			random_courtier_or_vassal = {
				limit = {
					is_inaccessible_or_incapable_trigger = no
					NOR = {
						is_married = ROOT
						any_consort = {
							character = ROOT
						}
						is_lover = ROOT
					}
				}
				
				preferred_limit = {
					intrigue >= 20
				}
				
				preferred_limit = {
					trait = mystic
				}
				
				preferred_limit = {
					is_smart_trigger = yes
				}
				
				save_event_target_as = kitsune_courtier
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4342 # I was perhaps a bit careless...
		
		prestige = -10
		
		event_target:kitsune_courtier = {
			character_event = { id = soh.4343 } # Informed that kitsune is suspicious
		}
	}
}

# Kitsune is suspicious - inform target?
character_event = {
	id = soh.4343
	desc = EVTDESC_SOH_4343
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4343 # Yes!
		
		FROM = {
			persistent_event_target:kitsune_target = {
				character_event = { id = soh.4344 } # Inform target
			}
		}
		
		add_rival = FROM
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4336 # No!
	}
}

# Target notified - might ignore or confront
character_event = {
	id = soh.4344
	desc = EVTDESC_SOH_4344
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4344 # I don't believe you!
		
		FROM = {
			character_event = { id = soh.4345 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4344 # I will confront her!
		
		FROMFROM = {
			character_event = { id = soh.4346 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = trusting
				}
			}
		}
	}
}

# Inform courtier that they were ignored
character_event = {
	id = soh.4345
	desc = EVTDESC_SOH_4345
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4345 # I see...
		
		prestige = -25
	}
}

# Kitsune confronted - charm target?
character_event = {
	id = soh.4346
	desc = EVTDESC_SOH_4346
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4346 # This is no longer funny!
		
		FROM = {
			character_event = { id = soh.4347 days = 1 }
		}
		
		leave_court_and_die_effect = yes
		
		ai_chance = {
			factor = 100
			
			trigger = {
				FROM = {
					NOT = {
						trait = trusting
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4346 # Time to turn on the charm!
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 256
					has_character_flag = kitsune_nine_tails
				}
				
				mult_modifier = {
					factor = 128
					has_character_flag = kitsune_eight_tails
				}
				
				mult_modifier = {
					factor = 64
					has_character_flag = kitsune_seven_tails
				}
				
				mult_modifier = {
					factor = 32
					has_character_flag = kitsune_six_tails
				}
				
				mult_modifier = {
					factor = 16
					has_character_flag = kitsune_five_tails
				}
				
				mult_modifier = {
					factor = 8
					has_character_flag = kitsune_four_tails
				}
				
				mult_modifier = {
					factor = 4
					has_character_flag = kitsune_three_tails
				}
				
				mult_modifier = {
					factor = 2
					has_character_flag = kitsune_two_tails
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 40
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 36
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 32
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 28
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 24
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 20
				}
				
				modifier = {
					factor = 2
					intrigue >= 12
				}
				
				character_event = { id = soh.4349 days = 1 } # Target charmed
			}
			
			50 = {
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 40
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 36
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 32
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 28
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 24
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 20
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 16
					}
				}
				
				character_event = { id = soh.4352 days = 1 } # Target not charmed
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = honest
				}
			}
		}
	}
}

# Kitsune elected to flee - inform target
character_event = {
	id = soh.4347
	desc = EVTDESC_SOH_4347
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4347 # She *was* a kitsune!
		
		FROMFROMFROM = {
			character_event = { id = soh.4348 }
		}
		
		prestige = -10
	}
}

# Inform courtier that they've been vindicated
character_event = {
	id = soh.4348
	desc = EVTDESC_SOH_4348
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4348 # Told you!
		
		prestige = 25
	}
}

# Target charmed
character_event = {
	id = soh.4349
	desc = EVTDESC_SOH_4349
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4349 # Child's play!
		
		prestige = 25
		
		FROMFROM = {
			character_event = { id = soh.4350 }
		}
	}
}

# Inform target
character_event = {
	id = soh.4350
	desc = EVTDESC_SOH_4350
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4350 # She's the most trustworthiest human ever!
		
		prestige = -10
		
		FROMFROMFROMFROM = {
			character_event = { id = soh.4351 }
		}
	}
}

# Inform suspicious courtier that they've been discredited
character_event = {
	id = soh.4351
	desc = EVTDESC_SOH_4351
	picture = GFX_evt_upsetting_letter
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4351 # I see...
		
		prestige = -25
	}
}

# Target not charmed - time to flee!
character_event = {
	id = soh.4352
	desc = EVTDESC_SOH_4352
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4352 # This is no longer funny!
		
		FROMFROM = {
			character_event = { id = soh.4353 }
		}
		
		leave_court_and_die_effect = yes
	}
}

# Inform target
character_event = {
	id = soh.4353
	desc = EVTDESC_SOH_4353
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4353 # She *was* a kitsune!
		
		FROMFROMFROM = {
			character_event = { id = soh.4354 }
		}
		
		prestige = -10
	}
}

# Inform courtier that they've been vindicated
character_event = {
	id = soh.4354
	desc = EVTDESC_SOH_4354
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4354 # Told you!
		
		prestige = 25
	}
}

# Kitsune is old but doesn't look like it - confront her?
character_event = {
	id = soh.4355
	desc = EVTDESC_SOH_4355
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4355 # I'm imagining things...
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = paranoid
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4355 # I will confront her!
		
		FROM = {
			character_event = { id = soh.4356 days = 1 }
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = trusting
				}
			}
		}
	}
}

# Confronted - charm target?
character_event = {
	id = soh.4356
	desc = EVTDESC_SOH_4356
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4356 # This is no longer funny!
		
		FROM = {
			character_event = { id = soh.4357 days = 1 }
		}
		
		leave_court_and_die_effect = yes
		
		ai_chance = {
			factor = 100
			
			trigger = {
				FROM = {
					NOT = {
						trait = trusting
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_4356 # Time to turn on the charm!
		
		random_list = {
			50 = {
				mult_modifier = {
					factor = 256
					has_character_flag = kitsune_nine_tails
				}
				
				mult_modifier = {
					factor = 128
					has_character_flag = kitsune_eight_tails
				}
				
				mult_modifier = {
					factor = 64
					has_character_flag = kitsune_seven_tails
				}
				
				mult_modifier = {
					factor = 32
					has_character_flag = kitsune_six_tails
				}
				
				mult_modifier = {
					factor = 16
					has_character_flag = kitsune_five_tails
				}
				
				mult_modifier = {
					factor = 8
					has_character_flag = kitsune_four_tails
				}
				
				mult_modifier = {
					factor = 4
					has_character_flag = kitsune_three_tails
				}
				
				mult_modifier = {
					factor = 2
					has_character_flag = kitsune_two_tails
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 40
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 36
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 32
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 28
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 24
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 20
				}
				
				mult_modifier = {
					factor = 2
					intrigue >= 12
				}
				
				character_event = { id = soh.4358 days = 1 } # Target charmed
			}
			
			50 = {
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 40
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 36
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 32
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 28
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 24
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 20
					}
				}
				
				mult_modifier = {
					factor = 2
					FROM = {
						intrigue >= 16
					}
				}
				
				character_event = { id = soh.4360 days = 1 } # Target not charmed
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = honest
				}
			}
		}
	}
}

# Kitsune fled - inform target
character_event = {
	id = soh.4357
	desc = EVTDESC_SOH_4357
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4357 # She *was* a kitsune!
		
		prestige = 25
	}
}

# Target charmed
character_event = {
	id = soh.4358
	desc = EVTDESC_SOH_4358
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4358 # Child's play!
		
		prestige = 25
		
		FROMFROM = {
			character_event = { id = soh.4359 }
		}
	}
}

# Inform target
character_event = {
	id = soh.4359
	desc = EVTDESC_SOH_4359
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4359 # She's the most trustworthiest human ever!
		
		prestige = -25
	}
}

# Target not charmed - time to flee!
character_event = {
	id = soh.4360
	desc = EVTDESC_SOH_4360
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	
	option = {
		name = EVTOPTA_SOH_4360 # This is no longer funny!
		
		FROMFROM = {
			character_event = { id = soh.4361 }
		}
		
		leave_court_and_die_effect = yes
	}
}

# Inform target
character_event = {
	id = soh.4361
	desc = EVTDESC_SOH_4361
	picture = GFX_evt_quarrel
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4361 # She *was* a kitsune!
		
		prestige = 25
	}
}

# Curse target to be ill?
character_event = {
	id = soh.4362
	desc = EVTDESC_SOH_4362
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4362 # Yes!
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4363 } # Inform target
		}
	}
	
	option = {
		trigger = {
			ai = no
		}
		
		name = EVTOPTB_SOH_4362 # No!
	}
}

# Target becomes ill
character_event = {
	id = soh.4363
	desc = EVTDESC_SOH_4363
	picture = GFX_evt_illness
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4363 # I don't feel so good...
		
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			random_list = {
				1 = {
					give_pneumonic_effect = yes
				}
				1 = {
					give_flu_effect = yes
				}
				1 = {
					give_food_poisoning_effect = yes
				}
			}
		}
		
		else = {
			add_trait = ill
		}
	}
}

# Kitsune teaches her child a few tricks
character_event = {
	id = soh.4364
	desc = EVTDESC_SOH_4364
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		random_child = {
			limit = {
				is_inaccessible_or_incapable_trigger = yes
				is_alive = yes
				is_adult = no
				NOT = {
					has_character_flag = kitsune_lesson
				}
			}
			
			preferred_limit = {
				is_female = yes
				has_character_flag = is_kitsune
			}
			
			preferred_limit = {
				is_female = yes
				has_character_flag = recessive_kitsune
			}
			
			preferred_limit = {
				is_female = yes
			}
			
			set_character_flag = kitsune_lesson
			save_event_target_as = kitsune_lesson_target
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4364 # Mother knows best!
		
		event_target:kitsune_lesson_target = {
			character_event = { id = soh.4365 } # Inform target
		}
	}
}

# Child informed
character_event = {
	id = soh.4365
	desc = EVTDESC_SOH_4365
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4365 # What a strange lesson...
		
		change_diplomacy = 1
		change_intrigue = 1
	}
}

# Kitsune is visited by foxes
character_event = {
	id = soh.4366
	desc = EVTDESC_SOH_4366
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4366 # Hello, my furry friends!
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4367 } # Inform target
		}
	}
}

# Target informed of fox visit
character_event = {
	id = soh.4367
	desc = EVTDESC_SOH_4367
	picture = GFX_evt_garden
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4367 # How odd...
	}
}

# Kitsune visits someone's dreams
character_event = {
	id = soh.4368
	desc = EVTDESC_SOH_4368
	picture = GFX_evt_sleeping_town_hf
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_playable = yes
					is_adult = yes
					is_inaccessible_or_incapable_trigger = no
				}
				save_event_target_as = kitsune_dream_target
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4368 # I will pay them a visit!
		
		prestige = 25
		
		event_target:kitsune_dream_target = {
			character_event = { id = soh.4369 } # Inform target
		}
	}
}

# Dreamer informed
character_event = {
	id = soh.4369
	desc = EVTDESC_SOH_4369
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4369 # How odd...
	}
}

# Kitsune feeds by having sex
character_event = {
	id = soh.4370
	desc = EVTDESC_SOH_4370
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4370 # Time to feed!
		
		add_character_modifier = {
			modifier = invigorating_love
			months = 12
		}
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4371 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = soh.4371
	desc = EVTDESC_SOH_4371
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4371 # That was... exhausting...
		
		unprotected_sex_effect = yes
		
		add_character_modifier = {
			modifier = fierce_lovemaking
			months = 12
		}
	}
}

# Develops hatred of (preferably Buddhist) priest
character_event = {
	id = soh.4372
	desc = EVTDESC_SOH_4372
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_theocracy = yes
					NOT = {
						any_rival = {
							character = ROOT
						}
					}
				}
				
				preferred_limit = {
					religion = buddhist
				}
				
				save_event_target_as = kitsune_priest
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4372 # Such a turbulent priest...
		
		add_rival = event_target:kitsune_priest
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4373 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = soh.4373
	desc = EVTDESC_SOH_4373
	picture = GFX_evt_bishop
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4373 # I see...
	}
}

# Gets rid of (preferably Buddhist) rival priest
character_event = {
	id = soh.4374
	desc = EVTDESC_SOH_4374
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	immediate = {
		top_liege = {
			random_realm_lord = {
				limit = {
					is_theocracy = yes
					any_rival = {
						character = ROOT
					}
				}
				
				preferred_limit = {
					religion = buddhist
				}
				
				save_event_target_as = kitsune_priest
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_4374 # Such a turbulent priest...
		
		event_target:kitsune_priest = {
			death = {
				death_reason = death_murder_unknown
			}
		}
		
		persistent_event_target:kitsune_target = {
			character_event = { id = soh.4375 } # Inform target
		}
	}
}

# Target informed
character_event = {
	id = soh.4375
	desc = EVTDESC_SOH_4375
	picture = GFX_evt_shadow
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4375 # I see...
	}
}

# Imprisoned kitsune escapes
character_event = {
	id = soh.4376
	desc = EVTDESC_SOH_4376
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4376 # This puny cell can't hold me!
		
		prestige = 25
		
		host = {
			save_event_target_as = kitsune_host
		}
		
		imprison = no
		
		if = {
			limit = {
				host = {
					event_target:kitsune_host = {
						character = PREV
						NOT = {
							ROOT = {
								persistent_event_target:kitsune_target = {
									character = PREVPREV
								}
							}
						}
					}
				}
			}
			
			leave_court_effect = yes
		}
		
		event_target:kitsune_host = {
			character_event = { id = soh.4377 } # Inform jailor
			
			if = {
				limit = {
					ROOT = {
						persistent_event_target:kitsune_target = {
							NOT = {
								character = PREVPREV
							}
						}
					}
				}
				
				ROOT = {
					persistent_event_target:kitsune_target = {
						character_event = { id = soh.4378 } # Inform target
					}
				}
			}
		}
	}
}

# Jailor informed
character_event = {
	id = soh.4377
	desc = EVTDESC_SOH_4377
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4377 # I see...
	}
}

# Target informed
character_event = {
	id = soh.4378
	desc = EVTDESC_SOH_4378
	picture = GFX_evt_hiding_from_pursuers
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_4378 # That's great!
	}
}

### Daughter of kitsune

# on_birth - daughter of kitsune might discover that she's a kitsune
character_event = {
	id = soh.4379
	hide_window = yes
	
	is_triggered_only = yes # on_birth
	
	only_women = yes
	
	trigger = {
		OR = {
			mother_even_if_dead = {
				trait = kitsune
			}
			mother = {
				has_character_flag = recessive_kitsune
			}
		}
	}
	
	immediate = {
		random_list = {
			97 = {
				# Not a kitsune, and not recessive
				mult_modifier = {
					factor = 0.2
					mother = {
						has_character_flag = kitsune_nine_tails
					}
				}
				
				mult_modifier = {
					factor = 0.3
					mother = {
						has_character_flag = kitsune_eight_tails
					}
				}
				
				mult_modifier = {
					factor = 0.4
					mother = {
						has_character_flag = kitsune_seven_tails
					}
				}
				
				mult_modifier = {
					factor = 0.5
					mother = {
						has_character_flag = kitsune_six_tails
					}
				}
				
				mult_modifier = {
					factor = 0.6
					mother = {
						has_character_flag = kitsune_five_tails
					}
				}
				
				mult_modifier = {
					factor = 0.7
					mother = {
						has_character_flag = kitsune_four_tails
					}
				}
				
				mult_modifier = {
					factor = 0.8
					mother = {
						has_character_flag = kitsune_three_tails
					}
				}
				
				mult_modifier = {
					factor = 0.9
					mother = {
						has_character_flag = kitsune_two_tails
					}
				}
			}
			
			2 = {
				health = 1
				set_character_flag = recessive_kitsune # Small chance of skipping a generation or more
			}
			
			1 = {
				health = 2
				set_character_flag = is_kitsune
			}
		}
	}
}

# on_adulthood - Kitsune's daughter is kitsune
character_event = {
	id = soh.4380
	
	desc = {
		trigger = {
			mother_even_if_dead = {
				trait = kitsune
			}
		}
		text = EVTDESC_SOH_4380_KITSUNE_MOTHER
	}
	
	desc = {
		trigger = {
			mother_even_if_dead = {
				NOT = {
					trait = kitsune
				}
			}
		}
		text = EVTDESC_SOH_4380_KITSUNE_ANCESTOR
	}
	
	picture = GFX_evt_dark_love
	border = GFX_event_normal_frame_intrigue
	
	is_triggered_only = yes # on_adulthood
	
	only_women = yes
	has_character_flag = is_kitsune
	
	option = {
		name = EVTOPTA_SOH_4380 # My true nature cannot remain hidden!
		
		prestige = 25
		
		set_character_flag = kitsune_one_tail
		change_diplomacy = 1
		change_intrigue = 1
		
		add_trait = kitsune
		
		if = {
			limit = {
				NOT = {
					trait = elusive_shadow
				}
			}
			
			remove_all_education_traits_effect = yes
			add_trait = elusive_shadow
		}
		
		remove_all_negative_congenital_traits_effect = yes
		
		if = {
			limit = {
				NOT = {
					trait = attractive
				}
			}
			
			add_trait = attractive
		}
		
		if = {
			limit = {
				NOT = {
					trait = celibate
				}
			}
			
			remove_trait = celibate
		}
		
		if = {
			limit = {
				has_character_modifier = mourning_celibate
			}
			
			remove_character_modifier = mourning_celibate
		}
		
		if = {
			limit = {
				NOT = {
					trait = lustful
				}
			}
			
			add_trait_fully_lustful_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = deceitful
				}
			}
			
			add_trait_fully_deceitful_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = shrewd
				}
			}
			
			add_trait_shrewd_effect = yes
		}
		
		if = {
			limit = {
				NOT = {
					trait = gregarious
				}
			}
			
			add_trait_fully_gregarious_effect = yes
		}
	}
}

# Kitsune daughter event selection - subset of mother's events
character_event = {
	id = soh.4381
	hide_window = yes
	
	is_triggered_only = yes # on_bi_yearly_pulse -> random_events -> kitsune_events
	
	only_women = yes
	min_age = 16
	has_character_flag = is_kitsune
	
	trigger = {
		trait = kitsune
		is_actually_incapable_trigger = no
	}
	
	immediate = {
		if = {
			limit = {
				persistent_event_target:kitsune_target = {
					is_alive = no
				}
			}
			
			if = {
				limit = {
					num_of_lovers >= 1
				}
				
				random_lover = {
					preferred_limit = {
						is_married = ROOT
					}
					
					preferred_limit = {
						any_consort = {
							character = ROOT
						}
					}
					
					save_event_target_as = kitsune_target
				}
			}
			
			else_if = {
				limit = {
					is_married = yes
				}
				spouse = {
					save_event_target_as = kitsune_target
				}
			}
			
			else_if = {
				limit = {
					is_consort = yes
				}
				random_consort = {
					save_event_target_as = kitsune_target
				}
			}
			
			save_persistent_event_target = {
				name = kitsune_target
				scope = event_target:kitsune_target
			}
		}
		
		random_list = {
			1 = {
				trigger = {
					NOT = {
						has_character_flag = kitsune_nine_tails
					}
				}
				character_event = { id = soh.4328 } # Kitsune gets another tail
				
			}
			
			1 = { # Less likely; we don't want the player to get their traits changed frequently if this is a player...
				trigger = {
					NAND = {
						trait = elusive_shadow
						trait = attractive
						NOT = {
							trait = celibate
						}
						trait = lustful
						trait = deceitful
						trait = shrewd
						trait = gregarious
					}
				}
				
				character_event = { id = soh.4329 } # Kitsune's traits change back
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						OR = {
							any_spouse = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
							
							any_consort = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
							
							any_lover = {
								is_inaccessible_or_incapable_trigger = no
								NOT = {
									character = ROOT
								}
							}
						}
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4336 } # Kitsune removes "obstacles"
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_inaccessible_or_incapable_trigger = no
						is_landed = yes
					}
					
					persistent_event_target:kitsune_target = {
						is_alive = yes
					}
				}
				
				character_event = { id = soh.4339 } # Kitsune impresses courtier
			}
			
			# Can't get the slip-up event; that'd kill us...
			# Can't get the "too young" event; that'd kill us
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_ill = no
						is_alive = yes
						is_inaccessible_or_incapable_trigger = no
					}
				}
				
				character_event = { id = soh.4362 } # Kitsune makes target ill
			}
			
			10 = {
				trigger = {
					any_child = {
						is_inaccessible_or_incapable_trigger = yes
						is_alive = yes
						is_adult = no
						NOT = {
							has_character_flag = kitsune_lesson
						}
					}
				}
				
				character_event = { id = soh.4364 } # Kitsune gives her child a lesson
			}
			
			10 = {
				character_event = { id = soh.4366 } # Kitsune is visited by foxes
			}
			
			10 = {
				character_event = { id = soh.4368 } # Kitsune visits someone's dreams
			}
			
			10 = {
				trigger = {
					persistent_event_target:kitsune_target = {
						is_alive = yes
						is_inaccessible_or_incapable_trigger = no
					}
					
					NOT = {
						trait = celibate
					}
				}
				
				character_event = { id = soh.4370 } # Kitsune feeds on sex
			}
			
			10 = {
				trigger = {
					top_liege = {
						any_realm_lord = {
							is_theocracy = yes
							NOT = {
								is_rival = ROOT
							}
						}
					}
				}
				
				character_event = { id = soh.4372 } # Kitsune disliks priest
			}
			
			10 = {
				trigger = {
					top_liege = {
						any_realm_lord = {
							is_theocracy = yes
							is_rival = ROOT
						}
					}
				}
				
				character_event = { id = soh.4374 } # Kitsune kills priest
			}
			
			100 = {
				trigger = {
					prisoner = yes
				}
				
				character_event = { id = soh.4376 } # Kitsune escapes prison
			}
			
			100 = {}
		}
	}
}