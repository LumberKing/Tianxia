# Iyomante events
# By Silverswee(e)per

namespace = soh

# Reserved ids soh.1-200

##### Preparation

# Preparation begins
character_event = {
	id = soh.1
	desc = EVTDESC_SOH_1
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		# Clear old flags
		clr_character_flag = coming_to_iyomante
		clr_character_flag = do_not_disturb
		clr_character_flag = guest_iyomante_started
		clr_character_flag = host_iyomante_started
		clr_character_flag = iyomante_little_sake
		clr_character_flag = iyomante_many_nusa
		clr_character_flag = iyomante_no_sacrifice
		clr_character_flag = iyomante_normal_nusa
		clr_character_flag = iyomante_normal_sake
		clr_character_flag = iyomante_plentiful_sake
		clr_character_flag = iyomante_single_inaw
		clr_character_flag = lavishly_food
		clr_character_flag = low_food
		clr_character_flag = medium_food
		clr_character_flag = recent_iyomante
		clr_character_flag = sent_invitations
	}
	
	option = {
		name = EVTOPTA_SOH_1 # Time for the preparations to begin
		
		character_event = { id = soh.2 days = 1 random = 2 } # Inaw/nusa
		
		character_event = { id = soh.3 days = 4 random = 2 } # Sake
		
		character_event = { id = soh.4 days = 7 random = 2 } # Food preparation
		
		character_event = { id = soh.5 days = 10 random = 2 } # Invitations
	}
}

# Preparing inaw (sing.)/nusa (plur.)
character_event = {
	id = soh.2
	desc = EVTDESC_SOH_2
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_2 # We must prepare plenty of nusa!
		
		wealth = -10
		piety = 15
		
		set_character_flag = iyomante_many_nusa
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					AND = {
						trait = cynical
						NOT = {
							trait = charitable
						}
					}
					AND = {
						trait = greedy
						NOT = {
							trait = zealous
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_2 # Prepare a reasonable amount of nusa
		
		piety = 10
		wealth = -5
		
		set_character_flag = iyomante_normal_nusa
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					AND = {
						trait = cynical
						NOT = {
							trait = charitable
						}
					}
					AND = {
						trait = greedy
						NOT = {
							trait = zealous
						}
					}
				}
			}

			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_2 # A single inaw is all I want
		
		piety = -10
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Preparing sake
character_event = {
	id = soh.3
	desc = EVTDESC_SOH_3
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_3 # The kamuy deserves plentiful sake!
		
		wealth = -10
		piety = 15
		
		set_character_flag = iyomante_plentiful_sake
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					AND = {
						trait = cynical
						NOT = {
							trait = charitable
						}
					}
					AND = {
						trait = greedy
						NOT = {
							trait = zealous
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_3 # The kamuy deserves sufficient sake
		
		piety = 10
		wealth = -5
		
		set_character_flag = iyomante_normal_sake
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					AND = {
						trait = cynical
						NOT = {
							trait = charitable
						}
					}
					AND = {
						trait = greedy
						NOT = {
							trait = zealous
						}
					}
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
				trait = zealous
			}
		}
	}
	
	option = {
		name = EVTOPTC_SOH_3 # The kamuy shouldn't get much sake
		
		piety = -10
		
		set_character_flag = iyomante_little_sake
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					trait = zealous
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
				NOT = {
					trait = cynical
				}
			}
		}
	}
}

# Food preparations - copied from vanilla
character_event = {
	id = soh.4
	desc = EVTDESC_SOH_4
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	only_rulers = yes
	prisoner = no
	war = no

	is_triggered_only = yes

	trigger = {
		is_actually_incapable_trigger = no
		NOR = {
			has_character_flag = lavishly_food
			has_character_flag = medium_food
			has_character_flag = low_food
		}
	}

	immediate = {
		if = {
			limit = {
				any_artifact = {
					has_artifact_flag = cooking
					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}
			}

			random_artifact = {
				limit = {
					has_artifact_flag = cooking

					OR = {
						is_artifact_equipped = yes

						# If ROOT already cannibal, someone else should be around to become cannical...
						trigger_if = {
							limit = {
								artifact_type = the_omnivore
								ROOT = { trait = cannibal }
							}

							ROOT = {
								any_courtier = {
									is_adult = yes
									NOT = { trait = cannibal }
									is_inaccessible_or_incapable_trigger = no
								}
							}
						}
					}

					NOT = { artifact_type = gastronomic_tonics } # Not really about food
				}

				preferred_limit = {
					quality >= 3
				}

				preferred_limit = {
					quality >= 2
				}

				preferred_limit = {
					quality >= 1
				}

				save_event_target_as = book_target
			}

			if = { # If ROOT is already a cannibal...
				limit = {
					trait = cannibal

					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				random_courtier = {
					limit = {
						NOT = { trait = cannibal }
						is_adult = yes
						is_inaccessible_or_incapable_trigger = no
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
						is_evil_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
						family_of_root_trigger = yes
					}

					preferred_limit = {
						family_of_root_trigger = yes
					}

					preferred_limit = {
						has_education_stewardship_trigger = yes
					}

					save_event_target_as = potential_cannibal
				}
			}
		}
	}

	option = {
		name = {
			text = EVTOPTD72003 # Why don't we use this as inspiration?
			trigger = {
				event_target:book_target = { quality > 1 }
			}
		}
		name = {
			text = EVTOPTD72003_cheap # Let's make use of this little thing
			trigger = {
				event_target:book_target = { quality < 2 }
			}
		}

		tooltip_info_custom = available_because_books_tt

		trigger = {
			event_target:book_target = { always = yes }
		}

		if = {
			limit = {
				event_target:book_target = {
					quality < 2
				}
			}

			set_character_flag = low_food
			prestige = -5
		}
		else_if = {
			limit = {
				event_target:book_target = {
					quality == 2
				}
			}

			if = {
				limit = {
					event_target:book_target = {
						artifact_type = the_omnivore
					}
				}

				if = {
					limit = { trait = cannibal }

					custom_tooltip = { text = EVTOPTD72003_buddy_cannibal_tt }

					event_target:potential_cannibal = {
						show_scope_change = no

						add_trait = cannibal
					}
				}
				else = {
					custom_tooltip = { text = EVTOPTD72003_cannibal_tt }
					add_trait = cannibal
				}

				set_character_flag = lavishly_food
				wealth = -10
				prestige = 20
			}
			else = {
				set_character_flag = medium_food
				wealth = -5
				prestige = 5
			}
		}
		else = { # Means it's quality 3/higher
			set_character_flag = lavishly_food
			wealth = -10
			prestige = 20
		}

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTA72003 # Spend lavishly on food

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes
		set_character_flag = lavishly_food
		wealth = -20
		prestige = 10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				trait = greedy
			}

			mult_modifier = {
				factor = 3
				trait = gluttonous
			}

			mult_modifier = {
				factor = 0.1
				trait = temperate
			}

			mult_modifier = {
				factor = 2
				higher_real_tier_than = DUKE
			}
		}
	}

	option = {
		name = EVTOPTB72003 # Spend medium on food

		set_character_flag = medium_food
		wealth = -10

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 0.5
				NOT = { trait = greedy }
			}

			mult_modifier = {
				factor = 2
				NOT = { trait = gluttonous }
			}

			mult_modifier = {
				factor = 2
				real_tier = DUKE
			}
		}
	}

	option = {
		name = EVTOPTC72003 # Spend low on food

		trigger = {
			NOT = { trait = gluttonous }
		}

		set_character_flag = low_food
		wealth = -5
		prestige = -5

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 2.5
				trait = greedy
			}

			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}

			mult_modifier = {
				factor = 2
				real_tier = COUNT
			}
		}
	}
}

# Time to send invitations
character_event = {
	id = soh.5
	desc = EVTDESC_SOH_5
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	prisoner = no
	war = no
	
	trigger = {
		has_character_modifier = iyomante_in_progress
		is_actually_incapable_trigger = no
	}

	option = {
		name = EVTOPTA72010

		custom_tooltip = {
			text = EVTTOOLTIP1_RoI_1000

			set_character_flag = sent_invitations

			character_event = {
				id = soh.8
				days = 20
			}

			any_vassal = {
				limit = {
					war = no
					block_general_event_trigger = no
					NOT = { has_character_modifier = holding_large_feast }
					NOT = {
						trait = treasure_fleet_preparation
					}
				}

				letter_event = {
					id = soh.6
					days = 2
					# tooltip = EVTTOOLTIP72011
				}
			}
		}
	}
}

# Vassal gets invitation
letter_event = {
	id = soh.6
	desc = EVTDESC_SOH_6

	is_triggered_only = yes

	trigger = { is_inaccessible_trigger = no }

	option = {
		name = EVTOPTA72011 # Travel to the feast

		set_character_flag = coming_to_iyomante

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -40
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value >= -20
				}
			}
		}
	}

	option = {
		name = EVTOPTB72011 # Refuse

		FROM = {
			show_scope_change = no

			letter_event = {
				id = soh.7
				days = 1
				random = 2
				tooltip = EVTTOOLTIP72012
			}

			opinion = {
				name = opinion_dislike
				who = ROOT
				years = 10
			}
		}

		ai_chance = {
			factor = 1

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -60
				}
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROM
					value < -80
				}
			}
		}
	}
}

# Vassal refused invitation
letter_event = {
	id = soh.7
	desc = EVTDESC_SOH_7

	is_triggered_only = yes
	
	ai = no

	option = {
		name = "EVTOPTA72012"
		
		opinion = {
			modifier = opinion_dislike
			who = FROM
			years = 10
		}
	}
}



##### Arrival

# Guests arrive - host
character_event = {
	id = soh.8
	desc = EVTDESC_SOH_8
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_8 # Welcome! Welcome!
		
		set_character_flag = host_iyomante_started
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			set_character_flag = guest_iyomante_started
			character_event = { id = soh.9 } # Vassals informed
		}
		
		character_event = { id = soh.10 days = 2 } # Event group 1 event selection
	}
}

# Guest arrives - guest
character_event = {
	id = soh.9
	desc = EVTDESC_SOH_9
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_9 # I hope this will be fun!
	}
}



##### Event group 1

# Event selection
character_event = {
	id = soh.10
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		random_list = {
			10 = { # Lavish food (vassal)
				trigger = {
					has_character_flag = lavishly_food

					any_vassal = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.11 }
				}
			}

			10 = { # Medium food (vassal)
				trigger = {
					has_character_flag = medium_food

					any_vassal = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.12 }
				}
			}

			10 = { # Low food (vassal)
				trigger = {
					has_character_flag = low_food

					any_vassal = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}
				}

				any_vassal = {
					limit = {
						has_character_flag = guest_iyomante_started
						is_actually_incapable_trigger = no
						prisoner = no
						war = no
					}

					score_value = {
						value = 10
						interesting_courtier_selection_score = yes
					}

					character_event = { id = soh.13 }
				}
			}
		}
		
		# Possible friendship or rivalry
		random_list = {
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
						NOR = {
							is_friend = ROOT
							is_rival = ROOT
							is_lover = ROOT
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						NOR = {
							is_friend = ROOT
							is_rival = ROOT
							is_lover = ROOT
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = iyomante_friend
					
					ROOT = {
						character_event = { id = soh.16 days = 3 random = 2 } # Host made a friend
					}
				}
			}
			
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_iyomante
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_iyomante
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = iyomante_friend_character_1
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_iyomante
						NOR = {
							character = event_target:iyomante_friend_character_1
							is_friend = event_target:iyomante_friend_character_1
							is_rival = event_target:iyomante_friend_character_1
							is_lover = event_target:iyomante_friend_character_1
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = iyomante_friend_character_2
				}
				
				event_target:iyomante_friend_character_1 = {
					character_event = { id = soh.18 days = 3 random = 2 } # Vassal befriended another vassal
				}
			}
			
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_iyomante
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						war = no
						ROOT = {
							any_vassal = {
								has_character_flag = coming_to_iyomante
								NOR = {
									character = PREVPREV
									is_friend = PREVPREV
									is_rival = PREVPREV
									is_lover = PREVPREV
								}
							}
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = iyomante_rival_character_1
				}
				
				any_vassal = {
					limit = {
						has_character_flag = coming_to_iyomante
						NOR = {
							character = event_target:iyomante_rival_character_1
							is_friend = event_target:iyomante_rival_character_1
							is_rival = event_target:iyomante_rival_character_1
							is_lover = event_target:iyomante_rival_character_1
						}
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					save_event_target_as = iyomante_rival_character_2
				}
				
				event_target:iyomante_rival_character_1 = {
					character_event = { id = soh.21 days = 3 random = 2 } # Vassal rivalled another vassal
				}
			}
			10 = {
				# Nothing
			}
		}
		
		# Bear event
		random_list = {
			5 = {
				# Bear escapes
				character_event = { id = soh.24 days = 6 random = 3 }
			}
			
			5 = {
				# Bear hurts someone
				character_event = { id = soh.26 days = 6 random = 3 }
			}
			
			20 = {
				# Bear breaks free but it goes well
				character_event = { id = soh.29 days = 6 random = 3 }
			}
			
			30 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
					}
				}
				
				# Bear is truly impressive
				character_event = { id = soh.31 days = 6 random = 3 }
				
			}
			10 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
					}
				}
				
				# Bear is truly unimpressive
				character_event = { id = soh.33 days = 6 random = 3 }
			}
			30 = {
				# Nothing
			}
		}
		
		# Go to the next event selection
		character_event = { id = soh.35 days = 10 random = 2 }
	}
}

### Food complaints - based on vanilla

# Lavish Food
character_event = {
	id = soh.11
	desc = EVTDESC_SOH_11
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_11 # Approve publicly

		trigger = {
			NOT = { trait = temperate }
		}

		gain_weight_small_effect = yes
		weight_trait_check_effect = yes

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.14
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_11 # Disapprove

		trigger = {
			NOT = { trait = gluttonous }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.15
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_11

		prestige = -10
	}
}

# Medium Food
character_event = {
	id = soh.12
	desc = EVTDESC_SOH_12
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_12 # Approve publicly

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.14
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}
	}

	option = {
		name = EVTOPTB_SOH_12 # Disapprove

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.15
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_12

		prestige = -10
	}
}

# Low Food
character_event = {
	id = soh.13
	desc = EVTDESC_SOH_13
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_13 # Approve publicly

		trigger = {
			NOT = { trait = gluttonous }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = compliment_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.14
				tooltip = EVTTOOLTIP72023 # Liege is glad you liked it
			}
		}

		ai_chance = {
			factor = 20

			mult_modifier = {
				factor = 5
				trait = temperate
			}
		}
	}

	option = {
		name = EVTOPTAB_SOH_13 # Disapprove

		trigger = {
			NOT = { trait = temperate }
		}

		event_target:feast_host = {
			show_scope_change = no

			add_character_modifier = {
				name = complain_food_timer
				days = 14
				hidden = yes
			}

			character_event = {
				id = soh.15
				tooltip = EVTTOOLTIP72024 # Liege dislike you complaining about the food
			}
		}

		ai_chance = {
			factor = 40

			mult_modifier = {
				factor = 5
				trait = gluttonous
			}
		}
	}

	option = {
		name = EVTOPTC_SOH_13

		prestige = -10
	}
}

# Liege is glad you liked the food at the feast
character_event = {
	id = soh.14
	desc = EVTDESC_SOH_14
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_14 # Good!

		opinion = {
			name = opinion_happy
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_approves
			who = FROM
			years = 10
		}
	}
}

# Liege dislikes you complaining about the food at the feast
character_event = {
	id = soh.15
	desc = EVTDESC_SOH_15
	picture = GFX_evt_feast

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_15 # Shut up!

		opinion = {
			name = opinion_irritated
			who = FROM
			years = 10
		}

		reverse_opinion = {
			name = opinion_disapprove
			who = FROM
			years = 10
		}
	}
}

### Friendship or rivalry

# Friendship with guest - host
character_event = {
	id = soh.16
	desc = EVTDESC_SOH_16
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_16 # That's great!
		
		event_target:iyomante_friend = {
			add_friend = ROOT
			
			character_event = { id = soh.17 } # Inform guest
		}
	}
}

# Friendship with host - guest
character_event = {
	id = soh.17
	desc = EVTDESC_SOH_17
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_17 # That's great!
		
		add_friend = FROM
	}
}

# Friendship with other guest - guest 1
character_event = {
	id = soh.18
	desc = EVTDESC_SOH_18
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_18 # That's great!
		
		event_target:iyomante_friend_character_2 = {
			add_friend = ROOT
			
			character_event = { id = soh.19 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = soh.20 } # Inform host
		}
	}
}

# Friendship with other guest - guest 2
character_event = {
	id = soh.19
	desc = EVTDESC_SOH_19
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_19 # That's great!
		
		add_friend = FROM
	}
}

# Inform host
character_event = {
	id = soh.20
	desc = EVTDESC_SOH_20
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_20 # I see...
	}
}

# Rivalry with other guest - guest 1
character_event = {
	id = soh.21
	desc = EVTDESC_SOH_21
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_21 # I hate them!
		
		event_target:iyomante_rival_character_2 = {
			add_rival = ROOT
			
			character_event = { id = soh.22 } # Inform other guest
		}
		
		FROM = {
			character_event = { id = soh.23 } # Inform host
		}
	}
}

# Rivalry with other guest - guest 2
character_event = {
	id = soh.22
	desc = EVTDESC_SOH_22
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_22 # I hate them!
		
		add_rival = FROM
	}
}

# Inform host
character_event = {
	id = soh.23
	desc = EVTDESC_SOH_23
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_23 # I see...
	}
}

### Poor preparations

# Bear tied up very poorly - it escapes - host
character_event = {
	id = soh.24
	desc = EVTDESC_SOH_24
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_24 # Oh no!
		
		prestige = -50
		piety = -100
		
		set_character_flag = iyomante_no_sacrifice
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.25 } # Inform guests
		}
	}
}

# Inform guests that the bear escaped
character_event = {
	id = soh.25
	desc = EVTDESC_SOH_25
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_25 # How embarassing!
	}
}

# Bear tied up very poorly - it wounds someone - host
character_event = {
	id = soh.26
	desc = EVTDESC_SOH_26
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				any_vassal = {
					has_character_flag = coming_to_iyomante
					war = no
				}
			}
			
			any_vassal = {
				limit = { 
					has_character_flag = coming_to_iyomante
					war = no
				}
				
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = iyomante_wounded_guest
			}
		}
		else = {
			any_courtier = {
				limit = {
					is_landed = no
					is_inaccessible_or_incapable_trigger = no
				}
				
				score_value = { #Prioritizes selecting an interesting courtier...
					value = 10
					interesting_courtier_selection_score = yes
				}
				
				save_event_target_as = iyomante_wounded_guest
			}
		}
	}
	
	option = {
		name = EVTOPTA_SOH_26 # That's bad...
		
		prestige = -25
		piety = -25
		
		event_target:iyomante_wounded_guest = {
			character_event = { id = soh.27 } # Inform wounded guest
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
				NOT = {
					character = event_target:iyomante_wounded_guest
				}
			}
			
			character_event = { id = soh.28 } # Inform other guests
		}
	}
}

# Inform wounded guest
character_event = {
	id = soh.27
	desc = EVTDESC_SOH_27
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_27 # Ow!
		
		add_trait = wounded
	}
}

# Inform other guests
character_event = {
	id = soh.28
	desc = EVTDESC_SOH_28
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_28 # At least I didn't get hurt...
	}
}

# Bear tied up very poorly - it goes well - host
character_event = {
	id = soh.29
	desc = EVTDESC_SOH_29
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_29 # That could have been bad...
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.30 } # Inform guests
		}
	}
}

# Inform guests
character_event = {
	id = soh.30
	desc = EVTDESC_SOH_30
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_30 # That could have been bad...
	}
}

### Impressive/unimpressive bear

# Host has impressive bear - guest
character_event = {
	id = soh.31
	desc = EVTDESC_SOH_31
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_31 # Impressive!
		
		FROM = {
			character_event = { id = soh.32 } # Inform host
		}
	}
}

# Host told that guest was impressed
character_event = {
	id = soh.32
	desc = EVTDESC_SOH_32
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_32 # That's great!
		
		prestige = 50
	}
}

# Host has an unimpressive bear - guest
character_event = {
	id = soh.33
	desc = EVTDESC_SOH_33
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_33 # Unimpressive!
		
		FROM = {
			character_event = { id = soh.34 } # Inform host
		}
	}
}

# Host told that guest was unimpressed
character_event = {
	id = soh.34
	desc = EVTDESC_SOH_34
	picture = GFX_evt_stressed_ruler
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_34 # I see...
		
		prestige = -50
	}
}

##### Event group 2

# Event selection (see if the child event happens and if the whole thing should be bypassed because the bear escaped)
character_event = {
	id = soh.35
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		# Check if the sacrifice still is possible and handle that
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			random_list = {
				5 = {
					trigger ={
						any_courtier = {
							is_landed = no
							age >= 6
							is_adult = no
							is_inaccessible_or_incapable_trigger = no
							religion_openly_ainu_or_reformed_trigger = yes
							NOT = {
								trait = cruel
							}
						}
					}
					
					random_courtier = {
						limit = {
							is_landed = no
							age >= 6
							is_adult = no
							is_inaccessible_or_incapable_trigger = no
							religion_openly_ainu_or_reformed_trigger = yes
							NOT = {
								trait = cruel
							}
						}
						
						preferred_limit = {
							is_close_relative = ROOT
							OR = {
								trait = kind
								trait = affectionate
							}
						}
						
						preferred_limit = {
							OR = {
								trait = kind
								trait = affectionate
							}
						}
						
						preferred_limit = {
							is_close_relative = ROOT
						}
						
						save_event_target_as = bear_sacrifice_child
					}
					
					character_event = { id = soh.36 } # Child wants to save the bear
				}
				
				95 = {
					character_event = { id = soh.39 } # Go to actual sacrifice
				}
			}
		}
		else = {
			character_event = { id = soh.72 } # Alternative sake event
		}
		
		# Going to the next event selection is handled elsewhere!
	}
}

### Bear sacrifice - child branch

# Child wants to save the bear - host
character_event = {
	id = soh.36
	desc = EVTDESC_SOH_36
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_36 # Fine!
		
		set_character_flag = iyomante_no_sacrifice
	
		character_event = { id = soh.72 days = 2 } # Alternative sake event
		
		custom_tooltip = {
			text = iyomante_bear_saved
			create_character = {
				age = 16 # Though the bear would be 2-3 years old, it would be an adult bear, so this is best...
				name = "Kamuy"
				dynasty = none
				female = 50
				culture = bear_culture
				religion = ROOT
				trait = bear # Fertility/etc. blocker, similar to Horse/Cat trait
				trait = strong
				trait = zealous
				trait = kind
				trait = gluttonous
			}
			new_character = {
				set_character_flag = ai_flag_refuse_concubinage
				set_character_flag = ai_flag_refuse_marriage
				set_character_flag = ai_flag_refuse_conversion
				set_character_flag = no_court_invites
				opinion = {
					who = event_target:bear_sacrifice_child
					modifier = opinion_loyal_servant
				}
			}
		}
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			character_event = { id = soh.37 } # Inform guests
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOR = {
					trait = zealous
					trait = cruel
				}
			}
			
			mult_modifier = {
				factor = 0.1
				NOT = {
					trait = kind
				}
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_36 # Not happening!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.38 } # Inform guests
		}
		
		character_event = { id = soh.39 days = 2 } # Go to the actual sacrifice
		
		event_target:bear_sacrifice_child = {
			if = {
				limit = {
					is_friend = ROOT
				}
				remove_friend = ROOT
			}
			add_rival = ROOT
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = cynical
			}
			
			mult_modifier = {
				factor = 0.1
				trait = kind
			}
		}
	}
}

# Bear saved - guest
character_event = {
	id = soh.37
	desc = EVTDESC_SOH_37
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_37 # An odd decision...
	}
}

# Bear not saved - guest
character_event = {
	id = soh.38
	desc = EVTDESC_SOH_38
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_38 # Probably the right decision...
	}
}

### Bear sacrifice - arrows

# Shooting the bear - who takes the first shot?
character_event = {
	id = soh.39
	desc = EVTDESC_SOH_39
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		any_vassal = {
			limit = { 
				has_character_flag = coming_to_iyomante
				war = no
				can_be_commander_trigger_no_fromfrom = yes
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_archer_1
		}
		
		any_courtier = {
			limit = {
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
				can_be_commander_trigger_no_fromfrom = yes
			}
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			save_event_target_as = iyomante_archer_2
		}
	}
	
	option = {
		trigger = {
			is_actually_incapable_trigger = no
		}
		
		name = EVTOPTA_SOH_39 # I will take the first shot!
		
		random_list = {
			75 = {
				trigger = {
					combat_rating > 0
				}
				
				character_event = { id = soh.40 days = 2 } # It goes well
			}
			
			25 = {
				trigger = {
					combat_rating < 50
				}
				
				character_event = { id = soh.42 days = 2 } # It goes poorly
			}
		}
		
		ai_chance = {
			factor = 100
			mult_modifier = {
				factor = 0.01
				NOR = {
					combat_rating = 1
					trait = proud
				}
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_archer_1 = {
				always = yes
			}
		}
		
		name = EVTOPTB_SOH_39 # A vassal will take the shot
		
		event_target:iyomante_archer_1 = {
			random_list = {
				75 = {
					trigger = {
						combat_rating > 0
					}
					
					character_event = { id = soh.44 days = 2 } # It goes well
				}
				
				25 = {
					trigger = {
						combat_rating < 50
					}
					
					character_event = { id = soh.47 days = 2 } # It goes poorly
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					is_rival = event_target:iyomante_archer_1
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:iyomante_archer_1
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_archer_2 = {
				always = yes
			}
		}
		name = EVTOPTC_SOH_39 # A a courtier will take the shot
		
		event_target:iyomante_archer_2 = {
			random_list = {
				75 = {
					trigger = {
						combat_rating > 0
					}
					
					character_event = { id = soh.44 days = 2 } # It goes well
				}
				
				25 = {
					trigger = {
						combat_rating < 50
					}
					
					character_event = { id = soh.47 days = 2 } # It goes poorly
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					is_rival = event_target:iyomante_archer_2
				}
			}
			
			mult_modifier = {
				factor = 10
				is_friend = event_target:iyomante_archer_2
			}
		}
	}
	
	after = {
		character_event = { id = soh.50 days = 4 } # Bear has been killed
	}
}

# Host takes the first shot - it goes well - host
character_event = {
	id = soh.40
	desc = EVTDESC_SOH_40
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_40 # As expected!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.41 } # Inform guests
		}
	}
}

# Host takes the first shot - it goes well - guest
character_event = {
	id = soh.41
	desc = EVTDESC_SOH_41
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_41 # As expected!
	}
}

# Host takes the first shot - it goes poorly - host
character_event = {
	id = soh.42
	desc = EVTDESC_SOH_42
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_42 # That's not good...
		
		prestige = -25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.43 } # Inform guests
		}
	}
}

# Host takes the first shot - it goes poorly - guest
character_event = {
	id = soh.43
	desc = EVTDESC_SOH_43
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_43 # How embarassing!
	}
}

# Guest takes the first shot - it goes well - guest
character_event = {
	id = soh.44
	desc = EVTDESC_SOH_44
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_44 # As expected!
		
		prestige = 10
		
		FROM = {
			character_event = { id = soh.45 } # Inform host
			
			any_vassal = {
				limit = {
					ai = no
					has_character_flag = coming_to_iyomante
					NOT = {
						character = ROOT
					}
				}
				
				character_event = { id = soh.46 } # Inform other guests
			}
		}
	}
}

# Guest takes the first shot - it goes well - host
character_event = {
	id = soh.45
	desc = EVTDESC_SOH_45
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_45 # As expected!
	}
}

# Guest takes the first shot - it goes well - other guests
character_event = {
	id = soh.46
	desc = EVTDESC_SOH_46
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_46 # As expected!
	}
}

# Guest takes the first shot - it goes poorly - guest
character_event = {
	id = soh.47
	desc = EVTDESC_SOH_47
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_47 # That went poorly...
		
		prestige = -25
		
		FROM = {
			character_event = { id = soh.48 } # Inform host
			
			any_vassal = {
				limit = {
					ai = no
					has_character_flag = coming_to_iyomante
					NOT = {
						character = ROOT
					}
				}
				
				character_event = { id = soh.49 } # Inform other guests
			}
		}
	}
}

# Guest takes the first shot - it goes poorly - host
character_event = {
	id = soh.48
	desc = EVTDESC_SOH_48
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_48 # How embarassing!
	}
}

# Guest takes the first shot - it goes poorly - other guests
character_event = {
	id = soh.49
	desc = EVTDESC_SOH_49
	picture = GFX_evt_longbowman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_49 # How embarassing!
	}
}

### Bear sacrifice - drinking the blood

# Time to drink the blood - host
character_event = {
	id = soh.50
	desc = EVTDESC_SOH_50
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_50 # Thank you, kamuy!
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			
			if = {
				limit = {
					OR = {
						religion_openly_ainu_or_reformed_trigger = yes
						religion_openly_nivkh_or_reformed_trigger = yes
						religion_secretly_ainu_or_reformed_trigger = yes
						religion_secretly_nivkh_or_reformed_trigger = yes
					}
				}
				character_event = { id = soh.51 } # Ainu guest is informed
			}
			
			else = {
				character_event = { id = soh.52 } # Non-Ainu guest might react poorly
			}
		}
		
		character_event = { id = soh.53 days = 2 } # Inaw/nusa
	}
}

# Time to drink the blood - Ainu/Nivkh guest
character_event = {
	id = soh.51
	desc = EVTDESC_SOH_51
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_51 # Thank you, kamuy!
	}
}

# Time to drink the blood - other guest
character_event = {
	id = soh.52
	desc = EVTDESC_SOH_52
	picture = GFX_evt_magic_ritual
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			NOR = {
				religion_group = pagan_group
				true_religion_group = pagan_group
			}
		}
		
		name = EVTOPTA_SOH_52 # How barbaric!
		
		add_trait_partially_proud_effect = yes
		add_trait_partially_zealous_effect = yes
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = zealous
			}
		}
	}
	
	option = {
		trigger = {
			OR = {
				religion_group = pagan_group
				true_religion_group = pagan_group
			}
		}
		
		name = EVTOPTB_SOH_52 # These Ainu customs sure are strange...
		
		add_trait_partially_proud_effect = yes
		add_trait_partially_zealous_effect = yes
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
			
			mult_modifier = {
				factor = 10
				trait = zealous
			}
		}
	}
	
	option = {
		trigger = {
			NOT = {
				trait = zealous
			}
		}
		
		name = EVTOPTC_SOH_52 # A curious ritual...
		
		if = {
			limit = {
				NOR = {
					religion_group = pagan_group
					trait = sympathy_pagans
				}
			}
			piety = -10
		}
		
		if = {
			limit = {
				NOT = {
					trait = sympathy_pagans
				}
			}
			add_trait = sympathy_pagans
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				NOR = {
					religion_group = pagan_group
					true_religion_group = pagan_group
					trait = sympathy_pagans
				}
			}
		}
	}
}

### Bear sacrifice - inaw/nusa

# Hidden event to select the appropriate event
character_event = {
	id = soh.53
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		random = {
			chance = 75
			if = {
				limit = {
					has_character_flag = iyomante_many_nusa
				}
				character_event = { id = soh.54 } # Plentiful nusa
			}
			
			else_if = {
				limit = {
					has_character_flag = iyomante_normal_nusa
				}
				character_event = { id = soh.56 } # Enough nusa
			}
			
			else_if = {
				limit = {
					has_character_flag = iyomante_single_inaw
				}
				character_event = { id = soh.58 } # A single inaw
			}
		}
		
		# Go to the sake event
		character_event = { id = soh.60 days = 2 }
	}
}

# Host offers plentiful nusa - host
character_event = {
	id = soh.54
	desc = EVTDESC_SOH_54
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_54 # For you, kamuy!
		
		piety = 15
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.55 } # Inform guests
		}
	}
}

# Host offers plentiful nusa - guest
character_event = {
	id = soh.55
	desc = EVTDESC_SOH_55
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_55 # An impressive sacrifice!
	}
}

# Host offers a reasonable amount of nusa - host
character_event = {
	id = soh.56
	desc = EVTDESC_SOH_56
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_56 # For you, kamuy!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.57 } # Inform guests
		}
	}
}

# Host offers a reasonable amount of nusa - guest
character_event = {
	id = soh.57
	desc = EVTDESC_SOH_57
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_57 # A good sacrifice!
	}
}

# Host offers a single inaw - host
character_event = {
	id = soh.58
	desc = EVTDESC_SOH_58
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_58 # I'm sure the kamuy will understand...
		
		piety = -10
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.59 } # Inform guests
		}
	}
}

# Host offers a single inaw - guest
character_event = {
	id = soh.59
	desc = EVTDESC_SOH_59
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_59 # That's all?
	}
}

### Bear sacrifice - sake

# Hidden event to select the appropriate event
character_event = {
	id = soh.60
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		random = {
			chance = 75
			if = {
				limit = {
					has_character_flag = iyomante_plentiful_sake
				}
				character_event = { id = soh.61 } # Plentiful sake
			}
			
			else_if = {
				limit = {
					has_character_flag = iyomante_normal_sake
				}
				character_event = { id = soh.63 } # Enough sake
			}
			
			else_if = {
				limit = {
					has_character_flag = iyomante_little_sake
				}
				character_event = { id = soh.65 } # Very little sake
			}
		}
		
		# Go to the meat event
		character_event = { id = soh.67 days = 2 }
	}
}

# Host offers plentiful sake - host
character_event = {
	id = soh.61
	desc = EVTDESC_SOH_61
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_61 # For you, kamuy!
		
		piety = 15
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.62 } # Inform guests
		}
	}
}

# Host offers plentiful sake - guest
character_event = {
	id = soh.62
	desc = EVTDESC_SOH_62
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_62 # An impressive sacrifice!
	}
}

# Host offers a reasonable amount of sake - host
character_event = {
	id = soh.63
	desc = EVTDESC_SOH_63
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_63 # For you, kamuy!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.64 } # Inform guests
		}
	}
}

# Host offers a reasonable amount of sake - guest
character_event = {
	id = soh.64
	desc = EVTDESC_SOH_64
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_64 # A good sacrifice!
	}
}

# Host offers very little sake - host
character_event = {
	id = soh.65
	desc = EVTDESC_SOH_65
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_65 # I'm sure the kamuy will understand...
		
		piety = -10
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.66 } # Inform guests
		}
	}
}

# Host offers very little sake - guest
character_event = {
	id = soh.66
	desc = EVTDESC_SOH_66
	picture = GFX_evt_cathedral_pagan_group
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_66 # That's all?
	}
}

### Bear sacrifice - distribute the meat

# Host decides how to distribute the meat
character_event = {
	id = soh.67
	desc = EVTDESC_SOH_67
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		any_vassal = {
			limit = { 
				has_character_flag = coming_to_iyomante
			}
			
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			
			save_event_target_as = iyomante_meat_recipient_1
		}
		
		any_courtier = {
			limit = {
				is_landed = no
				is_inaccessible_or_incapable_trigger = no
			}
			
			score_value = { #Prioritizes selecting an interesting courtier...
				value = 10
				interesting_courtier_selection_score = yes
			}
			
			save_event_target_as = iyomante_meat_recipient_2
		}
	}
	
	option = {
		name = EVTOPTA_SOH_67 # Everyone will get some!
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.68 } # Everyone gets meat
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 10
				trait = just
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_meat_recipient_1 = {
				always = yes
			}
		}
		
		name = EVTOPTB_SOH_67 # I'll give everything to a vassal!
		
		event_target:iyomante_meat_recipient_1 = {
			save_event_target_as = iyomante_meat_recipient
			
			opinion = {
				who = ROOT
				modifier = opinion_generous_iyomante_gift
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.69 } # Vassal got all the meat!
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
				NOT = {
					character = event_target:iyomante_meat_recipient_1
				}
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.70 } # Someone else got all the meat!
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					is_rival = event_target:iyomante_meat_recipient_1
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		trigger = {
			event_target:iyomante_meat_recipient_2 = {
				always = yes
			}
		}
		
		name = EVTOPTC_SOH_67 # I'll give everything to a courtier!
		
		event_target:iyomante_meat_recipient_2 = {
		
			save_event_target_as = iyomante_meat_recipient
			
			opinion = {
				who = ROOT
				modifier = opinion_generous_iyomante_gift
			}
		}
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.70 } # Someone else got all the meat!
			}
		}
		
		ai_chance = {
			factor = 100
			
			trigger = {
				NOT = {
					is_rival = event_target:iyomante_meat_recipient_2
				}
			}
			
			mult_modifier = {
				factor = 0.1
				trait = greedy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = gluttonous
			}
		}
	}
	
	option = {
		name = EVTOPTD_SOH_67 # I'll keep all the meat!
		
		prestige = 25
		piety = -25
		
		add_trait_partially_greedy_effect = yes
		
		any_vassal = {
			limit = {
				has_character_flag = coming_to_iyomante
			}
			
			opinion = {
				who = ROOT
				modifier = opinion_displeased
			}
			
			if = {
				limit = {
					ai = no
				}
				character_event = { id = soh.71 } # Liege didn't share the meat!
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.1
				trait = charitable
			}
			
			mult_modifier = {
				factor = 0.1
				trait = temperate
			}
			
			mult_modifier = {
				factor = 0.1
				trait = content
			}
		}
	}
	
	after = {
		character_event = { id = soh.75 days = 2 } # Go to event selection 3
	}
}

# Everyone got something - guest
character_event = {
	id = soh.68
	desc = EVTDESC_SOH_68
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_68 # My thanks!
	}
}

# You got everything
character_event = {
	id = soh.69
	desc = EVTDESC_SOH_69
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_69 # How generous!
	}
}

# Someone else got everything
character_event = {
	id = soh.70
	desc = EVTDESC_SOH_70
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_70 # This isn't right!
	}
}

# Host kept all the meat
character_event = {
	id = soh.71
	desc = EVTDESC_SOH_71
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_71 # This isn't right!
	}
}

### Alternative sake events if the sacrifice didn't happen

# Drink to forget - host
character_event = {
	id = soh.72
	desc = EVTDESC_SOH_72
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_72 # At least we have sake...
		
		hidden_tooltip = {
			any_vassal = {
				limit = {
					has_character_flag = coming_to_iyomante
				}
				
				if = {
					limit = {
						ai = no
					 }
					character_event = { id = soh.73 } # Vassals also drink
				}
				else = {
					random = {
						chance = 5
		
						prestige = -10
						add_trait_partially_drunkard_effect = yes
					}
				}
			}
			
			if = {
				limit = {
					has_character_flag = iyomante_plentiful_sake
				}
				
				random = {
					chance = 25
					character_event = { id = soh.74 days = 1 random = 2 } # You had way too much to drink
				}
			}
			
			else_if = {
				limit = {
					has_character_flag = iyomante_normal_sake
				}
				
				random = {
					chance = 5
					character_event = { id = soh.74 days = 1 random = 2 } # You had way too much to drink
				}
			}
		}
	}
	
	after = {
		character_event = { id = soh.75 days = 4 } # Go to event selection 3
	}
}

# Drink to forget - guest
character_event = {
	id = soh.73
	desc = EVTDESC_SOH_73
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_73 # At least we have sake...
		
		# Vassal is less likely to get drunk, seeing as they didn't fail to do the sacrifice
		if = {
			limit = {
				FROM = {
					has_character_flag = iyomante_plentiful_sake
				}
			}
			
			random = {
				chance = 5
				character_event = { id = soh.74 days = 1 random = 2 } # You had way too much to drink
			}
		}
		
		else_if = {
			limit = {
				FROM = {
					has_character_flag = iyomante_normal_sake
				}
			}
			
			random = {
				chance = 1
				character_event = { id = soh.74 days = 1 random = 2 } # You had way too much to drink
			}
		}
	}
}

# Drank way too much
character_event = {
	id = soh.74
	desc = EVTDESC_SOH_74
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_74 # That... was a mistake...
		
		prestige = -10
		add_trait_partially_drunkard_effect = yes
	}
}

##### Event group 3

# Event selection
character_event = {
	id = soh.75
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			character_event = { id = soh.76 } # Bear "doll"
		}
		
		# Yukar
		random_list = {
			50 = {
				trigger = {
					is_adult = yes
					is_actually_incapable_trigger = no
				}
				
				character_event = { id = soh.78 days = 2 } # Host gets to recite a yukar
			}
			
			50 = {
				trigger = {
					any_vassal = {
						has_character_flag = coming_to_iyomante
						is_adult = yes
						is_actually_incapable_trigger = no
						religion_openly_ainu_or_reformed_trigger = yes
					}
				}
				
				any_vassal = {
					limit = { 
						has_character_flag = coming_to_iyomante
						is_adult = yes
						is_actually_incapable_trigger = no
						religion_openly_ainu_or_reformed_trigger = yes
					}
					
					score_value = { #Prioritizes selecting an interesting courtier...
						value = 10
						interesting_courtier_selection_score = yes
					}
					
					character_event = { id = soh.85 days = 2 } # Guest gets to recite a yukar
				}
			}
		}
		
		# Go to the end of the Iyomante
		character_event = { id = soh.95 days = 6 }
	}
}

### Bear "doll"

# Fur and skull on a spear - host
character_event = {
	id = soh.76
	desc = EVTDESC_SOH_76
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_76 # It has been sent off!
		
		piety = 25
		
		any_vassal = {
			limit = {
				ai = no
				has_character_flag = coming_to_iyomante
			}
			
			character_event = { id = soh.77 } # Inform guests
		}
	}
}

# Fur and skull on a spear - guest
character_event = {
	id = soh.77
	desc = EVTDESC_SOH_77
	picture = GFX_evt_religious_exultation
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_77 # It has been sent off!
	}
}

### Yukar - host

# Host gets the opportunity to recite a yukar
character_event = {
	id = soh.78
	desc = EVTDESC_SOH_78
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_78 # Of course I'll do it!
		
		# Checks Learning and Diplomacy - Learning to remember, Diplomacy to be eloquent
		random_list = {
			20 = {
				mult_modifier = {
					factor = 2
					diplomacy = 24
				}
				
				mult_modifier = {
					factor = 2
					diplomacy = 20
				}
				
				mult_modifier = {
					factor = 2
					learning = 24
				}
				
				mult_modifier = {
					factor = 2
					learning = 20
				}
				
				character_event = { id = soh.79 days = 2 } # It goes very well
				
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					
					character_event = { id = soh.80 days = 2 } # Inform guests
				}
			}
			
			60 = {
				character_event = { id = soh.81 days = 2 } # It goes okay
				
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					
					character_event = { id = soh.82 days = 2 } # Inform guests
				}
			}
			
			20 = {
				mult_modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				
				character_event = { id = soh.83 days = 2 } # It goes very poorly
				
				any_vassal = {
					limit = {
						ai = no
						has_character_flag = coming_to_iyomante
					}
					
					character_event = { id = soh.84 days = 2 } # Inform guests
				}
			}
		}
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_78 # I think not!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = gregarious
			}
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Host recites a yukar extremely well - host
character_event = {
	id = soh.79
	desc = EVTDESC_SOH_79
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_79 # That went well!
		
		add_trait_partially_gregarious_effect = yes
		
		prestige = 15
		piety = 15
	}
}

# Host recites a yukar extremely well - guest
character_event = {
	id = soh.80
	desc = EVTDESC_SOH_80
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_80 # Impressive!
	}
}

# Host recites a yukar decently - host
character_event = {
	id = soh.81
	desc = EVTDESC_SOH_81
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_81 # That went okay!
		
		prestige = 5
		piety = 5
	}
}

# Host recites a yukar decently - guest
character_event = {
	id = soh.82
	desc = EVTDESC_SOH_82
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_82 # Tolerable!
	}
}

# Host recites a yukar very poorly - host
character_event = {
	id = soh.83
	desc = EVTDESC_SOH_83
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_83 # That went poorly!
		
		add_trait_partially_shy_effect = yes
		
		prestige = -15
		piety = -15
	}
}

# Host recites a yukar very poorly - guest
character_event = {
	id = soh.84
	desc = EVTDESC_SOH_84
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_84 # That wasn't very good!
	}
}

### Yukar - guest

# Guest gets the opportunity to recite a yukar
character_event = {
	id = soh.85
	desc = EVTDESC_SOH_85
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_85 # Of course I'll do it!
		
		# Checks Learning and Diplomacy - Learning to remember, Diplomacy to be eloquent
		random_list = {
			20 = {
				mult_modifier = {
					factor = 2
					diplomacy = 24
				}
				
				mult_modifier = {
					factor = 2
					diplomacy = 20
				}
				
				mult_modifier = {
					factor = 2
					learning = 24
				}
				
				mult_modifier = {
					factor = 2
					learning = 20
				}
				
				character_event = { id = soh.86 days = 2 } # It goes very well
				
				FROM = {
					character_event = { id = soh.87 days = 2 } # Inform host
					
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						
						character_event = { id = soh.88 days = 2 } # Inform other guests
					}
				}
			}
			
			60 = {
				character_event = { id = soh.89 days = 2 } # It goes okay
				
				FROM = {
					character_event = { id = soh.90 days = 2 } # Inform host
					
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						
						character_event = { id = soh.91 days = 2 } # Inform other guests
					}
				}
			}
			
			20 = {
				mult_modifier = {
					factor = 2
					NOT = {
						diplomacy = 8
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						diplomacy = 4
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						learning = 8
					}
				}
				
				mult_modifier = {
					factor = 2
					NOT = {
						learning = 4
					}
				}
				
				character_event = { id = soh.92 days = 2 } # It goes very poorly
				
				FROM = {
					character_event = { id = soh.93 days = 2 } # Inform host
					
					any_vassal = {
						limit = {
							ai = no
							has_character_flag = coming_to_iyomante
							NOT = {
								character = ROOT
							}
						}
						
						character_event = { id = soh.94 days = 2 } # Inform other guests
					}
				}
			}
		}
		
		ai_chance = {
			factor = 100
			mult_modifier = {
				factor = 0.01
				trait = shy
			}
			
			mult_modifier = {
				factor = 0.1
				trait = craven
			}
			
			mult_modifier = {
				factor = 10
				trait = proud
			}
		}
	}
	
	option = {
		name = EVTOPTB_SOH_85 # I think not!
		
		prestige = -10
		
		ai_chance = {
			factor = 100
			
			mult_modifier = {
				factor = 0.01
				trait = gregarious
			}
			
			mult_modifier = {
				factor = 0.1
				trait = brave
			}
			
			mult_modifier = {
				factor = 10
				trait = humble
			}
		}
	}
}

# Guest recites a yukar extremely well - guest
character_event = {
	id = soh.86
	desc = EVTDESC_SOH_86
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_86 # That went well!
		
		add_trait_partially_gregarious_effect = yes
		
		prestige = 15
		piety = 15
	}
}

# Guest recites a yukar extremely well - host
character_event = {
	id = soh.87
	desc = EVTDESC_SOH_87
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_87 # Impressive!
	}
}

# Guest recites a yukar extremely well - other guests
character_event = {
	id = soh.88
	desc = EVTDESC_SOH_88
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_88 # Impressive!
	}
}

# Guest recites a yukar decently - guest
character_event = {
	id = soh.89
	desc = EVTDESC_SOH_89
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_89 # That went okay!
		
		prestige = 5
		piety = 5
	}
}

# Guest recites a yukar decently - host
character_event = {
	id = soh.90
	desc = EVTDESC_SOH_90
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_90  # Tolerable!
	}
}

# Guest recites a yukar decently - other guests
character_event = {
	id = soh.91
	desc = EVTDESC_SOH_91
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_91 # Tolerable!
	}
}

# Guest recites a yukar very poorly - guest
character_event = {
	id = soh.92
	desc = EVTDESC_SOH_92
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_92 # That went poorly!
		
		add_trait_partially_shy_effect = yes
		
		prestige = -15
		piety = -15
	}
}

# Guest recites a yukar decently - host
character_event = {
	id = soh.93
	desc = EVTDESC_SOH_93
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	option = {
		name = EVTOPTA_SOH_93 # That was't very good!
	}
}

# Guest recites a yukar very poorly - other guests
character_event = {
	id = soh.94
	desc = EVTDESC_SOH_94
	picture = GFX_evt_shaman
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	trigger = {
		FROMFROM = {
			has_character_modifier = iyomante_in_progress
		}
	}
	
	option = {
		name = EVTOPTA_SOH_94 # That wasn't very good!
	}
}

##### End of Iyomante

# Check which ending is relevant
character_event = {
	id = soh.95
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_modifier = iyomante_in_progress
	}
	
	immediate = {
		if = {
			limit = {
				NOT = {
					has_character_flag = iyomante_no_sacrifice
				}
			}
			character_event = { id = soh.96 } # Normal end
		}
		
		else = {
			character_event = { id = soh.98 } # No sacrifice
		}
	}
}

# End of normal Iyomante - host
character_event = {
	id = soh.96
	desc = EVTDESC_SOH_96
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_96 # Until next time!
		
		prestige = 25
		piety = 25
		set_character_flag = recent_iyomante
		
		hidden_tooltip = {
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_iyomante
				}
				
				character_event = { id = soh.97 } # Inform vassals
				
				remove_opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
				}
				
				remove_opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
					years = 2
				}
				
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = guest_iyomante_started
			}
		}
	}
}

# End of normal Iyomante - guest
character_event = {
	id = soh.97
	desc = EVTDESC_SOH_97
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_97 # Until next time!
		
		prestige = 5
	}
}

# End of Iyomante without a sacrifice - host
character_event = {
	id = soh.98
	desc = EVTDESC_SOH_98
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_98 # Maybe the next one will be a proper one...
		
		prestige = -10
		piety = -10
		set_character_flag = recent_iyomante
		
		hidden_tooltip = {
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = sent_invitations
			
			any_vassal = {
				limit = {
					has_character_flag = coming_to_iyomante
				}
				
				character_event = { id = soh.99 } # Inform vassals
				
				remove_opinion = {
					modifier = opinion_enjoyed_iyomante
					who = ROOT
				}
				
				remove_opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
				}
				
				opinion = {
					modifier = opinion_did_not_enjoy_iyomante
					who = ROOT
					years = 2
				}
				
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = guest_iyomante_started
			}
		}
	}
}

# End of Iyomante without a sacrifice - guest
character_event = {
	id = soh.99
	desc = EVTDESC_SOH_99
	picture = GFX_evt_feast
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_SOH_99 # Maybe the next one will be a proper one...
	}
}

# Iyomante cancelled - host
character_event = {
	id = soh.100
	desc = EVTDESC_SOH_100
	picture = GFX_evt_feast

	only_rulers = yes
	
	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_100 # I see...
		hidden_tooltip = {
			remove_character_modifier = iyomante_in_progress
			# Clear flags
			clr_character_flag = coming_to_iyomante
			clr_character_flag = do_not_disturb
			clr_character_flag = guest_iyomante_started
			clr_character_flag = host_iyomante_started
			clr_character_flag = iyomante_little_sake
			clr_character_flag = iyomante_many_nusa
			clr_character_flag = iyomante_no_sacrifice
			clr_character_flag = iyomante_normal_nusa
			clr_character_flag = iyomante_normal_sake
			clr_character_flag = iyomante_plentiful_sake
			clr_character_flag = iyomante_single_inaw
			clr_character_flag = lavishly_food
			clr_character_flag = low_food
			clr_character_flag = medium_food
			clr_character_flag = recent_iyomante
			clr_character_flag = sent_invitations
			
			any_vassal = {
				limit = {
					has_character_flag = guest_iyomante_started
				}
				
				# Clear flags
				clr_character_flag = coming_to_iyomante
				clr_character_flag = guest_iyomante_started
				
				letter_event = { id = soh.101 } # Inform vassals
			}
		}
	}
}

# Iyomante cancelled - vassals
letter_event = {
	id = soh.101
	desc = EVTDESC_SOH_101

	is_triggered_only = yes

	option = {
		name = EVTOPTA_SOH_101 # I see...
	}
}

# on_war_started - cancel Iyomante
character_event = {
	id = soh.102
	hide_window = yes
	
	is_triggered_only = yes # on_war_started

	immediate = {
		ROOT = {
			if = {
				limit = { has_character_modifier = iyomante_in_progress }
				character_event = { id = soh.100 }
			}
		}

		FROM = {
			if = {
				limit = { has_character_flag = iyomante_in_progress }
				character_event = { id = soh.100 }
			}
		}
	}
}