# Events related to making Silk Road provinces sometimes flip to the religion of a different Silk Road province
# By Silverswee(e)per

namespace = silkroad

# on_yearly_pulse event firing for the Pope
character_event = {
	id = silkroad.1
	is_triggered_only = yes
	hide_window = yes
	
	only_rulers = yes
	religion = catholic
	
	trigger = {
		controls_religion = yes
	}
	
	immediate = {
		clr_character_flag = silk_road_religion_spread_failed
		# Clear flags related to the direction
		clr_character_flag = move_downstream
		clr_character_flag = move_upstream
		
		# Clear one or both variables
		2861 = {
			set_variable = {
				which = silk_road_religion_spread_distance_counter
				value = 0
			}
			if = {
				limit = {
					ROOT = {
						NOT = {
							has_character_flag = silk_road_religion_spread_failed
						}
					}
				}
				set_variable = {
					which = silk_road_religion_spread_attempts
					value = 1
				}
			}
		}
		random_province = {
			limit = {
				has_owner = yes
				trade_route = silk_road
			}
			save_event_target_as = silk_road_religion_spread_origin_province
			save_event_target_as = silk_road_religion_spread_target_province
			log = "The [silk_road_religion_spread_origin_province.Religion.GetName] religion is attempting to spread along the Silk Road from [silk_road_religion_spread_origin_province.GetName]!"
		}
		
		# Decide on the direction
		if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					province_id = 2861 # Chang'an
				}
			}
			set_character_flag = move_downstream
		}
		else_if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					is_silk_road_endpoint_trigger = yes
				}
			}
			set_character_flag = move_upstream
		}
		else = {
			random_list = {
				50 = {
					set_character_flag = move_downstream
				}
				50 = {
					set_character_flag = move_upstream
				}
			}
		}
		if = {
			limit = {
				has_character_flag = move_downstream
			}
			log = "Silk Road religion spread is moving DOWNSTREAM!"
		}
		if = {
			limit = {
				has_character_flag = move_upstream
			}
			log = "Silk Road religion spread is moving UPSTREAM!"
		}
		
		# Move in the appropriate direction up to 10 times
		move_downstream_or_upstream_based_on_flags_effect = yes # 1
		log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
		random_list = {
			50 = {}
			50 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 2
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			55 = {}
			45 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 3
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			60 = {}
			40 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 4
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			65 = {}
			35 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 5
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			70 = {}
			30 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 6
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			75 = {}
			25 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 7
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			80 = {}
			20 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 8
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			85 = {}
			15 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 9
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		random_list = {
			90 = {}
			10 = {
				modifier = {
					factor = 0
					2861 = {
						is_variable_equal = { which = silk_road_religion_spread_distance_counter value = 10 }
					}
				}
				move_downstream_or_upstream_based_on_flags_effect = yes # 10
				log = "[silk_road_religion_spread_target_province.GetName] is the current target, following the [silk_road_religion_spread_target_province.Religion.GetName] faith!"
			}
		}
		
		# After picking a target, make various checks to see if religion spread is possible
		if = {
			limit = {
				OR = {
					# Nomadic provinces can't get a new religion
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							any_province_holding = {
								OR = {
									holding_type = castle
									holding_type = city
									holding_type = temple
									holding_type = tribal
								}
							}
						}
					}
					# Same religion as the origin province
					event_target:silk_road_religion_spread_target_province = {
						event_target:silk_road_religion_spread_origin_province = {
							religion = PREV
						}
					}
					# Is a holy site of the current religion, and the spreading religion doesn't consider it a holy site
					event_target:silk_road_religion_spread_target_province = {
						is_holy_site_with_matching_province_religion_trigger = yes
						is_holy_site_of_spreading_religion_trigger = no
					}
					# MA in target province is too high
					event_target:silk_road_religion_spread_target_province = {
						religion_authority = 0.75
					}
					# MA in target province is too high
					AND = {
						event_target:silk_road_religion_spread_origin_province = {
							NOT = {
								religion_authority = 0.5
							}
						}
						event_target:silk_road_religion_spread_target_province = {
							religion_authority = 0.5
						}
					}
					# Don't spread in someone's capital!
					event_target:silk_road_religion_spread_target_province = {
						holder_scope = {
							top_liege = {
								capital_scope = {
									province = event_target:silk_road_religion_spread_target_province
								}
							}
						}
					}
				}
			}
			set_character_flag = silk_road_religion_spread_failed
		}
		# Unreformed pagan religions can only convert non-unreformed pagan provinces if the religion has a historical reason to be in a specific region
		else_if = {
			limit = {
				event_target:silk_road_religion_spread_target_province = {
					OR = {
						NOT = {
							religion_group = pagan_group
						}
						is_reformed_religion = yes
					}
				}
			}
			if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						# The religion has no historical reason to be remotely close to the Silk Road
						OR = {
							religion = finnish_pagan
							religion = baltic_pagan
							religion = west_african_pagan
							religion = aztec
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = norse_pagan
					}
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							province_id = 496 # Constantinople, due to the Varangians
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = tengri_pagan
					}
					# Tengri only spreads in the steppes and Manchuria
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_steppe
							region = world_manchuria
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = slavic_pagan
					}
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							province_id = 468 # Ragusa, due to former Slavic presence in the Balkans
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = zun_pagan
					}
					# Zunist can spread in Persia and western India
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_persia
							region = world_india_rajastan
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = bon
					}
					# Bon can spread in Tibet
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							region = world_tibet
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = hellenic_pagan
					}
					# Hellenic has a bias towards the old Roman Empire
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_europe
							region = world_africa_north
							region = world_middle_east_jerusalem
							region = world_asia_minor
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = chinese_pagan
					}
					# Shenist can spread in China
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							region = world_china
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = korean_pagan
					}
					# Muist can spread in Korea and Manchuria
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_korea
							region = world_manchuria
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = ryukyuan_pagan
							religion = ainu_pagan
						}
					}
					# Ryukyuan and Ainu can spread in Japan
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							region = world_japan
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = viet_pagan
					}
					# Thanist can spread in Indochina, Dali, and Canton
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_dali
							region = world_indochina
							region = world_canton
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = sanamahi_pagan
					}
					# Sanamahist can spread in Burma and Dali
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_dali
							region = world_burma
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = melanesian_pagan
							religion = dayak_pagan
						}
					}
					# Melanesian and Kaharingan can spread in Indonesia
					event_target:silk_road_religion_spread_target_province = {
						NOT = {
							region = world_indonesia
						}
					}
				}
				set_character_flag = silk_road_religion_spread_failed
			}
		}
		# Some religions should spread less
		if = {
			limit = {
				NOT = {
					has_character_flag = silk_road_religion_spread_failed
				}
			}
			if = {
				# Shinto shouldn't spread very much
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = shinto
							religion = shugendo
							religion = koshin
						}
					}
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_japan
							culture_group = japonic
						}
					}
				}
				random = {
					chance = 90
					set_character_flag = silk_road_religion_spread_failed
				}
			}
			else_if = {
				# Jain shouldn't spread very much
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = jain
					}
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_india
							region = world_indochina
							region = world_indonesia
							culture_group = dravidian_group
							culture_group = indo_aryan_group
						}
					}
				}
				random = {
					chance = 90
					set_character_flag = silk_road_religion_spread_failed
				}
			}
			else_if = {
				# Hindu shouldn't spread very much
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = hindu
					}
					event_target:silk_road_religion_spread_target_province = {
						NOR = {
							region = world_india
							region = world_indochina
							region = world_indonesia
							region = world_persia
							culture_group = indo_aryan_group
							culture_group = dravidian_group
							culture_group = malay_group
							culture_group = javanese_group
							culture_group = bornean_group
							culture_group = sulawesi_group
							culture_group = ma_i_an
							culture_group = tai_kadai_group
							culture_group = chamic
							culture = bamar
							culture_group = mon_khmer_group
						}
					}
				}
				random = {
					chance = 90
					set_character_flag = silk_road_religion_spread_failed
				}
			}
		}
		# If MA is low, consider automatically failing
		if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					NOT = {
						religion_authority = 0.25
					}
				}
			}
			random = {
				chance = 75
				set_character_flag = silk_road_religion_spread_failed
			}
		}
		# If MA is middling, consider automatically failing
		if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					NOT = {
						religion_authority = 0.5
					}
				}
			}
			random = {
				chance = 50
				set_character_flag = silk_road_religion_spread_failed
			}
		}
		# If the religion isn't Nestorian or Buddhist, consider failing just because
		if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					NOR = {
						religion = nestorian
						religion = buddhist
					}
				}
			}
			random = {
				chance = 50
				set_character_flag = silk_road_religion_spread_failed
			}
		}
		# If the province is resilient to conversion, consdier failing
		if = {
			limit = {
				event_target:silk_road_religion_spread_origin_province = {
					is_hard_to_convert = yes
				}
			}
			random = {
				chance = 50
				set_character_flag = silk_road_religion_spread_failed
			}
		}
		
		# If the religion still can spread, it is time to possibly convert the province
		if = {
			limit = {
				NOT = {
					has_character_flag = silk_road_religion_spread_failed
				}
			}
			# Check various historical biases (and a few plausible alt history ones)
			if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = catholic
							religion = fraticelli
							religion = cathar
							religion = lollard
							religion = waldensian
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_europe
									region = world_middle_east_jerusalem
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = orthodox
							religion = bogomilist
							religion = monothelite
							religion = iconoclast
							religion = paulician
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_europe_south_east
									region = world_asia_minor
									region = world_middle_east_jerusalem
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = miaphysite
							religion = monophysite
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_asia_minor
									region = world_middle_east_jerusalem
									region = world_africa_north
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = nestorian
							religion = messalian
						}
					}
				}
				random_list = {
					75 = { # Better than normal
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					25 = {
						# Nestorian and Messalian have no biases, due to historical spread along the Silk Road
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion_group = muslim
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_africa_north
									region = world_middle_east
									region = world_persia
									region = world_steppe_tarim
									region = world_india
									region = world_indonesia
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion_group = jewish_group
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 1.5 # Lower, due to Radhanites
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_middle_east # Spread around Israel
									region = world_steppe # Khazaria
									region = world_chinese_capital # Kaifeng Jews
									region = world_africa_north # Spread from Semien
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = zoroastrian
							religion = mazdaki
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_persia
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = khurmazta
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_persia
									region = world_steppe_tarim
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = manichean
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_persia
									region = world_steppe
									region = world_manchuria
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = norse_pagan
							religion = norse_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								port = no # Vikings like coasts!
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = finnish_pagan
							religion = finnish_pagan_reformed
							religion = baltic_pagan
							religion = baltic_pagan_reformed
							religion = west_african_pagan
							religion = west_african_pagan_reformed
							religion = aztec
							religion = aztec_reformed
							
						}
					}
				}
				random_list = {
					25 = { # Worse than normal
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					75 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = slavic_pagan
							religion = slavic_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_europe_south_east
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = tengri_pagan
							religion = tengri_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_steppe
									region = world_manchuria
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = zun_pagan
							religion = zun_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_persia
									region = world_steppe_tarim
									region = world_tibet
									region = world_india
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = bon
							religion = bon_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_tibet
									region = world_steppe_tarim
									region = world_india
									region = world_burma
									region = world_dali
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = hellenic_pagan
							religion = hellenic_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_europe
									region = world_africa_north
									region = world_asia_minor
									region = world_middle_east
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = chinese_pagan
							religion = chinese_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_china
									region = world_steppe_tarim
									region = world_tibet
									region = world_indochina
									region = world_korea
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = korean_pagan
							religion = korean_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_korea
									region = world_manchuria
									region = world_china
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = ainu_pagan
							religion = ainu_pagan_reformed
							religion = ryukyuan_pagan
							religion = ryukyuan_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_japan
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = viet_pagan
							religion = viet_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_china
									region = world_indochina
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = sanamahi_pagan
							religion = sanamahi_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_indochina
									region = world_dali
									region = world_tibet
									region = world_india
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = melanesian_pagan
							religion = melanesian_pagan_reformed
							religion = dayak_pagan
							religion = dayak_pagan_reformed
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_indonesia
								}
							}
						}
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									has_religion_feature = religion_proselytizing
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = hindu
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_india
									region = world_persia
									region = world_indochina
									region = world_indonesia
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = buddhist
					}
				}
				random_list = {
					75 = { # Better than normal
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						# Buddhist has no biases, due to historical spread
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = jain
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_india
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = taoist
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_china
									region = world_vietnam
									region = world_korea
									region = world_steppe_tarim
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						OR = {
							religion = shinto
							religion = shugendo
							religion = koshin
						}
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOT = {
									region = world_japan
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else_if = {
				limit = {
					event_target:silk_road_religion_spread_origin_province = {
						religion = confucian
					}
				}
				random_list = {
					50 = {
						event_target:silk_road_religion_spread_target_province = {
							religion = event_target:silk_road_religion_spread_origin_province
							add_province_modifier = {
								modifier = religious_unrest
								years = 5
							}
							province_event = { id = silkroad.2 } # Inform the province's owner
						}
					}
					50 = {
						modifier = {
							factor = 2
							event_target:silk_road_religion_spread_target_province = {
								NOR = {
									region = world_china
									region = world_vietnam
									region = world_korea
									region = world_steppe_tarim
								}
							}
						}
						set_character_flag = silk_road_religion_spread_failed
					}
				}
			}
			else = {
				set_character_flag = silk_road_religion_spread_failed
				log = "Something weird happened!"
			}
		}
		
		if = {
			limit = {
				has_character_flag = silk_road_religion_spread_failed
			}
			log = "Religion spread failed!"
		}
		else = {
			log = "Religion spread was successful!"
		}
		
		# If the spread failed, try again if we've not already tried too many times
		if = {
			limit = {
				has_character_flag = silk_road_religion_spread_failed
				2861 = {
					NOT = {
						is_variable_equal = {
							which = silk_road_religion_spread_attempts
							value = 5
						}
					}
				}
			}
			random = {
				chance = 50
				repeat_event = { id = silkroad.1 } # Make another attempt
			}
		}
		else = {
			clr_character_flag = silk_road_religion_spread_failed
			random = {
				chance = 25
				repeat_event = { id = silkroad.1 days = 90 random = 90 } # Rarely fire again
			}
		}
	}
}

# The province gets the event
province_event = {
	id = silkroad.2
	desc = EVTDESC_SILKROAD_2
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			owner = {
				religion = ROOT
			}
		}
		
		name = EVTOPTA_SILKROAD_2 # Great!
		
		# News spread
		hidden_tooltip = {
			owner = {
				top_liege = {
					if = {
						limit = {
							NOT = { character = PREV }
						}
						character_event = { id = silkroad.3 days = 2 }
					}
					any_vassal = {
						limit = {
							OR = {
								is_parent_religion = ROOT
								religion = ROOT
							}
						}
						character_event = { id = silkroad.3 days = 2 }
					}
				}
			}
		}
	}
	
	option = {
		trigger = {
			owner = {
				NOT = {
					religion = ROOT
				}
			}
		}
		
		name = EVTOPTB_SILKROAD_2 # Not good!
		
		# News spread
		hidden_tooltip = {
			owner = {
				top_liege = {
					if = {
						limit = {
							NOT = { character = PREV }
						}
						character_event = { id = silkroad.3 days = 2 }
					}
					any_vassal = {
						limit = {
							OR = {
								is_parent_religion = ROOT
								religion = ROOT
							}
						}
						character_event = { id = silkroad.3 days = 2 }
					}
				}
			}
		}
	}
}

# Inform others
character_event = {
	id = silkroad.3
	desc = EVTDESC_SILKROAD_3
	picture = GFX_evt_china_stable
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			religion = FROM
		}
		name = EVTOPTA_SILKROAD_3 # Great!
	}
	option = {
		trigger = {
			NOT = {
				religion = FROM
			}
		}
		name = EVTOPTB_SILKROAD_3 # Not good!
	}
}